<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesquisas DS - Sistema de Gest√£o</title>
    <link rel="stylesheet" href="assets/css/site.css">
</head>
<body>
    <header class="site-header">
        <nav class="navbar">
            <div class="nav-brand">
                <h1>üî¨ Pesquisas DS</h1>
            </div>
            <div class="nav-links">
                <a href="index.html">In√≠cio</a>
                <a href="about.html">Sobre</a>
                <a href="contact.html">Contacto</a>
                <a href="#" id="memberAreaLink" class="btn-login">√Årea de Membros</a>
            </div>
        </nav>
    </header>
    <main class="site-main">
        <section class="hero">
            <div class="hero-content">
                <h2>Sistema de Gest√£o de Pesquisas</h2>
                <p>Plataforma segura para gest√£o e an√°lise de dados de pesquisa com autentica√ß√£o avan√ßada.</p>
                <div class="hero-actions">
                    <a href="app/register.html" class="btn-primary">Come√ßar Agora</a>
                    <a href="app/login.html" class="btn-secondary">J√° tenho conta</a>
                </div>
            </div>
        </section>
        <section class="features">
            <div class="container">
                <h3>Funcionalidades Principais</h3>
                <div class="features-grid">
                    <div class="feature-card">
                        <h4>üîê Autentica√ß√£o Segura</h4>
                        <p>Login com JWT, confirma√ß√£o de email e recupera√ß√£o de password.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üë• Gest√£o de Utilizadores</h4>
                        <p>Painel administrativo para aprova√ß√£o e gest√£o de utilizadores.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üìä An√°lise de Dados</h4>
                        <p>Ferramentas avan√ßadas para an√°lise e visualiza√ß√£o de dados.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <footer class="site-footer">
        <div class="container">
            <p>&copy; 2024 Pesquisas DS. Todos os direitos reservados.</p>
        </div>
    </footer>
    <script>
    const WORKER_URL = 'https://worker-ds.mpmendespt.workers.dev';
    // Verificar autentica√ß√£o e redirecionar se necess√°rio
    async function checkAuthAndRedirect() {
        const token = localStorage.getItem('jwt');
        if (!token) return;
        
        try {
            const res = await fetch(`${WORKER_URL}/api/profile`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            if (res.ok) {
                // ‚úÖ CORRE√á√ÉO CR√çTICA: Caminho correto para o dashboard
                window.location.href = 'app/index.html'; // docs/app/index.html
            } else {
                localStorage.removeItem('jwt');
                localStorage.removeItem('user');
            }
        } catch (e) {
            console.error('Erro na verifica√ß√£o de autentica√ß√£o:', e);
        }
    }
    
    function updateMemberLink() {
        const link = document.getElementById('memberAreaLink');
        const token = localStorage.getItem('jwt');
        if (token) {
            link.textContent = 'Meu Dashboard';
            link.href = 'app/index.html'; // ‚úÖ Caminho correto
        } else {
            link.textContent = '√Årea de Membros';
            link.href = 'app/login.html'; // ‚úÖ Caminho correto
        }
    }
    
    // Executar verifica√ß√µes ap√≥s o carregamento
    document.addEventListener('DOMContentLoaded', () => {
        checkAuthAndRedirect();
        updateMemberLink();
    });
    
    // Verificar autentica√ß√£o periodicamente
    setInterval(checkAuthAndRedirect, 30000);
</script>
</body>
</html>