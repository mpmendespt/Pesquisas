<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesquisas DS - Sistema de GestÃ£o</title>
    <link rel="stylesheet" href="assets/css/site.css">
</head>
<body>
    <header class="site-header">
        <nav class="navbar">
            <div class="nav-brand">
                <h1>ğŸ”¬ Pesquisas DS</h1>
            </div>
            <div class="nav-links">
                <a href="index.html">InÃ­cio</a>
                <a href="about.html">Sobre</a>
                <a href="contact.html">Contacto</a>
                <a href="#" id="memberAreaLink" class="btn-login">Ãrea de Membros</a>
            </div>
        </nav>
    </header>
    <main class="site-main">
        <section class="hero">
            <div class="hero-content">
                <h2>Sistema de GestÃ£o de Pesquisas</h2>
                <p>Plataforma segura para gestÃ£o e anÃ¡lise de dados de pesquisa com autenticaÃ§Ã£o avanÃ§ada.</p>
                <div class="hero-actions">
                    <a href="app/register.html" class="btn-primary">ComeÃ§ar Agora</a>
                    <a href="app/login.html" class="btn-secondary">JÃ¡ tenho conta</a>
                </div>
            </div>
        </section>
        <section class="features">
            <div class="container">
                <h3>Funcionalidades Principais</h3>
                <div class="features-grid">
                    <div class="feature-card">
                        <h4>ğŸ” AutenticaÃ§Ã£o Segura</h4>
                        <p>Login com JWT, confirmaÃ§Ã£o de email e recuperaÃ§Ã£o de password.</p>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸ‘¥ GestÃ£o de Utilizadores</h4>
                        <p>Painel administrativo para aprovaÃ§Ã£o e gestÃ£o de utilizadores.</p>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸ“Š AnÃ¡lise de Dados</h4>
                        <p>Ferramentas avanÃ§adas para anÃ¡lise e visualizaÃ§Ã£o de dados.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <footer class="site-footer">
        <div class="container">
            <p>&copy; 2024 Pesquisas DS. Todos os direitos reservados.</p>
        </div>
    </footer>
    <script>
        const WORKER_URL = 'https://worker-ds.mpmendespt.workers.dev';
        // Verificar autenticaÃ§Ã£o e redirecionar se necessÃ¡rio
        async function checkAuthAndRedirect() {
            const token = localStorage.getItem('jwt');
            if (!token) {
                updateMemberLink(false);
                return;
            }
            try {
                const res = await fetch(`${WORKER_URL}/api/profile`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (res.ok) {
                    // EstÃ¡ logado â†’ vai para o dashboard
                    window.location.href = 'app/index.html';
                } else {
                    localStorage.removeItem('jwt');
                    localStorage.removeItem('user');
                    updateMemberLink(false);
                }
            } catch (e) {
                // Ignorar erros de rede
                updateMemberLink(false);
            }
        }
        function updateMemberLink(isLoggedIn) {
            const link = document.getElementById('memberAreaLink');
            if (isLoggedIn) {
                link.textContent = 'Meu Dashboard';
                link.href = 'app/index.html';
            } else {
                link.textContent = 'Ãrea de Membros';
                link.href = 'app/login.html';
            }
        }
        // Executar verificaÃ§Ãµes
        checkAuthAndRedirect();
        // Atualizar link apÃ³s pequeno delay para garantir carregamento
        setTimeout(() => {
            const token = localStorage.getItem('jwt');
            updateMemberLink(!!token);
        }, 100);
    </script>
</body>
</html>