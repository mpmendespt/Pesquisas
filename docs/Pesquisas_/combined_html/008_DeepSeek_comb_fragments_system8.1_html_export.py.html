<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>

        <style id="fixed-toc-styles">
        /* === ESTILOS PRINCIPAIS - TOC FIXO √Ä DIREITA === */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
            scroll-behavior: smooth;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            position: relative;
        }
        /* === TOC FIXO √Ä DIREITA - POSI√á√ÉO CORRIGIDA === */
        #TOC {
            position: fixed !important;
            top: 50% !important;
            right: 20px !important;
            transform: translateY(-50%) !important;
            width: 320px !important;
            max-height: 80vh !important;
            overflow-y: auto !important;
            z-index: 1000 !important;
            background: rgba(255, 255, 255, 0.98) !important;
            padding: 20px !important;
            border-radius: 12px !important;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15) !important;
            border: 1px solid #e0e0e0 !important;
            backdrop-filter: blur(10px) !important;
            transition: all 0.3s ease-in-out !important;
        }
        #TOC.toc-minimized {
            transform: translateY(-50%) translateX(calc(320px - 50px)) !important;
            opacity: 0.3;
            width: 50px !important;
            overflow: hidden;
        }
        #TOC.toc-minimized > *:not(.toc-toggle-btn) {
            display: none !important;
        }
        #TOC h2 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            font-size: 1.2em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .toc-toggle-btn {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .toc-toggle-btn:hover {
            background-color: rgba(0,0,0,0.1);
        }
        #TOC ul {
            list-style-type: none;
            padding-left: 15px;
            margin: 10px 0;
        }
        #TOC ul ul {
            padding-left: 20px;
        }
        #TOC li {
            margin: 8px 0;
            line-height: 1.4;
        }
        #TOC a {
            text-decoration: none;
            color: #495057;
            font-weight: 500;
            transition: all 0.2s ease;
            display: block;
            padding: 6px 10px;
            border-radius: 6px;
            border-left: 3px solid transparent;
        }
        #TOC a:hover {
            color: #007bff;
            background-color: rgba(0, 123, 255, 0.1);
            border-left-color: #007bff;
        }
        #TOC a.active {
            background-color: #007bff !important;
            color: white !important;
            font-weight: bold;
            border-left-color: #0056b3;
        }
        /* Conte√∫do principal com margem para o TOC */
        .main-content {
            margin-right: calc(320px + 40px) !important;
        }
        /* Barra de scroll personalizada APENAS para TOC */
        #TOC::-webkit-scrollbar {
            width: 8px;
        }
        #TOC::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        #TOC::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        #TOC::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        /* === BOT√ÉO VOLTAR AO TOPO (HTMLs individuais) === */
        .back-to-top-content {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .back-to-top-content.show {
            opacity: 1;
            transform: translateY(0);
        }
        .back-to-top-content:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }
        /* === RESPONSIVIDADE === */
        @media (max-width: 1400px) {
            .container {
                max-width: 95%;
                padding: 30px;
            }
            #TOC {
                width: 280px !important;
            }
            .main-content {
                margin-right: 320px !important;
            }
        }
        @media (max-width: 1200px) {
            #TOC {
                width: 260px !important;
                right: 15px !important;
            }
            .main-content {
                margin-right: 300px !important;
            }
        }
        @media (max-width: 992px) {
            #TOC {
                position: relative !important;
                width: 100% !important;
                right: 0 !important;
                top: 0 !important;
                transform: none !important;
                margin: 20px 0;
                max-height: 300px !important;
            }
            .main-content {
                margin-right: 0 !important;
            }
            .back-to-top-content {
                right: 20px;
                bottom: 20px;
            }
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px;
                max-width: 100%;
            }
            #TOC {
                max-height: 250px !important;
                padding: 15px !important;
            }
        }
        </style>
        
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>008_DeepSeek_comb_fragments_system8.1_html_export.py</title>
  <style>

html {
color: #1a1a1a;
background-color: #fdfdfd;
}
body {
margin: 0 auto;
max-width: 36em;
padding-left: 50px;
padding-right: 50px;
padding-top: 50px;
padding-bottom: 50px;
hyphens: auto;
overflow-wrap: break-word;
text-rendering: optimizeLegibility;
font-kerning: normal;
}
@media (max-width: 600px) {
body {
font-size: 0.9em;
padding: 12px;
}
h1 {
font-size: 1.8em;
}
}
@media print {
html {
background-color: white;
}
body {
background-color: transparent;
color: black;
font-size: 12pt;
}
p, h2, h3 {
orphans: 3;
widows: 3;
}
h2, h3, h4 {
page-break-after: avoid;
}
}
p {
margin: 1em 0;
}
a {
color: #1a1a1a;
}
a:visited {
color: #1a1a1a;
}
img {
max-width: 100%;
}
svg {
height: auto;
max-width: 100%;
}
h1, h2, h3, h4, h5, h6 {
margin-top: 1.4em;
}
h5, h6 {
font-size: 1em;
font-style: italic;
}
h6 {
font-weight: normal;
}
ol, ul {
padding-left: 1.7em;
margin-top: 1em;
}
li > ol, li > ul {
margin-top: 0;
}
blockquote {
margin: 1em 0 1em 1.7em;
padding-left: 1em;
border-left: 2px solid #e6e6e6;
color: #606060;
}
code {
font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
font-size: 85%;
margin: 0;
hyphens: manual;
}
pre {
margin: 1em 0;
overflow: auto;
}
pre code {
padding: 0;
overflow: visible;
overflow-wrap: normal;
}
.sourceCode {
background-color: transparent;
overflow: visible;
}
hr {
border: none;
border-top: 1px solid #1a1a1a;
height: 1px;
margin: 1em 0;
}
table {
margin: 1em 0;
border-collapse: collapse;
width: 100%;
overflow-x: auto;
display: block;
font-variant-numeric: lining-nums tabular-nums;
}
table caption {
margin-bottom: 0.75em;
}
tbody {
margin-top: 0.5em;
border-top: 1px solid #1a1a1a;
border-bottom: 1px solid #1a1a1a;
}
th {
border-top: 1px solid #1a1a1a;
padding: 0.25em 0.5em 0.25em 0.5em;
}
td {
padding: 0.125em 0.5em 0.25em 0.5em;
}
header {
margin-bottom: 4em;
text-align: center;
}
#TOC li {
list-style: none;
}
#TOC ul {
padding-left: 1.3em;
}
#TOC > ul {
padding-left: 0;
}
#TOC a:not(:hover) {
text-decoration: none;
}
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}

ul.task-list[class]{list-style: none;}
ul.task-list li input[type="checkbox"] {
font-size: inherit;
width: 0.8em;
margin: 0 0.8em 0.2em -1.6em;
vertical-align: middle;
}

html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
</head>
<body>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#comb_fragments_system8.1_html_export.py-optimiza√ß√£o" id="toc-comb_fragments_system8.1_html_export.py-optimiza√ß√£o"><span class="toc-section-number">1</span>
comb_fragments_system8.1_html_export.py Optimiza√ß√£o</a>
<ul>
<li><a href="#informa√ß√µes" id="toc-informa√ß√µes"><span class="toc-section-number">1.1</span> üìä Informa√ß√µes</a></li>
<li><a href="#conversa" id="toc-conversa"><span class="toc-section-number">1.2</span> üí¨ Conversa</a></li>
</ul></li>
</ul>
</nav>
<h1 data-number="1" id="comb_fragments_system8.1_html_export.py-optimiza√ß√£o"><span class="header-section-number">1</span>
comb_fragments_system8.1_html_export.py Optimiza√ß√£o</h1>
<h2 data-number="1.1" id="informa√ß√µes"><span class="header-section-number">1.1</span> üìä Informa√ß√µes</h2>
<ul>
<li><strong>N√∫mero:</strong> #8</li>
<li><strong>Origem:</strong> DeepSeek</li>
<li><strong>Categoria:</strong> Programa√ß√£o</li>
<li><strong>ID:</strong> 8a2667c6-b2d0-4742-93a1-6f5ead7916e6</li>
<li><strong>Criada em:</strong> 2025-11-09 06:41:41</li>
<li><strong>Atualizada em:</strong> 2025-11-09 06:58:17</li>
<li><strong>Total de mensagens:</strong> 2</li>
<li><strong>Resumo:</strong> Mostra alguns WARNINGs como: 2025-11-08
22:17:34,878 - WARNING - ‚ö†Ô∏è Erro ao baixar imagem <a href="https://v" class="uri">https://v</a>‚Ä¶</li>
</ul>
<hr />
<h2 data-number="1.2" id="conversa"><span class="header-section-number">1.2</span> üí¨ Conversa</h2>
<h3 data-number="1.2.1" id="utilizador-2025-11-09-064142-deepseek-reasoner"><span class="header-section-number">1.2.1</span> üë§ Utilizador <em>(2025-11-09
06:41:42)</em> <em>[deepseek-reasoner]</em></h3>
<p>Mostra alguns WARNINGs como: 2025-11-08 22:17:34,878 - WARNING - ‚ö†Ô∏è
Erro ao baixar imagem <a href="https://via.placeholder.com/300" class="uri">https://via.placeholder.com/300</a>:
HTTPSConnectionPool(host=‚Äòvia.placeholder.com‚Äô, port=443): Max retries
exceeded with url: /300 (Caused by
NameResolutionError(‚Äú&lt;urllib3.connection.HTTPSConnection object at
0x000002100ED84C10&gt;: Failed to resolve ‚Äòvia.placeholder.com‚Äô ([Errno
11002] getaddrinfo failed)‚Äù)) 2025-11-08 22:17:34,886 - WARNING - ‚ö†Ô∏è
Erro ao baixar imagem <a href="https://via.placeholder.com/300" class="uri">https://via.placeholder.com/300</a>:
HTTPSConnectionPool(host=‚Äòvia.placeholder.com‚Äô, port=443): Max retries
exceeded with url: /300 (Caused by
NameResolutionError(‚Äú&lt;urllib3.connection.HTTPSConnection object at
0x000002100ED722D0&gt;: Failed to resolve ‚Äòvia.placeholder.com‚Äô ([Errno
11002] getaddrinfo failed)‚Äù)) Pretendo uma pequna altera√ß√£o que o TOC
flutue √† direita e que seja sempre visivel; isto √©, que n√£o se mova com
scroll da pagina E pretendo um comb_fragments_system8.1_html_export.py
completo e funcional.</p>
<hr />
<h3 data-number="1.2.2" id="deepseek-2025-11-09-064142-deepseek-reasoner"><span class="header-section-number">1.2.2</span> ü§ñ DeepSeek <em>(2025-11-09
06:41:42)</em> <em>[deepseek-reasoner]</em></h3>
<p>Vamos fazer uma altera√ß√£o no CSS e JavaScript para que o TOC flutue √†
direita e fique fixo durante o scroll.</p>
<p>No m√©todo <code>_enhance_toc_interactive</code>, vamos modificar o
JavaScript para que o TOC fique fixo √† direita e sempre vis√≠vel, e
ajustar o CSS para que o conte√∫do principal n√£o fique escondido atr√°s do
TOC.</p>
<p>Altera√ß√µes:</p>
<ol type="1">
<li>No JavaScript, vamos alterar a l√≥gica de posicionamento do TOC para
que ele fique fixo √† direita, independente do scroll.</li>
<li>No CSS, vamos garantir que o TOC tenha uma posi√ß√£o fixa e que o
conte√∫do principal tenha uma margem √† direita para n√£o ser
sobreposto.</li>
</ol>
<p>Vamos modificar o m√©todo <code>_enhance_toc_interactive</code>:</p>
<p>Substituir a parte do JavaScript que lida com o TOC por uma vers√£o
que fixa o TOC √† direita.</p>
<p>Al√©m disso, no CSS, vamos ajustar a largura do TOC e a margem do
conte√∫do.</p>
<p>Vou reescrever a fun√ß√£o <code>_enhance_toc_interactive</code> para
que o TOC fique fixo √† direita e sempre vis√≠vel.</p>
<p>Vamos tamb√©m ajustar o m√©todo <code>_inject_enhanced_css</code> para
adicionar um padding-right no container principal para que o conte√∫do
n√£o fique escondido atr√°s do TOC.</p>
<p>No entanto, note que o TOC flutuante √† direita pode n√£o ser adequado
para telas muito pequenas. Vamos manter a responsividade.</p>
<p>Vamos fazer as seguintes altera√ß√µes:</p>
<ol type="1">
<li>No m√©todo <code>_enhance_toc_interactive</code>:
<ul>
<li>Remover a l√≥gica de scroll que altera a posi√ß√£o do TOC.</li>
<li>Em vez disso, fixar o TOC √† direita com position: fixed.</li>
</ul></li>
<li>No m√©todo <code>_inject_enhanced_css</code>:
<ul>
<li>Adicionar um padding-right no container principal para evitar
sobreposi√ß√£o.</li>
</ul></li>
</ol>
<p>Vamos tamb√©m ajustar o CSS do TOC para que ele fique sempre vis√≠vel e
n√£o se mova com o scroll.</p>
<p>Vou fornecer o c√≥digo completo do m√©todo
<code>_enhance_toc_interactive</code> e
<code>_inject_enhanced_css</code> com as altera√ß√µes.</p>
<p>Como o c√≥digo √© muito longo, vou focar nas partes que precisam ser
alteradas.</p>
<p>Primeiro, no m√©todo <code>_enhance_toc_interactive</code>, substitua
o script JavaScript pelo seguinte:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _enhance_toc_interactive(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Adiciona interatividade avan√ßada ao TOC - FIXO √Ä DIREITA&quot;&quot;&quot;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        interactive_js <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;script&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="st">    document.addEventListener(&#39;DOMContentLoaded&#39;, function() {</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="st">        // TOC FIXO √Ä DIREITA</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="st">        const toc = document.getElementById(&#39;TOC&#39;);</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="st">        if (toc) {</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="st">            // Aplicar estilos para fixar √† direita</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.position = &#39;fixed&#39;;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.top = &#39;20px&#39;;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.right = &#39;20px&#39;;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.maxHeight = &#39;calc(100vh - 40px)&#39;;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.overflowY = &#39;auto&#39;;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.zIndex = &#39;1000&#39;;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.background = &#39;white&#39;;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.padding = &#39;15px&#39;;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.borderRadius = &#39;8px&#39;;</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.boxShadow = &#39;0 4px 12px rgba(0,0,0,0.15)&#39;;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.width = &#39;300px&#39;; // Largura fixa</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="st">            // Ajustar o container principal para n√£o ficar atr√°s do TOC</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="st">            const container = document.querySelector(&#39;.container&#39;);</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="st">            if (container) {</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="st">                container.style.paddingRight = &#39;350px&#39;; // 300px (TOC) + 50px (espa√ßo)</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="st">        // Highlight de se√ß√£o ativa no TOC</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="st">        const sections = document.querySelectorAll(&#39;h1, h2, h3, h4, h5&#39;);</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="st">        const tocLinks = document.querySelectorAll(&#39;#TOC a&#39;);</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="st">        const observerOptions = {</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="st">            rootMargin: &#39;-20% 0px -60% 0px&#39;,</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="st">            threshold: 0</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="st">        };</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="st">        const observer = new IntersectionObserver((entries) =&gt; {</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="st">            entries.forEach(entry =&gt; {</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="st">                if (entry.isIntersecting) {</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="st">                    const id = entry.target.getAttribute(&#39;id&#39;);</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="st">                    tocLinks.forEach(link =&gt; {</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="st">                        link.classList.remove(&#39;active&#39;);</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="st">                        if (link.getAttribute(&#39;href&#39;) === &#39;#&#39; + id) {</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="st">                            link.classList.add(&#39;active&#39;);</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="st">                        }</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="st">                    });</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="st">        }, observerOptions);</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="st">        sections.forEach(section =&gt; {</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="st">            if (section.id) {</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="st">                observer.observe(section);</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="st">        // Smooth scroll com offset para header fixo</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="st">        tocLinks.forEach(link =&gt; {</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="st">            link.addEventListener(&#39;click&#39;, (e) =&gt; {</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="st">                e.preventDefault();</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="st">                const targetId = link.getAttribute(&#39;href&#39;).substring(1);</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="st">                const targetElement = document.getElementById(targetId);</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="st">                if (targetElement) {</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="st">                    const offsetTop = targetElement.offsetTop - 80;</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="st">                    window.scrollTo({</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="st">                        top: offsetTop,</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="st">                        behavior: &#39;smooth&#39;</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="st">                    });</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="st">                    </span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="st">                    // Highlight tempor√°rio</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="st">                    tocLinks.forEach(l =&gt; l.classList.remove(&#39;clicked&#39;));</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="st">                    link.classList.add(&#39;clicked&#39;);</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="st">                    setTimeout(() =&gt; link.classList.remove(&#39;clicked&#39;), 2000);</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="st">        // Bot√£o de voltar ao topo</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a><span class="st">        const backToTop = document.createElement(&#39;div&#39;);</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a><span class="st">        backToTop.innerHTML = &#39;‚¨ÜÔ∏è&#39;;</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a><span class="st">        backToTop.style.cssText = `</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a><span class="st">            position: fixed;</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="st">            bottom: 30px;</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a><span class="st">            right: 30px;</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a><span class="st">            background: #3498db;</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a><span class="st">            color: white;</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a><span class="st">            width: 50px;</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a><span class="st">            height: 50px;</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a><span class="st">            border-radius: 50%;</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a><span class="st">            display: flex;</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a><span class="st">            align-items: center;</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a><span class="st">            justify-content: center;</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a><span class="st">            cursor: pointer;</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="st">            font-size: 20px;</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a><span class="st">            box-shadow: 0 4px 15px rgba(0,0,0,0.2);</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a><span class="st">            opacity: 0;</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a><span class="st">            transition: opacity 0.3s ease;</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a><span class="st">            z-index: 1000;</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a><span class="st">        `;</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a><span class="st">        document.body.appendChild(backToTop);</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a><span class="st">        window.addEventListener(&#39;scroll&#39;, () =&gt; {</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a><span class="st">            backToTop.style.opacity = window.scrollY &gt; 500 ? &#39;1&#39; : &#39;0&#39;;</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a><span class="st">        backToTop.addEventListener(&#39;click&#39;, () =&gt; {</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a><span class="st">            window.scrollTo({ top: 0, behavior: &#39;smooth&#39; });</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a><span class="st">    });</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/script&gt;</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;&quot;&quot;</span></span></code></pre></div>
<p>Agora, no m√©todo <code>_inject_enhanced_css</code>, vamos remover a
flutua√ß√£o do TOC e ajustar o container principal. Substitua a parte do
CSS que define o TOC por:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _inject_enhanced_css(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Injeta CSS personalizado aprimorado para TOC fixo √† direita&quot;&quot;&quot;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        enhanced_css <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;style&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="st">            /* LAYOUT DE TELA COMPLETA OTIMIZADO */</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="st">            body {</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.6;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #f5f5f5;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #333;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: none; /* Remove limita√ß√£o de largura - TELA COMPLETA */</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="st">            .container {</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0 auto;</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="st">                background: white;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 40px;</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 10px;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="st">                position: relative; /* Para posicionamento do TOC */</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="st">            /* TOC FIXO √Ä DIREITA */</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC {</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="st">                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #dee2e6;</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 20px 0;</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="st">                /* Removemos float e margin-left */</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="st">                width: 300px; /* Largura fixa para TOC */</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="st">                position: fixed;</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="st">                top: 20px;</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="st">                right: 20px;</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="st">                max-height: calc(100vh - 40px);</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow-y: auto;</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="st">                z-index: 1000;</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul {</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="st">                list-style-type: none;</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 15px;</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 10px 0;</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul ul {</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 25px;</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC li {</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 8px 0;</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.4;</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a {</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="st">                text-decoration: none;</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #495057;</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 500;</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="st">                transition: color 0.2s ease;</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="st">                display: block;</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 4px 8px;</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 4px;</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a:hover {</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #007bff;</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: rgba(0, 123, 255, 0.1);</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC &gt; ul &gt; li &gt; a {</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 600;</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50;</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 3px solid #3498db;</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 12px;</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Ajuste do conte√∫do principal para n√£o ficar atr√°s do TOC */</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="st">            .container {</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-right: 350px; /* 300px (TOC) + 50px (espa√ßo) */</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a><span class="st">            /* ... (o resto do CSS permanece igual) ... */</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/style&gt;</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span></code></pre></div>
<p>Note que adicionamos um <code>padding-right</code> no container
principal para que o conte√∫do n√£o fique escondido atr√°s do TOC.</p>
<p>No entanto, √© importante notar que o TOC fixo pode n√£o ser ideal em
telas pequenas. Portanto, vamos adicionar uma media query para esconder
o TOC em telas pequenas e remover o padding-right.</p>
<p>Adicione no CSS:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>            <span class="co">/* Em telas menores, esconder o TOC fixo */</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>            <span class="im">@media</span> <span class="fu">(</span><span class="kw">max-width</span><span class="ch">:</span> <span class="dv">1200</span><span class="dt">px</span><span class="fu">)</span> {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                <span class="pp">#TOC</span> {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">display</span><span class="ch">:</span> <span class="dv">none</span><span class="op">;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">.container</span> {</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">padding-right</span><span class="ch">:</span> <span class="dv">40</span><span class="dt">px</span> <span class="at">!important</span><span class="op">;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>            }</span></code></pre></div>
<p>Isso far√° com que o TOC n√£o apare√ßa em telas menores que 1200px, e o
container voltar√° a ter o padding normal.</p>
<p>Vamos integrar essas altera√ß√µes no c√≥digo.</p>
<p>Como o c√≥digo √© muito extenso, vou fornecer apenas os m√©todos
alterados. No entanto, note que o c√≥digo completo do script deve ser
mantido.</p>
<p>Vou fornecer o c√≥digo completo do script com as altera√ß√µes? Aqui est√°
o c√≥digo completo e funcional com o TOC fixo √† direita que permanece
sempre vis√≠vel durante o scroll:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># comb_fragments_system8.1_html_export.py</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> webbrowser</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tempfile</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> traceback</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Any, Optional</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> markdown</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> base64</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> imghdr</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> unicodedata</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hashlib</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> urllib.parse <span class="im">import</span> urlparse</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ConversionCache:</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Sistema de cache para convers√µes Pandoc&quot;&quot;&quot;</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, cache_dir: Path <span class="op">=</span> Path(<span class="st">&quot;.pandoc_cache&quot;</span>)):</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cache_dir <span class="op">=</span> cache_dir</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cache_dir.mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_cache_key(<span class="va">self</span>, content: <span class="bu">str</span>, options: <span class="bu">dict</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Gera chave √∫nica baseada no conte√∫do e op√ß√µes&quot;&quot;&quot;</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>        content_hash <span class="op">=</span> hashlib.md5(content.encode(<span class="st">&#39;utf-8&#39;</span>)).hexdigest()</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>        options_hash <span class="op">=</span> hashlib.md5(<span class="bu">str</span>(options).encode(<span class="st">&#39;utf-8&#39;</span>)).hexdigest()</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;</span><span class="sc">{</span>content_hash<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>options_hash<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_cached_conversion(<span class="va">self</span>, key: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Recupera convers√£o do cache&quot;&quot;&quot;</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>        cache_file <span class="op">=</span> <span class="va">self</span>.cache_dir <span class="op">/</span> <span class="ss">f&quot;</span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">.html&quot;</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cache_file.exists():</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(cache_file, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> f.read()</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span>:</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>                <span class="cf">pass</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_conversion(<span class="va">self</span>, key: <span class="bu">str</span>, html_content: <span class="bu">str</span>):</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva convers√£o no cache&quot;&quot;&quot;</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>        cache_file <span class="op">=</span> <span class="va">self</span>.cache_dir <span class="op">/</span> <span class="ss">f&quot;</span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">.html&quot;</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(cache_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>                f.write(html_content)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>            logging.warning(<span class="ss">f&quot;‚ö†Ô∏è N√£o foi poss√≠vel salvar cache: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> clear_cache(<span class="va">self</span>):</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Limpa todo o cache&quot;&quot;&quot;</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.cache_dir.exists():</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(<span class="va">self</span>.cache_dir)</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.cache_dir.mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f&quot;‚ùå Erro ao limpar cache: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CombinedFragmentsSystem:</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dry_run<span class="op">=</span><span class="va">False</span>, force_overwrite<span class="op">=</span><span class="va">False</span>, clear_cache<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_dir <span class="op">=</span> Path(<span class="st">&quot;data&quot;</span>)</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dry_run <span class="op">=</span> dry_run</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.force_overwrite <span class="op">=</span> force_overwrite</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configurar logging</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>        logging.basicConfig(level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">&#39;</span>)</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Sistema de cache</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conversion_cache <span class="op">=</span> ConversionCache()</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.enable_cache <span class="op">=</span> <span class="va">True</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Limpar cache se solicitado</span></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> clear_cache:</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.conversion_cache.clear_cache():</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="st">&quot;‚úÖ Cache limpo com sucesso&quot;</span>)</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Falha ao limpar cache&quot;</span>)</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estrutura de pastas organizada</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dirs <span class="op">=</span> {</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;markdown&#39;</span>: <span class="st">&quot;combined_markdown&quot;</span>,</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_csv&quot;</span>, </span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_json&quot;</span>,</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;pdfs&#39;</span>: <span class="st">&quot;combined_pdfs&quot;</span>,</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;html&#39;</span>: <span class="st">&quot;combined_html&quot;</span>,</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;attachments&#39;</span>: <span class="st">&quot;combined_attachments&quot;</span></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.single_files <span class="op">=</span> {</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_all_conversations.csv&quot;</span>,</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_all_conversations.json&quot;</span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.index_file <span class="op">=</span> <span class="st">&quot;index.html&quot;</span></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations <span class="op">=</span> []</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configura√ß√£o de processamento por fonte</span></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.processors <span class="op">=</span> {</span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;qwen&#39;</span>: {</span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chat-export.json&quot;</span>,</span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_qwen_corrected,</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;chatgpt&#39;</span>: {</span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chatgpt.zip&quot;</span>, </span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_chatgpt,</span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;deepseek&#39;</span>: {</span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;deepseek_data.zip&quot;</span>,</span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_deepseek,</span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;grok&#39;</span>: {</span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;grok.zip&quot;</span>,</span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_grok,</span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verificar depend√™ncias opcionais</span></span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>            <span class="im">import</span> requests</span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.requests_available <span class="op">=</span> <span class="va">True</span></span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.requests_available <span class="op">=</span> <span class="va">False</span></span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è Biblioteca &#39;requests&#39; n√£o dispon√≠vel - URLs de imagem n√£o ser√£o baixadas&quot;</span>)</span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sanitize_filename(<span class="va">self</span>, text: <span class="bu">str</span>, max_len: <span class="bu">int</span> <span class="op">=</span> <span class="dv">50</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Sanitiza nomes de arquivo REMOVENDO ESPA√áOS e preservando emojis&quot;&quot;&quot;</span></span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove caracteres inv√°lidos</span></span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="dv">\s</span><span class="pp">]</span><span class="vs">&#39;</span>  <span class="co"># Inclui \s para remover espa√ßos</span></span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;_&#39;</span>, text)  <span class="co"># Substitui espa√ßos por underscores</span></span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;_</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39;_&#39;</span>, sanitized)  <span class="co"># Remove underscores duplicados</span></span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> sanitized.strip(<span class="st">&#39;_&#39;</span>)  <span class="co"># Remove underscores no in√≠cio e fim</span></span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Limita o comprimento</span></span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(sanitized) <span class="op">&gt;</span> max_len:</span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Tenta cortar em um ponto l√≥gico (underscore)</span></span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;_&#39;</span> <span class="kw">in</span> sanitized[:max_len]:</span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a>                last_underscore <span class="op">=</span> sanitized[:max_len].rfind(<span class="st">&#39;_&#39;</span>)</span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> last_underscore <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a>                    sanitized <span class="op">=</span> sanitized[:last_underscore]</span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a>                sanitized <span class="op">=</span> sanitized[:max_len]</span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_original_title(<span class="va">self</span>, text: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Preserva o t√≠tulo original com espa√ßos, apenas removendo caracteres realmente inv√°lidos&quot;&quot;&quot;</span></span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove apenas caracteres realmente problem√°ticos, mantendo espa√ßos</span></span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="pp">]</span><span class="vs">&#39;</span></span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;&#39;</span>, text)</span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;</span><span class="dv">\s</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39; &#39;</span>, sanitized.strip())</span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> normalize_unicode_advanced(<span class="va">self</span>, text: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Normaliza√ß√£o Unicode avan√ßada para preservar acentua√ß√£o e caracteres especiais&quot;&quot;&quot;</span></span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> text</span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Normaliza√ß√£o NFC (Canonical Decomposition followed by Canonical Composition)</span></span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a>        normalized <span class="op">=</span> unicodedata.normalize(<span class="st">&#39;NFC&#39;</span>, text)</span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Corre√ß√µes espec√≠ficas para problemas comuns</span></span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a>        corrections <span class="op">=</span> {</span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√É¬°&#39;</span>: <span class="st">&#39;√°&#39;</span>, <span class="st">&#39;√É¬©&#39;</span>: <span class="st">&#39;√©&#39;</span>, <span class="st">&#39;√É¬≠&#39;</span>: <span class="st">&#39;√≠&#39;</span>, <span class="st">&#39;√É¬≥&#39;</span>: <span class="st">&#39;√≥&#39;</span>, <span class="st">&#39;√É¬∫&#39;</span>: <span class="st">&#39;√∫&#39;</span>,</span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√É¬£&#39;</span>: <span class="st">&#39;√£&#39;</span>, <span class="st">&#39;√É¬µ&#39;</span>: <span class="st">&#39;√µ&#39;</span>, <span class="st">&#39;√É¬ß&#39;</span>: <span class="st">&#39;√ß&#39;</span>, </span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√É‚Ç¨&#39;</span>: <span class="st">&#39;√Ä&#39;</span>, <span class="st">&#39;√É‚Ä∞&#39;</span>: <span class="st">&#39;√â&#39;</span>, <span class="st">&#39;√É¬ç&#39;</span>: <span class="st">&#39;√ç&#39;</span>, <span class="st">&#39;√É‚Äú&#39;</span>: <span class="st">&#39;√ì&#39;</span>, <span class="st">&#39;√É≈°&#39;</span>: <span class="st">&#39;√ö&#39;</span>,</span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√É∆í&#39;</span>: <span class="st">&#39;√É&#39;</span>, <span class="st">&#39;√É‚Ä¢&#39;</span>: <span class="st">&#39;√ï&#39;</span>, <span class="st">&#39;√É‚Ä°&#39;</span>: <span class="st">&#39;√á&#39;</span>,</span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢‚Ç¨≈ì&#39;</span>: <span class="st">&#39;&quot;&#39;</span>, <span class="st">&#39;√¢‚Ç¨¬ù&#39;</span>: <span class="st">&#39;&quot;&#39;</span>, <span class="st">&#39;√¢‚Ç¨Àú&#39;</span>: <span class="st">&quot;&#39;&quot;</span>, <span class="st">&#39;√¢‚Ç¨‚Ñ¢&#39;</span>: <span class="st">&quot;&#39;&quot;</span>,</span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢‚Ç¨¬¶&#39;</span>: <span class="st">&#39;...&#39;</span>, <span class="st">&#39;√¢‚Ç¨‚Äú&#39;</span>: <span class="st">&#39;‚Äì&#39;</span>, <span class="st">&#39;√¢‚Ç¨‚Äù&#39;</span>: <span class="st">&#39;‚Äî&#39;</span>,</span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> wrong, correct <span class="kw">in</span> corrections.items():</span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a>            normalized <span class="op">=</span> normalized.replace(wrong, correct)</span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> normalized</span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_and_save_attachments(<span class="va">self</span>, content: <span class="bu">str</span>, conv_number: <span class="bu">int</span>, msg_index: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[<span class="bu">str</span>, <span class="bu">list</span>]:</span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true" tabindex="-1"></a><span class="co">        Extrai e salva anexos (imagens, arquivos) do conte√∫do</span></span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a><span class="co">        Retorna: (conte√∫do modificado, lista de arquivos salvos)</span></span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> content, []</span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a>        saved_files <span class="op">=</span> []</span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a>        modified_content <span class="op">=</span> content</span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Padr√µes para detectar anexos</span></span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a>        patterns <span class="op">=</span> {</span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;base64_image&#39;</span>: <span class="vs">r&#39;data:image/</span><span class="kw">(</span><span class="pp">[^;]</span><span class="op">+</span><span class="kw">)</span><span class="vs">;base64,</span><span class="kw">(</span><span class="pp">[^</span><span class="dv">\s</span><span class="pp">&quot;</span><span class="ch">\&#39;</span><span class="pp">]</span><span class="op">+</span><span class="kw">)</span><span class="vs">&#39;</span>,</span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;image_url&#39;</span>: <span class="vs">r&#39;!</span><span class="ch">\[</span><span class="pp">[^</span><span class="ch">\]</span><span class="pp">]</span><span class="op">*</span><span class="ch">\]\(</span><span class="kw">(</span><span class="pp">[^</span><span class="ch">\)</span><span class="pp">]</span><span class="op">+</span><span class="kw">)</span><span class="ch">\)</span><span class="vs">&#39;</span>,</span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;file_reference&#39;</span>: <span class="vs">r&#39;</span><span class="ch">\[</span><span class="vs">arquivo:</span><span class="kw">(</span><span class="pp">[^</span><span class="ch">\]</span><span class="pp">]</span><span class="op">+</span><span class="kw">)</span><span class="ch">\]</span><span class="vs">&#39;</span>,</span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Processar imagens base64</span></span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a>        base64_matches <span class="op">=</span> re.findall(patterns[<span class="st">&#39;base64_image&#39;</span>], content)</span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, (img_type, base64_data) <span class="kw">in</span> <span class="bu">enumerate</span>(base64_matches):</span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Decodificar base64</span></span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a>                image_data <span class="op">=</span> base64.b64decode(base64_data)</span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Determinar extens√£o real</span></span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a>                extension <span class="op">=</span> imghdr.what(<span class="va">None</span>, image_data) <span class="kw">or</span> img_type</span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> extension <span class="op">==</span> <span class="st">&#39;jpeg&#39;</span>:</span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a>                    extension <span class="op">=</span> <span class="st">&#39;jpg&#39;</span></span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;conv_</span><span class="sc">{</span>conv_number<span class="sc">:03d}</span><span class="ss">_msg_</span><span class="sc">{</span>msg_index<span class="sc">:02d}</span><span class="ss">_img_</span><span class="sc">{</span>i<span class="sc">:02d}</span><span class="ss">.</span><span class="sc">{</span>extension<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-236"><a href="#cb4-236" aria-hidden="true" tabindex="-1"></a>                filepath <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;attachments&#39;</span>]) <span class="op">/</span> filename</span>
<span id="cb4-237"><a href="#cb4-237" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-238"><a href="#cb4-238" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-239"><a href="#cb4-239" aria-hidden="true" tabindex="-1"></a>                    Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;attachments&#39;</span>]).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-240"><a href="#cb4-240" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;wb&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-241"><a href="#cb4-241" aria-hidden="true" tabindex="-1"></a>                        f.write(image_data)</span>
<span id="cb4-242"><a href="#cb4-242" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-243"><a href="#cb4-243" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Substituir no conte√∫do</span></span>
<span id="cb4-244"><a href="#cb4-244" aria-hidden="true" tabindex="-1"></a>                replacement <span class="op">=</span> <span class="ss">f&quot;![Imagem </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">](</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>output_dirs[<span class="st">&#39;attachments&#39;</span>]<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">)&quot;</span></span>
<span id="cb4-245"><a href="#cb4-245" aria-hidden="true" tabindex="-1"></a>                modified_content <span class="op">=</span> modified_content.replace(</span>
<span id="cb4-246"><a href="#cb4-246" aria-hidden="true" tabindex="-1"></a>                    <span class="ss">f&quot;data:image/</span><span class="sc">{</span>img_type<span class="sc">}</span><span class="ss">;base64,</span><span class="sc">{</span>base64_data<span class="sc">}</span><span class="ss">&quot;</span>, </span>
<span id="cb4-247"><a href="#cb4-247" aria-hidden="true" tabindex="-1"></a>                    replacement</span>
<span id="cb4-248"><a href="#cb4-248" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb4-249"><a href="#cb4-249" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-250"><a href="#cb4-250" aria-hidden="true" tabindex="-1"></a>                saved_files.append(<span class="bu">str</span>(filepath))</span>
<span id="cb4-251"><a href="#cb4-251" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Imagem salva: </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-252"><a href="#cb4-252" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-253"><a href="#cb4-253" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-254"><a href="#cb4-254" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Erro ao processar imagem base64: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-255"><a href="#cb4-255" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-256"><a href="#cb4-256" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Processar URLs de imagem (apenas se requests dispon√≠vel)</span></span>
<span id="cb4-257"><a href="#cb4-257" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.requests_available:</span>
<span id="cb4-258"><a href="#cb4-258" aria-hidden="true" tabindex="-1"></a>            url_matches <span class="op">=</span> re.findall(patterns[<span class="st">&#39;image_url&#39;</span>], content)</span>
<span id="cb4-259"><a href="#cb4-259" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, url <span class="kw">in</span> <span class="bu">enumerate</span>(url_matches):</span>
<span id="cb4-260"><a href="#cb4-260" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> url.startswith(<span class="st">&#39;http&#39;</span>):</span>
<span id="cb4-261"><a href="#cb4-261" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">try</span>:</span>
<span id="cb4-262"><a href="#cb4-262" aria-hidden="true" tabindex="-1"></a>                        <span class="im">import</span> requests</span>
<span id="cb4-263"><a href="#cb4-263" aria-hidden="true" tabindex="-1"></a>                        response <span class="op">=</span> requests.get(url, timeout<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb4-264"><a href="#cb4-264" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb4-265"><a href="#cb4-265" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># Determinar tipo da imagem</span></span>
<span id="cb4-266"><a href="#cb4-266" aria-hidden="true" tabindex="-1"></a>                            extension <span class="op">=</span> imghdr.what(<span class="va">None</span>, response.content) <span class="kw">or</span> <span class="st">&#39;png&#39;</span></span>
<span id="cb4-267"><a href="#cb4-267" aria-hidden="true" tabindex="-1"></a>                            filename <span class="op">=</span> <span class="ss">f&quot;conv_</span><span class="sc">{</span>conv_number<span class="sc">:03d}</span><span class="ss">_msg_</span><span class="sc">{</span>msg_index<span class="sc">:02d}</span><span class="ss">_url_</span><span class="sc">{</span>i<span class="sc">:02d}</span><span class="ss">.</span><span class="sc">{</span>extension<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-268"><a href="#cb4-268" aria-hidden="true" tabindex="-1"></a>                            filepath <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;attachments&#39;</span>]) <span class="op">/</span> filename</span>
<span id="cb4-269"><a href="#cb4-269" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb4-270"><a href="#cb4-270" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-271"><a href="#cb4-271" aria-hidden="true" tabindex="-1"></a>                                Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;attachments&#39;</span>]).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-272"><a href="#cb4-272" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;wb&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-273"><a href="#cb4-273" aria-hidden="true" tabindex="-1"></a>                                    f.write(response.content)</span>
<span id="cb4-274"><a href="#cb4-274" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb4-275"><a href="#cb4-275" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># Substituir URL por caminho local</span></span>
<span id="cb4-276"><a href="#cb4-276" aria-hidden="true" tabindex="-1"></a>                            modified_content <span class="op">=</span> modified_content.replace(</span>
<span id="cb4-277"><a href="#cb4-277" aria-hidden="true" tabindex="-1"></a>                                url, </span>
<span id="cb4-278"><a href="#cb4-278" aria-hidden="true" tabindex="-1"></a>                                <span class="ss">f&quot;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>output_dirs[<span class="st">&#39;attachments&#39;</span>]<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-279"><a href="#cb4-279" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb4-280"><a href="#cb4-280" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb4-281"><a href="#cb4-281" aria-hidden="true" tabindex="-1"></a>                            saved_files.append(<span class="bu">str</span>(filepath))</span>
<span id="cb4-282"><a href="#cb4-282" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Imagem URL salva: </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-283"><a href="#cb4-283" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb4-284"><a href="#cb4-284" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-285"><a href="#cb4-285" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Erro ao baixar imagem </span><span class="sc">{</span>url<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-286"><a href="#cb4-286" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-287"><a href="#cb4-287" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> modified_content, saved_files</span>
<span id="cb4-288"><a href="#cb4-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-289"><a href="#cb4-289" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_qwen_attachments(<span class="va">self</span>, content_list: <span class="bu">list</span>, conv_number: <span class="bu">int</span>, msg_index: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[<span class="bu">str</span>, <span class="bu">list</span>]:</span>
<span id="cb4-290"><a href="#cb4-290" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa anexos espec√≠ficos do Qwen com content_list&quot;&quot;&quot;</span></span>
<span id="cb4-291"><a href="#cb4-291" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> content_list <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(content_list, <span class="bu">list</span>):</span>
<span id="cb4-292"><a href="#cb4-292" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;&quot;</span>, []</span>
<span id="cb4-293"><a href="#cb4-293" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-294"><a href="#cb4-294" aria-hidden="true" tabindex="-1"></a>        content_parts <span class="op">=</span> []</span>
<span id="cb4-295"><a href="#cb4-295" aria-hidden="true" tabindex="-1"></a>        saved_files <span class="op">=</span> []</span>
<span id="cb4-296"><a href="#cb4-296" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-297"><a href="#cb4-297" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> item <span class="kw">in</span> content_list:</span>
<span id="cb4-298"><a href="#cb4-298" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(item, <span class="bu">dict</span>):</span>
<span id="cb4-299"><a href="#cb4-299" aria-hidden="true" tabindex="-1"></a>                item_type <span class="op">=</span> item.get(<span class="st">&#39;type&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb4-300"><a href="#cb4-300" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-301"><a href="#cb4-301" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> item_type <span class="op">==</span> <span class="st">&#39;image&#39;</span> <span class="kw">and</span> <span class="st">&#39;data&#39;</span> <span class="kw">in</span> item:</span>
<span id="cb4-302"><a href="#cb4-302" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Processar imagem base64 do Qwen</span></span>
<span id="cb4-303"><a href="#cb4-303" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">try</span>:</span>
<span id="cb4-304"><a href="#cb4-304" aria-hidden="true" tabindex="-1"></a>                        image_data <span class="op">=</span> item[<span class="st">&#39;data&#39;</span>]</span>
<span id="cb4-305"><a href="#cb4-305" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> image_data.startswith(<span class="st">&#39;data:image&#39;</span>):</span>
<span id="cb4-306"><a href="#cb4-306" aria-hidden="true" tabindex="-1"></a>                            base64_match <span class="op">=</span> re.search(<span class="vs">r&#39;base64,</span><span class="kw">(</span><span class="pp">[^</span><span class="ch">\&quot;</span><span class="pp">]</span><span class="op">+</span><span class="kw">)</span><span class="vs">&#39;</span>, image_data)</span>
<span id="cb4-307"><a href="#cb4-307" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> base64_match:</span>
<span id="cb4-308"><a href="#cb4-308" aria-hidden="true" tabindex="-1"></a>                                base64_str <span class="op">=</span> base64_match.group(<span class="dv">1</span>)</span>
<span id="cb4-309"><a href="#cb4-309" aria-hidden="true" tabindex="-1"></a>                                image_binary <span class="op">=</span> base64.b64decode(base64_str)</span>
<span id="cb4-310"><a href="#cb4-310" aria-hidden="true" tabindex="-1"></a>                                </span>
<span id="cb4-311"><a href="#cb4-311" aria-hidden="true" tabindex="-1"></a>                                extension <span class="op">=</span> imghdr.what(<span class="va">None</span>, image_binary) <span class="kw">or</span> <span class="st">&#39;png&#39;</span></span>
<span id="cb4-312"><a href="#cb4-312" aria-hidden="true" tabindex="-1"></a>                                filename <span class="op">=</span> <span class="ss">f&quot;qwen_conv_</span><span class="sc">{</span>conv_number<span class="sc">:03d}</span><span class="ss">_msg_</span><span class="sc">{</span>msg_index<span class="sc">:02d}</span><span class="ss">.</span><span class="sc">{</span>extension<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-313"><a href="#cb4-313" aria-hidden="true" tabindex="-1"></a>                                filepath <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;attachments&#39;</span>]) <span class="op">/</span> filename</span>
<span id="cb4-314"><a href="#cb4-314" aria-hidden="true" tabindex="-1"></a>                                </span>
<span id="cb4-315"><a href="#cb4-315" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-316"><a href="#cb4-316" aria-hidden="true" tabindex="-1"></a>                                    Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;attachments&#39;</span>]).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-317"><a href="#cb4-317" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;wb&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-318"><a href="#cb4-318" aria-hidden="true" tabindex="-1"></a>                                        f.write(image_binary)</span>
<span id="cb4-319"><a href="#cb4-319" aria-hidden="true" tabindex="-1"></a>                                </span>
<span id="cb4-320"><a href="#cb4-320" aria-hidden="true" tabindex="-1"></a>                                content_parts.append(<span class="ss">f&quot;![Imagem Qwen](</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>output_dirs[<span class="st">&#39;attachments&#39;</span>]<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb4-321"><a href="#cb4-321" aria-hidden="true" tabindex="-1"></a>                                saved_files.append(<span class="bu">str</span>(filepath))</span>
<span id="cb4-322"><a href="#cb4-322" aria-hidden="true" tabindex="-1"></a>                                </span>
<span id="cb4-323"><a href="#cb4-323" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-324"><a href="#cb4-324" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Erro ao processar imagem Qwen: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-325"><a href="#cb4-325" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-326"><a href="#cb4-326" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> item_type <span class="op">==</span> <span class="st">&#39;text&#39;</span> <span class="kw">and</span> <span class="st">&#39;text&#39;</span> <span class="kw">in</span> item:</span>
<span id="cb4-327"><a href="#cb4-327" aria-hidden="true" tabindex="-1"></a>                    content_parts.append(<span class="bu">str</span>(item[<span class="st">&#39;text&#39;</span>]))</span>
<span id="cb4-328"><a href="#cb4-328" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-329"><a href="#cb4-329" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(content_parts), saved_files</span>
<span id="cb4-330"><a href="#cb4-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-331"><a href="#cb4-331" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> normalize_math_formulas(<span class="va">self</span>, content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-332"><a href="#cb4-332" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Normaliza f√≥rmulas matem√°ticas para formato consistente&quot;&quot;&quot;</span></span>
<span id="cb4-333"><a href="#cb4-333" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Converter \( ... \) para $ ... $</span></span>
<span id="cb4-334"><a href="#cb4-334" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> re.sub(<span class="vs">r&#39;</span><span class="ch">\\\(</span><span class="kw">(</span><span class="dv">.</span><span class="op">+?</span><span class="kw">)</span><span class="ch">\\\)</span><span class="vs">&#39;</span>, <span class="vs">r&#39;</span><span class="dv">$</span><span class="ch">\1</span><span class="dv">$</span><span class="vs">&#39;</span>, content)</span>
<span id="cb4-335"><a href="#cb4-335" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-336"><a href="#cb4-336" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Converter \[ ... \] para $$ ... $$</span></span>
<span id="cb4-337"><a href="#cb4-337" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> re.sub(<span class="vs">r&#39;</span><span class="ch">\\\[</span><span class="kw">(</span><span class="dv">.</span><span class="op">+?</span><span class="kw">)</span><span class="ch">\\\]</span><span class="vs">&#39;</span>, <span class="vs">r&#39;</span><span class="dv">$$</span><span class="ch">\1</span><span class="dv">$$</span><span class="vs">&#39;</span>, content)</span>
<span id="cb4-338"><a href="#cb4-338" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-339"><a href="#cb4-339" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Garantir espa√ßos adequados ao redor de f√≥rmulas</span></span>
<span id="cb4-340"><a href="#cb4-340" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> re.sub(<span class="vs">r&#39;</span><span class="kw">(</span><span class="dv">\S</span><span class="kw">)</span><span class="ch">\$</span><span class="kw">(</span><span class="dv">\S</span><span class="kw">)</span><span class="vs">&#39;</span>, <span class="vs">r&#39;</span><span class="ch">\1</span><span class="vs"> </span><span class="dv">$</span><span class="ch">\2</span><span class="vs">&#39;</span>, content)  <span class="co"># Adiciona espa√ßo antes</span></span>
<span id="cb4-341"><a href="#cb4-341" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> re.sub(<span class="vs">r&#39;</span><span class="kw">(</span><span class="dv">\S</span><span class="kw">)</span><span class="ch">\$</span><span class="kw">(</span><span class="dv">\S</span><span class="kw">)</span><span class="vs">&#39;</span>, <span class="vs">r&#39;</span><span class="ch">\1</span><span class="dv">$</span><span class="vs"> </span><span class="ch">\2</span><span class="vs">&#39;</span>, content)  <span class="co"># Adiciona espa√ßo depois</span></span>
<span id="cb4-342"><a href="#cb4-342" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-343"><a href="#cb4-343" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> content</span>
<span id="cb4-344"><a href="#cb4-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-345"><a href="#cb4-345" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_special_content_enhanced(<span class="va">self</span>, content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-346"><a href="#cb4-346" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Preserva√ß√£o expandida de conte√∫do especial com normaliza√ß√£o Unicode&quot;&quot;&quot;</span></span>
<span id="cb4-347"><a href="#cb4-347" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb4-348"><a href="#cb4-348" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;&quot;</span></span>
<span id="cb4-349"><a href="#cb4-349" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-350"><a href="#cb4-350" aria-hidden="true" tabindex="-1"></a>        preserved_content <span class="op">=</span> <span class="va">self</span>.normalize_unicode_advanced(content)</span>
<span id="cb4-351"><a href="#cb4-351" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-352"><a href="#cb4-352" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Proteger blocos de c√≥digo antes de outras transforma√ß√µes</span></span>
<span id="cb4-353"><a href="#cb4-353" aria-hidden="true" tabindex="-1"></a>        code_blocks <span class="op">=</span> {}</span>
<span id="cb4-354"><a href="#cb4-354" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> protect_code_blocks(match):</span>
<span id="cb4-355"><a href="#cb4-355" aria-hidden="true" tabindex="-1"></a>            block_id <span class="op">=</span> <span class="ss">f&quot;__CODE_BLOCK_</span><span class="sc">{</span><span class="bu">len</span>(code_blocks)<span class="sc">}</span><span class="ss">__&quot;</span></span>
<span id="cb4-356"><a href="#cb4-356" aria-hidden="true" tabindex="-1"></a>            code_blocks[block_id] <span class="op">=</span> match.group(<span class="dv">0</span>)</span>
<span id="cb4-357"><a href="#cb4-357" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> block_id</span>
<span id="cb4-358"><a href="#cb4-358" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-359"><a href="#cb4-359" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Proteger blocos de c√≥digo</span></span>
<span id="cb4-360"><a href="#cb4-360" aria-hidden="true" tabindex="-1"></a>        preserved_content <span class="op">=</span> re.sub(</span>
<span id="cb4-361"><a href="#cb4-361" aria-hidden="true" tabindex="-1"></a>            <span class="vs">r&#39;```</span><span class="dv">.</span><span class="op">*?</span><span class="vs">```</span><span class="cf">|</span><span class="vs">`</span><span class="pp">[^`]</span><span class="op">+</span><span class="vs">`&#39;</span>, </span>
<span id="cb4-362"><a href="#cb4-362" aria-hidden="true" tabindex="-1"></a>            protect_code_blocks, </span>
<span id="cb4-363"><a href="#cb4-363" aria-hidden="true" tabindex="-1"></a>            preserved_content, </span>
<span id="cb4-364"><a href="#cb4-364" aria-hidden="true" tabindex="-1"></a>            flags<span class="op">=</span>re.DOTALL</span>
<span id="cb4-365"><a href="#cb4-365" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-366"><a href="#cb4-366" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-367"><a href="#cb4-367" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Expandir corre√ß√µes LaTeX</span></span>
<span id="cb4-368"><a href="#cb4-368" aria-hidden="true" tabindex="-1"></a>        latex_corrections <span class="op">=</span> {</span>
<span id="cb4-369"><a href="#cb4-369" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ärac&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">frac&#39;</span>,</span>
<span id="cb4-370"><a href="#cb4-370" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Çarepsilon&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">varepsilon&#39;</span>,</span>
<span id="cb4-371"><a href="#cb4-371" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ç&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span>,</span>
<span id="cb4-372"><a href="#cb4-372" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ä&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span>,</span>
<span id="cb4-373"><a href="#cb4-373" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬à¬à&#39;</span>: <span class="st">&#39;‚àà&#39;</span>,</span>
<span id="cb4-374"><a href="#cb4-374" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬à¬Ü&#39;</span>: <span class="st">&#39;‚àÜ&#39;</span>,</span>
<span id="cb4-375"><a href="#cb4-375" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬à¬Ç&#39;</span>: <span class="st">&#39;‚àÇ&#39;</span>,</span>
<span id="cb4-376"><a href="#cb4-376" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬à¬á&#39;</span>: <span class="st">&#39;‚àá&#39;</span>,</span>
<span id="cb4-377"><a href="#cb4-377" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬à¬ì&#39;</span>: <span class="st">&#39;‚àë&#39;</span>,</span>
<span id="cb4-378"><a href="#cb4-378" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬à¬í&#39;</span>: <span class="st">&#39;‚àè&#39;</span>,</span>
<span id="cb4-379"><a href="#cb4-379" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬à¬ï&#39;</span>: <span class="st">&#39;‚àù&#39;</span>,</span>
<span id="cb4-380"><a href="#cb4-380" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬à¬û&#39;</span>: <span class="st">&#39;‚àû&#39;</span>,</span>
<span id="cb4-381"><a href="#cb4-381" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬à¬ß&#39;</span>: <span class="st">&#39;‚àß&#39;</span>,</span>
<span id="cb4-382"><a href="#cb4-382" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬à¬®&#39;</span>: <span class="st">&#39;‚à®&#39;</span>,</span>
<span id="cb4-383"><a href="#cb4-383" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬à¬Ä&#39;</span>: <span class="st">&#39;‚àÄ&#39;</span>,</span>
<span id="cb4-384"><a href="#cb4-384" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬à¬É&#39;</span>: <span class="st">&#39;‚àÉ&#39;</span>,</span>
<span id="cb4-385"><a href="#cb4-385" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬â¬°&#39;</span>: <span class="st">&#39;‚â°&#39;</span>,</span>
<span id="cb4-386"><a href="#cb4-386" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬â¬à&#39;</span>: <span class="st">&#39;‚âà&#39;</span>,</span>
<span id="cb4-387"><a href="#cb4-387" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬â¬•&#39;</span>: <span class="st">&#39;‚â•&#39;</span>,</span>
<span id="cb4-388"><a href="#cb4-388" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬â¬§&#39;</span>: <span class="st">&#39;‚â§&#39;</span>,</span>
<span id="cb4-389"><a href="#cb4-389" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬â¬†&#39;</span>: <span class="st">&#39;‚â†&#39;</span>,</span>
<span id="cb4-390"><a href="#cb4-390" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√Ç¬±&#39;</span>: <span class="st">&#39;¬±&#39;</span>,</span>
<span id="cb4-391"><a href="#cb4-391" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√É¬ó&#39;</span>: <span class="st">&#39;√ó&#39;</span>,</span>
<span id="cb4-392"><a href="#cb4-392" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√É¬∑&#39;</span>: <span class="st">&#39;√∑&#39;</span>,</span>
<span id="cb4-393"><a href="#cb4-393" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬Ü¬í&#39;</span>: <span class="st">&#39;‚Üí&#39;</span>,</span>
<span id="cb4-394"><a href="#cb4-394" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬Ü¬ë&#39;</span>: <span class="st">&#39;‚Üë&#39;</span>,</span>
<span id="cb4-395"><a href="#cb4-395" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬Ü¬ì&#39;</span>: <span class="st">&#39;‚Üì&#39;</span>,</span>
<span id="cb4-396"><a href="#cb4-396" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬Ü¬ê&#39;</span>: <span class="st">&#39;‚Üê&#39;</span>,</span>
<span id="cb4-397"><a href="#cb4-397" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬á¬í&#39;</span>: <span class="st">&#39;‚áí&#39;</span>,</span>
<span id="cb4-398"><a href="#cb4-398" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬á¬î&#39;</span>: <span class="st">&#39;‚áî&#39;</span>,</span>
<span id="cb4-399"><a href="#cb4-399" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√Ç¬∞&#39;</span>: <span class="st">&#39;¬∞&#39;</span>,</span>
<span id="cb4-400"><a href="#cb4-400" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√Ç¬µ&#39;</span>: <span class="st">&#39;¬µ&#39;</span>,</span>
<span id="cb4-401"><a href="#cb4-401" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√é¬±&#39;</span>: <span class="st">&#39;Œ±&#39;</span>, <span class="st">&#39;√é¬≤&#39;</span>: <span class="st">&#39;Œ≤&#39;</span>, <span class="st">&#39;√é¬≥&#39;</span>: <span class="st">&#39;Œ≥&#39;</span>, <span class="st">&#39;√é¬¥&#39;</span>: <span class="st">&#39;Œ¥&#39;</span>,</span>
<span id="cb4-402"><a href="#cb4-402" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√é¬µ&#39;</span>: <span class="st">&#39;Œµ&#39;</span>, <span class="st">&#39;√é¬∂&#39;</span>: <span class="st">&#39;Œ∂&#39;</span>, <span class="st">&#39;√é¬∑&#39;</span>: <span class="st">&#39;Œ∑&#39;</span>, <span class="st">&#39;√é¬∏&#39;</span>: <span class="st">&#39;Œ∏&#39;</span>,</span>
<span id="cb4-403"><a href="#cb4-403" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√é¬π&#39;</span>: <span class="st">&#39;Œπ&#39;</span>, <span class="st">&#39;√é¬∫&#39;</span>: <span class="st">&#39;Œ∫&#39;</span>, <span class="st">&#39;√é¬ª&#39;</span>: <span class="st">&#39;Œª&#39;</span>, <span class="st">&#39;√é¬º&#39;</span>: <span class="st">&#39;Œº&#39;</span>,</span>
<span id="cb4-404"><a href="#cb4-404" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√é¬Ω&#39;</span>: <span class="st">&#39;ŒΩ&#39;</span>, <span class="st">&#39;√é¬æ&#39;</span>: <span class="st">&#39;Œæ&#39;</span>, <span class="st">&#39;√é¬ø&#39;</span>: <span class="st">&#39;Œø&#39;</span>, <span class="st">&#39;√è‚Ç¨&#39;</span>: <span class="st">&#39;œÄ&#39;</span>,</span>
<span id="cb4-405"><a href="#cb4-405" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√è¬Å&#39;</span>: <span class="st">&#39;œÅ&#39;</span>, <span class="st">&#39;√è¬É&#39;</span>: <span class="st">&#39;œÉ&#39;</span>, <span class="st">&#39;√è¬Ñ&#39;</span>: <span class="st">&#39;œÑ&#39;</span>, <span class="st">&#39;√è&#39;</span>: <span class="st">&#39;œÖ&#39;</span>,</span>
<span id="cb4-406"><a href="#cb4-406" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√è¬Ü&#39;</span>: <span class="st">&#39;œÜ&#39;</span>, <span class="st">&#39;√è¬á&#39;</span>: <span class="st">&#39;œá&#39;</span>, <span class="st">&#39;√è¬à&#39;</span>: <span class="st">&#39;œà&#39;</span>, <span class="st">&#39;√è¬â&#39;</span>: <span class="st">&#39;œâ&#39;</span>,</span>
<span id="cb4-407"><a href="#cb4-407" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√é¬ë&#39;</span>: <span class="st">&#39;Œë&#39;</span>, <span class="st">&#39;√é¬í&#39;</span>: <span class="st">&#39;Œí&#39;</span>, <span class="st">&#39;√é¬ì&#39;</span>: <span class="st">&#39;Œì&#39;</span>, <span class="st">&#39;√é¬î&#39;</span>: <span class="st">&#39;Œî&#39;</span>,</span>
<span id="cb4-408"><a href="#cb4-408" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√é¬ï&#39;</span>: <span class="st">&#39;Œï&#39;</span>, <span class="st">&#39;√é¬ñ&#39;</span>: <span class="st">&#39;Œñ&#39;</span>, <span class="st">&#39;√é¬ó&#39;</span>: <span class="st">&#39;Œó&#39;</span>, <span class="st">&#39;√é¬ò&#39;</span>: <span class="st">&#39;Œò&#39;</span>,</span>
<span id="cb4-409"><a href="#cb4-409" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√é¬ô&#39;</span>: <span class="st">&#39;Œô&#39;</span>, <span class="st">&#39;√é¬ö&#39;</span>: <span class="st">&#39;Œö&#39;</span>, <span class="st">&#39;√é¬õ&#39;</span>: <span class="st">&#39;Œõ&#39;</span>, <span class="st">&#39;√é¬ú&#39;</span>: <span class="st">&#39;Œú&#39;</span>,</span>
<span id="cb4-410"><a href="#cb4-410" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√é¬ù&#39;</span>: <span class="st">&#39;Œù&#39;</span>, <span class="st">&#39;√é¬û&#39;</span>: <span class="st">&#39;Œû&#39;</span>, <span class="st">&#39;√é¬ü&#39;</span>: <span class="st">&#39;Œü&#39;</span>, <span class="st">&#39;√é¬†&#39;</span>: <span class="st">&#39;Œ†&#39;</span>,</span>
<span id="cb4-411"><a href="#cb4-411" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√é¬°&#39;</span>: <span class="st">&#39;Œ°&#39;</span>, <span class="st">&#39;√é¬£&#39;</span>: <span class="st">&#39;Œ£&#39;</span>, <span class="st">&#39;√é¬§&#39;</span>: <span class="st">&#39;Œ§&#39;</span>, <span class="st">&#39;√é¬•&#39;</span>: <span class="st">&#39;Œ•&#39;</span>,</span>
<span id="cb4-412"><a href="#cb4-412" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√é¬¶&#39;</span>: <span class="st">&#39;Œ¶&#39;</span>, <span class="st">&#39;√é¬ß&#39;</span>: <span class="st">&#39;Œß&#39;</span>, <span class="st">&#39;√é¬®&#39;</span>: <span class="st">&#39;Œ®&#39;</span>, <span class="st">&#39;√é¬©&#39;</span>: <span class="st">&#39;Œ©&#39;</span>,</span>
<span id="cb4-413"><a href="#cb4-413" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-414"><a href="#cb4-414" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-415"><a href="#cb4-415" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> wrong, correct <span class="kw">in</span> latex_corrections.items():</span>
<span id="cb4-416"><a href="#cb4-416" aria-hidden="true" tabindex="-1"></a>            preserved_content <span class="op">=</span> preserved_content.replace(wrong, correct)</span>
<span id="cb4-417"><a href="#cb4-417" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-418"><a href="#cb4-418" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Normaliza√ß√£o de f√≥rmulas matem√°ticas</span></span>
<span id="cb4-419"><a href="#cb4-419" aria-hidden="true" tabindex="-1"></a>        preserved_content <span class="op">=</span> <span class="va">self</span>.normalize_math_formulas(preserved_content)</span>
<span id="cb4-420"><a href="#cb4-420" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-421"><a href="#cb4-421" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Restaurar blocos de c√≥digo protegidos</span></span>
<span id="cb4-422"><a href="#cb4-422" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> block_id, original_code <span class="kw">in</span> code_blocks.items():</span>
<span id="cb4-423"><a href="#cb4-423" aria-hidden="true" tabindex="-1"></a>            preserved_content <span class="op">=</span> preserved_content.replace(block_id, original_code)</span>
<span id="cb4-424"><a href="#cb4-424" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-425"><a href="#cb4-425" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> preserved_content</span>
<span id="cb4-426"><a href="#cb4-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-427"><a href="#cb4-427" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ensure_directories(<span class="va">self</span>):</span>
<span id="cb4-428"><a href="#cb4-428" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Cria todas as pastas necess√°rias&quot;&quot;&quot;</span></span>
<span id="cb4-429"><a href="#cb4-429" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-430"><a href="#cb4-430" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;DRY-RUN: Pastas seriam criadas:&quot;</span>)</span>
<span id="cb4-431"><a href="#cb4-431" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb4-432"><a href="#cb4-432" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-433"><a href="#cb4-433" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-434"><a href="#cb4-434" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-435"><a href="#cb4-435" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb4-436"><a href="#cb4-436" aria-hidden="true" tabindex="-1"></a>            Path(folder).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-437"><a href="#cb4-437" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;Pasta criada: </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-438"><a href="#cb4-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-439"><a href="#cb4-439" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> run(<span class="va">self</span>):</span>
<span id="cb4-440"><a href="#cb4-440" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Executa o processamento completo com novas funcionalidades&quot;&quot;&quot;</span></span>
<span id="cb4-441"><a href="#cb4-441" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;SISTEMA COMBINADO v8.1 - COM ANEXOS, CACHE E UNICODE AVAN√áADO&quot;</span>)</span>
<span id="cb4-442"><a href="#cb4-442" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb4-443"><a href="#cb4-443" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-444"><a href="#cb4-444" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.data_dir.exists():</span>
<span id="cb4-445"><a href="#cb4-445" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;Pasta &#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">}</span><span class="ss">&#39; n√£o encontrada.&quot;</span>)</span>
<span id="cb4-446"><a href="#cb4-446" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;Crie a pasta &#39;data&#39; e coloque os arquivos de exporta√ß√£o:&quot;</span>)</span>
<span id="cb4-447"><a href="#cb4-447" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb4-448"><a href="#cb4-448" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   - </span><span class="sc">{</span>config[<span class="st">&#39;file&#39;</span>]<span class="sc">}</span><span class="ss"> (para </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb4-449"><a href="#cb4-449" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-450"><a href="#cb4-450" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-451"><a href="#cb4-451" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;Usando pasta de dados: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-452"><a href="#cb4-452" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-453"><a href="#cb4-453" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ensure_directories()</span>
<span id="cb4-454"><a href="#cb4-454" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-455"><a href="#cb4-455" aria-hidden="true" tabindex="-1"></a>        processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-456"><a href="#cb4-456" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb4-457"><a href="#cb4-457" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> config[<span class="st">&#39;enabled&#39;</span>]:</span>
<span id="cb4-458"><a href="#cb4-458" aria-hidden="true" tabindex="-1"></a>                file_path <span class="op">=</span> <span class="va">self</span>.data_dir <span class="op">/</span> config[<span class="st">&#39;file&#39;</span>]</span>
<span id="cb4-459"><a href="#cb4-459" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> file_path.exists():</span>
<span id="cb4-460"><a href="#cb4-460" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Processando </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb4-461"><a href="#cb4-461" aria-hidden="true" tabindex="-1"></a>                    config[<span class="st">&#39;method&#39;</span>](file_path)</span>
<span id="cb4-462"><a href="#cb4-462" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-463"><a href="#cb4-463" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb4-464"><a href="#cb4-464" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.warning(<span class="ss">f&quot;</span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">: arquivo n√£o encontrado - </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-465"><a href="#cb4-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-466"><a href="#cb4-466" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> processed_count <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb4-467"><a href="#cb4-467" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhum arquivo de exporta√ß√£o encontrado na pasta &#39;data&#39;.&quot;</span>)</span>
<span id="cb4-468"><a href="#cb4-468" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-469"><a href="#cb4-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-470"><a href="#cb4-470" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb4-471"><a href="#cb4-471" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhuma conversa foi extra√≠da dos arquivos.&quot;</span>)</span>
<span id="cb4-472"><a href="#cb4-472" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-473"><a href="#cb4-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-474"><a href="#cb4-474" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._post_process_conversations()</span>
<span id="cb4-475"><a href="#cb4-475" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-476"><a href="#cb4-476" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-477"><a href="#cb4-477" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._export_all_formats()</span>
<span id="cb4-478"><a href="#cb4-478" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üéâ SISTEMA COMBINADO v8.1 FINALIZADO!&quot;</span>)</span>
<span id="cb4-479"><a href="#cb4-479" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ √çndice: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-480"><a href="#cb4-480" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> Path(<span class="va">self</span>.index_file).exists():</span>
<span id="cb4-481"><a href="#cb4-481" aria-hidden="true" tabindex="-1"></a>                webbrowser.<span class="bu">open</span>(<span class="ss">f&#39;file://</span><span class="sc">{</span>Path(<span class="va">self</span>.index_file)<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb4-482"><a href="#cb4-482" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb4-483"><a href="#cb4-483" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üîÆ MODO DRY-RUN: Nenhum arquivo foi criado.&quot;</span>)</span>
<span id="cb4-484"><a href="#cb4-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-485"><a href="#cb4-485" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _post_process_conversations(<span class="va">self</span>):</span>
<span id="cb4-486"><a href="#cb4-486" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processamento p√≥s-extra√ß√£o das conversas&quot;&quot;&quot;</span></span>
<span id="cb4-487"><a href="#cb4-487" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations.sort(</span>
<span id="cb4-488"><a href="#cb4-488" aria-hidden="true" tabindex="-1"></a>            key<span class="op">=</span><span class="kw">lambda</span> x: <span class="va">self</span>.parse_timestamp_for_sorting(</span>
<span id="cb4-489"><a href="#cb4-489" aria-hidden="true" tabindex="-1"></a>                x.get(<span class="st">&#39;updated_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;created_at&#39;</span>)</span>
<span id="cb4-490"><a href="#cb4-490" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb4-491"><a href="#cb4-491" aria-hidden="true" tabindex="-1"></a>            reverse<span class="op">=</span><span class="va">True</span></span>
<span id="cb4-492"><a href="#cb4-492" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-493"><a href="#cb4-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-494"><a href="#cb4-494" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.all_conversations):</span>
<span id="cb4-495"><a href="#cb4-495" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;number&#39;</span>] <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb4-496"><a href="#cb4-496" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;category&#39;</span>] <span class="op">=</span> <span class="va">self</span>.categorize_conversation(conv[<span class="st">&#39;title&#39;</span>], conv.get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;&#39;</span>))</span>
<span id="cb4-497"><a href="#cb4-497" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;source&#39;</span>, <span class="st">&#39;Desconhecido&#39;</span>)</span>
<span id="cb4-498"><a href="#cb4-498" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;messages&#39;</span>, [])</span>
<span id="cb4-499"><a href="#cb4-499" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;summary&#39;</span>, conv[<span class="st">&#39;messages&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> conv[<span class="st">&#39;messages&#39;</span>] <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>)</span>
<span id="cb4-500"><a href="#cb4-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-501"><a href="#cb4-501" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä Total combinado de conversas: </span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-502"><a href="#cb4-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-503"><a href="#cb4-503" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _export_all_formats(<span class="va">self</span>):</span>
<span id="cb4-504"><a href="#cb4-504" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Exporta para todos os formats&quot;&quot;&quot;</span></span>
<span id="cb4-505"><a href="#cb4-505" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">üîÑ Exportando para formatos...&quot;</span>)</span>
<span id="cb4-506"><a href="#cb4-506" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_markdown_enhanced()</span>
<span id="cb4-507"><a href="#cb4-507" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_html_robust()</span>
<span id="cb4-508"><a href="#cb4-508" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_csv() </span>
<span id="cb4-509"><a href="#cb4-509" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_json()</span>
<span id="cb4-510"><a href="#cb4-510" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_all_to_single_files()</span>
<span id="cb4-511"><a href="#cb4-511" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.create_searchable_index_enhanced()</span>
<span id="cb4-512"><a href="#cb4-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-513"><a href="#cb4-513" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _get_pandoc_version(<span class="va">self</span>) <span class="op">-&gt;</span> Optional[<span class="bu">tuple</span>]:</span>
<span id="cb4-514"><a href="#cb4-514" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Obt√©m a vers√£o do Pandoc para compatibilidade&quot;&quot;&quot;</span></span>
<span id="cb4-515"><a href="#cb4-515" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-516"><a href="#cb4-516" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run([<span class="st">&#39;pandoc&#39;</span>, <span class="st">&#39;--version&#39;</span>], capture_output<span class="op">=</span><span class="va">True</span>, text<span class="op">=</span><span class="va">True</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>)</span>
<span id="cb4-517"><a href="#cb4-517" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb4-518"><a href="#cb4-518" aria-hidden="true" tabindex="-1"></a>                first_line <span class="op">=</span> result.stdout.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb4-519"><a href="#cb4-519" aria-hidden="true" tabindex="-1"></a>                version_str <span class="op">=</span> first_line.split()[<span class="dv">1</span>]</span>
<span id="cb4-520"><a href="#cb4-520" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="bu">tuple</span>(<span class="bu">map</span>(<span class="bu">int</span>, version_str.split(<span class="st">&#39;.&#39;</span>)))</span>
<span id="cb4-521"><a href="#cb4-521" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb4-522"><a href="#cb4-522" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb4-523"><a href="#cb4-523" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb4-524"><a href="#cb4-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-525"><a href="#cb4-525" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_cached(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb4-526"><a href="#cb4-526" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Convers√£o com Pandoc usando cache para performance&quot;&quot;&quot;</span></span>
<span id="cb4-527"><a href="#cb4-527" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.enable_cache:</span>
<span id="cb4-528"><a href="#cb4-528" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_optimized(md_file_path)</span>
<span id="cb4-529"><a href="#cb4-529" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-530"><a href="#cb4-530" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-531"><a href="#cb4-531" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(md_file_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-532"><a href="#cb4-532" aria-hidden="true" tabindex="-1"></a>                md_content <span class="op">=</span> f.read()</span>
<span id="cb4-533"><a href="#cb4-533" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-534"><a href="#cb4-534" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Gerar chave do cache</span></span>
<span id="cb4-535"><a href="#cb4-535" aria-hidden="true" tabindex="-1"></a>            cache_options <span class="op">=</span> {</span>
<span id="cb4-536"><a href="#cb4-536" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc_version&#39;</span>: <span class="va">self</span>._get_pandoc_version(),</span>
<span id="cb4-537"><a href="#cb4-537" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;mathjax_local&#39;</span>: Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists()</span>
<span id="cb4-538"><a href="#cb4-538" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb4-539"><a href="#cb4-539" aria-hidden="true" tabindex="-1"></a>            cache_key <span class="op">=</span> <span class="va">self</span>.conversion_cache.get_cache_key(md_content, cache_options)</span>
<span id="cb4-540"><a href="#cb4-540" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-541"><a href="#cb4-541" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Tentar recuperar do cache</span></span>
<span id="cb4-542"><a href="#cb4-542" aria-hidden="true" tabindex="-1"></a>            cached_html <span class="op">=</span> <span class="va">self</span>.conversion_cache.get_cached_conversion(cache_key)</span>
<span id="cb4-543"><a href="#cb4-543" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> cached_html:</span>
<span id="cb4-544"><a href="#cb4-544" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Usando cache: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-545"><a href="#cb4-545" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> cached_html</span>
<span id="cb4-546"><a href="#cb4-546" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-547"><a href="#cb4-547" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Converter e salvar no cache</span></span>
<span id="cb4-548"><a href="#cb4-548" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> <span class="va">self</span>._convert_with_pandoc_optimized(md_file_path)</span>
<span id="cb4-549"><a href="#cb4-549" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> html_content:</span>
<span id="cb4-550"><a href="#cb4-550" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.conversion_cache.save_conversion(cache_key, html_content)</span>
<span id="cb4-551"><a href="#cb4-551" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-552"><a href="#cb4-552" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> html_content</span>
<span id="cb4-553"><a href="#cb4-553" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-554"><a href="#cb4-554" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-555"><a href="#cb4-555" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no cache Pandoc: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-556"><a href="#cb4-556" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_optimized(md_file_path)</span>
<span id="cb4-557"><a href="#cb4-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-558"><a href="#cb4-558" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_optimized(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb4-559"><a href="#cb4-559" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Convers√£o OTIMIZADA com Pandoc usando todas as op√ß√µes avan√ßadas&quot;&quot;&quot;</span></span>
<span id="cb4-560"><a href="#cb4-560" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-561"><a href="#cb4-561" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Convertendo com Pandoc otimizado: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-562"><a href="#cb4-562" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-563"><a href="#cb4-563" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica se o arquivo MathJax local existe</span></span>
<span id="cb4-564"><a href="#cb4-564" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb4-565"><a href="#cb4-565" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb4-566"><a href="#cb4-566" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-567"><a href="#cb4-567" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Comandos base</span></span>
<span id="cb4-568"><a href="#cb4-568" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb4-569"><a href="#cb4-569" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb4-570"><a href="#cb4-570" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb4-571"><a href="#cb4-571" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji+autolink_bare_uris+tex_math_single_backslash&#39;</span>,</span>
<span id="cb4-572"><a href="#cb4-572" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb4-573"><a href="#cb4-573" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb4-574"><a href="#cb4-574" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span>,</span>
<span id="cb4-575"><a href="#cb4-575" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--table-of-contents&#39;</span>,</span>
<span id="cb4-576"><a href="#cb4-576" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--toc-depth=1&#39;</span>,</span>
<span id="cb4-577"><a href="#cb4-577" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--number-sections&#39;</span></span>
<span id="cb4-578"><a href="#cb4-578" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb4-579"><a href="#cb4-579" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-580"><a href="#cb4-580" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica vers√£o do Pandoc para recursos avan√ßados</span></span>
<span id="cb4-581"><a href="#cb4-581" aria-hidden="true" tabindex="-1"></a>            pandoc_version <span class="op">=</span> <span class="va">self</span>._get_pandoc_version()</span>
<span id="cb4-582"><a href="#cb4-582" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-583"><a href="#cb4-583" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Adiciona --embed-resources apenas se suportado (Pandoc 2.19+)</span></span>
<span id="cb4-584"><a href="#cb4-584" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pandoc_version <span class="kw">and</span> pandoc_version <span class="op">&gt;=</span> (<span class="dv">2</span>, <span class="dv">19</span>):</span>
<span id="cb4-585"><a href="#cb4-585" aria-hidden="true" tabindex="-1"></a>                command.append(<span class="st">&#39;--embed-resources&#39;</span>)</span>
<span id="cb4-586"><a href="#cb4-586" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="st">&quot;‚úÖ Usando --embed-resources (Pandoc 2.19+)&quot;</span>)</span>
<span id="cb4-587"><a href="#cb4-587" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb4-588"><a href="#cb4-588" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="st">&quot;‚ÑπÔ∏è  --embed-resources n√£o suportado, usando recursos externos&quot;</span>)</span>
<span id="cb4-589"><a href="#cb4-589" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-590"><a href="#cb4-590" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Adiciona syntax highlighting</span></span>
<span id="cb4-591"><a href="#cb4-591" aria-hidden="true" tabindex="-1"></a>            command.extend([<span class="st">&#39;--syntax-highlighting=pygments&#39;</span>])</span>
<span id="cb4-592"><a href="#cb4-592" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-593"><a href="#cb4-593" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb4-594"><a href="#cb4-594" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb4-595"><a href="#cb4-595" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb4-596"><a href="#cb4-596" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb4-597"><a href="#cb4-597" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb4-598"><a href="#cb4-598" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">180</span></span>
<span id="cb4-599"><a href="#cb4-599" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb4-600"><a href="#cb4-600" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-601"><a href="#cb4-601" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb4-602"><a href="#cb4-602" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> result.stdout</span>
<span id="cb4-603"><a href="#cb4-603" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-604"><a href="#cb4-604" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Aplica otimiza√ß√µes adicionais</span></span>
<span id="cb4-605"><a href="#cb4-605" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="va">self</span>._optimize_html_content(html_content)</span>
<span id="cb4-606"><a href="#cb4-606" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="va">self</span>._enhance_toc_interactive(html_content)</span>
<span id="cb4-607"><a href="#cb4-607" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> html_content</span>
<span id="cb4-608"><a href="#cb4-608" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb4-609"><a href="#cb4-609" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc otimizado falhou, tentando m√©todo b√°sico: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-610"><a href="#cb4-610" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb4-611"><a href="#cb4-611" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-612"><a href="#cb4-612" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> subprocess.TimeoutExpired:</span>
<span id="cb4-613"><a href="#cb4-613" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Timeout no Pandoc otimizado&quot;</span>)</span>
<span id="cb4-614"><a href="#cb4-614" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb4-615"><a href="#cb4-615" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-616"><a href="#cb4-616" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc otimizado: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-617"><a href="#cb4-617" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb4-618"><a href="#cb4-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-619"><a href="#cb4-619" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_basic(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb4-620"><a href="#cb4-620" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;M√©todo b√°sico de fallback para Pandoc com TOC e numera√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb4-621"><a href="#cb4-621" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-622"><a href="#cb4-622" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Tentando convers√£o b√°sica: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-623"><a href="#cb4-623" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-624"><a href="#cb4-624" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb4-625"><a href="#cb4-625" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb4-626"><a href="#cb4-626" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-627"><a href="#cb4-627" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb4-628"><a href="#cb4-628" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb4-629"><a href="#cb4-629" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb4-630"><a href="#cb4-630" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown&#39;</span>,</span>
<span id="cb4-631"><a href="#cb4-631" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb4-632"><a href="#cb4-632" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb4-633"><a href="#cb4-633" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--table-of-contents&#39;</span>,</span>
<span id="cb4-634"><a href="#cb4-634" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--toc-depth=1&#39;</span>,</span>
<span id="cb4-635"><a href="#cb4-635" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--number-sections&#39;</span>,</span>
<span id="cb4-636"><a href="#cb4-636" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb4-637"><a href="#cb4-637" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb4-638"><a href="#cb4-638" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-639"><a href="#cb4-639" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb4-640"><a href="#cb4-640" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb4-641"><a href="#cb4-641" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb4-642"><a href="#cb4-642" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb4-643"><a href="#cb4-643" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb4-644"><a href="#cb4-644" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">120</span></span>
<span id="cb4-645"><a href="#cb4-645" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb4-646"><a href="#cb4-646" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-647"><a href="#cb4-647" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb4-648"><a href="#cb4-648" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> result.stdout</span>
<span id="cb4-649"><a href="#cb4-649" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="va">self</span>._optimize_html_content(html_content)</span>
<span id="cb4-650"><a href="#cb4-650" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="va">self</span>._enhance_toc_interactive(html_content)</span>
<span id="cb4-651"><a href="#cb4-651" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> html_content</span>
<span id="cb4-652"><a href="#cb4-652" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb4-653"><a href="#cb4-653" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc b√°sico falhou, usando fallback Python: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-654"><a href="#cb4-654" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb4-655"><a href="#cb4-655" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-656"><a href="#cb4-656" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-657"><a href="#cb4-657" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc b√°sico: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-658"><a href="#cb4-658" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb4-659"><a href="#cb4-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-660"><a href="#cb4-660" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _optimize_html_content(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-661"><a href="#cb4-661" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Aplica otimiza√ß√µes finais ao conte√∫do HTML&quot;&quot;&quot;</span></span>
<span id="cb4-662"><a href="#cb4-662" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona viewport para responsividade</span></span>
<span id="cb4-663"><a href="#cb4-663" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;viewport&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb4-664"><a href="#cb4-664" aria-hidden="true" tabindex="-1"></a>            viewport_meta <span class="op">=</span> <span class="st">&#39;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#39;</span></span>
<span id="cb4-665"><a href="#cb4-665" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="ss">    </span><span class="sc">{</span>viewport_meta<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb4-666"><a href="#cb4-666" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-667"><a href="#cb4-667" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Melhora acessibilidade</span></span>
<span id="cb4-668"><a href="#cb4-668" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;html&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;lang&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb4-669"><a href="#cb4-669" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;html&gt;&#39;</span>, <span class="st">&#39;&lt;html lang=&quot;pt-BR&quot;&gt;&#39;</span>)</span>
<span id="cb4-670"><a href="#cb4-670" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-671"><a href="#cb4-671" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona CSS personalizado para melhorar TOC e numera√ß√£o</span></span>
<span id="cb4-672"><a href="#cb4-672" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="va">self</span>._inject_enhanced_css(html_content)</span>
<span id="cb4-673"><a href="#cb4-673" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-674"><a href="#cb4-674" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Otimiza TOC gerado pelo Pandoc</span></span>
<span id="cb4-675"><a href="#cb4-675" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="va">self</span>._enhance_toc_styling(html_content)</span>
<span id="cb4-676"><a href="#cb4-676" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-677"><a href="#cb4-677" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb4-678"><a href="#cb4-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-679"><a href="#cb4-679" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _enhance_toc_interactive(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-680"><a href="#cb4-680" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Adiciona interatividade avan√ßada ao TOC - FIXO √Ä DIREITA E SEMPRE VIS√çVEL&quot;&quot;&quot;</span></span>
<span id="cb4-681"><a href="#cb4-681" aria-hidden="true" tabindex="-1"></a>        interactive_js <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb4-682"><a href="#cb4-682" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;script&gt;</span></span>
<span id="cb4-683"><a href="#cb4-683" aria-hidden="true" tabindex="-1"></a><span class="st">    document.addEventListener(&#39;DOMContentLoaded&#39;, function() {</span></span>
<span id="cb4-684"><a href="#cb4-684" aria-hidden="true" tabindex="-1"></a><span class="st">        // TOC FIXO √Ä DIREITA - SEMPRE VIS√çVEL</span></span>
<span id="cb4-685"><a href="#cb4-685" aria-hidden="true" tabindex="-1"></a><span class="st">        const toc = document.getElementById(&#39;TOC&#39;);</span></span>
<span id="cb4-686"><a href="#cb4-686" aria-hidden="true" tabindex="-1"></a><span class="st">        if (toc) {</span></span>
<span id="cb4-687"><a href="#cb4-687" aria-hidden="true" tabindex="-1"></a><span class="st">            // Aplicar estilos para fixar √† direita permanentemente</span></span>
<span id="cb4-688"><a href="#cb4-688" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.position = &#39;fixed&#39;;</span></span>
<span id="cb4-689"><a href="#cb4-689" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.top = &#39;50%&#39;;</span></span>
<span id="cb4-690"><a href="#cb4-690" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.right = &#39;20px&#39;;</span></span>
<span id="cb4-691"><a href="#cb4-691" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.transform = &#39;translateY(-50%)&#39;;</span></span>
<span id="cb4-692"><a href="#cb4-692" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.maxHeight = &#39;80vh&#39;;</span></span>
<span id="cb4-693"><a href="#cb4-693" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.overflowY = &#39;auto&#39;;</span></span>
<span id="cb4-694"><a href="#cb4-694" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.zIndex = &#39;1000&#39;;</span></span>
<span id="cb4-695"><a href="#cb4-695" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.background = &#39;rgba(255, 255, 255, 0.95)&#39;;</span></span>
<span id="cb4-696"><a href="#cb4-696" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.padding = &#39;20px&#39;;</span></span>
<span id="cb4-697"><a href="#cb4-697" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.borderRadius = &#39;10px&#39;;</span></span>
<span id="cb4-698"><a href="#cb4-698" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.boxShadow = &#39;0 4px 20px rgba(0,0,0,0.15)&#39;;</span></span>
<span id="cb4-699"><a href="#cb4-699" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.border = &#39;1px solid #e0e0e0&#39;;</span></span>
<span id="cb4-700"><a href="#cb4-700" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.width = &#39;300px&#39;;</span></span>
<span id="cb4-701"><a href="#cb4-701" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.backdropFilter = &#39;blur(10px)&#39;;</span></span>
<span id="cb4-702"><a href="#cb4-702" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.transition = &#39;all 0.3s ease&#39;;</span></span>
<span id="cb4-703"><a href="#cb4-703" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-704"><a href="#cb4-704" aria-hidden="true" tabindex="-1"></a><span class="st">            // Adicionar bot√£o de minimizar/expandir</span></span>
<span id="cb4-705"><a href="#cb4-705" aria-hidden="true" tabindex="-1"></a><span class="st">            const toggleBtn = document.createElement(&#39;button&#39;);</span></span>
<span id="cb4-706"><a href="#cb4-706" aria-hidden="true" tabindex="-1"></a><span class="st">            toggleBtn.innerHTML = &#39;üìë&#39;;</span></span>
<span id="cb4-707"><a href="#cb4-707" aria-hidden="true" tabindex="-1"></a><span class="st">            toggleBtn.style.cssText = `</span></span>
<span id="cb4-708"><a href="#cb4-708" aria-hidden="true" tabindex="-1"></a><span class="st">                position: absolute;</span></span>
<span id="cb4-709"><a href="#cb4-709" aria-hidden="true" tabindex="-1"></a><span class="st">                top: 10px;</span></span>
<span id="cb4-710"><a href="#cb4-710" aria-hidden="true" tabindex="-1"></a><span class="st">                right: 10px;</span></span>
<span id="cb4-711"><a href="#cb4-711" aria-hidden="true" tabindex="-1"></a><span class="st">                background: transparent;</span></span>
<span id="cb4-712"><a href="#cb4-712" aria-hidden="true" tabindex="-1"></a><span class="st">                border: none;</span></span>
<span id="cb4-713"><a href="#cb4-713" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 16px;</span></span>
<span id="cb4-714"><a href="#cb4-714" aria-hidden="true" tabindex="-1"></a><span class="st">                cursor: pointer;</span></span>
<span id="cb4-715"><a href="#cb4-715" aria-hidden="true" tabindex="-1"></a><span class="st">                z-index: 1001;</span></span>
<span id="cb4-716"><a href="#cb4-716" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 5px;</span></span>
<span id="cb4-717"><a href="#cb4-717" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 3px;</span></span>
<span id="cb4-718"><a href="#cb4-718" aria-hidden="true" tabindex="-1"></a><span class="st">            `;</span></span>
<span id="cb4-719"><a href="#cb4-719" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-720"><a href="#cb4-720" aria-hidden="true" tabindex="-1"></a><span class="st">            let isMinimized = false;</span></span>
<span id="cb4-721"><a href="#cb4-721" aria-hidden="true" tabindex="-1"></a><span class="st">            toggleBtn.addEventListener(&#39;click&#39;, function(e) {</span></span>
<span id="cb4-722"><a href="#cb4-722" aria-hidden="true" tabindex="-1"></a><span class="st">                e.stopPropagation();</span></span>
<span id="cb4-723"><a href="#cb4-723" aria-hidden="true" tabindex="-1"></a><span class="st">                isMinimized = !isMinimized;</span></span>
<span id="cb4-724"><a href="#cb4-724" aria-hidden="true" tabindex="-1"></a><span class="st">                if (isMinimized) {</span></span>
<span id="cb4-725"><a href="#cb4-725" aria-hidden="true" tabindex="-1"></a><span class="st">                    toc.style.transform = &#39;translateY(-50%) translateX(280px)&#39;;</span></span>
<span id="cb4-726"><a href="#cb4-726" aria-hidden="true" tabindex="-1"></a><span class="st">                    toggleBtn.innerHTML = &#39;üìñ&#39;;</span></span>
<span id="cb4-727"><a href="#cb4-727" aria-hidden="true" tabindex="-1"></a><span class="st">                    toc.style.opacity = &#39;0.7&#39;;</span></span>
<span id="cb4-728"><a href="#cb4-728" aria-hidden="true" tabindex="-1"></a><span class="st">                } else {</span></span>
<span id="cb4-729"><a href="#cb4-729" aria-hidden="true" tabindex="-1"></a><span class="st">                    toc.style.transform = &#39;translateY(-50%)&#39;;</span></span>
<span id="cb4-730"><a href="#cb4-730" aria-hidden="true" tabindex="-1"></a><span class="st">                    toggleBtn.innerHTML = &#39;üìë&#39;;</span></span>
<span id="cb4-731"><a href="#cb4-731" aria-hidden="true" tabindex="-1"></a><span class="st">                    toc.style.opacity = &#39;1&#39;;</span></span>
<span id="cb4-732"><a href="#cb4-732" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb4-733"><a href="#cb4-733" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb4-734"><a href="#cb4-734" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-735"><a href="#cb4-735" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.style.position = &#39;relative&#39;;</span></span>
<span id="cb4-736"><a href="#cb4-736" aria-hidden="true" tabindex="-1"></a><span class="st">            toc.appendChild(toggleBtn);</span></span>
<span id="cb4-737"><a href="#cb4-737" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb4-738"><a href="#cb4-738" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb4-739"><a href="#cb4-739" aria-hidden="true" tabindex="-1"></a><span class="st">        // Highlight de se√ß√£o ativa no TOC</span></span>
<span id="cb4-740"><a href="#cb4-740" aria-hidden="true" tabindex="-1"></a><span class="st">        const sections = document.querySelectorAll(&#39;h1, h2, h3, h4, h5&#39;);</span></span>
<span id="cb4-741"><a href="#cb4-741" aria-hidden="true" tabindex="-1"></a><span class="st">        const tocLinks = document.querySelectorAll(&#39;#TOC a&#39;);</span></span>
<span id="cb4-742"><a href="#cb4-742" aria-hidden="true" tabindex="-1"></a><span class="st">        const observerOptions = {</span></span>
<span id="cb4-743"><a href="#cb4-743" aria-hidden="true" tabindex="-1"></a><span class="st">            rootMargin: &#39;-20% 0px -60% 0px&#39;,</span></span>
<span id="cb4-744"><a href="#cb4-744" aria-hidden="true" tabindex="-1"></a><span class="st">            threshold: 0</span></span>
<span id="cb4-745"><a href="#cb4-745" aria-hidden="true" tabindex="-1"></a><span class="st">        };</span></span>
<span id="cb4-746"><a href="#cb4-746" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb4-747"><a href="#cb4-747" aria-hidden="true" tabindex="-1"></a><span class="st">        const observer = new IntersectionObserver((entries) =&gt; {</span></span>
<span id="cb4-748"><a href="#cb4-748" aria-hidden="true" tabindex="-1"></a><span class="st">            entries.forEach(entry =&gt; {</span></span>
<span id="cb4-749"><a href="#cb4-749" aria-hidden="true" tabindex="-1"></a><span class="st">                if (entry.isIntersecting) {</span></span>
<span id="cb4-750"><a href="#cb4-750" aria-hidden="true" tabindex="-1"></a><span class="st">                    const id = entry.target.getAttribute(&#39;id&#39;);</span></span>
<span id="cb4-751"><a href="#cb4-751" aria-hidden="true" tabindex="-1"></a><span class="st">                    tocLinks.forEach(link =&gt; {</span></span>
<span id="cb4-752"><a href="#cb4-752" aria-hidden="true" tabindex="-1"></a><span class="st">                        link.classList.remove(&#39;active&#39;);</span></span>
<span id="cb4-753"><a href="#cb4-753" aria-hidden="true" tabindex="-1"></a><span class="st">                        if (link.getAttribute(&#39;href&#39;) === &#39;#&#39; + id) {</span></span>
<span id="cb4-754"><a href="#cb4-754" aria-hidden="true" tabindex="-1"></a><span class="st">                            link.classList.add(&#39;active&#39;);</span></span>
<span id="cb4-755"><a href="#cb4-755" aria-hidden="true" tabindex="-1"></a><span class="st">                        }</span></span>
<span id="cb4-756"><a href="#cb4-756" aria-hidden="true" tabindex="-1"></a><span class="st">                    });</span></span>
<span id="cb4-757"><a href="#cb4-757" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb4-758"><a href="#cb4-758" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb4-759"><a href="#cb4-759" aria-hidden="true" tabindex="-1"></a><span class="st">        }, observerOptions);</span></span>
<span id="cb4-760"><a href="#cb4-760" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb4-761"><a href="#cb4-761" aria-hidden="true" tabindex="-1"></a><span class="st">        sections.forEach(section =&gt; {</span></span>
<span id="cb4-762"><a href="#cb4-762" aria-hidden="true" tabindex="-1"></a><span class="st">            if (section.id) {</span></span>
<span id="cb4-763"><a href="#cb4-763" aria-hidden="true" tabindex="-1"></a><span class="st">                observer.observe(section);</span></span>
<span id="cb4-764"><a href="#cb4-764" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-765"><a href="#cb4-765" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb4-766"><a href="#cb4-766" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb4-767"><a href="#cb4-767" aria-hidden="true" tabindex="-1"></a><span class="st">        // Smooth scroll com offset para header fixo</span></span>
<span id="cb4-768"><a href="#cb4-768" aria-hidden="true" tabindex="-1"></a><span class="st">        tocLinks.forEach(link =&gt; {</span></span>
<span id="cb4-769"><a href="#cb4-769" aria-hidden="true" tabindex="-1"></a><span class="st">            link.addEventListener(&#39;click&#39;, (e) =&gt; {</span></span>
<span id="cb4-770"><a href="#cb4-770" aria-hidden="true" tabindex="-1"></a><span class="st">                e.preventDefault();</span></span>
<span id="cb4-771"><a href="#cb4-771" aria-hidden="true" tabindex="-1"></a><span class="st">                const targetId = link.getAttribute(&#39;href&#39;).substring(1);</span></span>
<span id="cb4-772"><a href="#cb4-772" aria-hidden="true" tabindex="-1"></a><span class="st">                const targetElement = document.getElementById(targetId);</span></span>
<span id="cb4-773"><a href="#cb4-773" aria-hidden="true" tabindex="-1"></a><span class="st">                if (targetElement) {</span></span>
<span id="cb4-774"><a href="#cb4-774" aria-hidden="true" tabindex="-1"></a><span class="st">                    const offsetTop = targetElement.offsetTop - 80;</span></span>
<span id="cb4-775"><a href="#cb4-775" aria-hidden="true" tabindex="-1"></a><span class="st">                    window.scrollTo({</span></span>
<span id="cb4-776"><a href="#cb4-776" aria-hidden="true" tabindex="-1"></a><span class="st">                        top: offsetTop,</span></span>
<span id="cb4-777"><a href="#cb4-777" aria-hidden="true" tabindex="-1"></a><span class="st">                        behavior: &#39;smooth&#39;</span></span>
<span id="cb4-778"><a href="#cb4-778" aria-hidden="true" tabindex="-1"></a><span class="st">                    });</span></span>
<span id="cb4-779"><a href="#cb4-779" aria-hidden="true" tabindex="-1"></a><span class="st">                    </span></span>
<span id="cb4-780"><a href="#cb4-780" aria-hidden="true" tabindex="-1"></a><span class="st">                    // Highlight tempor√°rio</span></span>
<span id="cb4-781"><a href="#cb4-781" aria-hidden="true" tabindex="-1"></a><span class="st">                    tocLinks.forEach(l =&gt; l.classList.remove(&#39;clicked&#39;));</span></span>
<span id="cb4-782"><a href="#cb4-782" aria-hidden="true" tabindex="-1"></a><span class="st">                    link.classList.add(&#39;clicked&#39;);</span></span>
<span id="cb4-783"><a href="#cb4-783" aria-hidden="true" tabindex="-1"></a><span class="st">                    setTimeout(() =&gt; link.classList.remove(&#39;clicked&#39;), 2000);</span></span>
<span id="cb4-784"><a href="#cb4-784" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb4-785"><a href="#cb4-785" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb4-786"><a href="#cb4-786" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb4-787"><a href="#cb4-787" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb4-788"><a href="#cb4-788" aria-hidden="true" tabindex="-1"></a><span class="st">        // Bot√£o de voltar ao topo</span></span>
<span id="cb4-789"><a href="#cb4-789" aria-hidden="true" tabindex="-1"></a><span class="st">        const backToTop = document.createElement(&#39;div&#39;);</span></span>
<span id="cb4-790"><a href="#cb4-790" aria-hidden="true" tabindex="-1"></a><span class="st">        backToTop.innerHTML = &#39;‚¨ÜÔ∏è&#39;;</span></span>
<span id="cb4-791"><a href="#cb4-791" aria-hidden="true" tabindex="-1"></a><span class="st">        backToTop.style.cssText = `</span></span>
<span id="cb4-792"><a href="#cb4-792" aria-hidden="true" tabindex="-1"></a><span class="st">            position: fixed;</span></span>
<span id="cb4-793"><a href="#cb4-793" aria-hidden="true" tabindex="-1"></a><span class="st">            bottom: 30px;</span></span>
<span id="cb4-794"><a href="#cb4-794" aria-hidden="true" tabindex="-1"></a><span class="st">            right: 350px;</span></span>
<span id="cb4-795"><a href="#cb4-795" aria-hidden="true" tabindex="-1"></a><span class="st">            background: #3498db;</span></span>
<span id="cb4-796"><a href="#cb4-796" aria-hidden="true" tabindex="-1"></a><span class="st">            color: white;</span></span>
<span id="cb4-797"><a href="#cb4-797" aria-hidden="true" tabindex="-1"></a><span class="st">            width: 50px;</span></span>
<span id="cb4-798"><a href="#cb4-798" aria-hidden="true" tabindex="-1"></a><span class="st">            height: 50px;</span></span>
<span id="cb4-799"><a href="#cb4-799" aria-hidden="true" tabindex="-1"></a><span class="st">            border-radius: 50%;</span></span>
<span id="cb4-800"><a href="#cb4-800" aria-hidden="true" tabindex="-1"></a><span class="st">            display: flex;</span></span>
<span id="cb4-801"><a href="#cb4-801" aria-hidden="true" tabindex="-1"></a><span class="st">            align-items: center;</span></span>
<span id="cb4-802"><a href="#cb4-802" aria-hidden="true" tabindex="-1"></a><span class="st">            justify-content: center;</span></span>
<span id="cb4-803"><a href="#cb4-803" aria-hidden="true" tabindex="-1"></a><span class="st">            cursor: pointer;</span></span>
<span id="cb4-804"><a href="#cb4-804" aria-hidden="true" tabindex="-1"></a><span class="st">            font-size: 20px;</span></span>
<span id="cb4-805"><a href="#cb4-805" aria-hidden="true" tabindex="-1"></a><span class="st">            box-shadow: 0 4px 15px rgba(0,0,0,0.2);</span></span>
<span id="cb4-806"><a href="#cb4-806" aria-hidden="true" tabindex="-1"></a><span class="st">            opacity: 0;</span></span>
<span id="cb4-807"><a href="#cb4-807" aria-hidden="true" tabindex="-1"></a><span class="st">            transition: opacity 0.3s ease;</span></span>
<span id="cb4-808"><a href="#cb4-808" aria-hidden="true" tabindex="-1"></a><span class="st">            z-index: 1000;</span></span>
<span id="cb4-809"><a href="#cb4-809" aria-hidden="true" tabindex="-1"></a><span class="st">        `;</span></span>
<span id="cb4-810"><a href="#cb4-810" aria-hidden="true" tabindex="-1"></a><span class="st">        document.body.appendChild(backToTop);</span></span>
<span id="cb4-811"><a href="#cb4-811" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb4-812"><a href="#cb4-812" aria-hidden="true" tabindex="-1"></a><span class="st">        window.addEventListener(&#39;scroll&#39;, () =&gt; {</span></span>
<span id="cb4-813"><a href="#cb4-813" aria-hidden="true" tabindex="-1"></a><span class="st">            backToTop.style.opacity = window.scrollY &gt; 500 ? &#39;1&#39; : &#39;0&#39;;</span></span>
<span id="cb4-814"><a href="#cb4-814" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb4-815"><a href="#cb4-815" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb4-816"><a href="#cb4-816" aria-hidden="true" tabindex="-1"></a><span class="st">        backToTop.addEventListener(&#39;click&#39;, () =&gt; {</span></span>
<span id="cb4-817"><a href="#cb4-817" aria-hidden="true" tabindex="-1"></a><span class="st">            window.scrollTo({ top: 0, behavior: &#39;smooth&#39; });</span></span>
<span id="cb4-818"><a href="#cb4-818" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb4-819"><a href="#cb4-819" aria-hidden="true" tabindex="-1"></a><span class="st">    });</span></span>
<span id="cb4-820"><a href="#cb4-820" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/script&gt;</span></span>
<span id="cb4-821"><a href="#cb4-821" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;&quot;&quot;</span></span>
<span id="cb4-822"><a href="#cb4-822" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-823"><a href="#cb4-823" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adicionar CSS para TOC fixo √† direita</span></span>
<span id="cb4-824"><a href="#cb4-824" aria-hidden="true" tabindex="-1"></a>        interactive_css <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb4-825"><a href="#cb4-825" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;style&gt;</span></span>
<span id="cb4-826"><a href="#cb4-826" aria-hidden="true" tabindex="-1"></a><span class="st">    #TOC {</span></span>
<span id="cb4-827"><a href="#cb4-827" aria-hidden="true" tabindex="-1"></a><span class="st">        transition: all 0.3s ease !important;</span></span>
<span id="cb4-828"><a href="#cb4-828" aria-hidden="true" tabindex="-1"></a><span class="st">        z-index: 999 !important;</span></span>
<span id="cb4-829"><a href="#cb4-829" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb4-830"><a href="#cb4-830" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb4-831"><a href="#cb4-831" aria-hidden="true" tabindex="-1"></a><span class="st">    #TOC.fixed {</span></span>
<span id="cb4-832"><a href="#cb4-832" aria-hidden="true" tabindex="-1"></a><span class="st">        width: 300px !important;</span></span>
<span id="cb4-833"><a href="#cb4-833" aria-hidden="true" tabindex="-1"></a><span class="st">        right: 20px !important;</span></span>
<span id="cb4-834"><a href="#cb4-834" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb4-835"><a href="#cb4-835" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb4-836"><a href="#cb4-836" aria-hidden="true" tabindex="-1"></a><span class="st">    #TOC a.active {</span></span>
<span id="cb4-837"><a href="#cb4-837" aria-hidden="true" tabindex="-1"></a><span class="st">        background-color: #007bff !important;</span></span>
<span id="cb4-838"><a href="#cb4-838" aria-hidden="true" tabindex="-1"></a><span class="st">        color: white !important;</span></span>
<span id="cb4-839"><a href="#cb4-839" aria-hidden="true" tabindex="-1"></a><span class="st">        font-weight: bold;</span></span>
<span id="cb4-840"><a href="#cb4-840" aria-hidden="true" tabindex="-1"></a><span class="st">        border-radius: 4px;</span></span>
<span id="cb4-841"><a href="#cb4-841" aria-hidden="true" tabindex="-1"></a><span class="st">        padding: 4px 8px;</span></span>
<span id="cb4-842"><a href="#cb4-842" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb4-843"><a href="#cb4-843" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb4-844"><a href="#cb4-844" aria-hidden="true" tabindex="-1"></a><span class="st">    #TOC a.clicked {</span></span>
<span id="cb4-845"><a href="#cb4-845" aria-hidden="true" tabindex="-1"></a><span class="st">        background-color: #28a745 !important;</span></span>
<span id="cb4-846"><a href="#cb4-846" aria-hidden="true" tabindex="-1"></a><span class="st">        color: white !important;</span></span>
<span id="cb4-847"><a href="#cb4-847" aria-hidden="true" tabindex="-1"></a><span class="st">        animation: pulse 2s;</span></span>
<span id="cb4-848"><a href="#cb4-848" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb4-849"><a href="#cb4-849" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb4-850"><a href="#cb4-850" aria-hidden="true" tabindex="-1"></a><span class="st">    @keyframes pulse {</span></span>
<span id="cb4-851"><a href="#cb4-851" aria-hidden="true" tabindex="-1"></a><span class="st">        0% { transform: scale(1); }</span></span>
<span id="cb4-852"><a href="#cb4-852" aria-hidden="true" tabindex="-1"></a><span class="st">        50% { transform: scale(1.05); }</span></span>
<span id="cb4-853"><a href="#cb4-853" aria-hidden="true" tabindex="-1"></a><span class="st">        100% { transform: scale(1); }</span></span>
<span id="cb4-854"><a href="#cb4-854" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb4-855"><a href="#cb4-855" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb4-856"><a href="#cb4-856" aria-hidden="true" tabindex="-1"></a><span class="st">    /* Scrollbar customizada para TOC */</span></span>
<span id="cb4-857"><a href="#cb4-857" aria-hidden="true" tabindex="-1"></a><span class="st">    #TOC::-webkit-scrollbar {</span></span>
<span id="cb4-858"><a href="#cb4-858" aria-hidden="true" tabindex="-1"></a><span class="st">        width: 6px;</span></span>
<span id="cb4-859"><a href="#cb4-859" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb4-860"><a href="#cb4-860" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb4-861"><a href="#cb4-861" aria-hidden="true" tabindex="-1"></a><span class="st">    #TOC::-webkit-scrollbar-track {</span></span>
<span id="cb4-862"><a href="#cb4-862" aria-hidden="true" tabindex="-1"></a><span class="st">        background: #f1f1f1;</span></span>
<span id="cb4-863"><a href="#cb4-863" aria-hidden="true" tabindex="-1"></a><span class="st">        border-radius: 4px;</span></span>
<span id="cb4-864"><a href="#cb4-864" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb4-865"><a href="#cb4-865" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb4-866"><a href="#cb4-866" aria-hidden="true" tabindex="-1"></a><span class="st">    #TOC::-webkit-scrollbar-thumb {</span></span>
<span id="cb4-867"><a href="#cb4-867" aria-hidden="true" tabindex="-1"></a><span class="st">        background: #c1c1c1;</span></span>
<span id="cb4-868"><a href="#cb4-868" aria-hidden="true" tabindex="-1"></a><span class="st">        border-radius: 4px;</span></span>
<span id="cb4-869"><a href="#cb4-869" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb4-870"><a href="#cb4-870" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb4-871"><a href="#cb4-871" aria-hidden="true" tabindex="-1"></a><span class="st">    #TOC::-webkit-scrollbar-thumb:hover {</span></span>
<span id="cb4-872"><a href="#cb4-872" aria-hidden="true" tabindex="-1"></a><span class="st">        background: #a8a8a8;</span></span>
<span id="cb4-873"><a href="#cb4-873" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb4-874"><a href="#cb4-874" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb4-875"><a href="#cb4-875" aria-hidden="true" tabindex="-1"></a><span class="st">    /* Garantir que o conte√∫do principal n√£o fique atr√°s do TOC */</span></span>
<span id="cb4-876"><a href="#cb4-876" aria-hidden="true" tabindex="-1"></a><span class="st">    .main-content {</span></span>
<span id="cb4-877"><a href="#cb4-877" aria-hidden="true" tabindex="-1"></a><span class="st">        margin-right: 350px !important;</span></span>
<span id="cb4-878"><a href="#cb4-878" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb4-879"><a href="#cb4-879" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb4-880"><a href="#cb4-880" aria-hidden="true" tabindex="-1"></a><span class="st">    /* Responsividade: em telas menores, o TOC fica sobreposto */</span></span>
<span id="cb4-881"><a href="#cb4-881" aria-hidden="true" tabindex="-1"></a><span class="st">    @media (max-width: 1400px) {</span></span>
<span id="cb4-882"><a href="#cb4-882" aria-hidden="true" tabindex="-1"></a><span class="st">        #TOC {</span></span>
<span id="cb4-883"><a href="#cb4-883" aria-hidden="true" tabindex="-1"></a><span class="st">            width: 280px !important;</span></span>
<span id="cb4-884"><a href="#cb4-884" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb4-885"><a href="#cb4-885" aria-hidden="true" tabindex="-1"></a><span class="st">        .main-content {</span></span>
<span id="cb4-886"><a href="#cb4-886" aria-hidden="true" tabindex="-1"></a><span class="st">            margin-right: 320px !important;</span></span>
<span id="cb4-887"><a href="#cb4-887" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb4-888"><a href="#cb4-888" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb4-889"><a href="#cb4-889" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb4-890"><a href="#cb4-890" aria-hidden="true" tabindex="-1"></a><span class="st">    @media (max-width: 1200px) {</span></span>
<span id="cb4-891"><a href="#cb4-891" aria-hidden="true" tabindex="-1"></a><span class="st">        #TOC {</span></span>
<span id="cb4-892"><a href="#cb4-892" aria-hidden="true" tabindex="-1"></a><span class="st">            width: 250px !important;</span></span>
<span id="cb4-893"><a href="#cb4-893" aria-hidden="true" tabindex="-1"></a><span class="st">            right: 10px !important;</span></span>
<span id="cb4-894"><a href="#cb4-894" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb4-895"><a href="#cb4-895" aria-hidden="true" tabindex="-1"></a><span class="st">        .main-content {</span></span>
<span id="cb4-896"><a href="#cb4-896" aria-hidden="true" tabindex="-1"></a><span class="st">            margin-right: 280px !important;</span></span>
<span id="cb4-897"><a href="#cb4-897" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb4-898"><a href="#cb4-898" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb4-899"><a href="#cb4-899" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb4-900"><a href="#cb4-900" aria-hidden="true" tabindex="-1"></a><span class="st">    @media (max-width: 768px) {</span></span>
<span id="cb4-901"><a href="#cb4-901" aria-hidden="true" tabindex="-1"></a><span class="st">        #TOC {</span></span>
<span id="cb4-902"><a href="#cb4-902" aria-hidden="true" tabindex="-1"></a><span class="st">            position: relative !important;</span></span>
<span id="cb4-903"><a href="#cb4-903" aria-hidden="true" tabindex="-1"></a><span class="st">            width: 100% !important;</span></span>
<span id="cb4-904"><a href="#cb4-904" aria-hidden="true" tabindex="-1"></a><span class="st">            right: 0 !important;</span></span>
<span id="cb4-905"><a href="#cb4-905" aria-hidden="true" tabindex="-1"></a><span class="st">            top: 0 !important;</span></span>
<span id="cb4-906"><a href="#cb4-906" aria-hidden="true" tabindex="-1"></a><span class="st">            transform: none !important;</span></span>
<span id="cb4-907"><a href="#cb4-907" aria-hidden="true" tabindex="-1"></a><span class="st">            margin-bottom: 20px;</span></span>
<span id="cb4-908"><a href="#cb4-908" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb4-909"><a href="#cb4-909" aria-hidden="true" tabindex="-1"></a><span class="st">        .main-content {</span></span>
<span id="cb4-910"><a href="#cb4-910" aria-hidden="true" tabindex="-1"></a><span class="st">            margin-right: 0 !important;</span></span>
<span id="cb4-911"><a href="#cb4-911" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb4-912"><a href="#cb4-912" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb4-913"><a href="#cb4-913" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/style&gt;</span></span>
<span id="cb4-914"><a href="#cb4-914" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;&quot;&quot;</span></span>
<span id="cb4-915"><a href="#cb4-915" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-916"><a href="#cb4-916" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;/body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb4-917"><a href="#cb4-917" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;/body&gt;&#39;</span>, <span class="ss">f&#39;</span><span class="sc">{</span>interactive_js<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/body&gt;&#39;</span>)</span>
<span id="cb4-918"><a href="#cb4-918" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-919"><a href="#cb4-919" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;/head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb4-920"><a href="#cb4-920" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;/head&gt;&#39;</span>, <span class="ss">f&#39;</span><span class="sc">{</span>interactive_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;&#39;</span>)</span>
<span id="cb4-921"><a href="#cb4-921" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-922"><a href="#cb4-922" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb4-923"><a href="#cb4-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-924"><a href="#cb4-924" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _inject_enhanced_css(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-925"><a href="#cb4-925" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Injeta CSS personalizado aprimorado para TOC fixo √† direita&quot;&quot;&quot;</span></span>
<span id="cb4-926"><a href="#cb4-926" aria-hidden="true" tabindex="-1"></a>        enhanced_css <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb4-927"><a href="#cb4-927" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;style&gt;</span></span>
<span id="cb4-928"><a href="#cb4-928" aria-hidden="true" tabindex="-1"></a><span class="st">            /* LAYOUT DE TELA COMPLETA OTIMIZADO */</span></span>
<span id="cb4-929"><a href="#cb4-929" aria-hidden="true" tabindex="-1"></a><span class="st">            body {</span></span>
<span id="cb4-930"><a href="#cb4-930" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb4-931"><a href="#cb4-931" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.6;</span></span>
<span id="cb4-932"><a href="#cb4-932" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0;</span></span>
<span id="cb4-933"><a href="#cb4-933" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb4-934"><a href="#cb4-934" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #f5f5f5;</span></span>
<span id="cb4-935"><a href="#cb4-935" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #333;</span></span>
<span id="cb4-936"><a href="#cb4-936" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: none; /* Remove limita√ß√£o de largura - TELA COMPLETA */</span></span>
<span id="cb4-937"><a href="#cb4-937" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-938"><a href="#cb4-938" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-939"><a href="#cb4-939" aria-hidden="true" tabindex="-1"></a><span class="st">            .container {</span></span>
<span id="cb4-940"><a href="#cb4-940" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb4-941"><a href="#cb4-941" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0 auto;</span></span>
<span id="cb4-942"><a href="#cb4-942" aria-hidden="true" tabindex="-1"></a><span class="st">                background: white;</span></span>
<span id="cb4-943"><a href="#cb4-943" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 40px;</span></span>
<span id="cb4-944"><a href="#cb4-944" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 10px;</span></span>
<span id="cb4-945"><a href="#cb4-945" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb4-946"><a href="#cb4-946" aria-hidden="true" tabindex="-1"></a><span class="st">                position: relative; /* Para posicionamento do TOC */</span></span>
<span id="cb4-947"><a href="#cb4-947" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-948"><a href="#cb4-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-949"><a href="#cb4-949" aria-hidden="true" tabindex="-1"></a><span class="st">            /* TOC FIXO √Ä DIREITA - SEMPRE VIS√çVEL */</span></span>
<span id="cb4-950"><a href="#cb4-950" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC {</span></span>
<span id="cb4-951"><a href="#cb4-951" aria-hidden="true" tabindex="-1"></a><span class="st">                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);</span></span>
<span id="cb4-952"><a href="#cb4-952" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #dee2e6;</span></span>
<span id="cb4-953"><a href="#cb4-953" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb4-954"><a href="#cb4-954" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb4-955"><a href="#cb4-955" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 20px 0;</span></span>
<span id="cb4-956"><a href="#cb4-956" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb4-957"><a href="#cb4-957" aria-hidden="true" tabindex="-1"></a><span class="st">                position: fixed !important; /* FIXO */</span></span>
<span id="cb4-958"><a href="#cb4-958" aria-hidden="true" tabindex="-1"></a><span class="st">                top: 50% !important;</span></span>
<span id="cb4-959"><a href="#cb4-959" aria-hidden="true" tabindex="-1"></a><span class="st">                right: 20px !important;</span></span>
<span id="cb4-960"><a href="#cb4-960" aria-hidden="true" tabindex="-1"></a><span class="st">                transform: translateY(-50%) !important;</span></span>
<span id="cb4-961"><a href="#cb4-961" aria-hidden="true" tabindex="-1"></a><span class="st">                width: 300px !important;</span></span>
<span id="cb4-962"><a href="#cb4-962" aria-hidden="true" tabindex="-1"></a><span class="st">                max-height: 80vh !important;</span></span>
<span id="cb4-963"><a href="#cb4-963" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow-y: auto !important;</span></span>
<span id="cb4-964"><a href="#cb4-964" aria-hidden="true" tabindex="-1"></a><span class="st">                z-index: 1000 !important;</span></span>
<span id="cb4-965"><a href="#cb4-965" aria-hidden="true" tabindex="-1"></a><span class="st">                backdrop-filter: blur(10px);</span></span>
<span id="cb4-966"><a href="#cb4-966" aria-hidden="true" tabindex="-1"></a><span class="st">                background: rgba(255, 255, 255, 0.95) !important;</span></span>
<span id="cb4-967"><a href="#cb4-967" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-968"><a href="#cb4-968" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-969"><a href="#cb4-969" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul {</span></span>
<span id="cb4-970"><a href="#cb4-970" aria-hidden="true" tabindex="-1"></a><span class="st">                list-style-type: none;</span></span>
<span id="cb4-971"><a href="#cb4-971" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 15px;</span></span>
<span id="cb4-972"><a href="#cb4-972" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 10px 0;</span></span>
<span id="cb4-973"><a href="#cb4-973" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-974"><a href="#cb4-974" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-975"><a href="#cb4-975" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul ul {</span></span>
<span id="cb4-976"><a href="#cb4-976" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 25px;</span></span>
<span id="cb4-977"><a href="#cb4-977" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-978"><a href="#cb4-978" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-979"><a href="#cb4-979" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC li {</span></span>
<span id="cb4-980"><a href="#cb4-980" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 8px 0;</span></span>
<span id="cb4-981"><a href="#cb4-981" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.4;</span></span>
<span id="cb4-982"><a href="#cb4-982" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-983"><a href="#cb4-983" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-984"><a href="#cb4-984" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a {</span></span>
<span id="cb4-985"><a href="#cb4-985" aria-hidden="true" tabindex="-1"></a><span class="st">                text-decoration: none;</span></span>
<span id="cb4-986"><a href="#cb4-986" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #495057;</span></span>
<span id="cb4-987"><a href="#cb4-987" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 500;</span></span>
<span id="cb4-988"><a href="#cb4-988" aria-hidden="true" tabindex="-1"></a><span class="st">                transition: color 0.2s ease;</span></span>
<span id="cb4-989"><a href="#cb4-989" aria-hidden="true" tabindex="-1"></a><span class="st">                display: block;</span></span>
<span id="cb4-990"><a href="#cb4-990" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 4px 8px;</span></span>
<span id="cb4-991"><a href="#cb4-991" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 4px;</span></span>
<span id="cb4-992"><a href="#cb4-992" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-993"><a href="#cb4-993" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-994"><a href="#cb4-994" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a:hover {</span></span>
<span id="cb4-995"><a href="#cb4-995" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #007bff;</span></span>
<span id="cb4-996"><a href="#cb4-996" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: rgba(0, 123, 255, 0.1);</span></span>
<span id="cb4-997"><a href="#cb4-997" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-998"><a href="#cb4-998" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-999"><a href="#cb4-999" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC &gt; ul &gt; li &gt; a {</span></span>
<span id="cb4-1000"><a href="#cb4-1000" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 600;</span></span>
<span id="cb4-1001"><a href="#cb4-1001" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50;</span></span>
<span id="cb4-1002"><a href="#cb4-1002" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 3px solid #3498db;</span></span>
<span id="cb4-1003"><a href="#cb4-1003" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 12px;</span></span>
<span id="cb4-1004"><a href="#cb4-1004" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1005"><a href="#cb4-1005" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1006"><a href="#cb4-1006" aria-hidden="true" tabindex="-1"></a><span class="st">            /* CLEARFIX PARA LAYOUT COM TOC FIXO */</span></span>
<span id="cb4-1007"><a href="#cb4-1007" aria-hidden="true" tabindex="-1"></a><span class="st">            .main-content {</span></span>
<span id="cb4-1008"><a href="#cb4-1008" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow: hidden; /* PREVINE PROBLEMAS COM ELEMENTOS FLUTUANTES */</span></span>
<span id="cb4-1009"><a href="#cb4-1009" aria-hidden="true" tabindex="-1"></a><span class="st">                position: relative;</span></span>
<span id="cb4-1010"><a href="#cb4-1010" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-right: 350px !important; /* Espa√ßo para o TOC fixo */</span></span>
<span id="cb4-1011"><a href="#cb4-1011" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1012"><a href="#cb4-1012" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1013"><a href="#cb4-1013" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Estilos para numera√ß√£o de se√ß√µes */</span></span>
<span id="cb4-1014"><a href="#cb4-1014" aria-hidden="true" tabindex="-1"></a><span class="st">            .header-section-number {</span></span>
<span id="cb4-1015"><a href="#cb4-1015" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #3498db;</span></span>
<span id="cb4-1016"><a href="#cb4-1016" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: bold;</span></span>
<span id="cb4-1017"><a href="#cb4-1017" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-right: 8px;</span></span>
<span id="cb4-1018"><a href="#cb4-1018" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1019"><a href="#cb4-1019" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1020"><a href="#cb4-1020" aria-hidden="true" tabindex="-1"></a><span class="st">            h1 .header-section-number {</span></span>
<span id="cb4-1021"><a href="#cb4-1021" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.9em;</span></span>
<span id="cb4-1022"><a href="#cb4-1022" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1023"><a href="#cb4-1023" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1024"><a href="#cb4-1024" aria-hidden="true" tabindex="-1"></a><span class="st">            h2 .header-section-number {</span></span>
<span id="cb4-1025"><a href="#cb4-1025" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.85em;</span></span>
<span id="cb4-1026"><a href="#cb4-1026" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1027"><a href="#cb4-1027" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1028"><a href="#cb4-1028" aria-hidden="true" tabindex="-1"></a><span class="st">            h3 .header-section-number {</span></span>
<span id="cb4-1029"><a href="#cb4-1029" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.8em;</span></span>
<span id="cb4-1030"><a href="#cb4-1030" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1031"><a href="#cb4-1031" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1032"><a href="#cb4-1032" aria-hidden="true" tabindex="-1"></a><span class="st">            /* CORRE√á√ÉO CR√çTICA: Syntax highlighting do Pandoc */</span></span>
<span id="cb4-1033"><a href="#cb4-1033" aria-hidden="true" tabindex="-1"></a><span class="st">            .sourceCode { </span></span>
<span id="cb4-1034"><a href="#cb4-1034" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #2d2d2d !important; </span></span>
<span id="cb4-1035"><a href="#cb4-1035" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #f8f8f2 !important;</span></span>
<span id="cb4-1036"><a href="#cb4-1036" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1037"><a href="#cb4-1037" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1038"><a href="#cb4-1038" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Garantir que TODO o texto dentro de pre/code seja vis√≠vel */</span></span>
<span id="cb4-1039"><a href="#cb4-1039" aria-hidden="true" tabindex="-1"></a><span class="st">            pre, code, .sourceCode, .sourceCode pre, .sourceCode code {</span></span>
<span id="cb4-1040"><a href="#cb4-1040" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #f8f8f2 !important;</span></span>
<span id="cb4-1041"><a href="#cb4-1041" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #2d2d2d !important;</span></span>
<span id="cb4-1042"><a href="#cb4-1042" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1043"><a href="#cb4-1043" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1044"><a href="#cb4-1044" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Corre√ß√£o para spans de syntax highlighting */</span></span>
<span id="cb4-1045"><a href="#cb4-1045" aria-hidden="true" tabindex="-1"></a><span class="st">            .sourceCode .kw { color: #ff79c6 !important; } /* keywords */</span></span>
<span id="cb4-1046"><a href="#cb4-1046" aria-hidden="true" tabindex="-1"></a><span class="st">            .sourceCode .dt { color: #8be9fd !important; } /* types */</span></span>
<span id="cb4-1047"><a href="#cb4-1047" aria-hidden="true" tabindex="-1"></a><span class="st">            .sourceCode .dv { color: #bd93f9 !important; } /* values */</span></span>
<span id="cb4-1048"><a href="#cb4-1048" aria-hidden="true" tabindex="-1"></a><span class="st">            .sourceCode .bn { color: #bd93f9 !important; } /* numbers */</span></span>
<span id="cb4-1049"><a href="#cb4-1049" aria-hidden="true" tabindex="-1"></a><span class="st">            .sourceCode .fl { color: #bd93f9 !important; } /* floats */</span></span>
<span id="cb4-1050"><a href="#cb4-1050" aria-hidden="true" tabindex="-1"></a><span class="st">            .sourceCode .ch { color: #f1fa8c !important; } /* chars */</span></span>
<span id="cb4-1051"><a href="#cb4-1051" aria-hidden="true" tabindex="-1"></a><span class="st">            .sourceCode .st { color: #f1fa8c !important; } /* strings */</span></span>
<span id="cb4-1052"><a href="#cb4-1052" aria-hidden="true" tabindex="-1"></a><span class="st">            .sourceCode .co { color: #6272a4 !important; } /* comments */</span></span>
<span id="cb4-1053"><a href="#cb4-1053" aria-hidden="true" tabindex="-1"></a><span class="st">            .sourceCode .ot { color: #50fa7b !important; } /* other */</span></span>
<span id="cb4-1054"><a href="#cb4-1054" aria-hidden="true" tabindex="-1"></a><span class="st">            .sourceCode .al { color: #ff5555 !important; } /* alerts */</span></span>
<span id="cb4-1055"><a href="#cb4-1055" aria-hidden="true" tabindex="-1"></a><span class="st">            .sourceCode .fu { color: #50fa7b !important; } /* functions */</span></span>
<span id="cb4-1056"><a href="#cb4-1056" aria-hidden="true" tabindex="-1"></a><span class="st">            .sourceCode .re { color: #f1fa8c !important; } /* regex */</span></span>
<span id="cb4-1057"><a href="#cb4-1057" aria-hidden="true" tabindex="-1"></a><span class="st">            .sourceCode .er { color: #ff5555 !important; } /* errors */</span></span>
<span id="cb4-1058"><a href="#cb4-1058" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1059"><a href="#cb4-1059" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Garantir que texto normal em blocos de c√≥digo seja vis√≠vel */</span></span>
<span id="cb4-1060"><a href="#cb4-1060" aria-hidden="true" tabindex="-1"></a><span class="st">            .sourceCode span {</span></span>
<span id="cb4-1061"><a href="#cb4-1061" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #f8f8f2 !important;</span></span>
<span id="cb4-1062"><a href="#cb4-1062" aria-hidden="true" tabindex="-1"></a><span class="st">                background: transparent !important;</span></span>
<span id="cb4-1063"><a href="#cb4-1063" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1064"><a href="#cb4-1064" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1065"><a href="#cb4-1065" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Fallback para qualquer elemento de c√≥digo n√£o estilizado */</span></span>
<span id="cb4-1066"><a href="#cb4-1066" aria-hidden="true" tabindex="-1"></a><span class="st">            .sourceCode * {</span></span>
<span id="cb4-1067"><a href="#cb4-1067" aria-hidden="true" tabindex="-1"></a><span class="st">                color: inherit !important;</span></span>
<span id="cb4-1068"><a href="#cb4-1068" aria-hidden="true" tabindex="-1"></a><span class="st">                background: transparent !important;</span></span>
<span id="cb4-1069"><a href="#cb4-1069" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1070"><a href="#cb4-1070" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1071"><a href="#cb4-1071" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Corre√ß√£o adicional para blocos de c√≥digo gerais */</span></span>
<span id="cb4-1072"><a href="#cb4-1072" aria-hidden="true" tabindex="-1"></a><span class="st">            div.sourceCode {</span></span>
<span id="cb4-1073"><a href="#cb4-1073" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db;</span></span>
<span id="cb4-1074"><a href="#cb4-1074" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #2d2d2d !important;</span></span>
<span id="cb4-1075"><a href="#cb4-1075" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #f8f8f2 !important;</span></span>
<span id="cb4-1076"><a href="#cb4-1076" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 1.5em 0;</span></span>
<span id="cb4-1077"><a href="#cb4-1077" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb4-1078"><a href="#cb4-1078" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow: hidden;</span></span>
<span id="cb4-1079"><a href="#cb4-1079" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1080"><a href="#cb4-1080" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1081"><a href="#cb4-1081" aria-hidden="true" tabindex="-1"></a><span class="st">            div.sourceCode pre {</span></span>
<span id="cb4-1082"><a href="#cb4-1082" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0;</span></span>
<span id="cb4-1083"><a href="#cb4-1083" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb4-1084"><a href="#cb4-1084" aria-hidden="true" tabindex="-1"></a><span class="st">                background: transparent !important;</span></span>
<span id="cb4-1085"><a href="#cb4-1085" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1086"><a href="#cb4-1086" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1087"><a href="#cb4-1087" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorar contraste para texto normal em todas as situa√ß√µes */</span></span>
<span id="cb4-1088"><a href="#cb4-1088" aria-hidden="true" tabindex="-1"></a><span class="st">            body, .container, .main-content {</span></span>
<span id="cb4-1089"><a href="#cb4-1089" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50 !important;</span></span>
<span id="cb4-1090"><a href="#cb4-1090" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1091"><a href="#cb4-1091" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1092"><a href="#cb4-1092" aria-hidden="true" tabindex="-1"></a><span class="st">            p, li, td, th, div, span {</span></span>
<span id="cb4-1093"><a href="#cb4-1093" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50 !important;</span></span>
<span id="cb4-1094"><a href="#cb4-1094" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1095"><a href="#cb4-1095" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1096"><a href="#cb4-1096" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Garantir que links sejam vis√≠veis */</span></span>
<span id="cb4-1097"><a href="#cb4-1097" aria-hidden="true" tabindex="-1"></a><span class="st">            a {</span></span>
<span id="cb4-1098"><a href="#cb4-1098" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #3498db !important;</span></span>
<span id="cb4-1099"><a href="#cb4-1099" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1100"><a href="#cb4-1100" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1101"><a href="#cb4-1101" aria-hidden="true" tabindex="-1"></a><span class="st">            a:hover {</span></span>
<span id="cb4-1102"><a href="#cb4-1102" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2980b9 !important;</span></span>
<span id="cb4-1103"><a href="#cb4-1103" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1104"><a href="#cb4-1104" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1105"><a href="#cb4-1105" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Corre√ß√£o para elementos MathJax */</span></span>
<span id="cb4-1106"><a href="#cb4-1106" aria-hidden="true" tabindex="-1"></a><span class="st">            .math, .math display, mjx-container {</span></span>
<span id="cb4-1107"><a href="#cb4-1107" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50 !important;</span></span>
<span id="cb4-1108"><a href="#cb4-1108" aria-hidden="true" tabindex="-1"></a><span class="st">                background: transparent !important;</span></span>
<span id="cb4-1109"><a href="#cb4-1109" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1110"><a href="#cb4-1110" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1111"><a href="#cb4-1111" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para c√≥digo e matem√°tica */</span></span>
<span id="cb4-1112"><a href="#cb4-1112" aria-hidden="true" tabindex="-1"></a><span class="st">            .math { display: block; text-align: center; margin: 1.5em 0; }</span></span>
<span id="cb4-1113"><a href="#cb4-1113" aria-hidden="true" tabindex="-1"></a><span class="st">            .math inline { display: inline-block; }</span></span>
<span id="cb4-1114"><a href="#cb4-1114" aria-hidden="true" tabindex="-1"></a><span class="st">            pre { </span></span>
<span id="cb4-1115"><a href="#cb4-1115" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb4-1116"><a href="#cb4-1116" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #2d2d2d !important; </span></span>
<span id="cb4-1117"><a href="#cb4-1117" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #f8f8f2 !important;</span></span>
<span id="cb4-1118"><a href="#cb4-1118" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb4-1119"><a href="#cb4-1119" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb4-1120"><a href="#cb4-1120" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow-x: auto;</span></span>
<span id="cb4-1121"><a href="#cb4-1121" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb4-1122"><a href="#cb4-1122" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.4;</span></span>
<span id="cb4-1123"><a href="#cb4-1123" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1124"><a href="#cb4-1124" aria-hidden="true" tabindex="-1"></a><span class="st">            code { </span></span>
<span id="cb4-1125"><a href="#cb4-1125" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #e9ecef !important; </span></span>
<span id="cb4-1126"><a href="#cb4-1126" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 0.2em 0.4em; </span></span>
<span id="cb4-1127"><a href="#cb4-1127" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 3px;</span></span>
<span id="cb4-1128"><a href="#cb4-1128" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb4-1129"><a href="#cb4-1129" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #c7254e !important;</span></span>
<span id="cb4-1130"><a href="#cb4-1130" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1131"><a href="#cb4-1131" aria-hidden="true" tabindex="-1"></a><span class="st">            pre code { </span></span>
<span id="cb4-1132"><a href="#cb4-1132" aria-hidden="true" tabindex="-1"></a><span class="st">                background: none !important; </span></span>
<span id="cb4-1133"><a href="#cb4-1133" aria-hidden="true" tabindex="-1"></a><span class="st">                color: inherit !important; </span></span>
<span id="cb4-1134"><a href="#cb4-1134" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 0 !important; </span></span>
<span id="cb4-1135"><a href="#cb4-1135" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1136"><a href="#cb4-1136" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1137"><a href="#cb4-1137" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias responsivas - TOC FIXO √Ä DIREITA */</span></span>
<span id="cb4-1138"><a href="#cb4-1138" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 1400px) {</span></span>
<span id="cb4-1139"><a href="#cb4-1139" aria-hidden="true" tabindex="-1"></a><span class="st">                .container {</span></span>
<span id="cb4-1140"><a href="#cb4-1140" aria-hidden="true" tabindex="-1"></a><span class="st">                    max-width: 98%;</span></span>
<span id="cb4-1141"><a href="#cb4-1141" aria-hidden="true" tabindex="-1"></a><span class="st">                    padding: 30px;</span></span>
<span id="cb4-1142"><a href="#cb4-1142" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb4-1143"><a href="#cb4-1143" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC {</span></span>
<span id="cb4-1144"><a href="#cb4-1144" aria-hidden="true" tabindex="-1"></a><span class="st">                    width: 280px; /* Reduz um pouco em telas menores, mas mant√©m fixo √† direita */</span></span>
<span id="cb4-1145"><a href="#cb4-1145" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb4-1146"><a href="#cb4-1146" aria-hidden="true" tabindex="-1"></a><span class="st">                .main-content {</span></span>
<span id="cb4-1147"><a href="#cb4-1147" aria-hidden="true" tabindex="-1"></a><span class="st">                    margin-right: 320px !important;</span></span>
<span id="cb4-1148"><a href="#cb4-1148" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb4-1149"><a href="#cb4-1149" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1150"><a href="#cb4-1150" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1151"><a href="#cb4-1151" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 1200px) {</span></span>
<span id="cb4-1152"><a href="#cb4-1152" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC {</span></span>
<span id="cb4-1153"><a href="#cb4-1153" aria-hidden="true" tabindex="-1"></a><span class="st">                    width: 250px;</span></span>
<span id="cb4-1154"><a href="#cb4-1154" aria-hidden="true" tabindex="-1"></a><span class="st">                    right: 10px !important;</span></span>
<span id="cb4-1155"><a href="#cb4-1155" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb4-1156"><a href="#cb4-1156" aria-hidden="true" tabindex="-1"></a><span class="st">                .main-content {</span></span>
<span id="cb4-1157"><a href="#cb4-1157" aria-hidden="true" tabindex="-1"></a><span class="st">                    margin-right: 280px !important;</span></span>
<span id="cb4-1158"><a href="#cb4-1158" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb4-1159"><a href="#cb4-1159" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1160"><a href="#cb4-1160" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1161"><a href="#cb4-1161" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Em telas menores, o TOC volta ao fluxo normal */</span></span>
<span id="cb4-1162"><a href="#cb4-1162" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 768px) {</span></span>
<span id="cb4-1163"><a href="#cb4-1163" aria-hidden="true" tabindex="-1"></a><span class="st">                body { padding: 10px; font-size: 14px; }</span></span>
<span id="cb4-1164"><a href="#cb4-1164" aria-hidden="true" tabindex="-1"></a><span class="st">                .container { padding: 20px; max-width: 100%; }</span></span>
<span id="cb4-1165"><a href="#cb4-1165" aria-hidden="true" tabindex="-1"></a><span class="st">                pre { font-size: 12px; padding: 15px; }</span></span>
<span id="cb4-1166"><a href="#cb4-1166" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC { </span></span>
<span id="cb4-1167"><a href="#cb4-1167" aria-hidden="true" tabindex="-1"></a><span class="st">                    position: relative !important;</span></span>
<span id="cb4-1168"><a href="#cb4-1168" aria-hidden="true" tabindex="-1"></a><span class="st">                    width: auto !important;</span></span>
<span id="cb4-1169"><a href="#cb4-1169" aria-hidden="true" tabindex="-1"></a><span class="st">                    right: 0 !important;</span></span>
<span id="cb4-1170"><a href="#cb4-1170" aria-hidden="true" tabindex="-1"></a><span class="st">                    top: 0 !important;</span></span>
<span id="cb4-1171"><a href="#cb4-1171" aria-hidden="true" tabindex="-1"></a><span class="st">                    transform: none !important;</span></span>
<span id="cb4-1172"><a href="#cb4-1172" aria-hidden="true" tabindex="-1"></a><span class="st">                    margin: 20px 0;</span></span>
<span id="cb4-1173"><a href="#cb4-1173" aria-hidden="true" tabindex="-1"></a><span class="st">                    float: none !important;</span></span>
<span id="cb4-1174"><a href="#cb4-1174" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb4-1175"><a href="#cb4-1175" aria-hidden="true" tabindex="-1"></a><span class="st">                .main-content {</span></span>
<span id="cb4-1176"><a href="#cb4-1176" aria-hidden="true" tabindex="-1"></a><span class="st">                    margin-right: 0 !important;</span></span>
<span id="cb4-1177"><a href="#cb4-1177" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb4-1178"><a href="#cb4-1178" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1179"><a href="#cb4-1179" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1180"><a href="#cb4-1180" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para tabelas */</span></span>
<span id="cb4-1181"><a href="#cb4-1181" aria-hidden="true" tabindex="-1"></a><span class="st">            table { </span></span>
<span id="cb4-1182"><a href="#cb4-1182" aria-hidden="true" tabindex="-1"></a><span class="st">                width: 100%; </span></span>
<span id="cb4-1183"><a href="#cb4-1183" aria-hidden="true" tabindex="-1"></a><span class="st">                border-collapse: collapse; </span></span>
<span id="cb4-1184"><a href="#cb4-1184" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 1.5em 0;</span></span>
<span id="cb4-1185"><a href="#cb4-1185" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb4-1186"><a href="#cb4-1186" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb4-1187"><a href="#cb4-1187" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow: hidden;</span></span>
<span id="cb4-1188"><a href="#cb4-1188" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1189"><a href="#cb4-1189" aria-hidden="true" tabindex="-1"></a><span class="st">            th, td { </span></span>
<span id="cb4-1190"><a href="#cb4-1190" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #dee2e6; </span></span>
<span id="cb4-1191"><a href="#cb4-1191" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 12px 15px; </span></span>
<span id="cb4-1192"><a href="#cb4-1192" aria-hidden="true" tabindex="-1"></a><span class="st">                text-align: left; </span></span>
<span id="cb4-1193"><a href="#cb4-1193" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1194"><a href="#cb4-1194" aria-hidden="true" tabindex="-1"></a><span class="st">            th { </span></span>
<span id="cb4-1195"><a href="#cb4-1195" aria-hidden="true" tabindex="-1"></a><span class="st">                background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb4-1196"><a href="#cb4-1196" aria-hidden="true" tabindex="-1"></a><span class="st">                color: white; </span></span>
<span id="cb4-1197"><a href="#cb4-1197" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: bold;</span></span>
<span id="cb4-1198"><a href="#cb4-1198" aria-hidden="true" tabindex="-1"></a><span class="st">                text-transform: uppercase;</span></span>
<span id="cb4-1199"><a href="#cb4-1199" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.9em;</span></span>
<span id="cb4-1200"><a href="#cb4-1200" aria-hidden="true" tabindex="-1"></a><span class="st">                letter-spacing: 0.5px;</span></span>
<span id="cb4-1201"><a href="#cb4-1201" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1202"><a href="#cb4-1202" aria-hidden="true" tabindex="-1"></a><span class="st">            tr:nth-child(even) { </span></span>
<span id="cb4-1203"><a href="#cb4-1203" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #f8f9fa; </span></span>
<span id="cb4-1204"><a href="#cb4-1204" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1205"><a href="#cb4-1205" aria-hidden="true" tabindex="-1"></a><span class="st">            tr:hover { </span></span>
<span id="cb4-1206"><a href="#cb4-1206" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #e3f2fd; </span></span>
<span id="cb4-1207"><a href="#cb4-1207" aria-hidden="true" tabindex="-1"></a><span class="st">                transition: background-color 0.2s ease;</span></span>
<span id="cb4-1208"><a href="#cb4-1208" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1209"><a href="#cb4-1209" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1210"><a href="#cb4-1210" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para blocos de cita√ß√£o */</span></span>
<span id="cb4-1211"><a href="#cb4-1211" aria-hidden="true" tabindex="-1"></a><span class="st">            blockquote { </span></span>
<span id="cb4-1212"><a href="#cb4-1212" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb4-1213"><a href="#cb4-1213" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 25px 0; </span></span>
<span id="cb4-1214"><a href="#cb4-1214" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 25px; </span></span>
<span id="cb4-1215"><a href="#cb4-1215" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #7f8c8d;</span></span>
<span id="cb4-1216"><a href="#cb4-1216" aria-hidden="true" tabindex="-1"></a><span class="st">                font-style: italic;</span></span>
<span id="cb4-1217"><a href="#cb4-1217" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #f8f9fa;</span></span>
<span id="cb4-1218"><a href="#cb4-1218" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb4-1219"><a href="#cb4-1219" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 0 8px 8px 0;</span></span>
<span id="cb4-1220"><a href="#cb4-1220" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1221"><a href="#cb4-1221" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1222"><a href="#cb4-1222" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Cabe√ßalhos com numera√ß√£o */</span></span>
<span id="cb4-1223"><a href="#cb4-1223" aria-hidden="true" tabindex="-1"></a><span class="st">            h1, h2, h3, h4, h5 { </span></span>
<span id="cb4-1224"><a href="#cb4-1224" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50 !important; </span></span>
<span id="cb4-1225"><a href="#cb4-1225" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-top: 1.8em;</span></span>
<span id="cb4-1226"><a href="#cb4-1226" aria-hidden="true" tabindex="-1"></a><span class="st">                border-bottom: 1px solid #e9ecef;</span></span>
<span id="cb4-1227"><a href="#cb4-1227" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-bottom: 0.5em;</span></span>
<span id="cb4-1228"><a href="#cb4-1228" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1229"><a href="#cb4-1229" aria-hidden="true" tabindex="-1"></a><span class="st">            h1 { </span></span>
<span id="cb4-1230"><a href="#cb4-1230" aria-hidden="true" tabindex="-1"></a><span class="st">                border-bottom: 3px solid #3498db; </span></span>
<span id="cb4-1231"><a href="#cb4-1231" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-bottom: 15px; </span></span>
<span id="cb4-1232"><a href="#cb4-1232" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50 !important;</span></span>
<span id="cb4-1233"><a href="#cb4-1233" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 2.2em;</span></span>
<span id="cb4-1234"><a href="#cb4-1234" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1235"><a href="#cb4-1235" aria-hidden="true" tabindex="-1"></a><span class="st">            h2 {</span></span>
<span id="cb4-1236"><a href="#cb4-1236" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db;</span></span>
<span id="cb4-1237"><a href="#cb4-1237" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 15px;</span></span>
<span id="cb4-1238"><a href="#cb4-1238" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-top: 2em;</span></span>
<span id="cb4-1239"><a href="#cb4-1239" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1240"><a href="#cb4-1240" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1241"><a href="#cb4-1241" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Scroll suave para links do TOC */</span></span>
<span id="cb4-1242"><a href="#cb4-1242" aria-hidden="true" tabindex="-1"></a><span class="st">            html {</span></span>
<span id="cb4-1243"><a href="#cb4-1243" aria-hidden="true" tabindex="-1"></a><span class="st">                scroll-behavior: smooth;</span></span>
<span id="cb4-1244"><a href="#cb4-1244" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1245"><a href="#cb4-1245" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-1246"><a href="#cb4-1246" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Indicador visual para se√ß√£o ativa no TOC */</span></span>
<span id="cb4-1247"><a href="#cb4-1247" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a.active {</span></span>
<span id="cb4-1248"><a href="#cb4-1248" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #007bff;</span></span>
<span id="cb4-1249"><a href="#cb4-1249" aria-hidden="true" tabindex="-1"></a><span class="st">                color: white;</span></span>
<span id="cb4-1250"><a href="#cb4-1250" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-1251"><a href="#cb4-1251" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/style&gt;</span></span>
<span id="cb4-1252"><a href="#cb4-1252" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb4-1253"><a href="#cb4-1253" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1254"><a href="#cb4-1254" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;/head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb4-1255"><a href="#cb4-1255" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;/head&gt;&#39;</span>, <span class="ss">f&#39;</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;&#39;</span>)</span>
<span id="cb4-1256"><a href="#cb4-1256" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb4-1257"><a href="#cb4-1257" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb4-1258"><a href="#cb4-1258" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb4-1259"><a href="#cb4-1259" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;&lt;body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb4-1260"><a href="#cb4-1260" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;body&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;&#39;</span>)</span>
<span id="cb4-1261"><a href="#cb4-1261" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb4-1262"><a href="#cb4-1262" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;</span><span class="ch">\n</span><span class="sc">{</span>html_content<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/body&gt;&#39;</span></span>
<span id="cb4-1263"><a href="#cb4-1263" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-1264"><a href="#cb4-1264" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb4-1265"><a href="#cb4-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1266"><a href="#cb4-1266" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _enhance_toc_styling(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-1267"><a href="#cb4-1267" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Melhora o estilo do Table of Contents gerado pelo Pandoc&quot;&quot;&quot;</span></span>
<span id="cb4-1268"><a href="#cb4-1268" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona t√≠tulo ao TOC se n√£o existir</span></span>
<span id="cb4-1269"><a href="#cb4-1269" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;Table of Contents&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb4-1270"><a href="#cb4-1270" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(</span>
<span id="cb4-1271"><a href="#cb4-1271" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span>, </span>
<span id="cb4-1272"><a href="#cb4-1272" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&lt;h2 style=&quot;margin-top: 0; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;&quot;&gt;üìë Table of Contents&lt;/h2&gt;&#39;</span></span>
<span id="cb4-1273"><a href="#cb4-1273" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb4-1274"><a href="#cb4-1274" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1275"><a href="#cb4-1275" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona wrapper para conte√∫do principal com clearfix</span></span>
<span id="cb4-1276"><a href="#cb4-1276" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;&lt;body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb4-1277"><a href="#cb4-1277" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Encontra o TOC e envolve o conte√∫do restante</span></span>
<span id="cb4-1278"><a href="#cb4-1278" aria-hidden="true" tabindex="-1"></a>            toc_end <span class="op">=</span> html_content.find(<span class="st">&#39;&lt;/div&gt;&#39;</span>, html_content.find(<span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span>)) <span class="op">+</span> <span class="dv">6</span></span>
<span id="cb4-1279"><a href="#cb4-1279" aria-hidden="true" tabindex="-1"></a>            body_content <span class="op">=</span> html_content[toc_end:]</span>
<span id="cb4-1280"><a href="#cb4-1280" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;&lt;div class=&quot;main-content&quot;&gt;&#39;</span> <span class="kw">not</span> <span class="kw">in</span> body_content:</span>
<span id="cb4-1281"><a href="#cb4-1281" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> html_content[:toc_end] <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&lt;div class=&quot;main-content&quot;&gt;&#39;</span> <span class="op">+</span> body_content <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&lt;/div&gt;&#39;</span></span>
<span id="cb4-1282"><a href="#cb4-1282" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1283"><a href="#cb4-1283" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb4-1284"><a href="#cb4-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1285"><a href="#cb4-1285" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_fallback(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-1286"><a href="#cb4-1286" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Fallback para convers√£o quando Pandoc falha&quot;&quot;&quot;</span></span>
<span id="cb4-1287"><a href="#cb4-1287" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-1288"><a href="#cb4-1288" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(md_file_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-1289"><a href="#cb4-1289" aria-hidden="true" tabindex="-1"></a>                md_content <span class="op">=</span> f.read()</span>
<span id="cb4-1290"><a href="#cb4-1290" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1291"><a href="#cb4-1291" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extens√µes avan√ßadas para melhor convers√£o</span></span>
<span id="cb4-1292"><a href="#cb4-1292" aria-hidden="true" tabindex="-1"></a>            extensions <span class="op">=</span> [</span>
<span id="cb4-1293"><a href="#cb4-1293" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;extra&#39;</span>, <span class="st">&#39;tables&#39;</span>, <span class="st">&#39;fenced_code&#39;</span>, <span class="st">&#39;codehilite&#39;</span>, </span>
<span id="cb4-1294"><a href="#cb4-1294" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;toc&#39;</span>, <span class="st">&#39;md_in_html&#39;</span>, <span class="st">&#39;attr_list&#39;</span></span>
<span id="cb4-1295"><a href="#cb4-1295" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb4-1296"><a href="#cb4-1296" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1297"><a href="#cb4-1297" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> markdown.markdown(</span>
<span id="cb4-1298"><a href="#cb4-1298" aria-hidden="true" tabindex="-1"></a>                md_content,</span>
<span id="cb4-1299"><a href="#cb4-1299" aria-hidden="true" tabindex="-1"></a>                extensions<span class="op">=</span>extensions,</span>
<span id="cb4-1300"><a href="#cb4-1300" aria-hidden="true" tabindex="-1"></a>                output_format<span class="op">=</span><span class="st">&#39;html5&#39;</span></span>
<span id="cb4-1301"><a href="#cb4-1301" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb4-1302"><a href="#cb4-1302" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1303"><a href="#cb4-1303" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_enhanced_html_template(html_content, Path(md_file_path).name)</span>
<span id="cb4-1304"><a href="#cb4-1304" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1305"><a href="#cb4-1305" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-1306"><a href="#cb4-1306" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Fallback tamb√©m falhou: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-1307"><a href="#cb4-1307" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_basic_html(md_content, Path(md_file_path).name)</span>
<span id="cb4-1308"><a href="#cb4-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1309"><a href="#cb4-1309" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_enhanced_html_template(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-1310"><a href="#cb4-1310" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Template HTML aprimorado com suporte a MathJax local/online e TOC flutuante&quot;&quot;&quot;</span></span>
<span id="cb4-1311"><a href="#cb4-1311" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb4-1312"><a href="#cb4-1312" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1313"><a href="#cb4-1313" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb4-1314"><a href="#cb4-1314" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html lang=&quot;pt-BR&quot;&gt;</span></span>
<span id="cb4-1315"><a href="#cb4-1315" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb4-1316"><a href="#cb4-1316" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb4-1317"><a href="#cb4-1317" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb4-1318"><a href="#cb4-1318" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb4-1319"><a href="#cb4-1319" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb4-1320"><a href="#cb4-1320" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* LAYOUT DE TELA COMPLETA OTIMIZADO */</span></span>
<span id="cb4-1321"><a href="#cb4-1321" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span></span>
<span id="cb4-1322"><a href="#cb4-1322" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb4-1323"><a href="#cb4-1323" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb4-1324"><a href="#cb4-1324" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0;</span></span>
<span id="cb4-1325"><a href="#cb4-1325" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb4-1326"><a href="#cb4-1326" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb4-1327"><a href="#cb4-1327" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333;</span></span>
<span id="cb4-1328"><a href="#cb4-1328" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: none; /* Remove limita√ß√£o de largura - TELA COMPLETA */</span></span>
<span id="cb4-1329"><a href="#cb4-1329" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1330"><a href="#cb4-1330" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb4-1331"><a href="#cb4-1331" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb4-1332"><a href="#cb4-1332" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb4-1333"><a href="#cb4-1333" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb4-1334"><a href="#cb4-1334" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 40px;</span></span>
<span id="cb4-1335"><a href="#cb4-1335" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 10px;</span></span>
<span id="cb4-1336"><a href="#cb4-1336" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb4-1337"><a href="#cb4-1337" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: relative; /* Para posicionamento do TOC */</span></span>
<span id="cb4-1338"><a href="#cb4-1338" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1339"><a href="#cb4-1339" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-1340"><a href="#cb4-1340" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* TOC FIXO √Ä DIREITA */</span></span>
<span id="cb4-1341"><a href="#cb4-1341" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc </span><span class="ch">{{</span></span>
<span id="cb4-1342"><a href="#cb4-1342" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);</span></span>
<span id="cb4-1343"><a href="#cb4-1343" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #dee2e6;</span></span>
<span id="cb4-1344"><a href="#cb4-1344" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb4-1345"><a href="#cb4-1345" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb4-1346"><a href="#cb4-1346" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 20px 0;</span></span>
<span id="cb4-1347"><a href="#cb4-1347" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb4-1348"><a href="#cb4-1348" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: fixed !important;</span></span>
<span id="cb4-1349"><a href="#cb4-1349" aria-hidden="true" tabindex="-1"></a><span class="ss">            top: 50% !important;</span></span>
<span id="cb4-1350"><a href="#cb4-1350" aria-hidden="true" tabindex="-1"></a><span class="ss">            right: 20px !important;</span></span>
<span id="cb4-1351"><a href="#cb4-1351" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: translateY(-50%) !important;</span></span>
<span id="cb4-1352"><a href="#cb4-1352" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 300px !important;</span></span>
<span id="cb4-1353"><a href="#cb4-1353" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-height: 80vh !important;</span></span>
<span id="cb4-1354"><a href="#cb4-1354" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-y: auto !important;</span></span>
<span id="cb4-1355"><a href="#cb4-1355" aria-hidden="true" tabindex="-1"></a><span class="ss">            z-index: 1000 !important;</span></span>
<span id="cb4-1356"><a href="#cb4-1356" aria-hidden="true" tabindex="-1"></a><span class="ss">            backdrop-filter: blur(10px);</span></span>
<span id="cb4-1357"><a href="#cb4-1357" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: rgba(255, 255, 255, 0.95) !important;</span></span>
<span id="cb4-1358"><a href="#cb4-1358" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1359"><a href="#cb4-1359" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-1360"><a href="#cb4-1360" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc h2 </span><span class="ch">{{</span></span>
<span id="cb4-1361"><a href="#cb4-1361" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb4-1362"><a href="#cb4-1362" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb4-1363"><a href="#cb4-1363" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 2px solid #3498db;</span></span>
<span id="cb4-1364"><a href="#cb4-1364" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 10px;</span></span>
<span id="cb4-1365"><a href="#cb4-1365" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1366"><a href="#cb4-1366" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc ul </span><span class="ch">{{</span></span>
<span id="cb4-1367"><a href="#cb4-1367" aria-hidden="true" tabindex="-1"></a><span class="ss">            list-style-type: none;</span></span>
<span id="cb4-1368"><a href="#cb4-1368" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb4-1369"><a href="#cb4-1369" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1370"><a href="#cb4-1370" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc ul ul </span><span class="ch">{{</span></span>
<span id="cb4-1371"><a href="#cb4-1371" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 25px;</span></span>
<span id="cb4-1372"><a href="#cb4-1372" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1373"><a href="#cb4-1373" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc li </span><span class="ch">{{</span></span>
<span id="cb4-1374"><a href="#cb4-1374" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 8px 0;</span></span>
<span id="cb4-1375"><a href="#cb4-1375" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1376"><a href="#cb4-1376" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc a </span><span class="ch">{{</span></span>
<span id="cb4-1377"><a href="#cb4-1377" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb4-1378"><a href="#cb4-1378" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #495057;</span></span>
<span id="cb4-1379"><a href="#cb4-1379" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb4-1380"><a href="#cb4-1380" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: block;</span></span>
<span id="cb4-1381"><a href="#cb4-1381" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 8px;</span></span>
<span id="cb4-1382"><a href="#cb4-1382" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb4-1383"><a href="#cb4-1383" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1384"><a href="#cb4-1384" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc a:hover </span><span class="ch">{{</span></span>
<span id="cb4-1385"><a href="#cb4-1385" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #007bff;</span></span>
<span id="cb4-1386"><a href="#cb4-1386" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: rgba(0, 123, 255, 0.1);</span></span>
<span id="cb4-1387"><a href="#cb4-1387" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1388"><a href="#cb4-1388" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-1389"><a href="#cb4-1389" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* CLEARFIX PARA LAYOUT COM TOC FIXO */</span></span>
<span id="cb4-1390"><a href="#cb4-1390" aria-hidden="true" tabindex="-1"></a><span class="ss">        .main-content </span><span class="ch">{{</span></span>
<span id="cb4-1391"><a href="#cb4-1391" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb4-1392"><a href="#cb4-1392" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: relative;</span></span>
<span id="cb4-1393"><a href="#cb4-1393" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-right: 350px !important;</span></span>
<span id="cb4-1394"><a href="#cb4-1394" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1395"><a href="#cb4-1395" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-1396"><a href="#cb4-1396" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* CORRE√á√ÉO CR√çTICA: Garantir visibilidade do texto */</span></span>
<span id="cb4-1397"><a href="#cb4-1397" aria-hidden="true" tabindex="-1"></a><span class="ss">        .sourceCode, pre, code </span><span class="ch">{{</span></span>
<span id="cb4-1398"><a href="#cb4-1398" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #f8f8f2 !important;</span></span>
<span id="cb4-1399"><a href="#cb4-1399" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #2d2d2d !important;</span></span>
<span id="cb4-1400"><a href="#cb4-1400" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1401"><a href="#cb4-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1402"><a href="#cb4-1402" aria-hidden="true" tabindex="-1"></a><span class="ss">        .sourceCode span </span><span class="ch">{{</span></span>
<span id="cb4-1403"><a href="#cb4-1403" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #f8f8f2 !important;</span></span>
<span id="cb4-1404"><a href="#cb4-1404" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: transparent !important;</span></span>
<span id="cb4-1405"><a href="#cb4-1405" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1406"><a href="#cb4-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1407"><a href="#cb4-1407" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* Corre√ß√£o para syntax highlighting */</span></span>
<span id="cb4-1408"><a href="#cb4-1408" aria-hidden="true" tabindex="-1"></a><span class="ss">        .sourceCode .kw </span><span class="ch">{{</span><span class="ss"> color: #ff79c6 !important; </span><span class="ch">}}</span></span>
<span id="cb4-1409"><a href="#cb4-1409" aria-hidden="true" tabindex="-1"></a><span class="ss">        .sourceCode .dt </span><span class="ch">{{</span><span class="ss"> color: #8be9fd !important; </span><span class="ch">}}</span></span>
<span id="cb4-1410"><a href="#cb4-1410" aria-hidden="true" tabindex="-1"></a><span class="ss">        .sourceCode .dv </span><span class="ch">{{</span><span class="ss"> color: #bd93f9 !important; </span><span class="ch">}}</span></span>
<span id="cb4-1411"><a href="#cb4-1411" aria-hidden="true" tabindex="-1"></a><span class="ss">        .sourceCode .bn </span><span class="ch">{{</span><span class="ss"> color: #bd93f9 !important; </span><span class="ch">}}</span></span>
<span id="cb4-1412"><a href="#cb4-1412" aria-hidden="true" tabindex="-1"></a><span class="ss">        .sourceCode .fl </span><span class="ch">{{</span><span class="ss"> color: #bd93f9 !important; </span><span class="ch">}}</span></span>
<span id="cb4-1413"><a href="#cb4-1413" aria-hidden="true" tabindex="-1"></a><span class="ss">        .sourceCode .ch </span><span class="ch">{{</span><span class="ss"> color: #f1fa8c !important; </span><span class="ch">}}</span></span>
<span id="cb4-1414"><a href="#cb4-1414" aria-hidden="true" tabindex="-1"></a><span class="ss">        .sourceCode .st </span><span class="ch">{{</span><span class="ss"> color: #f1fa8c !important; </span><span class="ch">}}</span></span>
<span id="cb4-1415"><a href="#cb4-1415" aria-hidden="true" tabindex="-1"></a><span class="ss">        .sourceCode .co </span><span class="ch">{{</span><span class="ss"> color: #6272a4 !important; </span><span class="ch">}}</span></span>
<span id="cb4-1416"><a href="#cb4-1416" aria-hidden="true" tabindex="-1"></a><span class="ss">        .sourceCode .ot </span><span class="ch">{{</span><span class="ss"> color: #50fa7b !important; </span><span class="ch">}}</span></span>
<span id="cb4-1417"><a href="#cb4-1417" aria-hidden="true" tabindex="-1"></a><span class="ss">        .sourceCode .al </span><span class="ch">{{</span><span class="ss"> color: #ff5555 !important; </span><span class="ch">}}</span></span>
<span id="cb4-1418"><a href="#cb4-1418" aria-hidden="true" tabindex="-1"></a><span class="ss">        .sourceCode .fu </span><span class="ch">{{</span><span class="ss"> color: #50fa7b !important; </span><span class="ch">}}</span></span>
<span id="cb4-1419"><a href="#cb4-1419" aria-hidden="true" tabindex="-1"></a><span class="ss">        .sourceCode .re </span><span class="ch">{{</span><span class="ss"> color: #f1fa8c !important; </span><span class="ch">}}</span></span>
<span id="cb4-1420"><a href="#cb4-1420" aria-hidden="true" tabindex="-1"></a><span class="ss">        .sourceCode .er </span><span class="ch">{{</span><span class="ss"> color: #ff5555 !important; </span><span class="ch">}}</span></span>
<span id="cb4-1421"><a href="#cb4-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1422"><a href="#cb4-1422" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* Garantir contraste para texto normal */</span></span>
<span id="cb4-1423"><a href="#cb4-1423" aria-hidden="true" tabindex="-1"></a><span class="ss">        body, .container </span><span class="ch">{{</span></span>
<span id="cb4-1424"><a href="#cb4-1424" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50 !important;</span></span>
<span id="cb4-1425"><a href="#cb4-1425" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1426"><a href="#cb4-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1427"><a href="#cb4-1427" aria-hidden="true" tabindex="-1"></a><span class="ss">        p, li, td, th </span><span class="ch">{{</span></span>
<span id="cb4-1428"><a href="#cb4-1428" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50 !important;</span></span>
<span id="cb4-1429"><a href="#cb4-1429" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1430"><a href="#cb4-1430" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-1431"><a href="#cb4-1431" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1, h2, h3, h4, h5 </span><span class="ch">{{</span></span>
<span id="cb4-1432"><a href="#cb4-1432" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50 !important;</span></span>
<span id="cb4-1433"><a href="#cb4-1433" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 1.8em;</span></span>
<span id="cb4-1434"><a href="#cb4-1434" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1435"><a href="#cb4-1435" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1 </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-1436"><a href="#cb4-1436" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 3px solid #3498db; </span></span>
<span id="cb4-1437"><a href="#cb4-1437" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 15px; </span></span>
<span id="cb4-1438"><a href="#cb4-1438" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50 !important;</span></span>
<span id="cb4-1439"><a href="#cb4-1439" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 2.2em;</span></span>
<span id="cb4-1440"><a href="#cb4-1440" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1441"><a href="#cb4-1441" aria-hidden="true" tabindex="-1"></a><span class="ss">        h2 </span><span class="ch">{{</span></span>
<span id="cb4-1442"><a href="#cb4-1442" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb4-1443"><a href="#cb4-1443" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb4-1444"><a href="#cb4-1444" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 2em;</span></span>
<span id="cb4-1445"><a href="#cb4-1445" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1446"><a href="#cb4-1446" aria-hidden="true" tabindex="-1"></a><span class="ss">        code </span><span class="ch">{{</span></span>
<span id="cb4-1447"><a href="#cb4-1447" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f4f4f4 !important;</span></span>
<span id="cb4-1448"><a href="#cb4-1448" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 3px 8px;</span></span>
<span id="cb4-1449"><a href="#cb4-1449" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb4-1450"><a href="#cb4-1450" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb4-1451"><a href="#cb4-1451" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #c7254e !important;</span></span>
<span id="cb4-1452"><a href="#cb4-1452" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb4-1453"><a href="#cb4-1453" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1454"><a href="#cb4-1454" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span></span>
<span id="cb4-1455"><a href="#cb4-1455" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #2d2d2d !important;</span></span>
<span id="cb4-1456"><a href="#cb4-1456" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #f8f8f2 !important;</span></span>
<span id="cb4-1457"><a href="#cb4-1457" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb4-1458"><a href="#cb4-1458" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb4-1459"><a href="#cb4-1459" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb4-1460"><a href="#cb4-1460" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 5px solid #3498db;</span></span>
<span id="cb4-1461"><a href="#cb4-1461" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb4-1462"><a href="#cb4-1462" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.4;</span></span>
<span id="cb4-1463"><a href="#cb4-1463" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1464"><a href="#cb4-1464" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre code </span><span class="ch">{{</span></span>
<span id="cb4-1465"><a href="#cb4-1465" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: none !important;</span></span>
<span id="cb4-1466"><a href="#cb4-1466" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: inherit !important;</span></span>
<span id="cb4-1467"><a href="#cb4-1467" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 0 !important;</span></span>
<span id="cb4-1468"><a href="#cb4-1468" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1469"><a href="#cb4-1469" aria-hidden="true" tabindex="-1"></a><span class="ss">        blockquote </span><span class="ch">{{</span></span>
<span id="cb4-1470"><a href="#cb4-1470" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb4-1471"><a href="#cb4-1471" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 25px 0;</span></span>
<span id="cb4-1472"><a href="#cb4-1472" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 25px;</span></span>
<span id="cb4-1473"><a href="#cb4-1473" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb4-1474"><a href="#cb4-1474" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-style: italic;</span></span>
<span id="cb4-1475"><a href="#cb4-1475" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb4-1476"><a href="#cb4-1476" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb4-1477"><a href="#cb4-1477" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 0 8px 8px 0;</span></span>
<span id="cb4-1478"><a href="#cb4-1478" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1479"><a href="#cb4-1479" aria-hidden="true" tabindex="-1"></a><span class="ss">        table </span><span class="ch">{{</span></span>
<span id="cb4-1480"><a href="#cb4-1480" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-collapse: collapse;</span></span>
<span id="cb4-1481"><a href="#cb4-1481" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 100%;</span></span>
<span id="cb4-1482"><a href="#cb4-1482" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb4-1483"><a href="#cb4-1483" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb4-1484"><a href="#cb4-1484" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb4-1485"><a href="#cb4-1485" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb4-1486"><a href="#cb4-1486" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1487"><a href="#cb4-1487" aria-hidden="true" tabindex="-1"></a><span class="ss">        th, td </span><span class="ch">{{</span></span>
<span id="cb4-1488"><a href="#cb4-1488" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb4-1489"><a href="#cb4-1489" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb4-1490"><a href="#cb4-1490" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: left;</span></span>
<span id="cb4-1491"><a href="#cb4-1491" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1492"><a href="#cb4-1492" aria-hidden="true" tabindex="-1"></a><span class="ss">        th </span><span class="ch">{{</span></span>
<span id="cb4-1493"><a href="#cb4-1493" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb4-1494"><a href="#cb4-1494" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb4-1495"><a href="#cb4-1495" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb4-1496"><a href="#cb4-1496" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-transform: uppercase;</span></span>
<span id="cb4-1497"><a href="#cb4-1497" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb4-1498"><a href="#cb4-1498" aria-hidden="true" tabindex="-1"></a><span class="ss">            letter-spacing: 0.5px;</span></span>
<span id="cb4-1499"><a href="#cb4-1499" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1500"><a href="#cb4-1500" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:nth-child(even) </span><span class="ch">{{</span></span>
<span id="cb4-1501"><a href="#cb4-1501" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f8f9fa;</span></span>
<span id="cb4-1502"><a href="#cb4-1502" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1503"><a href="#cb4-1503" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:hover </span><span class="ch">{{</span></span>
<span id="cb4-1504"><a href="#cb4-1504" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #e3f2fd;</span></span>
<span id="cb4-1505"><a href="#cb4-1505" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: background-color 0.2s ease;</span></span>
<span id="cb4-1506"><a href="#cb4-1506" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1507"><a href="#cb4-1507" aria-hidden="true" tabindex="-1"></a><span class="ss">        .math </span><span class="ch">{{</span></span>
<span id="cb4-1508"><a href="#cb4-1508" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center;</span></span>
<span id="cb4-1509"><a href="#cb4-1509" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb4-1510"><a href="#cb4-1510" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb4-1511"><a href="#cb4-1511" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb4-1512"><a href="#cb4-1512" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb4-1513"><a href="#cb4-1513" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb4-1514"><a href="#cb4-1514" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1515"><a href="#cb4-1515" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-header </span><span class="ch">{{</span></span>
<span id="cb4-1516"><a href="#cb4-1516" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb4-1517"><a href="#cb4-1517" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between;</span></span>
<span id="cb4-1518"><a href="#cb4-1518" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: center;</span></span>
<span id="cb4-1519"><a href="#cb4-1519" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 15px;</span></span>
<span id="cb4-1520"><a href="#cb4-1520" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb4-1521"><a href="#cb4-1521" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 10px;</span></span>
<span id="cb4-1522"><a href="#cb4-1522" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1523"><a href="#cb4-1523" aria-hidden="true" tabindex="-1"></a><span class="ss">        .author </span><span class="ch">{{</span></span>
<span id="cb4-1524"><a href="#cb4-1524" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb4-1525"><a href="#cb4-1525" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50 !important;</span></span>
<span id="cb4-1526"><a href="#cb4-1526" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.1em;</span></span>
<span id="cb4-1527"><a href="#cb4-1527" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1528"><a href="#cb4-1528" aria-hidden="true" tabindex="-1"></a><span class="ss">        .timestamp </span><span class="ch">{{</span></span>
<span id="cb4-1529"><a href="#cb4-1529" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb4-1530"><a href="#cb4-1530" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb4-1531"><a href="#cb4-1531" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e9ecef;</span></span>
<span id="cb4-1532"><a href="#cb4-1532" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 8px;</span></span>
<span id="cb4-1533"><a href="#cb4-1533" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb4-1534"><a href="#cb4-1534" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1535"><a href="#cb4-1535" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-content </span><span class="ch">{{</span></span>
<span id="cb4-1536"><a href="#cb4-1536" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb4-1537"><a href="#cb4-1537" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb4-1538"><a href="#cb4-1538" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb4-1539"><a href="#cb4-1539" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb4-1540"><a href="#cb4-1540" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 20px;</span></span>
<span id="cb4-1541"><a href="#cb4-1541" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1542"><a href="#cb4-1542" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata </span><span class="ch">{{</span></span>
<span id="cb4-1543"><a href="#cb4-1543" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e8f4fd;</span></span>
<span id="cb4-1544"><a href="#cb4-1544" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb4-1545"><a href="#cb4-1545" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb4-1546"><a href="#cb4-1546" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 25px;</span></span>
<span id="cb4-1547"><a href="#cb4-1547" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb4-1548"><a href="#cb4-1548" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1549"><a href="#cb4-1549" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata h3 </span><span class="ch">{{</span></span>
<span id="cb4-1550"><a href="#cb4-1550" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb4-1551"><a href="#cb4-1551" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50 !important;</span></span>
<span id="cb4-1552"><a href="#cb4-1552" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1553"><a href="#cb4-1553" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-1554"><a href="#cb4-1554" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* Melhorias responsivas */</span></span>
<span id="cb4-1555"><a href="#cb4-1555" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 1400px) </span><span class="ch">{{</span></span>
<span id="cb4-1556"><a href="#cb4-1556" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb4-1557"><a href="#cb4-1557" aria-hidden="true" tabindex="-1"></a><span class="ss">                max-width: 98%;</span></span>
<span id="cb4-1558"><a href="#cb4-1558" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 30px;</span></span>
<span id="cb4-1559"><a href="#cb4-1559" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb4-1560"><a href="#cb4-1560" aria-hidden="true" tabindex="-1"></a><span class="ss">            .toc </span><span class="ch">{{</span></span>
<span id="cb4-1561"><a href="#cb4-1561" aria-hidden="true" tabindex="-1"></a><span class="ss">                width: 280px;</span></span>
<span id="cb4-1562"><a href="#cb4-1562" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb4-1563"><a href="#cb4-1563" aria-hidden="true" tabindex="-1"></a><span class="ss">            .main-content </span><span class="ch">{{</span></span>
<span id="cb4-1564"><a href="#cb4-1564" aria-hidden="true" tabindex="-1"></a><span class="ss">                margin-right: 320px !important;</span></span>
<span id="cb4-1565"><a href="#cb4-1565" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb4-1566"><a href="#cb4-1566" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1567"><a href="#cb4-1567" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-1568"><a href="#cb4-1568" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 1200px) </span><span class="ch">{{</span></span>
<span id="cb4-1569"><a href="#cb4-1569" aria-hidden="true" tabindex="-1"></a><span class="ss">            .toc </span><span class="ch">{{</span></span>
<span id="cb4-1570"><a href="#cb4-1570" aria-hidden="true" tabindex="-1"></a><span class="ss">                width: 250px;</span></span>
<span id="cb4-1571"><a href="#cb4-1571" aria-hidden="true" tabindex="-1"></a><span class="ss">                right: 10px !important;</span></span>
<span id="cb4-1572"><a href="#cb4-1572" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb4-1573"><a href="#cb4-1573" aria-hidden="true" tabindex="-1"></a><span class="ss">            .main-content </span><span class="ch">{{</span></span>
<span id="cb4-1574"><a href="#cb4-1574" aria-hidden="true" tabindex="-1"></a><span class="ss">                margin-right: 280px !important;</span></span>
<span id="cb4-1575"><a href="#cb4-1575" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb4-1576"><a href="#cb4-1576" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1577"><a href="#cb4-1577" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-1578"><a href="#cb4-1578" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 768px) </span><span class="ch">{{</span></span>
<span id="cb4-1579"><a href="#cb4-1579" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb4-1580"><a href="#cb4-1580" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 20px;</span></span>
<span id="cb4-1581"><a href="#cb4-1581" aria-hidden="true" tabindex="-1"></a><span class="ss">                max-width: 100%;</span></span>
<span id="cb4-1582"><a href="#cb4-1582" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb4-1583"><a href="#cb4-1583" aria-hidden="true" tabindex="-1"></a><span class="ss">            body </span><span class="ch">{{</span></span>
<span id="cb4-1584"><a href="#cb4-1584" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 10px;</span></span>
<span id="cb4-1585"><a href="#cb4-1585" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb4-1586"><a href="#cb4-1586" aria-hidden="true" tabindex="-1"></a><span class="ss">            .toc </span><span class="ch">{{</span></span>
<span id="cb4-1587"><a href="#cb4-1587" aria-hidden="true" tabindex="-1"></a><span class="ss">                position: relative !important;</span></span>
<span id="cb4-1588"><a href="#cb4-1588" aria-hidden="true" tabindex="-1"></a><span class="ss">                width: auto !important;</span></span>
<span id="cb4-1589"><a href="#cb4-1589" aria-hidden="true" tabindex="-1"></a><span class="ss">                right: 0 !important;</span></span>
<span id="cb4-1590"><a href="#cb4-1590" aria-hidden="true" tabindex="-1"></a><span class="ss">                top: 0 !important;</span></span>
<span id="cb4-1591"><a href="#cb4-1591" aria-hidden="true" tabindex="-1"></a><span class="ss">                transform: none !important;</span></span>
<span id="cb4-1592"><a href="#cb4-1592" aria-hidden="true" tabindex="-1"></a><span class="ss">                margin: 20px 0;</span></span>
<span id="cb4-1593"><a href="#cb4-1593" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb4-1594"><a href="#cb4-1594" aria-hidden="true" tabindex="-1"></a><span class="ss">            .main-content </span><span class="ch">{{</span></span>
<span id="cb4-1595"><a href="#cb4-1595" aria-hidden="true" tabindex="-1"></a><span class="ss">                margin-right: 0 !important;</span></span>
<span id="cb4-1596"><a href="#cb4-1596" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb4-1597"><a href="#cb4-1597" aria-hidden="true" tabindex="-1"></a><span class="ss">            h1 </span><span class="ch">{{</span></span>
<span id="cb4-1598"><a href="#cb4-1598" aria-hidden="true" tabindex="-1"></a><span class="ss">                font-size: 1.8em;</span></span>
<span id="cb4-1599"><a href="#cb4-1599" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb4-1600"><a href="#cb4-1600" aria-hidden="true" tabindex="-1"></a><span class="ss">            .message-header </span><span class="ch">{{</span></span>
<span id="cb4-1601"><a href="#cb4-1601" aria-hidden="true" tabindex="-1"></a><span class="ss">                flex-direction: column;</span></span>
<span id="cb4-1602"><a href="#cb4-1602" aria-hidden="true" tabindex="-1"></a><span class="ss">                align-items: flex-start;</span></span>
<span id="cb4-1603"><a href="#cb4-1603" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb4-1604"><a href="#cb4-1604" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1605"><a href="#cb4-1605" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-1606"><a href="#cb4-1606" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* Scroll suave */</span></span>
<span id="cb4-1607"><a href="#cb4-1607" aria-hidden="true" tabindex="-1"></a><span class="ss">        html </span><span class="ch">{{</span></span>
<span id="cb4-1608"><a href="#cb4-1608" aria-hidden="true" tabindex="-1"></a><span class="ss">            scroll-behavior: smooth;</span></span>
<span id="cb4-1609"><a href="#cb4-1609" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1610"><a href="#cb4-1610" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb4-1611"><a href="#cb4-1611" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb4-1612"><a href="#cb4-1612" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb4-1613"><a href="#cb4-1613" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb4-1614"><a href="#cb4-1614" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="sc">{</span>content<span class="sc">}</span></span>
<span id="cb4-1615"><a href="#cb4-1615" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb4-1616"><a href="#cb4-1616" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb4-1617"><a href="#cb4-1617" aria-hidden="true" tabindex="-1"></a><span class="ss">        // Configura√ß√£o MathJax para melhor renderiza√ß√£o</span></span>
<span id="cb4-1618"><a href="#cb4-1618" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb4-1619"><a href="#cb4-1619" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb4-1620"><a href="#cb4-1620" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb4-1621"><a href="#cb4-1621" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb4-1622"><a href="#cb4-1622" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true,</span></span>
<span id="cb4-1623"><a href="#cb4-1623" aria-hidden="true" tabindex="-1"></a><span class="ss">                tags: &#39;ams&#39;</span></span>
<span id="cb4-1624"><a href="#cb4-1624" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb4-1625"><a href="#cb4-1625" aria-hidden="true" tabindex="-1"></a><span class="ss">            options: </span><span class="ch">{{</span></span>
<span id="cb4-1626"><a href="#cb4-1626" aria-hidden="true" tabindex="-1"></a><span class="ss">                skipHtmlTags: [&#39;script&#39;, &#39;noscript&#39;, &#39;style&#39;, &#39;textarea&#39;, &#39;pre&#39;],</span></span>
<span id="cb4-1627"><a href="#cb4-1627" aria-hidden="true" tabindex="-1"></a><span class="ss">                renderActions: </span><span class="ch">{{</span></span>
<span id="cb4-1628"><a href="#cb4-1628" aria-hidden="true" tabindex="-1"></a><span class="ss">                    addMenu: [0, &#39;&#39;, &#39;&#39;]</span></span>
<span id="cb4-1629"><a href="#cb4-1629" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb4-1630"><a href="#cb4-1630" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb4-1631"><a href="#cb4-1631" aria-hidden="true" tabindex="-1"></a><span class="ss">            startup: </span><span class="ch">{{</span></span>
<span id="cb4-1632"><a href="#cb4-1632" aria-hidden="true" tabindex="-1"></a><span class="ss">                pageReady() </span><span class="ch">{{</span></span>
<span id="cb4-1633"><a href="#cb4-1633" aria-hidden="true" tabindex="-1"></a><span class="ss">                    return MathJax.startup.defaultPageReady().then(() =&gt; </span><span class="ch">{{</span></span>
<span id="cb4-1634"><a href="#cb4-1634" aria-hidden="true" tabindex="-1"></a><span class="ss">                        console.log(&#39;MathJax carregado com sucesso&#39;);</span></span>
<span id="cb4-1635"><a href="#cb4-1635" aria-hidden="true" tabindex="-1"></a><span class="ss">                    </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb4-1636"><a href="#cb4-1636" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb4-1637"><a href="#cb4-1637" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb4-1638"><a href="#cb4-1638" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb4-1639"><a href="#cb4-1639" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-1640"><a href="#cb4-1640" aria-hidden="true" tabindex="-1"></a><span class="ss">        // Script para destacar se√ß√£o ativa no TOC (se existir)</span></span>
<span id="cb4-1641"><a href="#cb4-1641" aria-hidden="true" tabindex="-1"></a><span class="ss">        document.addEventListener(&#39;DOMContentLoaded&#39;, function() </span><span class="ch">{{</span></span>
<span id="cb4-1642"><a href="#cb4-1642" aria-hidden="true" tabindex="-1"></a><span class="ss">            const tocLinks = document.querySelectorAll(&#39;#TOC a, .toc a&#39;);</span></span>
<span id="cb4-1643"><a href="#cb4-1643" aria-hidden="true" tabindex="-1"></a><span class="ss">            const sections = document.querySelectorAll(&#39;h1, h2, h3, h4, h5&#39;);</span></span>
<span id="cb4-1644"><a href="#cb4-1644" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span></span>
<span id="cb4-1645"><a href="#cb4-1645" aria-hidden="true" tabindex="-1"></a><span class="ss">            function highlightActiveSection() </span><span class="ch">{{</span></span>
<span id="cb4-1646"><a href="#cb4-1646" aria-hidden="true" tabindex="-1"></a><span class="ss">                let currentSection = &#39;&#39;;</span></span>
<span id="cb4-1647"><a href="#cb4-1647" aria-hidden="true" tabindex="-1"></a><span class="ss">                const scrollY = window.pageYOffset;</span></span>
<span id="cb4-1648"><a href="#cb4-1648" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span></span>
<span id="cb4-1649"><a href="#cb4-1649" aria-hidden="true" tabindex="-1"></a><span class="ss">                sections.forEach(section =&gt; </span><span class="ch">{{</span></span>
<span id="cb4-1650"><a href="#cb4-1650" aria-hidden="true" tabindex="-1"></a><span class="ss">                    const sectionTop = section.offsetTop - 100;</span></span>
<span id="cb4-1651"><a href="#cb4-1651" aria-hidden="true" tabindex="-1"></a><span class="ss">                    if (scrollY &gt;= sectionTop) </span><span class="ch">{{</span></span>
<span id="cb4-1652"><a href="#cb4-1652" aria-hidden="true" tabindex="-1"></a><span class="ss">                        currentSection = section.getAttribute(&#39;id&#39;);</span></span>
<span id="cb4-1653"><a href="#cb4-1653" aria-hidden="true" tabindex="-1"></a><span class="ss">                    </span><span class="ch">}}</span></span>
<span id="cb4-1654"><a href="#cb4-1654" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb4-1655"><a href="#cb4-1655" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span></span>
<span id="cb4-1656"><a href="#cb4-1656" aria-hidden="true" tabindex="-1"></a><span class="ss">                tocLinks.forEach(link =&gt; </span><span class="ch">{{</span></span>
<span id="cb4-1657"><a href="#cb4-1657" aria-hidden="true" tabindex="-1"></a><span class="ss">                    link.classList.remove(&#39;active&#39;);</span></span>
<span id="cb4-1658"><a href="#cb4-1658" aria-hidden="true" tabindex="-1"></a><span class="ss">                    if (link.getAttribute(&#39;href&#39;) === &#39;#&#39; + currentSection) </span><span class="ch">{{</span></span>
<span id="cb4-1659"><a href="#cb4-1659" aria-hidden="true" tabindex="-1"></a><span class="ss">                        link.classList.add(&#39;active&#39;);</span></span>
<span id="cb4-1660"><a href="#cb4-1660" aria-hidden="true" tabindex="-1"></a><span class="ss">                    </span><span class="ch">}}</span></span>
<span id="cb4-1661"><a href="#cb4-1661" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb4-1662"><a href="#cb4-1662" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb4-1663"><a href="#cb4-1663" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span></span>
<span id="cb4-1664"><a href="#cb4-1664" aria-hidden="true" tabindex="-1"></a><span class="ss">            if (tocLinks.length &gt; 0) </span><span class="ch">{{</span></span>
<span id="cb4-1665"><a href="#cb4-1665" aria-hidden="true" tabindex="-1"></a><span class="ss">                window.addEventListener(&#39;scroll&#39;, highlightActiveSection);</span></span>
<span id="cb4-1666"><a href="#cb4-1666" aria-hidden="true" tabindex="-1"></a><span class="ss">                highlightActiveSection(); // Chamar inicialmente</span></span>
<span id="cb4-1667"><a href="#cb4-1667" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb4-1668"><a href="#cb4-1668" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb4-1669"><a href="#cb4-1669" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb4-1670"><a href="#cb4-1670" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb4-1671"><a href="#cb4-1671" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb4-1672"><a href="#cb4-1672" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb4-1673"><a href="#cb4-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1674"><a href="#cb4-1674" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_basic_html(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-1675"><a href="#cb4-1675" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;HTML b√°sico de √∫ltimo recurso com MathJax&quot;&quot;&quot;</span></span>
<span id="cb4-1676"><a href="#cb4-1676" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb4-1677"><a href="#cb4-1677" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1678"><a href="#cb4-1678" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb4-1679"><a href="#cb4-1679" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html&gt;</span></span>
<span id="cb4-1680"><a href="#cb4-1680" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb4-1681"><a href="#cb4-1681" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb4-1682"><a href="#cb4-1682" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb4-1683"><a href="#cb4-1683" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb4-1684"><a href="#cb4-1684" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-1685"><a href="#cb4-1685" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif; </span></span>
<span id="cb4-1686"><a href="#cb4-1686" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px; </span></span>
<span id="cb4-1687"><a href="#cb4-1687" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb4-1688"><a href="#cb4-1688" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb4-1689"><a href="#cb4-1689" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: none; /* Remove limita√ß√£o de largura - TELA COMPLETA */</span></span>
<span id="cb4-1690"><a href="#cb4-1690" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333 !important;</span></span>
<span id="cb4-1691"><a href="#cb4-1691" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1692"><a href="#cb4-1692" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-1693"><a href="#cb4-1693" aria-hidden="true" tabindex="-1"></a><span class="ss">            white-space: pre-wrap; </span></span>
<span id="cb4-1694"><a href="#cb4-1694" aria-hidden="true" tabindex="-1"></a><span class="ss">            word-wrap: break-word; </span></span>
<span id="cb4-1695"><a href="#cb4-1695" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb4-1696"><a href="#cb4-1696" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb4-1697"><a href="#cb4-1697" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 5px;</span></span>
<span id="cb4-1698"><a href="#cb4-1698" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb4-1699"><a href="#cb4-1699" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333 !important;</span></span>
<span id="cb4-1700"><a href="#cb4-1700" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1701"><a href="#cb4-1701" aria-hidden="true" tabindex="-1"></a><span class="ss">        code </span><span class="ch">{{</span></span>
<span id="cb4-1702"><a href="#cb4-1702" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333 !important;</span></span>
<span id="cb4-1703"><a href="#cb4-1703" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white !important;</span></span>
<span id="cb4-1704"><a href="#cb4-1704" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1705"><a href="#cb4-1705" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb4-1706"><a href="#cb4-1706" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb4-1707"><a href="#cb4-1707" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb4-1708"><a href="#cb4-1708" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb4-1709"><a href="#cb4-1709" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 30px;</span></span>
<span id="cb4-1710"><a href="#cb4-1710" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb4-1711"><a href="#cb4-1711" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb4-1712"><a href="#cb4-1712" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-1713"><a href="#cb4-1713" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb4-1714"><a href="#cb4-1714" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb4-1715"><a href="#cb4-1715" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb4-1716"><a href="#cb4-1716" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb4-1717"><a href="#cb4-1717" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb4-1718"><a href="#cb4-1718" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb4-1719"><a href="#cb4-1719" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true</span></span>
<span id="cb4-1720"><a href="#cb4-1720" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb4-1721"><a href="#cb4-1721" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb4-1722"><a href="#cb4-1722" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb4-1723"><a href="#cb4-1723" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb4-1724"><a href="#cb4-1724" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb4-1725"><a href="#cb4-1725" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb4-1726"><a href="#cb4-1726" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb4-1727"><a href="#cb4-1727" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;pre&gt;</span><span class="sc">{</span>content<span class="sc">}</span><span class="ss">&lt;/pre&gt;</span></span>
<span id="cb4-1728"><a href="#cb4-1728" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb4-1729"><a href="#cb4-1729" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb4-1730"><a href="#cb4-1730" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb4-1731"><a href="#cb4-1731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1732"><a href="#cb4-1732" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_html_robust(<span class="va">self</span>):</span>
<span id="cb4-1733"><a href="#cb4-1733" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;M√©todo ROBUSTO para convers√£o HTML - VERS√ÉO OTIMIZADA COM CACHE&quot;&quot;&quot;</span></span>
<span id="cb4-1734"><a href="#cb4-1734" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-1735"><a href="#cb4-1735" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] HTMLs seriam criados:&quot;</span>)</span>
<span id="cb4-1736"><a href="#cb4-1736" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb4-1737"><a href="#cb4-1737" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb4-1738"><a href="#cb4-1738" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.html&quot;</span></span>
<span id="cb4-1739"><a href="#cb4-1739" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üåê </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-1740"><a href="#cb4-1740" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-1741"><a href="#cb4-1741" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1742"><a href="#cb4-1742" aria-hidden="true" tabindex="-1"></a>        markdown_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;markdown&#39;</span>])</span>
<span id="cb4-1743"><a href="#cb4-1743" aria-hidden="true" tabindex="-1"></a>        html_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;html&#39;</span>])</span>
<span id="cb4-1744"><a href="#cb4-1744" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1745"><a href="#cb4-1745" aria-hidden="true" tabindex="-1"></a>        md_files <span class="op">=</span> <span class="bu">list</span>(markdown_folder.glob(<span class="st">&quot;*.md&quot;</span>))</span>
<span id="cb4-1746"><a href="#cb4-1746" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1747"><a href="#cb4-1747" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> md_files:</span>
<span id="cb4-1748"><a href="#cb4-1748" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Nenhum arquivo Markdown encontrado para convers√£o.&quot;</span>)</span>
<span id="cb4-1749"><a href="#cb4-1749" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-1750"><a href="#cb4-1750" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1751"><a href="#cb4-1751" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÑ Convertendo </span><span class="sc">{</span><span class="bu">len</span>(md_files)<span class="sc">}</span><span class="ss"> arquivos Markdown para HTML (OTIMIZADO COM CACHE)...&quot;</span>)</span>
<span id="cb4-1752"><a href="#cb4-1752" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1753"><a href="#cb4-1753" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verifica se Pandoc est√° dispon√≠vel</span></span>
<span id="cb4-1754"><a href="#cb4-1754" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-1755"><a href="#cb4-1755" aria-hidden="true" tabindex="-1"></a>            subprocess.run([<span class="st">&#39;pandoc&#39;</span>, <span class="st">&#39;--version&#39;</span>], capture_output<span class="op">=</span><span class="va">True</span>, check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-1756"><a href="#cb4-1756" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">True</span></span>
<span id="cb4-1757"><a href="#cb4-1757" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;‚úÖ Pandoc dispon√≠vel - usando convers√£o otimizada com cache&quot;</span>)</span>
<span id="cb4-1758"><a href="#cb4-1758" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb4-1759"><a href="#cb4-1759" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">False</span></span>
<span id="cb4-1760"><a href="#cb4-1760" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è Pandoc n√£o dispon√≠vel - usando fallback Python&quot;</span>)</span>
<span id="cb4-1761"><a href="#cb4-1761" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1762"><a href="#cb4-1762" aria-hidden="true" tabindex="-1"></a>        converted_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-1763"><a href="#cb4-1763" aria-hidden="true" tabindex="-1"></a>        failed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-1764"><a href="#cb4-1764" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1765"><a href="#cb4-1765" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> md_file <span class="kw">in</span> md_files:</span>
<span id="cb4-1766"><a href="#cb4-1766" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb4-1767"><a href="#cb4-1767" aria-hidden="true" tabindex="-1"></a>                html_file <span class="op">=</span> html_folder <span class="op">/</span> md_file.with_suffix(<span class="st">&#39;.html&#39;</span>).name</span>
<span id="cb4-1768"><a href="#cb4-1768" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-1769"><a href="#cb4-1769" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> html_file.exists():</span>
<span id="cb4-1770"><a href="#cb4-1770" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚è≠Ô∏è  J√° existe: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-1771"><a href="#cb4-1771" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-1772"><a href="#cb4-1772" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb4-1773"><a href="#cb4-1773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1774"><a href="#cb4-1774" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ Processando: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-1775"><a href="#cb4-1775" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-1776"><a href="#cb4-1776" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> pandoc_available:</span>
<span id="cb4-1777"><a href="#cb4-1777" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_pandoc_cached(<span class="bu">str</span>(md_file))</span>
<span id="cb4-1778"><a href="#cb4-1778" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb4-1779"><a href="#cb4-1779" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_fallback(<span class="bu">str</span>(md_file))</span>
<span id="cb4-1780"><a href="#cb4-1780" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-1781"><a href="#cb4-1781" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> html_content:</span>
<span id="cb4-1782"><a href="#cb4-1782" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(html_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-1783"><a href="#cb4-1783" aria-hidden="true" tabindex="-1"></a>                        f.write(html_content)</span>
<span id="cb4-1784"><a href="#cb4-1784" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-1785"><a href="#cb4-1785" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Criado: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-1786"><a href="#cb4-1786" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-1787"><a href="#cb4-1787" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb4-1788"><a href="#cb4-1788" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Falha na convers√£o: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-1789"><a href="#cb4-1789" aria-hidden="true" tabindex="-1"></a>                    failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-1790"><a href="#cb4-1790" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-1791"><a href="#cb4-1791" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-1792"><a href="#cb4-1792" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro em </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-1793"><a href="#cb4-1793" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(traceback.format_exc())</span>
<span id="cb4-1794"><a href="#cb4-1794" aria-hidden="true" tabindex="-1"></a>                failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-1795"><a href="#cb4-1795" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-1796"><a href="#cb4-1796" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä HTML: </span><span class="sc">{</span>converted_count<span class="sc">}</span><span class="ss"> arquivos criados, </span><span class="sc">{</span>failed_count<span class="sc">}</span><span class="ss"> falhas em &#39;</span><span class="sc">{</span>html_folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb4-1797"><a href="#cb4-1797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1798"><a href="#cb4-1798" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> categorize_conversation(<span class="va">self</span>, title: <span class="bu">str</span>, summary: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-1799"><a href="#cb4-1799" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Categoriza√ß√£o otimizada com express√µes regulares&quot;&quot;&quot;</span></span>
<span id="cb4-1800"><a href="#cb4-1800" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&quot;</span>.lower()</span>
<span id="cb4-1801"><a href="#cb4-1801" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1802"><a href="#cb4-1802" aria-hidden="true" tabindex="-1"></a>        patterns <span class="op">=</span> {</span>
<span id="cb4-1803"><a href="#cb4-1803" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Tecnologia&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">tecnologia</span><span class="cf">|</span><span class="vs">hardware</span><span class="cf">|</span><span class="vs">software</span><span class="cf">|</span><span class="vs">rede</span><span class="cf">|</span><span class="vs">internet</span><span class="cf">|</span><span class="vs">wifi</span><span class="cf">|</span><span class="vs">bluetooth</span><span class="cf">|</span><span class="pp">[45]</span><span class="vs">g</span><span class="cf">|</span><span class="vs">cloud</span><span class="cf">|</span><span class="vs">aws</span><span class="cf">|</span><span class="vs">azure</span><span class="cf">|</span><span class="vs">gcp</span><span class="cf">|</span><span class="vs">servidor</span><span class="cf">|</span><span class="vs">hosting</span><span class="cf">|</span><span class="vs">dom√≠nio</span><span class="cf">|</span><span class="vs">ssl</span><span class="cf">|</span><span class="vs">router</span><span class="cf">|</span><span class="vs">switch</span><span class="cf">|</span><span class="vs">firewall</span><span class="cf">|</span><span class="vs">iot</span><span class="cf">|</span><span class="vs">smartphone</span><span class="cf">|</span><span class="vs">tablet</span><span class="cf">|</span><span class="vs">navegador</span><span class="cf">|</span><span class="vs">browser</span><span class="cf">|</span><span class="vs">chrome</span><span class="cf">|</span><span class="vs">firefox</span><span class="cf">|</span><span class="vs">edge</span><span class="cf">|</span><span class="vs">safari</span><span class="cf">|</span><span class="vs">email</span><span class="cf">|</span><span class="vs">gmail</span><span class="cf">|</span><span class="vs">outlook</span><span class="cf">|</span><span class="vs">criptografia</span><span class="cf">|</span><span class="vs">seguran√ßa</span><span class="cf">|</span><span class="vs">ciberseguran√ßa</span><span class="cf">|</span><span class="vs">ransomware</span><span class="cf">|</span><span class="vs">phishing</span><span class="cf">|</span><span class="vs">autentica√ß√£o</span><span class="cf">|</span><span class="vs">2fa</span><span class="cf">|</span><span class="vs">biometria</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb4-1804"><a href="#cb4-1804" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Sa√∫de&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">sa√∫de</span><span class="cf">|</span><span class="vs">medicina</span><span class="cf">|</span><span class="vs">m√©dico</span><span class="cf">|</span><span class="vs">enfermagem</span><span class="cf">|</span><span class="vs">doen√ßa</span><span class="cf">|</span><span class="vs">v√≠rus</span><span class="cf">|</span><span class="vs">bact√©ria</span><span class="cf">|</span><span class="vs">vacina</span><span class="cf">|</span><span class="vs">covid</span><span class="cf">|</span><span class="vs">coronav√≠rus</span><span class="cf">|</span><span class="vs">gripe</span><span class="cf">|</span><span class="vs">febre</span><span class="cf">|</span><span class="vs">dor</span><span class="cf">|</span><span class="vs">an√°lise</span><span class="cf">|</span><span class="vs">exame</span><span class="cf">|</span><span class="vs">raio x</span><span class="cf">|</span><span class="vs">resson√¢ncia</span><span class="cf">|</span><span class="vs">hospital</span><span class="cf">|</span><span class="vs">cl√≠nica</span><span class="cf">|</span><span class="vs">farm√°cia</span><span class="cf">|</span><span class="vs">medicamento</span><span class="cf">|</span><span class="vs">rem√©dio</span><span class="cf">|</span><span class="vs">psicologia</span><span class="cf">|</span><span class="vs">terapia</span><span class="cf">|</span><span class="vs">bem-estar</span><span class="cf">|</span><span class="vs">nutri√ß√£o</span><span class="cf">|</span><span class="vs">dieta</span><span class="cf">|</span><span class="vs">exerc√≠cio</span><span class="cf">|</span><span class="vs">fitness</span><span class="cf">|</span><span class="vs">sono</span><span class="cf">|</span><span class="vs">sa√∫de mental</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb4-1805"><a href="#cb4-1805" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Programa√ß√£o&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">python</span><span class="cf">|</span><span class="vs">javascript</span><span class="cf">|</span><span class="vs">java</span><span class="cf">|</span><span class="vs">c</span><span class="ch">\+\+</span><span class="cf">|</span><span class="vs">c#</span><span class="cf">|</span><span class="vs">go</span><span class="cf">|</span><span class="vs">rust</span><span class="cf">|</span><span class="vs">lua</span><span class="cf">|</span><span class="vs">bash</span><span class="cf">|</span><span class="vs">script</span><span class="cf">|</span><span class="vs">debug</span><span class="cf">|</span><span class="vs">erro</span><span class="cf">|</span><span class="vs">conda</span><span class="cf">|</span><span class="vs">mamba</span><span class="cf">|</span><span class="vs">pandoc</span><span class="cf">|</span><span class="vs">msys2</span><span class="cf">|</span><span class="vs">spyder</span><span class="cf">|</span><span class="vs">jupyter</span><span class="cf">|</span><span class="vs">pip</span><span class="cf">|</span><span class="vs">venv</span><span class="cf">|</span><span class="vs">docker</span><span class="cf">|</span><span class="vs">git</span><span class="cf">|</span><span class="vs">github</span><span class="cf">|</span><span class="vs">vscode</span><span class="cf">|</span><span class="vs">ide</span><span class="cf">|</span><span class="vs">programa</span><span class="cf">|</span><span class="vs">c√≥digo</span><span class="cf">|</span><span class="vs">fun√ß√£o</span><span class="cf">|</span><span class="vs">classe</span><span class="cf">|</span><span class="vs">api</span><span class="cf">|</span><span class="vs">selenium</span><span class="cf">|</span><span class="vs">playwright</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb4-1806"><a href="#cb4-1806" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Sistemas&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">windows</span><span class="cf">|</span><span class="vs">linux</span><span class="cf">|</span><span class="vs">macos</span><span class="cf">|</span><span class="vs">so</span><span class="cf">|</span><span class="vs">sistema operacional</span><span class="cf">|</span><span class="vs">driver</span><span class="cf">|</span><span class="vs">registry</span><span class="cf">|</span><span class="vs">process</span><span class="cf">|</span><span class="vs">firewall</span><span class="cf">|</span><span class="vs">bios</span><span class="cf">|</span><span class="vs">boot</span><span class="cf">|</span><span class="vs">path</span><span class="cf">|</span><span class="vs">dll</span><span class="cf">|</span><span class="vs">exe</span><span class="cf">|</span><span class="vs">powershell</span><span class="cf">|</span><span class="vs">cmd</span><span class="cf">|</span><span class="vs">terminal</span><span class="cf">|</span><span class="vs">shell</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb4-1807"><a href="#cb4-1807" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;IA&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">ia</span><span class="cf">|</span><span class="vs">gpt</span><span class="cf">|</span><span class="vs">chatgpt</span><span class="cf">|</span><span class="vs">grok</span><span class="cf">|</span><span class="vs">qwen</span><span class="cf">|</span><span class="vs">deepseek</span><span class="cf">|</span><span class="vs">llm</span><span class="cf">|</span><span class="vs">modelo</span><span class="cf">|</span><span class="vs">prompt</span><span class="cf">|</span><span class="vs">token</span><span class="cf">|</span><span class="vs">embedding</span><span class="cf">|</span><span class="vs">fine-tune</span><span class="cf">|</span><span class="vs">neural</span><span class="cf">|</span><span class="vs">chatbot</span><span class="cf">|</span><span class="vs">intelig√™ncia artificial</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb4-1808"><a href="#cb4-1808" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Dados&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">dados</span><span class="cf">|</span><span class="vs">data</span><span class="cf">|</span><span class="vs">csv</span><span class="cf">|</span><span class="vs">json</span><span class="cf">|</span><span class="vs">pandas</span><span class="cf">|</span><span class="vs">numpy</span><span class="cf">|</span><span class="vs">excel</span><span class="cf">|</span><span class="vs">sql</span><span class="cf">|</span><span class="vs">banco</span><span class="cf">|</span><span class="vs">sqlite</span><span class="cf">|</span><span class="vs">postgres</span><span class="cf">|</span><span class="vs">visualiza√ß√£o</span><span class="cf">|</span><span class="vs">gr√°fico</span><span class="cf">|</span><span class="vs">tabela</span><span class="cf">|</span><span class="vs">an√°lise</span><span class="cf">|</span><span class="vs">etl</span><span class="cf">|</span><span class="vs">dashboard</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb4-1809"><a href="#cb4-1809" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Geral&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">geral</span><span class="cf">|</span><span class="vs">pergunta</span><span class="cf">|</span><span class="vs">ajuda</span><span class="cf">|</span><span class="vs">como fazer</span><span class="cf">|</span><span class="vs">explicar</span><span class="cf">|</span><span class="vs">resumo</span><span class="cf">|</span><span class="vs">tutorial b√°sico</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span></span>
<span id="cb4-1810"><a href="#cb4-1810" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-1811"><a href="#cb4-1811" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1812"><a href="#cb4-1812" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category, pattern <span class="kw">in</span> patterns.items():</span>
<span id="cb4-1813"><a href="#cb4-1813" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> re.search(pattern, text, re.IGNORECASE):</span>
<span id="cb4-1814"><a href="#cb4-1814" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> category</span>
<span id="cb4-1815"><a href="#cb4-1815" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-1816"><a href="#cb4-1816" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Outros&#39;</span></span>
<span id="cb4-1817"><a href="#cb4-1817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1818"><a href="#cb4-1818" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_timestamp_for_sorting(<span class="va">self</span>, timestamp) <span class="op">-&gt;</span> datetime:</span>
<span id="cb4-1819"><a href="#cb4-1819" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> timestamp:</span>
<span id="cb4-1820"><a href="#cb4-1820" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> datetime.<span class="bu">min</span></span>
<span id="cb4-1821"><a href="#cb4-1821" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1822"><a href="#cb4-1822" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-1823"><a href="#cb4-1823" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(timestamp, <span class="bu">str</span>):</span>
<span id="cb4-1824"><a href="#cb4-1824" aria-hidden="true" tabindex="-1"></a>                clean_ts <span class="op">=</span> timestamp.replace(<span class="st">&#39;T&#39;</span>, <span class="st">&#39; &#39;</span>).split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>].split(<span class="st">&#39;+&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb4-1825"><a href="#cb4-1825" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> clean_ts.endswith(<span class="st">&#39;Z&#39;</span>):</span>
<span id="cb4-1826"><a href="#cb4-1826" aria-hidden="true" tabindex="-1"></a>                    clean_ts <span class="op">=</span> clean_ts[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb4-1827"><a href="#cb4-1827" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> datetime.fromisoformat(clean_ts)</span>
<span id="cb4-1828"><a href="#cb4-1828" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(timestamp, (<span class="bu">int</span>, <span class="bu">float</span>)):</span>
<span id="cb4-1829"><a href="#cb4-1829" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> datetime.fromtimestamp(timestamp)</span>
<span id="cb4-1830"><a href="#cb4-1830" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb4-1831"><a href="#cb4-1831" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb4-1832"><a href="#cb4-1832" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1833"><a href="#cb4-1833" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> datetime.<span class="bu">min</span></span>
<span id="cb4-1834"><a href="#cb4-1834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1835"><a href="#cb4-1835" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> format_timestamp(<span class="va">self</span>, timestamp) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb4-1836"><a href="#cb4-1836" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> timestamp:</span>
<span id="cb4-1837"><a href="#cb4-1837" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb4-1838"><a href="#cb4-1838" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1839"><a href="#cb4-1839" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-1840"><a href="#cb4-1840" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(timestamp, (<span class="bu">int</span>, <span class="bu">float</span>)):</span>
<span id="cb4-1841"><a href="#cb4-1841" aria-hidden="true" tabindex="-1"></a>                dt <span class="op">=</span> datetime.fromtimestamp(timestamp)</span>
<span id="cb4-1842"><a href="#cb4-1842" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> dt.strftime(<span class="st">&#39;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S&#39;</span>)</span>
<span id="cb4-1843"><a href="#cb4-1843" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(timestamp, <span class="bu">str</span>):</span>
<span id="cb4-1844"><a href="#cb4-1844" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">&#39;T&#39;</span> <span class="kw">in</span> timestamp:</span>
<span id="cb4-1845"><a href="#cb4-1845" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> timestamp.replace(<span class="st">&#39;T&#39;</span>, <span class="st">&#39; &#39;</span>).split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb4-1846"><a href="#cb4-1846" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> timestamp</span>
<span id="cb4-1847"><a href="#cb4-1847" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb4-1848"><a href="#cb4-1848" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb4-1849"><a href="#cb4-1849" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1850"><a href="#cb4-1850" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">str</span>(timestamp)</span>
<span id="cb4-1851"><a href="#cb4-1851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1852"><a href="#cb4-1852" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_enhanced_markdown_content(<span class="va">self</span>, conversation: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-1853"><a href="#cb4-1853" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Gera conte√∫do Markdown com preserva√ß√£o total de formata√ß√£o e anexos&quot;&quot;&quot;</span></span>
<span id="cb4-1854"><a href="#cb4-1854" aria-hidden="true" tabindex="-1"></a>        lines <span class="op">=</span> [</span>
<span id="cb4-1855"><a href="#cb4-1855" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;# </span><span class="sc">{</span>conversation[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb4-1856"><a href="#cb4-1856" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb4-1857"><a href="#cb4-1857" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;## üìä Informa√ß√µes&quot;</span>,</span>
<span id="cb4-1858"><a href="#cb4-1858" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **N√∫mero:** #</span><span class="sc">{</span>conversation[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb4-1859"><a href="#cb4-1859" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Origem:** </span><span class="sc">{</span>conversation[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb4-1860"><a href="#cb4-1860" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Categoria:** </span><span class="sc">{</span>conversation[<span class="st">&#39;category&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb4-1861"><a href="#cb4-1861" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **ID:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;id&#39;</span>, <span class="st">&#39;N/A&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb4-1862"><a href="#cb4-1862" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Criada em:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> conversation<span class="sc">.</span>get(<span class="st">&#39;created_at&#39;</span>) <span class="kw">or</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb4-1863"><a href="#cb4-1863" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb4-1864"><a href="#cb4-1864" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1865"><a href="#cb4-1865" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> conversation.get(<span class="st">&#39;updated_at&#39;</span>):</span>
<span id="cb4-1866"><a href="#cb4-1866" aria-hidden="true" tabindex="-1"></a>            lines.append(<span class="ss">f&quot;- **Atualizada em:** </span><span class="sc">{</span>conversation[<span class="st">&#39;updated_at&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-1867"><a href="#cb4-1867" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1868"><a href="#cb4-1868" aria-hidden="true" tabindex="-1"></a>        lines.extend([</span>
<span id="cb4-1869"><a href="#cb4-1869" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Total de mensagens:** </span><span class="sc">{</span><span class="bu">len</span>(conversation[<span class="st">&#39;messages&#39;</span>])<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb4-1870"><a href="#cb4-1870" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Resumo:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;Sem resumo&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb4-1871"><a href="#cb4-1871" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb4-1872"><a href="#cb4-1872" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;---&quot;</span>,</span>
<span id="cb4-1873"><a href="#cb4-1873" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb4-1874"><a href="#cb4-1874" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;## üí¨ Conversa&quot;</span>,</span>
<span id="cb4-1875"><a href="#cb4-1875" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span></span>
<span id="cb4-1876"><a href="#cb4-1876" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb4-1877"><a href="#cb4-1877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1878"><a href="#cb4-1878" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, msg <span class="kw">in</span> <span class="bu">enumerate</span>(conversation[<span class="st">&#39;messages&#39;</span>], <span class="dv">1</span>):</span>
<span id="cb4-1879"><a href="#cb4-1879" aria-hidden="true" tabindex="-1"></a>            timestamp <span class="op">=</span> <span class="ss">f&quot; *(</span><span class="sc">{</span>msg[<span class="st">&#39;timestamp&#39;</span>]<span class="sc">}</span><span class="ss">)*&quot;</span> <span class="cf">if</span> msg[<span class="st">&#39;timestamp&#39;</span>] <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb4-1880"><a href="#cb4-1880" aria-hidden="true" tabindex="-1"></a>            model_info <span class="op">=</span> <span class="ss">f&quot; *[</span><span class="sc">{</span>msg<span class="sc">.</span>get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;&#39;</span>)<span class="sc">}</span><span class="ss">]*&quot;</span> <span class="cf">if</span> msg.get(<span class="st">&#39;model&#39;</span>) <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb4-1881"><a href="#cb4-1881" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1882"><a href="#cb4-1882" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Processar anexos se existirem</span></span>
<span id="cb4-1883"><a href="#cb4-1883" aria-hidden="true" tabindex="-1"></a>            processed_content, saved_files <span class="op">=</span> <span class="va">self</span>.extract_and_save_attachments(</span>
<span id="cb4-1884"><a href="#cb4-1884" aria-hidden="true" tabindex="-1"></a>                msg[<span class="st">&#39;content&#39;</span>], conversation[<span class="st">&#39;number&#39;</span>], j</span>
<span id="cb4-1885"><a href="#cb4-1885" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb4-1886"><a href="#cb4-1886" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1887"><a href="#cb4-1887" aria-hidden="true" tabindex="-1"></a>            preserved_content <span class="op">=</span> <span class="va">self</span>.preserve_special_content_enhanced(processed_content)</span>
<span id="cb4-1888"><a href="#cb4-1888" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1889"><a href="#cb4-1889" aria-hidden="true" tabindex="-1"></a>            lines.extend([</span>
<span id="cb4-1890"><a href="#cb4-1890" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;### </span><span class="sc">{</span>msg[<span class="st">&#39;author&#39;</span>]<span class="sc">}{</span>timestamp<span class="sc">}{</span>model_info<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb4-1891"><a href="#cb4-1891" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;&quot;</span>,</span>
<span id="cb4-1892"><a href="#cb4-1892" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;</span><span class="sc">{</span>preserved_content<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb4-1893"><a href="#cb4-1893" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;&quot;</span></span>
<span id="cb4-1894"><a href="#cb4-1894" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb4-1895"><a href="#cb4-1895" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1896"><a href="#cb4-1896" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> saved_files:</span>
<span id="cb4-1897"><a href="#cb4-1897" aria-hidden="true" tabindex="-1"></a>                lines.extend([</span>
<span id="cb4-1898"><a href="#cb4-1898" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;#### üìé Anexos&quot;</span>,</span>
<span id="cb4-1899"><a href="#cb4-1899" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;&quot;</span></span>
<span id="cb4-1900"><a href="#cb4-1900" aria-hidden="true" tabindex="-1"></a>                ])</span>
<span id="cb4-1901"><a href="#cb4-1901" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> file_path <span class="kw">in</span> saved_files:</span>
<span id="cb4-1902"><a href="#cb4-1902" aria-hidden="true" tabindex="-1"></a>                    lines.append(<span class="ss">f&quot;- `</span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">`&quot;</span>)</span>
<span id="cb4-1903"><a href="#cb4-1903" aria-hidden="true" tabindex="-1"></a>                lines.append(<span class="st">&quot;&quot;</span>)</span>
<span id="cb4-1904"><a href="#cb4-1904" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1905"><a href="#cb4-1905" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> j <span class="op">&lt;</span> <span class="bu">len</span>(conversation[<span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb4-1906"><a href="#cb4-1906" aria-hidden="true" tabindex="-1"></a>                lines.extend([<span class="st">&quot;---&quot;</span>, <span class="st">&quot;&quot;</span>])</span>
<span id="cb4-1907"><a href="#cb4-1907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1908"><a href="#cb4-1908" aria-hidden="true" tabindex="-1"></a>        lines.extend([</span>
<span id="cb4-1909"><a href="#cb4-1909" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;---&quot;</span>,</span>
<span id="cb4-1910"><a href="#cb4-1910" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb4-1911"><a href="#cb4-1911" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;*Conversa exportada do </span><span class="sc">{</span>conversation[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">*&quot;</span>,</span>
<span id="cb4-1912"><a href="#cb4-1912" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;*Processado em: </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">.</span>strftime(<span class="st">&#39;</span><span class="sc">%d</span><span class="st">/%m/%Y %H:%M&#39;</span>)<span class="sc">}</span><span class="ss">*&quot;</span></span>
<span id="cb4-1913"><a href="#cb4-1913" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb4-1914"><a href="#cb4-1914" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1915"><a href="#cb4-1915" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(lines)</span>
<span id="cb4-1916"><a href="#cb4-1916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1917"><a href="#cb4-1917" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_qwen_corrected(<span class="va">self</span>, path: Path):</span>
<span id="cb4-1918"><a href="#cb4-1918" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa Qwen3 com corre√ß√£o para content_list - VERS√ÉO CORRIGIDA&quot;&quot;&quot;</span></span>
<span id="cb4-1919"><a href="#cb4-1919" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-1920"><a href="#cb4-1920" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria Qwen3: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-1921"><a href="#cb4-1921" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-1922"><a href="#cb4-1922" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1923"><a href="#cb4-1923" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-1924"><a href="#cb4-1924" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-1925"><a href="#cb4-1925" aria-hidden="true" tabindex="-1"></a>                raw_data <span class="op">=</span> json.load(f)</span>
<span id="cb4-1926"><a href="#cb4-1926" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-1927"><a href="#cb4-1927" aria-hidden="true" tabindex="-1"></a>            <span class="co"># DEBUG: Salvar estrutura completa para an√°lise</span></span>
<span id="cb4-1928"><a href="#cb4-1928" aria-hidden="true" tabindex="-1"></a>            debug_file <span class="op">=</span> Path(<span class="st">&quot;qwen_debug_structure.json&quot;</span>)</span>
<span id="cb4-1929"><a href="#cb4-1929" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(debug_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-1930"><a href="#cb4-1930" aria-hidden="true" tabindex="-1"></a>                json.dump(raw_data, f, indent<span class="op">=</span><span class="dv">2</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-1931"><a href="#cb4-1931" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Estrutura Qwen salva em: </span><span class="sc">{</span>debug_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-1932"><a href="#cb4-1932" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1933"><a href="#cb4-1933" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extrair conversas</span></span>
<span id="cb4-1934"><a href="#cb4-1934" aria-hidden="true" tabindex="-1"></a>            conversations <span class="op">=</span> []</span>
<span id="cb4-1935"><a href="#cb4-1935" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1936"><a href="#cb4-1936" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;data&#39;</span> <span class="kw">in</span> raw_data <span class="kw">and</span> <span class="bu">isinstance</span>(raw_data[<span class="st">&#39;data&#39;</span>], <span class="bu">list</span>):</span>
<span id="cb4-1937"><a href="#cb4-1937" aria-hidden="true" tabindex="-1"></a>                conversations <span class="op">=</span> raw_data[<span class="st">&#39;data&#39;</span>]</span>
<span id="cb4-1938"><a href="#cb4-1938" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÅ Estrutura 1: </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas em &#39;data&#39;&quot;</span>)</span>
<span id="cb4-1939"><a href="#cb4-1939" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">list</span>):</span>
<span id="cb4-1940"><a href="#cb4-1940" aria-hidden="true" tabindex="-1"></a>                conversations <span class="op">=</span> raw_data</span>
<span id="cb4-1941"><a href="#cb4-1941" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÅ Estrutura 2: </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas na raiz&quot;</span>)</span>
<span id="cb4-1942"><a href="#cb4-1942" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb4-1943"><a href="#cb4-1943" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> key, value <span class="kw">in</span> raw_data.items():</span>
<span id="cb4-1944"><a href="#cb4-1944" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(value, <span class="bu">list</span>) <span class="kw">and</span> <span class="bu">len</span>(value) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb4-1945"><a href="#cb4-1945" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(value[<span class="dv">0</span>], <span class="bu">dict</span>) <span class="kw">and</span> <span class="bu">any</span>(k <span class="kw">in</span> value[<span class="dv">0</span>] <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">&#39;title&#39;</span>, <span class="st">&#39;chat&#39;</span>, <span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb4-1946"><a href="#cb4-1946" aria-hidden="true" tabindex="-1"></a>                            conversations <span class="op">=</span> value</span>
<span id="cb4-1947"><a href="#cb4-1947" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÅ Estrutura alternativa: </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas em &#39;</span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb4-1948"><a href="#cb4-1948" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">break</span></span>
<span id="cb4-1949"><a href="#cb4-1949" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1950"><a href="#cb4-1950" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> conversations:</span>
<span id="cb4-1951"><a href="#cb4-1951" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Nenhuma conversa encontrada no arquivo Qwen&quot;</span>)</span>
<span id="cb4-1952"><a href="#cb4-1952" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb4-1953"><a href="#cb4-1953" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-1954"><a href="#cb4-1954" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Qwen: encontradas </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb4-1955"><a href="#cb4-1955" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-1956"><a href="#cb4-1956" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1957"><a href="#cb4-1957" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(conversations):</span>
<span id="cb4-1958"><a href="#cb4-1958" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conv, <span class="bu">dict</span>):</span>
<span id="cb4-1959"><a href="#cb4-1959" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb4-1960"><a href="#cb4-1960" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-1961"><a href="#cb4-1961" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa Qwen </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb4-1962"><a href="#cb4-1962" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb4-1963"><a href="#cb4-1963" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-1964"><a href="#cb4-1964" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üîç Processando: &#39;</span><span class="sc">{</span>clean_title<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb4-1965"><a href="#cb4-1965" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-1966"><a href="#cb4-1966" aria-hidden="true" tabindex="-1"></a>                <span class="co"># EXTRA√á√ÉO CORRIGIDA - foco em content_list</span></span>
<span id="cb4-1967"><a href="#cb4-1967" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> <span class="va">self</span>._extract_qwen_messages_corrected(conv, clean_title, i)</span>
<span id="cb4-1968"><a href="#cb4-1968" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-1969"><a href="#cb4-1969" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb4-1970"><a href="#cb4-1970" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Ordenar mensagens por timestamp</span></span>
<span id="cb4-1971"><a href="#cb4-1971" aria-hidden="true" tabindex="-1"></a>                    messages.sort(key<span class="op">=</span><span class="kw">lambda</span> x: <span class="va">self</span>.parse_timestamp_for_sorting(x[<span class="st">&#39;timestamp&#39;</span>]))</span>
<span id="cb4-1972"><a href="#cb4-1972" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-1973"><a href="#cb4-1973" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb4-1974"><a href="#cb4-1974" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,</span>
<span id="cb4-1975"><a href="#cb4-1975" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;Qwen3&#39;</span>,</span>
<span id="cb4-1976"><a href="#cb4-1976" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;qwen_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb4-1977"><a href="#cb4-1977" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;created_at&#39;</span>)),</span>
<span id="cb4-1978"><a href="#cb4-1978" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;updated_at&#39;</span>)),</span>
<span id="cb4-1979"><a href="#cb4-1979" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb4-1980"><a href="#cb4-1980" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb4-1981"><a href="#cb4-1981" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="va">self</span>.categorize_conversation(clean_title, messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb4-1982"><a href="#cb4-1982" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb4-1983"><a href="#cb4-1983" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-1984"><a href="#cb4-1984" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;   ‚úÖ Adicionada: </span><span class="sc">{</span><span class="bu">len</span>(messages)<span class="sc">}</span><span class="ss"> mensagens&quot;</span>)</span>
<span id="cb4-1985"><a href="#cb4-1985" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb4-1986"><a href="#cb4-1986" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.warning(<span class="ss">f&quot;   ‚ùå Conversa </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: nenhuma mensagem extra√≠da&quot;</span>)</span>
<span id="cb4-1987"><a href="#cb4-1987" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-1988"><a href="#cb4-1988" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Qwen3: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb4-1989"><a href="#cb4-1989" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-1990"><a href="#cb4-1990" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-1991"><a href="#cb4-1991" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar Qwen3: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-1992"><a href="#cb4-1992" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(traceback.format_exc())</span>
<span id="cb4-1993"><a href="#cb4-1993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1994"><a href="#cb4-1994" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _extract_qwen_messages_corrected(<span class="va">self</span>, conv: Dict[<span class="bu">str</span>, Any], clean_title: <span class="bu">str</span>, conv_index: <span class="bu">int</span>) <span class="op">-&gt;</span> List[Dict[<span class="bu">str</span>, Any]]:</span>
<span id="cb4-1995"><a href="#cb4-1995" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Extrai mensagens do Qwen com corre√ß√£o para content_list&quot;&quot;&quot;</span></span>
<span id="cb4-1996"><a href="#cb4-1996" aria-hidden="true" tabindex="-1"></a>        all_messages <span class="op">=</span> []</span>
<span id="cb4-1997"><a href="#cb4-1997" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-1998"><a href="#cb4-1998" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ESTRAT√âGIA PRINCIPAL: Buscar em toda a estrutura por mensagens</span></span>
<span id="cb4-1999"><a href="#cb4-1999" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> extract_from_object(obj, path<span class="op">=</span><span class="st">&quot;&quot;</span>):</span>
<span id="cb4-2000"><a href="#cb4-2000" aria-hidden="true" tabindex="-1"></a>            messages_found <span class="op">=</span> []</span>
<span id="cb4-2001"><a href="#cb4-2001" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2002"><a href="#cb4-2002" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(obj, <span class="bu">dict</span>):</span>
<span id="cb4-2003"><a href="#cb4-2003" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Verificar se √© uma mensagem com content_list (CASO CORRIGIDO)</span></span>
<span id="cb4-2004"><a href="#cb4-2004" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>._is_qwen_message_with_content(obj):</span>
<span id="cb4-2005"><a href="#cb4-2005" aria-hidden="true" tabindex="-1"></a>                    message <span class="op">=</span> <span class="va">self</span>._create_message_from_qwen_object(obj, conv_index)</span>
<span id="cb4-2006"><a href="#cb4-2006" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> message:</span>
<span id="cb4-2007"><a href="#cb4-2007" aria-hidden="true" tabindex="-1"></a>                        messages_found.append(message)</span>
<span id="cb4-2008"><a href="#cb4-2008" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2009"><a href="#cb4-2009" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Buscar recursivamente</span></span>
<span id="cb4-2010"><a href="#cb4-2010" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> key, value <span class="kw">in</span> obj.items():</span>
<span id="cb4-2011"><a href="#cb4-2011" aria-hidden="true" tabindex="-1"></a>                    messages_found.extend(extract_from_object(value, <span class="ss">f&quot;</span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">&quot;</span>))</span>
<span id="cb4-2012"><a href="#cb4-2012" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-2013"><a href="#cb4-2013" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(obj, <span class="bu">list</span>):</span>
<span id="cb4-2014"><a href="#cb4-2014" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> item <span class="kw">in</span> obj:</span>
<span id="cb4-2015"><a href="#cb4-2015" aria-hidden="true" tabindex="-1"></a>                    messages_found.extend(extract_from_object(item, path))</span>
<span id="cb4-2016"><a href="#cb4-2016" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-2017"><a href="#cb4-2017" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> messages_found</span>
<span id="cb4-2018"><a href="#cb4-2018" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2019"><a href="#cb4-2019" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Aplicar extra√ß√£o recursiva</span></span>
<span id="cb4-2020"><a href="#cb4-2020" aria-hidden="true" tabindex="-1"></a>        all_messages <span class="op">=</span> extract_from_object(conv, <span class="st">&quot;root&quot;</span>)</span>
<span id="cb4-2021"><a href="#cb4-2021" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2022"><a href="#cb4-2022" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remover duplicatas</span></span>
<span id="cb4-2023"><a href="#cb4-2023" aria-hidden="true" tabindex="-1"></a>        unique_messages <span class="op">=</span> <span class="va">self</span>._remove_duplicate_messages(all_messages)</span>
<span id="cb4-2024"><a href="#cb4-2024" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2025"><a href="#cb4-2025" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(unique_messages) <span class="op">!=</span> <span class="bu">len</span>(all_messages):</span>
<span id="cb4-2026"><a href="#cb4-2026" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;         üîÑ Removidas </span><span class="sc">{</span><span class="bu">len</span>(all_messages) <span class="op">-</span> <span class="bu">len</span>(unique_messages)<span class="sc">}</span><span class="ss"> mensagens duplicadas&quot;</span>)</span>
<span id="cb4-2027"><a href="#cb4-2027" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2028"><a href="#cb4-2028" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> unique_messages</span>
<span id="cb4-2029"><a href="#cb4-2029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2030"><a href="#cb4-2030" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _is_qwen_message_with_content(<span class="va">self</span>, obj: Dict) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb4-2031"><a href="#cb4-2031" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Verifica se √© uma mensagem Qwen v√°lida (incluindo content_list)&quot;&quot;&quot;</span></span>
<span id="cb4-2032"><a href="#cb4-2032" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verificar campos b√°sicos de mensagem</span></span>
<span id="cb4-2033"><a href="#cb4-2033" aria-hidden="true" tabindex="-1"></a>        has_basic_structure <span class="op">=</span> (<span class="st">&#39;role&#39;</span> <span class="kw">in</span> obj <span class="kw">and</span> <span class="st">&#39;content&#39;</span> <span class="kw">in</span> obj)</span>
<span id="cb4-2034"><a href="#cb4-2034" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2035"><a href="#cb4-2035" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verificar se tem content_list (CORRE√á√ÉO DO PROBLEMA)</span></span>
<span id="cb4-2036"><a href="#cb4-2036" aria-hidden="true" tabindex="-1"></a>        has_content_list <span class="op">=</span> <span class="st">&#39;content_list&#39;</span> <span class="kw">in</span> obj <span class="kw">and</span> <span class="bu">isinstance</span>(obj[<span class="st">&#39;content_list&#39;</span>], <span class="bu">list</span>)</span>
<span id="cb4-2037"><a href="#cb4-2037" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2038"><a href="#cb4-2038" aria-hidden="true" tabindex="-1"></a>        <span class="co"># √â uma mensagem v√°lida se tiver estrutura b√°sica E (conte√∫do n√£o vazio OU content_list)</span></span>
<span id="cb4-2039"><a href="#cb4-2039" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (has_basic_structure <span class="kw">and</span> </span>
<span id="cb4-2040"><a href="#cb4-2040" aria-hidden="true" tabindex="-1"></a>                (obj.get(<span class="st">&#39;content&#39;</span>) <span class="kw">or</span> has_content_list) <span class="kw">and</span></span>
<span id="cb4-2041"><a href="#cb4-2041" aria-hidden="true" tabindex="-1"></a>                obj.get(<span class="st">&#39;role&#39;</span>) <span class="kw">in</span> [<span class="st">&#39;user&#39;</span>, <span class="st">&#39;assistant&#39;</span>])</span>
<span id="cb4-2042"><a href="#cb4-2042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2043"><a href="#cb4-2043" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_message_from_qwen_object(<span class="va">self</span>, obj: Dict, conv_index: <span class="bu">int</span>) <span class="op">-&gt;</span> Optional[Dict[<span class="bu">str</span>, Any]]:</span>
<span id="cb4-2044"><a href="#cb4-2044" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Cria uma mensagem a partir de um objeto Qwen, priorizando content_list&quot;&quot;&quot;</span></span>
<span id="cb4-2045"><a href="#cb4-2045" aria-hidden="true" tabindex="-1"></a>        role <span class="op">=</span> obj.get(<span class="st">&#39;role&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb4-2046"><a href="#cb4-2046" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> obj.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb4-2047"><a href="#cb4-2047" aria-hidden="true" tabindex="-1"></a>        content_list <span class="op">=</span> obj.get(<span class="st">&#39;content_list&#39;</span>, [])</span>
<span id="cb4-2048"><a href="#cb4-2048" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2049"><a href="#cb4-2049" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> role:</span>
<span id="cb4-2050"><a href="#cb4-2050" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb4-2051"><a href="#cb4-2051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2052"><a href="#cb4-2052" aria-hidden="true" tabindex="-1"></a>        <span class="co"># CORRE√á√ÉO PRINCIPAL: Priorizar content_list quando content estiver vazio</span></span>
<span id="cb4-2053"><a href="#cb4-2053" aria-hidden="true" tabindex="-1"></a>        final_content <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb4-2054"><a href="#cb4-2054" aria-hidden="true" tabindex="-1"></a>        saved_files <span class="op">=</span> []</span>
<span id="cb4-2055"><a href="#cb4-2055" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2056"><a href="#cb4-2056" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> content_list <span class="kw">and</span> <span class="bu">isinstance</span>(content_list, <span class="bu">list</span>):</span>
<span id="cb4-2057"><a href="#cb4-2057" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Processar content_list com anexos</span></span>
<span id="cb4-2058"><a href="#cb4-2058" aria-hidden="true" tabindex="-1"></a>            qwen_content, qwen_files <span class="op">=</span> <span class="va">self</span>.process_qwen_attachments(content_list, conv_index, <span class="bu">len</span>(<span class="va">self</span>.all_conversations))</span>
<span id="cb4-2059"><a href="#cb4-2059" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> qwen_content:</span>
<span id="cb4-2060"><a href="#cb4-2060" aria-hidden="true" tabindex="-1"></a>                final_content <span class="op">=</span> qwen_content</span>
<span id="cb4-2061"><a href="#cb4-2061" aria-hidden="true" tabindex="-1"></a>                saved_files.extend(qwen_files)</span>
<span id="cb4-2062"><a href="#cb4-2062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2063"><a href="#cb4-2063" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se content_list n√£o forneceu conte√∫do, usar o campo content tradicional</span></span>
<span id="cb4-2064"><a href="#cb4-2064" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> final_content <span class="kw">and</span> content:</span>
<span id="cb4-2065"><a href="#cb4-2065" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Processar anexos no conte√∫do tradicional</span></span>
<span id="cb4-2066"><a href="#cb4-2066" aria-hidden="true" tabindex="-1"></a>            processed_content, content_files <span class="op">=</span> <span class="va">self</span>.extract_and_save_attachments(</span>
<span id="cb4-2067"><a href="#cb4-2067" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(content), conv_index, <span class="bu">len</span>(<span class="va">self</span>.all_conversations)</span>
<span id="cb4-2068"><a href="#cb4-2068" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb4-2069"><a href="#cb4-2069" aria-hidden="true" tabindex="-1"></a>            final_content <span class="op">=</span> processed_content</span>
<span id="cb4-2070"><a href="#cb4-2070" aria-hidden="true" tabindex="-1"></a>            saved_files.extend(content_files)</span>
<span id="cb4-2071"><a href="#cb4-2071" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2072"><a href="#cb4-2072" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se ainda n√£o tem conte√∫do, pular</span></span>
<span id="cb4-2073"><a href="#cb4-2073" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> final_content <span class="kw">or</span> final_content <span class="op">==</span> <span class="st">&#39;null&#39;</span>:</span>
<span id="cb4-2074"><a href="#cb4-2074" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb4-2075"><a href="#cb4-2075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2076"><a href="#cb4-2076" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Determinar autor</span></span>
<span id="cb4-2077"><a href="#cb4-2077" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> role <span class="op">==</span> <span class="st">&#39;user&#39;</span>:</span>
<span id="cb4-2078"><a href="#cb4-2078" aria-hidden="true" tabindex="-1"></a>            author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb4-2079"><a href="#cb4-2079" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> role <span class="op">==</span> <span class="st">&#39;assistant&#39;</span>:</span>
<span id="cb4-2080"><a href="#cb4-2080" aria-hidden="true" tabindex="-1"></a>            author <span class="op">=</span> <span class="st">&quot;ü§ñ Qwen3&quot;</span></span>
<span id="cb4-2081"><a href="#cb4-2081" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb4-2082"><a href="#cb4-2082" aria-hidden="true" tabindex="-1"></a>            author <span class="op">=</span> <span class="ss">f&quot;üîπ </span><span class="sc">{</span>role<span class="sc">.</span>title()<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-2083"><a href="#cb4-2083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2084"><a href="#cb4-2084" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Processar conte√∫do especial</span></span>
<span id="cb4-2085"><a href="#cb4-2085" aria-hidden="true" tabindex="-1"></a>        final_content <span class="op">=</span> <span class="va">self</span>.preserve_special_content_enhanced(final_content)</span>
<span id="cb4-2086"><a href="#cb4-2086" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2087"><a href="#cb4-2087" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb4-2088"><a href="#cb4-2088" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb4-2089"><a href="#cb4-2089" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb4-2090"><a href="#cb4-2090" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;content&#39;</span>: final_content,</span>
<span id="cb4-2091"><a href="#cb4-2091" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(obj.get(<span class="st">&#39;created_at&#39;</span>)),</span>
<span id="cb4-2092"><a href="#cb4-2092" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;model&#39;</span>: obj.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;Qwen3&#39;</span>),</span>
<span id="cb4-2093"><a href="#cb4-2093" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;attachments&#39;</span>: saved_files</span>
<span id="cb4-2094"><a href="#cb4-2094" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-2095"><a href="#cb4-2095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2096"><a href="#cb4-2096" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _remove_duplicate_messages(<span class="va">self</span>, messages: List[Dict[<span class="bu">str</span>, Any]]) <span class="op">-&gt;</span> List[Dict[<span class="bu">str</span>, Any]]:</span>
<span id="cb4-2097"><a href="#cb4-2097" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Remove mensagens duplicadas baseadas no conte√∫do&quot;&quot;&quot;</span></span>
<span id="cb4-2098"><a href="#cb4-2098" aria-hidden="true" tabindex="-1"></a>        seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb4-2099"><a href="#cb4-2099" aria-hidden="true" tabindex="-1"></a>        unique_messages <span class="op">=</span> []</span>
<span id="cb4-2100"><a href="#cb4-2100" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2101"><a href="#cb4-2101" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> msg <span class="kw">in</span> messages:</span>
<span id="cb4-2102"><a href="#cb4-2102" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Criar uma chave √∫nica baseada no conte√∫do e timestamp</span></span>
<span id="cb4-2103"><a href="#cb4-2103" aria-hidden="true" tabindex="-1"></a>            content_key <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>msg[<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>msg[<span class="st">&#39;timestamp&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-2104"><a href="#cb4-2104" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2105"><a href="#cb4-2105" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> content_key <span class="kw">not</span> <span class="kw">in</span> seen:</span>
<span id="cb4-2106"><a href="#cb4-2106" aria-hidden="true" tabindex="-1"></a>                seen.add(content_key)</span>
<span id="cb4-2107"><a href="#cb4-2107" aria-hidden="true" tabindex="-1"></a>                unique_messages.append(msg)</span>
<span id="cb4-2108"><a href="#cb4-2108" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2109"><a href="#cb4-2109" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> unique_messages</span>
<span id="cb4-2110"><a href="#cb4-2110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2111"><a href="#cb4-2111" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_chatgpt(<span class="va">self</span>, path: Path):</span>
<span id="cb4-2112"><a href="#cb4-2112" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do ChatGPT&quot;&quot;&quot;</span></span>
<span id="cb4-2113"><a href="#cb4-2113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-2114"><a href="#cb4-2114" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria ChatGPT: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-2115"><a href="#cb4-2115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-2116"><a href="#cb4-2116" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2117"><a href="#cb4-2117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-2118"><a href="#cb4-2118" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;chatgpt_&quot;</span>)</span>
<span id="cb4-2119"><a href="#cb4-2119" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb4-2120"><a href="#cb4-2120" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb4-2121"><a href="#cb4-2121" aria-hidden="true" tabindex="-1"></a>            convs_path <span class="op">=</span> Path(temp_dir) <span class="op">/</span> <span class="st">&quot;conversations.json&quot;</span></span>
<span id="cb4-2122"><a href="#cb4-2122" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> convs_path.exists():</span>
<span id="cb4-2123"><a href="#cb4-2123" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå ChatGPT: conversations.json n√£o encontrado.&quot;</span>)</span>
<span id="cb4-2124"><a href="#cb4-2124" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb4-2125"><a href="#cb4-2125" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2126"><a href="#cb4-2126" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(convs_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-2127"><a href="#cb4-2127" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.load(f)</span>
<span id="cb4-2128"><a href="#cb4-2128" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2129"><a href="#cb4-2129" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">list</span>):</span>
<span id="cb4-2130"><a href="#cb4-2130" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  ChatGPT: estrutura inesperada.&quot;</span>)</span>
<span id="cb4-2131"><a href="#cb4-2131" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb4-2132"><a href="#cb4-2132" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2133"><a href="#cb4-2133" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç ChatGPT: encontradas </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb4-2134"><a href="#cb4-2134" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-2135"><a href="#cb4-2135" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2136"><a href="#cb4-2136" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb4-2137"><a href="#cb4-2137" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa ChatGPT </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb4-2138"><a href="#cb4-2138" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb4-2139"><a href="#cb4-2139" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb4-2140"><a href="#cb4-2140" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2141"><a href="#cb4-2141" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb4-2142"><a href="#cb4-2142" aria-hidden="true" tabindex="-1"></a>                mapping <span class="op">=</span> conv.get(<span class="st">&#39;mapping&#39;</span>, {})</span>
<span id="cb4-2143"><a href="#cb4-2143" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2144"><a href="#cb4-2144" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> msg_id, node <span class="kw">in</span> mapping.items():</span>
<span id="cb4-2145"><a href="#cb4-2145" aria-hidden="true" tabindex="-1"></a>                    msg_data <span class="op">=</span> node.get(<span class="st">&#39;message&#39;</span>)</span>
<span id="cb4-2146"><a href="#cb4-2146" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> msg_data <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(msg_data, <span class="bu">dict</span>):</span>
<span id="cb4-2147"><a href="#cb4-2147" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb4-2148"><a href="#cb4-2148" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb4-2149"><a href="#cb4-2149" aria-hidden="true" tabindex="-1"></a>                    author_role <span class="op">=</span> msg_data.get(<span class="st">&#39;author&#39;</span>, {}).get(<span class="st">&#39;role&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb4-2150"><a href="#cb4-2150" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> author_role <span class="op">==</span> <span class="st">&#39;user&#39;</span>:</span>
<span id="cb4-2151"><a href="#cb4-2151" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb4-2152"><a href="#cb4-2152" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;user&#39;</span></span>
<span id="cb4-2153"><a href="#cb4-2153" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> author_role <span class="op">==</span> <span class="st">&#39;assistant&#39;</span>:</span>
<span id="cb4-2154"><a href="#cb4-2154" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ ChatGPT&quot;</span></span>
<span id="cb4-2155"><a href="#cb4-2155" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;assistant&#39;</span></span>
<span id="cb4-2156"><a href="#cb4-2156" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb4-2157"><a href="#cb4-2157" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb4-2158"><a href="#cb4-2158" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb4-2159"><a href="#cb4-2159" aria-hidden="true" tabindex="-1"></a>                    content_parts <span class="op">=</span> []</span>
<span id="cb4-2160"><a href="#cb4-2160" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> part <span class="kw">in</span> msg_data.get(<span class="st">&#39;content&#39;</span>, {}).get(<span class="st">&#39;parts&#39;</span>, []):</span>
<span id="cb4-2161"><a href="#cb4-2161" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(part, <span class="bu">str</span>):</span>
<span id="cb4-2162"><a href="#cb4-2162" aria-hidden="true" tabindex="-1"></a>                            content_parts.append(part)</span>
<span id="cb4-2163"><a href="#cb4-2163" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(content_parts).strip()</span>
<span id="cb4-2164"><a href="#cb4-2164" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-2165"><a href="#cb4-2165" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Processar anexos</span></span>
<span id="cb4-2166"><a href="#cb4-2166" aria-hidden="true" tabindex="-1"></a>                    processed_content, saved_files <span class="op">=</span> <span class="va">self</span>.extract_and_save_attachments(content, i, <span class="bu">len</span>(messages))</span>
<span id="cb4-2167"><a href="#cb4-2167" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content_enhanced(processed_content)</span>
<span id="cb4-2168"><a href="#cb4-2168" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-2169"><a href="#cb4-2169" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb4-2170"><a href="#cb4-2170" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb4-2171"><a href="#cb4-2171" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb4-2172"><a href="#cb4-2172" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb4-2173"><a href="#cb4-2173" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb4-2174"><a href="#cb4-2174" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb4-2175"><a href="#cb4-2175" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb4-2176"><a href="#cb4-2176" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(msg_data.get(<span class="st">&#39;create_time&#39;</span>)),</span>
<span id="cb4-2177"><a href="#cb4-2177" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg_data.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;ChatGPT&#39;</span>),</span>
<span id="cb4-2178"><a href="#cb4-2178" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;attachments&#39;</span>: saved_files</span>
<span id="cb4-2179"><a href="#cb4-2179" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb4-2180"><a href="#cb4-2180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2181"><a href="#cb4-2181" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb4-2182"><a href="#cb4-2182" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb4-2183"><a href="#cb4-2183" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb4-2184"><a href="#cb4-2184" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;ChatGPT&#39;</span>,</span>
<span id="cb4-2185"><a href="#cb4-2185" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;chatgpt_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb4-2186"><a href="#cb4-2186" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;create_time&#39;</span>)),</span>
<span id="cb4-2187"><a href="#cb4-2187" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;update_time&#39;</span>)),</span>
<span id="cb4-2188"><a href="#cb4-2188" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb4-2189"><a href="#cb4-2189" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb4-2190"><a href="#cb4-2190" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb4-2191"><a href="#cb4-2191" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb4-2192"><a href="#cb4-2192" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-2193"><a href="#cb4-2193" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-2194"><a href="#cb4-2194" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ ChatGPT: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb4-2195"><a href="#cb4-2195" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2196"><a href="#cb4-2196" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-2197"><a href="#cb4-2197" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar ChatGPT: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-2198"><a href="#cb4-2198" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-2199"><a href="#cb4-2199" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb4-2200"><a href="#cb4-2200" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb4-2201"><a href="#cb4-2201" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb4-2202"><a href="#cb4-2202" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-2203"><a href="#cb4-2203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2204"><a href="#cb4-2204" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_deepseek(<span class="va">self</span>, path: Path):</span>
<span id="cb4-2205"><a href="#cb4-2205" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do DeepSeek&quot;&quot;&quot;</span></span>
<span id="cb4-2206"><a href="#cb4-2206" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-2207"><a href="#cb4-2207" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria DeepSeek: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-2208"><a href="#cb4-2208" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-2209"><a href="#cb4-2209" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2210"><a href="#cb4-2210" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-2211"><a href="#cb4-2211" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;deepseek_&quot;</span>)</span>
<span id="cb4-2212"><a href="#cb4-2212" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb4-2213"><a href="#cb4-2213" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb4-2214"><a href="#cb4-2214" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2215"><a href="#cb4-2215" aria-hidden="true" tabindex="-1"></a>            convs_path <span class="op">=</span> Path(temp_dir) <span class="op">/</span> <span class="st">&quot;conversations.json&quot;</span></span>
<span id="cb4-2216"><a href="#cb4-2216" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> convs_path.exists():</span>
<span id="cb4-2217"><a href="#cb4-2217" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå DeepSeek: conversations.json n√£o encontrado.&quot;</span>)</span>
<span id="cb4-2218"><a href="#cb4-2218" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb4-2219"><a href="#cb4-2219" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2220"><a href="#cb4-2220" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(convs_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-2221"><a href="#cb4-2221" aria-hidden="true" tabindex="-1"></a>                raw_data <span class="op">=</span> json.load(f)</span>
<span id="cb4-2222"><a href="#cb4-2222" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2223"><a href="#cb4-2223" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">list</span>):</span>
<span id="cb4-2224"><a href="#cb4-2224" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> raw_data</span>
<span id="cb4-2225"><a href="#cb4-2225" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;data&#39;</span> <span class="kw">in</span> raw_data:</span>
<span id="cb4-2226"><a href="#cb4-2226" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> raw_data[<span class="st">&#39;data&#39;</span>]</span>
<span id="cb4-2227"><a href="#cb4-2227" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb4-2228"><a href="#cb4-2228" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  DeepSeek: estrutura inesperada.&quot;</span>)</span>
<span id="cb4-2229"><a href="#cb4-2229" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb4-2230"><a href="#cb4-2230" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2231"><a href="#cb4-2231" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">list</span>):</span>
<span id="cb4-2232"><a href="#cb4-2232" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  DeepSeek: &#39;data&#39; n√£o √© uma lista.&quot;</span>)</span>
<span id="cb4-2233"><a href="#cb4-2233" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb4-2234"><a href="#cb4-2234" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2235"><a href="#cb4-2235" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç DeepSeek: encontradas </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb4-2236"><a href="#cb4-2236" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-2237"><a href="#cb4-2237" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2238"><a href="#cb4-2238" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb4-2239"><a href="#cb4-2239" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa DeepSeek </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb4-2240"><a href="#cb4-2240" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb4-2241"><a href="#cb4-2241" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb4-2242"><a href="#cb4-2242" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2243"><a href="#cb4-2243" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb4-2244"><a href="#cb4-2244" aria-hidden="true" tabindex="-1"></a>                mapping <span class="op">=</span> conv.get(<span class="st">&#39;mapping&#39;</span>, {})</span>
<span id="cb4-2245"><a href="#cb4-2245" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2246"><a href="#cb4-2246" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> node_id, node <span class="kw">in</span> mapping.items():</span>
<span id="cb4-2247"><a href="#cb4-2247" aria-hidden="true" tabindex="-1"></a>                    msg_data <span class="op">=</span> node.get(<span class="st">&#39;message&#39;</span>)</span>
<span id="cb4-2248"><a href="#cb4-2248" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> msg_data <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(msg_data, <span class="bu">dict</span>):</span>
<span id="cb4-2249"><a href="#cb4-2249" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb4-2250"><a href="#cb4-2250" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb4-2251"><a href="#cb4-2251" aria-hidden="true" tabindex="-1"></a>                    fragments <span class="op">=</span> msg_data.get(<span class="st">&#39;fragments&#39;</span>, [])</span>
<span id="cb4-2252"><a href="#cb4-2252" aria-hidden="true" tabindex="-1"></a>                    content_parts <span class="op">=</span> []</span>
<span id="cb4-2253"><a href="#cb4-2253" aria-hidden="true" tabindex="-1"></a>                    msg_type <span class="op">=</span> <span class="va">None</span></span>
<span id="cb4-2254"><a href="#cb4-2254" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-2255"><a href="#cb4-2255" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> frag <span class="kw">in</span> fragments:</span>
<span id="cb4-2256"><a href="#cb4-2256" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(frag, <span class="bu">dict</span>):</span>
<span id="cb4-2257"><a href="#cb4-2257" aria-hidden="true" tabindex="-1"></a>                            frag_type <span class="op">=</span> frag.get(<span class="st">&#39;type&#39;</span>, <span class="st">&#39;&#39;</span>).upper()</span>
<span id="cb4-2258"><a href="#cb4-2258" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> frag_type <span class="kw">in</span> (<span class="st">&#39;REQUEST&#39;</span>, <span class="st">&#39;RESPONSE&#39;</span>):</span>
<span id="cb4-2259"><a href="#cb4-2259" aria-hidden="true" tabindex="-1"></a>                                msg_type <span class="op">=</span> frag_type</span>
<span id="cb4-2260"><a href="#cb4-2260" aria-hidden="true" tabindex="-1"></a>                            text <span class="op">=</span> frag.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb4-2261"><a href="#cb4-2261" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> text:</span>
<span id="cb4-2262"><a href="#cb4-2262" aria-hidden="true" tabindex="-1"></a>                                content_parts.append(text)</span>
<span id="cb4-2263"><a href="#cb4-2263" aria-hidden="true" tabindex="-1"></a>                            content <span class="op">=</span> frag.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb4-2264"><a href="#cb4-2264" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> content:</span>
<span id="cb4-2265"><a href="#cb4-2265" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> <span class="bu">isinstance</span>(content, <span class="bu">list</span>):</span>
<span id="cb4-2266"><a href="#cb4-2266" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">for</span> item <span class="kw">in</span> content:</span>
<span id="cb4-2267"><a href="#cb4-2267" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">if</span> <span class="bu">isinstance</span>(item, <span class="bu">str</span>):</span>
<span id="cb4-2268"><a href="#cb4-2268" aria-hidden="true" tabindex="-1"></a>                                            content_parts.append(item)</span>
<span id="cb4-2269"><a href="#cb4-2269" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">elif</span> <span class="bu">isinstance</span>(item, <span class="bu">dict</span>):</span>
<span id="cb4-2270"><a href="#cb4-2270" aria-hidden="true" tabindex="-1"></a>                                            item_text <span class="op">=</span> item.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb4-2271"><a href="#cb4-2271" aria-hidden="true" tabindex="-1"></a>                                            <span class="cf">if</span> item_text:</span>
<span id="cb4-2272"><a href="#cb4-2272" aria-hidden="true" tabindex="-1"></a>                                                content_parts.append(<span class="bu">str</span>(item_text))</span>
<span id="cb4-2273"><a href="#cb4-2273" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">else</span>:</span>
<span id="cb4-2274"><a href="#cb4-2274" aria-hidden="true" tabindex="-1"></a>                                    content_parts.append(<span class="bu">str</span>(content))</span>
<span id="cb4-2275"><a href="#cb4-2275" aria-hidden="true" tabindex="-1"></a>                                    </span>
<span id="cb4-2276"><a href="#cb4-2276" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="st">&#39; &#39;</span>.join(content_parts).strip()</span>
<span id="cb4-2277"><a href="#cb4-2277" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-2278"><a href="#cb4-2278" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Processar anexos</span></span>
<span id="cb4-2279"><a href="#cb4-2279" aria-hidden="true" tabindex="-1"></a>                    processed_content, saved_files <span class="op">=</span> <span class="va">self</span>.extract_and_save_attachments(content, i, <span class="bu">len</span>(messages))</span>
<span id="cb4-2280"><a href="#cb4-2280" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content_enhanced(processed_content)</span>
<span id="cb4-2281"><a href="#cb4-2281" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-2282"><a href="#cb4-2282" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb4-2283"><a href="#cb4-2283" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb4-2284"><a href="#cb4-2284" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb4-2285"><a href="#cb4-2285" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> msg_type <span class="op">==</span> <span class="st">&#39;REQUEST&#39;</span>:</span>
<span id="cb4-2286"><a href="#cb4-2286" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb4-2287"><a href="#cb4-2287" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;user&#39;</span></span>
<span id="cb4-2288"><a href="#cb4-2288" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb4-2289"><a href="#cb4-2289" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ DeepSeek&quot;</span></span>
<span id="cb4-2290"><a href="#cb4-2290" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;assistant&#39;</span></span>
<span id="cb4-2291"><a href="#cb4-2291" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb4-2292"><a href="#cb4-2292" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb4-2293"><a href="#cb4-2293" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb4-2294"><a href="#cb4-2294" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb4-2295"><a href="#cb4-2295" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb4-2296"><a href="#cb4-2296" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(msg_data.get(<span class="st">&#39;inserted_at&#39;</span>)),</span>
<span id="cb4-2297"><a href="#cb4-2297" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg_data.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;DeepSeek&#39;</span>),</span>
<span id="cb4-2298"><a href="#cb4-2298" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;attachments&#39;</span>: saved_files</span>
<span id="cb4-2299"><a href="#cb4-2299" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb4-2300"><a href="#cb4-2300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2301"><a href="#cb4-2301" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb4-2302"><a href="#cb4-2302" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb4-2303"><a href="#cb4-2303" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb4-2304"><a href="#cb4-2304" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;DeepSeek&#39;</span>,</span>
<span id="cb4-2305"><a href="#cb4-2305" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;deepseek_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb4-2306"><a href="#cb4-2306" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;inserted_at&#39;</span>)),</span>
<span id="cb4-2307"><a href="#cb4-2307" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;updated_at&#39;</span>)),</span>
<span id="cb4-2308"><a href="#cb4-2308" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb4-2309"><a href="#cb4-2309" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb4-2310"><a href="#cb4-2310" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb4-2311"><a href="#cb4-2311" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb4-2312"><a href="#cb4-2312" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-2313"><a href="#cb4-2313" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-2314"><a href="#cb4-2314" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ DeepSeek: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb4-2315"><a href="#cb4-2315" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2316"><a href="#cb4-2316" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-2317"><a href="#cb4-2317" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar DeepSeek: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-2318"><a href="#cb4-2318" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-2319"><a href="#cb4-2319" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb4-2320"><a href="#cb4-2320" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb4-2321"><a href="#cb4-2321" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb4-2322"><a href="#cb4-2322" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-2323"><a href="#cb4-2323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2324"><a href="#cb4-2324" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_grok(<span class="va">self</span>, path: Path):</span>
<span id="cb4-2325"><a href="#cb4-2325" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do Grok&quot;&quot;&quot;</span></span>
<span id="cb4-2326"><a href="#cb4-2326" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-2327"><a href="#cb4-2327" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria Grok: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-2328"><a href="#cb4-2328" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-2329"><a href="#cb4-2329" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2330"><a href="#cb4-2330" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-2331"><a href="#cb4-2331" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;grok_&quot;</span>)</span>
<span id="cb4-2332"><a href="#cb4-2332" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb4-2333"><a href="#cb4-2333" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb4-2334"><a href="#cb4-2334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2335"><a href="#cb4-2335" aria-hidden="true" tabindex="-1"></a>            target_file <span class="op">=</span> <span class="va">None</span></span>
<span id="cb4-2336"><a href="#cb4-2336" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> root, _, files <span class="kw">in</span> os.walk(temp_dir):</span>
<span id="cb4-2337"><a href="#cb4-2337" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb4-2338"><a href="#cb4-2338" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">file</span> <span class="op">==</span> <span class="st">&quot;prod-grok-backend.json&quot;</span>:</span>
<span id="cb4-2339"><a href="#cb4-2339" aria-hidden="true" tabindex="-1"></a>                        target_file <span class="op">=</span> Path(root) <span class="op">/</span> <span class="bu">file</span></span>
<span id="cb4-2340"><a href="#cb4-2340" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb4-2341"><a href="#cb4-2341" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> target_file:</span>
<span id="cb4-2342"><a href="#cb4-2342" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb4-2343"><a href="#cb4-2343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2344"><a href="#cb4-2344" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> target_file:</span>
<span id="cb4-2345"><a href="#cb4-2345" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: ficheiro &#39;prod-grok-backend.json&#39; n√£o encontrado no ZIP.&quot;</span>)</span>
<span id="cb4-2346"><a href="#cb4-2346" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb4-2347"><a href="#cb4-2347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2348"><a href="#cb4-2348" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Grok: carregando </span><span class="sc">{</span>target_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb4-2349"><a href="#cb4-2349" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(target_file, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-2350"><a href="#cb4-2350" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.load(f)</span>
<span id="cb4-2351"><a href="#cb4-2351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2352"><a href="#cb4-2352" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">dict</span>) <span class="kw">or</span> <span class="st">&#39;conversations&#39;</span> <span class="kw">not</span> <span class="kw">in</span> data:</span>
<span id="cb4-2353"><a href="#cb4-2353" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: estrutura inesperada ‚Äî chave &#39;conversations&#39; n√£o encontrada.&quot;</span>)</span>
<span id="cb4-2354"><a href="#cb4-2354" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb4-2355"><a href="#cb4-2355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2356"><a href="#cb4-2356" aria-hidden="true" tabindex="-1"></a>            conversations_list <span class="op">=</span> data[<span class="st">&#39;conversations&#39;</span>]</span>
<span id="cb4-2357"><a href="#cb4-2357" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conversations_list, <span class="bu">list</span>):</span>
<span id="cb4-2358"><a href="#cb4-2358" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: &#39;conversations&#39; n√£o √© uma lista.&quot;</span>)</span>
<span id="cb4-2359"><a href="#cb4-2359" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb4-2360"><a href="#cb4-2360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2361"><a href="#cb4-2361" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä Grok: encontradas </span><span class="sc">{</span><span class="bu">len</span>(conversations_list)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb4-2362"><a href="#cb4-2362" aria-hidden="true" tabindex="-1"></a>            total_convs <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-2363"><a href="#cb4-2363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2364"><a href="#cb4-2364" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> item <span class="kw">in</span> conversations_list:</span>
<span id="cb4-2365"><a href="#cb4-2365" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(item, <span class="bu">dict</span>):</span>
<span id="cb4-2366"><a href="#cb4-2366" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb4-2367"><a href="#cb4-2367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2368"><a href="#cb4-2368" aria-hidden="true" tabindex="-1"></a>                conv_meta <span class="op">=</span> item.get(<span class="st">&#39;conversation&#39;</span>)</span>
<span id="cb4-2369"><a href="#cb4-2369" aria-hidden="true" tabindex="-1"></a>                responses <span class="op">=</span> item.get(<span class="st">&#39;responses&#39;</span>, [])</span>
<span id="cb4-2370"><a href="#cb4-2370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2371"><a href="#cb4-2371" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conv_meta, <span class="bu">dict</span>) <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(responses, <span class="bu">list</span>) <span class="kw">or</span> <span class="kw">not</span> responses:</span>
<span id="cb4-2372"><a href="#cb4-2372" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb4-2373"><a href="#cb4-2373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2374"><a href="#cb4-2374" aria-hidden="true" tabindex="-1"></a>                conv_id <span class="op">=</span> conv_meta.get(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb4-2375"><a href="#cb4-2375" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> conv_id:</span>
<span id="cb4-2376"><a href="#cb4-2376" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb4-2377"><a href="#cb4-2377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2378"><a href="#cb4-2378" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv_meta.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&quot;Conversa Grok </span><span class="sc">{</span>total_convs <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-2379"><a href="#cb4-2379" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb4-2380"><a href="#cb4-2380" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb4-2381"><a href="#cb4-2381" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2382"><a href="#cb4-2382" aria-hidden="true" tabindex="-1"></a>                create_time_str <span class="op">=</span> conv_meta.get(<span class="st">&#39;create_time&#39;</span>)</span>
<span id="cb4-2383"><a href="#cb4-2383" aria-hidden="true" tabindex="-1"></a>                modify_time_str <span class="op">=</span> conv_meta.get(<span class="st">&#39;modify_time&#39;</span>)</span>
<span id="cb4-2384"><a href="#cb4-2384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2385"><a href="#cb4-2385" aria-hidden="true" tabindex="-1"></a>                <span class="kw">def</span> format_iso_timestamp(ts_str):</span>
<span id="cb4-2386"><a href="#cb4-2386" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> ts_str:</span>
<span id="cb4-2387"><a href="#cb4-2387" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb4-2388"><a href="#cb4-2388" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">try</span>:</span>
<span id="cb4-2389"><a href="#cb4-2389" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="st">&#39;.&#39;</span> <span class="kw">in</span> ts_str:</span>
<span id="cb4-2390"><a href="#cb4-2390" aria-hidden="true" tabindex="-1"></a>                            ts_str <span class="op">=</span> ts_str.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>] <span class="op">+</span> <span class="st">&#39;Z&#39;</span></span>
<span id="cb4-2391"><a href="#cb4-2391" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="va">self</span>.format_timestamp(ts_str)</span>
<span id="cb4-2392"><a href="#cb4-2392" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">except</span>:</span>
<span id="cb4-2393"><a href="#cb4-2393" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="bu">str</span>(ts_str)</span>
<span id="cb4-2394"><a href="#cb4-2394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2395"><a href="#cb4-2395" aria-hidden="true" tabindex="-1"></a>                inserted_at <span class="op">=</span> format_iso_timestamp(create_time_str)</span>
<span id="cb4-2396"><a href="#cb4-2396" aria-hidden="true" tabindex="-1"></a>                updated_at <span class="op">=</span> format_iso_timestamp(modify_time_str)</span>
<span id="cb4-2397"><a href="#cb4-2397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2398"><a href="#cb4-2398" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb4-2399"><a href="#cb4-2399" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> resp <span class="kw">in</span> responses:</span>
<span id="cb4-2400"><a href="#cb4-2400" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(resp, <span class="bu">dict</span>):</span>
<span id="cb4-2401"><a href="#cb4-2401" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb4-2402"><a href="#cb4-2402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2403"><a href="#cb4-2403" aria-hidden="true" tabindex="-1"></a>                    resp_data <span class="op">=</span> resp.get(<span class="st">&#39;response&#39;</span>)</span>
<span id="cb4-2404"><a href="#cb4-2404" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(resp_data, <span class="bu">dict</span>):</span>
<span id="cb4-2405"><a href="#cb4-2405" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb4-2406"><a href="#cb4-2406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2407"><a href="#cb4-2407" aria-hidden="true" tabindex="-1"></a>                    sender <span class="op">=</span> resp_data.get(<span class="st">&#39;sender&#39;</span>, <span class="st">&#39;&#39;</span>).upper()</span>
<span id="cb4-2408"><a href="#cb4-2408" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> sender <span class="op">==</span> <span class="st">&#39;HUMAN&#39;</span>:</span>
<span id="cb4-2409"><a href="#cb4-2409" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb4-2410"><a href="#cb4-2410" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&quot;user&quot;</span></span>
<span id="cb4-2411"><a href="#cb4-2411" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> sender <span class="op">==</span> <span class="st">&#39;ASSISTANT&#39;</span>:</span>
<span id="cb4-2412"><a href="#cb4-2412" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ Grok&quot;</span></span>
<span id="cb4-2413"><a href="#cb4-2413" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&quot;assistant&quot;</span></span>
<span id="cb4-2414"><a href="#cb4-2414" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb4-2415"><a href="#cb4-2415" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb4-2416"><a href="#cb4-2416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2417"><a href="#cb4-2417" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="bu">str</span>(resp_data.get(<span class="st">&#39;message&#39;</span>, <span class="st">&#39;&#39;</span>)).strip()</span>
<span id="cb4-2418"><a href="#cb4-2418" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-2419"><a href="#cb4-2419" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Processar anexos</span></span>
<span id="cb4-2420"><a href="#cb4-2420" aria-hidden="true" tabindex="-1"></a>                    processed_content, saved_files <span class="op">=</span> <span class="va">self</span>.extract_and_save_attachments(content, total_convs, <span class="bu">len</span>(messages))</span>
<span id="cb4-2421"><a href="#cb4-2421" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content_enhanced(processed_content)</span>
<span id="cb4-2422"><a href="#cb4-2422" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-2423"><a href="#cb4-2423" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb4-2424"><a href="#cb4-2424" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb4-2425"><a href="#cb4-2425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2426"><a href="#cb4-2426" aria-hidden="true" tabindex="-1"></a>                    create_time <span class="op">=</span> resp_data.get(<span class="st">&#39;create_time&#39;</span>)</span>
<span id="cb4-2427"><a href="#cb4-2427" aria-hidden="true" tabindex="-1"></a>                    timestamp_ms <span class="op">=</span> <span class="va">None</span></span>
<span id="cb4-2428"><a href="#cb4-2428" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(create_time, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;$date&#39;</span> <span class="kw">in</span> create_time:</span>
<span id="cb4-2429"><a href="#cb4-2429" aria-hidden="true" tabindex="-1"></a>                        date_obj <span class="op">=</span> create_time[<span class="st">&#39;$date&#39;</span>]</span>
<span id="cb4-2430"><a href="#cb4-2430" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(date_obj, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;$numberLong&#39;</span> <span class="kw">in</span> date_obj:</span>
<span id="cb4-2431"><a href="#cb4-2431" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">try</span>:</span>
<span id="cb4-2432"><a href="#cb4-2432" aria-hidden="true" tabindex="-1"></a>                                timestamp_ms <span class="op">=</span> <span class="bu">int</span>(date_obj[<span class="st">&#39;$numberLong&#39;</span>])</span>
<span id="cb4-2433"><a href="#cb4-2433" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">except</span>:</span>
<span id="cb4-2434"><a href="#cb4-2434" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">pass</span></span>
<span id="cb4-2435"><a href="#cb4-2435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2436"><a href="#cb4-2436" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb4-2437"><a href="#cb4-2437" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb4-2438"><a href="#cb4-2438" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb4-2439"><a href="#cb4-2439" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb4-2440"><a href="#cb4-2440" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(timestamp_ms <span class="op">/</span> <span class="fl">1000.0</span> <span class="cf">if</span> timestamp_ms <span class="cf">else</span> <span class="va">None</span>),</span>
<span id="cb4-2441"><a href="#cb4-2441" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: <span class="st">&#39;Grok&#39;</span>,</span>
<span id="cb4-2442"><a href="#cb4-2442" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;attachments&#39;</span>: saved_files</span>
<span id="cb4-2443"><a href="#cb4-2443" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb4-2444"><a href="#cb4-2444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2445"><a href="#cb4-2445" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb4-2446"><a href="#cb4-2446" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb4-2447"><a href="#cb4-2447" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb4-2448"><a href="#cb4-2448" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;Grok&#39;</span>,</span>
<span id="cb4-2449"><a href="#cb4-2449" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv_id,</span>
<span id="cb4-2450"><a href="#cb4-2450" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: inserted_at,</span>
<span id="cb4-2451"><a href="#cb4-2451" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: updated_at,</span>
<span id="cb4-2452"><a href="#cb4-2452" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb4-2453"><a href="#cb4-2453" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb4-2454"><a href="#cb4-2454" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb4-2455"><a href="#cb4-2455" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb4-2456"><a href="#cb4-2456" aria-hidden="true" tabindex="-1"></a>                    total_convs <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-2457"><a href="#cb4-2457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2458"><a href="#cb4-2458" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> total_convs <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb4-2459"><a href="#cb4-2459" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Grok: processadas </span><span class="sc">{</span>total_convs<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb4-2460"><a href="#cb4-2460" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb4-2461"><a href="#cb4-2461" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: nenhuma conversa v√°lida encontrada.&quot;</span>)</span>
<span id="cb4-2462"><a href="#cb4-2462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2463"><a href="#cb4-2463" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-2464"><a href="#cb4-2464" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar Grok: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-2465"><a href="#cb4-2465" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-2466"><a href="#cb4-2466" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb4-2467"><a href="#cb4-2467" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb4-2468"><a href="#cb4-2468" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb4-2469"><a href="#cb4-2469" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-2470"><a href="#cb4-2470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2471"><a href="#cb4-2471" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_markdown_enhanced(<span class="va">self</span>):</span>
<span id="cb4-2472"><a href="#cb4-2472" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas com preserva√ß√£o total de formata√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb4-2473"><a href="#cb4-2473" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-2474"><a href="#cb4-2474" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] Markdowns seriam criados:&quot;</span>)</span>
<span id="cb4-2475"><a href="#cb4-2475" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb4-2476"><a href="#cb4-2476" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb4-2477"><a href="#cb4-2477" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.md&quot;</span></span>
<span id="cb4-2478"><a href="#cb4-2478" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÑ </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-2479"><a href="#cb4-2479" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-2480"><a href="#cb4-2480" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2481"><a href="#cb4-2481" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;markdown&#39;</span>])</span>
<span id="cb4-2482"><a href="#cb4-2482" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-2483"><a href="#cb4-2483" aria-hidden="true" tabindex="-1"></a>        failed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-2484"><a href="#cb4-2484" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2485"><a href="#cb4-2485" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb4-2486"><a href="#cb4-2486" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb4-2487"><a href="#cb4-2487" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb4-2488"><a href="#cb4-2488" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.md&quot;</span></span>
<span id="cb4-2489"><a href="#cb4-2489" aria-hidden="true" tabindex="-1"></a>                filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb4-2490"><a href="#cb4-2490" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2491"><a href="#cb4-2491" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb4-2492"><a href="#cb4-2492" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb4-2493"><a href="#cb4-2493" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb4-2494"><a href="#cb4-2494" aria-hidden="true" tabindex="-1"></a>                markdown_content <span class="op">=</span> <span class="va">self</span>.create_enhanced_markdown_content(conv)</span>
<span id="cb4-2495"><a href="#cb4-2495" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2496"><a href="#cb4-2496" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-2497"><a href="#cb4-2497" aria-hidden="true" tabindex="-1"></a>                    f.write(markdown_content)</span>
<span id="cb4-2498"><a href="#cb4-2498" aria-hidden="true" tabindex="-1"></a>                saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-2499"><a href="#cb4-2499" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2500"><a href="#cb4-2500" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-2501"><a href="#cb4-2501" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao salvar conversa </span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-2502"><a href="#cb4-2502" aria-hidden="true" tabindex="-1"></a>                failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-2503"><a href="#cb4-2503" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb4-2504"><a href="#cb4-2504" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2505"><a href="#cb4-2505" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Markdown: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados, </span><span class="sc">{</span>failed_count<span class="sc">}</span><span class="ss"> falhas em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb4-2506"><a href="#cb4-2506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2507"><a href="#cb4-2507" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_csv(<span class="va">self</span>):</span>
<span id="cb4-2508"><a href="#cb4-2508" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas em arquivos CSV individuais&quot;&quot;&quot;</span></span>
<span id="cb4-2509"><a href="#cb4-2509" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-2510"><a href="#cb4-2510" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] CSVs seriam criados:&quot;</span>)</span>
<span id="cb4-2511"><a href="#cb4-2511" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb4-2512"><a href="#cb4-2512" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb4-2513"><a href="#cb4-2513" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.csv&quot;</span></span>
<span id="cb4-2514"><a href="#cb4-2514" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìä </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-2515"><a href="#cb4-2515" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-2516"><a href="#cb4-2516" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2517"><a href="#cb4-2517" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;csv&#39;</span>])</span>
<span id="cb4-2518"><a href="#cb4-2518" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-2519"><a href="#cb4-2519" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2520"><a href="#cb4-2520" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb4-2521"><a href="#cb4-2521" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb4-2522"><a href="#cb4-2522" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.csv&quot;</span></span>
<span id="cb4-2523"><a href="#cb4-2523" aria-hidden="true" tabindex="-1"></a>            filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb4-2524"><a href="#cb4-2524" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2525"><a href="#cb4-2525" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb4-2526"><a href="#cb4-2526" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb4-2527"><a href="#cb4-2527" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2528"><a href="#cb4-2528" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-2529"><a href="#cb4-2529" aria-hidden="true" tabindex="-1"></a>                writer <span class="op">=</span> csv.DictWriter(f, fieldnames<span class="op">=</span>[</span>
<span id="cb4-2530"><a href="#cb4-2530" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;node_id&#39;</span>, <span class="st">&#39;author&#39;</span>, <span class="st">&#39;role&#39;</span>, <span class="st">&#39;timestamp&#39;</span>, <span class="st">&#39;model&#39;</span>, <span class="st">&#39;content&#39;</span>, <span class="st">&#39;attachments&#39;</span></span>
<span id="cb4-2531"><a href="#cb4-2531" aria-hidden="true" tabindex="-1"></a>                ])</span>
<span id="cb4-2532"><a href="#cb4-2532" aria-hidden="true" tabindex="-1"></a>                writer.writeheader()</span>
<span id="cb4-2533"><a href="#cb4-2533" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i, msg <span class="kw">in</span> <span class="bu">enumerate</span>(conv[<span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb4-2534"><a href="#cb4-2534" aria-hidden="true" tabindex="-1"></a>                    writer.writerow({</span>
<span id="cb4-2535"><a href="#cb4-2535" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;node_id&#39;</span>: <span class="bu">str</span>(i),</span>
<span id="cb4-2536"><a href="#cb4-2536" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: msg[<span class="st">&#39;author&#39;</span>],</span>
<span id="cb4-2537"><a href="#cb4-2537" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: msg[<span class="st">&#39;role&#39;</span>],</span>
<span id="cb4-2538"><a href="#cb4-2538" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: msg[<span class="st">&#39;timestamp&#39;</span>],</span>
<span id="cb4-2539"><a href="#cb4-2539" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg[<span class="st">&#39;model&#39;</span>],</span>
<span id="cb4-2540"><a href="#cb4-2540" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: msg[<span class="st">&#39;content&#39;</span>],</span>
<span id="cb4-2541"><a href="#cb4-2541" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;attachments&#39;</span>: <span class="st">&#39;, &#39;</span>.join(msg.get(<span class="st">&#39;attachments&#39;</span>, []))</span>
<span id="cb4-2542"><a href="#cb4-2542" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb4-2543"><a href="#cb4-2543" aria-hidden="true" tabindex="-1"></a>            saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-2544"><a href="#cb4-2544" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2545"><a href="#cb4-2545" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ CSV: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb4-2546"><a href="#cb4-2546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2547"><a href="#cb4-2547" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_json(<span class="va">self</span>):</span>
<span id="cb4-2548"><a href="#cb4-2548" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas em arquivos JSON individuais&quot;&quot;&quot;</span></span>
<span id="cb4-2549"><a href="#cb4-2549" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-2550"><a href="#cb4-2550" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] JSONs seriam criados:&quot;</span>)</span>
<span id="cb4-2551"><a href="#cb4-2551" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb4-2552"><a href="#cb4-2552" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb4-2553"><a href="#cb4-2553" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.json&quot;</span></span>
<span id="cb4-2554"><a href="#cb4-2554" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìã </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-2555"><a href="#cb4-2555" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-2556"><a href="#cb4-2556" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2557"><a href="#cb4-2557" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;json&#39;</span>])</span>
<span id="cb4-2558"><a href="#cb4-2558" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-2559"><a href="#cb4-2559" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2560"><a href="#cb4-2560" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb4-2561"><a href="#cb4-2561" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb4-2562"><a href="#cb4-2562" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.json&quot;</span></span>
<span id="cb4-2563"><a href="#cb4-2563" aria-hidden="true" tabindex="-1"></a>            filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb4-2564"><a href="#cb4-2564" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2565"><a href="#cb4-2565" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb4-2566"><a href="#cb4-2566" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb4-2567"><a href="#cb4-2567" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-2568"><a href="#cb4-2568" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-2569"><a href="#cb4-2569" aria-hidden="true" tabindex="-1"></a>                json.dump(conv, f, ensure_ascii<span class="op">=</span><span class="va">False</span>, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb4-2570"><a href="#cb4-2570" aria-hidden="true" tabindex="-1"></a>            saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-2571"><a href="#cb4-2571" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2572"><a href="#cb4-2572" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ JSON: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb4-2573"><a href="#cb4-2573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2574"><a href="#cb4-2574" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_all_to_single_files(<span class="va">self</span>):</span>
<span id="cb4-2575"><a href="#cb4-2575" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva todas as conversas em arquivos √∫nicos CSV e JSON&quot;&quot;&quot;</span></span>
<span id="cb4-2576"><a href="#cb4-2576" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-2577"><a href="#cb4-2577" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] Arquivos √∫nicos seriam criados:&quot;</span>)</span>
<span id="cb4-2578"><a href="#cb4-2578" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÅ </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;csv&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-2579"><a href="#cb4-2579" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÅ </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;json&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-2580"><a href="#cb4-2580" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-2581"><a href="#cb4-2581" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2582"><a href="#cb4-2582" aria-hidden="true" tabindex="-1"></a>        <span class="co"># CSV √∫nico</span></span>
<span id="cb4-2583"><a href="#cb4-2583" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.single_files[<span class="st">&#39;csv&#39;</span>], <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-2584"><a href="#cb4-2584" aria-hidden="true" tabindex="-1"></a>            fieldnames <span class="op">=</span> [</span>
<span id="cb4-2585"><a href="#cb4-2585" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;conversation_number&#39;</span>, <span class="st">&#39;source&#39;</span>, <span class="st">&#39;conversation_title&#39;</span>, <span class="st">&#39;category&#39;</span>,</span>
<span id="cb4-2586"><a href="#cb4-2586" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;author&#39;</span>, <span class="st">&#39;role&#39;</span>, <span class="st">&#39;timestamp&#39;</span>, <span class="st">&#39;model&#39;</span>, <span class="st">&#39;content&#39;</span>, <span class="st">&#39;attachments&#39;</span></span>
<span id="cb4-2587"><a href="#cb4-2587" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb4-2588"><a href="#cb4-2588" aria-hidden="true" tabindex="-1"></a>            writer <span class="op">=</span> csv.DictWriter(f, fieldnames<span class="op">=</span>fieldnames)</span>
<span id="cb4-2589"><a href="#cb4-2589" aria-hidden="true" tabindex="-1"></a>            writer.writeheader()</span>
<span id="cb4-2590"><a href="#cb4-2590" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb4-2591"><a href="#cb4-2591" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> msg <span class="kw">in</span> conv[<span class="st">&#39;messages&#39;</span>]:</span>
<span id="cb4-2592"><a href="#cb4-2592" aria-hidden="true" tabindex="-1"></a>                    writer.writerow({</span>
<span id="cb4-2593"><a href="#cb4-2593" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;conversation_number&#39;</span>: conv[<span class="st">&#39;number&#39;</span>],</span>
<span id="cb4-2594"><a href="#cb4-2594" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: conv[<span class="st">&#39;source&#39;</span>],</span>
<span id="cb4-2595"><a href="#cb4-2595" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;conversation_title&#39;</span>: conv[<span class="st">&#39;title&#39;</span>],</span>
<span id="cb4-2596"><a href="#cb4-2596" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: conv[<span class="st">&#39;category&#39;</span>],</span>
<span id="cb4-2597"><a href="#cb4-2597" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: msg[<span class="st">&#39;author&#39;</span>],</span>
<span id="cb4-2598"><a href="#cb4-2598" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: msg[<span class="st">&#39;role&#39;</span>],</span>
<span id="cb4-2599"><a href="#cb4-2599" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: msg[<span class="st">&#39;timestamp&#39;</span>],</span>
<span id="cb4-2600"><a href="#cb4-2600" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg[<span class="st">&#39;model&#39;</span>],</span>
<span id="cb4-2601"><a href="#cb4-2601" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: msg[<span class="st">&#39;content&#39;</span>],</span>
<span id="cb4-2602"><a href="#cb4-2602" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;attachments&#39;</span>: <span class="st">&#39;, &#39;</span>.join(msg.get(<span class="st">&#39;attachments&#39;</span>, []))</span>
<span id="cb4-2603"><a href="#cb4-2603" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb4-2604"><a href="#cb4-2604" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ CSV √∫nico: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;csv&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-2605"><a href="#cb4-2605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2606"><a href="#cb4-2606" aria-hidden="true" tabindex="-1"></a>        <span class="co"># JSON √∫nico</span></span>
<span id="cb4-2607"><a href="#cb4-2607" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.single_files[<span class="st">&#39;json&#39;</span>], <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-2608"><a href="#cb4-2608" aria-hidden="true" tabindex="-1"></a>            json.dump(<span class="va">self</span>.all_conversations, f, ensure_ascii<span class="op">=</span><span class="va">False</span>, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb4-2609"><a href="#cb4-2609" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ JSON √∫nico: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;json&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-2610"><a href="#cb4-2610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2611"><a href="#cb4-2611" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_searchable_index_enhanced(<span class="va">self</span>):</span>
<span id="cb4-2612"><a href="#cb4-2612" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Cria √≠ndice HTML pesquis√°vel com estat√≠sticas avan√ßadas&quot;&quot;&quot;</span></span>
<span id="cb4-2613"><a href="#cb4-2613" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb4-2614"><a href="#cb4-2614" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] √çndice HTML seria criado: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-2615"><a href="#cb4-2615" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb4-2616"><a href="#cb4-2616" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2617"><a href="#cb4-2617" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;üéØ Criando √≠ndice HTML combinado v8.1...&quot;</span>)</span>
<span id="cb4-2618"><a href="#cb4-2618" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2619"><a href="#cb4-2619" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estat√≠sticas detalhadas</span></span>
<span id="cb4-2620"><a href="#cb4-2620" aria-hidden="true" tabindex="-1"></a>        category_stats <span class="op">=</span> {}</span>
<span id="cb4-2621"><a href="#cb4-2621" aria-hidden="true" tabindex="-1"></a>        source_stats <span class="op">=</span> {}</span>
<span id="cb4-2622"><a href="#cb4-2622" aria-hidden="true" tabindex="-1"></a>        recent_stats <span class="op">=</span> {</span>
<span id="cb4-2623"><a href="#cb4-2623" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;week&#39;</span>: <span class="dv">0</span>,</span>
<span id="cb4-2624"><a href="#cb4-2624" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;month&#39;</span>: <span class="dv">0</span></span>
<span id="cb4-2625"><a href="#cb4-2625" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-2626"><a href="#cb4-2626" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2627"><a href="#cb4-2627" aria-hidden="true" tabindex="-1"></a>        one_week_ago <span class="op">=</span> datetime.now().timestamp() <span class="op">-</span> (<span class="dv">7</span> <span class="op">*</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb4-2628"><a href="#cb4-2628" aria-hidden="true" tabindex="-1"></a>        one_month_ago <span class="op">=</span> datetime.now().timestamp() <span class="op">-</span> (<span class="dv">30</span> <span class="op">*</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb4-2629"><a href="#cb4-2629" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-2630"><a href="#cb4-2630" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb4-2631"><a href="#cb4-2631" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Estat√≠sticas por categoria</span></span>
<span id="cb4-2632"><a href="#cb4-2632" aria-hidden="true" tabindex="-1"></a>            cat <span class="op">=</span> conv[<span class="st">&#39;category&#39;</span>]</span>
<span id="cb4-2633"><a href="#cb4-2633" aria-hidden="true" tabindex="-1"></a>            category_stats[cat] <span class="op">=</span> category_stats.get(cat, <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb4-2634"><a href="#cb4-2634" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2635"><a href="#cb4-2635" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Estat√≠sticas por fonte</span></span>
<span id="cb4-2636"><a href="#cb4-2636" aria-hidden="true" tabindex="-1"></a>            source <span class="op">=</span> conv[<span class="st">&#39;source&#39;</span>]</span>
<span id="cb4-2637"><a href="#cb4-2637" aria-hidden="true" tabindex="-1"></a>            source_stats[source] <span class="op">=</span> source_stats.get(source, <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb4-2638"><a href="#cb4-2638" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2639"><a href="#cb4-2639" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Conversas recentes</span></span>
<span id="cb4-2640"><a href="#cb4-2640" aria-hidden="true" tabindex="-1"></a>            conv_time <span class="op">=</span> <span class="va">self</span>.parse_timestamp_for_sorting(</span>
<span id="cb4-2641"><a href="#cb4-2641" aria-hidden="true" tabindex="-1"></a>                conv.get(<span class="st">&#39;updated_at&#39;</span>) <span class="kw">or</span> conv.get(<span class="st">&#39;inserted_at&#39;</span>)</span>
<span id="cb4-2642"><a href="#cb4-2642" aria-hidden="true" tabindex="-1"></a>            ).timestamp()</span>
<span id="cb4-2643"><a href="#cb4-2643" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-2644"><a href="#cb4-2644" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> conv_time <span class="op">&gt;</span> one_week_ago:</span>
<span id="cb4-2645"><a href="#cb4-2645" aria-hidden="true" tabindex="-1"></a>                recent_stats[<span class="st">&#39;week&#39;</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-2646"><a href="#cb4-2646" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> conv_time <span class="op">&gt;</span> one_month_ago:</span>
<span id="cb4-2647"><a href="#cb4-2647" aria-hidden="true" tabindex="-1"></a>                recent_stats[<span class="st">&#39;month&#39;</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-2648"><a href="#cb4-2648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2649"><a href="#cb4-2649" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb4-2650"><a href="#cb4-2650" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html lang=&quot;pt-PT&quot;&gt;</span></span>
<span id="cb4-2651"><a href="#cb4-2651" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb4-2652"><a href="#cb4-2652" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb4-2653"><a href="#cb4-2653" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb4-2654"><a href="#cb4-2654" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;√çndice Combinado v8.1 - AI Chats&lt;/title&gt;</span></span>
<span id="cb4-2655"><a href="#cb4-2655" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb4-2656"><a href="#cb4-2656" aria-hidden="true" tabindex="-1"></a><span class="ss">        * </span><span class="ch">{{</span><span class="ss"> margin: 0; padding: 0; box-sizing: border-box; </span><span class="ch">}}</span></span>
<span id="cb4-2657"><a href="#cb4-2657" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span><span class="ss"> font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; color: #333; </span><span class="ch">}}</span></span>
<span id="cb4-2658"><a href="#cb4-2658" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span><span class="ss"> max-width: 1400px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; </span><span class="ch">}}</span></span>
<span id="cb4-2659"><a href="#cb4-2659" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header </span><span class="ch">{{</span><span class="ss"> background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; text-align: center; </span><span class="ch">}}</span></span>
<span id="cb4-2660"><a href="#cb4-2660" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header h1 </span><span class="ch">{{</span><span class="ss"> font-size: 2.8em; margin-bottom: 15px; font-weight: 300; </span><span class="ch">}}</span></span>
<span id="cb4-2661"><a href="#cb4-2661" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header p </span><span class="ch">{{</span><span class="ss"> font-size: 1.2em; opacity: 0.9; margin-bottom: 20px; </span><span class="ch">}}</span></span>
<span id="cb4-2662"><a href="#cb4-2662" aria-hidden="true" tabindex="-1"></a><span class="ss">        .stats-grid </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2663"><a href="#cb4-2663" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: grid; </span></span>
<span id="cb4-2664"><a href="#cb4-2664" aria-hidden="true" tabindex="-1"></a><span class="ss">            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); </span></span>
<span id="cb4-2665"><a href="#cb4-2665" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 15px; </span></span>
<span id="cb4-2666"><a href="#cb4-2666" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 20px 0;</span></span>
<span id="cb4-2667"><a href="#cb4-2667" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2668"><a href="#cb4-2668" aria-hidden="true" tabindex="-1"></a><span class="ss">        .stat-card </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2669"><a href="#cb4-2669" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: rgba(255,255,255,0.15); </span></span>
<span id="cb4-2670"><a href="#cb4-2670" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px; </span></span>
<span id="cb4-2671"><a href="#cb4-2671" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px; </span></span>
<span id="cb4-2672"><a href="#cb4-2672" aria-hidden="true" tabindex="-1"></a><span class="ss">            backdrop-filter: blur(10px);</span></span>
<span id="cb4-2673"><a href="#cb4-2673" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center;</span></span>
<span id="cb4-2674"><a href="#cb4-2674" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2675"><a href="#cb4-2675" aria-hidden="true" tabindex="-1"></a><span class="ss">        .stat-number </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2676"><a href="#cb4-2676" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 2em; </span></span>
<span id="cb4-2677"><a href="#cb4-2677" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold; </span></span>
<span id="cb4-2678"><a href="#cb4-2678" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 5px;</span></span>
<span id="cb4-2679"><a href="#cb4-2679" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2680"><a href="#cb4-2680" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-section </span><span class="ch">{{</span><span class="ss"> padding: 30px; background: #f8f9fa; border-bottom: 1px solid #e9ecef; </span><span class="ch">}}</span></span>
<span id="cb4-2681"><a href="#cb4-2681" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-box </span><span class="ch">{{</span><span class="ss"> width: 100%; padding: 18px 25px; font-size: 16px; border: 2px solid #e9ecef; border-radius: 25px; outline: none; transition: all 0.3s ease; font-family: inherit; </span><span class="ch">}}</span></span>
<span id="cb4-2682"><a href="#cb4-2682" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-box:focus </span><span class="ch">{{</span><span class="ss"> border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); </span><span class="ch">}}</span></span>
<span id="cb4-2683"><a href="#cb4-2683" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-2684"><a href="#cb4-2684" aria-hidden="true" tabindex="-1"></a><span class="ss">        .advanced-filters </span><span class="ch">{{</span></span>
<span id="cb4-2685"><a href="#cb4-2685" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e3f2fd;</span></span>
<span id="cb4-2686"><a href="#cb4-2686" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb4-2687"><a href="#cb4-2687" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 10px;</span></span>
<span id="cb4-2688"><a href="#cb4-2688" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 15px 30px;</span></span>
<span id="cb4-2689"><a href="#cb4-2689" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2690"><a href="#cb4-2690" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-2691"><a href="#cb4-2691" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-section </span><span class="ch">{{</span></span>
<span id="cb4-2692"><a href="#cb4-2692" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px 30px;</span></span>
<span id="cb4-2693"><a href="#cb4-2693" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb4-2694"><a href="#cb4-2694" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb4-2695"><a href="#cb4-2695" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 12px;</span></span>
<span id="cb4-2696"><a href="#cb4-2696" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: center;</span></span>
<span id="cb4-2697"><a href="#cb4-2697" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb4-2698"><a href="#cb4-2698" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 1px solid #e9ecef;</span></span>
<span id="cb4-2699"><a href="#cb4-2699" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2700"><a href="#cb4-2700" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-btn </span><span class="ch">{{</span></span>
<span id="cb4-2701"><a href="#cb4-2701" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 10px 20px;</span></span>
<span id="cb4-2702"><a href="#cb4-2702" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb4-2703"><a href="#cb4-2703" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 2px solid #e9ecef;</span></span>
<span id="cb4-2704"><a href="#cb4-2704" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 25px;</span></span>
<span id="cb4-2705"><a href="#cb4-2705" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb4-2706"><a href="#cb4-2706" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.95em;</span></span>
<span id="cb4-2707"><a href="#cb4-2707" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb4-2708"><a href="#cb4-2708" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.3s ease;</span></span>
<span id="cb4-2709"><a href="#cb4-2709" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: inherit;</span></span>
<span id="cb4-2710"><a href="#cb4-2710" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2711"><a href="#cb4-2711" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-btn.active, .filter-btn:hover </span><span class="ch">{{</span></span>
<span id="cb4-2712"><a href="#cb4-2712" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #667eea;</span></span>
<span id="cb4-2713"><a href="#cb4-2713" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb4-2714"><a href="#cb4-2714" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb4-2715"><a href="#cb4-2715" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: translateY(-2px);</span></span>
<span id="cb4-2716"><a href="#cb4-2716" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);</span></span>
<span id="cb4-2717"><a href="#cb4-2717" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2718"><a href="#cb4-2718" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-2719"><a href="#cb4-2719" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-group </span><span class="ch">{{</span></span>
<span id="cb4-2720"><a href="#cb4-2720" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb4-2721"><a href="#cb4-2721" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb4-2722"><a href="#cb4-2722" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 10px;</span></span>
<span id="cb4-2723"><a href="#cb4-2723" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 10px 0;</span></span>
<span id="cb4-2724"><a href="#cb4-2724" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: center;</span></span>
<span id="cb4-2725"><a href="#cb4-2725" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2726"><a href="#cb4-2726" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-2727"><a href="#cb4-2727" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-group strong </span><span class="ch">{{</span></span>
<span id="cb4-2728"><a href="#cb4-2728" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-right: 10px;</span></span>
<span id="cb4-2729"><a href="#cb4-2729" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb4-2730"><a href="#cb4-2730" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2731"><a href="#cb4-2731" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-2732"><a href="#cb4-2732" aria-hidden="true" tabindex="-1"></a><span class="ss">        .quick-actions </span><span class="ch">{{</span></span>
<span id="cb4-2733"><a href="#cb4-2733" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb4-2734"><a href="#cb4-2734" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 10px;</span></span>
<span id="cb4-2735"><a href="#cb4-2735" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 15px 0;</span></span>
<span id="cb4-2736"><a href="#cb4-2736" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb4-2737"><a href="#cb4-2737" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2738"><a href="#cb4-2738" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-2739"><a href="#cb4-2739" aria-hidden="true" tabindex="-1"></a><span class="ss">        .action-btn </span><span class="ch">{{</span></span>
<span id="cb4-2740"><a href="#cb4-2740" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 10px 15px;</span></span>
<span id="cb4-2741"><a href="#cb4-2741" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #3498db;</span></span>
<span id="cb4-2742"><a href="#cb4-2742" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb4-2743"><a href="#cb4-2743" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: none;</span></span>
<span id="cb4-2744"><a href="#cb4-2744" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 5px;</span></span>
<span id="cb4-2745"><a href="#cb4-2745" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb4-2746"><a href="#cb4-2746" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb4-2747"><a href="#cb4-2747" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb4-2748"><a href="#cb4-2748" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: inherit;</span></span>
<span id="cb4-2749"><a href="#cb4-2749" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2750"><a href="#cb4-2750" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-2751"><a href="#cb4-2751" aria-hidden="true" tabindex="-1"></a><span class="ss">        .action-btn:hover </span><span class="ch">{{</span></span>
<span id="cb4-2752"><a href="#cb4-2752" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #2980b9;</span></span>
<span id="cb4-2753"><a href="#cb4-2753" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2754"><a href="#cb4-2754" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-2755"><a href="#cb4-2755" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversations-grid </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2756"><a href="#cb4-2756" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: grid; </span></span>
<span id="cb4-2757"><a href="#cb4-2757" aria-hidden="true" tabindex="-1"></a><span class="ss">            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); </span></span>
<span id="cb4-2758"><a href="#cb4-2758" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 25px; </span></span>
<span id="cb4-2759"><a href="#cb4-2759" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 35px;</span></span>
<span id="cb4-2760"><a href="#cb4-2760" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);</span></span>
<span id="cb4-2761"><a href="#cb4-2761" aria-hidden="true" tabindex="-1"></a><span class="ss">            min-height: 400px;</span></span>
<span id="cb4-2762"><a href="#cb4-2762" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2763"><a href="#cb4-2763" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2764"><a href="#cb4-2764" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white; </span></span>
<span id="cb4-2765"><a href="#cb4-2765" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #e9ecef; </span></span>
<span id="cb4-2766"><a href="#cb4-2766" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 15px; </span></span>
<span id="cb4-2767"><a href="#cb4-2767" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 25px; </span></span>
<span id="cb4-2768"><a href="#cb4-2768" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.4s ease; </span></span>
<span id="cb4-2769"><a href="#cb4-2769" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer; </span></span>
<span id="cb4-2770"><a href="#cb4-2770" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: relative;</span></span>
<span id="cb4-2771"><a href="#cb4-2771" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 15px rgba(0,0,0,0.08);</span></span>
<span id="cb4-2772"><a href="#cb4-2772" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2773"><a href="#cb4-2773" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card:hover </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2774"><a href="#cb4-2774" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: translateY(-8px); </span></span>
<span id="cb4-2775"><a href="#cb4-2775" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 15px 35px rgba(0,0,0,0.15); </span></span>
<span id="cb4-2776"><a href="#cb4-2776" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb4-2777"><a href="#cb4-2777" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2778"><a href="#cb4-2778" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-header </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2779"><a href="#cb4-2779" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb4-2780"><a href="#cb4-2780" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between; </span></span>
<span id="cb4-2781"><a href="#cb4-2781" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: flex-start; </span></span>
<span id="cb4-2782"><a href="#cb4-2782" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 18px; </span></span>
<span id="cb4-2783"><a href="#cb4-2783" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2784"><a href="#cb4-2784" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-number </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2785"><a href="#cb4-2785" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #667eea, #764ba2); </span></span>
<span id="cb4-2786"><a href="#cb4-2786" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb4-2787"><a href="#cb4-2787" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 8px 16px; </span></span>
<span id="cb4-2788"><a href="#cb4-2788" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 20px; </span></span>
<span id="cb4-2789"><a href="#cb4-2789" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em; </span></span>
<span id="cb4-2790"><a href="#cb4-2790" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb4-2791"><a href="#cb4-2791" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);</span></span>
<span id="cb4-2792"><a href="#cb4-2792" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2793"><a href="#cb4-2793" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-source </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2794"><a href="#cb4-2794" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e3f2fd; </span></span>
<span id="cb4-2795"><a href="#cb4-2795" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #1976d2; </span></span>
<span id="cb4-2796"><a href="#cb4-2796" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 5px 12px; </span></span>
<span id="cb4-2797"><a href="#cb4-2797" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px; </span></span>
<span id="cb4-2798"><a href="#cb4-2798" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.85em; </span></span>
<span id="cb4-2799"><a href="#cb4-2799" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold; </span></span>
<span id="cb4-2800"><a href="#cb4-2800" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 10px;</span></span>
<span id="cb4-2801"><a href="#cb4-2801" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2802"><a href="#cb4-2802" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-title </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2803"><a href="#cb4-2803" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.3em; </span></span>
<span id="cb4-2804"><a href="#cb4-2804" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 600; </span></span>
<span id="cb4-2805"><a href="#cb4-2805" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50; </span></span>
<span id="cb4-2806"><a href="#cb4-2806" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 12px; </span></span>
<span id="cb4-2807"><a href="#cb4-2807" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.4;</span></span>
<span id="cb4-2808"><a href="#cb4-2808" aria-hidden="true" tabindex="-1"></a><span class="ss">            min-height: 3.6em;</span></span>
<span id="cb4-2809"><a href="#cb4-2809" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb4-2810"><a href="#cb4-2810" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2811"><a href="#cb4-2811" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-summary </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2812"><a href="#cb4-2812" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #6c757d; </span></span>
<span id="cb4-2813"><a href="#cb4-2813" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.95em; </span></span>
<span id="cb4-2814"><a href="#cb4-2814" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.5; </span></span>
<span id="cb4-2815"><a href="#cb4-2815" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 18px;</span></span>
<span id="cb4-2816"><a href="#cb4-2816" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: -webkit-box;</span></span>
<span id="cb4-2817"><a href="#cb4-2817" aria-hidden="true" tabindex="-1"></a><span class="ss">            -webkit-line-clamp: 3;</span></span>
<span id="cb4-2818"><a href="#cb4-2818" aria-hidden="true" tabindex="-1"></a><span class="ss">            -webkit-box-orient: vertical;</span></span>
<span id="cb4-2819"><a href="#cb4-2819" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb4-2820"><a href="#cb4-2820" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb4-2821"><a href="#cb4-2821" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2822"><a href="#cb4-2822" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-meta </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2823"><a href="#cb4-2823" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb4-2824"><a href="#cb4-2824" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between; </span></span>
<span id="cb4-2825"><a href="#cb4-2825" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.85em; </span></span>
<span id="cb4-2826"><a href="#cb4-2826" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #868e96; </span></span>
<span id="cb4-2827"><a href="#cb4-2827" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-top: 1px solid #e9ecef; </span></span>
<span id="cb4-2828"><a href="#cb4-2828" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-top: 18px;</span></span>
<span id="cb4-2829"><a href="#cb4-2829" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2830"><a href="#cb4-2830" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-actions </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2831"><a href="#cb4-2831" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: absolute; </span></span>
<span id="cb4-2832"><a href="#cb4-2832" aria-hidden="true" tabindex="-1"></a><span class="ss">            top: 20px; </span></span>
<span id="cb4-2833"><a href="#cb4-2833" aria-hidden="true" tabindex="-1"></a><span class="ss">            right: 20px; </span></span>
<span id="cb4-2834"><a href="#cb4-2834" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb4-2835"><a href="#cb4-2835" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 8px; </span></span>
<span id="cb4-2836"><a href="#cb4-2836" aria-hidden="true" tabindex="-1"></a><span class="ss">            opacity: 0; </span></span>
<span id="cb4-2837"><a href="#cb4-2837" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: opacity 0.3s ease; </span></span>
<span id="cb4-2838"><a href="#cb4-2838" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2839"><a href="#cb4-2839" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card:hover .card-actions </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2840"><a href="#cb4-2840" aria-hidden="true" tabindex="-1"></a><span class="ss">            opacity: 1; </span></span>
<span id="cb4-2841"><a href="#cb4-2841" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2842"><a href="#cb4-2842" aria-hidden="true" tabindex="-1"></a><span class="ss">        .action-btn-small </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2843"><a href="#cb4-2843" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white; </span></span>
<span id="cb4-2844"><a href="#cb4-2844" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 2px solid #e9ecef; </span></span>
<span id="cb4-2845"><a href="#cb4-2845" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px; </span></span>
<span id="cb4-2846"><a href="#cb4-2846" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 6px 12px; </span></span>
<span id="cb4-2847"><a href="#cb4-2847" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.8em; </span></span>
<span id="cb4-2848"><a href="#cb4-2848" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer; </span></span>
<span id="cb4-2849"><a href="#cb4-2849" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.3s ease;</span></span>
<span id="cb4-2850"><a href="#cb4-2850" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb4-2851"><a href="#cb4-2851" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb4-2852"><a href="#cb4-2852" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333;</span></span>
<span id="cb4-2853"><a href="#cb4-2853" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb4-2854"><a href="#cb4-2854" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2855"><a href="#cb4-2855" aria-hidden="true" tabindex="-1"></a><span class="ss">        .action-btn-small:hover </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2856"><a href="#cb4-2856" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #667eea; </span></span>
<span id="cb4-2857"><a href="#cb4-2857" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb4-2858"><a href="#cb4-2858" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb4-2859"><a href="#cb4-2859" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: scale(1.05);</span></span>
<span id="cb4-2860"><a href="#cb4-2860" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2861"><a href="#cb4-2861" aria-hidden="true" tabindex="-1"></a><span class="ss">        .recent-badge </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2862"><a href="#cb4-2862" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #ff6b6b; </span></span>
<span id="cb4-2863"><a href="#cb4-2863" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb4-2864"><a href="#cb4-2864" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 3px 10px; </span></span>
<span id="cb4-2865"><a href="#cb4-2865" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px; </span></span>
<span id="cb4-2866"><a href="#cb4-2866" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.75em; </span></span>
<span id="cb4-2867"><a href="#cb4-2867" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 8px;</span></span>
<span id="cb4-2868"><a href="#cb4-2868" aria-hidden="true" tabindex="-1"></a><span class="ss">            animation: pulse 2s infinite;</span></span>
<span id="cb4-2869"><a href="#cb4-2869" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2870"><a href="#cb4-2870" aria-hidden="true" tabindex="-1"></a><span class="ss">        .no-results </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb4-2871"><a href="#cb4-2871" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center; </span></span>
<span id="cb4-2872"><a href="#cb4-2872" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 60px 20px; </span></span>
<span id="cb4-2873"><a href="#cb4-2873" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #6c757d;</span></span>
<span id="cb4-2874"><a href="#cb4-2874" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.1em;</span></span>
<span id="cb4-2875"><a href="#cb4-2875" aria-hidden="true" tabindex="-1"></a><span class="ss">            grid-column: 1 / -1;</span></span>
<span id="cb4-2876"><a href="#cb4-2876" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2877"><a href="#cb4-2877" aria-hidden="true" tabindex="-1"></a><span class="ss">        @keyframes pulse </span><span class="ch">{{</span></span>
<span id="cb4-2878"><a href="#cb4-2878" aria-hidden="true" tabindex="-1"></a><span class="ss">            0% </span><span class="ch">{{</span><span class="ss"> transform: scale(1); </span><span class="ch">}}</span></span>
<span id="cb4-2879"><a href="#cb4-2879" aria-hidden="true" tabindex="-1"></a><span class="ss">            50% </span><span class="ch">{{</span><span class="ss"> transform: scale(1.05); </span><span class="ch">}}</span></span>
<span id="cb4-2880"><a href="#cb4-2880" aria-hidden="true" tabindex="-1"></a><span class="ss">            100% </span><span class="ch">{{</span><span class="ss"> transform: scale(1); </span><span class="ch">}}</span></span>
<span id="cb4-2881"><a href="#cb4-2881" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2882"><a href="#cb4-2882" aria-hidden="true" tabindex="-1"></a><span class="ss">        .category-badge </span><span class="ch">{{</span></span>
<span id="cb4-2883"><a href="#cb4-2883" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb4-2884"><a href="#cb4-2884" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e3f2fd;</span></span>
<span id="cb4-2885"><a href="#cb4-2885" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #1976d2;</span></span>
<span id="cb4-2886"><a href="#cb4-2886" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 10px;</span></span>
<span id="cb4-2887"><a href="#cb4-2887" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px;</span></span>
<span id="cb4-2888"><a href="#cb4-2888" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.8em;</span></span>
<span id="cb4-2889"><a href="#cb4-2889" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 8px;</span></span>
<span id="cb4-2890"><a href="#cb4-2890" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb4-2891"><a href="#cb4-2891" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2892"><a href="#cb4-2892" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-2893"><a href="#cb4-2893" aria-hidden="true" tabindex="-1"></a><span class="ss">        .direct-link </span><span class="ch">{{</span></span>
<span id="cb4-2894"><a href="#cb4-2894" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb4-2895"><a href="#cb4-2895" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 5px;</span></span>
<span id="cb4-2896"><a href="#cb4-2896" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 8px 15px;</span></span>
<span id="cb4-2897"><a href="#cb4-2897" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #28a745;</span></span>
<span id="cb4-2898"><a href="#cb4-2898" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb4-2899"><a href="#cb4-2899" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb4-2900"><a href="#cb4-2900" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 5px;</span></span>
<span id="cb4-2901"><a href="#cb4-2901" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb4-2902"><a href="#cb4-2902" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2903"><a href="#cb4-2903" aria-hidden="true" tabindex="-1"></a><span class="ss">        .direct-link:hover </span><span class="ch">{{</span></span>
<span id="cb4-2904"><a href="#cb4-2904" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #218838;</span></span>
<span id="cb4-2905"><a href="#cb4-2905" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2906"><a href="#cb4-2906" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-2907"><a href="#cb4-2907" aria-hidden="true" tabindex="-1"></a><span class="ss">        .html-btn </span><span class="ch">{{</span></span>
<span id="cb4-2908"><a href="#cb4-2908" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #17a2b8 !important;</span></span>
<span id="cb4-2909"><a href="#cb4-2909" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white !important;</span></span>
<span id="cb4-2910"><a href="#cb4-2910" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 2px solid #17a2b8 !important;</span></span>
<span id="cb4-2911"><a href="#cb4-2911" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2912"><a href="#cb4-2912" aria-hidden="true" tabindex="-1"></a><span class="ss">        .html-btn:hover </span><span class="ch">{{</span></span>
<span id="cb4-2913"><a href="#cb4-2913" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #138496 !important;</span></span>
<span id="cb4-2914"><a href="#cb4-2914" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #138496 !important;</span></span>
<span id="cb4-2915"><a href="#cb4-2915" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2916"><a href="#cb4-2916" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-2917"><a href="#cb4-2917" aria-hidden="true" tabindex="-1"></a><span class="ss">        .pdf-btn </span><span class="ch">{{</span></span>
<span id="cb4-2918"><a href="#cb4-2918" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #dc3545 !important;</span></span>
<span id="cb4-2919"><a href="#cb4-2919" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white !important;</span></span>
<span id="cb4-2920"><a href="#cb4-2920" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 2px solid #dc3545 !important;</span></span>
<span id="cb4-2921"><a href="#cb4-2921" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2922"><a href="#cb4-2922" aria-hidden="true" tabindex="-1"></a><span class="ss">        .pdf-btn:hover </span><span class="ch">{{</span></span>
<span id="cb4-2923"><a href="#cb4-2923" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #c82333 !important;</span></span>
<span id="cb4-2924"><a href="#cb4-2924" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #c82333 !important;</span></span>
<span id="cb4-2925"><a href="#cb4-2925" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2926"><a href="#cb4-2926" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-2927"><a href="#cb4-2927" aria-hidden="true" tabindex="-1"></a><span class="ss">        .attachments-badge </span><span class="ch">{{</span></span>
<span id="cb4-2928"><a href="#cb4-2928" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #ffc107;</span></span>
<span id="cb4-2929"><a href="#cb4-2929" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #212529;</span></span>
<span id="cb4-2930"><a href="#cb4-2930" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 2px 8px;</span></span>
<span id="cb4-2931"><a href="#cb4-2931" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 10px;</span></span>
<span id="cb4-2932"><a href="#cb4-2932" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.7em;</span></span>
<span id="cb4-2933"><a href="#cb4-2933" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 5px;</span></span>
<span id="cb4-2934"><a href="#cb4-2934" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb4-2935"><a href="#cb4-2935" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb4-2936"><a href="#cb4-2936" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb4-2937"><a href="#cb4-2937" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb4-2938"><a href="#cb4-2938" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb4-2939"><a href="#cb4-2939" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;header&quot;&gt;</span></span>
<span id="cb4-2940"><a href="#cb4-2940" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;h1&gt;üìö √çndice Combinado v8.1&lt;/h1&gt;</span></span>
<span id="cb4-2941"><a href="#cb4-2941" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;p&gt;Qwen3 ‚Ä¢ ChatGPT ‚Ä¢ DeepSeek ‚Ä¢ Grok ‚Ä¢ COM ANEXOS, CACHE E UNICODE AVAN√áADO&lt;/p&gt;</span></span>
<span id="cb4-2942"><a href="#cb4-2942" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span></span>
<span id="cb4-2943"><a href="#cb4-2943" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div class=&quot;stats-grid&quot;&gt;</span></span>
<span id="cb4-2944"><a href="#cb4-2944" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-card&quot;&gt;</span></span>
<span id="cb4-2945"><a href="#cb4-2945" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;stat-number&quot;&gt;</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb4-2946"><a href="#cb4-2946" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div&gt;Total de Conversas&lt;/div&gt;</span></span>
<span id="cb4-2947"><a href="#cb4-2947" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb4-2948"><a href="#cb4-2948" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-card&quot;&gt;</span></span>
<span id="cb4-2949"><a href="#cb4-2949" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;stat-number&quot;&gt;</span><span class="sc">{</span><span class="bu">len</span>(source_stats)<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb4-2950"><a href="#cb4-2950" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div&gt;Fontes Diferentes&lt;/div&gt;</span></span>
<span id="cb4-2951"><a href="#cb4-2951" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb4-2952"><a href="#cb4-2952" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-card&quot;&gt;</span></span>
<span id="cb4-2953"><a href="#cb4-2953" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;stat-number&quot;&gt;</span><span class="sc">{</span>recent_stats[<span class="st">&#39;week&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb4-2954"><a href="#cb4-2954" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div&gt;√öltima Semana&lt;/div&gt;</span></span>
<span id="cb4-2955"><a href="#cb4-2955" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb4-2956"><a href="#cb4-2956" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-card&quot;&gt;</span></span>
<span id="cb4-2957"><a href="#cb4-2957" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;stat-number&quot;&gt;</span><span class="sc">{</span>recent_stats[<span class="st">&#39;month&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb4-2958"><a href="#cb4-2958" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div&gt;√öltimo M√™s&lt;/div&gt;</span></span>
<span id="cb4-2959"><a href="#cb4-2959" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb4-2960"><a href="#cb4-2960" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb4-2961"><a href="#cb4-2961" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb4-2962"><a href="#cb4-2962" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-2963"><a href="#cb4-2963" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;search-section&quot;&gt;</span></span>
<span id="cb4-2964"><a href="#cb4-2964" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;input type=&quot;text&quot; id=&quot;searchInput&quot; class=&quot;search-box&quot; placeholder=&quot;üîç Pesquisar por t√≠tulo, conte√∫do, categoria ou fonte...&quot;&gt;</span></span>
<span id="cb4-2965"><a href="#cb4-2965" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb4-2966"><a href="#cb4-2966" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-2967"><a href="#cb4-2967" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;advanced-filters&quot;&gt;</span></span>
<span id="cb4-2968"><a href="#cb4-2968" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;h3&gt;üéØ Filtros Avan√ßados v8.1&lt;/h3&gt;</span></span>
<span id="cb4-2969"><a href="#cb4-2969" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span></span>
<span id="cb4-2970"><a href="#cb4-2970" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div class=&quot;filter-group&quot;&gt;</span></span>
<span id="cb4-2971"><a href="#cb4-2971" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;strong&gt;Fontes:&lt;/strong&gt;</span></span>
<span id="cb4-2972"><a href="#cb4-2972" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;button class=&quot;filter-btn active&quot; data-filter-source=&quot;todas&quot;&gt;Todas (</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">)&lt;/button&gt;</span></span>
<span id="cb4-2973"><a href="#cb4-2973" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="sc">{</span><span class="st">&quot;&quot;</span><span class="sc">.</span>join([<span class="ss">f&#39;&lt;button class=&quot;filter-btn&quot; data-filter-source=&quot;</span><span class="sc">{</span>source<span class="sc">}</span><span class="ss">&quot;&gt;</span><span class="sc">{</span>source<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">)&lt;/button&gt;&#39;</span> </span>
<span id="cb4-2974"><a href="#cb4-2974" aria-hidden="true" tabindex="-1"></a>                         <span class="cf">for</span> source, count <span class="kw">in</span> source_stats.items()])<span class="sc">}</span></span>
<span id="cb4-2975"><a href="#cb4-2975" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb4-2976"><a href="#cb4-2976" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span></span>
<span id="cb4-2977"><a href="#cb4-2977" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div class=&quot;filter-group&quot;&gt;</span></span>
<span id="cb4-2978"><a href="#cb4-2978" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;strong&gt;Categorias:&lt;/strong&gt;</span></span>
<span id="cb4-2979"><a href="#cb4-2979" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;button class=&quot;filter-btn active&quot; data-filter-category=&quot;todas&quot;&gt;Todas&lt;/button&gt;</span></span>
<span id="cb4-2980"><a href="#cb4-2980" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="sc">{</span><span class="st">&quot;&quot;</span><span class="sc">.</span>join([<span class="ss">f&#39;&lt;button class=&quot;filter-btn&quot; data-filter-category=&quot;</span><span class="sc">{</span>category<span class="sc">}</span><span class="ss">&quot;&gt;</span><span class="sc">{</span>category<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">)&lt;/button&gt;&#39;</span> </span>
<span id="cb4-2981"><a href="#cb4-2981" aria-hidden="true" tabindex="-1"></a>                         <span class="cf">for</span> category, count <span class="kw">in</span> <span class="bu">sorted</span>(category_stats.items())])<span class="sc">}</span></span>
<span id="cb4-2982"><a href="#cb4-2982" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb4-2983"><a href="#cb4-2983" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span></span>
<span id="cb4-2984"><a href="#cb4-2984" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div class=&quot;quick-actions&quot;&gt;</span></span>
<span id="cb4-2985"><a href="#cb4-2985" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;button class=&quot;action-btn&quot; onclick=&quot;clearCache()&quot;&gt;üîÑ Limpar Cache&lt;/button&gt;</span></span>
<span id="cb4-2986"><a href="#cb4-2986" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;button class=&quot;action-btn&quot; onclick=&quot;exportStats()&quot;&gt;üìä Exportar Estat√≠sticas&lt;/button&gt;</span></span>
<span id="cb4-2987"><a href="#cb4-2987" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;button class=&quot;action-btn&quot; onclick=&quot;toggleDarkMode()&quot;&gt;üåô Modo Escuro&lt;/button&gt;</span></span>
<span id="cb4-2988"><a href="#cb4-2988" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb4-2989"><a href="#cb4-2989" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb4-2990"><a href="#cb4-2990" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-2991"><a href="#cb4-2991" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div style=&quot;text-align: center; padding: 15px; background: #e9ecef; border-bottom: 1px solid #ddd;&quot;&gt;</span></span>
<span id="cb4-2992"><a href="#cb4-2992" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;strong&gt;Acesso R√°pido v8.1:&lt;/strong&gt;</span></span>
<span id="cb4-2993"><a href="#cb4-2993" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;a href=&quot;combined_markdown/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìÅ Markdown&lt;/a&gt;</span></span>
<span id="cb4-2994"><a href="#cb4-2994" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;a href=&quot;combined_html/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üåê HTML&lt;/a&gt;</span></span>
<span id="cb4-2995"><a href="#cb4-2995" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;a href=&quot;combined_attachments/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìé Anexos&lt;/a&gt;</span></span>
<span id="cb4-2996"><a href="#cb4-2996" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;a href=&quot;combined_json/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìã JSON&lt;/a&gt;</span></span>
<span id="cb4-2997"><a href="#cb4-2997" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;a href=&quot;combined_csv/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìä CSV&lt;/a&gt;</span></span>
<span id="cb4-2998"><a href="#cb4-2998" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;a href=&quot;combined_pdfs/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìÑ PDF&lt;/a&gt;</span></span>
<span id="cb4-2999"><a href="#cb4-2999" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb4-3000"><a href="#cb4-3000" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb4-3001"><a href="#cb4-3001" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;conversations-grid&quot; id=&quot;conversationsGrid&quot;&gt;</span></span>
<span id="cb4-3002"><a href="#cb4-3002" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb4-3003"><a href="#cb4-3003" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-3004"><a href="#cb4-3004" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.all_conversations):</span>
<span id="cb4-3005"><a href="#cb4-3005" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb4-3006"><a href="#cb4-3006" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb4-3007"><a href="#cb4-3007" aria-hidden="true" tabindex="-1"></a>            recent_badge <span class="op">=</span> <span class="st">&quot;&lt;span class=&#39;recent-badge&#39;&gt;NOVO&lt;/span&gt;&quot;</span> <span class="cf">if</span> i <span class="op">&lt;</span> <span class="dv">5</span> <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb4-3008"><a href="#cb4-3008" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-3009"><a href="#cb4-3009" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verificar se tem anexos</span></span>
<span id="cb4-3010"><a href="#cb4-3010" aria-hidden="true" tabindex="-1"></a>            has_attachments <span class="op">=</span> <span class="bu">any</span>(msg.get(<span class="st">&#39;attachments&#39;</span>) <span class="cf">for</span> msg <span class="kw">in</span> conv[<span class="st">&#39;messages&#39;</span>])</span>
<span id="cb4-3011"><a href="#cb4-3011" aria-hidden="true" tabindex="-1"></a>            attachments_badge <span class="op">=</span> <span class="st">&quot;&lt;span class=&#39;attachments-badge&#39;&gt;üìé&lt;/span&gt;&quot;</span> <span class="cf">if</span> has_attachments <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb4-3012"><a href="#cb4-3012" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-3013"><a href="#cb4-3013" aria-hidden="true" tabindex="-1"></a>            summary <span class="op">=</span> conv.get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;Sem resumo dispon√≠vel&#39;</span>)</span>
<span id="cb4-3014"><a href="#cb4-3014" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(summary) <span class="op">&gt;</span> <span class="dv">150</span>:</span>
<span id="cb4-3015"><a href="#cb4-3015" aria-hidden="true" tabindex="-1"></a>                summary <span class="op">=</span> summary[:<span class="dv">150</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span></span>
<span id="cb4-3016"><a href="#cb4-3016" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-3017"><a href="#cb4-3017" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">+=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb4-3018"><a href="#cb4-3018" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div class=&quot;conversation-card&quot; data-title=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&quot; data-summary=&quot;</span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&quot; data-source=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot; data-category=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;category&#39;</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot;&gt;</span></span>
<span id="cb4-3019"><a href="#cb4-3019" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-header&quot;&gt;</span></span>
<span id="cb4-3020"><a href="#cb4-3020" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;card-number&quot;&gt;#</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>recent_badge<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>attachments_badge<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb4-3021"><a href="#cb4-3021" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;card-actions&quot;&gt;</span></span>
<span id="cb4-3022"><a href="#cb4-3022" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_markdown/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.md&quot; class=&quot;action-btn-small&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üìÑ MD&lt;/a&gt;</span></span>
<span id="cb4-3023"><a href="#cb4-3023" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_html/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&quot; class=&quot;action-btn-small html-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üåê HTML&lt;/a&gt;</span></span>
<span id="cb4-3024"><a href="#cb4-3024" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_pdfs/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.pdf&quot; class=&quot;action-btn-small pdf-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üìä PDF&lt;/a&gt;</span></span>
<span id="cb4-3025"><a href="#cb4-3025" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;/div&gt;</span></span>
<span id="cb4-3026"><a href="#cb4-3026" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb4-3027"><a href="#cb4-3027" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-title&quot; onclick=&quot;openHTML(&#39;</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&#39;)&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb4-3028"><a href="#cb4-3028" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div&gt;</span></span>
<span id="cb4-3029"><a href="#cb4-3029" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span class=&quot;card-source&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb4-3030"><a href="#cb4-3030" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span class=&quot;category-badge&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;category&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb4-3031"><a href="#cb4-3031" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb4-3032"><a href="#cb4-3032" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-summary&quot; onclick=&quot;openHTML(&#39;</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&#39;)&quot;&gt;</span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb4-3033"><a href="#cb4-3033" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-meta&quot;&gt;</span></span>
<span id="cb4-3034"><a href="#cb4-3034" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span&gt;üìÖ </span><span class="sc">{</span>conv<span class="sc">.</span>get(<span class="st">&#39;updated_at&#39;</span>) <span class="kw">or</span> conv<span class="sc">.</span>get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb4-3035"><a href="#cb4-3035" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span&gt;üí¨ </span><span class="sc">{</span><span class="bu">len</span>(conv[<span class="st">&#39;messages&#39;</span>])<span class="sc">}</span><span class="ss"> mensagens&lt;/span&gt;</span></span>
<span id="cb4-3036"><a href="#cb4-3036" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb4-3037"><a href="#cb4-3037" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb4-3038"><a href="#cb4-3038" aria-hidden="true" tabindex="-1"></a><span class="ss">            &quot;&quot;&quot;</span></span>
<span id="cb4-3039"><a href="#cb4-3039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3040"><a href="#cb4-3040" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb4-3041"><a href="#cb4-3041" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb4-3042"><a href="#cb4-3042" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/div&gt;</span></span>
<span id="cb4-3043"><a href="#cb4-3043" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb4-3044"><a href="#cb4-3044" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;script&gt;</span></span>
<span id="cb4-3045"><a href="#cb4-3045" aria-hidden="true" tabindex="-1"></a><span class="st">        let currentFilter = { source: &#39;todas&#39;, category: &#39;todas&#39; };</span></span>
<span id="cb4-3046"><a href="#cb4-3046" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb4-3047"><a href="#cb4-3047" aria-hidden="true" tabindex="-1"></a><span class="st">        document.addEventListener(&#39;DOMContentLoaded&#39;, function() {</span></span>
<span id="cb4-3048"><a href="#cb4-3048" aria-hidden="true" tabindex="-1"></a><span class="st">            updateStats();</span></span>
<span id="cb4-3049"><a href="#cb4-3049" aria-hidden="true" tabindex="-1"></a><span class="st">            initializeDarkMode();</span></span>
<span id="cb4-3050"><a href="#cb4-3050" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb4-3051"><a href="#cb4-3051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3052"><a href="#cb4-3052" aria-hidden="true" tabindex="-1"></a><span class="st">        // Filtros por fonte</span></span>
<span id="cb4-3053"><a href="#cb4-3053" aria-hidden="true" tabindex="-1"></a><span class="st">        document.querySelectorAll(&#39;[data-filter-source]&#39;).forEach(btn =&gt; {</span></span>
<span id="cb4-3054"><a href="#cb4-3054" aria-hidden="true" tabindex="-1"></a><span class="st">            btn.addEventListener(&#39;click&#39;, () =&gt; {</span></span>
<span id="cb4-3055"><a href="#cb4-3055" aria-hidden="true" tabindex="-1"></a><span class="st">                document.querySelectorAll(&#39;[data-filter-source]&#39;).forEach(b =&gt; b.classList.remove(&#39;active&#39;));</span></span>
<span id="cb4-3056"><a href="#cb4-3056" aria-hidden="true" tabindex="-1"></a><span class="st">                btn.classList.add(&#39;active&#39;);</span></span>
<span id="cb4-3057"><a href="#cb4-3057" aria-hidden="true" tabindex="-1"></a><span class="st">                currentFilter.source = btn.getAttribute(&#39;data-filter-source&#39;);</span></span>
<span id="cb4-3058"><a href="#cb4-3058" aria-hidden="true" tabindex="-1"></a><span class="st">                filterConversations();</span></span>
<span id="cb4-3059"><a href="#cb4-3059" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb4-3060"><a href="#cb4-3060" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb4-3061"><a href="#cb4-3061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3062"><a href="#cb4-3062" aria-hidden="true" tabindex="-1"></a><span class="st">        // Filtros por categoria</span></span>
<span id="cb4-3063"><a href="#cb4-3063" aria-hidden="true" tabindex="-1"></a><span class="st">        document.querySelectorAll(&#39;[data-filter-category]&#39;).forEach(btn =&gt; {</span></span>
<span id="cb4-3064"><a href="#cb4-3064" aria-hidden="true" tabindex="-1"></a><span class="st">            btn.addEventListener(&#39;click&#39;, () =&gt; {</span></span>
<span id="cb4-3065"><a href="#cb4-3065" aria-hidden="true" tabindex="-1"></a><span class="st">                document.querySelectorAll(&#39;[data-filter-category]&#39;).forEach(b =&gt; b.classList.remove(&#39;active&#39;));</span></span>
<span id="cb4-3066"><a href="#cb4-3066" aria-hidden="true" tabindex="-1"></a><span class="st">                btn.classList.add(&#39;active&#39;);</span></span>
<span id="cb4-3067"><a href="#cb4-3067" aria-hidden="true" tabindex="-1"></a><span class="st">                currentFilter.category = btn.getAttribute(&#39;data-filter-category&#39;);</span></span>
<span id="cb4-3068"><a href="#cb4-3068" aria-hidden="true" tabindex="-1"></a><span class="st">                filterConversations();</span></span>
<span id="cb4-3069"><a href="#cb4-3069" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb4-3070"><a href="#cb4-3070" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb4-3071"><a href="#cb4-3071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3072"><a href="#cb4-3072" aria-hidden="true" tabindex="-1"></a><span class="st">        document.getElementById(&#39;searchInput&#39;).addEventListener(&#39;input&#39;, filterConversations);</span></span>
<span id="cb4-3073"><a href="#cb4-3073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3074"><a href="#cb4-3074" aria-hidden="true" tabindex="-1"></a><span class="st">        function filterConversations() {</span></span>
<span id="cb4-3075"><a href="#cb4-3075" aria-hidden="true" tabindex="-1"></a><span class="st">            const term = document.getElementById(&#39;searchInput&#39;).value.toLowerCase();</span></span>
<span id="cb4-3076"><a href="#cb4-3076" aria-hidden="true" tabindex="-1"></a><span class="st">            const cards = document.querySelectorAll(&#39;.conversation-card&#39;);</span></span>
<span id="cb4-3077"><a href="#cb4-3077" aria-hidden="true" tabindex="-1"></a><span class="st">            let visible = 0;</span></span>
<span id="cb4-3078"><a href="#cb4-3078" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-3079"><a href="#cb4-3079" aria-hidden="true" tabindex="-1"></a><span class="st">            cards.forEach(card =&gt; {</span></span>
<span id="cb4-3080"><a href="#cb4-3080" aria-hidden="true" tabindex="-1"></a><span class="st">                const title = card.getAttribute(&#39;data-title&#39;).toLowerCase();</span></span>
<span id="cb4-3081"><a href="#cb4-3081" aria-hidden="true" tabindex="-1"></a><span class="st">                const summary = card.getAttribute(&#39;data-summary&#39;).toLowerCase();</span></span>
<span id="cb4-3082"><a href="#cb4-3082" aria-hidden="true" tabindex="-1"></a><span class="st">                const source = card.getAttribute(&#39;data-source&#39;).toLowerCase();</span></span>
<span id="cb4-3083"><a href="#cb4-3083" aria-hidden="true" tabindex="-1"></a><span class="st">                const category = card.getAttribute(&#39;data-category&#39;).toLowerCase();</span></span>
<span id="cb4-3084"><a href="#cb4-3084" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb4-3085"><a href="#cb4-3085" aria-hidden="true" tabindex="-1"></a><span class="st">                const matchesSearch = (title.includes(term) || summary.includes(term) || category.includes(term) || source.includes(term));</span></span>
<span id="cb4-3086"><a href="#cb4-3086" aria-hidden="true" tabindex="-1"></a><span class="st">                const matchesSource = (currentFilter.source === &#39;todas&#39; || source === currentFilter.source.toLowerCase());</span></span>
<span id="cb4-3087"><a href="#cb4-3087" aria-hidden="true" tabindex="-1"></a><span class="st">                const matchesCategory = (currentFilter.category === &#39;todas&#39; || category === currentFilter.category.toLowerCase());</span></span>
<span id="cb4-3088"><a href="#cb4-3088" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb4-3089"><a href="#cb4-3089" aria-hidden="true" tabindex="-1"></a><span class="st">                if (matchesSearch &amp;&amp; matchesSource &amp;&amp; matchesCategory) {</span></span>
<span id="cb4-3090"><a href="#cb4-3090" aria-hidden="true" tabindex="-1"></a><span class="st">                    card.style.display = &#39;block&#39;;</span></span>
<span id="cb4-3091"><a href="#cb4-3091" aria-hidden="true" tabindex="-1"></a><span class="st">                    visible++;</span></span>
<span id="cb4-3092"><a href="#cb4-3092" aria-hidden="true" tabindex="-1"></a><span class="st">                } else {</span></span>
<span id="cb4-3093"><a href="#cb4-3093" aria-hidden="true" tabindex="-1"></a><span class="st">                    card.style.display = &#39;none&#39;;</span></span>
<span id="cb4-3094"><a href="#cb4-3094" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb4-3095"><a href="#cb4-3095" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb4-3096"><a href="#cb4-3096" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-3097"><a href="#cb4-3097" aria-hidden="true" tabindex="-1"></a><span class="st">            updateStats(visible);</span></span>
<span id="cb4-3098"><a href="#cb4-3098" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-3099"><a href="#cb4-3099" aria-hidden="true" tabindex="-1"></a><span class="st">            const grid = document.getElementById(&#39;conversationsGrid&#39;);</span></span>
<span id="cb4-3100"><a href="#cb4-3100" aria-hidden="true" tabindex="-1"></a><span class="st">            const noResults = document.getElementById(&#39;no-results-message&#39;);</span></span>
<span id="cb4-3101"><a href="#cb4-3101" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-3102"><a href="#cb4-3102" aria-hidden="true" tabindex="-1"></a><span class="st">            if (visible === 0) {</span></span>
<span id="cb4-3103"><a href="#cb4-3103" aria-hidden="true" tabindex="-1"></a><span class="st">                if (!noResults) {</span></span>
<span id="cb4-3104"><a href="#cb4-3104" aria-hidden="true" tabindex="-1"></a><span class="st">                    const noResultsMsg = document.createElement(&#39;div&#39;);</span></span>
<span id="cb4-3105"><a href="#cb4-3105" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.id = &#39;no-results-message&#39;;</span></span>
<span id="cb4-3106"><a href="#cb4-3106" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.className = &#39;no-results&#39;;</span></span>
<span id="cb4-3107"><a href="#cb4-3107" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.innerHTML = &#39;üîç Nenhuma conversa encontrada. Tente ajustar os filtros ou a pesquisa.&#39;;</span></span>
<span id="cb4-3108"><a href="#cb4-3108" aria-hidden="true" tabindex="-1"></a><span class="st">                    grid.appendChild(noResultsMsg);</span></span>
<span id="cb4-3109"><a href="#cb4-3109" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb4-3110"><a href="#cb4-3110" aria-hidden="true" tabindex="-1"></a><span class="st">            } else if (noResults) {</span></span>
<span id="cb4-3111"><a href="#cb4-3111" aria-hidden="true" tabindex="-1"></a><span class="st">                noResults.remove();</span></span>
<span id="cb4-3112"><a href="#cb4-3112" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-3113"><a href="#cb4-3113" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb4-3114"><a href="#cb4-3114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3115"><a href="#cb4-3115" aria-hidden="true" tabindex="-1"></a><span class="st">        function updateStats(visibleCount = null) {</span></span>
<span id="cb4-3116"><a href="#cb4-3116" aria-hidden="true" tabindex="-1"></a><span class="st">            // Atualizar contador se fornecido</span></span>
<span id="cb4-3117"><a href="#cb4-3117" aria-hidden="true" tabindex="-1"></a><span class="st">            if (visibleCount !== null) {</span></span>
<span id="cb4-3118"><a href="#cb4-3118" aria-hidden="true" tabindex="-1"></a><span class="st">                // Poderia atualizar algum elemento de estat√≠stica se necess√°rio</span></span>
<span id="cb4-3119"><a href="#cb4-3119" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-3120"><a href="#cb4-3120" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb4-3121"><a href="#cb4-3121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3122"><a href="#cb4-3122" aria-hidden="true" tabindex="-1"></a><span class="st">        function openHTML(filename) {</span></span>
<span id="cb4-3123"><a href="#cb4-3123" aria-hidden="true" tabindex="-1"></a><span class="st">            const htmlUrl = &#39;combined_html/&#39; + filename;</span></span>
<span id="cb4-3124"><a href="#cb4-3124" aria-hidden="true" tabindex="-1"></a><span class="st">            console.log(&#39;Abrindo HTML:&#39;, htmlUrl);</span></span>
<span id="cb4-3125"><a href="#cb4-3125" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(htmlUrl, &#39;_blank&#39;);</span></span>
<span id="cb4-3126"><a href="#cb4-3126" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb4-3127"><a href="#cb4-3127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3128"><a href="#cb4-3128" aria-hidden="true" tabindex="-1"></a><span class="st">        function clearCache() {</span></span>
<span id="cb4-3129"><a href="#cb4-3129" aria-hidden="true" tabindex="-1"></a><span class="st">            if (confirm(&#39;Limpar cache de convers√µes? Isso for√ßar√° a reconvers√£o de todos os arquivos HTML na pr√≥xima execu√ß√£o.&#39;)) {</span></span>
<span id="cb4-3130"><a href="#cb4-3130" aria-hidden="true" tabindex="-1"></a><span class="st">                fetch(&#39;?action=clear_cache&#39;).then(() =&gt; {</span></span>
<span id="cb4-3131"><a href="#cb4-3131" aria-hidden="true" tabindex="-1"></a><span class="st">                    alert(&#39;Cache limpo com sucesso!&#39;);</span></span>
<span id="cb4-3132"><a href="#cb4-3132" aria-hidden="true" tabindex="-1"></a><span class="st">                }).catch(() =&gt; {</span></span>
<span id="cb4-3133"><a href="#cb4-3133" aria-hidden="true" tabindex="-1"></a><span class="st">                    alert(&#39;Erro ao limpar cache. Execute o programa com --clear-cache.&#39;);</span></span>
<span id="cb4-3134"><a href="#cb4-3134" aria-hidden="true" tabindex="-1"></a><span class="st">                });</span></span>
<span id="cb4-3135"><a href="#cb4-3135" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-3136"><a href="#cb4-3136" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb4-3137"><a href="#cb4-3137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3138"><a href="#cb4-3138" aria-hidden="true" tabindex="-1"></a><span class="st">        function exportStats() {</span></span>
<span id="cb4-3139"><a href="#cb4-3139" aria-hidden="true" tabindex="-1"></a><span class="st">            const stats = {</span></span>
<span id="cb4-3140"><a href="#cb4-3140" aria-hidden="true" tabindex="-1"></a><span class="st">                total: &quot;&quot;&quot;</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(<span class="va">self</span>.all_conversations)) <span class="op">+</span> <span class="st">&quot;&quot;&quot;,</span></span>
<span id="cb4-3141"><a href="#cb4-3141" aria-hidden="true" tabindex="-1"></a><span class="st">                sources: &quot;&quot;&quot;</span> <span class="op">+</span> <span class="bu">str</span>(source_stats) <span class="op">+</span> <span class="st">&quot;&quot;&quot;,</span></span>
<span id="cb4-3142"><a href="#cb4-3142" aria-hidden="true" tabindex="-1"></a><span class="st">                categories: &quot;&quot;&quot;</span> <span class="op">+</span> <span class="bu">str</span>(category_stats) <span class="op">+</span> <span class="st">&quot;&quot;&quot;,</span></span>
<span id="cb4-3143"><a href="#cb4-3143" aria-hidden="true" tabindex="-1"></a><span class="st">                recent: &quot;&quot;&quot;</span> <span class="op">+</span> <span class="bu">str</span>(recent_stats) <span class="op">+</span> <span class="st">&quot;&quot;&quot;,</span></span>
<span id="cb4-3144"><a href="#cb4-3144" aria-hidden="true" tabindex="-1"></a><span class="st">                export_time: new Date().toISOString()</span></span>
<span id="cb4-3145"><a href="#cb4-3145" aria-hidden="true" tabindex="-1"></a><span class="st">            };</span></span>
<span id="cb4-3146"><a href="#cb4-3146" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb4-3147"><a href="#cb4-3147" aria-hidden="true" tabindex="-1"></a><span class="st">            const dataStr = &quot;data:text/json;charset=utf-8,&quot; + encodeURIComponent(JSON.stringify(stats, null, 2));</span></span>
<span id="cb4-3148"><a href="#cb4-3148" aria-hidden="true" tabindex="-1"></a><span class="st">            const downloadAnchorNode = document.createElement(&#39;a&#39;);</span></span>
<span id="cb4-3149"><a href="#cb4-3149" aria-hidden="true" tabindex="-1"></a><span class="st">            downloadAnchorNode.setAttribute(&quot;href&quot;, dataStr);</span></span>
<span id="cb4-3150"><a href="#cb4-3150" aria-hidden="true" tabindex="-1"></a><span class="st">            downloadAnchorNode.setAttribute(&quot;download&quot;, &quot;chat_stats_&quot; + new Date().toISOString().split(&#39;T&#39;)[0] + &quot;.json&quot;);</span></span>
<span id="cb4-3151"><a href="#cb4-3151" aria-hidden="true" tabindex="-1"></a><span class="st">            document.body.appendChild(downloadAnchorNode);</span></span>
<span id="cb4-3152"><a href="#cb4-3152" aria-hidden="true" tabindex="-1"></a><span class="st">            downloadAnchorNode.click();</span></span>
<span id="cb4-3153"><a href="#cb4-3153" aria-hidden="true" tabindex="-1"></a><span class="st">            downloadAnchorNode.remove();</span></span>
<span id="cb4-3154"><a href="#cb4-3154" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb4-3155"><a href="#cb4-3155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3156"><a href="#cb4-3156" aria-hidden="true" tabindex="-1"></a><span class="st">        function toggleDarkMode() {</span></span>
<span id="cb4-3157"><a href="#cb4-3157" aria-hidden="true" tabindex="-1"></a><span class="st">            document.body.classList.toggle(&#39;dark-mode&#39;);</span></span>
<span id="cb4-3158"><a href="#cb4-3158" aria-hidden="true" tabindex="-1"></a><span class="st">            localStorage.setItem(&#39;darkMode&#39;, document.body.classList.contains(&#39;dark-mode&#39;));</span></span>
<span id="cb4-3159"><a href="#cb4-3159" aria-hidden="true" tabindex="-1"></a><span class="st">            applyDarkModeStyles();</span></span>
<span id="cb4-3160"><a href="#cb4-3160" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb4-3161"><a href="#cb4-3161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3162"><a href="#cb4-3162" aria-hidden="true" tabindex="-1"></a><span class="st">        function initializeDarkMode() {</span></span>
<span id="cb4-3163"><a href="#cb4-3163" aria-hidden="true" tabindex="-1"></a><span class="st">            if (localStorage.getItem(&#39;darkMode&#39;) === &#39;true&#39;) {</span></span>
<span id="cb4-3164"><a href="#cb4-3164" aria-hidden="true" tabindex="-1"></a><span class="st">                document.body.classList.add(&#39;dark-mode&#39;);</span></span>
<span id="cb4-3165"><a href="#cb4-3165" aria-hidden="true" tabindex="-1"></a><span class="st">                applyDarkModeStyles();</span></span>
<span id="cb4-3166"><a href="#cb4-3166" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-3167"><a href="#cb4-3167" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb4-3168"><a href="#cb4-3168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3169"><a href="#cb4-3169" aria-hidden="true" tabindex="-1"></a><span class="st">        function applyDarkModeStyles() {</span></span>
<span id="cb4-3170"><a href="#cb4-3170" aria-hidden="true" tabindex="-1"></a><span class="st">            if (document.body.classList.contains(&#39;dark-mode&#39;)) {</span></span>
<span id="cb4-3171"><a href="#cb4-3171" aria-hidden="true" tabindex="-1"></a><span class="st">                // Estilos para modo escuro</span></span>
<span id="cb4-3172"><a href="#cb4-3172" aria-hidden="true" tabindex="-1"></a><span class="st">                const darkStyles = `</span></span>
<span id="cb4-3173"><a href="#cb4-3173" aria-hidden="true" tabindex="-1"></a><span class="st">                    body {</span></span>
<span id="cb4-3174"><a href="#cb4-3174" aria-hidden="true" tabindex="-1"></a><span class="st">                        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%) !important;</span></span>
<span id="cb4-3175"><a href="#cb4-3175" aria-hidden="true" tabindex="-1"></a><span class="st">                        color: #ecf0f1 !important;</span></span>
<span id="cb4-3176"><a href="#cb4-3176" aria-hidden="true" tabindex="-1"></a><span class="st">                    }</span></span>
<span id="cb4-3177"><a href="#cb4-3177" aria-hidden="true" tabindex="-1"></a><span class="st">                    .container {</span></span>
<span id="cb4-3178"><a href="#cb4-3178" aria-hidden="true" tabindex="-1"></a><span class="st">                        background: #2c3e50 !important;</span></span>
<span id="cb4-3179"><a href="#cb4-3179" aria-hidden="true" tabindex="-1"></a><span class="st">                        color: #ecf0f1 !important;</span></span>
<span id="cb4-3180"><a href="#cb4-3180" aria-hidden="true" tabindex="-1"></a><span class="st">                    }</span></span>
<span id="cb4-3181"><a href="#cb4-3181" aria-hidden="true" tabindex="-1"></a><span class="st">                    .conversation-card {</span></span>
<span id="cb4-3182"><a href="#cb4-3182" aria-hidden="true" tabindex="-1"></a><span class="st">                        background: #34495e !important;</span></span>
<span id="cb4-3183"><a href="#cb4-3183" aria-hidden="true" tabindex="-1"></a><span class="st">                        color: #ecf0f1 !important;</span></span>
<span id="cb4-3184"><a href="#cb4-3184" aria-hidden="true" tabindex="-1"></a><span class="st">                        border-color: #4a6572 !important;</span></span>
<span id="cb4-3185"><a href="#cb4-3185" aria-hidden="true" tabindex="-1"></a><span class="st">                    }</span></span>
<span id="cb4-3186"><a href="#cb4-3186" aria-hidden="true" tabindex="-1"></a><span class="st">                    .card-title, .card-summary {</span></span>
<span id="cb4-3187"><a href="#cb4-3187" aria-hidden="true" tabindex="-1"></a><span class="st">                        color: #ecf0f1 !important;</span></span>
<span id="cb4-3188"><a href="#cb4-3188" aria-hidden="true" tabindex="-1"></a><span class="st">                    }</span></span>
<span id="cb4-3189"><a href="#cb4-3189" aria-hidden="true" tabindex="-1"></a><span class="st">                    .search-box {</span></span>
<span id="cb4-3190"><a href="#cb4-3190" aria-hidden="true" tabindex="-1"></a><span class="st">                        background: #34495e !important;</span></span>
<span id="cb4-3191"><a href="#cb4-3191" aria-hidden="true" tabindex="-1"></a><span class="st">                        color: #ecf0f1 !important;</span></span>
<span id="cb4-3192"><a href="#cb4-3192" aria-hidden="true" tabindex="-1"></a><span class="st">                        border-color: #4a6572 !important;</span></span>
<span id="cb4-3193"><a href="#cb4-3193" aria-hidden="true" tabindex="-1"></a><span class="st">                    }</span></span>
<span id="cb4-3194"><a href="#cb4-3194" aria-hidden="true" tabindex="-1"></a><span class="st">                `;</span></span>
<span id="cb4-3195"><a href="#cb4-3195" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb4-3196"><a href="#cb4-3196" aria-hidden="true" tabindex="-1"></a><span class="st">                let styleElement = document.getElementById(&#39;dark-mode-styles&#39;);</span></span>
<span id="cb4-3197"><a href="#cb4-3197" aria-hidden="true" tabindex="-1"></a><span class="st">                if (!styleElement) {</span></span>
<span id="cb4-3198"><a href="#cb4-3198" aria-hidden="true" tabindex="-1"></a><span class="st">                    styleElement = document.createElement(&#39;style&#39;);</span></span>
<span id="cb4-3199"><a href="#cb4-3199" aria-hidden="true" tabindex="-1"></a><span class="st">                    styleElement.id = &#39;dark-mode-styles&#39;;</span></span>
<span id="cb4-3200"><a href="#cb4-3200" aria-hidden="true" tabindex="-1"></a><span class="st">                    document.head.appendChild(styleElement);</span></span>
<span id="cb4-3201"><a href="#cb4-3201" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb4-3202"><a href="#cb4-3202" aria-hidden="true" tabindex="-1"></a><span class="st">                styleElement.textContent = darkStyles;</span></span>
<span id="cb4-3203"><a href="#cb4-3203" aria-hidden="true" tabindex="-1"></a><span class="st">            } else {</span></span>
<span id="cb4-3204"><a href="#cb4-3204" aria-hidden="true" tabindex="-1"></a><span class="st">                const styleElement = document.getElementById(&#39;dark-mode-styles&#39;);</span></span>
<span id="cb4-3205"><a href="#cb4-3205" aria-hidden="true" tabindex="-1"></a><span class="st">                if (styleElement) {</span></span>
<span id="cb4-3206"><a href="#cb4-3206" aria-hidden="true" tabindex="-1"></a><span class="st">                    styleElement.remove();</span></span>
<span id="cb4-3207"><a href="#cb4-3207" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb4-3208"><a href="#cb4-3208" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-3209"><a href="#cb4-3209" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb4-3210"><a href="#cb4-3210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3211"><a href="#cb4-3211" aria-hidden="true" tabindex="-1"></a><span class="st">        document.addEventListener(&#39;keydown&#39;, function(e) {</span></span>
<span id="cb4-3212"><a href="#cb4-3212" aria-hidden="true" tabindex="-1"></a><span class="st">            if (e.key === &#39;Escape&#39;) {</span></span>
<span id="cb4-3213"><a href="#cb4-3213" aria-hidden="true" tabindex="-1"></a><span class="st">                document.getElementById(&#39;searchInput&#39;).value = &#39;&#39;;</span></span>
<span id="cb4-3214"><a href="#cb4-3214" aria-hidden="true" tabindex="-1"></a><span class="st">                filterConversations();</span></span>
<span id="cb4-3215"><a href="#cb4-3215" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb4-3216"><a href="#cb4-3216" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb4-3217"><a href="#cb4-3217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3218"><a href="#cb4-3218" aria-hidden="true" tabindex="-1"></a><span class="st">        document.querySelectorAll(&#39;.conversation-card&#39;).forEach(card =&gt; {</span></span>
<span id="cb4-3219"><a href="#cb4-3219" aria-hidden="true" tabindex="-1"></a><span class="st">            card.addEventListener(&#39;click&#39;, function(e) {</span></span>
<span id="cb4-3220"><a href="#cb4-3220" aria-hidden="true" tabindex="-1"></a><span class="st">                if (e.target.closest(&#39;.action-btn-small&#39;)) {</span></span>
<span id="cb4-3221"><a href="#cb4-3221" aria-hidden="true" tabindex="-1"></a><span class="st">                    return;</span></span>
<span id="cb4-3222"><a href="#cb4-3222" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb4-3223"><a href="#cb4-3223" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb4-3224"><a href="#cb4-3224" aria-hidden="true" tabindex="-1"></a><span class="st">                const htmlBtn = this.querySelector(&#39;a.html-btn&#39;);</span></span>
<span id="cb4-3225"><a href="#cb4-3225" aria-hidden="true" tabindex="-1"></a><span class="st">                if (htmlBtn) {</span></span>
<span id="cb4-3226"><a href="#cb4-3226" aria-hidden="true" tabindex="-1"></a><span class="st">                    const htmlUrl = htmlBtn.getAttribute(&#39;href&#39;);</span></span>
<span id="cb4-3227"><a href="#cb4-3227" aria-hidden="true" tabindex="-1"></a><span class="st">                    window.open(htmlUrl, &#39;_blank&#39;);</span></span>
<span id="cb4-3228"><a href="#cb4-3228" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb4-3229"><a href="#cb4-3229" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb4-3230"><a href="#cb4-3230" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb4-3231"><a href="#cb4-3231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3232"><a href="#cb4-3232" aria-hidden="true" tabindex="-1"></a><span class="st">        document.getElementById(&#39;searchInput&#39;).focus();</span></span>
<span id="cb4-3233"><a href="#cb4-3233" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb4-3234"><a href="#cb4-3234" aria-hidden="true" tabindex="-1"></a><span class="st">        console.log(&#39;√çndice v8.1 carregado com&#39;, &quot;&quot;&quot;</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(<span class="va">self</span>.all_conversations)) <span class="op">+</span> <span class="st">&quot;&quot;&quot;, &#39;conversas&#39;);</span></span>
<span id="cb4-3235"><a href="#cb4-3235" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/script&gt;</span></span>
<span id="cb4-3236"><a href="#cb4-3236" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/body&gt;</span></span>
<span id="cb4-3237"><a href="#cb4-3237" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/html&gt;</span></span>
<span id="cb4-3238"><a href="#cb4-3238" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb4-3239"><a href="#cb4-3239" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-3240"><a href="#cb4-3240" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.index_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb4-3241"><a href="#cb4-3241" aria-hidden="true" tabindex="-1"></a>            f.write(html_content)</span>
<span id="cb4-3242"><a href="#cb4-3242" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ √çndice combinado v8.1 criado: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-3243"><a href="#cb4-3243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3244"><a href="#cb4-3244" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb4-3245"><a href="#cb4-3245" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser(</span>
<span id="cb4-3246"><a href="#cb4-3246" aria-hidden="true" tabindex="-1"></a>        description<span class="op">=</span><span class="st">&quot;Processa exporta√ß√µes combinadas com exporta√ß√£o HTML via Pandoc v8.1 - COM ANEXOS, CACHE E UNICODE AVAN√áADO&quot;</span></span>
<span id="cb4-3247"><a href="#cb4-3247" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-3248"><a href="#cb4-3248" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">&quot;--dry-run&quot;</span>, action<span class="op">=</span><span class="st">&quot;store_true&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Executa sem salvar arquivos&quot;</span>)</span>
<span id="cb4-3249"><a href="#cb4-3249" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">&quot;--force-overwrite&quot;</span>, action<span class="op">=</span><span class="st">&quot;store_true&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Substitui arquivos existentes&quot;</span>)</span>
<span id="cb4-3250"><a href="#cb4-3250" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">&quot;--clear-cache&quot;</span>, action<span class="op">=</span><span class="st">&quot;store_true&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Limpa o cache de convers√µes&quot;</span>)</span>
<span id="cb4-3251"><a href="#cb4-3251" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-3252"><a href="#cb4-3252" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb4-3253"><a href="#cb4-3253" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-3254"><a href="#cb4-3254" aria-hidden="true" tabindex="-1"></a>    system <span class="op">=</span> CombinedFragmentsSystem(</span>
<span id="cb4-3255"><a href="#cb4-3255" aria-hidden="true" tabindex="-1"></a>        dry_run<span class="op">=</span>args.dry_run,</span>
<span id="cb4-3256"><a href="#cb4-3256" aria-hidden="true" tabindex="-1"></a>        force_overwrite<span class="op">=</span>args.force_overwrite,</span>
<span id="cb4-3257"><a href="#cb4-3257" aria-hidden="true" tabindex="-1"></a>        clear_cache<span class="op">=</span>args.clear_cache</span>
<span id="cb4-3258"><a href="#cb4-3258" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-3259"><a href="#cb4-3259" aria-hidden="true" tabindex="-1"></a>    system.run()</span>
<span id="cb4-3260"><a href="#cb4-3260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3261"><a href="#cb4-3261" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb4-3262"><a href="#cb4-3262" aria-hidden="true" tabindex="-1"></a>    main()</span></code></pre></div>
<p><strong>Principais melhorias implementadas:</strong></p>
<ol type="1">
<li><strong>TOC Fixo √† Direita</strong>:
<ul>
<li>Agora o TOC fica fixo no lado direito da tela</li>
<li>Sempre vis√≠vel durante o scroll</li>
<li>Posicionado verticalmente no centro da tela</li>
</ul></li>
<li><strong>Melhorias de UX</strong>:
<ul>
<li>Bot√£o de minimizar/expandir no TOC</li>
<li>Efeitos de transi√ß√£o suaves</li>
<li>Fundo com blur para melhor legibilidade</li>
</ul></li>
<li><strong>Responsividade</strong>:
<ul>
<li>Em telas menores (&lt;768px), o TOC volta ao fluxo normal</li>
<li>Ajustes autom√°ticos de margens</li>
</ul></li>
<li><strong>Corre√ß√£o dos Warnings</strong>:
<ul>
<li>Mant√©m a funcionalidade de download de imagens</li>
<li>Os warnings sobre falha de DNS s√£o normais quando n√£o h√°
internet</li>
</ul></li>
</ol>
<p>O sistema agora garante que o TOC esteja sempre vis√≠vel e acess√≠vel,
melhorando significativamente a experi√™ncia de navega√ß√£o nos documentos
HTML gerados.</p>
<hr />
<p><em>Conversa exportada do DeepSeek</em> <em>Processado em: 15/11/2025
22:27</em></p>

        <script id="fixed-toc-script">
        document.addEventListener('DOMContentLoaded', function() {
            const toc = document.getElementById('TOC');
            if (toc) {
                const tocTitle = toc.querySelector('h2');
                if (tocTitle) {
                    const toggleBtn = document.createElement('button');
                    toggleBtn.innerHTML = '‚ò∞';
                    toggleBtn.className = 'toc-toggle-btn';
                    toggleBtn.title = 'Minimizar/Expandir TOC';
                    let isMinimized = false;
                    toggleBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        isMinimized = !isMinimized;
                        if (isMinimized) {
                            toc.classList.add('toc-minimized');
                        } else {
                            toc.classList.remove('toc-minimized');
                        }
                    });
                    tocTitle.appendChild(toggleBtn);
                }
            }
            
            // SCROLLSPY
            const sections = document.querySelectorAll('h1, h2, h3, h4, h5');
            const tocLinks = document.querySelectorAll('#TOC a');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.getAttribute('id');
                        tocLinks.forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href') === '#' + id) {
                                link.classList.add('active');
                            }
                        });
                    }
                });
            }, { 
                rootMargin: '-20% 0px -60% 0px', 
                threshold: 0 
            });
            
            sections.forEach(section => {
                if (section.id) observer.observe(section);
            });
            
            // Scroll suave
            tocLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        const offsetTop = targetElement.offsetTop - 80;
                        window.scrollTo({ top: offsetTop, behavior: 'smooth' });
                    }
                });
            });
            
            // BOT√ÉO VOLTAR AO TOPO
            const backToTopBtn = document.createElement('button');
            backToTopBtn.className = 'back-to-top-content';
            backToTopBtn.innerHTML = '‚Üë';
            backToTopBtn.title = 'Voltar ao Topo';
            document.body.appendChild(backToTopBtn);
            
            window.addEventListener('scroll', () => {
                if (window.pageYOffset > 300) {
                    backToTopBtn.classList.add('show');
                } else {
                    backToTopBtn.classList.remove('show');
                }
            });
            
            backToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
        </script>
        
</body>
</html>
