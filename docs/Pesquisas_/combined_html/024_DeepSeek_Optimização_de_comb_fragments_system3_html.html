<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>

        <style id="fixed-toc-styles">
        /* === ESTILOS PRINCIPAIS - TOC FIXO √Ä DIREITA === */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
            scroll-behavior: smooth;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            position: relative;
        }
        /* === TOC FIXO √Ä DIREITA - POSI√á√ÉO CORRIGIDA === */
        #TOC {
            position: fixed !important;
            top: 50% !important;
            right: 20px !important;
            transform: translateY(-50%) !important;
            width: 320px !important;
            max-height: 80vh !important;
            overflow-y: auto !important;
            z-index: 1000 !important;
            background: rgba(255, 255, 255, 0.98) !important;
            padding: 20px !important;
            border-radius: 12px !important;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15) !important;
            border: 1px solid #e0e0e0 !important;
            backdrop-filter: blur(10px) !important;
            transition: all 0.3s ease-in-out !important;
        }
        #TOC.toc-minimized {
            transform: translateY(-50%) translateX(calc(320px - 50px)) !important;
            opacity: 0.3;
            width: 50px !important;
            overflow: hidden;
        }
        #TOC.toc-minimized > *:not(.toc-toggle-btn) {
            display: none !important;
        }
        #TOC h2 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            font-size: 1.2em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .toc-toggle-btn {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .toc-toggle-btn:hover {
            background-color: rgba(0,0,0,0.1);
        }
        #TOC ul {
            list-style-type: none;
            padding-left: 15px;
            margin: 10px 0;
        }
        #TOC ul ul {
            padding-left: 20px;
        }
        #TOC li {
            margin: 8px 0;
            line-height: 1.4;
        }
        #TOC a {
            text-decoration: none;
            color: #495057;
            font-weight: 500;
            transition: all 0.2s ease;
            display: block;
            padding: 6px 10px;
            border-radius: 6px;
            border-left: 3px solid transparent;
        }
        #TOC a:hover {
            color: #007bff;
            background-color: rgba(0, 123, 255, 0.1);
            border-left-color: #007bff;
        }
        #TOC a.active {
            background-color: #007bff !important;
            color: white !important;
            font-weight: bold;
            border-left-color: #0056b3;
        }
        /* Conte√∫do principal com margem para o TOC */
        .main-content {
            margin-right: calc(320px + 40px) !important;
        }
        /* Barra de scroll personalizada APENAS para TOC */
        #TOC::-webkit-scrollbar {
            width: 8px;
        }
        #TOC::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        #TOC::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        #TOC::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        /* === BOT√ÉO VOLTAR AO TOPO (HTMLs individuais) === */
        .back-to-top-content {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .back-to-top-content.show {
            opacity: 1;
            transform: translateY(0);
        }
        .back-to-top-content:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }
        /* === RESPONSIVIDADE === */
        @media (max-width: 1400px) {
            .container {
                max-width: 95%;
                padding: 30px;
            }
            #TOC {
                width: 280px !important;
            }
            .main-content {
                margin-right: 320px !important;
            }
        }
        @media (max-width: 1200px) {
            #TOC {
                width: 260px !important;
                right: 15px !important;
            }
            .main-content {
                margin-right: 300px !important;
            }
        }
        @media (max-width: 992px) {
            #TOC {
                position: relative !important;
                width: 100% !important;
                right: 0 !important;
                top: 0 !important;
                transform: none !important;
                margin: 20px 0;
                max-height: 300px !important;
            }
            .main-content {
                margin-right: 0 !important;
            }
            .back-to-top-content {
                right: 20px;
                bottom: 20px;
            }
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px;
                max-width: 100%;
            }
            #TOC {
                max-height: 250px !important;
                padding: 15px !important;
            }
        }
        </style>
        
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>024_DeepSeek_Optimiza√ß√£o_de_comb_fragments_system3_html</title>
  <style>

html {
color: #1a1a1a;
background-color: #fdfdfd;
}
body {
margin: 0 auto;
max-width: 36em;
padding-left: 50px;
padding-right: 50px;
padding-top: 50px;
padding-bottom: 50px;
hyphens: auto;
overflow-wrap: break-word;
text-rendering: optimizeLegibility;
font-kerning: normal;
}
@media (max-width: 600px) {
body {
font-size: 0.9em;
padding: 12px;
}
h1 {
font-size: 1.8em;
}
}
@media print {
html {
background-color: white;
}
body {
background-color: transparent;
color: black;
font-size: 12pt;
}
p, h2, h3 {
orphans: 3;
widows: 3;
}
h2, h3, h4 {
page-break-after: avoid;
}
}
p {
margin: 1em 0;
}
a {
color: #1a1a1a;
}
a:visited {
color: #1a1a1a;
}
img {
max-width: 100%;
}
svg {
height: auto;
max-width: 100%;
}
h1, h2, h3, h4, h5, h6 {
margin-top: 1.4em;
}
h5, h6 {
font-size: 1em;
font-style: italic;
}
h6 {
font-weight: normal;
}
ol, ul {
padding-left: 1.7em;
margin-top: 1em;
}
li > ol, li > ul {
margin-top: 0;
}
blockquote {
margin: 1em 0 1em 1.7em;
padding-left: 1em;
border-left: 2px solid #e6e6e6;
color: #606060;
}
code {
font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
font-size: 85%;
margin: 0;
hyphens: manual;
}
pre {
margin: 1em 0;
overflow: auto;
}
pre code {
padding: 0;
overflow: visible;
overflow-wrap: normal;
}
.sourceCode {
background-color: transparent;
overflow: visible;
}
hr {
border: none;
border-top: 1px solid #1a1a1a;
height: 1px;
margin: 1em 0;
}
table {
margin: 1em 0;
border-collapse: collapse;
width: 100%;
overflow-x: auto;
display: block;
font-variant-numeric: lining-nums tabular-nums;
}
table caption {
margin-bottom: 0.75em;
}
tbody {
margin-top: 0.5em;
border-top: 1px solid #1a1a1a;
border-bottom: 1px solid #1a1a1a;
}
th {
border-top: 1px solid #1a1a1a;
padding: 0.25em 0.5em 0.25em 0.5em;
}
td {
padding: 0.125em 0.5em 0.25em 0.5em;
}
header {
margin-bottom: 4em;
text-align: center;
}
#TOC li {
list-style: none;
}
#TOC ul {
padding-left: 1.3em;
}
#TOC > ul {
padding-left: 0;
}
#TOC a:not(:hover) {
text-decoration: none;
}
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}

ul.task-list[class]{list-style: none;}
ul.task-list li input[type="checkbox"] {
font-size: inherit;
width: 0.8em;
margin: 0 0.8em 0.2em -1.6em;
vertical-align: middle;
}

html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
</head>
<body>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#optimiza√ß√£o-de-comb_fragments_system3_html_export.py" id="toc-optimiza√ß√£o-de-comb_fragments_system3_html_export.py"><span class="toc-section-number">1</span> Optimiza√ß√£o de
comb_fragments_system3_html_export.py</a>
<ul>
<li><a href="#informa√ß√µes" id="toc-informa√ß√µes"><span class="toc-section-number">1.1</span> üìä Informa√ß√µes</a></li>
<li><a href="#conversa" id="toc-conversa"><span class="toc-section-number">1.2</span> üí¨ Conversa</a></li>
<li><a href="#principais-otimiza√ß√µes-implementadas" id="toc-principais-otimiza√ß√µes-implementadas"><span class="toc-section-number">1.3</span> Principais otimiza√ß√µes
implementadas:</a></li>
<li><a href="#comandos-adicionais-recomendados" id="toc-comandos-adicionais-recomendados"><span class="toc-section-number">1.4</span> Comandos adicionais
recomendados:</a></li>
<li><a href="#principais-melhorias-implementadas" id="toc-principais-melhorias-implementadas"><span class="toc-section-number">1.5</span> Principais melhorias
implementadas:</a></li>
<li><a href="#principais-otimiza√ß√µes-implementadas-1" id="toc-principais-otimiza√ß√µes-implementadas-1"><span class="toc-section-number">1.6</span> Principais otimiza√ß√µes
implementadas:</a></li>
<li><a href="#principais-corre√ß√µes-implementadas" id="toc-principais-corre√ß√µes-implementadas"><span class="toc-section-number">1.7</span> Principais corre√ß√µes
implementadas:</a></li>
<li><a href="#resultado" id="toc-resultado"><span class="toc-section-number">1.8</span> Resultado:</a></li>
<li><a href="#principais-corre√ß√µes-para-o-layout" id="toc-principais-corre√ß√µes-para-o-layout"><span class="toc-section-number">1.9</span> Principais corre√ß√µes para o
layout:</a></li>
<li><a href="#principais-corre√ß√µes-de-layout-implementadas" id="toc-principais-corre√ß√µes-de-layout-implementadas"><span class="toc-section-number">1.10</span> Principais corre√ß√µes de layout
implementadas:</a></li>
</ul></li>
</ul>
</nav>
<h1 data-number="1" id="optimiza√ß√£o-de-comb_fragments_system3_html_export.py"><span class="header-section-number">1</span> Optimiza√ß√£o de
comb_fragments_system3_html_export.py</h1>
<h2 data-number="1.1" id="informa√ß√µes"><span class="header-section-number">1.1</span> üìä Informa√ß√µes</h2>
<ul>
<li><strong>N√∫mero:</strong> #24</li>
<li><strong>Origem:</strong> DeepSeek</li>
<li><strong>Categoria:</strong> Outros</li>
<li><strong>ID:</strong> 4427487c-667f-42b5-9189-e738d6efc748</li>
<li><strong>Criada em:</strong> 2025-11-07 19:51:18</li>
<li><strong>Atualizada em:</strong> 2025-11-08 01:57:04</li>
<li><strong>Total de mensagens:</strong> 14</li>
<li><strong>Resumo:</strong> Optimiza√ß√£o de
comb_fragments_system3_html_export.py. Pretendo a optimiza√ß√£o da
convers√£o para html,‚Ä¶</li>
</ul>
<hr />
<h2 data-number="1.2" id="conversa"><span class="header-section-number">1.2</span> üí¨ Conversa</h2>
<h3 data-number="1.2.1" id="utilizador-2025-11-07-195120-deepseek-reasoner"><span class="header-section-number">1.2.1</span> üë§ Utilizador <em>(2025-11-07
19:51:20)</em> <em>[deepseek-reasoner]</em></h3>
<p>Optimiza√ß√£o de comb_fragments_system3_html_export.py. Pretendo a
optimiza√ß√£o da convers√£o para html, com ‚Äìstandalone ‚Äìmathjax
‚Äìembed-resources ‚Äìsyntax-highlighting=pygments ‚Äìto=html5. E usar
‚Äìmathjax=assets/tex-mml-chtml.js; Porque j√° fiz o respectivo download
com: mkdir -p assets; wget ‚Äú<a href="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" class="uri">https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js</a>‚Äù
-O ‚Äúassets/tex-mml-chtml.js‚Äù; (Pesquisas)
D:_DOCS__DOCS___D_C_G_Qwen_Op&gt;dir assets Volume in drive D is
<em>Work</em> Volume Serial Number is 3CB7-A082</p>
<p>Directory of D:_DOCS__DOCS___D_C_G_Qwen_Op</p>
11/07/2025 11:46 AM
<DIR>
. 11/07/2025 11:46 AM
<DIR>
<p>.. 11/07/2025 11:46 AM 1,173,007 tex-mml-chtml.js 1 File(s) 1,173,007
bytes; Se existir mais alguma sujest√£o pretendo essa informa√ß√£o para
melhorar a convers√£o.</p>
<hr />
<h3 data-number="1.2.2" id="deepseek-2025-11-07-195120-deepseek-reasoner"><span class="header-section-number">1.2.2</span> ü§ñ DeepSeek <em>(2025-11-07
19:51:20)</em> <em>[deepseek-reasoner]</em></h3>
<p>Vamos otimizar a convers√£o para HTML no m√©todo
<code>_convert_with_pandoc</code> para usar as op√ß√µes mencionadas,
incluindo o uso do MathJax local.</p>
<p>Altera√ß√µes propostas: 1. Usar <code>--standalone</code> para gerar um
HTML completo. 2. Usar <code>--mathjax</code> apontando para o arquivo
local: <code>--mathjax=assets/tex-mml-chtml.js</code>. 3. Adicionar
<code>--embed-resources</code> para embedar CSS, imagens, etc. (no
entanto, note que isso pode n√£o ser compat√≠vel com a sa√≠da HTML5, e o
Pandoc pode n√£o suportar embedar todos os recursos em HTML5. Vamos
verificar a documenta√ß√£o: normalmente, <code>--embed-resources</code> √©
usado com <code>--self-contained</code> e para HTML4, mas vamos tentar).
4. Usar <code>--syntax-highlighting=pygments</code> para realce de
sintaxe. 5. Usar <code>--to=html5</code>.</p>
<p>No entanto, note que a op√ß√£o <code>--embed-resources</code> √©
suportada apenas em conjunto com <code>--self-contained</code> e para
HTML4. Para HTML5, o Pandoc n√£o suporta embedar recursos no mesmo
arquivo. Portanto, se quisermos um arquivo HTML auto-contido, ter√≠amos
que usar <code>--self-contained</code> e talvez mudar para
<code>html4</code>? Mas n√£o √© o que queremos, porque queremos HTML5.</p>
<p>Alternativa: Vamos usar <code>--self-contained</code> com HTML5? A
documenta√ß√£o do Pandoc diz que <code>--self-contained</code> produz um
HTML4, mas na vers√£o recente do Pandoc, ele pode produzir HTML5 com
<code>--self-contained</code>? Vamos verificar a documenta√ß√£o:</p>
<p>Na vers√£o 2.19.2, a op√ß√£o <code>--self-contained</code> √© suportada
para HTML5, mas note que ela pode n√£o ser totalmente compat√≠vel porque o
HTML5 n√£o suporta a inclus√£o de recursos como CSS e JS na mesma maneira
que o HTML4. No entanto, o Pandoc tenta fazer isso.</p>
<p>Mas note: o MathJax √© um recurso externo. Se usarmos
<code>--self-contained</code>, o Pandoc vai tentar baixar e incorporar o
MathJax? Isso n√£o √© desej√°vel porque o MathJax √© muito grande e complexo
para ser incorporado.</p>
<p>Portanto, vamos reconsiderar:</p>
<ul>
<li>Queremos um arquivo HTML que funcione offline? Sim, mas com o
MathJax local, mas n√£o necessariamente embedado no mesmo arquivo, e sim
como um arquivo separado que est√° na pasta <code>assets</code>.</li>
</ul>
<p>Plano: 1. Usar <code>--mathjax=assets/tex-mml-chtml.js</code> para
apontar para o MathJax local. 2. N√£o usar <code>--embed-resources</code>
porque queremos manter o MathJax como um recurso externo (mesmo que
local) e n√£o embedado no HTML. 3. Usar <code>--standalone</code> para
gerar um HTML completo. 4. Usar
<code>--syntax-highlighting=pygments</code> para realce de sintaxe. 5.
Usar <code>--to=html5</code>.</p>
<p>Al√©m disso, note que o Pandoc pode n√£o suportar a op√ß√£o
<code>--syntax-highlighting=pygments</code>? A op√ß√£o correta √©
<code>--highlight-style=pygments</code>. Vou corrigir.</p>
<p>Vamos ajustar o m√©todo <code>_convert_with_pandoc</code>:</p>
<p>Substituir a chamada do subprocess para usar:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> subprocess.run([</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">str</span>(md_file_path),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji&#39;</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;--mathjax=assets/tex-mml-chtml.js&#39;</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;--highlight-style&#39;</span>, <span class="st">&#39;pygments&#39;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>], capture_output<span class="op">=</span><span class="va">True</span>, text<span class="op">=</span><span class="va">True</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, timeout<span class="op">=</span><span class="dv">60</span>)</span></code></pre></div>
<p>Al√©m disso, note que o arquivo <code>tex-mml-chtml.js</code> est√° na
pasta <code>assets</code> (relativo ao diret√≥rio de trabalho atual).
Portanto, o HTML gerado vai referenciar
<code>assets/tex-mml-chtml.js</code>. Isso significa que, quando abrimos
o HTML, ele vai procurar o MathJax em
<code>assets/tex-mml-chtml.js</code> (relativo ao local do HTML).
Portanto, precisamos garantir que a pasta <code>assets</code> esteja no
mesmo diret√≥rio que o HTML, ou ajustar o caminho.</p>
<p>Como estamos gerando HTML na pasta <code>combined_html</code>, e a
pasta <code>assets</code> est√° no diret√≥rio raiz (onde est√° o script),
ent√£o o caminho relativo from <code>combined_html</code> to
<code>assets</code> √© <code>../assets</code>. Portanto, talvez tenhamos
que ajustar o caminho para <code>../assets/tex-mml-chtml.js</code>.</p>
<p>Mas note: o Pandoc gera um caminho relativo para o MathJax. Se
usarmos <code>--mathjax=assets/tex-mml-chtml.js</code>, o Pandoc vai
gerar:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;assets/tex-mml-chtml.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Isso significa que o HTML vai procurar a pasta <code>assets</code> no
mesmo diret√≥rio que o HTML. Portanto, precisamos copiar a pasta
<code>assets</code> para a pasta <code>combined_html</code>? Ou ent√£o,
podemos ajustar o caminho para
<code>../assets/tex-mml-chtml.js</code>?</p>
<p>Alternativa: Vamos mudar o comando para:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">&#39;--mathjax=../assets/tex-mml-chtml.js&#39;</span>,</span></code></pre></div>
<p>Assim, o HTML gerado na pasta <code>combined_html</code> vai
referenciar o MathJax em <code>../assets/tex-mml-chtml.js</code>.</p>
<p>Mas note: se o HTML for aberto a partir do √≠ndice (que est√° na raiz),
o caminho relativo from o √≠ndice para o assets √©
<code>assets/tex-mml-chtml.js</code>, mas from o HTML (dentro de
<code>combined_html</code>) para o assets √©
<code>../assets/tex-mml-chtml.js</code>. Portanto, o mesmo arquivo
MathJax deve ser acess√≠vel por dois caminhos diferentes? Isso n√£o √©
ideal.</p>
<p>Outra solu√ß√£o: copiar a pasta <code>assets</code> para a pasta
<code>combined_html</code>? Mas a√≠ ter√≠amos duplica√ß√£o.</p>
<p>Ou ent√£o, podemos usar uma estrutura de pastas diferente:</p>
<ul>
<li>Colocar o MathJax em uma pasta <code>assets</code> na raiz e, no
HTML, usar um caminho absoluto (relativo ao sistema de arquivos) n√£o √©
port√°vel.</li>
</ul>
<p>Vamos repensar: o √≠ndice HTML est√° na raiz, e os HTMLs est√£o em
<code>combined_html</code>. O √≠ndice HTML usa o MathJax de
<code>assets/tex-mml-chtml.js</code> (porque o √≠ndice est√° na raiz). J√°
os HTMLs convertidos, se usarem <code>../assets/tex-mml-chtml.js</code>,
v√£o subir um n√≠vel e encontrar a pasta <code>assets</code> na raiz. Isso
funciona.</p>
<p>Portanto, vamos usar
<code>--mathjax=../assets/tex-mml-chtml.js</code> para a convers√£o dos
HTMLs.</p>
<p>Al√©m disso, note que o m√©todo <code>_convert_with_pandoc</code> √©
chamado para cada arquivo Markdown, e o HTML √© salvo em
<code>combined_html</code>. Portanto, o caminho relativo para a raiz
(onde est√° a pasta <code>assets</code>) √© <code>../assets</code>.</p>
<p>Vamos ajustar:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> subprocess.run([</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">str</span>(md_file_path),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji&#39;</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;--mathjax=../assets/tex-mml-chtml.js&#39;</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;--highlight-style&#39;</span>, <span class="st">&#39;pygments&#39;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    ], capture_output<span class="op">=</span><span class="va">True</span>, text<span class="op">=</span><span class="va">True</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, timeout<span class="op">=</span><span class="dv">60</span>)</span></code></pre></div>
<p>Al√©m disso, note que o m√©todo <code>_apply_custom_style</code>
adiciona um estilo CSS personalizado. Vamos garantir que esse estilo n√£o
entre em conflito com o estilo gerado pelo Pandoc. O Pandoc, com
<code>--standalone</code>, j√° gera um estilo CSS para o realce de
sintaxe (pygments) e para o layout. Nosso estilo customizado pode
sobrescrever alguns estilos.</p>
<p>Vamos remover a aplica√ß√£o de estilo customizado? N√£o, porque queremos
um estilo consistente. Mas note que o Pandoc gera um estilo embutido (na
tag <code>&lt;style&gt;</code>) para o realce de sintaxe. Nosso estilo
customizado deve ser aplicado ap√≥s o estilo do Pandoc, para sobrescrever
o que for necess√°rio.</p>
<p>No m√©todo <code>_apply_custom_style</code>, estamos injetando o
estilo customizado no <code>&lt;head&gt;</code>. Isso √© aceit√°vel.</p>
<p>Outra considera√ß√£o: a op√ß√£o <code>--embed-resources</code> n√£o ser√°
usada, ent√£o o HTML gerado n√£o ser√° auto-contido (o MathJax √© um recurso
externo). Mas isso √© aceit√°vel, pois temos o MathJax localmente.</p>
<p>Vamos tamb√©m verificar se o Pandoc est√° gerando o realce de sintaxe
corretamente com o estilo pygments. Se n√£o, podemos ajustar o
<code>--highlight-style</code> para um estilo que preferirmos.</p>
<p>Al√©m disso, note que o m√©todo <code>_convert_with_fallback</code> e
<code>_create_basic_html</code> tamb√©m s√£o usados em caso de falha.
Vamos ajust√°-los para usar o MathJax local? Sim, para consist√™ncia.</p>
<p>No m√©todo <code>_convert_with_fallback</code>, n√£o usamos Pandoc,
ent√£o vamos ajustar o template para usar o MathJax local:</p>
<p>No m√©todo <code>_create_html_template</code> (usado no fallback),
vamos mudar o script do MathJax para:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;../assets/tex-mml-chtml.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Da mesma forma, no m√©todo <code>_create_basic_html</code> (√∫ltimo
recurso), vamos fazer o mesmo.</p>
<p>Vamos fazer essas altera√ß√µes:</p>
<ol type="1">
<li>No m√©todo <code>_convert_with_pandoc</code>, ajustar o comando para
usar <code>--mathjax=../assets/tex-mml-chtml.js</code> e
<code>--highlight-style pygments</code>.</li>
<li>Nos m√©todos <code>_create_html_template</code> e
<code>_create_basic_html</code>, ajustar o script do MathJax para
apontar para <code>../assets/tex-mml-chtml.js</code>.</li>
</ol>
<p>Al√©m disso, note que o √≠ndice HTML (gerado pelo m√©todo
<code>create_searchable_index</code>) usa o MathJax do CDN. Vamos mudar
para local? N√£o √© necess√°rio, porque o √≠ndice n√£o cont√©m f√≥rmulas
matem√°ticas. Mas se quisermos, podemos mudar. No entanto, o √≠ndice n√£o
usa MathJax, ent√£o podemos deixar como est√°.</p>
<p>Vamos implementar as altera√ß√µes:</p>
<ul>
<li>No m√©todo <code>_convert_with_pandoc</code>:
<ul>
<li>Adicionar <code>--mathjax=../assets/tex-mml-chtml.js</code></li>
<li>Adicionar <code>--highlight-style pygments</code></li>
</ul></li>
<li>No m√©todo <code>_create_html_template</code>:
<ul>
<li>Alterar o script do MathJax para:
<code>src=&quot;../assets/tex-mml-chtml.js&quot;</code></li>
</ul></li>
<li>No m√©todo <code>_create_basic_html</code>:
<ul>
<li>Alterar o script do MathJax para:
<code>src=&quot;../assets/tex-mml-chtml.js&quot;</code></li>
</ul></li>
</ul>
<p>Vamos tamb√©m verificar se o caminho <code>../assets</code> √© correto
para a estrutura de pastas.</p>
<p>Estrutura: - Raiz: - assets/tex-mml-chtml.js - combined_html/ (aqui
est√£o os HTMLs) - index.html</p>
<p>Portanto, from um HTML em <code>combined_html</code>, o assets est√°
em <code>../assets</code>.</p>
<p>Agora, vamos ao c√≥digo. Aqui est√° a vers√£o otimizada do c√≥digo com
melhorias na convers√£o HTML:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># comb_fragments_system3_html_export.py (vers√£o otimizada)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> webbrowser</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tempfile</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> traceback</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Any, Optional</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> markdown</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CombinedFragmentsSystem:</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dry_run<span class="op">=</span><span class="va">False</span>, force_overwrite<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_dir <span class="op">=</span> Path(<span class="st">&quot;data&quot;</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dry_run <span class="op">=</span> dry_run</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.force_overwrite <span class="op">=</span> force_overwrite</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assets_dir <span class="op">=</span> Path(<span class="st">&quot;assets&quot;</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configurar logging</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>        logging.basicConfig(level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">&#39;</span>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estrutura de pastas organizada</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dirs <span class="op">=</span> {</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;markdown&#39;</span>: <span class="st">&quot;combined_markdown&quot;</span>,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_csv&quot;</span>, </span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_json&quot;</span>,</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;pdfs&#39;</span>: <span class="st">&quot;combined_pdfs&quot;</span>,</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;html&#39;</span>: <span class="st">&quot;combined_html&quot;</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.single_files <span class="op">=</span> {</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_all_conversations.csv&quot;</span>,</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_all_conversations.json&quot;</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.index_file <span class="op">=</span> <span class="st">&quot;index.html&quot;</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations <span class="op">=</span> []</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configura√ß√£o de processamento por fonte</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.processors <span class="op">=</span> {</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;qwen&#39;</span>: {</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chat-export.json&quot;</span>,</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_qwen_enhanced,</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;chatgpt&#39;</span>: {</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chatgpt.zip&quot;</span>, </span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_chatgpt,</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;deepseek&#39;</span>: {</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;deepseek_data.zip&quot;</span>,</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_deepseek,</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;grok&#39;</span>: {</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;grok.zip&quot;</span>,</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_grok,</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_optimized(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Convers√£o OTIMIZADA com Pandoc usando recursos locais e op√ß√µes avan√ßadas&quot;&quot;&quot;</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Convertendo com Pandoc ot</span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a><span class="er">---</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a><span class="er">### üë§ Utilizador *</span>(<span class="dv">2025</span><span class="op">-</span><span class="dv">11</span><span class="op">-</span><span class="dv">0</span><span class="er">7</span> <span class="dv">19</span>:<span class="dv">54</span>:<span class="dv">32</span>)<span class="op">*</span> <span class="op">*</span>[deepseek<span class="op">-</span>reasoner]<span class="op">*</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>Optimiza√ß√£o de comb_fragments_system3_html_export.py. Pretendo a optimiza√ß√£o da convers√£o para html, com  <span class="op">--</span>standalone <span class="op">--</span>mathjax <span class="op">--</span>embed<span class="op">-</span>resources <span class="op">--</span>syntax<span class="op">-</span>highlighting<span class="op">=</span>pygments <span class="op">--</span>to<span class="op">=</span>html5. E usar <span class="op">--</span>mathjax<span class="op">=</span>assets<span class="op">/</span>tex<span class="op">-</span>mml<span class="op">-</span>chtml.js<span class="op">;</span> Porque j√° fiz o respectivo download com: mkdir <span class="op">-</span>p assets<span class="op">;</span>  wget <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span> <span class="op">-</span>O <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span><span class="op">;</span> (Pesquisas) D:\Downloads\_DOCS_\_DOCS_\Pesquisas__D_C_G_Qwen_Op<span class="op">&gt;</span><span class="bu">dir</span> assets</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a> Volume <span class="kw">in</span> drive D <span class="kw">is</span> _Work_</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a> Volume Serial Number <span class="kw">is</span> <span class="dv">3</span><span class="er">CB7</span><span class="op">-</span>A082</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a> Directory of D:\Downloads\_DOCS_\_DOCS_\Pesquisas__D_C_G_Qwen_Op\assets</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span><span class="op">/</span><span class="dv">0</span><span class="er">7</span><span class="op">/</span><span class="dv">2025</span>  <span class="dv">11</span>:<span class="dv">46</span> AM    <span class="op">&lt;</span>DIR<span class="op">&gt;</span>          .</span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span><span class="op">/</span><span class="dv">0</span><span class="er">7</span><span class="op">/</span><span class="dv">2025</span>  <span class="dv">11</span>:<span class="dv">46</span> AM    <span class="op">&lt;</span>DIR<span class="op">&gt;</span>          ..</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span><span class="op">/</span><span class="dv">0</span><span class="er">7</span><span class="op">/</span><span class="dv">2025</span>  <span class="dv">11</span>:<span class="dv">46</span> AM         <span class="dv">1</span>,<span class="dv">173</span>,<span class="dv">00</span><span class="er">7</span> tex<span class="op">-</span>mml<span class="op">-</span>chtml.js</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>               <span class="dv">1</span> File(s)      <span class="dv">1</span>,<span class="dv">173</span>,<span class="dv">00</span><span class="er">7</span> <span class="bu">bytes</span><span class="op">;</span>  Se existir mais alguma sujest√£o pretendo essa informa√ß√£o para melhorar a convers√£o. Se <span class="op">--</span>embed<span class="op">-</span>resources n√£o √© suportada em HTML5, ent√£o pretendo usar HTML4</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a><span class="op">---</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a><span class="co">### ü§ñ DeepSeek *(2025-11-07 19:54:32)* *[deepseek-reasoner]*</span></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>Vamos otimizar a convers√£o para HTML usando <span class="im">as</span> op√ß√µes do Pandoc que voc√™ mencionou.</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a> Al√©m disso, vamos ajustar para usar o MathJax local (assets<span class="op">/</span>tex<span class="op">-</span>mml<span class="op">-</span>chtml.js) e, se necess√°rio, adaptar para HTML4 se <span class="op">--</span>embed<span class="op">-</span>resources n√£o <span class="cf">for</span> suportado em HTML5.</span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a> No entanto, note que a op√ß√£o <span class="op">--</span>embed<span class="op">-</span>resources √© suportada apenas para HTML5? Na verdade, o Pandoc suporta <span class="op">--</span>embed<span class="op">-</span>resources para HTML4 e HTML5, mas para HTML4, ele usa base64 para imagens, etc. </span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a> Mas como queremos usar MathJax local, e n√£o queremos depender de recursos online, vamos tentar usar <span class="op">--</span>embed<span class="op">-</span>resources e <span class="op">--</span>mathjax com o caminho local.</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a> Vamos modificar a fun√ß√£o `_convert_with_pandoc` para usar <span class="im">as</span> op√ß√µes:</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>   <span class="op">--</span>standalone</span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>   <span class="op">--</span>mathjax<span class="op">=</span>assets<span class="op">/</span>tex<span class="op">-</span>mml<span class="op">-</span>chtml.js</span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>   <span class="op">--</span>embed<span class="op">-</span>resources</span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>   <span class="op">--</span>syntax<span class="op">-</span>highlighting<span class="op">=</span>pygments</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>   <span class="op">--</span>to<span class="op">=</span>html5</span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a> Mas note: <span class="op">--</span>embed<span class="op">-</span>resources pode n√£o ser suportado em todas <span class="im">as</span> vers√µes do Pandoc. Se n√£o <span class="cf">for</span> suportado, podemos remover e usar recursos externos.</span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a> Al√©m disso, vamos ajustar o template HTML para incluir o MathJax local, mas note que o <span class="op">--</span>mathjax do Pandoc j√° inclui o script do MathJax. Com <span class="op">--</span>embed<span class="op">-</span>resources, o Pandoc pode tentar embutir o MathJax? </span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a> N√£o, <span class="op">--</span>embed<span class="op">-</span>resources √© para imagens, CSS, etc. O MathJax √© um script externo. Como baixamos o MathJax local, podemos usar o caminho local.</span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a> No entanto, o Pandoc n√£o baixa o MathJax, ent√£o temos que garantir que o caminho local est√° correto.</span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a> Vamos mudar a op√ß√£o <span class="op">--</span>mathjax para apontar para o arquivo local: <span class="op">--</span>mathjax<span class="op">=</span>assets<span class="op">/</span>tex<span class="op">-</span>mml<span class="op">-</span>chtml.js</span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a> E tamb√©m, como temos o arquivo local, podemos usar <span class="op">--</span>mathjax sem a URL online.</span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a> Outra coisa: a op√ß√£o <span class="op">--</span>syntax<span class="op">-</span>highlighting<span class="op">=</span>pygments pode ser substitu√≠da por <span class="op">--</span>highlight<span class="op">-</span>style<span class="op">=</span>pygments, mas a op√ß√£o <span class="op">--</span>syntax<span class="op">-</span>highlighting n√£o existe. Vou verificar a documenta√ß√£o do Pandoc.</span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a> Na vers√£o <span class="fl">2.11</span> e acima, a op√ß√£o √© <span class="op">--</span>highlight<span class="op">-</span>style<span class="op">=</span>pygments.</span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a> Vamos ajustar para a op√ß√£o correta.</span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a> Vamos reescrever a fun√ß√£o `_convert_with_pandoc`:</span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Usar <span class="im">as</span> op√ß√µes: </span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a>        [<span class="st">&#39;pandoc&#39;</span>, md_file, <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji&#39;</span>, <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>, <span class="st">&#39;--standalone&#39;</span>, </span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;--mathjax=assets/tex-mml-chtml.js&#39;</span>, <span class="st">&#39;--embed-resources&#39;</span>, <span class="st">&#39;--highlight-style=pygments&#39;</span>]</span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Se falhar, tentar sem <span class="op">--</span>embed<span class="op">-</span>resources, pois pode n√£o ser suportado.</span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Se ainda falhar, usar o fallback.</span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a> No entanto, note que <span class="op">--</span>embed<span class="op">-</span>resources pode n√£o ser necess√°rio se quisermos apenas o MathJax local. Mas ele √© √∫til para embutir imagens (se houver) e CSS.</span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a> Vamos tentar com <span class="op">--</span>embed<span class="op">-</span>resources e, se der erro, tentar sem.</span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a> Vamos modificar a fun√ß√£o para tentar duas vezes:</span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>  <span class="fl">1.</span> Com <span class="op">--</span>embed<span class="op">-</span>resources</span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>  <span class="fl">2.</span> Sem <span class="op">--</span>embed<span class="op">-</span>resources</span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a> E, em ambos os casos, usar o MathJax local.</span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a> Al√©m disso, vamos ajustar o template HTML fallback para usar o MathJax local, caso o Pandoc n√£o o inclua (porque usamos <span class="op">--</span>mathjax, ele deve incluir).</span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a> Vamos tamb√©m modificar a fun√ß√£o `_create_html_template` e `_create_basic_html` para usar o MathJax local.</span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a> No entanto, note que o Pandoc, quando usamos <span class="op">--</span>mathjax, adiciona um script que aponta para o arquivo local. Mas se usarmos <span class="op">--</span>embed<span class="op">-</span>resources, o Pandoc n√£o embute o MathJax, apenas o script √© inclu√≠do com o src apontando para o local.</span>
<span id="cb6-153"><a href="#cb6-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-154"><a href="#cb6-154" aria-hidden="true" tabindex="-1"></a> Portanto, precisamos garantir que o arquivo HTML gerado possa acessar o assets<span class="op">/</span>tex<span class="op">-</span>mml<span class="op">-</span>chtml.js. Como estamos gerando HTML na pasta combined_html, e a pasta assets est√° na raiz, o caminho relativo seria ..<span class="op">/</span>assets<span class="op">/</span>tex<span class="op">-</span>mml<span class="op">-</span>chtml.js.</span>
<span id="cb6-155"><a href="#cb6-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a> Mas note: o Pandoc n√£o ajusta o caminho do MathJax para o relativo. Ele usa o caminho que passamos. Ent√£o, se passarmos <span class="op">--</span>mathjax<span class="op">=</span>assets<span class="op">/</span>tex<span class="op">-</span>mml<span class="op">-</span>chtml.js, o script no HTML gerado ser√°:</span>
<span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a>   <span class="op">&lt;</span>script src<span class="op">=</span><span class="st">&quot;assets/tex-mml-chtml.js&quot;</span><span class="op">&gt;&lt;/</span>script<span class="op">&gt;</span></span>
<span id="cb6-159"><a href="#cb6-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a> Isso vai procurar a pasta assets dentro da pasta combined_html. Mas nossa pasta assets est√° na raiz. Ent√£o, temos duas op√ß√µes:</span>
<span id="cb6-161"><a href="#cb6-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-162"><a href="#cb6-162" aria-hidden="true" tabindex="-1"></a>  <span class="fl">1.</span> Copiar a pasta assets para dentro de combined_html.</span>
<span id="cb6-163"><a href="#cb6-163" aria-hidden="true" tabindex="-1"></a>  <span class="fl">2.</span> Ajustar o caminho para ..<span class="op">/</span>assets<span class="op">/</span>tex<span class="op">-</span>mml<span class="op">-</span>chtml.js.</span>
<span id="cb6-164"><a href="#cb6-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-165"><a href="#cb6-165" aria-hidden="true" tabindex="-1"></a> Vamos optar por ajustar o caminho para ..<span class="op">/</span>assets<span class="op">/</span>tex<span class="op">-</span>mml<span class="op">-</span>chtml.js.</span>
<span id="cb6-166"><a href="#cb6-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-167"><a href="#cb6-167" aria-hidden="true" tabindex="-1"></a> Ent√£o, vamos mudar a op√ß√£o para: <span class="op">--</span>mathjax<span class="op">=</span>..<span class="op">/</span>assets<span class="op">/</span>tex<span class="op">-</span>mml<span class="op">-</span>chtml.js</span>
<span id="cb6-168"><a href="#cb6-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-169"><a href="#cb6-169" aria-hidden="true" tabindex="-1"></a> E, nos templates fallback, vamos ajustar o script para usar ..<span class="op">/</span>assets<span class="op">/</span>tex<span class="op">-</span>mml<span class="op">-</span>chtml.js.</span>
<span id="cb6-170"><a href="#cb6-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-171"><a href="#cb6-171" aria-hidden="true" tabindex="-1"></a> Vamos modificar:</span>
<span id="cb6-172"><a href="#cb6-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-173"><a href="#cb6-173" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> No Pandoc: usar <span class="op">--</span>mathjax<span class="op">=</span>..<span class="op">/</span>assets<span class="op">/</span>tex<span class="op">-</span>mml<span class="op">-</span>chtml.js</span>
<span id="cb6-174"><a href="#cb6-174" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> No template fallback: alterar o src do MathJax para ..<span class="op">/</span>assets<span class="op">/</span>tex<span class="op">-</span>mml<span class="op">-</span>chtml.js</span>
<span id="cb6-175"><a href="#cb6-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-176"><a href="#cb6-176" aria-hidden="true" tabindex="-1"></a> Dessa forma, o HTML em combined_html poder√° acessar o MathJax na raiz.</span>
<span id="cb6-177"><a href="#cb6-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-178"><a href="#cb6-178" aria-hidden="true" tabindex="-1"></a> Vamos implementar:</span>
<span id="cb6-179"><a href="#cb6-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-180"><a href="#cb6-180" aria-hidden="true" tabindex="-1"></a>  <span class="fl">1.</span> Modificar a fun√ß√£o `_convert_with_pandoc` para tentar com <span class="op">--</span>embed<span class="op">-</span>resources e, se falhar, sem.</span>
<span id="cb6-181"><a href="#cb6-181" aria-hidden="true" tabindex="-1"></a>  <span class="fl">2.</span> Usar o caminho ..<span class="op">/</span>assets<span class="op">/</span>tex<span class="op">-</span>mml<span class="op">-</span>chtml.js para o MathJax.</span>
<span id="cb6-182"><a href="#cb6-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-183"><a href="#cb6-183" aria-hidden="true" tabindex="-1"></a> Al√©m disso, vamos adicionar uma verifica√ß√£o: se o arquivo assets<span class="op">/</span>tex<span class="op">-</span>mml<span class="op">-</span>chtml.js existe, sen√£o, usar a vers√£o online? </span>
<span id="cb6-184"><a href="#cb6-184" aria-hidden="true" tabindex="-1"></a> Mas como voc√™ j√° baixou, vamos assumir que existe.</span>
<span id="cb6-185"><a href="#cb6-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-186"><a href="#cb6-186" aria-hidden="true" tabindex="-1"></a> Vamos ao c√≥digo:</span>
<span id="cb6-187"><a href="#cb6-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-188"><a href="#cb6-188" aria-hidden="true" tabindex="-1"></a> Primeiro, na fun√ß√£o `_convert_with_pandoc`:</span>
<span id="cb6-189"><a href="#cb6-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-190"><a href="#cb6-190" aria-hidden="true" tabindex="-1"></a>   Tentaremos com <span class="op">--</span>embed<span class="op">-</span>resources. Se der erro, tentaremos sem.</span>
<span id="cb6-191"><a href="#cb6-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-192"><a href="#cb6-192" aria-hidden="true" tabindex="-1"></a>   Com <span class="op">--</span>embed<span class="op">-</span>resources:</span>
<span id="cb6-193"><a href="#cb6-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-194"><a href="#cb6-194" aria-hidden="true" tabindex="-1"></a>        command <span class="op">=</span> [</span>
<span id="cb6-195"><a href="#cb6-195" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb6-196"><a href="#cb6-196" aria-hidden="true" tabindex="-1"></a>            <span class="bu">str</span>(md_file_path),</span>
<span id="cb6-197"><a href="#cb6-197" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji&#39;</span>,</span>
<span id="cb6-198"><a href="#cb6-198" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb6-199"><a href="#cb6-199" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb6-200"><a href="#cb6-200" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--mathjax=../assets/tex-mml-chtml.js&#39;</span>,</span>
<span id="cb6-201"><a href="#cb6-201" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--embed-resources&#39;</span>,</span>
<span id="cb6-202"><a href="#cb6-202" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--highlight-style=pygments&#39;</span></span>
<span id="cb6-203"><a href="#cb6-203" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb6-204"><a href="#cb6-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-205"><a href="#cb6-205" aria-hidden="true" tabindex="-1"></a>   Se falhar, tentaremos sem <span class="op">--</span>embed<span class="op">-</span>resources:</span>
<span id="cb6-206"><a href="#cb6-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-207"><a href="#cb6-207" aria-hidden="true" tabindex="-1"></a>        command <span class="op">=</span> [</span>
<span id="cb6-208"><a href="#cb6-208" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb6-209"><a href="#cb6-209" aria-hidden="true" tabindex="-1"></a>            <span class="bu">str</span>(md_file_path),</span>
<span id="cb6-210"><a href="#cb6-210" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji&#39;</span>,</span>
<span id="cb6-211"><a href="#cb6-211" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb6-212"><a href="#cb6-212" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb6-213"><a href="#cb6-213" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--mathjax=../assets/tex-mml-chtml.js&#39;</span>,</span>
<span id="cb6-214"><a href="#cb6-214" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--highlight-style=pygments&#39;</span></span>
<span id="cb6-215"><a href="#cb6-215" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb6-216"><a href="#cb6-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-217"><a href="#cb6-217" aria-hidden="true" tabindex="-1"></a>   Se ainda falhar, usamos o fallback.</span>
<span id="cb6-218"><a href="#cb6-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-219"><a href="#cb6-219" aria-hidden="true" tabindex="-1"></a>   E no fallback, vamos ajustar o MathJax para local.</span>
<span id="cb6-220"><a href="#cb6-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-221"><a href="#cb6-221" aria-hidden="true" tabindex="-1"></a>   Vamos modificar `_create_html_template` e `_create_basic_html` para usar o MathJax local.</span>
<span id="cb6-222"><a href="#cb6-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-223"><a href="#cb6-223" aria-hidden="true" tabindex="-1"></a>   Em `_create_html_template`:</span>
<span id="cb6-224"><a href="#cb6-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-225"><a href="#cb6-225" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>script <span class="bu">id</span><span class="op">=</span><span class="st">&quot;MathJax-script&quot;</span> <span class="cf">async</span> src<span class="op">=</span><span class="st">&quot;../assets/tex-mml-chtml.js&quot;</span><span class="op">&gt;&lt;/</span>script<span class="op">&gt;</span></span>
<span id="cb6-226"><a href="#cb6-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-227"><a href="#cb6-227" aria-hidden="true" tabindex="-1"></a>   E em `_create_basic_html`:</span>
<span id="cb6-228"><a href="#cb6-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-229"><a href="#cb6-229" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>script <span class="bu">id</span><span class="op">=</span><span class="st">&quot;MathJax-script&quot;</span> <span class="cf">async</span> src<span class="op">=</span><span class="st">&quot;../assets/tex-mml-chtml.js&quot;</span><span class="op">&gt;&lt;/</span>script<span class="op">&gt;</span></span>
<span id="cb6-230"><a href="#cb6-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-231"><a href="#cb6-231" aria-hidden="true" tabindex="-1"></a>   E tamb√©m, note que o fallback n√£o usa mais o polyfill online? Vamos manter o polyfill online? Ou temos local?</span>
<span id="cb6-232"><a href="#cb6-232" aria-hidden="true" tabindex="-1"></a>   Vamos manter o polyfill online, pois n√£o o baixamos. Mas se quiser, pode baixar e usar local. Por enquanto, vamos manter online.</span>
<span id="cb6-233"><a href="#cb6-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-234"><a href="#cb6-234" aria-hidden="true" tabindex="-1"></a>   No entanto, o polyfill n√£o √© estritamente necess√°rio, ent√£o podemos remover? Mas o MathJax pode exigir. Vamos manter como estava.</span>
<span id="cb6-235"><a href="#cb6-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-236"><a href="#cb6-236" aria-hidden="true" tabindex="-1"></a>   Vamos tamb√©m adicionar uma verifica√ß√£o: se o arquivo local do MathJax existe, sen√£o, usar o online? Mas como o usu√°rio j√° baixou, vamos confiar.</span>
<span id="cb6-237"><a href="#cb6-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-238"><a href="#cb6-238" aria-hidden="true" tabindex="-1"></a>   Mas para evitar problemas, se o arquivo local n√£o existir, podemos usar o online. Vamos fazer isso?</span>
<span id="cb6-239"><a href="#cb6-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-240"><a href="#cb6-240" aria-hidden="true" tabindex="-1"></a>   Podemos verificar se o arquivo assets<span class="op">/</span>tex<span class="op">-</span>mml<span class="op">-</span>chtml.js existe. Se existir, usamos local, sen√£o, usamos o online.</span>
<span id="cb6-241"><a href="#cb6-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-242"><a href="#cb6-242" aria-hidden="true" tabindex="-1"></a>   Vamos criar uma fun√ß√£o auxiliar para retornar a URL do MathJax:</span>
<span id="cb6-243"><a href="#cb6-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-244"><a href="#cb6-244" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> get_mathjax_url(<span class="va">self</span>):</span>
<span id="cb6-245"><a href="#cb6-245" aria-hidden="true" tabindex="-1"></a>            local_mathjax <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb6-246"><a href="#cb6-246" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> local_mathjax.exists():</span>
<span id="cb6-247"><a href="#cb6-247" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="st">&quot;../assets/tex-mml-chtml.js&quot;</span></span>
<span id="cb6-248"><a href="#cb6-248" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb6-249"><a href="#cb6-249" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb6-250"><a href="#cb6-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-251"><a href="#cb6-251" aria-hidden="true" tabindex="-1"></a>   E us√°<span class="op">-</span>la em todos os lugares.</span>
<span id="cb6-252"><a href="#cb6-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-253"><a href="#cb6-253" aria-hidden="true" tabindex="-1"></a>   Vamos modificar:</span>
<span id="cb6-254"><a href="#cb6-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-255"><a href="#cb6-255" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> No Pandoc: <span class="op">--</span>mathjax<span class="op">=&lt;</span>url<span class="op">&gt;</span> <span class="op">-&gt;</span> usaremos a URL local se existir, sen√£o a online.</span>
<span id="cb6-256"><a href="#cb6-256" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> Nos templates: usar a URL retornada por get_mathjax_url.</span>
<span id="cb6-257"><a href="#cb6-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-258"><a href="#cb6-258" aria-hidden="true" tabindex="-1"></a>   Mas note: no Pandoc, a op√ß√£o <span class="op">--</span>mathjax espera um caminho (ou URL). Ent√£o, podemos passar a URL local (caminho relativo) ou a URL online.</span>
<span id="cb6-259"><a href="#cb6-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-260"><a href="#cb6-260" aria-hidden="true" tabindex="-1"></a>   Vamos fazer:</span>
<span id="cb6-261"><a href="#cb6-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-262"><a href="#cb6-262" aria-hidden="true" tabindex="-1"></a>        mathjax_url <span class="op">=</span> <span class="va">self</span>.get_mathjax_url()</span>
<span id="cb6-263"><a href="#cb6-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-264"><a href="#cb6-264" aria-hidden="true" tabindex="-1"></a>        command <span class="op">=</span> [</span>
<span id="cb6-265"><a href="#cb6-265" aria-hidden="true" tabindex="-1"></a>            ...,</span>
<span id="cb6-266"><a href="#cb6-266" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_url<span class="sc">}</span><span class="ss">&#39;</span>,</span>
<span id="cb6-267"><a href="#cb6-267" aria-hidden="true" tabindex="-1"></a>            ...</span>
<span id="cb6-268"><a href="#cb6-268" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb6-269"><a href="#cb6-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-270"><a href="#cb6-270" aria-hidden="true" tabindex="-1"></a>   E nos templates, usamos a mesma URL.</span>
<span id="cb6-271"><a href="#cb6-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-272"><a href="#cb6-272" aria-hidden="true" tabindex="-1"></a>   No entanto, no template, o caminho √© relativo ao HTML. Se usarmos a URL online, n√£o h√° problema. Se usarmos a local, √© relativo.</span>
<span id="cb6-273"><a href="#cb6-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-274"><a href="#cb6-274" aria-hidden="true" tabindex="-1"></a>   Vamos implementar a fun√ß√£o `get_mathjax_url` e us√°<span class="op">-</span>la em todos os lugares.</span>
<span id="cb6-275"><a href="#cb6-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-276"><a href="#cb6-276" aria-hidden="true" tabindex="-1"></a>   Vamos tamb√©m modificar a fun√ß√£o `_convert_with_pandoc` para usar essa URL.</span>
<span id="cb6-277"><a href="#cb6-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-278"><a href="#cb6-278" aria-hidden="true" tabindex="-1"></a>   E modificar os templates para usar a URL din√¢mica.</span>
<span id="cb6-279"><a href="#cb6-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-280"><a href="#cb6-280" aria-hidden="true" tabindex="-1"></a>   Vamos l√°.</span>
<span id="cb6-281"><a href="#cb6-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-282"><a href="#cb6-282" aria-hidden="true" tabindex="-1"></a>   Passos:</span>
<span id="cb6-283"><a href="#cb6-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-284"><a href="#cb6-284" aria-hidden="true" tabindex="-1"></a>   <span class="fl">1.</span> Adicionar fun√ß√£o `get_mathjax_url`.</span>
<span id="cb6-285"><a href="#cb6-285" aria-hidden="true" tabindex="-1"></a>   <span class="fl">2.</span> Modificar `_convert_with_pandoc` para usar `get_mathjax_url`.</span>
<span id="cb6-286"><a href="#cb6-286" aria-hidden="true" tabindex="-1"></a>   <span class="fl">3.</span> Modificar `_create_html_template` e `_create_basic_html` para usar `get_mathjax_url`.</span>
<span id="cb6-287"><a href="#cb6-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-288"><a href="#cb6-288" aria-hidden="true" tabindex="-1"></a>   Vamos fazer isso.</span>
<span id="cb6-289"><a href="#cb6-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-290"><a href="#cb6-290" aria-hidden="true" tabindex="-1"></a>   No entanto, note que no Pandoc, o caminho do MathJax √© relativo ao arquivo de sa√≠da? Sim, o Pandoc gera o script com o src exatamente como passamos.</span>
<span id="cb6-291"><a href="#cb6-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-292"><a href="#cb6-292" aria-hidden="true" tabindex="-1"></a>   Ent√£o, se passarmos <span class="st">&#39;../assets/tex-mml-chtml.js&#39;</span>, o HTML gerado ter√°:</span>
<span id="cb6-293"><a href="#cb6-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-294"><a href="#cb6-294" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>script src<span class="op">=</span><span class="st">&quot;../assets/tex-mml-chtml.js&quot;</span><span class="op">&gt;&lt;/</span>script<span class="op">&gt;</span></span>
<span id="cb6-295"><a href="#cb6-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-296"><a href="#cb6-296" aria-hidden="true" tabindex="-1"></a>   E se usarmos a URL online, ter√° a URL online.</span>
<span id="cb6-297"><a href="#cb6-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-298"><a href="#cb6-298" aria-hidden="true" tabindex="-1"></a>   Isso √© bom.</span>
<span id="cb6-299"><a href="#cb6-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-300"><a href="#cb6-300" aria-hidden="true" tabindex="-1"></a>   Vamos implementar.</span>
<span id="cb6-301"><a href="#cb6-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-302"><a href="#cb6-302" aria-hidden="true" tabindex="-1"></a>   Outra coisa: a op√ß√£o <span class="op">--</span>embed<span class="op">-</span>resources pode falhar se houver recursos (imagens) que n√£o podem ser embutidos. Vamos tentar com e sem.</span>
<span id="cb6-303"><a href="#cb6-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-304"><a href="#cb6-304" aria-hidden="true" tabindex="-1"></a>   Vamos modificar a fun√ß√£o `_convert_with_pandoc` para tentar duas vezes.</span>
<span id="cb6-305"><a href="#cb6-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-306"><a href="#cb6-306" aria-hidden="true" tabindex="-1"></a>   Vamos reescrev√™<span class="op">-</span>la:</span>
<span id="cb6-307"><a href="#cb6-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-308"><a href="#cb6-308" aria-hidden="true" tabindex="-1"></a>        mathjax_url <span class="op">=</span> <span class="va">self</span>.get_mathjax_url()</span>
<span id="cb6-309"><a href="#cb6-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-310"><a href="#cb6-310" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Primeira tentativa: com --embed-resources</span></span>
<span id="cb6-311"><a href="#cb6-311" aria-hidden="true" tabindex="-1"></a>        command1 <span class="op">=</span> [</span>
<span id="cb6-312"><a href="#cb6-312" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb6-313"><a href="#cb6-313" aria-hidden="true" tabindex="-1"></a>            <span class="bu">str</span>(md_file_path),</span>
<span id="cb6-314"><a href="#cb6-314" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji&#39;</span>,</span>
<span id="cb6-315"><a href="#cb6-315" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb6-316"><a href="#cb6-316" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb6-317"><a href="#cb6-317" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_url<span class="sc">}</span><span class="ss">&#39;</span>,</span>
<span id="cb6-318"><a href="#cb6-318" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--embed-resources&#39;</span>,</span>
<span id="cb6-319"><a href="#cb6-319" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--highlight-style=pygments&#39;</span></span>
<span id="cb6-320"><a href="#cb6-320" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb6-321"><a href="#cb6-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-322"><a href="#cb6-322" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Segunda tentativa: sem --embed-resources</span></span>
<span id="cb6-323"><a href="#cb6-323" aria-hidden="true" tabindex="-1"></a>        command2 <span class="op">=</span> [</span>
<span id="cb6-324"><a href="#cb6-324" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb6-325"><a href="#cb6-325" aria-hidden="true" tabindex="-1"></a>            <span class="bu">str</span>(md_file_path),</span>
<span id="cb6-326"><a href="#cb6-326" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji&#39;</span>,</span>
<span id="cb6-327"><a href="#cb6-327" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb6-328"><a href="#cb6-328" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb6-329"><a href="#cb6-329" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_url<span class="sc">}</span><span class="ss">&#39;</span>,</span>
<span id="cb6-330"><a href="#cb6-330" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;--highlight-style=pygments&#39;</span></span>
<span id="cb6-331"><a href="#cb6-331" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb6-332"><a href="#cb6-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-333"><a href="#cb6-333" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb6-334"><a href="#cb6-334" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(command1, ...)</span>
<span id="cb6-335"><a href="#cb6-335" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb6-336"><a href="#cb6-336" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._apply_custom_style(result.stdout)</span>
<span id="cb6-337"><a href="#cb6-337" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb6-338"><a href="#cb6-338" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Tenta sem embed-resources</span></span>
<span id="cb6-339"><a href="#cb6-339" aria-hidden="true" tabindex="-1"></a>                result2 <span class="op">=</span> subprocess.run(command2, ...)</span>
<span id="cb6-340"><a href="#cb6-340" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> result2.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb6-341"><a href="#cb6-341" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">self</span>._apply_custom_style(result2.stdout)</span>
<span id="cb6-342"><a href="#cb6-342" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb6-343"><a href="#cb6-343" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è  Pandoc falhou, usando fallback: </span><span class="sc">{</span>result2<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-344"><a href="#cb6-344" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb6-345"><a href="#cb6-345" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb6-346"><a href="#cb6-346" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-347"><a href="#cb6-347" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb6-348"><a href="#cb6-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-349"><a href="#cb6-349" aria-hidden="true" tabindex="-1"></a>   Vamos implementar.</span>
<span id="cb6-350"><a href="#cb6-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-351"><a href="#cb6-351" aria-hidden="true" tabindex="-1"></a>   Vamos tamb√©m verificar a vers√£o do Pandoc para ver se suporta <span class="op">--</span>embed<span class="op">-</span>resources? Mas n√£o √© necess√°rio, pois se n√£o suportar, ele vai falhar e tentaremos sem.</span>
<span id="cb6-352"><a href="#cb6-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-353"><a href="#cb6-353" aria-hidden="true" tabindex="-1"></a>   Vamos ao c√≥digo. Aqui est√° a vers√£o otimizada do c√≥digo com <span class="im">as</span> melhorias solicitadas para a convers√£o HTML:</span>
<span id="cb6-354"><a href="#cb6-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-355"><a href="#cb6-355" aria-hidden="true" tabindex="-1"></a>```python</span>
<span id="cb6-356"><a href="#cb6-356" aria-hidden="true" tabindex="-1"></a><span class="co"># comb_fragments_system3_html_export.py</span></span>
<span id="cb6-357"><a href="#cb6-357" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb6-358"><a href="#cb6-358" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb6-359"><a href="#cb6-359" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb6-360"><a href="#cb6-360" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb6-361"><a href="#cb6-361" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb6-362"><a href="#cb6-362" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb6-363"><a href="#cb6-363" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb6-364"><a href="#cb6-364" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb6-365"><a href="#cb6-365" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> webbrowser</span>
<span id="cb6-366"><a href="#cb6-366" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb6-367"><a href="#cb6-367" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tempfile</span>
<span id="cb6-368"><a href="#cb6-368" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> traceback</span>
<span id="cb6-369"><a href="#cb6-369" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb6-370"><a href="#cb6-370" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb6-371"><a href="#cb6-371" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Any, Optional</span>
<span id="cb6-372"><a href="#cb6-372" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> markdown</span>
<span id="cb6-373"><a href="#cb6-373" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb6-374"><a href="#cb6-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-375"><a href="#cb6-375" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CombinedFragmentsSystem:</span>
<span id="cb6-376"><a href="#cb6-376" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dry_run<span class="op">=</span><span class="va">False</span>, force_overwrite<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb6-377"><a href="#cb6-377" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_dir <span class="op">=</span> Path(<span class="st">&quot;data&quot;</span>)</span>
<span id="cb6-378"><a href="#cb6-378" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dry_run <span class="op">=</span> dry_run</span>
<span id="cb6-379"><a href="#cb6-379" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.force_overwrite <span class="op">=</span> force_overwrite</span>
<span id="cb6-380"><a href="#cb6-380" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-381"><a href="#cb6-381" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configurar logging</span></span>
<span id="cb6-382"><a href="#cb6-382" aria-hidden="true" tabindex="-1"></a>        logging.basicConfig(level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">&#39;</span>)</span>
<span id="cb6-383"><a href="#cb6-383" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb6-384"><a href="#cb6-384" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-385"><a href="#cb6-385" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estrutura de pastas organizada</span></span>
<span id="cb6-386"><a href="#cb6-386" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dirs <span class="op">=</span> {</span>
<span id="cb6-387"><a href="#cb6-387" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;markdown&#39;</span>: <span class="st">&quot;combined_markdown&quot;</span>,</span>
<span id="cb6-388"><a href="#cb6-388" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_csv&quot;</span>, </span>
<span id="cb6-389"><a href="#cb6-389" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_json&quot;</span>,</span>
<span id="cb6-390"><a href="#cb6-390" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;pdfs&#39;</span>: <span class="st">&quot;combined_pdfs&quot;</span>,</span>
<span id="cb6-391"><a href="#cb6-391" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;html&#39;</span>: <span class="st">&quot;combined_html&quot;</span></span>
<span id="cb6-392"><a href="#cb6-392" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb6-393"><a href="#cb6-393" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-394"><a href="#cb6-394" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.single_files <span class="op">=</span> {</span>
<span id="cb6-395"><a href="#cb6-395" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_all_conversations.csv&quot;</span>,</span>
<span id="cb6-396"><a href="#cb6-396" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_all_conversations.json&quot;</span></span>
<span id="cb6-397"><a href="#cb6-397" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb6-398"><a href="#cb6-398" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-399"><a href="#cb6-399" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.index_file <span class="op">=</span> <span class="st">&quot;index.html&quot;</span></span>
<span id="cb6-400"><a href="#cb6-400" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations <span class="op">=</span> []</span>
<span id="cb6-401"><a href="#cb6-401" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-402"><a href="#cb6-402" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configura√ß√£o de processamento por fonte</span></span>
<span id="cb6-403"><a href="#cb6-403" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.processors <span class="op">=</span> {</span>
<span id="cb6-404"><a href="#cb6-404" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;qwen&#39;</span>: {</span>
<span id="cb6-405"><a href="#cb6-405" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chat-export.json&quot;</span>,</span>
<span id="cb6-406"><a href="#cb6-406" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_qwen_enhanced,</span>
<span id="cb6-407"><a href="#cb6-407" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb6-408"><a href="#cb6-408" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb6-409"><a href="#cb6-409" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;chatgpt&#39;</span>: {</span>
<span id="cb6-410"><a href="#cb6-410" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chatgpt.zip&quot;</span>, </span>
<span id="cb6-411"><a href="#cb6-411" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_chatgpt,</span>
<span id="cb6-412"><a href="#cb6-412" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb6-413"><a href="#cb6-413" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb6-414"><a href="#cb6-414" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;deepseek&#39;</span>: {</span>
<span id="cb6-415"><a href="#cb6-415" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;deepseek_data.zip&quot;</span>,</span>
<span id="cb6-416"><a href="#cb6-416" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_deepseek,</span>
<span id="cb6-417"><a href="#cb6-417" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb6-418"><a href="#cb6-418" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb6-419"><a href="#cb6-419" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;grok&#39;</span>: {</span>
<span id="cb6-420"><a href="#cb6-420" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;grok.zip&quot;</span>,</span>
<span id="cb6-421"><a href="#cb6-421" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_grok,</span>
<span id="cb6-422"><a href="#cb6-422" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb6-423"><a href="#cb6-423" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb6-424"><a href="#cb6-424" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb6-425"><a href="#cb6-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-426"><a href="#cb6-426" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sanitize_filename(<span class="va">self</span>, text: <span class="bu">str</span>, max_len: <span class="bu">int</span> <span class="op">=</span> <span class="dv">50</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb6-427"><a href="#cb6-427" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Sanitiza nomes de arquivo REMOVENDO ESPA√áOS e preservando emojis&quot;&quot;&quot;</span></span>
<span id="cb6-428"><a href="#cb6-428" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb6-429"><a href="#cb6-429" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb6-430"><a href="#cb6-430" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-431"><a href="#cb6-431" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove caracteres inv√°lidos</span></span>
<span id="cb6-432"><a href="#cb6-432" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="dv">\s</span><span class="pp">]</span><span class="vs">&#39;</span>  <span class="co"># Inclui \s para remover espa√ßos</span></span>
<span id="cb6-433"><a href="#cb6-433" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;_&#39;</span>, text)  <span class="co"># Substitui espa√ßos por underscores</span></span>
<span id="cb6-434"><a href="#cb6-434" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;_</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39;_&#39;</span>, sanitized)  <span class="co"># Remove underscores duplicados</span></span>
<span id="cb6-435"><a href="#cb6-435" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> sanitized.strip(<span class="st">&#39;_&#39;</span>)  <span class="co"># Remove underscores no in√≠cio e fim</span></span>
<span id="cb6-436"><a href="#cb6-436" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-437"><a href="#cb6-437" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb6-438"><a href="#cb6-438" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb6-439"><a href="#cb6-439" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-440"><a href="#cb6-440" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Limita o comprimento</span></span>
<span id="cb6-441"><a href="#cb6-441" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(sanitized) <span class="op">&gt;</span> max_len:</span>
<span id="cb6-442"><a href="#cb6-442" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Tenta cortar em um ponto l√≥gico (underscore)</span></span>
<span id="cb6-443"><a href="#cb6-443" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;_&#39;</span> <span class="kw">in</span> sanitized[:max_len]:</span>
<span id="cb6-444"><a href="#cb6-444" aria-hidden="true" tabindex="-1"></a>                last_underscore <span class="op">=</span> sanitized[:max_len].rfind(<span class="st">&#39;_&#39;</span>)</span>
<span id="cb6-445"><a href="#cb6-445" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> last_underscore <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb6-446"><a href="#cb6-446" aria-hidden="true" tabindex="-1"></a>                    sanitized <span class="op">=</span> sanitized[:last_underscore]</span>
<span id="cb6-447"><a href="#cb6-447" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb6-448"><a href="#cb6-448" aria-hidden="true" tabindex="-1"></a>                sanitized <span class="op">=</span> sanitized[:max_len]</span>
<span id="cb6-449"><a href="#cb6-449" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-450"><a href="#cb6-450" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb6-451"><a href="#cb6-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-452"><a href="#cb6-452" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_original_title(<span class="va">self</span>, text: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb6-453"><a href="#cb6-453" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Preserva o t√≠tulo original com espa√ßos, apenas removendo caracteres realmente inv√°lidos&quot;&quot;&quot;</span></span>
<span id="cb6-454"><a href="#cb6-454" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb6-455"><a href="#cb6-455" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb6-456"><a href="#cb6-456" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-457"><a href="#cb6-457" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove apenas caracteres realmente problem√°ticos, mantendo espa√ßos</span></span>
<span id="cb6-458"><a href="#cb6-458" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="pp">]</span><span class="vs">&#39;</span></span>
<span id="cb6-459"><a href="#cb6-459" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;&#39;</span>, text)</span>
<span id="cb6-460"><a href="#cb6-460" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;</span><span class="dv">\s</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39; &#39;</span>, sanitized.strip())</span>
<span id="cb6-461"><a href="#cb6-461" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-462"><a href="#cb6-462" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb6-463"><a href="#cb6-463" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb6-464"><a href="#cb6-464" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-465"><a href="#cb6-465" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb6-466"><a href="#cb6-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-467"><a href="#cb6-467" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_special_content(<span class="va">self</span>, content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb6-468"><a href="#cb6-468" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Preserva f√≥rmulas matem√°ticas, c√≥digo e formata√ß√£o especial&quot;&quot;&quot;</span></span>
<span id="cb6-469"><a href="#cb6-469" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb6-470"><a href="#cb6-470" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;&quot;</span></span>
<span id="cb6-471"><a href="#cb6-471" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-472"><a href="#cb6-472" aria-hidden="true" tabindex="-1"></a>        preserved_content <span class="op">=</span> content</span>
<span id="cb6-473"><a href="#cb6-473" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-474"><a href="#cb6-474" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Corrige problemas com barras invertidas em LaTeX</span></span>
<span id="cb6-475"><a href="#cb6-475" aria-hidden="true" tabindex="-1"></a>        latex_corrections <span class="op">=</span> {</span>
<span id="cb6-476"><a href="#cb6-476" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ärac&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">frac&#39;</span>,</span>
<span id="cb6-477"><a href="#cb6-477" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Çarepsilon&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">varepsilon&#39;</span>,</span>
<span id="cb6-478"><a href="#cb6-478" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ç&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span>,</span>
<span id="cb6-479"><a href="#cb6-479" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ä&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span></span>
<span id="cb6-480"><a href="#cb6-480" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb6-481"><a href="#cb6-481" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-482"><a href="#cb6-482" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> wrong, correct <span class="kw">in</span> latex_corrections.items():</span>
<span id="cb6-483"><a href="#cb6-483" aria-hidden="true" tabindex="-1"></a>            preserved_content <span class="op">=</span> preserved_content.replace(wrong, correct)</span>
<span id="cb6-484"><a href="#cb6-484" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-485"><a href="#cb6-485" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> preserved_content</span>
<span id="cb6-486"><a href="#cb6-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-487"><a href="#cb6-487" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ensure_directories(<span class="va">self</span>):</span>
<span id="cb6-488"><a href="#cb6-488" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Cria todas as pastas necess√°rias&quot;&quot;&quot;</span></span>
<span id="cb6-489"><a href="#cb6-489" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb6-490"><a href="#cb6-490" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;DRY-RUN: Pastas seriam criadas:&quot;</span>)</span>
<span id="cb6-491"><a href="#cb6-491" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb6-492"><a href="#cb6-492" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-493"><a href="#cb6-493" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb6-494"><a href="#cb6-494" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-495"><a href="#cb6-495" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb6-496"><a href="#cb6-496" aria-hidden="true" tabindex="-1"></a>            Path(folder).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-497"><a href="#cb6-497" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;Pasta criada: </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-498"><a href="#cb6-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-499"><a href="#cb6-499" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> run(<span class="va">self</span>):</span>
<span id="cb6-500"><a href="#cb6-500" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Executa o processamento completo&quot;&quot;&quot;</span></span>
<span id="cb6-501"><a href="#cb6-501" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;SISTEMA COMBINADO DE EXPORTA√á√ïES COM HTML (Qwen3, ChatGPT, DeepSeek, Grok)&quot;</span>)</span>
<span id="cb6-502"><a href="#cb6-502" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb6-503"><a href="#cb6-503" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-504"><a href="#cb6-504" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.data_dir.exists():</span>
<span id="cb6-505"><a href="#cb6-505" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;Pasta &#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">}</span><span class="ss">&#39; n√£o encontrada.&quot;</span>)</span>
<span id="cb6-506"><a href="#cb6-506" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;Crie a pasta &#39;data&#39; e coloque os arquivos de exporta√ß√£o:&quot;</span>)</span>
<span id="cb6-507"><a href="#cb6-507" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb6-508"><a href="#cb6-508" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   - </span><span class="sc">{</span>config[<span class="st">&#39;file&#39;</span>]<span class="sc">}</span><span class="ss"> (para </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb6-509"><a href="#cb6-509" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb6-510"><a href="#cb6-510" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-511"><a href="#cb6-511" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;Usando pasta de dados: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-512"><a href="#cb6-512" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-513"><a href="#cb6-513" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ensure_directories()</span>
<span id="cb6-514"><a href="#cb6-514" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-515"><a href="#cb6-515" aria-hidden="true" tabindex="-1"></a>        processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-516"><a href="#cb6-516" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb6-517"><a href="#cb6-517" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> config[<span class="st">&#39;enabled&#39;</span>]:</span>
<span id="cb6-518"><a href="#cb6-518" aria-hidden="true" tabindex="-1"></a>                file_path <span class="op">=</span> <span class="va">self</span>.data_dir <span class="op">/</span> config[<span class="st">&#39;file&#39;</span>]</span>
<span id="cb6-519"><a href="#cb6-519" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> file_path.exists():</span>
<span id="cb6-520"><a href="#cb6-520" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Processando </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb6-521"><a href="#cb6-521" aria-hidden="true" tabindex="-1"></a>                    config[<span class="st">&#39;method&#39;</span>](file_path)</span>
<span id="cb6-522"><a href="#cb6-522" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-523"><a href="#cb6-523" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb6-524"><a href="#cb6-524" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.warning(<span class="ss">f&quot;</span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">: arquivo n√£o encontrado - </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-525"><a href="#cb6-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-526"><a href="#cb6-526" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> processed_count <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb6-527"><a href="#cb6-527" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhum arquivo de exporta√ß√£o encontrado na pasta &#39;data&#39;.&quot;</span>)</span>
<span id="cb6-528"><a href="#cb6-528" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb6-529"><a href="#cb6-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-530"><a href="#cb6-530" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb6-531"><a href="#cb6-531" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhuma conversa foi extra√≠da dos arquivos.&quot;</span>)</span>
<span id="cb6-532"><a href="#cb6-532" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb6-533"><a href="#cb6-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-534"><a href="#cb6-534" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._post_process_conversations()</span>
<span id="cb6-535"><a href="#cb6-535" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-536"><a href="#cb6-536" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.dry_run:</span>
<span id="cb6-537"><a href="#cb6-537" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._export_all_formats()</span>
<span id="cb6-538"><a href="#cb6-538" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üéâ SISTEMA COMBINADO FINALIZADO!&quot;</span>)</span>
<span id="cb6-539"><a href="#cb6-539" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ √çndice: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-540"><a href="#cb6-540" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> Path(<span class="va">self</span>.index_file).exists():</span>
<span id="cb6-541"><a href="#cb6-541" aria-hidden="true" tabindex="-1"></a>                webbrowser.<span class="bu">open</span>(<span class="ss">f&#39;file://</span><span class="sc">{</span>Path(<span class="va">self</span>.index_file)<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb6-542"><a href="#cb6-542" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb6-543"><a href="#cb6-543" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üîÆ MODO DRY-RUN: Nenhum arquivo foi criado.&quot;</span>)</span>
<span id="cb6-544"><a href="#cb6-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-545"><a href="#cb6-545" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _post_process_conversations(<span class="va">self</span>):</span>
<span id="cb6-546"><a href="#cb6-546" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Processamento p√≥s-extra√ß√£o das conversas&quot;&quot;&quot;</span></span>
<span id="cb6-547"><a href="#cb6-547" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations.sort(</span>
<span id="cb6-548"><a href="#cb6-548" aria-hidden="true" tabindex="-1"></a>            key<span class="op">=</span><span class="kw">lambda</span> x: <span class="va">self</span>.parse_timestamp_for_sorting(</span>
<span id="cb6-549"><a href="#cb6-549" aria-hidden="true" tabindex="-1"></a>                x.get(<span class="st">&#39;updated_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;created_at&#39;</span>)</span>
<span id="cb6-550"><a href="#cb6-550" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb6-551"><a href="#cb6-551" aria-hidden="true" tabindex="-1"></a>            reverse<span class="op">=</span><span class="va">True</span></span>
<span id="cb6-552"><a href="#cb6-552" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb6-553"><a href="#cb6-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-554"><a href="#cb6-554" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.all_conversations):</span>
<span id="cb6-555"><a href="#cb6-555" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;number&#39;</span>] <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb6-556"><a href="#cb6-556" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;category&#39;</span>] <span class="op">=</span> <span class="va">self</span>.categorize_conversation(conv[<span class="st">&#39;title&#39;</span>], conv.get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;&#39;</span>))</span>
<span id="cb6-557"><a href="#cb6-557" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;source&#39;</span>, <span class="st">&#39;Desconhecido&#39;</span>)</span>
<span id="cb6-558"><a href="#cb6-558" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;messages&#39;</span>, [])</span>
<span id="cb6-559"><a href="#cb6-559" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;summary&#39;</span>, conv[<span class="st">&#39;messages&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> conv[<span class="st">&#39;messages&#39;</span>] <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>)</span>
<span id="cb6-560"><a href="#cb6-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-561"><a href="#cb6-561" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä Total combinado de conversas: </span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-562"><a href="#cb6-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-563"><a href="#cb6-563" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _export_all_formats(<span class="va">self</span>):</span>
<span id="cb6-564"><a href="#cb6-564" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Exporta para todos os formatos&quot;&quot;&quot;</span></span>
<span id="cb6-565"><a href="#cb6-565" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">üîÑ Exportando para formatos...&quot;</span>)</span>
<span id="cb6-566"><a href="#cb6-566" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_markdown_enhanced()</span>
<span id="cb6-567"><a href="#cb6-567" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_html_robust()</span>
<span id="cb6-568"><a href="#cb6-568" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_csv() </span>
<span id="cb6-569"><a href="#cb6-569" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_json()</span>
<span id="cb6-570"><a href="#cb6-570" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_all_to_single_files()</span>
<span id="cb6-571"><a href="#cb6-571" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.create_searchable_index()</span>
<span id="cb6-572"><a href="#cb6-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-573"><a href="#cb6-573" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_optimized(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb6-574"><a href="#cb6-574" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Convers√£o OTIMIZADA com Pandoc usando MathJax local e recursos embutidos&quot;&quot;&quot;</span></span>
<span id="cb6-575"><a href="#cb6-575" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb6-576"><a href="#cb6-576" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Convertendo com Pandoc otimizado: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-577"><a href="#cb6-577" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-578"><a href="#cb6-578" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica se o arquivo MathJax local existe</span></span>
<span id="cb6-579"><a href="#cb6-579" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb6-580"><a href="#cb6-580" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb6-581"><a href="#cb6-581" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-582"><a href="#cb6-582" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Comando otimizado para HTML5 com recursos embutidos</span></span>
<span id="cb6-583"><a href="#cb6-583" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb6-584"><a href="#cb6-584" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb6-585"><a href="#cb6-585" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb6-586"><a href="#cb6-586" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji+autolink_bare_uris+tex_math_single_backslash&#39;</span>,</span>
<span id="cb6-587"><a href="#cb6-587" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb6-588"><a href="#cb6-588" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb6-589"><a href="#cb6-589" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--embed-resources&#39;</span>,</span>
<span id="cb6-590"><a href="#cb6-590" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--highlight-style=pygments&#39;</span>,</span>
<span id="cb6-591"><a href="#cb6-591" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--css=assets/pandoc.css&#39;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/pandoc.css&quot;</span>).exists() <span class="cf">else</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb6-592"><a href="#cb6-592" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb6-593"><a href="#cb6-593" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb6-594"><a href="#cb6-594" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-595"><a href="#cb6-595" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Remove argumentos vazios</span></span>
<span id="cb6-596"><a href="#cb6-596" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [arg <span class="cf">for</span> arg <span class="kw">in</span> command <span class="cf">if</span> arg]</span>
<span id="cb6-597"><a href="#cb6-597" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-598"><a href="#cb6-598" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb6-599"><a href="#cb6-599" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb6-600"><a href="#cb6-600" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb6-601"><a href="#cb6-601" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb6-602"><a href="#cb6-602" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb6-603"><a href="#cb6-603" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">120</span></span>
<span id="cb6-604"><a href="#cb6-604" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb6-605"><a href="#cb6-605" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-606"><a href="#cb6-606" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb6-607"><a href="#cb6-607" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> result.stdout</span>
<span id="cb6-608"><a href="#cb6-608" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb6-609"><a href="#cb6-609" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Aplica otimiza√ß√µes adicionais</span></span>
<span id="cb6-610"><a href="#cb6-610" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="va">self</span>._optimize_html_content(html_content)</span>
<span id="cb6-611"><a href="#cb6-611" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> html_content</span>
<span id="cb6-612"><a href="#cb6-612" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb6-613"><a href="#cb6-613" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc otimizado falhou, tentando m√©todo b√°sico: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-614"><a href="#cb6-614" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb6-615"><a href="#cb6-615" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb6-616"><a href="#cb6-616" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> subprocess.TimeoutExpired:</span>
<span id="cb6-617"><a href="#cb6-617" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Timeout no Pandoc otimizado&quot;</span>)</span>
<span id="cb6-618"><a href="#cb6-618" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb6-619"><a href="#cb6-619" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb6-620"><a href="#cb6-620" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc otimizado: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-621"><a href="#cb6-621" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb6-622"><a href="#cb6-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-623"><a href="#cb6-623" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_basic(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb6-624"><a href="#cb6-624" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;M√©todo b√°sico de fallback para Pandoc&quot;&quot;&quot;</span></span>
<span id="cb6-625"><a href="#cb6-625" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb6-626"><a href="#cb6-626" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Tentando convers√£o b√°sica: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-627"><a href="#cb6-627" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-628"><a href="#cb6-628" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb6-629"><a href="#cb6-629" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb6-630"><a href="#cb6-630" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-631"><a href="#cb6-631" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb6-632"><a href="#cb6-632" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb6-633"><a href="#cb6-633" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb6-634"><a href="#cb6-634" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown&#39;</span>,</span>
<span id="cb6-635"><a href="#cb6-635" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb6-636"><a href="#cb6-636" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb6-637"><a href="#cb6-637" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb6-638"><a href="#cb6-638" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb6-639"><a href="#cb6-639" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-640"><a href="#cb6-640" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb6-641"><a href="#cb6-641" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb6-642"><a href="#cb6-642" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb6-643"><a href="#cb6-643" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb6-644"><a href="#cb6-644" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb6-645"><a href="#cb6-645" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">60</span></span>
<span id="cb6-646"><a href="#cb6-646" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb6-647"><a href="#cb6-647" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-648"><a href="#cb6-648" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb6-649"><a href="#cb6-649" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._optimize_html_content(result.stdout)</span>
<span id="cb6-650"><a href="#cb6-650" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb6-651"><a href="#cb6-651" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc b√°sico falhou, usando fallback Python: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-652"><a href="#cb6-652" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb6-653"><a href="#cb6-653" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb6-654"><a href="#cb6-654" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb6-655"><a href="#cb6-655" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc b√°sico: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-656"><a href="#cb6-656" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb6-657"><a href="#cb6-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-658"><a href="#cb6-658" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _optimize_html_content(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb6-659"><a href="#cb6-659" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Aplica otimiza√ß√µes finais ao conte√∫do HTML&quot;&quot;&quot;</span></span>
<span id="cb6-660"><a href="#cb6-660" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona viewport para responsividade</span></span>
<span id="cb6-661"><a href="#cb6-661" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;viewport&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb6-662"><a href="#cb6-662" aria-hidden="true" tabindex="-1"></a>            viewport_meta <span class="op">=</span> <span class="st">&#39;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#39;</span></span>
<span id="cb6-663"><a href="#cb6-663" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="ss">    </span><span class="sc">{</span>viewport_meta<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb6-664"><a href="#cb6-664" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-665"><a href="#cb6-665" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Melhora acessibilidade</span></span>
<span id="cb6-666"><a href="#cb6-666" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;html&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;lang&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb6-667"><a href="#cb6-667" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;html&gt;&#39;</span>, <span class="st">&#39;&lt;html lang=&quot;pt-BR&quot;&gt;&#39;</span>)</span>
<span id="cb6-668"><a href="#cb6-668" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-669"><a href="#cb6-669" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona CSS personalizado se necess√°rio</span></span>
<span id="cb6-670"><a href="#cb6-670" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;style&gt;&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content <span class="kw">or</span> <span class="st">&#39;custom-css&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb6-671"><a href="#cb6-671" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> <span class="va">self</span>._inject_custom_css(html_content)</span>
<span id="cb6-672"><a href="#cb6-672" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-673"><a href="#cb6-673" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb6-674"><a href="#cb6-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-675"><a href="#cb6-675" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _inject_custom_css(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb6-676"><a href="#cb6-676" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Injeta CSS personalizado para melhorar a apar√™ncia&quot;&quot;&quot;</span></span>
<span id="cb6-677"><a href="#cb6-677" aria-hidden="true" tabindex="-1"></a>        custom_css <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb6-678"><a href="#cb6-678" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;style&gt;</span></span>
<span id="cb6-679"><a href="#cb6-679" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para c√≥digo e matem√°tica */</span></span>
<span id="cb6-680"><a href="#cb6-680" aria-hidden="true" tabindex="-1"></a><span class="st">            .math { display: block; text-align: center; margin: 1em 0; }</span></span>
<span id="cb6-681"><a href="#cb6-681" aria-hidden="true" tabindex="-1"></a><span class="st">            .math inline { display: inline-block; }</span></span>
<span id="cb6-682"><a href="#cb6-682" aria-hidden="true" tabindex="-1"></a><span class="st">            pre { border-left: 4px solid #3498db; background: #f8f9fa; }</span></span>
<span id="cb6-683"><a href="#cb6-683" aria-hidden="true" tabindex="-1"></a><span class="st">            code { background: #e9ecef; padding: 0.2em 0.4em; border-radius: 3px; }</span></span>
<span id="cb6-684"><a href="#cb6-684" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb6-685"><a href="#cb6-685" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias responsivas */</span></span>
<span id="cb6-686"><a href="#cb6-686" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 768px) {</span></span>
<span id="cb6-687"><a href="#cb6-687" aria-hidden="true" tabindex="-1"></a><span class="st">                body { padding: 10px; font-size: 14px; }</span></span>
<span id="cb6-688"><a href="#cb6-688" aria-hidden="true" tabindex="-1"></a><span class="st">                .container { padding: 15px; }</span></span>
<span id="cb6-689"><a href="#cb6-689" aria-hidden="true" tabindex="-1"></a><span class="st">                pre { font-size: 12px; }</span></span>
<span id="cb6-690"><a href="#cb6-690" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb6-691"><a href="#cb6-691" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb6-692"><a href="#cb6-692" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para tabelas */</span></span>
<span id="cb6-693"><a href="#cb6-693" aria-hidden="true" tabindex="-1"></a><span class="st">            table { width: 100%; border-collapse: collapse; margin: 1em 0; }</span></span>
<span id="cb6-694"><a href="#cb6-694" aria-hidden="true" tabindex="-1"></a><span class="st">            th, td { border: 1px solid #dee2e6; padding: 0.75rem; }</span></span>
<span id="cb6-695"><a href="#cb6-695" aria-hidden="true" tabindex="-1"></a><span class="st">            th { background-color: #3498db; color: white; }</span></span>
<span id="cb6-696"><a href="#cb6-696" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb6-697"><a href="#cb6-697" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para blocos de cita√ß√£o */</span></span>
<span id="cb6-698"><a href="#cb6-698" aria-hidden="true" tabindex="-1"></a><span class="st">            blockquote { </span></span>
<span id="cb6-699"><a href="#cb6-699" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb6-700"><a href="#cb6-700" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 1em 0; </span></span>
<span id="cb6-701"><a href="#cb6-701" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 1em; </span></span>
<span id="cb6-702"><a href="#cb6-702" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #6c757d;</span></span>
<span id="cb6-703"><a href="#cb6-703" aria-hidden="true" tabindex="-1"></a><span class="st">                font-style: italic;</span></span>
<span id="cb6-704"><a href="#cb6-704" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb6-705"><a href="#cb6-705" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/style&gt;</span></span>
<span id="cb6-706"><a href="#cb6-706" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb6-707"><a href="#cb6-707" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-708"><a href="#cb6-708" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;/head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb6-709"><a href="#cb6-709" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;/head&gt;&#39;</span>, <span class="ss">f&#39;</span><span class="sc">{</span>custom_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;&#39;</span>)</span>
<span id="cb6-710"><a href="#cb6-710" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb6-711"><a href="#cb6-711" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>custom_css<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb6-712"><a href="#cb6-712" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb6-713"><a href="#cb6-713" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Se n√£o encontrar head, adiciona antes do body</span></span>
<span id="cb6-714"><a href="#cb6-714" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;&lt;body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb6-715"><a href="#cb6-715" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;body&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>custom_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;&#39;</span>)</span>
<span id="cb6-716"><a href="#cb6-716" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb6-717"><a href="#cb6-717" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>custom_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;</span><span class="ch">\n</span><span class="sc">{</span>html_content<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/body&gt;&#39;</span></span>
<span id="cb6-718"><a href="#cb6-718" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb6-719"><a href="#cb6-719" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb6-720"><a href="#cb6-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-721"><a href="#cb6-721" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_fallback(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb6-722"><a href="#cb6-722" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Fallback para convers√£o quando Pandoc falha&quot;&quot;&quot;</span></span>
<span id="cb6-723"><a href="#cb6-723" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb6-724"><a href="#cb6-724" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(md_file_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb6-725"><a href="#cb6-725" aria-hidden="true" tabindex="-1"></a>                md_content <span class="op">=</span> f.read()</span>
<span id="cb6-726"><a href="#cb6-726" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-727"><a href="#cb6-727" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extens√µes avan√ßadas para melhor convers√£o</span></span>
<span id="cb6-728"><a href="#cb6-728" aria-hidden="true" tabindex="-1"></a>            extensions <span class="op">=</span> [</span>
<span id="cb6-729"><a href="#cb6-729" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;extra&#39;</span>, <span class="st">&#39;tables&#39;</span>, <span class="st">&#39;fenced_code&#39;</span>, <span class="st">&#39;codehilite&#39;</span>, </span>
<span id="cb6-730"><a href="#cb6-730" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;toc&#39;</span>, <span class="st">&#39;md_in_html&#39;</span>, <span class="st">&#39;attr_list&#39;</span></span>
<span id="cb6-731"><a href="#cb6-731" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb6-732"><a href="#cb6-732" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-733"><a href="#cb6-733" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> markdown.markdown(</span>
<span id="cb6-734"><a href="#cb6-734" aria-hidden="true" tabindex="-1"></a>                md_content,</span>
<span id="cb6-735"><a href="#cb6-735" aria-hidden="true" tabindex="-1"></a>                extensions<span class="op">=</span>extensions,</span>
<span id="cb6-736"><a href="#cb6-736" aria-hidden="true" tabindex="-1"></a>                output_format<span class="op">=</span><span class="st">&#39;html5&#39;</span></span>
<span id="cb6-737"><a href="#cb6-737" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb6-738"><a href="#cb6-738" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-739"><a href="#cb6-739" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_enhanced_html_template(html_content, Path(md_file_path).name)</span>
<span id="cb6-740"><a href="#cb6-740" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-741"><a href="#cb6-741" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb6-742"><a href="#cb6-742" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Fallback tamb√©m falhou: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-743"><a href="#cb6-743" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_basic_html(md_content, Path(md_file_path).name)</span>
<span id="cb6-744"><a href="#cb6-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-745"><a href="#cb6-745" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_enhanced_html_template(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb6-746"><a href="#cb6-746" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Template HTML aprimorado com suporte a MathJax local/online&quot;&quot;&quot;</span></span>
<span id="cb6-747"><a href="#cb6-747" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb6-748"><a href="#cb6-748" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-749"><a href="#cb6-749" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb6-750"><a href="#cb6-750" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html lang=&quot;pt-BR&quot;&gt;</span></span>
<span id="cb6-751"><a href="#cb6-751" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb6-752"><a href="#cb6-752" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb6-753"><a href="#cb6-753" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb6-754"><a href="#cb6-754" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb6-755"><a href="#cb6-755" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb6-756"><a href="#cb6-756" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span></span>
<span id="cb6-757"><a href="#cb6-757" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb6-758"><a href="#cb6-758" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb6-759"><a href="#cb6-759" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0;</span></span>
<span id="cb6-760"><a href="#cb6-760" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb6-761"><a href="#cb6-761" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb6-762"><a href="#cb6-762" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333;</span></span>
<span id="cb6-763"><a href="#cb6-763" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-764"><a href="#cb6-764" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb6-765"><a href="#cb6-765" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 900px;</span></span>
<span id="cb6-766"><a href="#cb6-766" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb6-767"><a href="#cb6-767" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb6-768"><a href="#cb6-768" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 40px;</span></span>
<span id="cb6-769"><a href="#cb6-769" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 10px;</span></span>
<span id="cb6-770"><a href="#cb6-770" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb6-771"><a href="#cb6-771" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-772"><a href="#cb6-772" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1, h2, h3, h4, h5 </span><span class="ch">{{</span></span>
<span id="cb6-773"><a href="#cb6-773" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb6-774"><a href="#cb6-774" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 1.8em;</span></span>
<span id="cb6-775"><a href="#cb6-775" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-776"><a href="#cb6-776" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1 </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb6-777"><a href="#cb6-777" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 3px solid #3498db; </span></span>
<span id="cb6-778"><a href="#cb6-778" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 15px; </span></span>
<span id="cb6-779"><a href="#cb6-779" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb6-780"><a href="#cb6-780" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 2.2em;</span></span>
<span id="cb6-781"><a href="#cb6-781" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-782"><a href="#cb6-782" aria-hidden="true" tabindex="-1"></a><span class="ss">        h2 </span><span class="ch">{{</span></span>
<span id="cb6-783"><a href="#cb6-783" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb6-784"><a href="#cb6-784" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb6-785"><a href="#cb6-785" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 2em;</span></span>
<span id="cb6-786"><a href="#cb6-786" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-787"><a href="#cb6-787" aria-hidden="true" tabindex="-1"></a><span class="ss">        code </span><span class="ch">{{</span></span>
<span id="cb6-788"><a href="#cb6-788" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f4f4f4;</span></span>
<span id="cb6-789"><a href="#cb6-789" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 3px 8px;</span></span>
<span id="cb6-790"><a href="#cb6-790" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb6-791"><a href="#cb6-791" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb6-792"><a href="#cb6-792" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #c7254e;</span></span>
<span id="cb6-793"><a href="#cb6-793" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb6-794"><a href="#cb6-794" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-795"><a href="#cb6-795" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span></span>
<span id="cb6-796"><a href="#cb6-796" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #2d2d2d;</span></span>
<span id="cb6-797"><a href="#cb6-797" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #f8f8f2;</span></span>
<span id="cb6-798"><a href="#cb6-798" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb6-799"><a href="#cb6-799" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb6-800"><a href="#cb6-800" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb6-801"><a href="#cb6-801" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 5px solid #3498db;</span></span>
<span id="cb6-802"><a href="#cb6-802" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb6-803"><a href="#cb6-803" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.4;</span></span>
<span id="cb6-804"><a href="#cb6-804" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-805"><a href="#cb6-805" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre code </span><span class="ch">{{</span></span>
<span id="cb6-806"><a href="#cb6-806" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: none;</span></span>
<span id="cb6-807"><a href="#cb6-807" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: inherit;</span></span>
<span id="cb6-808"><a href="#cb6-808" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 0;</span></span>
<span id="cb6-809"><a href="#cb6-809" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-810"><a href="#cb6-810" aria-hidden="true" tabindex="-1"></a><span class="ss">        blockquote </span><span class="ch">{{</span></span>
<span id="cb6-811"><a href="#cb6-811" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb6-812"><a href="#cb6-812" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 25px 0;</span></span>
<span id="cb6-813"><a href="#cb6-813" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 25px;</span></span>
<span id="cb6-814"><a href="#cb6-814" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb6-815"><a href="#cb6-815" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-style: italic;</span></span>
<span id="cb6-816"><a href="#cb6-816" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb6-817"><a href="#cb6-817" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb6-818"><a href="#cb6-818" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 0 8px 8px 0;</span></span>
<span id="cb6-819"><a href="#cb6-819" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-820"><a href="#cb6-820" aria-hidden="true" tabindex="-1"></a><span class="ss">        table </span><span class="ch">{{</span></span>
<span id="cb6-821"><a href="#cb6-821" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-collapse: collapse;</span></span>
<span id="cb6-822"><a href="#cb6-822" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 100%;</span></span>
<span id="cb6-823"><a href="#cb6-823" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb6-824"><a href="#cb6-824" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb6-825"><a href="#cb6-825" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb6-826"><a href="#cb6-826" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb6-827"><a href="#cb6-827" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-828"><a href="#cb6-828" aria-hidden="true" tabindex="-1"></a><span class="ss">        th, td </span><span class="ch">{{</span></span>
<span id="cb6-829"><a href="#cb6-829" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb6-830"><a href="#cb6-830" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb6-831"><a href="#cb6-831" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: left;</span></span>
<span id="cb6-832"><a href="#cb6-832" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-833"><a href="#cb6-833" aria-hidden="true" tabindex="-1"></a><span class="ss">        th </span><span class="ch">{{</span></span>
<span id="cb6-834"><a href="#cb6-834" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb6-835"><a href="#cb6-835" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb6-836"><a href="#cb6-836" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb6-837"><a href="#cb6-837" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-transform: uppercase;</span></span>
<span id="cb6-838"><a href="#cb6-838" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb6-839"><a href="#cb6-839" aria-hidden="true" tabindex="-1"></a><span class="ss">            letter-spacing: 0.5px;</span></span>
<span id="cb6-840"><a href="#cb6-840" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-841"><a href="#cb6-841" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:nth-child(even) </span><span class="ch">{{</span></span>
<span id="cb6-842"><a href="#cb6-842" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f8f9fa;</span></span>
<span id="cb6-843"><a href="#cb6-843" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-844"><a href="#cb6-844" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:hover </span><span class="ch">{{</span></span>
<span id="cb6-845"><a href="#cb6-845" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #e3f2fd;</span></span>
<span id="cb6-846"><a href="#cb6-846" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: background-color 0.2s ease;</span></span>
<span id="cb6-847"><a href="#cb6-847" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-848"><a href="#cb6-848" aria-hidden="true" tabindex="-1"></a><span class="ss">        .math </span><span class="ch">{{</span></span>
<span id="cb6-849"><a href="#cb6-849" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center;</span></span>
<span id="cb6-850"><a href="#cb6-850" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb6-851"><a href="#cb6-851" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb6-852"><a href="#cb6-852" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb6-853"><a href="#cb6-853" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb6-854"><a href="#cb6-854" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb6-855"><a href="#cb6-855" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-856"><a href="#cb6-856" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-header </span><span class="ch">{{</span></span>
<span id="cb6-857"><a href="#cb6-857" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb6-858"><a href="#cb6-858" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between;</span></span>
<span id="cb6-859"><a href="#cb6-859" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: center;</span></span>
<span id="cb6-860"><a href="#cb6-860" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 15px;</span></span>
<span id="cb6-861"><a href="#cb6-861" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb6-862"><a href="#cb6-862" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 10px;</span></span>
<span id="cb6-863"><a href="#cb6-863" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-864"><a href="#cb6-864" aria-hidden="true" tabindex="-1"></a><span class="ss">        .author </span><span class="ch">{{</span></span>
<span id="cb6-865"><a href="#cb6-865" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb6-866"><a href="#cb6-866" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb6-867"><a href="#cb6-867" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.1em;</span></span>
<span id="cb6-868"><a href="#cb6-868" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-869"><a href="#cb6-869" aria-hidden="true" tabindex="-1"></a><span class="ss">        .timestamp </span><span class="ch">{{</span></span>
<span id="cb6-870"><a href="#cb6-870" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb6-871"><a href="#cb6-871" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb6-872"><a href="#cb6-872" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e9ecef;</span></span>
<span id="cb6-873"><a href="#cb6-873" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 8px;</span></span>
<span id="cb6-874"><a href="#cb6-874" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb6-875"><a href="#cb6-875" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-876"><a href="#cb6-876" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-content </span><span class="ch">{{</span></span>
<span id="cb6-877"><a href="#cb6-877" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb6-878"><a href="#cb6-878" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb6-879"><a href="#cb6-879" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb6-880"><a href="#cb6-880" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb6-881"><a href="#cb6-881" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 20px;</span></span>
<span id="cb6-882"><a href="#cb6-882" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-883"><a href="#cb6-883" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata </span><span class="ch">{{</span></span>
<span id="cb6-884"><a href="#cb6-884" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e8f4fd;</span></span>
<span id="cb6-885"><a href="#cb6-885" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb6-886"><a href="#cb6-886" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb6-887"><a href="#cb6-887" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 25px;</span></span>
<span id="cb6-888"><a href="#cb6-888" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb6-889"><a href="#cb6-889" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-890"><a href="#cb6-890" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata h3 </span><span class="ch">{{</span></span>
<span id="cb6-891"><a href="#cb6-891" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb6-892"><a href="#cb6-892" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb6-893"><a href="#cb6-893" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-894"><a href="#cb6-894" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 768px) </span><span class="ch">{{</span></span>
<span id="cb6-895"><a href="#cb6-895" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb6-896"><a href="#cb6-896" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 20px;</span></span>
<span id="cb6-897"><a href="#cb6-897" aria-hidden="true" tabindex="-1"></a><span class="ss">                margin: 10px;</span></span>
<span id="cb6-898"><a href="#cb6-898" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb6-899"><a href="#cb6-899" aria-hidden="true" tabindex="-1"></a><span class="ss">            body </span><span class="ch">{{</span></span>
<span id="cb6-900"><a href="#cb6-900" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 10px;</span></span>
<span id="cb6-901"><a href="#cb6-901" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb6-902"><a href="#cb6-902" aria-hidden="true" tabindex="-1"></a><span class="ss">            h1 </span><span class="ch">{{</span></span>
<span id="cb6-903"><a href="#cb6-903" aria-hidden="true" tabindex="-1"></a><span class="ss">                font-size: 1.8em;</span></span>
<span id="cb6-904"><a href="#cb6-904" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb6-905"><a href="#cb6-905" aria-hidden="true" tabindex="-1"></a><span class="ss">            .message-header </span><span class="ch">{{</span></span>
<span id="cb6-906"><a href="#cb6-906" aria-hidden="true" tabindex="-1"></a><span class="ss">                flex-direction: column;</span></span>
<span id="cb6-907"><a href="#cb6-907" aria-hidden="true" tabindex="-1"></a><span class="ss">                align-items: flex-start;</span></span>
<span id="cb6-908"><a href="#cb6-908" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb6-909"><a href="#cb6-909" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb6-910"><a href="#cb6-910" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb6-911"><a href="#cb6-911" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb6-912"><a href="#cb6-912" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb6-913"><a href="#cb6-913" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb6-914"><a href="#cb6-914" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="sc">{</span>content<span class="sc">}</span></span>
<span id="cb6-915"><a href="#cb6-915" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb6-916"><a href="#cb6-916" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb6-917"><a href="#cb6-917" aria-hidden="true" tabindex="-1"></a><span class="ss">        // Configura√ß√£o MathJax para melhor renderiza√ß√£o</span></span>
<span id="cb6-918"><a href="#cb6-918" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb6-919"><a href="#cb6-919" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb6-920"><a href="#cb6-920" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb6-921"><a href="#cb6-921" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb6-922"><a href="#cb6-922" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true,</span></span>
<span id="cb6-923"><a href="#cb6-923" aria-hidden="true" tabindex="-1"></a><span class="ss">                tags: &#39;ams&#39;</span></span>
<span id="cb6-924"><a href="#cb6-924" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb6-925"><a href="#cb6-925" aria-hidden="true" tabindex="-1"></a><span class="ss">            options: </span><span class="ch">{{</span></span>
<span id="cb6-926"><a href="#cb6-926" aria-hidden="true" tabindex="-1"></a><span class="ss">                skipHtmlTags: [&#39;script&#39;, &#39;noscript&#39;, &#39;style&#39;, &#39;textarea&#39;, &#39;pre&#39;],</span></span>
<span id="cb6-927"><a href="#cb6-927" aria-hidden="true" tabindex="-1"></a><span class="ss">                renderActions: </span><span class="ch">{{</span></span>
<span id="cb6-928"><a href="#cb6-928" aria-hidden="true" tabindex="-1"></a><span class="ss">                    addMenu: [0, &#39;&#39;, &#39;&#39;]</span></span>
<span id="cb6-929"><a href="#cb6-929" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb6-930"><a href="#cb6-930" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb6-931"><a href="#cb6-931" aria-hidden="true" tabindex="-1"></a><span class="ss">            startup: </span><span class="ch">{{</span></span>
<span id="cb6-932"><a href="#cb6-932" aria-hidden="true" tabindex="-1"></a><span class="ss">                pageReady() </span><span class="ch">{{</span></span>
<span id="cb6-933"><a href="#cb6-933" aria-hidden="true" tabindex="-1"></a><span class="ss">                    return MathJax.startup.defaultPageReady().then(() =&gt; </span><span class="ch">{{</span></span>
<span id="cb6-934"><a href="#cb6-934" aria-hidden="true" tabindex="-1"></a><span class="ss">                        console.log(&#39;MathJax carregado com sucesso&#39;);</span></span>
<span id="cb6-935"><a href="#cb6-935" aria-hidden="true" tabindex="-1"></a><span class="ss">                    </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb6-936"><a href="#cb6-936" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb6-937"><a href="#cb6-937" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb6-938"><a href="#cb6-938" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb6-939"><a href="#cb6-939" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb6-940"><a href="#cb6-940" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb6-941"><a href="#cb6-941" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb6-942"><a href="#cb6-942" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb6-943"><a href="#cb6-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-944"><a href="#cb6-944" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ... (mantenha o resto dos m√©todos existentes como save_as_html_robust, categorize_conversation, etc.)</span></span>
<span id="cb6-945"><a href="#cb6-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-946"><a href="#cb6-946" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_html_robust(<span class="va">self</span>):</span>
<span id="cb6-947"><a href="#cb6-947" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;M√©todo ROBUSTO para convers√£o HTML - VERS√ÉO OTIMIZADA&quot;&quot;&quot;</span></span>
<span id="cb6-948"><a href="#cb6-948" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb6-949"><a href="#cb6-949" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] HTMLs seriam criados:&quot;</span>)</span>
<span id="cb6-950"><a href="#cb6-950" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb6-951"><a href="#cb6-951" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb6-952"><a href="#cb6-952" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.html&quot;</span></span>
<span id="cb6-953"><a href="#cb6-953" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üåê </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-954"><a href="#cb6-954" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb6-955"><a href="#cb6-955" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-956"><a href="#cb6-956" aria-hidden="true" tabindex="-1"></a>        markdown_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;markdown&#39;</span>])</span>
<span id="cb6-957"><a href="#cb6-957" aria-hidden="true" tabindex="-1"></a>        html_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;html&#39;</span>])</span>
<span id="cb6-958"><a href="#cb6-958" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-959"><a href="#cb6-959" aria-hidden="true" tabindex="-1"></a>        md_files <span class="op">=</span> <span class="bu">list</span>(markdown_folder.glob(<span class="st">&quot;*.md&quot;</span>))</span>
<span id="cb6-960"><a href="#cb6-960" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-961"><a href="#cb6-961" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> md_files:</span>
<span id="cb6-962"><a href="#cb6-962" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Nenhum arquivo Markdown encontrado para convers√£o.&quot;</span>)</span>
<span id="cb6-963"><a href="#cb6-963" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb6-964"><a href="#cb6-964" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-965"><a href="#cb6-965" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÑ Convertendo </span><span class="sc">{</span><span class="bu">len</span>(md_files)<span class="sc">}</span><span class="ss"> arquivos Markdown para HTML (OTIMIZADO)...&quot;</span>)</span>
<span id="cb6-966"><a href="#cb6-966" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-967"><a href="#cb6-967" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verifica se Pandoc est√° dispon√≠vel</span></span>
<span id="cb6-968"><a href="#cb6-968" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb6-969"><a href="#cb6-969" aria-hidden="true" tabindex="-1"></a>            subprocess.run([<span class="st">&#39;pandoc&#39;</span>, <span class="st">&#39;--version&#39;</span>], capture_output<span class="op">=</span><span class="va">True</span>, check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-970"><a href="#cb6-970" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">True</span></span>
<span id="cb6-971"><a href="#cb6-971" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;‚úÖ Pandoc dispon√≠vel - usando convers√£o otimizada&quot;</span>)</span>
<span id="cb6-972"><a href="#cb6-972" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb6-973"><a href="#cb6-973" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">False</span></span>
<span id="cb6-974"><a href="#cb6-974" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è Pandoc n√£o dispon√≠vel - usando fallback Python&quot;</span>)</span>
<span id="cb6-975"><a href="#cb6-975" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-976"><a href="#cb6-976" aria-hidden="true" tabindex="-1"></a>        converted_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-977"><a href="#cb6-977" aria-hidden="true" tabindex="-1"></a>        failed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-978"><a href="#cb6-978" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-979"><a href="#cb6-979" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> md_file <span class="kw">in</span> md_files:</span>
<span id="cb6-980"><a href="#cb6-980" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb6-981"><a href="#cb6-981" aria-hidden="true" tabindex="-1"></a>                html_file <span class="op">=</span> html_folder <span class="op">/</span> md_file.with_suffix(<span class="st">&#39;.html&#39;</span>).name</span>
<span id="cb6-982"><a href="#cb6-982" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb6-983"><a href="#cb6-983" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> html_file.exists():</span>
<span id="cb6-984"><a href="#cb6-984" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚è≠Ô∏è  J√° existe: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-985"><a href="#cb6-985" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-986"><a href="#cb6-986" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb6-987"><a href="#cb6-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-988"><a href="#cb6-988" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ Processando: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-989"><a href="#cb6-989" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb6-990"><a href="#cb6-990" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> pandoc_available:</span>
<span id="cb6-991"><a href="#cb6-991" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_pandoc_optimized(<span class="bu">str</span>(md_file))</span>
<span id="cb6-992"><a href="#cb6-992" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb6-993"><a href="#cb6-993" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_fallback(<span class="bu">str</span>(md_file))</span>
<span id="cb6-994"><a href="#cb6-994" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb6-995"><a href="#cb6-995" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> html_content:</span>
<span id="cb6-996"><a href="#cb6-996" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(html_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb6-997"><a href="#cb6-997" aria-hidden="true" tabindex="-1"></a>                        f.write(html_content)</span>
<span id="cb6-998"><a href="#cb6-998" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb6-999"><a href="#cb6-999" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Criado: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-1000"><a href="#cb6-1000" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-1001"><a href="#cb6-1001" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb6-1002"><a href="#cb6-1002" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Falha na convers√£o: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-1003"><a href="#cb6-1003" aria-hidden="true" tabindex="-1"></a>                    failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-1004"><a href="#cb6-1004" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb6-1005"><a href="#cb6-1005" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb6-1006"><a href="#cb6-1006" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro em </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-1007"><a href="#cb6-1007" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(traceback.format_exc())</span>
<span id="cb6-1008"><a href="#cb6-1008" aria-hidden="true" tabindex="-1"></a>                failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-1009"><a href="#cb6-1009" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb6-1010"><a href="#cb6-1010" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä HTML: </span><span class="sc">{</span>converted_count<span class="sc">}</span><span class="ss"> arquivos criados, </span><span class="sc">{</span>failed_count<span class="sc">}</span><span class="ss"> falhas em &#39;</span><span class="sc">{</span>html_folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb6-1011"><a href="#cb6-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1012"><a href="#cb6-1012" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ... (mantenha todos os outros m√©todos existentes inalterados)</span></span>
<span id="cb6-1013"><a href="#cb6-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1014"><a href="#cb6-1014" aria-hidden="true" tabindex="-1"></a><span class="co"># ... (mantenha o resto do c√≥digo inalterado)</span></span></code></pre></div>
<h2 data-number="1.3" id="principais-otimiza√ß√µes-implementadas"><span class="header-section-number">1.3</span> Principais otimiza√ß√µes
implementadas:</h2>
<h3 data-number="1.3.1" id="convers√£o-pandoc-otimizada-_convert_with_pandoc_optimized"><span class="header-section-number">1.3.1</span> 1. <strong>Convers√£o Pandoc
Otimizada</strong> (<code>_convert_with_pandoc_optimized</code>):</h3>
<ul>
<li><code>--embed-resources</code> para embutir CSS/imagens</li>
<li><code>--highlight-style=pygments</code> para syntax
highlighting</li>
<li><code>--mathjax=assets/tex-mml-chtml.js</code> para MathJax
local</li>
<li>Suporte a extens√µes avan√ßadas do Markdown</li>
</ul>
<h3 data-number="1.3.2" id="mathjax-local"><span class="header-section-number">1.3.2</span> 2. <strong>MathJax
Local</strong>:</h3>
<ul>
<li>Detecta automaticamente se o arquivo local existe</li>
<li>Fallback para CDN se necess√°rio</li>
<li>Configura√ß√£o MathJax otimizada no template</li>
</ul>
<h3 data-number="1.3.3" id="m√©todo-de-fallback-em-camadas"><span class="header-section-number">1.3.3</span> 3. <strong>M√©todo de Fallback
em Camadas</strong>:</h3>
<ul>
<li>Pandoc otimizado ‚Üí Pandoc b√°sico ‚Üí Fallback Python</li>
<li>Timeout aprimorado (120 segundos)</li>
</ul>
<h3 data-number="1.3.4" id="html-aprimorado"><span class="header-section-number">1.3.4</span> 4. <strong>HTML
Aprimorado</strong>:</h3>
<ul>
<li>CSS responsivo e acess√≠vel</li>
<li>Viewport meta tag</li>
<li>Melhorias para c√≥digo, tabelas e matem√°tica</li>
<li>Configura√ß√£o MathJax personalizada</li>
</ul>
<h3 data-number="1.3.5" id="css-personalizado"><span class="header-section-number">1.3.5</span> 5. <strong>CSS
Personalizado</strong>:</h3>
<ul>
<li>Design responsivo</li>
<li>Melhor syntax highlighting</li>
<li>Estilos para elementos matem√°ticos</li>
<li>Melhorias de acessibilidade</li>
</ul>
<h2 data-number="1.4" id="comandos-adicionais-recomendados"><span class="header-section-number">1.4</span> Comandos adicionais
recomendados:</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar CSS personalizado para Pandoc</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> assets</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&gt;</span> assets/pandoc.css <span class="op">&lt;&lt; &#39;EOF&#39;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="st">/* CSS personalizado para Pandoc */</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">code { background: #f4f4f4; padding: 0.2em 0.4em; }</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="st">pre { border-left: 4px solid #3498db; background: #f8f9fa; }</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="st">.math { text-align: center; margin: 1em 0; }</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span></code></pre></div>
<p>Esta vers√£o oferece convers√£o HTML significativamente melhorada com
suporte robusto a matem√°tica, c√≥digo e recursos embutidos.</p>
<hr />
<h3 data-number="1.4.1" id="utilizador-2025-11-07-201847-deepseek-reasoner"><span class="header-section-number">1.4.1</span> üë§ Utilizador <em>(2025-11-07
20:18:47)</em> <em>[deepseek-reasoner]</em></h3>
<p>Pretendo o comb_fragments_system3_html_export.py completo</p>
<hr />
<h3 data-number="1.4.2" id="deepseek-2025-11-07-201847-deepseek-reasoner"><span class="header-section-number">1.4.2</span> ü§ñ DeepSeek <em>(2025-11-07
20:18:47)</em> <em>[deepseek-reasoner]</em></h3>
<p>Vamos atualizar o m√©todo <code>_convert_with_pandoc_optimized</code>
para usar as op√ß√µes solicitadas, incluindo o MathJax local. Al√©m disso,
note que a op√ß√£o <code>--embed-resources</code> √© suportada apenas para
HTML4, ent√£o se n√£o funcionar com HTML5, podemos tentar HTML4. No
entanto, a documenta√ß√£o do Pandoc indica que
<code>--embed-resources</code> s√≥ √© suportado para HTML4. Vamos
ajustar:</p>
<p>Vamos tentar primeiro com HTML5 e <code>--embed-resources</code>. Se
falhar, tentaremos sem embed-resources ou com HTML4.</p>
<p>Vamos criar uma estrat√©gia: 1. Tentar com HTML5 e
<code>--embed-resources</code> (se o Pandoc suportar, mas note que a
documenta√ß√£o atual diz que n√£o) 2. Se falhar, tentar com HTML4 e
<code>--embed-resources</code> 3. Se ainda falhar, tentar sem
embed-resources.</p>
<p>No entanto, a op√ß√£o <code>--embed-resources</code> √© experimental e
pode n√£o ser suportada. Vamos verificar a vers√£o do Pandoc.</p>
<p>Como n√£o temos como verificar a vers√£o no c√≥digo, vamos tentar com
HTML5 e se der erro, tentar sem <code>--embed-resources</code>.</p>
<p>Vamos modificar o m√©todo <code>_convert_with_pandoc_optimized</code>
para tentar duas abordagens:</p>
<p>Primeira tentativa: comando = [‚Ä¶, ‚Äò‚Äìto‚Äô, ‚Äòhtml5‚Äô, ‚Äò‚Äìembed-resources‚Äô,
‚Ä¶]</p>
<p>Se falhar, segunda tentativa (fallback): comando = [‚Ä¶, ‚Äò‚Äìto‚Äô,
‚Äòhtml5‚Äô, ‚Ä¶] (sem embed-resources)</p>
<p>E se ainda falhar, usamos o m√©todo b√°sico.</p>
<p>Al√©m disso, vamos usar o MathJax local se existir.</p>
<p>Vamos reescrever o m√©todo <code>_convert_with_pandoc_optimized</code>
para tentar essas abordagens.</p>
<p>No entanto, note que a op√ß√£o <code>--embed-resources</code> pode n√£o
ser suportada em HTML5. A documenta√ß√£o do Pandoc (<a href="https://pandoc.org/MANUAL.html" class="uri">https://pandoc.org/MANUAL.html</a>) diz: ‚ÄúThis option is
currently only supported for HTML and EPUB output.‚Äù</p>
<p>E para HTML, a op√ß√£o <code>--embed-resources</code> s√≥ √© suportada
para HTML4? Na verdade, a documenta√ß√£o n√£o especifica, mas na pr√°tica
pode n√£o funcionar para HTML5.</p>
<p>Vamos tentar:</p>
<p>Primeiro, tentamos com <code>--to html5</code> e
<code>--embed-resources</code>. Se o Pandoc retornar erro, tentamos sem
<code>--embed-resources</code>.</p>
<p>Vamos tamb√©m adicionar a op√ß√£o <code>--standalone</code> e
<code>--mathjax</code> com o caminho local.</p>
<p>Outra coisa: a op√ß√£o <code>--syntax-highlighting=pygments</code> n√£o
√© v√°lida. O correto √© <code>--highlight-style=pygments</code>.</p>
<p>Vamos corrigir.</p>
<p>Vamos reorganizar o m√©todo:</p>
<p>Tentativa 1: HTML5 com embed-resources (se o Pandoc suportar)
Tentativa 2: HTML5 sem embed-resources Tentativa 3: HTML4 com
embed-resources (se a Tentativa 1 falhar, mas n√£o vamos fazer HTML4
porque o objetivo √© HTML5) Na verdade, o mais importante √© ter HTML5. O
embed-resources √© um plus.</p>
<p>Vamos priorizar HTML5, e se o embed-resources n√£o funcionar, deixamos
sem.</p>
<p>Vamos fazer:</p>
<ol type="1">
<li><p>Tentativa: comando = [pandoc, md_file, ‚Äò‚Äìfrom‚Äô,
‚Äòmarkdown+emoji‚Ä¶‚Äô, ‚Äò‚Äìto‚Äô, ‚Äòhtml5‚Äô, ‚Äò‚Äìstandalone‚Äô, ‚Äò‚Äìembed-resources‚Äô,
‚Äò‚Äìhighlight-style=pygments‚Äô,
‚Äò‚Äìmathjax=assets/tex-mml-chtml.js‚Äô]</p></li>
<li><p>Se falhar, tentar sem <code>--embed-resources</code>: comando =
[pandoc, md_file, ‚Äò‚Äìfrom‚Äô, ‚Äòmarkdown+emoji‚Ä¶‚Äô, ‚Äò‚Äìto‚Äô, ‚Äòhtml5‚Äô,
‚Äò‚Äìstandalone‚Äô, ‚Äò‚Äìhighlight-style=pygments‚Äô,
‚Äò‚Äìmathjax=assets/tex-mml-chtml.js‚Äô]</p></li>
<li><p>Se ainda falhar, usar o m√©todo b√°sico.</p></li>
</ol>
<p>Vamos implementar essa l√≥gica.</p>
<p>Al√©m disso, note que o m√©todo
<code>_convert_with_pandoc_optimized</code> j√° tenta o m√©todo b√°sico em
caso de falha.</p>
<p>Vamos reestruturar:</p>
<p>Primeiro, vamos tentar com todas as op√ß√µes desejadas (incluindo
embed-resources). Se der erro, tentamos sem embed-resources.</p>
<p>Vamos criar uma fun√ß√£o auxiliar para executar o comando Pandoc e
verificar se teve sucesso.</p>
<p>Vamos tamb√©m verificar se o arquivo MathJax local existe e ajustar o
argumento <code>--mathjax</code> accordingly.</p>
<p>Vamos atualizar o c√≥digo conforme abaixo.</p>
<p>Nota: A op√ß√£o <code>--embed-resources</code> pode embutir imagens
tamb√©m, mas isso requer que o Pandoc tenha suporte a isso e que as
imagens estejam acess√≠veis.</p>
<p>Como estamos convertendo markdown que pode ter imagens, isso seria
√∫til, mas se n√£o funcionar, pelo menos temos o fallback.</p>
<p>Vamos ao c√≥digo. Aqui est√° o arquivo
<code>comb_fragments_system3_html_export.py</code> completo com todas as
otimiza√ß√µes:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># comb_fragments_system3_html_export.py</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> webbrowser</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tempfile</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> traceback</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Any, Optional</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> markdown</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CombinedFragmentsSystem:</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dry_run<span class="op">=</span><span class="va">False</span>, force_overwrite<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_dir <span class="op">=</span> Path(<span class="st">&quot;data&quot;</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dry_run <span class="op">=</span> dry_run</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.force_overwrite <span class="op">=</span> force_overwrite</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configurar logging</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        logging.basicConfig(level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">&#39;</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estrutura de pastas organizada</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dirs <span class="op">=</span> {</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;markdown&#39;</span>: <span class="st">&quot;combined_markdown&quot;</span>,</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_csv&quot;</span>, </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_json&quot;</span>,</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;pdfs&#39;</span>: <span class="st">&quot;combined_pdfs&quot;</span>,</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;html&#39;</span>: <span class="st">&quot;combined_html&quot;</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.single_files <span class="op">=</span> {</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_all_conversations.csv&quot;</span>,</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_all_conversations.json&quot;</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.index_file <span class="op">=</span> <span class="st">&quot;index.html&quot;</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations <span class="op">=</span> []</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configura√ß√£o de processamento por fonte</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.processors <span class="op">=</span> {</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;qwen&#39;</span>: {</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chat-export.json&quot;</span>,</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_qwen_enhanced,</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;chatgpt&#39;</span>: {</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chatgpt.zip&quot;</span>, </span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_chatgpt,</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;deepseek&#39;</span>: {</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;deepseek_data.zip&quot;</span>,</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_deepseek,</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;grok&#39;</span>: {</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;grok.zip&quot;</span>,</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_grok,</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sanitize_filename(<span class="va">self</span>, text: <span class="bu">str</span>, max_len: <span class="bu">int</span> <span class="op">=</span> <span class="dv">50</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Sanitiza nomes de arquivo REMOVENDO ESPA√áOS e preservando emojis&quot;&quot;&quot;</span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove caracteres inv√°lidos</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="dv">\s</span><span class="pp">]</span><span class="vs">&#39;</span>  <span class="co"># Inclui \s para remover espa√ßos</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;_&#39;</span>, text)  <span class="co"># Substitui espa√ßos por underscores</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;_</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39;_&#39;</span>, sanitized)  <span class="co"># Remove underscores duplicados</span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> sanitized.strip(<span class="st">&#39;_&#39;</span>)  <span class="co"># Remove underscores no in√≠cio e fim</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Limita o comprimento</span></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(sanitized) <span class="op">&gt;</span> max_len:</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Tenta cortar em um ponto l√≥gico (underscore)</span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;_&#39;</span> <span class="kw">in</span> sanitized[:max_len]:</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>                last_underscore <span class="op">=</span> sanitized[:max_len].rfind(<span class="st">&#39;_&#39;</span>)</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> last_underscore <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>                    sanitized <span class="op">=</span> sanitized[:last_underscore]</span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>                sanitized <span class="op">=</span> sanitized[:max_len]</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_original_title(<span class="va">self</span>, text: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Preserva o t√≠tulo original com espa√ßos, apenas removendo caracteres realmente inv√°lidos&quot;&quot;&quot;</span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove apenas caracteres realmente problem√°ticos, mantendo espa√ßos</span></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="pp">]</span><span class="vs">&#39;</span></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;&#39;</span>, text)</span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;</span><span class="dv">\s</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39; &#39;</span>, sanitized.strip())</span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_special_content(<span class="va">self</span>, content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Preserva f√≥rmulas matem√°ticas, c√≥digo e formata√ß√£o especial&quot;&quot;&quot;</span></span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;&quot;</span></span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>        preserved_content <span class="op">=</span> content</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Corrige problemas com barras invertidas em LaTeX</span></span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>        latex_corrections <span class="op">=</span> {</span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ärac&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">frac&#39;</span>,</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Çarepsilon&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">varepsilon&#39;</span>,</span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ç&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span>,</span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ä&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span></span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> wrong, correct <span class="kw">in</span> latex_corrections.items():</span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>            preserved_content <span class="op">=</span> preserved_content.replace(wrong, correct)</span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> preserved_content</span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ensure_directories(<span class="va">self</span>):</span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Cria todas as pastas necess√°rias&quot;&quot;&quot;</span></span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;DRY-RUN: Pastas seriam criadas:&quot;</span>)</span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a>            Path(folder).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;Pasta criada: </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> run(<span class="va">self</span>):</span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Executa o processamento completo&quot;&quot;&quot;</span></span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;SISTEMA COMBINADO DE EXPORTA√á√ïES COM HTML (Qwen3, ChatGPT, DeepSeek, Grok)&quot;</span>)</span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.data_dir.exists():</span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;Pasta &#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">}</span><span class="ss">&#39; n√£o encontrada.&quot;</span>)</span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;Crie a pasta &#39;data&#39; e coloque os arquivos de exporta√ß√£o:&quot;</span>)</span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   - </span><span class="sc">{</span>config[<span class="st">&#39;file&#39;</span>]<span class="sc">}</span><span class="ss"> (para </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;Usando pasta de dados: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ensure_directories()</span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a>        processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> config[<span class="st">&#39;enabled&#39;</span>]:</span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a>                file_path <span class="op">=</span> <span class="va">self</span>.data_dir <span class="op">/</span> config[<span class="st">&#39;file&#39;</span>]</span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> file_path.exists():</span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Processando </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a>                    config[<span class="st">&#39;method&#39;</span>](file_path)</span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.warning(<span class="ss">f&quot;</span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">: arquivo n√£o encontrado - </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> processed_count <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhum arquivo de exporta√ß√£o encontrado na pasta &#39;data&#39;.&quot;</span>)</span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhuma conversa foi extra√≠da dos arquivos.&quot;</span>)</span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._post_process_conversations()</span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-182"><a href="#cb8-182" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._export_all_formats()</span>
<span id="cb8-183"><a href="#cb8-183" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üéâ SISTEMA COMBINADO FINALIZADO!&quot;</span>)</span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ √çndice: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> Path(<span class="va">self</span>.index_file).exists():</span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true" tabindex="-1"></a>                webbrowser.<span class="bu">open</span>(<span class="ss">f&#39;file://</span><span class="sc">{</span>Path(<span class="va">self</span>.index_file)<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üîÆ MODO DRY-RUN: Nenhum arquivo foi criado.&quot;</span>)</span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _post_process_conversations(<span class="va">self</span>):</span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processamento p√≥s-extra√ß√£o das conversas&quot;&quot;&quot;</span></span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations.sort(</span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a>            key<span class="op">=</span><span class="kw">lambda</span> x: <span class="va">self</span>.parse_timestamp_for_sorting(</span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a>                x.get(<span class="st">&#39;updated_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;created_at&#39;</span>)</span>
<span id="cb8-195"><a href="#cb8-195" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb8-196"><a href="#cb8-196" aria-hidden="true" tabindex="-1"></a>            reverse<span class="op">=</span><span class="va">True</span></span>
<span id="cb8-197"><a href="#cb8-197" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-198"><a href="#cb8-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-199"><a href="#cb8-199" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.all_conversations):</span>
<span id="cb8-200"><a href="#cb8-200" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;number&#39;</span>] <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb8-201"><a href="#cb8-201" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;category&#39;</span>] <span class="op">=</span> <span class="va">self</span>.categorize_conversation(conv[<span class="st">&#39;title&#39;</span>], conv.get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;&#39;</span>))</span>
<span id="cb8-202"><a href="#cb8-202" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;source&#39;</span>, <span class="st">&#39;Desconhecido&#39;</span>)</span>
<span id="cb8-203"><a href="#cb8-203" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;messages&#39;</span>, [])</span>
<span id="cb8-204"><a href="#cb8-204" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;summary&#39;</span>, conv[<span class="st">&#39;messages&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> conv[<span class="st">&#39;messages&#39;</span>] <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>)</span>
<span id="cb8-205"><a href="#cb8-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-206"><a href="#cb8-206" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä Total combinado de conversas: </span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-207"><a href="#cb8-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-208"><a href="#cb8-208" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _export_all_formats(<span class="va">self</span>):</span>
<span id="cb8-209"><a href="#cb8-209" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Exporta para todos os formatos&quot;&quot;&quot;</span></span>
<span id="cb8-210"><a href="#cb8-210" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">üîÑ Exportando para formatos...&quot;</span>)</span>
<span id="cb8-211"><a href="#cb8-211" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_markdown_enhanced()</span>
<span id="cb8-212"><a href="#cb8-212" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_html_robust()</span>
<span id="cb8-213"><a href="#cb8-213" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_csv() </span>
<span id="cb8-214"><a href="#cb8-214" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_json()</span>
<span id="cb8-215"><a href="#cb8-215" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_all_to_single_files()</span>
<span id="cb8-216"><a href="#cb8-216" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.create_searchable_index()</span>
<span id="cb8-217"><a href="#cb8-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-218"><a href="#cb8-218" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_optimized(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb8-219"><a href="#cb8-219" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Convers√£o OTIMIZADA com Pandoc usando MathJax local e recursos embutidos&quot;&quot;&quot;</span></span>
<span id="cb8-220"><a href="#cb8-220" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-221"><a href="#cb8-221" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Convertendo com Pandoc otimizado: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-222"><a href="#cb8-222" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-223"><a href="#cb8-223" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica se o arquivo MathJax local existe</span></span>
<span id="cb8-224"><a href="#cb8-224" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb8-225"><a href="#cb8-225" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb8-226"><a href="#cb8-226" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-227"><a href="#cb8-227" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Comando otimizado para HTML5 com recursos embutidos</span></span>
<span id="cb8-228"><a href="#cb8-228" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb8-229"><a href="#cb8-229" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb8-230"><a href="#cb8-230" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb8-231"><a href="#cb8-231" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji+autolink_bare_uris+tex_math_single_backslash&#39;</span>,</span>
<span id="cb8-232"><a href="#cb8-232" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb8-233"><a href="#cb8-233" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb8-234"><a href="#cb8-234" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--embed-resources&#39;</span>,</span>
<span id="cb8-235"><a href="#cb8-235" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--highlight-style=pygments&#39;</span>,</span>
<span id="cb8-236"><a href="#cb8-236" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb8-237"><a href="#cb8-237" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb8-238"><a href="#cb8-238" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-239"><a href="#cb8-239" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Remove argumentos vazios</span></span>
<span id="cb8-240"><a href="#cb8-240" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [arg <span class="cf">for</span> arg <span class="kw">in</span> command <span class="cf">if</span> arg]</span>
<span id="cb8-241"><a href="#cb8-241" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-242"><a href="#cb8-242" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb8-243"><a href="#cb8-243" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb8-244"><a href="#cb8-244" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb8-245"><a href="#cb8-245" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb8-246"><a href="#cb8-246" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb8-247"><a href="#cb8-247" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">120</span></span>
<span id="cb8-248"><a href="#cb8-248" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb8-249"><a href="#cb8-249" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-250"><a href="#cb8-250" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb8-251"><a href="#cb8-251" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> result.stdout</span>
<span id="cb8-252"><a href="#cb8-252" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-253"><a href="#cb8-253" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Aplica otimiza√ß√µes adicionais</span></span>
<span id="cb8-254"><a href="#cb8-254" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="va">self</span>._optimize_html_content(html_content)</span>
<span id="cb8-255"><a href="#cb8-255" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> html_content</span>
<span id="cb8-256"><a href="#cb8-256" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb8-257"><a href="#cb8-257" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc otimizado falhou, tentando m√©todo b√°sico: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-258"><a href="#cb8-258" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb8-259"><a href="#cb8-259" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-260"><a href="#cb8-260" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> subprocess.TimeoutExpired:</span>
<span id="cb8-261"><a href="#cb8-261" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Timeout no Pandoc otimizado&quot;</span>)</span>
<span id="cb8-262"><a href="#cb8-262" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb8-263"><a href="#cb8-263" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-264"><a href="#cb8-264" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc otimizado: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-265"><a href="#cb8-265" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb8-266"><a href="#cb8-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-267"><a href="#cb8-267" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_basic(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb8-268"><a href="#cb8-268" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;M√©todo b√°sico de fallback para Pandoc&quot;&quot;&quot;</span></span>
<span id="cb8-269"><a href="#cb8-269" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-270"><a href="#cb8-270" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Tentando convers√£o b√°sica: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-271"><a href="#cb8-271" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-272"><a href="#cb8-272" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb8-273"><a href="#cb8-273" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb8-274"><a href="#cb8-274" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-275"><a href="#cb8-275" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb8-276"><a href="#cb8-276" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb8-277"><a href="#cb8-277" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb8-278"><a href="#cb8-278" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown&#39;</span>,</span>
<span id="cb8-279"><a href="#cb8-279" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb8-280"><a href="#cb8-280" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb8-281"><a href="#cb8-281" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb8-282"><a href="#cb8-282" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb8-283"><a href="#cb8-283" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-284"><a href="#cb8-284" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb8-285"><a href="#cb8-285" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb8-286"><a href="#cb8-286" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb8-287"><a href="#cb8-287" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb8-288"><a href="#cb8-288" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb8-289"><a href="#cb8-289" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">60</span></span>
<span id="cb8-290"><a href="#cb8-290" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb8-291"><a href="#cb8-291" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-292"><a href="#cb8-292" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb8-293"><a href="#cb8-293" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._optimize_html_content(result.stdout)</span>
<span id="cb8-294"><a href="#cb8-294" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb8-295"><a href="#cb8-295" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc b√°sico falhou, usando fallback Python: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-296"><a href="#cb8-296" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb8-297"><a href="#cb8-297" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-298"><a href="#cb8-298" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-299"><a href="#cb8-299" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc b√°sico: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-300"><a href="#cb8-300" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb8-301"><a href="#cb8-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-302"><a href="#cb8-302" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _optimize_html_content(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-303"><a href="#cb8-303" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Aplica otimiza√ß√µes finais ao conte√∫do HTML&quot;&quot;&quot;</span></span>
<span id="cb8-304"><a href="#cb8-304" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona viewport para responsividade</span></span>
<span id="cb8-305"><a href="#cb8-305" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;viewport&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb8-306"><a href="#cb8-306" aria-hidden="true" tabindex="-1"></a>            viewport_meta <span class="op">=</span> <span class="st">&#39;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#39;</span></span>
<span id="cb8-307"><a href="#cb8-307" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="ss">    </span><span class="sc">{</span>viewport_meta<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb8-308"><a href="#cb8-308" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-309"><a href="#cb8-309" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Melhora acessibilidade</span></span>
<span id="cb8-310"><a href="#cb8-310" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;html&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;lang&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb8-311"><a href="#cb8-311" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;html&gt;&#39;</span>, <span class="st">&#39;&lt;html lang=&quot;pt-BR&quot;&gt;&#39;</span>)</span>
<span id="cb8-312"><a href="#cb8-312" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-313"><a href="#cb8-313" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona CSS personalizado se necess√°rio</span></span>
<span id="cb8-314"><a href="#cb8-314" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;style&gt;&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content <span class="kw">or</span> <span class="st">&#39;custom-css&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb8-315"><a href="#cb8-315" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> <span class="va">self</span>._inject_custom_css(html_content)</span>
<span id="cb8-316"><a href="#cb8-316" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-317"><a href="#cb8-317" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb8-318"><a href="#cb8-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-319"><a href="#cb8-319" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _inject_custom_css(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-320"><a href="#cb8-320" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Injeta CSS personalizado para melhorar a apar√™ncia&quot;&quot;&quot;</span></span>
<span id="cb8-321"><a href="#cb8-321" aria-hidden="true" tabindex="-1"></a>        custom_css <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb8-322"><a href="#cb8-322" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;style&gt;</span></span>
<span id="cb8-323"><a href="#cb8-323" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para c√≥digo e matem√°tica */</span></span>
<span id="cb8-324"><a href="#cb8-324" aria-hidden="true" tabindex="-1"></a><span class="st">            .math { display: block; text-align: center; margin: 1em 0; }</span></span>
<span id="cb8-325"><a href="#cb8-325" aria-hidden="true" tabindex="-1"></a><span class="st">            .math inline { display: inline-block; }</span></span>
<span id="cb8-326"><a href="#cb8-326" aria-hidden="true" tabindex="-1"></a><span class="st">            pre { border-left: 4px solid #3498db; background: #f8f9fa; }</span></span>
<span id="cb8-327"><a href="#cb8-327" aria-hidden="true" tabindex="-1"></a><span class="st">            code { background: #e9ecef; padding: 0.2em 0.4em; border-radius: 3px; }</span></span>
<span id="cb8-328"><a href="#cb8-328" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-329"><a href="#cb8-329" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias responsivas */</span></span>
<span id="cb8-330"><a href="#cb8-330" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 768px) {</span></span>
<span id="cb8-331"><a href="#cb8-331" aria-hidden="true" tabindex="-1"></a><span class="st">                body { padding: 10px; font-size: 14px; }</span></span>
<span id="cb8-332"><a href="#cb8-332" aria-hidden="true" tabindex="-1"></a><span class="st">                .container { padding: 15px; }</span></span>
<span id="cb8-333"><a href="#cb8-333" aria-hidden="true" tabindex="-1"></a><span class="st">                pre { font-size: 12px; }</span></span>
<span id="cb8-334"><a href="#cb8-334" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-335"><a href="#cb8-335" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-336"><a href="#cb8-336" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para tabelas */</span></span>
<span id="cb8-337"><a href="#cb8-337" aria-hidden="true" tabindex="-1"></a><span class="st">            table { width: 100%; border-collapse: collapse; margin: 1em 0; }</span></span>
<span id="cb8-338"><a href="#cb8-338" aria-hidden="true" tabindex="-1"></a><span class="st">            th, td { border: 1px solid #dee2e6; padding: 0.75rem; }</span></span>
<span id="cb8-339"><a href="#cb8-339" aria-hidden="true" tabindex="-1"></a><span class="st">            th { background-color: #3498db; color: white; }</span></span>
<span id="cb8-340"><a href="#cb8-340" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-341"><a href="#cb8-341" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para blocos de cita√ß√£o */</span></span>
<span id="cb8-342"><a href="#cb8-342" aria-hidden="true" tabindex="-1"></a><span class="st">            blockquote { </span></span>
<span id="cb8-343"><a href="#cb8-343" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb8-344"><a href="#cb8-344" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 1em 0; </span></span>
<span id="cb8-345"><a href="#cb8-345" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 1em; </span></span>
<span id="cb8-346"><a href="#cb8-346" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #6c757d;</span></span>
<span id="cb8-347"><a href="#cb8-347" aria-hidden="true" tabindex="-1"></a><span class="st">                font-style: italic;</span></span>
<span id="cb8-348"><a href="#cb8-348" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-349"><a href="#cb8-349" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/style&gt;</span></span>
<span id="cb8-350"><a href="#cb8-350" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb8-351"><a href="#cb8-351" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-352"><a href="#cb8-352" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;/head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb8-353"><a href="#cb8-353" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;/head&gt;&#39;</span>, <span class="ss">f&#39;</span><span class="sc">{</span>custom_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;&#39;</span>)</span>
<span id="cb8-354"><a href="#cb8-354" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb8-355"><a href="#cb8-355" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>custom_css<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb8-356"><a href="#cb8-356" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb8-357"><a href="#cb8-357" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Se n√£o encontrar head, adiciona antes do body</span></span>
<span id="cb8-358"><a href="#cb8-358" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;&lt;body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb8-359"><a href="#cb8-359" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;body&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>custom_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;&#39;</span>)</span>
<span id="cb8-360"><a href="#cb8-360" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb8-361"><a href="#cb8-361" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>custom_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;</span><span class="ch">\n</span><span class="sc">{</span>html_content<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/body&gt;&#39;</span></span>
<span id="cb8-362"><a href="#cb8-362" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-363"><a href="#cb8-363" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb8-364"><a href="#cb8-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-365"><a href="#cb8-365" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_fallback(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-366"><a href="#cb8-366" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Fallback para convers√£o quando Pandoc falha&quot;&quot;&quot;</span></span>
<span id="cb8-367"><a href="#cb8-367" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-368"><a href="#cb8-368" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(md_file_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-369"><a href="#cb8-369" aria-hidden="true" tabindex="-1"></a>                md_content <span class="op">=</span> f.read()</span>
<span id="cb8-370"><a href="#cb8-370" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-371"><a href="#cb8-371" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extens√µes avan√ßadas para melhor convers√£o</span></span>
<span id="cb8-372"><a href="#cb8-372" aria-hidden="true" tabindex="-1"></a>            extensions <span class="op">=</span> [</span>
<span id="cb8-373"><a href="#cb8-373" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;extra&#39;</span>, <span class="st">&#39;tables&#39;</span>, <span class="st">&#39;fenced_code&#39;</span>, <span class="st">&#39;codehilite&#39;</span>, </span>
<span id="cb8-374"><a href="#cb8-374" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;toc&#39;</span>, <span class="st">&#39;md_in_html&#39;</span>, <span class="st">&#39;attr_list&#39;</span></span>
<span id="cb8-375"><a href="#cb8-375" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb8-376"><a href="#cb8-376" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-377"><a href="#cb8-377" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> markdown.markdown(</span>
<span id="cb8-378"><a href="#cb8-378" aria-hidden="true" tabindex="-1"></a>                md_content,</span>
<span id="cb8-379"><a href="#cb8-379" aria-hidden="true" tabindex="-1"></a>                extensions<span class="op">=</span>extensions,</span>
<span id="cb8-380"><a href="#cb8-380" aria-hidden="true" tabindex="-1"></a>                output_format<span class="op">=</span><span class="st">&#39;html5&#39;</span></span>
<span id="cb8-381"><a href="#cb8-381" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb8-382"><a href="#cb8-382" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-383"><a href="#cb8-383" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_enhanced_html_template(html_content, Path(md_file_path).name)</span>
<span id="cb8-384"><a href="#cb8-384" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-385"><a href="#cb8-385" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-386"><a href="#cb8-386" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Fallback tamb√©m falhou: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-387"><a href="#cb8-387" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_basic_html(md_content, Path(md_file_path).name)</span>
<span id="cb8-388"><a href="#cb8-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-389"><a href="#cb8-389" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_enhanced_html_template(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-390"><a href="#cb8-390" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Template HTML aprimorado com suporte a MathJax local/online&quot;&quot;&quot;</span></span>
<span id="cb8-391"><a href="#cb8-391" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb8-392"><a href="#cb8-392" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-393"><a href="#cb8-393" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb8-394"><a href="#cb8-394" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html lang=&quot;pt-BR&quot;&gt;</span></span>
<span id="cb8-395"><a href="#cb8-395" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb8-396"><a href="#cb8-396" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb8-397"><a href="#cb8-397" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb8-398"><a href="#cb8-398" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb8-399"><a href="#cb8-399" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb8-400"><a href="#cb8-400" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span></span>
<span id="cb8-401"><a href="#cb8-401" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb8-402"><a href="#cb8-402" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb8-403"><a href="#cb8-403" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0;</span></span>
<span id="cb8-404"><a href="#cb8-404" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb8-405"><a href="#cb8-405" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb8-406"><a href="#cb8-406" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333;</span></span>
<span id="cb8-407"><a href="#cb8-407" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-408"><a href="#cb8-408" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb8-409"><a href="#cb8-409" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 900px;</span></span>
<span id="cb8-410"><a href="#cb8-410" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb8-411"><a href="#cb8-411" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb8-412"><a href="#cb8-412" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 40px;</span></span>
<span id="cb8-413"><a href="#cb8-413" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 10px;</span></span>
<span id="cb8-414"><a href="#cb8-414" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb8-415"><a href="#cb8-415" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-416"><a href="#cb8-416" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1, h2, h3, h4, h5 </span><span class="ch">{{</span></span>
<span id="cb8-417"><a href="#cb8-417" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb8-418"><a href="#cb8-418" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 1.8em;</span></span>
<span id="cb8-419"><a href="#cb8-419" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-420"><a href="#cb8-420" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1 </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-421"><a href="#cb8-421" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 3px solid #3498db; </span></span>
<span id="cb8-422"><a href="#cb8-422" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 15px; </span></span>
<span id="cb8-423"><a href="#cb8-423" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb8-424"><a href="#cb8-424" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 2.2em;</span></span>
<span id="cb8-425"><a href="#cb8-425" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-426"><a href="#cb8-426" aria-hidden="true" tabindex="-1"></a><span class="ss">        h2 </span><span class="ch">{{</span></span>
<span id="cb8-427"><a href="#cb8-427" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb8-428"><a href="#cb8-428" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb8-429"><a href="#cb8-429" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 2em;</span></span>
<span id="cb8-430"><a href="#cb8-430" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-431"><a href="#cb8-431" aria-hidden="true" tabindex="-1"></a><span class="ss">        code </span><span class="ch">{{</span></span>
<span id="cb8-432"><a href="#cb8-432" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f4f4f4;</span></span>
<span id="cb8-433"><a href="#cb8-433" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 3px 8px;</span></span>
<span id="cb8-434"><a href="#cb8-434" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb8-435"><a href="#cb8-435" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb8-436"><a href="#cb8-436" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #c7254e;</span></span>
<span id="cb8-437"><a href="#cb8-437" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb8-438"><a href="#cb8-438" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-439"><a href="#cb8-439" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span></span>
<span id="cb8-440"><a href="#cb8-440" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #2d2d2d;</span></span>
<span id="cb8-441"><a href="#cb8-441" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #f8f8f2;</span></span>
<span id="cb8-442"><a href="#cb8-442" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb8-443"><a href="#cb8-443" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb8-444"><a href="#cb8-444" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb8-445"><a href="#cb8-445" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 5px solid #3498db;</span></span>
<span id="cb8-446"><a href="#cb8-446" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb8-447"><a href="#cb8-447" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.4;</span></span>
<span id="cb8-448"><a href="#cb8-448" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-449"><a href="#cb8-449" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre code </span><span class="ch">{{</span></span>
<span id="cb8-450"><a href="#cb8-450" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: none;</span></span>
<span id="cb8-451"><a href="#cb8-451" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: inherit;</span></span>
<span id="cb8-452"><a href="#cb8-452" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 0;</span></span>
<span id="cb8-453"><a href="#cb8-453" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-454"><a href="#cb8-454" aria-hidden="true" tabindex="-1"></a><span class="ss">        blockquote </span><span class="ch">{{</span></span>
<span id="cb8-455"><a href="#cb8-455" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb8-456"><a href="#cb8-456" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 25px 0;</span></span>
<span id="cb8-457"><a href="#cb8-457" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 25px;</span></span>
<span id="cb8-458"><a href="#cb8-458" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb8-459"><a href="#cb8-459" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-style: italic;</span></span>
<span id="cb8-460"><a href="#cb8-460" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb8-461"><a href="#cb8-461" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb8-462"><a href="#cb8-462" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 0 8px 8px 0;</span></span>
<span id="cb8-463"><a href="#cb8-463" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-464"><a href="#cb8-464" aria-hidden="true" tabindex="-1"></a><span class="ss">        table </span><span class="ch">{{</span></span>
<span id="cb8-465"><a href="#cb8-465" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-collapse: collapse;</span></span>
<span id="cb8-466"><a href="#cb8-466" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 100%;</span></span>
<span id="cb8-467"><a href="#cb8-467" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb8-468"><a href="#cb8-468" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb8-469"><a href="#cb8-469" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb8-470"><a href="#cb8-470" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb8-471"><a href="#cb8-471" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-472"><a href="#cb8-472" aria-hidden="true" tabindex="-1"></a><span class="ss">        th, td </span><span class="ch">{{</span></span>
<span id="cb8-473"><a href="#cb8-473" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb8-474"><a href="#cb8-474" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb8-475"><a href="#cb8-475" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: left;</span></span>
<span id="cb8-476"><a href="#cb8-476" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-477"><a href="#cb8-477" aria-hidden="true" tabindex="-1"></a><span class="ss">        th </span><span class="ch">{{</span></span>
<span id="cb8-478"><a href="#cb8-478" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb8-479"><a href="#cb8-479" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb8-480"><a href="#cb8-480" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb8-481"><a href="#cb8-481" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-transform: uppercase;</span></span>
<span id="cb8-482"><a href="#cb8-482" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb8-483"><a href="#cb8-483" aria-hidden="true" tabindex="-1"></a><span class="ss">            letter-spacing: 0.5px;</span></span>
<span id="cb8-484"><a href="#cb8-484" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-485"><a href="#cb8-485" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:nth-child(even) </span><span class="ch">{{</span></span>
<span id="cb8-486"><a href="#cb8-486" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f8f9fa;</span></span>
<span id="cb8-487"><a href="#cb8-487" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-488"><a href="#cb8-488" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:hover </span><span class="ch">{{</span></span>
<span id="cb8-489"><a href="#cb8-489" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #e3f2fd;</span></span>
<span id="cb8-490"><a href="#cb8-490" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: background-color 0.2s ease;</span></span>
<span id="cb8-491"><a href="#cb8-491" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-492"><a href="#cb8-492" aria-hidden="true" tabindex="-1"></a><span class="ss">        .math </span><span class="ch">{{</span></span>
<span id="cb8-493"><a href="#cb8-493" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center;</span></span>
<span id="cb8-494"><a href="#cb8-494" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb8-495"><a href="#cb8-495" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb8-496"><a href="#cb8-496" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb8-497"><a href="#cb8-497" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb8-498"><a href="#cb8-498" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb8-499"><a href="#cb8-499" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-500"><a href="#cb8-500" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-header </span><span class="ch">{{</span></span>
<span id="cb8-501"><a href="#cb8-501" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb8-502"><a href="#cb8-502" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between;</span></span>
<span id="cb8-503"><a href="#cb8-503" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: center;</span></span>
<span id="cb8-504"><a href="#cb8-504" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 15px;</span></span>
<span id="cb8-505"><a href="#cb8-505" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb8-506"><a href="#cb8-506" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 10px;</span></span>
<span id="cb8-507"><a href="#cb8-507" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-508"><a href="#cb8-508" aria-hidden="true" tabindex="-1"></a><span class="ss">        .author </span><span class="ch">{{</span></span>
<span id="cb8-509"><a href="#cb8-509" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb8-510"><a href="#cb8-510" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb8-511"><a href="#cb8-511" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.1em;</span></span>
<span id="cb8-512"><a href="#cb8-512" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-513"><a href="#cb8-513" aria-hidden="true" tabindex="-1"></a><span class="ss">        .timestamp </span><span class="ch">{{</span></span>
<span id="cb8-514"><a href="#cb8-514" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb8-515"><a href="#cb8-515" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb8-516"><a href="#cb8-516" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e9ecef;</span></span>
<span id="cb8-517"><a href="#cb8-517" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 8px;</span></span>
<span id="cb8-518"><a href="#cb8-518" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb8-519"><a href="#cb8-519" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-520"><a href="#cb8-520" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-content </span><span class="ch">{{</span></span>
<span id="cb8-521"><a href="#cb8-521" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb8-522"><a href="#cb8-522" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb8-523"><a href="#cb8-523" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb8-524"><a href="#cb8-524" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb8-525"><a href="#cb8-525" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 20px;</span></span>
<span id="cb8-526"><a href="#cb8-526" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-527"><a href="#cb8-527" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata </span><span class="ch">{{</span></span>
<span id="cb8-528"><a href="#cb8-528" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e8f4fd;</span></span>
<span id="cb8-529"><a href="#cb8-529" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb8-530"><a href="#cb8-530" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb8-531"><a href="#cb8-531" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 25px;</span></span>
<span id="cb8-532"><a href="#cb8-532" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb8-533"><a href="#cb8-533" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-534"><a href="#cb8-534" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata h3 </span><span class="ch">{{</span></span>
<span id="cb8-535"><a href="#cb8-535" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb8-536"><a href="#cb8-536" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb8-537"><a href="#cb8-537" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-538"><a href="#cb8-538" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 768px) </span><span class="ch">{{</span></span>
<span id="cb8-539"><a href="#cb8-539" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb8-540"><a href="#cb8-540" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 20px;</span></span>
<span id="cb8-541"><a href="#cb8-541" aria-hidden="true" tabindex="-1"></a><span class="ss">                margin: 10px;</span></span>
<span id="cb8-542"><a href="#cb8-542" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb8-543"><a href="#cb8-543" aria-hidden="true" tabindex="-1"></a><span class="ss">            body </span><span class="ch">{{</span></span>
<span id="cb8-544"><a href="#cb8-544" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 10px;</span></span>
<span id="cb8-545"><a href="#cb8-545" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb8-546"><a href="#cb8-546" aria-hidden="true" tabindex="-1"></a><span class="ss">            h1 </span><span class="ch">{{</span></span>
<span id="cb8-547"><a href="#cb8-547" aria-hidden="true" tabindex="-1"></a><span class="ss">                font-size: 1.8em;</span></span>
<span id="cb8-548"><a href="#cb8-548" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb8-549"><a href="#cb8-549" aria-hidden="true" tabindex="-1"></a><span class="ss">            .message-header </span><span class="ch">{{</span></span>
<span id="cb8-550"><a href="#cb8-550" aria-hidden="true" tabindex="-1"></a><span class="ss">                flex-direction: column;</span></span>
<span id="cb8-551"><a href="#cb8-551" aria-hidden="true" tabindex="-1"></a><span class="ss">                align-items: flex-start;</span></span>
<span id="cb8-552"><a href="#cb8-552" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb8-553"><a href="#cb8-553" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-554"><a href="#cb8-554" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb8-555"><a href="#cb8-555" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb8-556"><a href="#cb8-556" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb8-557"><a href="#cb8-557" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb8-558"><a href="#cb8-558" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="sc">{</span>content<span class="sc">}</span></span>
<span id="cb8-559"><a href="#cb8-559" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb8-560"><a href="#cb8-560" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb8-561"><a href="#cb8-561" aria-hidden="true" tabindex="-1"></a><span class="ss">        // Configura√ß√£o MathJax para melhor renderiza√ß√£o</span></span>
<span id="cb8-562"><a href="#cb8-562" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb8-563"><a href="#cb8-563" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb8-564"><a href="#cb8-564" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb8-565"><a href="#cb8-565" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb8-566"><a href="#cb8-566" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true,</span></span>
<span id="cb8-567"><a href="#cb8-567" aria-hidden="true" tabindex="-1"></a><span class="ss">                tags: &#39;ams&#39;</span></span>
<span id="cb8-568"><a href="#cb8-568" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb8-569"><a href="#cb8-569" aria-hidden="true" tabindex="-1"></a><span class="ss">            options: </span><span class="ch">{{</span></span>
<span id="cb8-570"><a href="#cb8-570" aria-hidden="true" tabindex="-1"></a><span class="ss">                skipHtmlTags: [&#39;script&#39;, &#39;noscript&#39;, &#39;style&#39;, &#39;textarea&#39;, &#39;pre&#39;],</span></span>
<span id="cb8-571"><a href="#cb8-571" aria-hidden="true" tabindex="-1"></a><span class="ss">                renderActions: </span><span class="ch">{{</span></span>
<span id="cb8-572"><a href="#cb8-572" aria-hidden="true" tabindex="-1"></a><span class="ss">                    addMenu: [0, &#39;&#39;, &#39;&#39;]</span></span>
<span id="cb8-573"><a href="#cb8-573" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb8-574"><a href="#cb8-574" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb8-575"><a href="#cb8-575" aria-hidden="true" tabindex="-1"></a><span class="ss">            startup: </span><span class="ch">{{</span></span>
<span id="cb8-576"><a href="#cb8-576" aria-hidden="true" tabindex="-1"></a><span class="ss">                pageReady() </span><span class="ch">{{</span></span>
<span id="cb8-577"><a href="#cb8-577" aria-hidden="true" tabindex="-1"></a><span class="ss">                    return MathJax.startup.defaultPageReady().then(() =&gt; </span><span class="ch">{{</span></span>
<span id="cb8-578"><a href="#cb8-578" aria-hidden="true" tabindex="-1"></a><span class="ss">                        console.log(&#39;MathJax carregado com sucesso&#39;);</span></span>
<span id="cb8-579"><a href="#cb8-579" aria-hidden="true" tabindex="-1"></a><span class="ss">                    </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb8-580"><a href="#cb8-580" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb8-581"><a href="#cb8-581" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb8-582"><a href="#cb8-582" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb8-583"><a href="#cb8-583" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb8-584"><a href="#cb8-584" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb8-585"><a href="#cb8-585" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb8-586"><a href="#cb8-586" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb8-587"><a href="#cb8-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-588"><a href="#cb8-588" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_basic_html(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-589"><a href="#cb8-589" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;HTML b√°sico de √∫ltimo recurso com MathJax&quot;&quot;&quot;</span></span>
<span id="cb8-590"><a href="#cb8-590" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb8-591"><a href="#cb8-591" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-592"><a href="#cb8-592" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb8-593"><a href="#cb8-593" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html&gt;</span></span>
<span id="cb8-594"><a href="#cb8-594" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb8-595"><a href="#cb8-595" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb8-596"><a href="#cb8-596" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb8-597"><a href="#cb8-597" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb8-598"><a href="#cb8-598" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-599"><a href="#cb8-599" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif; </span></span>
<span id="cb8-600"><a href="#cb8-600" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px; </span></span>
<span id="cb8-601"><a href="#cb8-601" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb8-602"><a href="#cb8-602" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb8-603"><a href="#cb8-603" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-604"><a href="#cb8-604" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-605"><a href="#cb8-605" aria-hidden="true" tabindex="-1"></a><span class="ss">            white-space: pre-wrap; </span></span>
<span id="cb8-606"><a href="#cb8-606" aria-hidden="true" tabindex="-1"></a><span class="ss">            word-wrap: break-word; </span></span>
<span id="cb8-607"><a href="#cb8-607" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb8-608"><a href="#cb8-608" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb8-609"><a href="#cb8-609" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 5px;</span></span>
<span id="cb8-610"><a href="#cb8-610" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb8-611"><a href="#cb8-611" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-612"><a href="#cb8-612" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb8-613"><a href="#cb8-613" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 800px;</span></span>
<span id="cb8-614"><a href="#cb8-614" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb8-615"><a href="#cb8-615" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb8-616"><a href="#cb8-616" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 30px;</span></span>
<span id="cb8-617"><a href="#cb8-617" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb8-618"><a href="#cb8-618" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb8-619"><a href="#cb8-619" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-620"><a href="#cb8-620" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb8-621"><a href="#cb8-621" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb8-622"><a href="#cb8-622" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb8-623"><a href="#cb8-623" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb8-624"><a href="#cb8-624" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb8-625"><a href="#cb8-625" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb8-626"><a href="#cb8-626" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true</span></span>
<span id="cb8-627"><a href="#cb8-627" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb8-628"><a href="#cb8-628" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb8-629"><a href="#cb8-629" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb8-630"><a href="#cb8-630" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb8-631"><a href="#cb8-631" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb8-632"><a href="#cb8-632" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb8-633"><a href="#cb8-633" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb8-634"><a href="#cb8-634" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;pre&gt;</span><span class="sc">{</span>content<span class="sc">}</span><span class="ss">&lt;/pre&gt;</span></span>
<span id="cb8-635"><a href="#cb8-635" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb8-636"><a href="#cb8-636" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb8-637"><a href="#cb8-637" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb8-638"><a href="#cb8-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-639"><a href="#cb8-639" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_html_robust(<span class="va">self</span>):</span>
<span id="cb8-640"><a href="#cb8-640" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;M√©todo ROBUSTO para convers√£o HTML - VERS√ÉO OTIMIZADA&quot;&quot;&quot;</span></span>
<span id="cb8-641"><a href="#cb8-641" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-642"><a href="#cb8-642" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] HTMLs seriam criados:&quot;</span>)</span>
<span id="cb8-643"><a href="#cb8-643" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-644"><a href="#cb8-644" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb8-645"><a href="#cb8-645" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.html&quot;</span></span>
<span id="cb8-646"><a href="#cb8-646" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üåê </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-647"><a href="#cb8-647" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-648"><a href="#cb8-648" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-649"><a href="#cb8-649" aria-hidden="true" tabindex="-1"></a>        markdown_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;markdown&#39;</span>])</span>
<span id="cb8-650"><a href="#cb8-650" aria-hidden="true" tabindex="-1"></a>        html_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;html&#39;</span>])</span>
<span id="cb8-651"><a href="#cb8-651" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-652"><a href="#cb8-652" aria-hidden="true" tabindex="-1"></a>        md_files <span class="op">=</span> <span class="bu">list</span>(markdown_folder.glob(<span class="st">&quot;*.md&quot;</span>))</span>
<span id="cb8-653"><a href="#cb8-653" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-654"><a href="#cb8-654" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> md_files:</span>
<span id="cb8-655"><a href="#cb8-655" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Nenhum arquivo Markdown encontrado para convers√£o.&quot;</span>)</span>
<span id="cb8-656"><a href="#cb8-656" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-657"><a href="#cb8-657" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-658"><a href="#cb8-658" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÑ Convertendo </span><span class="sc">{</span><span class="bu">len</span>(md_files)<span class="sc">}</span><span class="ss"> arquivos Markdown para HTML (OTIMIZADO)...&quot;</span>)</span>
<span id="cb8-659"><a href="#cb8-659" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-660"><a href="#cb8-660" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verifica se Pandoc est√° dispon√≠vel</span></span>
<span id="cb8-661"><a href="#cb8-661" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-662"><a href="#cb8-662" aria-hidden="true" tabindex="-1"></a>            subprocess.run([<span class="st">&#39;pandoc&#39;</span>, <span class="st">&#39;--version&#39;</span>], capture_output<span class="op">=</span><span class="va">True</span>, check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-663"><a href="#cb8-663" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">True</span></span>
<span id="cb8-664"><a href="#cb8-664" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;‚úÖ Pandoc dispon√≠vel - usando convers√£o otimizada&quot;</span>)</span>
<span id="cb8-665"><a href="#cb8-665" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb8-666"><a href="#cb8-666" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">False</span></span>
<span id="cb8-667"><a href="#cb8-667" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è Pandoc n√£o dispon√≠vel - usando fallback Python&quot;</span>)</span>
<span id="cb8-668"><a href="#cb8-668" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-669"><a href="#cb8-669" aria-hidden="true" tabindex="-1"></a>        converted_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-670"><a href="#cb8-670" aria-hidden="true" tabindex="-1"></a>        failed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-671"><a href="#cb8-671" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-672"><a href="#cb8-672" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> md_file <span class="kw">in</span> md_files:</span>
<span id="cb8-673"><a href="#cb8-673" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb8-674"><a href="#cb8-674" aria-hidden="true" tabindex="-1"></a>                html_file <span class="op">=</span> html_folder <span class="op">/</span> md_file.with_suffix(<span class="st">&#39;.html&#39;</span>).name</span>
<span id="cb8-675"><a href="#cb8-675" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-676"><a href="#cb8-676" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> html_file.exists():</span>
<span id="cb8-677"><a href="#cb8-677" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚è≠Ô∏è  J√° existe: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-678"><a href="#cb8-678" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-679"><a href="#cb8-679" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb8-680"><a href="#cb8-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-681"><a href="#cb8-681" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ Processando: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-682"><a href="#cb8-682" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-683"><a href="#cb8-683" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> pandoc_available:</span>
<span id="cb8-684"><a href="#cb8-684" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_pandoc_optimized(<span class="bu">str</span>(md_file))</span>
<span id="cb8-685"><a href="#cb8-685" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb8-686"><a href="#cb8-686" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_fallback(<span class="bu">str</span>(md_file))</span>
<span id="cb8-687"><a href="#cb8-687" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-688"><a href="#cb8-688" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> html_content:</span>
<span id="cb8-689"><a href="#cb8-689" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(html_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-690"><a href="#cb8-690" aria-hidden="true" tabindex="-1"></a>                        f.write(html_content)</span>
<span id="cb8-691"><a href="#cb8-691" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-692"><a href="#cb8-692" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Criado: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-693"><a href="#cb8-693" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-694"><a href="#cb8-694" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb8-695"><a href="#cb8-695" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Falha na convers√£o: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-696"><a href="#cb8-696" aria-hidden="true" tabindex="-1"></a>                    failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-697"><a href="#cb8-697" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-698"><a href="#cb8-698" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-699"><a href="#cb8-699" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro em </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-700"><a href="#cb8-700" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(traceback.format_exc())</span>
<span id="cb8-701"><a href="#cb8-701" aria-hidden="true" tabindex="-1"></a>                failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-702"><a href="#cb8-702" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-703"><a href="#cb8-703" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä HTML: </span><span class="sc">{</span>converted_count<span class="sc">}</span><span class="ss"> arquivos criados, </span><span class="sc">{</span>failed_count<span class="sc">}</span><span class="ss"> falhas em &#39;</span><span class="sc">{</span>html_folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb8-704"><a href="#cb8-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-705"><a href="#cb8-705" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> categorize_conversation(<span class="va">self</span>, title: <span class="bu">str</span>, summary: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-706"><a href="#cb8-706" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Categoriza√ß√£o otimizada com express√µes regulares&quot;&quot;&quot;</span></span>
<span id="cb8-707"><a href="#cb8-707" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&quot;</span>.lower()</span>
<span id="cb8-708"><a href="#cb8-708" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-709"><a href="#cb8-709" aria-hidden="true" tabindex="-1"></a>        patterns <span class="op">=</span> {</span>
<span id="cb8-710"><a href="#cb8-710" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Tecnologia&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">tecnologia</span><span class="cf">|</span><span class="vs">hardware</span><span class="cf">|</span><span class="vs">software</span><span class="cf">|</span><span class="vs">rede</span><span class="cf">|</span><span class="vs">internet</span><span class="cf">|</span><span class="vs">wifi</span><span class="cf">|</span><span class="vs">bluetooth</span><span class="cf">|</span><span class="pp">[45]</span><span class="vs">g</span><span class="cf">|</span><span class="vs">cloud</span><span class="cf">|</span><span class="vs">aws</span><span class="cf">|</span><span class="vs">azure</span><span class="cf">|</span><span class="vs">gcp</span><span class="cf">|</span><span class="vs">servidor</span><span class="cf">|</span><span class="vs">hosting</span><span class="cf">|</span><span class="vs">dom√≠nio</span><span class="cf">|</span><span class="vs">ssl</span><span class="cf">|</span><span class="vs">router</span><span class="cf">|</span><span class="vs">switch</span><span class="cf">|</span><span class="vs">firewall</span><span class="cf">|</span><span class="vs">iot</span><span class="cf">|</span><span class="vs">smartphone</span><span class="cf">|</span><span class="vs">tablet</span><span class="cf">|</span><span class="vs">navegador</span><span class="cf">|</span><span class="vs">browser</span><span class="cf">|</span><span class="vs">chrome</span><span class="cf">|</span><span class="vs">firefox</span><span class="cf">|</span><span class="vs">edge</span><span class="cf">|</span><span class="vs">safari</span><span class="cf">|</span><span class="vs">email</span><span class="cf">|</span><span class="vs">gmail</span><span class="cf">|</span><span class="vs">outlook</span><span class="cf">|</span><span class="vs">criptografia</span><span class="cf">|</span><span class="vs">seguran√ßa</span><span class="cf">|</span><span class="vs">ciberseguran√ßa</span><span class="cf">|</span><span class="vs">ransomware</span><span class="cf">|</span><span class="vs">phishing</span><span class="cf">|</span><span class="vs">autentica√ß√£o</span><span class="cf">|</span><span class="vs">2fa</span><span class="cf">|</span><span class="vs">biometria</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb8-711"><a href="#cb8-711" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Sa√∫de&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">sa√∫de</span><span class="cf">|</span><span class="vs">medicina</span><span class="cf">|</span><span class="vs">m√©dico</span><span class="cf">|</span><span class="vs">enfermagem</span><span class="cf">|</span><span class="vs">doen√ßa</span><span class="cf">|</span><span class="vs">v√≠rus</span><span class="cf">|</span><span class="vs">bact√©ria</span><span class="cf">|</span><span class="vs">vacina</span><span class="cf">|</span><span class="vs">covid</span><span class="cf">|</span><span class="vs">coronav√≠rus</span><span class="cf">|</span><span class="vs">gripe</span><span class="cf">|</span><span class="vs">febre</span><span class="cf">|</span><span class="vs">dor</span><span class="cf">|</span><span class="vs">an√°lise</span><span class="cf">|</span><span class="vs">exame</span><span class="cf">|</span><span class="vs">raio x</span><span class="cf">|</span><span class="vs">resson√¢ncia</span><span class="cf">|</span><span class="vs">hospital</span><span class="cf">|</span><span class="vs">cl√≠nica</span><span class="cf">|</span><span class="vs">farm√°cia</span><span class="cf">|</span><span class="vs">medicamento</span><span class="cf">|</span><span class="vs">rem√©dio</span><span class="cf">|</span><span class="vs">psicologia</span><span class="cf">|</span><span class="vs">terapia</span><span class="cf">|</span><span class="vs">bem-estar</span><span class="cf">|</span><span class="vs">nutri√ß√£o</span><span class="cf">|</span><span class="vs">dieta</span><span class="cf">|</span><span class="vs">exerc√≠cio</span><span class="cf">|</span><span class="vs">fitness</span><span class="cf">|</span><span class="vs">sono</span><span class="cf">|</span><span class="vs">sa√∫de mental</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb8-712"><a href="#cb8-712" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Programa√ß√£o&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">python</span><span class="cf">|</span><span class="vs">javascript</span><span class="cf">|</span><span class="vs">java</span><span class="cf">|</span><span class="vs">c</span><span class="ch">\+\+</span><span class="cf">|</span><span class="vs">c#</span><span class="cf">|</span><span class="vs">go</span><span class="cf">|</span><span class="vs">rust</span><span class="cf">|</span><span class="vs">lua</span><span class="cf">|</span><span class="vs">bash</span><span class="cf">|</span><span class="vs">script</span><span class="cf">|</span><span class="vs">debug</span><span class="cf">|</span><span class="vs">erro</span><span class="cf">|</span><span class="vs">conda</span><span class="cf">|</span><span class="vs">mamba</span><span class="cf">|</span><span class="vs">pandoc</span><span class="cf">|</span><span class="vs">msys2</span><span class="cf">|</span><span class="vs">spyder</span><span class="cf">|</span><span class="vs">jupyter</span><span class="cf">|</span><span class="vs">pip</span><span class="cf">|</span><span class="vs">venv</span><span class="cf">|</span><span class="vs">docker</span><span class="cf">|</span><span class="vs">git</span><span class="cf">|</span><span class="vs">github</span><span class="cf">|</span><span class="vs">vscode</span><span class="cf">|</span><span class="vs">ide</span><span class="cf">|</span><span class="vs">programa</span><span class="cf">|</span><span class="vs">c√≥digo</span><span class="cf">|</span><span class="vs">fun√ß√£o</span><span class="cf">|</span><span class="vs">classe</span><span class="cf">|</span><span class="vs">api</span><span class="cf">|</span><span class="vs">selenium</span><span class="cf">|</span><span class="vs">playwright</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb8-713"><a href="#cb8-713" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Sistemas&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">windows</span><span class="cf">|</span><span class="vs">linux</span><span class="cf">|</span><span class="vs">macos</span><span class="cf">|</span><span class="vs">so</span><span class="cf">|</span><span class="vs">sistema operacional</span><span class="cf">|</span><span class="vs">driver</span><span class="cf">|</span><span class="vs">registry</span><span class="cf">|</span><span class="vs">process</span><span class="cf">|</span><span class="vs">firewall</span><span class="cf">|</span><span class="vs">bios</span><span class="cf">|</span><span class="vs">boot</span><span class="cf">|</span><span class="vs">path</span><span class="cf">|</span><span class="vs">dll</span><span class="cf">|</span><span class="vs">exe</span><span class="cf">|</span><span class="vs">powershell</span><span class="cf">|</span><span class="vs">cmd</span><span class="cf">|</span><span class="vs">terminal</span><span class="cf">|</span><span class="vs">shell</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb8-714"><a href="#cb8-714" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;IA&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">ia</span><span class="cf">|</span><span class="vs">gpt</span><span class="cf">|</span><span class="vs">chatgpt</span><span class="cf">|</span><span class="vs">grok</span><span class="cf">|</span><span class="vs">qwen</span><span class="cf">|</span><span class="vs">deepseek</span><span class="cf">|</span><span class="vs">llm</span><span class="cf">|</span><span class="vs">modelo</span><span class="cf">|</span><span class="vs">prompt</span><span class="cf">|</span><span class="vs">token</span><span class="cf">|</span><span class="vs">embedding</span><span class="cf">|</span><span class="vs">fine-tune</span><span class="cf">|</span><span class="vs">neural</span><span class="cf">|</span><span class="vs">chatbot</span><span class="cf">|</span><span class="vs">intelig√™ncia artificial</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb8-715"><a href="#cb8-715" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Dados&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">dados</span><span class="cf">|</span><span class="vs">data</span><span class="cf">|</span><span class="vs">csv</span><span class="cf">|</span><span class="vs">json</span><span class="cf">|</span><span class="vs">pandas</span><span class="cf">|</span><span class="vs">numpy</span><span class="cf">|</span><span class="vs">excel</span><span class="cf">|</span><span class="vs">sql</span><span class="cf">|</span><span class="vs">banco</span><span class="cf">|</span><span class="vs">sqlite</span><span class="cf">|</span><span class="vs">postgres</span><span class="cf">|</span><span class="vs">visualiza√ß√£o</span><span class="cf">|</span><span class="vs">gr√°fico</span><span class="cf">|</span><span class="vs">tabela</span><span class="cf">|</span><span class="vs">an√°lise</span><span class="cf">|</span><span class="vs">etl</span><span class="cf">|</span><span class="vs">dashboard</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb8-716"><a href="#cb8-716" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Geral&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">geral</span><span class="cf">|</span><span class="vs">pergunta</span><span class="cf">|</span><span class="vs">ajuda</span><span class="cf">|</span><span class="vs">como fazer</span><span class="cf">|</span><span class="vs">explicar</span><span class="cf">|</span><span class="vs">resumo</span><span class="cf">|</span><span class="vs">tutorial b√°sico</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span></span>
<span id="cb8-717"><a href="#cb8-717" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-718"><a href="#cb8-718" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-719"><a href="#cb8-719" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category, pattern <span class="kw">in</span> patterns.items():</span>
<span id="cb8-720"><a href="#cb8-720" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> re.search(pattern, text, re.IGNORECASE):</span>
<span id="cb8-721"><a href="#cb8-721" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> category</span>
<span id="cb8-722"><a href="#cb8-722" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-723"><a href="#cb8-723" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Outros&#39;</span></span>
<span id="cb8-724"><a href="#cb8-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-725"><a href="#cb8-725" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_timestamp_for_sorting(<span class="va">self</span>, timestamp) <span class="op">-&gt;</span> datetime:</span>
<span id="cb8-726"><a href="#cb8-726" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> timestamp:</span>
<span id="cb8-727"><a href="#cb8-727" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> datetime.<span class="bu">min</span></span>
<span id="cb8-728"><a href="#cb8-728" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-729"><a href="#cb8-729" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-730"><a href="#cb8-730" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(timestamp, <span class="bu">str</span>):</span>
<span id="cb8-731"><a href="#cb8-731" aria-hidden="true" tabindex="-1"></a>                clean_ts <span class="op">=</span> timestamp.replace(<span class="st">&#39;T&#39;</span>, <span class="st">&#39; &#39;</span>).split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>].split(<span class="st">&#39;+&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb8-732"><a href="#cb8-732" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> clean_ts.endswith(<span class="st">&#39;Z&#39;</span>):</span>
<span id="cb8-733"><a href="#cb8-733" aria-hidden="true" tabindex="-1"></a>                    clean_ts <span class="op">=</span> clean_ts[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb8-734"><a href="#cb8-734" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> datetime.fromisoformat(clean_ts)</span>
<span id="cb8-735"><a href="#cb8-735" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(timestamp, (<span class="bu">int</span>, <span class="bu">float</span>)):</span>
<span id="cb8-736"><a href="#cb8-736" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> datetime.fromtimestamp(timestamp)</span>
<span id="cb8-737"><a href="#cb8-737" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb8-738"><a href="#cb8-738" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb8-739"><a href="#cb8-739" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-740"><a href="#cb8-740" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> datetime.<span class="bu">min</span></span>
<span id="cb8-741"><a href="#cb8-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-742"><a href="#cb8-742" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> format_timestamp(<span class="va">self</span>, timestamp) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb8-743"><a href="#cb8-743" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> timestamp:</span>
<span id="cb8-744"><a href="#cb8-744" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb8-745"><a href="#cb8-745" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-746"><a href="#cb8-746" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-747"><a href="#cb8-747" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(timestamp, (<span class="bu">int</span>, <span class="bu">float</span>)):</span>
<span id="cb8-748"><a href="#cb8-748" aria-hidden="true" tabindex="-1"></a>                dt <span class="op">=</span> datetime.fromtimestamp(timestamp)</span>
<span id="cb8-749"><a href="#cb8-749" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> dt.strftime(<span class="st">&#39;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S&#39;</span>)</span>
<span id="cb8-750"><a href="#cb8-750" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(timestamp, <span class="bu">str</span>):</span>
<span id="cb8-751"><a href="#cb8-751" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">&#39;T&#39;</span> <span class="kw">in</span> timestamp:</span>
<span id="cb8-752"><a href="#cb8-752" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> timestamp.replace(<span class="st">&#39;T&#39;</span>, <span class="st">&#39; &#39;</span>).split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb8-753"><a href="#cb8-753" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> timestamp</span>
<span id="cb8-754"><a href="#cb8-754" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb8-755"><a href="#cb8-755" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb8-756"><a href="#cb8-756" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-757"><a href="#cb8-757" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">str</span>(timestamp)</span>
<span id="cb8-758"><a href="#cb8-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-759"><a href="#cb8-759" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_enhanced_markdown_content(<span class="va">self</span>, conversation: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-760"><a href="#cb8-760" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Gera conte√∫do Markdown com preserva√ß√£o total de formata√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb8-761"><a href="#cb8-761" aria-hidden="true" tabindex="-1"></a>        lines <span class="op">=</span> [</span>
<span id="cb8-762"><a href="#cb8-762" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;# </span><span class="sc">{</span>conversation[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-763"><a href="#cb8-763" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb8-764"><a href="#cb8-764" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;## üìä Informa√ß√µes&quot;</span>,</span>
<span id="cb8-765"><a href="#cb8-765" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **N√∫mero:** #</span><span class="sc">{</span>conversation[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-766"><a href="#cb8-766" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Origem:** </span><span class="sc">{</span>conversation[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-767"><a href="#cb8-767" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Categoria:** </span><span class="sc">{</span>conversation[<span class="st">&#39;category&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-768"><a href="#cb8-768" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **ID:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;id&#39;</span>, <span class="st">&#39;N/A&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-769"><a href="#cb8-769" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Criada em:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> conversation<span class="sc">.</span>get(<span class="st">&#39;created_at&#39;</span>) <span class="kw">or</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-770"><a href="#cb8-770" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb8-771"><a href="#cb8-771" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-772"><a href="#cb8-772" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> conversation.get(<span class="st">&#39;updated_at&#39;</span>):</span>
<span id="cb8-773"><a href="#cb8-773" aria-hidden="true" tabindex="-1"></a>            lines.append(<span class="ss">f&quot;- **Atualizada em:** </span><span class="sc">{</span>conversation[<span class="st">&#39;updated_at&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-774"><a href="#cb8-774" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-775"><a href="#cb8-775" aria-hidden="true" tabindex="-1"></a>        lines.extend([</span>
<span id="cb8-776"><a href="#cb8-776" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Total de mensagens:** </span><span class="sc">{</span><span class="bu">len</span>(conversation[<span class="st">&#39;messages&#39;</span>])<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-777"><a href="#cb8-777" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Resumo:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;Sem resumo&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-778"><a href="#cb8-778" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb8-779"><a href="#cb8-779" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;---&quot;</span>,</span>
<span id="cb8-780"><a href="#cb8-780" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb8-781"><a href="#cb8-781" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;## üí¨ Conversa&quot;</span>,</span>
<span id="cb8-782"><a href="#cb8-782" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span></span>
<span id="cb8-783"><a href="#cb8-783" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb8-784"><a href="#cb8-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-785"><a href="#cb8-785" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, msg <span class="kw">in</span> <span class="bu">enumerate</span>(conversation[<span class="st">&#39;messages&#39;</span>], <span class="dv">1</span>):</span>
<span id="cb8-786"><a href="#cb8-786" aria-hidden="true" tabindex="-1"></a>            timestamp <span class="op">=</span> <span class="ss">f&quot; *(</span><span class="sc">{</span>msg[<span class="st">&#39;timestamp&#39;</span>]<span class="sc">}</span><span class="ss">)*&quot;</span> <span class="cf">if</span> msg[<span class="st">&#39;timestamp&#39;</span>] <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb8-787"><a href="#cb8-787" aria-hidden="true" tabindex="-1"></a>            model_info <span class="op">=</span> <span class="ss">f&quot; *[</span><span class="sc">{</span>msg<span class="sc">.</span>get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;&#39;</span>)<span class="sc">}</span><span class="ss">]*&quot;</span> <span class="cf">if</span> msg.get(<span class="st">&#39;model&#39;</span>) <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb8-788"><a href="#cb8-788" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-789"><a href="#cb8-789" aria-hidden="true" tabindex="-1"></a>            preserved_content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(msg[<span class="st">&#39;content&#39;</span>])</span>
<span id="cb8-790"><a href="#cb8-790" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-791"><a href="#cb8-791" aria-hidden="true" tabindex="-1"></a>            lines.extend([</span>
<span id="cb8-792"><a href="#cb8-792" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;### </span><span class="sc">{</span>msg[<span class="st">&#39;author&#39;</span>]<span class="sc">}{</span>timestamp<span class="sc">}{</span>model_info<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-793"><a href="#cb8-793" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;&quot;</span>,</span>
<span id="cb8-794"><a href="#cb8-794" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;</span><span class="sc">{</span>preserved_content<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-795"><a href="#cb8-795" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;&quot;</span></span>
<span id="cb8-796"><a href="#cb8-796" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb8-797"><a href="#cb8-797" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-798"><a href="#cb8-798" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> j <span class="op">&lt;</span> <span class="bu">len</span>(conversation[<span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb8-799"><a href="#cb8-799" aria-hidden="true" tabindex="-1"></a>                lines.extend([<span class="st">&quot;---&quot;</span>, <span class="st">&quot;&quot;</span>])</span>
<span id="cb8-800"><a href="#cb8-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-801"><a href="#cb8-801" aria-hidden="true" tabindex="-1"></a>        lines.extend([</span>
<span id="cb8-802"><a href="#cb8-802" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;---&quot;</span>,</span>
<span id="cb8-803"><a href="#cb8-803" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb8-804"><a href="#cb8-804" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;*Conversa exportada do </span><span class="sc">{</span>conversation[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">*&quot;</span>,</span>
<span id="cb8-805"><a href="#cb8-805" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;*Processado em: </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">.</span>strftime(<span class="st">&#39;</span><span class="sc">%d</span><span class="st">/%m/%Y %H:%M&#39;</span>)<span class="sc">}</span><span class="ss">*&quot;</span></span>
<span id="cb8-806"><a href="#cb8-806" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb8-807"><a href="#cb8-807" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-808"><a href="#cb8-808" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(lines)</span>
<span id="cb8-809"><a href="#cb8-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-810"><a href="#cb8-810" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_qwen_enhanced(<span class="va">self</span>, path: Path):</span>
<span id="cb8-811"><a href="#cb8-811" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa Qwen3 com preserva√ß√£o total de conte√∫do&quot;&quot;&quot;</span></span>
<span id="cb8-812"><a href="#cb8-812" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-813"><a href="#cb8-813" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria Qwen3: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-814"><a href="#cb8-814" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-815"><a href="#cb8-815" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-816"><a href="#cb8-816" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-817"><a href="#cb8-817" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-818"><a href="#cb8-818" aria-hidden="true" tabindex="-1"></a>                raw <span class="op">=</span> json.load(f)</span>
<span id="cb8-819"><a href="#cb8-819" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-820"><a href="#cb8-820" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> raw.get(<span class="st">&#39;data&#39;</span>, [])</span>
<span id="cb8-821"><a href="#cb8-821" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">list</span>):</span>
<span id="cb8-822"><a href="#cb8-822" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  Qwen3: &#39;data&#39; n√£o √© uma lista.&quot;</span>)</span>
<span id="cb8-823"><a href="#cb8-823" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-824"><a href="#cb8-824" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-825"><a href="#cb8-825" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Qwen3: encontradas </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb8-826"><a href="#cb8-826" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-827"><a href="#cb8-827" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-828"><a href="#cb8-828" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb8-829"><a href="#cb8-829" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa Qwen </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb8-830"><a href="#cb8-830" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb8-831"><a href="#cb8-831" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb8-832"><a href="#cb8-832" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-833"><a href="#cb8-833" aria-hidden="true" tabindex="-1"></a>                history <span class="op">=</span> conv.get(<span class="st">&#39;chat&#39;</span>, {}).get(<span class="st">&#39;history&#39;</span>, {})</span>
<span id="cb8-834"><a href="#cb8-834" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb8-835"><a href="#cb8-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-836"><a href="#cb8-836" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> history:</span>
<span id="cb8-837"><a href="#cb8-837" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb8-838"><a href="#cb8-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-839"><a href="#cb8-839" aria-hidden="true" tabindex="-1"></a>                messages_dict <span class="op">=</span> history.get(<span class="st">&#39;messages&#39;</span>, {})</span>
<span id="cb8-840"><a href="#cb8-840" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-841"><a href="#cb8-841" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(messages_dict, <span class="bu">dict</span>):</span>
<span id="cb8-842"><a href="#cb8-842" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb8-843"><a href="#cb8-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-844"><a href="#cb8-844" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìù Conversa </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: &#39;</span><span class="sc">{</span>clean_title<span class="sc">}</span><span class="ss">&#39; - </span><span class="sc">{</span><span class="bu">len</span>(messages_dict)<span class="sc">}</span><span class="ss"> mensagens&quot;</span>)</span>
<span id="cb8-845"><a href="#cb8-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-846"><a href="#cb8-846" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> message_id, message_data <span class="kw">in</span> messages_dict.items():</span>
<span id="cb8-847"><a href="#cb8-847" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(message_data, <span class="bu">dict</span>):</span>
<span id="cb8-848"><a href="#cb8-848" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-849"><a href="#cb8-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-850"><a href="#cb8-850" aria-hidden="true" tabindex="-1"></a>                    role <span class="op">=</span> message_data.get(<span class="st">&#39;role&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb8-851"><a href="#cb8-851" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> message_data.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb8-852"><a href="#cb8-852" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-853"><a href="#cb8-853" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content <span class="kw">or</span> <span class="kw">not</span> role:</span>
<span id="cb8-854"><a href="#cb8-854" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-855"><a href="#cb8-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-856"><a href="#cb8-856" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> role <span class="op">==</span> <span class="st">&#39;user&#39;</span>:</span>
<span id="cb8-857"><a href="#cb8-857" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb8-858"><a href="#cb8-858" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> role <span class="op">==</span> <span class="st">&#39;assistant&#39;</span>:</span>
<span id="cb8-859"><a href="#cb8-859" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ Qwen3&quot;</span></span>
<span id="cb8-860"><a href="#cb8-860" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb8-861"><a href="#cb8-861" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-862"><a href="#cb8-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-863"><a href="#cb8-863" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(content, <span class="bu">list</span>):</span>
<span id="cb8-864"><a href="#cb8-864" aria-hidden="true" tabindex="-1"></a>                        text_parts <span class="op">=</span> []</span>
<span id="cb8-865"><a href="#cb8-865" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">for</span> block <span class="kw">in</span> content:</span>
<span id="cb8-866"><a href="#cb8-866" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> <span class="bu">isinstance</span>(block, <span class="bu">dict</span>):</span>
<span id="cb8-867"><a href="#cb8-867" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> block.get(<span class="st">&#39;type&#39;</span>) <span class="op">==</span> <span class="st">&#39;text&#39;</span>:</span>
<span id="cb8-868"><a href="#cb8-868" aria-hidden="true" tabindex="-1"></a>                                    text_parts.append(block.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>))</span>
<span id="cb8-869"><a href="#cb8-869" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">elif</span> block.get(<span class="st">&#39;type&#39;</span>) <span class="op">==</span> <span class="st">&#39;image&#39;</span>:</span>
<span id="cb8-870"><a href="#cb8-870" aria-hidden="true" tabindex="-1"></a>                                    image_info <span class="op">=</span> block.get(<span class="st">&#39;image&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb8-871"><a href="#cb8-871" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">if</span> image_info:</span>
<span id="cb8-872"><a href="#cb8-872" aria-hidden="true" tabindex="-1"></a>                                        text_parts.append(<span class="ss">f&quot;![Imagem](</span><span class="sc">{</span>image_info<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb8-873"><a href="#cb8-873" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">elif</span> <span class="bu">isinstance</span>(block, <span class="bu">str</span>):</span>
<span id="cb8-874"><a href="#cb8-874" aria-hidden="true" tabindex="-1"></a>                                text_parts.append(block)</span>
<span id="cb8-875"><a href="#cb8-875" aria-hidden="true" tabindex="-1"></a>                        final_content <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(text_parts).strip()</span>
<span id="cb8-876"><a href="#cb8-876" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb8-877"><a href="#cb8-877" aria-hidden="true" tabindex="-1"></a>                        final_content <span class="op">=</span> <span class="bu">str</span>(content).strip()</span>
<span id="cb8-878"><a href="#cb8-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-879"><a href="#cb8-879" aria-hidden="true" tabindex="-1"></a>                    final_content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(final_content)</span>
<span id="cb8-880"><a href="#cb8-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-881"><a href="#cb8-881" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> final_content <span class="kw">or</span> final_content <span class="op">==</span> <span class="st">&#39;null&#39;</span>:</span>
<span id="cb8-882"><a href="#cb8-882" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-883"><a href="#cb8-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-884"><a href="#cb8-884" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb8-885"><a href="#cb8-885" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb8-886"><a href="#cb8-886" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb8-887"><a href="#cb8-887" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: final_content,</span>
<span id="cb8-888"><a href="#cb8-888" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(message_data.get(<span class="st">&#39;created_at&#39;</span>)),</span>
<span id="cb8-889"><a href="#cb8-889" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: message_data.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;Qwen3&#39;</span>)</span>
<span id="cb8-890"><a href="#cb8-890" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-891"><a href="#cb8-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-892"><a href="#cb8-892" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb8-893"><a href="#cb8-893" aria-hidden="true" tabindex="-1"></a>                    messages.sort(key<span class="op">=</span><span class="kw">lambda</span> x: <span class="va">self</span>.parse_timestamp_for_sorting(x[<span class="st">&#39;timestamp&#39;</span>]))</span>
<span id="cb8-894"><a href="#cb8-894" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-895"><a href="#cb8-895" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb8-896"><a href="#cb8-896" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb8-897"><a href="#cb8-897" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;Qwen3&#39;</span>,</span>
<span id="cb8-898"><a href="#cb8-898" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;qwen_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb8-899"><a href="#cb8-899" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;created_at&#39;</span>)),</span>
<span id="cb8-900"><a href="#cb8-900" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;updated_at&#39;</span>)),</span>
<span id="cb8-901"><a href="#cb8-901" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb8-902"><a href="#cb8-902" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb8-903"><a href="#cb8-903" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb8-904"><a href="#cb8-904" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-905"><a href="#cb8-905" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-906"><a href="#cb8-906" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;   ‚úÖ Adicionada: </span><span class="sc">{</span><span class="bu">len</span>(messages)<span class="sc">}</span><span class="ss"> mensagens&quot;</span>)</span>
<span id="cb8-907"><a href="#cb8-907" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-908"><a href="#cb8-908" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Qwen3: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb8-909"><a href="#cb8-909" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-910"><a href="#cb8-910" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-911"><a href="#cb8-911" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar Qwen3: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-912"><a href="#cb8-912" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-913"><a href="#cb8-913" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb8-914"><a href="#cb8-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-915"><a href="#cb8-915" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_chatgpt(<span class="va">self</span>, path: Path):</span>
<span id="cb8-916"><a href="#cb8-916" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do ChatGPT&quot;&quot;&quot;</span></span>
<span id="cb8-917"><a href="#cb8-917" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-918"><a href="#cb8-918" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria ChatGPT: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-919"><a href="#cb8-919" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-920"><a href="#cb8-920" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-921"><a href="#cb8-921" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-922"><a href="#cb8-922" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;chatgpt_&quot;</span>)</span>
<span id="cb8-923"><a href="#cb8-923" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb8-924"><a href="#cb8-924" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb8-925"><a href="#cb8-925" aria-hidden="true" tabindex="-1"></a>            convs_path <span class="op">=</span> Path(temp_dir) <span class="op">/</span> <span class="st">&quot;conversations.json&quot;</span></span>
<span id="cb8-926"><a href="#cb8-926" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> convs_path.exists():</span>
<span id="cb8-927"><a href="#cb8-927" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå ChatGPT: conversations.json n√£o encontrado.&quot;</span>)</span>
<span id="cb8-928"><a href="#cb8-928" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-929"><a href="#cb8-929" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-930"><a href="#cb8-930" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(convs_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-931"><a href="#cb8-931" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.load(f)</span>
<span id="cb8-932"><a href="#cb8-932" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-933"><a href="#cb8-933" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">list</span>):</span>
<span id="cb8-934"><a href="#cb8-934" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  ChatGPT: estrutura inesperada.&quot;</span>)</span>
<span id="cb8-935"><a href="#cb8-935" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-936"><a href="#cb8-936" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-937"><a href="#cb8-937" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç ChatGPT: encontradas </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb8-938"><a href="#cb8-938" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-939"><a href="#cb8-939" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-940"><a href="#cb8-940" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb8-941"><a href="#cb8-941" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa ChatGPT </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb8-942"><a href="#cb8-942" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb8-943"><a href="#cb8-943" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb8-944"><a href="#cb8-944" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-945"><a href="#cb8-945" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb8-946"><a href="#cb8-946" aria-hidden="true" tabindex="-1"></a>                mapping <span class="op">=</span> conv.get(<span class="st">&#39;mapping&#39;</span>, {})</span>
<span id="cb8-947"><a href="#cb8-947" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-948"><a href="#cb8-948" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> msg_id, node <span class="kw">in</span> mapping.items():</span>
<span id="cb8-949"><a href="#cb8-949" aria-hidden="true" tabindex="-1"></a>                    msg_data <span class="op">=</span> node.get(<span class="st">&#39;message&#39;</span>)</span>
<span id="cb8-950"><a href="#cb8-950" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> msg_data <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(msg_data, <span class="bu">dict</span>):</span>
<span id="cb8-951"><a href="#cb8-951" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-952"><a href="#cb8-952" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb8-953"><a href="#cb8-953" aria-hidden="true" tabindex="-1"></a>                    author_role <span class="op">=</span> msg_data.get(<span class="st">&#39;author&#39;</span>, {}).get(<span class="st">&#39;role&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb8-954"><a href="#cb8-954" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> author_role <span class="op">==</span> <span class="st">&#39;user&#39;</span>:</span>
<span id="cb8-955"><a href="#cb8-955" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb8-956"><a href="#cb8-956" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;user&#39;</span></span>
<span id="cb8-957"><a href="#cb8-957" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> author_role <span class="op">==</span> <span class="st">&#39;assistant&#39;</span>:</span>
<span id="cb8-958"><a href="#cb8-958" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ ChatGPT&quot;</span></span>
<span id="cb8-959"><a href="#cb8-959" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;assistant&#39;</span></span>
<span id="cb8-960"><a href="#cb8-960" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb8-961"><a href="#cb8-961" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-962"><a href="#cb8-962" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb8-963"><a href="#cb8-963" aria-hidden="true" tabindex="-1"></a>                    content_parts <span class="op">=</span> []</span>
<span id="cb8-964"><a href="#cb8-964" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> part <span class="kw">in</span> msg_data.get(<span class="st">&#39;content&#39;</span>, {}).get(<span class="st">&#39;parts&#39;</span>, []):</span>
<span id="cb8-965"><a href="#cb8-965" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(part, <span class="bu">str</span>):</span>
<span id="cb8-966"><a href="#cb8-966" aria-hidden="true" tabindex="-1"></a>                            content_parts.append(part)</span>
<span id="cb8-967"><a href="#cb8-967" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(content_parts).strip()</span>
<span id="cb8-968"><a href="#cb8-968" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-969"><a href="#cb8-969" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb8-970"><a href="#cb8-970" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-971"><a href="#cb8-971" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb8-972"><a href="#cb8-972" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-973"><a href="#cb8-973" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb8-974"><a href="#cb8-974" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb8-975"><a href="#cb8-975" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb8-976"><a href="#cb8-976" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb8-977"><a href="#cb8-977" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb8-978"><a href="#cb8-978" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(msg_data.get(<span class="st">&#39;create_time&#39;</span>)),</span>
<span id="cb8-979"><a href="#cb8-979" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg_data.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;ChatGPT&#39;</span>)</span>
<span id="cb8-980"><a href="#cb8-980" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-981"><a href="#cb8-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-982"><a href="#cb8-982" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb8-983"><a href="#cb8-983" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb8-984"><a href="#cb8-984" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb8-985"><a href="#cb8-985" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;ChatGPT&#39;</span>,</span>
<span id="cb8-986"><a href="#cb8-986" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;chatgpt_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb8-987"><a href="#cb8-987" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;create_time&#39;</span>)),</span>
<span id="cb8-988"><a href="#cb8-988" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;update_time&#39;</span>)),</span>
<span id="cb8-989"><a href="#cb8-989" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb8-990"><a href="#cb8-990" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb8-991"><a href="#cb8-991" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb8-992"><a href="#cb8-992" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-993"><a href="#cb8-993" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-994"><a href="#cb8-994" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-995"><a href="#cb8-995" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ ChatGPT: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb8-996"><a href="#cb8-996" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-997"><a href="#cb8-997" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-998"><a href="#cb8-998" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar ChatGPT: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-999"><a href="#cb8-999" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1000"><a href="#cb8-1000" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb8-1001"><a href="#cb8-1001" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb8-1002"><a href="#cb8-1002" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb8-1003"><a href="#cb8-1003" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-1004"><a href="#cb8-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1005"><a href="#cb8-1005" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_deepseek(<span class="va">self</span>, path: Path):</span>
<span id="cb8-1006"><a href="#cb8-1006" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do DeepSeek&quot;&quot;&quot;</span></span>
<span id="cb8-1007"><a href="#cb8-1007" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1008"><a href="#cb8-1008" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria DeepSeek: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1009"><a href="#cb8-1009" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1010"><a href="#cb8-1010" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1011"><a href="#cb8-1011" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-1012"><a href="#cb8-1012" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;deepseek_&quot;</span>)</span>
<span id="cb8-1013"><a href="#cb8-1013" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb8-1014"><a href="#cb8-1014" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb8-1015"><a href="#cb8-1015" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1016"><a href="#cb8-1016" aria-hidden="true" tabindex="-1"></a>            convs_path <span class="op">=</span> Path(temp_dir) <span class="op">/</span> <span class="st">&quot;conversations.json&quot;</span></span>
<span id="cb8-1017"><a href="#cb8-1017" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> convs_path.exists():</span>
<span id="cb8-1018"><a href="#cb8-1018" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå DeepSeek: conversations.json n√£o encontrado.&quot;</span>)</span>
<span id="cb8-1019"><a href="#cb8-1019" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-1020"><a href="#cb8-1020" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1021"><a href="#cb8-1021" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(convs_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1022"><a href="#cb8-1022" aria-hidden="true" tabindex="-1"></a>                raw_data <span class="op">=</span> json.load(f)</span>
<span id="cb8-1023"><a href="#cb8-1023" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1024"><a href="#cb8-1024" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">list</span>):</span>
<span id="cb8-1025"><a href="#cb8-1025" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> raw_data</span>
<span id="cb8-1026"><a href="#cb8-1026" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;data&#39;</span> <span class="kw">in</span> raw_data:</span>
<span id="cb8-1027"><a href="#cb8-1027" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> raw_data[<span class="st">&#39;data&#39;</span>]</span>
<span id="cb8-1028"><a href="#cb8-1028" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb8-1029"><a href="#cb8-1029" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  DeepSeek: estrutura inesperada.&quot;</span>)</span>
<span id="cb8-1030"><a href="#cb8-1030" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-1031"><a href="#cb8-1031" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1032"><a href="#cb8-1032" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">list</span>):</span>
<span id="cb8-1033"><a href="#cb8-1033" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  DeepSeek: &#39;data&#39; n√£o √© uma lista.&quot;</span>)</span>
<span id="cb8-1034"><a href="#cb8-1034" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-1035"><a href="#cb8-1035" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1036"><a href="#cb8-1036" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç DeepSeek: encontradas </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb8-1037"><a href="#cb8-1037" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-1038"><a href="#cb8-1038" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1039"><a href="#cb8-1039" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb8-1040"><a href="#cb8-1040" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa DeepSeek </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb8-1041"><a href="#cb8-1041" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb8-1042"><a href="#cb8-1042" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb8-1043"><a href="#cb8-1043" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1044"><a href="#cb8-1044" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb8-1045"><a href="#cb8-1045" aria-hidden="true" tabindex="-1"></a>                mapping <span class="op">=</span> conv.get(<span class="st">&#39;mapping&#39;</span>, {})</span>
<span id="cb8-1046"><a href="#cb8-1046" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1047"><a href="#cb8-1047" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> node_id, node <span class="kw">in</span> mapping.items():</span>
<span id="cb8-1048"><a href="#cb8-1048" aria-hidden="true" tabindex="-1"></a>                    msg_data <span class="op">=</span> node.get(<span class="st">&#39;message&#39;</span>)</span>
<span id="cb8-1049"><a href="#cb8-1049" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> msg_data <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(msg_data, <span class="bu">dict</span>):</span>
<span id="cb8-1050"><a href="#cb8-1050" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-1051"><a href="#cb8-1051" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb8-1052"><a href="#cb8-1052" aria-hidden="true" tabindex="-1"></a>                    fragments <span class="op">=</span> msg_data.get(<span class="st">&#39;fragments&#39;</span>, [])</span>
<span id="cb8-1053"><a href="#cb8-1053" aria-hidden="true" tabindex="-1"></a>                    content_parts <span class="op">=</span> []</span>
<span id="cb8-1054"><a href="#cb8-1054" aria-hidden="true" tabindex="-1"></a>                    msg_type <span class="op">=</span> <span class="va">None</span></span>
<span id="cb8-1055"><a href="#cb8-1055" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1056"><a href="#cb8-1056" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> frag <span class="kw">in</span> fragments:</span>
<span id="cb8-1057"><a href="#cb8-1057" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(frag, <span class="bu">dict</span>):</span>
<span id="cb8-1058"><a href="#cb8-1058" aria-hidden="true" tabindex="-1"></a>                            frag_type <span class="op">=</span> frag.get(<span class="st">&#39;type&#39;</span>, <span class="st">&#39;&#39;</span>).upper()</span>
<span id="cb8-1059"><a href="#cb8-1059" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> frag_type <span class="kw">in</span> (<span class="st">&#39;REQUEST&#39;</span>, <span class="st">&#39;RESPONSE&#39;</span>):</span>
<span id="cb8-1060"><a href="#cb8-1060" aria-hidden="true" tabindex="-1"></a>                                msg_type <span class="op">=</span> frag_type</span>
<span id="cb8-1061"><a href="#cb8-1061" aria-hidden="true" tabindex="-1"></a>                            text <span class="op">=</span> frag.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb8-1062"><a href="#cb8-1062" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> text:</span>
<span id="cb8-1063"><a href="#cb8-1063" aria-hidden="true" tabindex="-1"></a>                                content_parts.append(text)</span>
<span id="cb8-1064"><a href="#cb8-1064" aria-hidden="true" tabindex="-1"></a>                            content <span class="op">=</span> frag.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb8-1065"><a href="#cb8-1065" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> content:</span>
<span id="cb8-1066"><a href="#cb8-1066" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> <span class="bu">isinstance</span>(content, <span class="bu">list</span>):</span>
<span id="cb8-1067"><a href="#cb8-1067" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">for</span> item <span class="kw">in</span> content:</span>
<span id="cb8-1068"><a href="#cb8-1068" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">if</span> <span class="bu">isinstance</span>(item, <span class="bu">str</span>):</span>
<span id="cb8-1069"><a href="#cb8-1069" aria-hidden="true" tabindex="-1"></a>                                            content_parts.append(item)</span>
<span id="cb8-1070"><a href="#cb8-1070" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">elif</span> <span class="bu">isinstance</span>(item, <span class="bu">dict</span>):</span>
<span id="cb8-1071"><a href="#cb8-1071" aria-hidden="true" tabindex="-1"></a>                                            item_text <span class="op">=</span> item.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb8-1072"><a href="#cb8-1072" aria-hidden="true" tabindex="-1"></a>                                            <span class="cf">if</span> item_text:</span>
<span id="cb8-1073"><a href="#cb8-1073" aria-hidden="true" tabindex="-1"></a>                                                content_parts.append(<span class="bu">str</span>(item_text))</span>
<span id="cb8-1074"><a href="#cb8-1074" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">else</span>:</span>
<span id="cb8-1075"><a href="#cb8-1075" aria-hidden="true" tabindex="-1"></a>                                    content_parts.append(<span class="bu">str</span>(content))</span>
<span id="cb8-1076"><a href="#cb8-1076" aria-hidden="true" tabindex="-1"></a>                                    </span>
<span id="cb8-1077"><a href="#cb8-1077" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="st">&#39; &#39;</span>.join(content_parts).strip()</span>
<span id="cb8-1078"><a href="#cb8-1078" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1079"><a href="#cb8-1079" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb8-1080"><a href="#cb8-1080" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1081"><a href="#cb8-1081" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb8-1082"><a href="#cb8-1082" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-1083"><a href="#cb8-1083" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb8-1084"><a href="#cb8-1084" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> msg_type <span class="op">==</span> <span class="st">&#39;REQUEST&#39;</span>:</span>
<span id="cb8-1085"><a href="#cb8-1085" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb8-1086"><a href="#cb8-1086" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;user&#39;</span></span>
<span id="cb8-1087"><a href="#cb8-1087" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb8-1088"><a href="#cb8-1088" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ DeepSeek&quot;</span></span>
<span id="cb8-1089"><a href="#cb8-1089" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;assistant&#39;</span></span>
<span id="cb8-1090"><a href="#cb8-1090" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb8-1091"><a href="#cb8-1091" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb8-1092"><a href="#cb8-1092" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb8-1093"><a href="#cb8-1093" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb8-1094"><a href="#cb8-1094" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb8-1095"><a href="#cb8-1095" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(msg_data.get(<span class="st">&#39;inserted_at&#39;</span>)),</span>
<span id="cb8-1096"><a href="#cb8-1096" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg_data.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;DeepSeek&#39;</span>)</span>
<span id="cb8-1097"><a href="#cb8-1097" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-1098"><a href="#cb8-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1099"><a href="#cb8-1099" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb8-1100"><a href="#cb8-1100" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb8-1101"><a href="#cb8-1101" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb8-1102"><a href="#cb8-1102" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;DeepSeek&#39;</span>,</span>
<span id="cb8-1103"><a href="#cb8-1103" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;deepseek_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb8-1104"><a href="#cb8-1104" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;inserted_at&#39;</span>)),</span>
<span id="cb8-1105"><a href="#cb8-1105" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;updated_at&#39;</span>)),</span>
<span id="cb8-1106"><a href="#cb8-1106" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb8-1107"><a href="#cb8-1107" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb8-1108"><a href="#cb8-1108" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb8-1109"><a href="#cb8-1109" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-1110"><a href="#cb8-1110" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1111"><a href="#cb8-1111" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1112"><a href="#cb8-1112" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ DeepSeek: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb8-1113"><a href="#cb8-1113" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1114"><a href="#cb8-1114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-1115"><a href="#cb8-1115" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar DeepSeek: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1116"><a href="#cb8-1116" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1117"><a href="#cb8-1117" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb8-1118"><a href="#cb8-1118" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb8-1119"><a href="#cb8-1119" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb8-1120"><a href="#cb8-1120" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-1121"><a href="#cb8-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1122"><a href="#cb8-1122" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_grok(<span class="va">self</span>, path: Path):</span>
<span id="cb8-1123"><a href="#cb8-1123" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do Grok&quot;&quot;&quot;</span></span>
<span id="cb8-1124"><a href="#cb8-1124" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1125"><a href="#cb8-1125" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria Grok: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1126"><a href="#cb8-1126" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1127"><a href="#cb8-1127" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1128"><a href="#cb8-1128" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-1129"><a href="#cb8-1129" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;grok_&quot;</span>)</span>
<span id="cb8-1130"><a href="#cb8-1130" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb8-1131"><a href="#cb8-1131" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb8-1132"><a href="#cb8-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1133"><a href="#cb8-1133" aria-hidden="true" tabindex="-1"></a>            target_file <span class="op">=</span> <span class="va">None</span></span>
<span id="cb8-1134"><a href="#cb8-1134" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> root, _, files <span class="kw">in</span> os.walk(temp_dir):</span>
<span id="cb8-1135"><a href="#cb8-1135" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb8-1136"><a href="#cb8-1136" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">file</span> <span class="op">==</span> <span class="st">&quot;prod-grok-backend.json&quot;</span>:</span>
<span id="cb8-1137"><a href="#cb8-1137" aria-hidden="true" tabindex="-1"></a>                        target_file <span class="op">=</span> Path(root) <span class="op">/</span> <span class="bu">file</span></span>
<span id="cb8-1138"><a href="#cb8-1138" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb8-1139"><a href="#cb8-1139" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> target_file:</span>
<span id="cb8-1140"><a href="#cb8-1140" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb8-1141"><a href="#cb8-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1142"><a href="#cb8-1142" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> target_file:</span>
<span id="cb8-1143"><a href="#cb8-1143" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: ficheiro &#39;prod-grok-backend.json&#39; n√£o encontrado no ZIP.&quot;</span>)</span>
<span id="cb8-1144"><a href="#cb8-1144" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-1145"><a href="#cb8-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1146"><a href="#cb8-1146" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Grok: carregando </span><span class="sc">{</span>target_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb8-1147"><a href="#cb8-1147" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(target_file, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1148"><a href="#cb8-1148" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.load(f)</span>
<span id="cb8-1149"><a href="#cb8-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1150"><a href="#cb8-1150" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">dict</span>) <span class="kw">or</span> <span class="st">&#39;conversations&#39;</span> <span class="kw">not</span> <span class="kw">in</span> data:</span>
<span id="cb8-1151"><a href="#cb8-1151" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: estrutura inesperada ‚Äî chave &#39;conversations&#39; n√£o encontrada.&quot;</span>)</span>
<span id="cb8-1152"><a href="#cb8-1152" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-1153"><a href="#cb8-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1154"><a href="#cb8-1154" aria-hidden="true" tabindex="-1"></a>            conversations_list <span class="op">=</span> data[<span class="st">&#39;conversations&#39;</span>]</span>
<span id="cb8-1155"><a href="#cb8-1155" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conversations_list, <span class="bu">list</span>):</span>
<span id="cb8-1156"><a href="#cb8-1156" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: &#39;conversations&#39; n√£o √© uma lista.&quot;</span>)</span>
<span id="cb8-1157"><a href="#cb8-1157" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-1158"><a href="#cb8-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1159"><a href="#cb8-1159" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä Grok: encontradas </span><span class="sc">{</span><span class="bu">len</span>(conversations_list)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb8-1160"><a href="#cb8-1160" aria-hidden="true" tabindex="-1"></a>            total_convs <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-1161"><a href="#cb8-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1162"><a href="#cb8-1162" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> item <span class="kw">in</span> conversations_list:</span>
<span id="cb8-1163"><a href="#cb8-1163" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(item, <span class="bu">dict</span>):</span>
<span id="cb8-1164"><a href="#cb8-1164" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb8-1165"><a href="#cb8-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1166"><a href="#cb8-1166" aria-hidden="true" tabindex="-1"></a>                conv_meta <span class="op">=</span> item.get(<span class="st">&#39;conversation&#39;</span>)</span>
<span id="cb8-1167"><a href="#cb8-1167" aria-hidden="true" tabindex="-1"></a>                responses <span class="op">=</span> item.get(<span class="st">&#39;responses&#39;</span>, [])</span>
<span id="cb8-1168"><a href="#cb8-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1169"><a href="#cb8-1169" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conv_meta, <span class="bu">dict</span>) <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(responses, <span class="bu">list</span>) <span class="kw">or</span> <span class="kw">not</span> responses:</span>
<span id="cb8-1170"><a href="#cb8-1170" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb8-1171"><a href="#cb8-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1172"><a href="#cb8-1172" aria-hidden="true" tabindex="-1"></a>                conv_id <span class="op">=</span> conv_meta.get(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb8-1173"><a href="#cb8-1173" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> conv_id:</span>
<span id="cb8-1174"><a href="#cb8-1174" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb8-1175"><a href="#cb8-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1176"><a href="#cb8-1176" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv_meta.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&quot;Conversa Grok </span><span class="sc">{</span>total_convs <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1177"><a href="#cb8-1177" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb8-1178"><a href="#cb8-1178" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb8-1179"><a href="#cb8-1179" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1180"><a href="#cb8-1180" aria-hidden="true" tabindex="-1"></a>                create_time_str <span class="op">=</span> conv_meta.get(<span class="st">&#39;create_time&#39;</span>)</span>
<span id="cb8-1181"><a href="#cb8-1181" aria-hidden="true" tabindex="-1"></a>                modify_time_str <span class="op">=</span> conv_meta.get(<span class="st">&#39;modify_time&#39;</span>)</span>
<span id="cb8-1182"><a href="#cb8-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1183"><a href="#cb8-1183" aria-hidden="true" tabindex="-1"></a>                <span class="kw">def</span> format_iso_timestamp(ts_str):</span>
<span id="cb8-1184"><a href="#cb8-1184" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> ts_str:</span>
<span id="cb8-1185"><a href="#cb8-1185" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb8-1186"><a href="#cb8-1186" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">try</span>:</span>
<span id="cb8-1187"><a href="#cb8-1187" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="st">&#39;.&#39;</span> <span class="kw">in</span> ts_str:</span>
<span id="cb8-1188"><a href="#cb8-1188" aria-hidden="true" tabindex="-1"></a>                            ts_str <span class="op">=</span> ts_str.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>] <span class="op">+</span> <span class="st">&#39;Z&#39;</span></span>
<span id="cb8-1189"><a href="#cb8-1189" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="va">self</span>.format_timestamp(ts_str)</span>
<span id="cb8-1190"><a href="#cb8-1190" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">except</span>:</span>
<span id="cb8-1191"><a href="#cb8-1191" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="bu">str</span>(ts_str)</span>
<span id="cb8-1192"><a href="#cb8-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1193"><a href="#cb8-1193" aria-hidden="true" tabindex="-1"></a>                inserted_at <span class="op">=</span> format_iso_timestamp(create_time_str)</span>
<span id="cb8-1194"><a href="#cb8-1194" aria-hidden="true" tabindex="-1"></a>                updated_at <span class="op">=</span> format_iso_timestamp(modify_time_str)</span>
<span id="cb8-1195"><a href="#cb8-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1196"><a href="#cb8-1196" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb8-1197"><a href="#cb8-1197" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> resp <span class="kw">in</span> responses:</span>
<span id="cb8-1198"><a href="#cb8-1198" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(resp, <span class="bu">dict</span>):</span>
<span id="cb8-1199"><a href="#cb8-1199" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-1200"><a href="#cb8-1200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1201"><a href="#cb8-1201" aria-hidden="true" tabindex="-1"></a>                    resp_data <span class="op">=</span> resp.get(<span class="st">&#39;response&#39;</span>)</span>
<span id="cb8-1202"><a href="#cb8-1202" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(resp_data, <span class="bu">dict</span>):</span>
<span id="cb8-1203"><a href="#cb8-1203" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-1204"><a href="#cb8-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1205"><a href="#cb8-1205" aria-hidden="true" tabindex="-1"></a>                    sender <span class="op">=</span> resp_data.get(<span class="st">&#39;sender&#39;</span>, <span class="st">&#39;&#39;</span>).upper()</span>
<span id="cb8-1206"><a href="#cb8-1206" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> sender <span class="op">==</span> <span class="st">&#39;HUMAN&#39;</span>:</span>
<span id="cb8-1207"><a href="#cb8-1207" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb8-1208"><a href="#cb8-1208" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&quot;user&quot;</span></span>
<span id="cb8-1209"><a href="#cb8-1209" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> sender <span class="op">==</span> <span class="st">&#39;ASSISTANT&#39;</span>:</span>
<span id="cb8-1210"><a href="#cb8-1210" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ Grok&quot;</span></span>
<span id="cb8-1211"><a href="#cb8-1211" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&quot;assistant&quot;</span></span>
<span id="cb8-1212"><a href="#cb8-1212" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb8-1213"><a href="#cb8-1213" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-1214"><a href="#cb8-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1215"><a href="#cb8-1215" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="bu">str</span>(resp_data.get(<span class="st">&#39;message&#39;</span>, <span class="st">&#39;&#39;</span>)).strip()</span>
<span id="cb8-1216"><a href="#cb8-1216" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1217"><a href="#cb8-1217" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb8-1218"><a href="#cb8-1218" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1219"><a href="#cb8-1219" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb8-1220"><a href="#cb8-1220" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-1221"><a href="#cb8-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1222"><a href="#cb8-1222" aria-hidden="true" tabindex="-1"></a>                    create_time <span class="op">=</span> resp_data.get(<span class="st">&#39;create_time&#39;</span>)</span>
<span id="cb8-1223"><a href="#cb8-1223" aria-hidden="true" tabindex="-1"></a>                    timestamp_ms <span class="op">=</span> <span class="va">None</span></span>
<span id="cb8-1224"><a href="#cb8-1224" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(create_time, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;$date&#39;</span> <span class="kw">in</span> create_time:</span>
<span id="cb8-1225"><a href="#cb8-1225" aria-hidden="true" tabindex="-1"></a>                        date_obj <span class="op">=</span> create_time[<span class="st">&#39;$date&#39;</span>]</span>
<span id="cb8-1226"><a href="#cb8-1226" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(date_obj, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;$numberLong&#39;</span> <span class="kw">in</span> date_obj:</span>
<span id="cb8-1227"><a href="#cb8-1227" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">try</span>:</span>
<span id="cb8-1228"><a href="#cb8-1228" aria-hidden="true" tabindex="-1"></a>                                timestamp_ms <span class="op">=</span> <span class="bu">int</span>(date_obj[<span class="st">&#39;$numberLong&#39;</span>])</span>
<span id="cb8-1229"><a href="#cb8-1229" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">except</span>:</span>
<span id="cb8-1230"><a href="#cb8-1230" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">pass</span></span>
<span id="cb8-1231"><a href="#cb8-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1232"><a href="#cb8-1232" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb8-1233"><a href="#cb8-1233" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb8-1234"><a href="#cb8-1234" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb8-1235"><a href="#cb8-1235" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb8-1236"><a href="#cb8-1236" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(timestamp_ms <span class="op">/</span> <span class="fl">1000.0</span> <span class="cf">if</span> timestamp_ms <span class="cf">else</span> <span class="va">None</span>),</span>
<span id="cb8-1237"><a href="#cb8-1237" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: <span class="st">&#39;Grok&#39;</span></span>
<span id="cb8-1238"><a href="#cb8-1238" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-1239"><a href="#cb8-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1240"><a href="#cb8-1240" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb8-1241"><a href="#cb8-1241" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb8-1242"><a href="#cb8-1242" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb8-1243"><a href="#cb8-1243" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;Grok&#39;</span>,</span>
<span id="cb8-1244"><a href="#cb8-1244" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv_id,</span>
<span id="cb8-1245"><a href="#cb8-1245" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: inserted_at,</span>
<span id="cb8-1246"><a href="#cb8-1246" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: updated_at,</span>
<span id="cb8-1247"><a href="#cb8-1247" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb8-1248"><a href="#cb8-1248" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb8-1249"><a href="#cb8-1249" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb8-1250"><a href="#cb8-1250" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-1251"><a href="#cb8-1251" aria-hidden="true" tabindex="-1"></a>                    total_convs <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1252"><a href="#cb8-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1253"><a href="#cb8-1253" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> total_convs <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb8-1254"><a href="#cb8-1254" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Grok: processadas </span><span class="sc">{</span>total_convs<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb8-1255"><a href="#cb8-1255" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb8-1256"><a href="#cb8-1256" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: nenhuma conversa v√°lida encontrada.&quot;</span>)</span>
<span id="cb8-1257"><a href="#cb8-1257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1258"><a href="#cb8-1258" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-1259"><a href="#cb8-1259" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar Grok: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1260"><a href="#cb8-1260" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1261"><a href="#cb8-1261" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb8-1262"><a href="#cb8-1262" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb8-1263"><a href="#cb8-1263" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb8-1264"><a href="#cb8-1264" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-1265"><a href="#cb8-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1266"><a href="#cb8-1266" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_markdown_enhanced(<span class="va">self</span>):</span>
<span id="cb8-1267"><a href="#cb8-1267" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas com preserva√ß√£o total de formata√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb8-1268"><a href="#cb8-1268" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1269"><a href="#cb8-1269" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] Markdowns seriam criados:&quot;</span>)</span>
<span id="cb8-1270"><a href="#cb8-1270" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-1271"><a href="#cb8-1271" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb8-1272"><a href="#cb8-1272" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.md&quot;</span></span>
<span id="cb8-1273"><a href="#cb8-1273" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÑ </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1274"><a href="#cb8-1274" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1275"><a href="#cb8-1275" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1276"><a href="#cb8-1276" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;markdown&#39;</span>])</span>
<span id="cb8-1277"><a href="#cb8-1277" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-1278"><a href="#cb8-1278" aria-hidden="true" tabindex="-1"></a>        failed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-1279"><a href="#cb8-1279" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1280"><a href="#cb8-1280" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-1281"><a href="#cb8-1281" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb8-1282"><a href="#cb8-1282" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb8-1283"><a href="#cb8-1283" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.md&quot;</span></span>
<span id="cb8-1284"><a href="#cb8-1284" aria-hidden="true" tabindex="-1"></a>                filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb8-1285"><a href="#cb8-1285" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1286"><a href="#cb8-1286" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb8-1287"><a href="#cb8-1287" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb8-1288"><a href="#cb8-1288" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1289"><a href="#cb8-1289" aria-hidden="true" tabindex="-1"></a>                markdown_content <span class="op">=</span> <span class="va">self</span>.create_enhanced_markdown_content(conv)</span>
<span id="cb8-1290"><a href="#cb8-1290" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1291"><a href="#cb8-1291" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1292"><a href="#cb8-1292" aria-hidden="true" tabindex="-1"></a>                    f.write(markdown_content)</span>
<span id="cb8-1293"><a href="#cb8-1293" aria-hidden="true" tabindex="-1"></a>                saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1294"><a href="#cb8-1294" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1295"><a href="#cb8-1295" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-1296"><a href="#cb8-1296" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao salvar conversa </span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1297"><a href="#cb8-1297" aria-hidden="true" tabindex="-1"></a>                failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1298"><a href="#cb8-1298" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb8-1299"><a href="#cb8-1299" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1300"><a href="#cb8-1300" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Markdown: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados, </span><span class="sc">{</span>failed_count<span class="sc">}</span><span class="ss"> falhas em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb8-1301"><a href="#cb8-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1302"><a href="#cb8-1302" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_csv(<span class="va">self</span>):</span>
<span id="cb8-1303"><a href="#cb8-1303" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas em arquivos CSV individuais&quot;&quot;&quot;</span></span>
<span id="cb8-1304"><a href="#cb8-1304" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1305"><a href="#cb8-1305" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] CSVs seriam criados:&quot;</span>)</span>
<span id="cb8-1306"><a href="#cb8-1306" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-1307"><a href="#cb8-1307" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb8-1308"><a href="#cb8-1308" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.csv&quot;</span></span>
<span id="cb8-1309"><a href="#cb8-1309" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìä </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1310"><a href="#cb8-1310" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1311"><a href="#cb8-1311" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1312"><a href="#cb8-1312" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;csv&#39;</span>])</span>
<span id="cb8-1313"><a href="#cb8-1313" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-1314"><a href="#cb8-1314" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1315"><a href="#cb8-1315" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-1316"><a href="#cb8-1316" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb8-1317"><a href="#cb8-1317" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.csv&quot;</span></span>
<span id="cb8-1318"><a href="#cb8-1318" aria-hidden="true" tabindex="-1"></a>            filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb8-1319"><a href="#cb8-1319" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1320"><a href="#cb8-1320" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb8-1321"><a href="#cb8-1321" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb8-1322"><a href="#cb8-1322" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1323"><a href="#cb8-1323" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1324"><a href="#cb8-1324" aria-hidden="true" tabindex="-1"></a>                writer <span class="op">=</span> csv.DictWriter(f, fieldnames<span class="op">=</span>[</span>
<span id="cb8-1325"><a href="#cb8-1325" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;node_id&#39;</span>, <span class="st">&#39;author&#39;</span>, <span class="st">&#39;role&#39;</span>, <span class="st">&#39;timestamp&#39;</span>, <span class="st">&#39;model&#39;</span>, <span class="st">&#39;content&#39;</span></span>
<span id="cb8-1326"><a href="#cb8-1326" aria-hidden="true" tabindex="-1"></a>                ])</span>
<span id="cb8-1327"><a href="#cb8-1327" aria-hidden="true" tabindex="-1"></a>                writer.writeheader()</span>
<span id="cb8-1328"><a href="#cb8-1328" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i, msg <span class="kw">in</span> <span class="bu">enumerate</span>(conv[<span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb8-1329"><a href="#cb8-1329" aria-hidden="true" tabindex="-1"></a>                    writer.writerow({</span>
<span id="cb8-1330"><a href="#cb8-1330" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;node_id&#39;</span>: <span class="bu">str</span>(i),</span>
<span id="cb8-1331"><a href="#cb8-1331" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: msg[<span class="st">&#39;author&#39;</span>],</span>
<span id="cb8-1332"><a href="#cb8-1332" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: msg[<span class="st">&#39;role&#39;</span>],</span>
<span id="cb8-1333"><a href="#cb8-1333" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: msg[<span class="st">&#39;timestamp&#39;</span>],</span>
<span id="cb8-1334"><a href="#cb8-1334" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg[<span class="st">&#39;model&#39;</span>],</span>
<span id="cb8-1335"><a href="#cb8-1335" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: msg[<span class="st">&#39;content&#39;</span>]</span>
<span id="cb8-1336"><a href="#cb8-1336" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-1337"><a href="#cb8-1337" aria-hidden="true" tabindex="-1"></a>            saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1338"><a href="#cb8-1338" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1339"><a href="#cb8-1339" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ CSV: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb8-1340"><a href="#cb8-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1341"><a href="#cb8-1341" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_json(<span class="va">self</span>):</span>
<span id="cb8-1342"><a href="#cb8-1342" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas em arquivos JSON individuais&quot;&quot;&quot;</span></span>
<span id="cb8-1343"><a href="#cb8-1343" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1344"><a href="#cb8-1344" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] JSONs seriam criados:&quot;</span>)</span>
<span id="cb8-1345"><a href="#cb8-1345" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-1346"><a href="#cb8-1346" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb8-1347"><a href="#cb8-1347" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.json&quot;</span></span>
<span id="cb8-1348"><a href="#cb8-1348" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìã </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1349"><a href="#cb8-1349" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1350"><a href="#cb8-1350" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1351"><a href="#cb8-1351" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;json&#39;</span>])</span>
<span id="cb8-1352"><a href="#cb8-1352" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-1353"><a href="#cb8-1353" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1354"><a href="#cb8-1354" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-1355"><a href="#cb8-1355" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb8-1356"><a href="#cb8-1356" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.json&quot;</span></span>
<span id="cb8-1357"><a href="#cb8-1357" aria-hidden="true" tabindex="-1"></a>            filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb8-1358"><a href="#cb8-1358" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1359"><a href="#cb8-1359" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb8-1360"><a href="#cb8-1360" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb8-1361"><a href="#cb8-1361" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1362"><a href="#cb8-1362" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1363"><a href="#cb8-1363" aria-hidden="true" tabindex="-1"></a>                json.dump(conv, f, ensure_ascii<span class="op">=</span><span class="va">False</span>, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb8-1364"><a href="#cb8-1364" aria-hidden="true" tabindex="-1"></a>            saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1365"><a href="#cb8-1365" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1366"><a href="#cb8-1366" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ JSON: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb8-1367"><a href="#cb8-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1368"><a href="#cb8-1368" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_all_to_single_files(<span class="va">self</span>):</span>
<span id="cb8-1369"><a href="#cb8-1369" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva todas as conversas em arquivos √∫nicos CSV e JSON&quot;&quot;&quot;</span></span>
<span id="cb8-1370"><a href="#cb8-1370" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1371"><a href="#cb8-1371" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] Arquivos √∫nicos seriam criados:&quot;</span>)</span>
<span id="cb8-1372"><a href="#cb8-1372" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÅ </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;csv&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1373"><a href="#cb8-1373" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÅ </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;json&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1374"><a href="#cb8-1374" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1375"><a href="#cb8-1375" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1376"><a href="#cb8-1376" aria-hidden="true" tabindex="-1"></a>        <span class="co"># CSV √∫nico</span></span>
<span id="cb8-1377"><a href="#cb8-1377" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.single_files[<span class="st">&#39;csv&#39;</span>], <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1378"><a href="#cb8-1378" aria-hidden="true" tabindex="-1"></a>            fieldnames <span class="op">=</span> [</span>
<span id="cb8-1379"><a href="#cb8-1379" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;conversation_number&#39;</span>, <span class="st">&#39;source&#39;</span>, <span class="st">&#39;conversation_title&#39;</span>, <span class="st">&#39;category&#39;</span>,</span>
<span id="cb8-1380"><a href="#cb8-1380" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;author&#39;</span>, <span class="st">&#39;role&#39;</span>, <span class="st">&#39;timestamp&#39;</span>, <span class="st">&#39;model&#39;</span>, <span class="st">&#39;content&#39;</span></span>
<span id="cb8-1381"><a href="#cb8-1381" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb8-1382"><a href="#cb8-1382" aria-hidden="true" tabindex="-1"></a>            writer <span class="op">=</span> csv.DictWriter(f, fieldnames<span class="op">=</span>fieldnames)</span>
<span id="cb8-1383"><a href="#cb8-1383" aria-hidden="true" tabindex="-1"></a>            writer.writeheader()</span>
<span id="cb8-1384"><a href="#cb8-1384" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-1385"><a href="#cb8-1385" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> msg <span class="kw">in</span> conv[<span class="st">&#39;messages&#39;</span>]:</span>
<span id="cb8-1386"><a href="#cb8-1386" aria-hidden="true" tabindex="-1"></a>                    writer.writerow({</span>
<span id="cb8-1387"><a href="#cb8-1387" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;conversation_number&#39;</span>: conv[<span class="st">&#39;number&#39;</span>],</span>
<span id="cb8-1388"><a href="#cb8-1388" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: conv[<span class="st">&#39;source&#39;</span>],</span>
<span id="cb8-1389"><a href="#cb8-1389" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;conversation_title&#39;</span>: conv[<span class="st">&#39;title&#39;</span>],</span>
<span id="cb8-1390"><a href="#cb8-1390" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: conv[<span class="st">&#39;category&#39;</span>],</span>
<span id="cb8-1391"><a href="#cb8-1391" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: msg[<span class="st">&#39;author&#39;</span>],</span>
<span id="cb8-1392"><a href="#cb8-1392" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: msg[<span class="st">&#39;role&#39;</span>],</span>
<span id="cb8-1393"><a href="#cb8-1393" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: msg[<span class="st">&#39;timestamp&#39;</span>],</span>
<span id="cb8-1394"><a href="#cb8-1394" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg[<span class="st">&#39;model&#39;</span>],</span>
<span id="cb8-1395"><a href="#cb8-1395" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: msg[<span class="st">&#39;content&#39;</span>]</span>
<span id="cb8-1396"><a href="#cb8-1396" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-1397"><a href="#cb8-1397" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ CSV √∫nico: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;csv&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1398"><a href="#cb8-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1399"><a href="#cb8-1399" aria-hidden="true" tabindex="-1"></a>        <span class="co"># JSON √∫nico</span></span>
<span id="cb8-1400"><a href="#cb8-1400" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.single_files[<span class="st">&#39;json&#39;</span>], <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1401"><a href="#cb8-1401" aria-hidden="true" tabindex="-1"></a>            json.dump(<span class="va">self</span>.all_conversations, f, ensure_ascii<span class="op">=</span><span class="va">False</span>, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb8-1402"><a href="#cb8-1402" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ JSON √∫nico: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;json&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1403"><a href="#cb8-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1404"><a href="#cb8-1404" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_searchable_index(<span class="va">self</span>):</span>
<span id="cb8-1405"><a href="#cb8-1405" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Cria √≠ndice HTML pesquis√°vel com links para HTML&quot;&quot;&quot;</span></span>
<span id="cb8-1406"><a href="#cb8-1406" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1407"><a href="#cb8-1407" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] √çndice HTML seria criado: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1408"><a href="#cb8-1408" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1409"><a href="#cb8-1409" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1410"><a href="#cb8-1410" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;üéØ Criando √≠ndice HTML combinado...&quot;</span>)</span>
<span id="cb8-1411"><a href="#cb8-1411" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1412"><a href="#cb8-1412" aria-hidden="true" tabindex="-1"></a>        category_stats <span class="op">=</span> {}</span>
<span id="cb8-1413"><a href="#cb8-1413" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-1414"><a href="#cb8-1414" aria-hidden="true" tabindex="-1"></a>            cat <span class="op">=</span> conv[<span class="st">&#39;category&#39;</span>]</span>
<span id="cb8-1415"><a href="#cb8-1415" aria-hidden="true" tabindex="-1"></a>            category_stats[cat] <span class="op">=</span> category_stats.get(cat, <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb8-1416"><a href="#cb8-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1417"><a href="#cb8-1417" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb8-1418"><a href="#cb8-1418" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html lang=&quot;pt-PT&quot;&gt;</span></span>
<span id="cb8-1419"><a href="#cb8-1419" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb8-1420"><a href="#cb8-1420" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb8-1421"><a href="#cb8-1421" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb8-1422"><a href="#cb8-1422" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;√çndice Combinado - AI Chats&lt;/title&gt;</span></span>
<span id="cb8-1423"><a href="#cb8-1423" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb8-1424"><a href="#cb8-1424" aria-hidden="true" tabindex="-1"></a><span class="ss">        * </span><span class="ch">{{</span><span class="ss"> margin: 0; padding: 0; box-sizing: border-box; </span><span class="ch">}}</span></span>
<span id="cb8-1425"><a href="#cb8-1425" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span><span class="ss"> font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; color: #333; </span><span class="ch">}}</span></span>
<span id="cb8-1426"><a href="#cb8-1426" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span><span class="ss"> max-width: 1400px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; </span><span class="ch">}}</span></span>
<span id="cb8-1427"><a href="#cb8-1427" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header </span><span class="ch">{{</span><span class="ss"> background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; text-align: center; </span><span class="ch">}}</span></span>
<span id="cb8-1428"><a href="#cb8-1428" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header h1 </span><span class="ch">{{</span><span class="ss"> font-size: 2.8em; margin-bottom: 15px; font-weight: 300; </span><span class="ch">}}</span></span>
<span id="cb8-1429"><a href="#cb8-1429" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header p </span><span class="ch">{{</span><span class="ss"> font-size: 1.2em; opacity: 0.9; margin-bottom: 20px; </span><span class="ch">}}</span></span>
<span id="cb8-1430"><a href="#cb8-1430" aria-hidden="true" tabindex="-1"></a><span class="ss">        .stats </span><span class="ch">{{</span><span class="ss"> display: flex; justify-content: center; gap: 30px; margin-top: 25px; flex-wrap: wrap; </span><span class="ch">}}</span></span>
<span id="cb8-1431"><a href="#cb8-1431" aria-hidden="true" tabindex="-1"></a><span class="ss">        .stat-item </span><span class="ch">{{</span><span class="ss"> background: rgba(255,255,255,0.15); padding: 18px 28px; border-radius: 12px; backdrop-filter: blur(10px); font-size: 1.1em; </span><span class="ch">}}</span></span>
<span id="cb8-1432"><a href="#cb8-1432" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-section </span><span class="ch">{{</span><span class="ss"> padding: 30px; background: #f8f9fa; border-bottom: 1px solid #e9ecef; </span><span class="ch">}}</span></span>
<span id="cb8-1433"><a href="#cb8-1433" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-box </span><span class="ch">{{</span><span class="ss"> width: 100%; padding: 18px 25px; font-size: 16px; border: 2px solid #e9ecef; border-radius: 25px; outline: none; transition: all 0.3s ease; font-family: inherit; </span><span class="ch">}}</span></span>
<span id="cb8-1434"><a href="#cb8-1434" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-box:focus </span><span class="ch">{{</span><span class="ss"> border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); </span><span class="ch">}}</span></span>
<span id="cb8-1435"><a href="#cb8-1435" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-section </span><span class="ch">{{</span></span>
<span id="cb8-1436"><a href="#cb8-1436" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px 30px;</span></span>
<span id="cb8-1437"><a href="#cb8-1437" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb8-1438"><a href="#cb8-1438" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb8-1439"><a href="#cb8-1439" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 12px;</span></span>
<span id="cb8-1440"><a href="#cb8-1440" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: center;</span></span>
<span id="cb8-1441"><a href="#cb8-1441" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb8-1442"><a href="#cb8-1442" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 1px solid #e9ecef;</span></span>
<span id="cb8-1443"><a href="#cb8-1443" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1444"><a href="#cb8-1444" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-btn </span><span class="ch">{{</span></span>
<span id="cb8-1445"><a href="#cb8-1445" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 10px 20px;</span></span>
<span id="cb8-1446"><a href="#cb8-1446" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb8-1447"><a href="#cb8-1447" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 2px solid #e9ecef;</span></span>
<span id="cb8-1448"><a href="#cb8-1448" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 25px;</span></span>
<span id="cb8-1449"><a href="#cb8-1449" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb8-1450"><a href="#cb8-1450" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.95em;</span></span>
<span id="cb8-1451"><a href="#cb8-1451" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb8-1452"><a href="#cb8-1452" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.3s ease;</span></span>
<span id="cb8-1453"><a href="#cb8-1453" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: inherit;</span></span>
<span id="cb8-1454"><a href="#cb8-1454" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1455"><a href="#cb8-1455" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-btn.active, .filter-btn:hover </span><span class="ch">{{</span></span>
<span id="cb8-1456"><a href="#cb8-1456" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #667eea;</span></span>
<span id="cb8-1457"><a href="#cb8-1457" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb8-1458"><a href="#cb8-1458" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb8-1459"><a href="#cb8-1459" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: translateY(-2px);</span></span>
<span id="cb8-1460"><a href="#cb8-1460" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);</span></span>
<span id="cb8-1461"><a href="#cb8-1461" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1462"><a href="#cb8-1462" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversations-grid </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1463"><a href="#cb8-1463" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: grid; </span></span>
<span id="cb8-1464"><a href="#cb8-1464" aria-hidden="true" tabindex="-1"></a><span class="ss">            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); </span></span>
<span id="cb8-1465"><a href="#cb8-1465" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 25px; </span></span>
<span id="cb8-1466"><a href="#cb8-1466" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 35px;</span></span>
<span id="cb8-1467"><a href="#cb8-1467" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);</span></span>
<span id="cb8-1468"><a href="#cb8-1468" aria-hidden="true" tabindex="-1"></a><span class="ss">            min-height: 400px;</span></span>
<span id="cb8-1469"><a href="#cb8-1469" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1470"><a href="#cb8-1470" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1471"><a href="#cb8-1471" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white; </span></span>
<span id="cb8-1472"><a href="#cb8-1472" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #e9ecef; </span></span>
<span id="cb8-1473"><a href="#cb8-1473" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 15px; </span></span>
<span id="cb8-1474"><a href="#cb8-1474" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 25px; </span></span>
<span id="cb8-1475"><a href="#cb8-1475" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.4s ease; </span></span>
<span id="cb8-1476"><a href="#cb8-1476" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer; </span></span>
<span id="cb8-1477"><a href="#cb8-1477" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: relative;</span></span>
<span id="cb8-1478"><a href="#cb8-1478" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 15px rgba(0,0,0,0.08);</span></span>
<span id="cb8-1479"><a href="#cb8-1479" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1480"><a href="#cb8-1480" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card:hover </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1481"><a href="#cb8-1481" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: translateY(-8px); </span></span>
<span id="cb8-1482"><a href="#cb8-1482" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 15px 35px rgba(0,0,0,0.15); </span></span>
<span id="cb8-1483"><a href="#cb8-1483" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb8-1484"><a href="#cb8-1484" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1485"><a href="#cb8-1485" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-header </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1486"><a href="#cb8-1486" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb8-1487"><a href="#cb8-1487" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between; </span></span>
<span id="cb8-1488"><a href="#cb8-1488" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: flex-start; </span></span>
<span id="cb8-1489"><a href="#cb8-1489" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 18px; </span></span>
<span id="cb8-1490"><a href="#cb8-1490" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1491"><a href="#cb8-1491" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-number </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1492"><a href="#cb8-1492" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #667eea, #764ba2); </span></span>
<span id="cb8-1493"><a href="#cb8-1493" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb8-1494"><a href="#cb8-1494" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 8px 16px; </span></span>
<span id="cb8-1495"><a href="#cb8-1495" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 20px; </span></span>
<span id="cb8-1496"><a href="#cb8-1496" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em; </span></span>
<span id="cb8-1497"><a href="#cb8-1497" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb8-1498"><a href="#cb8-1498" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);</span></span>
<span id="cb8-1499"><a href="#cb8-1499" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1500"><a href="#cb8-1500" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-source </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1501"><a href="#cb8-1501" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e3f2fd; </span></span>
<span id="cb8-1502"><a href="#cb8-1502" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #1976d2; </span></span>
<span id="cb8-1503"><a href="#cb8-1503" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 5px 12px; </span></span>
<span id="cb8-1504"><a href="#cb8-1504" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px; </span></span>
<span id="cb8-1505"><a href="#cb8-1505" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.85em; </span></span>
<span id="cb8-1506"><a href="#cb8-1506" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold; </span></span>
<span id="cb8-1507"><a href="#cb8-1507" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 10px;</span></span>
<span id="cb8-1508"><a href="#cb8-1508" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1509"><a href="#cb8-1509" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-title </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1510"><a href="#cb8-1510" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.3em; </span></span>
<span id="cb8-1511"><a href="#cb8-1511" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 600; </span></span>
<span id="cb8-1512"><a href="#cb8-1512" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50; </span></span>
<span id="cb8-1513"><a href="#cb8-1513" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 12px; </span></span>
<span id="cb8-1514"><a href="#cb8-1514" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.4;</span></span>
<span id="cb8-1515"><a href="#cb8-1515" aria-hidden="true" tabindex="-1"></a><span class="ss">            min-height: 3.6em;</span></span>
<span id="cb8-1516"><a href="#cb8-1516" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb8-1517"><a href="#cb8-1517" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1518"><a href="#cb8-1518" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-summary </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1519"><a href="#cb8-1519" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #6c757d; </span></span>
<span id="cb8-1520"><a href="#cb8-1520" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.95em; </span></span>
<span id="cb8-1521"><a href="#cb8-1521" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.5; </span></span>
<span id="cb8-1522"><a href="#cb8-1522" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 18px;</span></span>
<span id="cb8-1523"><a href="#cb8-1523" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: -webkit-box;</span></span>
<span id="cb8-1524"><a href="#cb8-1524" aria-hidden="true" tabindex="-1"></a><span class="ss">            -webkit-line-clamp: 3;</span></span>
<span id="cb8-1525"><a href="#cb8-1525" aria-hidden="true" tabindex="-1"></a><span class="ss">            -webkit-box-orient: vertical;</span></span>
<span id="cb8-1526"><a href="#cb8-1526" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb8-1527"><a href="#cb8-1527" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb8-1528"><a href="#cb8-1528" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1529"><a href="#cb8-1529" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-meta </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1530"><a href="#cb8-1530" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb8-1531"><a href="#cb8-1531" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between; </span></span>
<span id="cb8-1532"><a href="#cb8-1532" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.85em; </span></span>
<span id="cb8-1533"><a href="#cb8-1533" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #868e96; </span></span>
<span id="cb8-1534"><a href="#cb8-1534" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-top: 1px solid #e9ecef; </span></span>
<span id="cb8-1535"><a href="#cb8-1535" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-top: 18px;</span></span>
<span id="cb8-1536"><a href="#cb8-1536" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1537"><a href="#cb8-1537" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-actions </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1538"><a href="#cb8-1538" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: absolute; </span></span>
<span id="cb8-1539"><a href="#cb8-1539" aria-hidden="true" tabindex="-1"></a><span class="ss">            top: 20px; </span></span>
<span id="cb8-1540"><a href="#cb8-1540" aria-hidden="true" tabindex="-1"></a><span class="ss">            right: 20px; </span></span>
<span id="cb8-1541"><a href="#cb8-1541" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb8-1542"><a href="#cb8-1542" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 8px; </span></span>
<span id="cb8-1543"><a href="#cb8-1543" aria-hidden="true" tabindex="-1"></a><span class="ss">            opacity: 0; </span></span>
<span id="cb8-1544"><a href="#cb8-1544" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: opacity 0.3s ease; </span></span>
<span id="cb8-1545"><a href="#cb8-1545" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1546"><a href="#cb8-1546" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card:hover .card-actions </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1547"><a href="#cb8-1547" aria-hidden="true" tabindex="-1"></a><span class="ss">            opacity: 1; </span></span>
<span id="cb8-1548"><a href="#cb8-1548" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1549"><a href="#cb8-1549" aria-hidden="true" tabindex="-1"></a><span class="ss">        .action-btn </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1550"><a href="#cb8-1550" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white; </span></span>
<span id="cb8-1551"><a href="#cb8-1551" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 2px solid #e9ecef; </span></span>
<span id="cb8-1552"><a href="#cb8-1552" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px; </span></span>
<span id="cb8-1553"><a href="#cb8-1553" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 6px 12px; </span></span>
<span id="cb8-1554"><a href="#cb8-1554" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.8em; </span></span>
<span id="cb8-1555"><a href="#cb8-1555" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer; </span></span>
<span id="cb8-1556"><a href="#cb8-1556" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.3s ease;</span></span>
<span id="cb8-1557"><a href="#cb8-1557" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb8-1558"><a href="#cb8-1558" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb8-1559"><a href="#cb8-1559" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333;</span></span>
<span id="cb8-1560"><a href="#cb8-1560" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb8-1561"><a href="#cb8-1561" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1562"><a href="#cb8-1562" aria-hidden="true" tabindex="-1"></a><span class="ss">        .action-btn:hover </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1563"><a href="#cb8-1563" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #667eea; </span></span>
<span id="cb8-1564"><a href="#cb8-1564" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb8-1565"><a href="#cb8-1565" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb8-1566"><a href="#cb8-1566" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: scale(1.05);</span></span>
<span id="cb8-1567"><a href="#cb8-1567" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1568"><a href="#cb8-1568" aria-hidden="true" tabindex="-1"></a><span class="ss">        .recent-badge </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1569"><a href="#cb8-1569" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #ff6b6b; </span></span>
<span id="cb8-1570"><a href="#cb8-1570" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb8-1571"><a href="#cb8-1571" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 3px 10px; </span></span>
<span id="cb8-1572"><a href="#cb8-1572" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px; </span></span>
<span id="cb8-1573"><a href="#cb8-1573" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.75em; </span></span>
<span id="cb8-1574"><a href="#cb8-1574" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 8px;</span></span>
<span id="cb8-1575"><a href="#cb8-1575" aria-hidden="true" tabindex="-1"></a><span class="ss">            animation: pulse 2s infinite;</span></span>
<span id="cb8-1576"><a href="#cb8-1576" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1577"><a href="#cb8-1577" aria-hidden="true" tabindex="-1"></a><span class="ss">        .no-results </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1578"><a href="#cb8-1578" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center; </span></span>
<span id="cb8-1579"><a href="#cb8-1579" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 60px 20px; </span></span>
<span id="cb8-1580"><a href="#cb8-1580" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #6c757d;</span></span>
<span id="cb8-1581"><a href="#cb8-1581" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.1em;</span></span>
<span id="cb8-1582"><a href="#cb8-1582" aria-hidden="true" tabindex="-1"></a><span class="ss">            grid-column: 1 / -1;</span></span>
<span id="cb8-1583"><a href="#cb8-1583" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1584"><a href="#cb8-1584" aria-hidden="true" tabindex="-1"></a><span class="ss">        @keyframes pulse </span><span class="ch">{{</span></span>
<span id="cb8-1585"><a href="#cb8-1585" aria-hidden="true" tabindex="-1"></a><span class="ss">            0% </span><span class="ch">{{</span><span class="ss"> transform: scale(1); </span><span class="ch">}}</span></span>
<span id="cb8-1586"><a href="#cb8-1586" aria-hidden="true" tabindex="-1"></a><span class="ss">            50% </span><span class="ch">{{</span><span class="ss"> transform: scale(1.05); </span><span class="ch">}}</span></span>
<span id="cb8-1587"><a href="#cb8-1587" aria-hidden="true" tabindex="-1"></a><span class="ss">            100% </span><span class="ch">{{</span><span class="ss"> transform: scale(1); </span><span class="ch">}}</span></span>
<span id="cb8-1588"><a href="#cb8-1588" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1589"><a href="#cb8-1589" aria-hidden="true" tabindex="-1"></a><span class="ss">        .category-badge </span><span class="ch">{{</span></span>
<span id="cb8-1590"><a href="#cb8-1590" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb8-1591"><a href="#cb8-1591" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e3f2fd;</span></span>
<span id="cb8-1592"><a href="#cb8-1592" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #1976d2;</span></span>
<span id="cb8-1593"><a href="#cb8-1593" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 10px;</span></span>
<span id="cb8-1594"><a href="#cb8-1594" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px;</span></span>
<span id="cb8-1595"><a href="#cb8-1595" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.8em;</span></span>
<span id="cb8-1596"><a href="#cb8-1596" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 8px;</span></span>
<span id="cb8-1597"><a href="#cb8-1597" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb8-1598"><a href="#cb8-1598" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1599"><a href="#cb8-1599" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-1600"><a href="#cb8-1600" aria-hidden="true" tabindex="-1"></a><span class="ss">        .direct-link </span><span class="ch">{{</span></span>
<span id="cb8-1601"><a href="#cb8-1601" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb8-1602"><a href="#cb8-1602" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 5px;</span></span>
<span id="cb8-1603"><a href="#cb8-1603" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 8px 15px;</span></span>
<span id="cb8-1604"><a href="#cb8-1604" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #28a745;</span></span>
<span id="cb8-1605"><a href="#cb8-1605" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb8-1606"><a href="#cb8-1606" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb8-1607"><a href="#cb8-1607" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 5px;</span></span>
<span id="cb8-1608"><a href="#cb8-1608" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb8-1609"><a href="#cb8-1609" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1610"><a href="#cb8-1610" aria-hidden="true" tabindex="-1"></a><span class="ss">        .direct-link:hover </span><span class="ch">{{</span></span>
<span id="cb8-1611"><a href="#cb8-1611" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #218838;</span></span>
<span id="cb8-1612"><a href="#cb8-1612" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1613"><a href="#cb8-1613" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-1614"><a href="#cb8-1614" aria-hidden="true" tabindex="-1"></a><span class="ss">        .html-btn </span><span class="ch">{{</span></span>
<span id="cb8-1615"><a href="#cb8-1615" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #17a2b8;</span></span>
<span id="cb8-1616"><a href="#cb8-1616" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb8-1617"><a href="#cb8-1617" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1618"><a href="#cb8-1618" aria-hidden="true" tabindex="-1"></a><span class="ss">        .html-btn:hover </span><span class="ch">{{</span></span>
<span id="cb8-1619"><a href="#cb8-1619" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #138496;</span></span>
<span id="cb8-1620"><a href="#cb8-1620" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1621"><a href="#cb8-1621" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-1622"><a href="#cb8-1622" aria-hidden="true" tabindex="-1"></a><span class="ss">        .pdf-btn </span><span class="ch">{{</span></span>
<span id="cb8-1623"><a href="#cb8-1623" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #dc3545;</span></span>
<span id="cb8-1624"><a href="#cb8-1624" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb8-1625"><a href="#cb8-1625" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1626"><a href="#cb8-1626" aria-hidden="true" tabindex="-1"></a><span class="ss">        .pdf-btn:hover </span><span class="ch">{{</span></span>
<span id="cb8-1627"><a href="#cb8-1627" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #c82333;</span></span>
<span id="cb8-1628"><a href="#cb8-1628" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1629"><a href="#cb8-1629" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb8-1630"><a href="#cb8-1630" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb8-1631"><a href="#cb8-1631" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb8-1632"><a href="#cb8-1632" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb8-1633"><a href="#cb8-1633" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;header&quot;&gt;</span></span>
<span id="cb8-1634"><a href="#cb8-1634" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;h1&gt;üìö √çndice Combinado de Conversas&lt;/h1&gt;</span></span>
<span id="cb8-1635"><a href="#cb8-1635" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;p&gt;Qwen3 ‚Ä¢ ChatGPT ‚Ä¢ DeepSeek ‚Ä¢ Grok ‚Ä¢ COM HTML (Pandoc + MathJax)&lt;/p&gt;</span></span>
<span id="cb8-1636"><a href="#cb8-1636" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div class=&quot;stats&quot;&gt;</span></span>
<span id="cb8-1637"><a href="#cb8-1637" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb8-1638"><a href="#cb8-1638" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Total:&lt;/strong&gt; &lt;span id=&quot;total-count&quot;&gt;</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">&lt;/span&gt; conversas</span></span>
<span id="cb8-1639"><a href="#cb8-1639" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb8-1640"><a href="#cb8-1640" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb8-1641"><a href="#cb8-1641" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Ordena√ß√£o:&lt;/strong&gt; Mais Recentes Primeiro</span></span>
<span id="cb8-1642"><a href="#cb8-1642" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb8-1643"><a href="#cb8-1643" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb8-1644"><a href="#cb8-1644" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Atualizado:&lt;/strong&gt; </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">.</span>strftime(<span class="st">&#39;</span><span class="sc">%d</span><span class="st">/%m/%Y %H:%M&#39;</span>)<span class="sc">}</span></span>
<span id="cb8-1645"><a href="#cb8-1645" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb8-1646"><a href="#cb8-1646" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb8-1647"><a href="#cb8-1647" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb8-1648"><a href="#cb8-1648" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-1649"><a href="#cb8-1649" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;search-section&quot;&gt;</span></span>
<span id="cb8-1650"><a href="#cb8-1650" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;input type=&quot;text&quot; id=&quot;searchInput&quot; class=&quot;search-box&quot; placeholder=&quot;üîç Pesquisar por t√≠tulo, conte√∫do ou categoria...&quot;&gt;</span></span>
<span id="cb8-1651"><a href="#cb8-1651" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb8-1652"><a href="#cb8-1652" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-1653"><a href="#cb8-1653" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;filter-section&quot;&gt;</span></span>
<span id="cb8-1654"><a href="#cb8-1654" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;button class=&quot;filter-btn active&quot; data-filter=&quot;todas&quot;&gt;Todas (</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">)&lt;/button&gt;</span></span>
<span id="cb8-1655"><a href="#cb8-1655" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb8-1656"><a href="#cb8-1656" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-1657"><a href="#cb8-1657" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category, count <span class="kw">in</span> category_stats.items():</span>
<span id="cb8-1658"><a href="#cb8-1658" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">+=</span> <span class="ss">f&#39;&lt;button class=&quot;filter-btn&quot; data-filter=&quot;</span><span class="sc">{</span>category<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot;&gt;</span><span class="sc">{</span>category<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">)&lt;/button&gt;</span><span class="ch">\n</span><span class="ss">&#39;</span></span>
<span id="cb8-1659"><a href="#cb8-1659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1660"><a href="#cb8-1660" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb8-1661"><a href="#cb8-1661" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb8-1662"><a href="#cb8-1662" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb8-1663"><a href="#cb8-1663" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div style=&quot;text-align: center; padding: 15px; background: #e9ecef; border-bottom: 1px solid #ddd;&quot;&gt;</span></span>
<span id="cb8-1664"><a href="#cb8-1664" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;strong&gt;Acesso R√°pido:&lt;/strong&gt;</span></span>
<span id="cb8-1665"><a href="#cb8-1665" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_markdown/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìÅ Markdown&lt;/a&gt;</span></span>
<span id="cb8-1666"><a href="#cb8-1666" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_html/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üåê HTML&lt;/a&gt;</span></span>
<span id="cb8-1667"><a href="#cb8-1667" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_pdfs/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìÑ PDF&lt;/a&gt;</span></span>
<span id="cb8-1668"><a href="#cb8-1668" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_json/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìã JSON&lt;/a&gt;</span></span>
<span id="cb8-1669"><a href="#cb8-1669" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb8-1670"><a href="#cb8-1670" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb8-1671"><a href="#cb8-1671" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div class=&quot;conversations-grid&quot; id=&quot;conversationsGrid&quot;&gt;</span></span>
<span id="cb8-1672"><a href="#cb8-1672" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb8-1673"><a href="#cb8-1673" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-1674"><a href="#cb8-1674" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.all_conversations):</span>
<span id="cb8-1675"><a href="#cb8-1675" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb8-1676"><a href="#cb8-1676" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb8-1677"><a href="#cb8-1677" aria-hidden="true" tabindex="-1"></a>            recent_badge <span class="op">=</span> <span class="st">&quot;&lt;span class=&#39;recent-badge&#39;&gt;NOVO&lt;/span&gt;&quot;</span> <span class="cf">if</span> i <span class="op">&lt;</span> <span class="dv">5</span> <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb8-1678"><a href="#cb8-1678" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1679"><a href="#cb8-1679" aria-hidden="true" tabindex="-1"></a>            summary <span class="op">=</span> conv.get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;Sem resumo dispon√≠vel&#39;</span>)</span>
<span id="cb8-1680"><a href="#cb8-1680" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(summary) <span class="op">&gt;</span> <span class="dv">150</span>:</span>
<span id="cb8-1681"><a href="#cb8-1681" aria-hidden="true" tabindex="-1"></a>                summary <span class="op">=</span> summary[:<span class="dv">150</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span></span>
<span id="cb8-1682"><a href="#cb8-1682" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1683"><a href="#cb8-1683" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">+=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb8-1684"><a href="#cb8-1684" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div class=&quot;conversation-card&quot; data-title=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&quot; data-summary=&quot;</span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&quot; data-source=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot; data-category=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;category&#39;</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot;&gt;</span></span>
<span id="cb8-1685"><a href="#cb8-1685" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-header&quot;&gt;</span></span>
<span id="cb8-1686"><a href="#cb8-1686" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;card-number&quot;&gt;#</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>recent_badge<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb8-1687"><a href="#cb8-1687" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;card-actions&quot;&gt;</span></span>
<span id="cb8-1688"><a href="#cb8-1688" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_markdown/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.md&quot; class=&quot;action-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üìÑ MD&lt;/a&gt;</span></span>
<span id="cb8-1689"><a href="#cb8-1689" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_html/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&quot; class=&quot;action-btn html-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üåê HTML&lt;/a&gt;</span></span>
<span id="cb8-1690"><a href="#cb8-1690" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_pdfs/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.pdf&quot; class=&quot;action-btn pdf-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üìä PDF&lt;/a&gt;</span></span>
<span id="cb8-1691"><a href="#cb8-1691" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;/div&gt;</span></span>
<span id="cb8-1692"><a href="#cb8-1692" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb8-1693"><a href="#cb8-1693" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-title&quot; onclick=&quot;openHTML(&#39;</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&#39;)&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb8-1694"><a href="#cb8-1694" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div&gt;</span></span>
<span id="cb8-1695"><a href="#cb8-1695" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span class=&quot;card-source&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb8-1696"><a href="#cb8-1696" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span class=&quot;category-badge&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;category&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb8-1697"><a href="#cb8-1697" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb8-1698"><a href="#cb8-1698" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-summary&quot; onclick=&quot;openHTML(&#39;</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&#39;)&quot;&gt;</span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb8-1699"><a href="#cb8-1699" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-meta&quot;&gt;</span></span>
<span id="cb8-1700"><a href="#cb8-1700" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span&gt;üìÖ </span><span class="sc">{</span>conv<span class="sc">.</span>get(<span class="st">&#39;updated_at&#39;</span>) <span class="kw">or</span> conv<span class="sc">.</span>get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb8-1701"><a href="#cb8-1701" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span&gt;üí¨ </span><span class="sc">{</span><span class="bu">len</span>(conv[<span class="st">&#39;messages&#39;</span>])<span class="sc">}</span><span class="ss"> mensagens&lt;/span&gt;</span></span>
<span id="cb8-1702"><a href="#cb8-1702" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb8-1703"><a href="#cb8-1703" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb8-1704"><a href="#cb8-1704" aria-hidden="true" tabindex="-1"></a><span class="ss">            &quot;&quot;&quot;</span></span>
<span id="cb8-1705"><a href="#cb8-1705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1706"><a href="#cb8-1706" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb8-1707"><a href="#cb8-1707" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb8-1708"><a href="#cb8-1708" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/div&gt;</span></span>
<span id="cb8-1709"><a href="#cb8-1709" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb8-1710"><a href="#cb8-1710" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;script&gt;</span></span>
<span id="cb8-1711"><a href="#cb8-1711" aria-hidden="true" tabindex="-1"></a><span class="st">        let currentFilter = &#39;todas&#39;;</span></span>
<span id="cb8-1712"><a href="#cb8-1712" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb8-1713"><a href="#cb8-1713" aria-hidden="true" tabindex="-1"></a><span class="st">        document.addEventListener(&#39;DOMContentLoaded&#39;, function() {</span></span>
<span id="cb8-1714"><a href="#cb8-1714" aria-hidden="true" tabindex="-1"></a><span class="st">            updateStats();</span></span>
<span id="cb8-1715"><a href="#cb8-1715" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb8-1716"><a href="#cb8-1716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1717"><a href="#cb8-1717" aria-hidden="true" tabindex="-1"></a><span class="st">        document.querySelectorAll(&#39;.filter-btn&#39;).forEach(btn =&gt; {</span></span>
<span id="cb8-1718"><a href="#cb8-1718" aria-hidden="true" tabindex="-1"></a><span class="st">            btn.addEventListener(&#39;click&#39;, () =&gt; {</span></span>
<span id="cb8-1719"><a href="#cb8-1719" aria-hidden="true" tabindex="-1"></a><span class="st">                document.querySelectorAll(&#39;.filter-btn&#39;).forEach(b =&gt; b.classList.remove(&#39;active&#39;));</span></span>
<span id="cb8-1720"><a href="#cb8-1720" aria-hidden="true" tabindex="-1"></a><span class="st">                btn.classList.add(&#39;active&#39;);</span></span>
<span id="cb8-1721"><a href="#cb8-1721" aria-hidden="true" tabindex="-1"></a><span class="st">                currentFilter = btn.getAttribute(&#39;data-filter&#39;);</span></span>
<span id="cb8-1722"><a href="#cb8-1722" aria-hidden="true" tabindex="-1"></a><span class="st">                filterConversations();</span></span>
<span id="cb8-1723"><a href="#cb8-1723" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb8-1724"><a href="#cb8-1724" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb8-1725"><a href="#cb8-1725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1726"><a href="#cb8-1726" aria-hidden="true" tabindex="-1"></a><span class="st">        document.getElementById(&#39;searchInput&#39;).addEventListener(&#39;input&#39;, filterConversations);</span></span>
<span id="cb8-1727"><a href="#cb8-1727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1728"><a href="#cb8-1728" aria-hidden="true" tabindex="-1"></a><span class="st">        function filterConversations() {</span></span>
<span id="cb8-1729"><a href="#cb8-1729" aria-hidden="true" tabindex="-1"></a><span class="st">            const term = document.getElementById(&#39;searchInput&#39;).value.toLowerCase();</span></span>
<span id="cb8-1730"><a href="#cb8-1730" aria-hidden="true" tabindex="-1"></a><span class="st">            const cards = document.querySelectorAll(&#39;.conversation-card&#39;);</span></span>
<span id="cb8-1731"><a href="#cb8-1731" aria-hidden="true" tabindex="-1"></a><span class="st">            let visible = 0;</span></span>
<span id="cb8-1732"><a href="#cb8-1732" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-1733"><a href="#cb8-1733" aria-hidden="true" tabindex="-1"></a><span class="st">            cards.forEach(card =&gt; {</span></span>
<span id="cb8-1734"><a href="#cb8-1734" aria-hidden="true" tabindex="-1"></a><span class="st">                const title = card.getAttribute(&#39;data-title&#39;).toLowerCase();</span></span>
<span id="cb8-1735"><a href="#cb8-1735" aria-hidden="true" tabindex="-1"></a><span class="st">                const summary = card.getAttribute(&#39;data-summary&#39;).toLowerCase();</span></span>
<span id="cb8-1736"><a href="#cb8-1736" aria-hidden="true" tabindex="-1"></a><span class="st">                const source = card.getAttribute(&#39;data-source&#39;).toLowerCase();</span></span>
<span id="cb8-1737"><a href="#cb8-1737" aria-hidden="true" tabindex="-1"></a><span class="st">                const category = card.getAttribute(&#39;data-category&#39;).toLowerCase();</span></span>
<span id="cb8-1738"><a href="#cb8-1738" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb8-1739"><a href="#cb8-1739" aria-hidden="true" tabindex="-1"></a><span class="st">                const matchesSearch = (title.includes(term) || summary.includes(term) || category.includes(term) || source.includes(term));</span></span>
<span id="cb8-1740"><a href="#cb8-1740" aria-hidden="true" tabindex="-1"></a><span class="st">                const matchesCategory = (currentFilter === &#39;todas&#39; || category === currentFilter);</span></span>
<span id="cb8-1741"><a href="#cb8-1741" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb8-1742"><a href="#cb8-1742" aria-hidden="true" tabindex="-1"></a><span class="st">                if (matchesSearch &amp;&amp; matchesCategory) {</span></span>
<span id="cb8-1743"><a href="#cb8-1743" aria-hidden="true" tabindex="-1"></a><span class="st">                    card.style.display = &#39;block&#39;;</span></span>
<span id="cb8-1744"><a href="#cb8-1744" aria-hidden="true" tabindex="-1"></a><span class="st">                    visible++;</span></span>
<span id="cb8-1745"><a href="#cb8-1745" aria-hidden="true" tabindex="-1"></a><span class="st">                } else {</span></span>
<span id="cb8-1746"><a href="#cb8-1746" aria-hidden="true" tabindex="-1"></a><span class="st">                    card.style.display = &#39;none&#39;;</span></span>
<span id="cb8-1747"><a href="#cb8-1747" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb8-1748"><a href="#cb8-1748" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb8-1749"><a href="#cb8-1749" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-1750"><a href="#cb8-1750" aria-hidden="true" tabindex="-1"></a><span class="st">            updateStats(visible);</span></span>
<span id="cb8-1751"><a href="#cb8-1751" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-1752"><a href="#cb8-1752" aria-hidden="true" tabindex="-1"></a><span class="st">            const grid = document.getElementById(&#39;conversationsGrid&#39;);</span></span>
<span id="cb8-1753"><a href="#cb8-1753" aria-hidden="true" tabindex="-1"></a><span class="st">            const noResults = document.getElementById(&#39;no-results-message&#39;);</span></span>
<span id="cb8-1754"><a href="#cb8-1754" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-1755"><a href="#cb8-1755" aria-hidden="true" tabindex="-1"></a><span class="st">            if (visible === 0) {</span></span>
<span id="cb8-1756"><a href="#cb8-1756" aria-hidden="true" tabindex="-1"></a><span class="st">                if (!noResults) {</span></span>
<span id="cb8-1757"><a href="#cb8-1757" aria-hidden="true" tabindex="-1"></a><span class="st">                    const noResultsMsg = document.createElement(&#39;div&#39;);</span></span>
<span id="cb8-1758"><a href="#cb8-1758" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.id = &#39;no-results-message&#39;;</span></span>
<span id="cb8-1759"><a href="#cb8-1759" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.className = &#39;no-results&#39;;</span></span>
<span id="cb8-1760"><a href="#cb8-1760" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.innerHTML = &#39;üîç Nenhuma conversa encontrada. Tente ajustar os filtros ou a pesquisa.&#39;;</span></span>
<span id="cb8-1761"><a href="#cb8-1761" aria-hidden="true" tabindex="-1"></a><span class="st">                    grid.appendChild(noResultsMsg);</span></span>
<span id="cb8-1762"><a href="#cb8-1762" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb8-1763"><a href="#cb8-1763" aria-hidden="true" tabindex="-1"></a><span class="st">            } else if (noResults) {</span></span>
<span id="cb8-1764"><a href="#cb8-1764" aria-hidden="true" tabindex="-1"></a><span class="st">                noResults.remove();</span></span>
<span id="cb8-1765"><a href="#cb8-1765" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-1766"><a href="#cb8-1766" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb8-1767"><a href="#cb8-1767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1768"><a href="#cb8-1768" aria-hidden="true" tabindex="-1"></a><span class="st">        function updateStats(visibleCount = null) {</span></span>
<span id="cb8-1769"><a href="#cb8-1769" aria-hidden="true" tabindex="-1"></a><span class="st">            const totalElement = document.getElementById(&#39;total-count&#39;);</span></span>
<span id="cb8-1770"><a href="#cb8-1770" aria-hidden="true" tabindex="-1"></a><span class="st">            if (visibleCount !== null) {</span></span>
<span id="cb8-1771"><a href="#cb8-1771" aria-hidden="true" tabindex="-1"></a><span class="st">                totalElement.textContent = visibleCount;</span></span>
<span id="cb8-1772"><a href="#cb8-1772" aria-hidden="true" tabindex="-1"></a><span class="st">            } else {</span></span>
<span id="cb8-1773"><a href="#cb8-1773" aria-hidden="true" tabindex="-1"></a><span class="st">                totalElement.textContent = &quot;&quot;&quot;</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(<span class="va">self</span>.all_conversations)) <span class="op">+</span> <span class="st">&quot;&quot;&quot;;</span></span>
<span id="cb8-1774"><a href="#cb8-1774" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-1775"><a href="#cb8-1775" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb8-1776"><a href="#cb8-1776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1777"><a href="#cb8-1777" aria-hidden="true" tabindex="-1"></a><span class="st">        function openHTML(filename) {</span></span>
<span id="cb8-1778"><a href="#cb8-1778" aria-hidden="true" tabindex="-1"></a><span class="st">            const htmlUrl = &#39;combined_html/&#39; + filename;</span></span>
<span id="cb8-1779"><a href="#cb8-1779" aria-hidden="true" tabindex="-1"></a><span class="st">            console.log(&#39;Abrindo HTML:&#39;, htmlUrl);</span></span>
<span id="cb8-1780"><a href="#cb8-1780" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(htmlUrl, &#39;_blank&#39;);</span></span>
<span id="cb8-1781"><a href="#cb8-1781" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb8-1782"><a href="#cb8-1782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1783"><a href="#cb8-1783" aria-hidden="true" tabindex="-1"></a><span class="st">        function openMD(filename) {</span></span>
<span id="cb8-1784"><a href="#cb8-1784" aria-hidden="true" tabindex="-1"></a><span class="st">            const mdUrl = &#39;combined_markdown/&#39; + filename;</span></span>
<span id="cb8-1785"><a href="#cb8-1785" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(mdUrl, &#39;_blank&#39;);</span></span>
<span id="cb8-1786"><a href="#cb8-1786" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb8-1787"><a href="#cb8-1787" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb8-1788"><a href="#cb8-1788" aria-hidden="true" tabindex="-1"></a><span class="st">        function openPDF(filename) {</span></span>
<span id="cb8-1789"><a href="#cb8-1789" aria-hidden="true" tabindex="-1"></a><span class="st">            const pdfFile = filename.replace(&#39;.html&#39;, &#39;.pdf&#39;);</span></span>
<span id="cb8-1790"><a href="#cb8-1790" aria-hidden="true" tabindex="-1"></a><span class="st">            const pdfUrl = &#39;combined_pdfs/&#39; + pdfFile;</span></span>
<span id="cb8-1791"><a href="#cb8-1791" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(pdfUrl, &#39;_blank&#39;);</span></span>
<span id="cb8-1792"><a href="#cb8-1792" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb8-1793"><a href="#cb8-1793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1794"><a href="#cb8-1794" aria-hidden="true" tabindex="-1"></a><span class="st">        document.addEventListener(&#39;keydown&#39;, function(e) {</span></span>
<span id="cb8-1795"><a href="#cb8-1795" aria-hidden="true" tabindex="-1"></a><span class="st">            if (e.key === &#39;Escape&#39;) {</span></span>
<span id="cb8-1796"><a href="#cb8-1796" aria-hidden="true" tabindex="-1"></a><span class="st">                document.getElementById(&#39;searchInput&#39;).value = &#39;&#39;;</span></span>
<span id="cb8-1797"><a href="#cb8-1797" aria-hidden="true" tabindex="-1"></a><span class="st">                filterConversations();</span></span>
<span id="cb8-1798"><a href="#cb8-1798" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-1799"><a href="#cb8-1799" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb8-1800"><a href="#cb8-1800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1801"><a href="#cb8-1801" aria-hidden="true" tabindex="-1"></a><span class="st">        document.querySelectorAll(&#39;.conversation-card&#39;).forEach(card =&gt; {</span></span>
<span id="cb8-1802"><a href="#cb8-1802" aria-hidden="true" tabindex="-1"></a><span class="st">            card.addEventListener(&#39;click&#39;, function(e) {</span></span>
<span id="cb8-1803"><a href="#cb8-1803" aria-hidden="true" tabindex="-1"></a><span class="st">                if (e.target.closest(&#39;.action-btn&#39;)) {</span></span>
<span id="cb8-1804"><a href="#cb8-1804" aria-hidden="true" tabindex="-1"></a><span class="st">                    return;</span></span>
<span id="cb8-1805"><a href="#cb8-1805" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb8-1806"><a href="#cb8-1806" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb8-1807"><a href="#cb8-1807" aria-hidden="true" tabindex="-1"></a><span class="st">                const htmlBtn = this.querySelector(&#39;a.html-btn&#39;);</span></span>
<span id="cb8-1808"><a href="#cb8-1808" aria-hidden="true" tabindex="-1"></a><span class="st">                if (htmlBtn) {</span></span>
<span id="cb8-1809"><a href="#cb8-1809" aria-hidden="true" tabindex="-1"></a><span class="st">                    const htmlUrl = htmlBtn.getAttribute(&#39;href&#39;);</span></span>
<span id="cb8-1810"><a href="#cb8-1810" aria-hidden="true" tabindex="-1"></a><span class="st">                    window.open(htmlUrl, &#39;_blank&#39;);</span></span>
<span id="cb8-1811"><a href="#cb8-1811" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb8-1812"><a href="#cb8-1812" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb8-1813"><a href="#cb8-1813" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb8-1814"><a href="#cb8-1814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1815"><a href="#cb8-1815" aria-hidden="true" tabindex="-1"></a><span class="st">        document.getElementById(&#39;searchInput&#39;).focus();</span></span>
<span id="cb8-1816"><a href="#cb8-1816" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb8-1817"><a href="#cb8-1817" aria-hidden="true" tabindex="-1"></a><span class="st">        console.log(&#39;√çndice carregado com&#39;, &quot;&quot;&quot;</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(<span class="va">self</span>.all_conversations)) <span class="op">+</span> <span class="st">&quot;&quot;&quot;, &#39;conversas&#39;);</span></span>
<span id="cb8-1818"><a href="#cb8-1818" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/script&gt;</span></span>
<span id="cb8-1819"><a href="#cb8-1819" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/body&gt;</span></span>
<span id="cb8-1820"><a href="#cb8-1820" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/html&gt;</span></span>
<span id="cb8-1821"><a href="#cb8-1821" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb8-1822"><a href="#cb8-1822" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-1823"><a href="#cb8-1823" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.index_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1824"><a href="#cb8-1824" aria-hidden="true" tabindex="-1"></a>            f.write(html_content)</span>
<span id="cb8-1825"><a href="#cb8-1825" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ √çndice combinado criado: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1826"><a href="#cb8-1826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1827"><a href="#cb8-1827" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb8-1828"><a href="#cb8-1828" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser(</span>
<span id="cb8-1829"><a href="#cb8-1829" aria-hidden="true" tabindex="-1"></a>        description<span class="op">=</span><span class="st">&quot;Processa exporta√ß√µes combinadas com exporta√ß√£o HTML via Pandoc.&quot;</span></span>
<span id="cb8-1830"><a href="#cb8-1830" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-1831"><a href="#cb8-1831" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">&quot;--dry-run&quot;</span>, action<span class="op">=</span><span class="st">&quot;store_true&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Executa sem salvar arquivos&quot;</span>)</span>
<span id="cb8-1832"><a href="#cb8-1832" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">&quot;--force-overwrite&quot;</span>, action<span class="op">=</span><span class="st">&quot;store_true&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Substitui arquivos existentes&quot;</span>)</span>
<span id="cb8-1833"><a href="#cb8-1833" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-1834"><a href="#cb8-1834" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb8-1835"><a href="#cb8-1835" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-1836"><a href="#cb8-1836" aria-hidden="true" tabindex="-1"></a>    system <span class="op">=</span> CombinedFragmentsSystem(</span>
<span id="cb8-1837"><a href="#cb8-1837" aria-hidden="true" tabindex="-1"></a>        dry_run<span class="op">=</span>args.dry_run,</span>
<span id="cb8-1838"><a href="#cb8-1838" aria-hidden="true" tabindex="-1"></a>        force_overwrite<span class="op">=</span>args.force_overwrite</span>
<span id="cb8-1839"><a href="#cb8-1839" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-1840"><a href="#cb8-1840" aria-hidden="true" tabindex="-1"></a>    system.run()</span>
<span id="cb8-1841"><a href="#cb8-1841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1842"><a href="#cb8-1842" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb8-1843"><a href="#cb8-1843" aria-hidden="true" tabindex="-1"></a>    main()</span></code></pre></div>
<h2 data-number="1.5" id="principais-melhorias-implementadas"><span class="header-section-number">1.5</span> Principais melhorias
implementadas:</h2>
<h3 data-number="1.5.1" id="convers√£o-pandoc-otimizada"><span class="header-section-number">1.5.1</span> 1. <strong>Convers√£o Pandoc
Otimizada:</strong></h3>
<ul>
<li><code>--embed-resources</code> para embutir recursos</li>
<li><code>--highlight-style=pygments</code> para syntax
highlighting<br />
</li>
<li><code>--mathjax=assets/tex-mml-chtml.js</code> para MathJax
local</li>
<li>Extens√µes avan√ßadas do Markdown</li>
</ul>
<h3 data-number="1.5.2" id="mathjax-local-1"><span class="header-section-number">1.5.2</span> 2. <strong>MathJax
Local:</strong></h3>
<ul>
<li>Detecta automaticamente arquivo local</li>
<li>Fallback para CDN se necess√°rio</li>
<li>Configura√ß√£o MathJax otimizada</li>
</ul>
<h3 data-number="1.5.3" id="sistema-de-fallback-em-3-n√≠veis"><span class="header-section-number">1.5.3</span> 3. <strong>Sistema de
Fallback em 3 N√≠veis:</strong></h3>
<ul>
<li>Pandoc otimizado ‚Üí Pandoc b√°sico ‚Üí Fallback Python</li>
<li>Timeouts aprimorados</li>
</ul>
<h3 data-number="1.5.4" id="html-aprimorado-1"><span class="header-section-number">1.5.4</span> 4. <strong>HTML
Aprimorado:</strong></h3>
<ul>
<li>CSS responsivo e acess√≠vel</li>
<li>Viewport meta tag</li>
<li>Melhor syntax highlighting</li>
<li>Design moderno</li>
</ul>
<h3 data-number="1.5.5" id="configura√ß√£o-mathjax"><span class="header-section-number">1.5.5</span> 5. <strong>Configura√ß√£o
MathJax:</strong></h3>
<ul>
<li>Suporte a f√≥rmulas inline e display</li>
<li>Configura√ß√£o para melhor renderiza√ß√£o</li>
<li>Compatibilidade com c√≥digo e pre</li>
</ul>
<h3 data-number="1.5.6" id="comandos-recomendados-para-uso"><span class="header-section-number">1.5.6</span> Comandos recomendados para
uso:</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Executar o sistema</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> comb_fragments_system3_html_export.py</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Modo dry-run para teste</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> comb_fragments_system3_html_export.py <span class="at">--dry-run</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># For√ßar sobrescrita de arquivos</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> comb_fragments_system3_html_export.py <span class="at">--force-overwrite</span></span></code></pre></div>
<p>O sistema agora oferece convers√£o HTML significativamente melhorada
com suporte robusto a matem√°tica, c√≥digo e formata√ß√£o avan√ßada!</p>
<hr />
<h3 data-number="1.5.7" id="utilizador-2025-11-08-005544-deepseek-reasoner"><span class="header-section-number">1.5.7</span> üë§ Utilizador <em>(2025-11-08
00:55:44)</em> <em>[deepseek-reasoner]</em></h3>
<p>Pretendo a optimiza√ß√£o da convers√£o para html, pandoc com ‚Äìstandalone
‚Äìmathjax ‚Äìembed-resources ‚Äìsyntax-highlighting=pygments
‚Äìmathjax=assets/tex-mml-chtml.js e ‚Äìtable-of-contents ‚Äìtoc-depth=2
‚Äìnumber-sections ;</p>
<p>E o resultante agora: comb_fragments_system4_html_export.py
completo</p>
<hr />
<h3 data-number="1.5.8" id="deepseek-2025-11-08-005544-deepseek-reasoner"><span class="header-section-number">1.5.8</span> ü§ñ DeepSeek <em>(2025-11-08
00:55:44)</em> <em>[deepseek-reasoner]</em></h3>
<p>Vamos atualizar a fun√ß√£o <code>_convert_with_pandoc_optimized</code>
para incluir as novas op√ß√µes: ‚Äìtable-of-contents (ou ‚Äìtoc) ‚Äìtoc-depth=2
‚Äìnumber-sections</p>
<p>Al√©m disso, vamos ajustar o comando para usar a op√ß√£o
<code>--syntax-highlighting=pygments</code> (que √© equivalente a
<code>--highlight-style=pygments</code>).</p>
<p>Nota: A op√ß√£o <code>--embed-resources</code> √© experimental e pode
n√£o estar dispon√≠vel em todas as vers√µes do Pandoc. Vamos mant√™-la, mas
se causar problemas, podemos remov√™-la.</p>
<p>Vamos tamb√©m ajustar a fun√ß√£o <code>_convert_with_pandoc_basic</code>
para incluir as mesmas op√ß√µes, mas sem <code>--embed-resources</code>
para maior compatibilidade.</p>
<p>Al√©m disso, note que a op√ß√£o
<code>--mathjax=assets/tex-mml-chtml.js</code> j√° est√° sendo
tratada.</p>
<p>Vamos reorganizar o comando para que as op√ß√µes sejam colocadas de
forma consistente.</p>
<p>Vamos tamb√©m adicionar a op√ß√£o <code>--toc</code> (que √© a abrevia√ß√£o
de <code>--table-of-contents</code>) e <code>--toc-depth=2</code> e
<code>--number-sections</code>.</p>
<p>Vamos atualizar a fun√ß√£o <code>_convert_with_pandoc_optimized</code>
e <code>_convert_with_pandoc_basic</code> para incluir essas op√ß√µes.</p>
<p>Como a op√ß√£o <code>--embed-resources</code> pode n√£o ser suportada,
vamos tentar us√°-la apenas na vers√£o otimizada e, se falhar, tentar sem
ela.</p>
<p>No entanto, note que a op√ß√£o <code>--embed-resources</code> √©
suportada apenas no Pandoc 2.19+ e apenas para HTML. Se houver erro,
podemos remov√™-la.</p>
<p>Vamos tamb√©m ajustar o tempo de timeout para 180 segundos, pois as
op√ß√µes adicionais podem aumentar o tempo de processamento.</p>
<p>Vamos tamb√©m atualizar o m√©todo
<code>_create_enhanced_html_template</code> para incluir o Table of
Contents (TOC) e se√ß√µes numeradas. Mas note que o Pandoc j√° ir√° gerar o
TOC e a numera√ß√£o se usarmos as op√ß√µes.</p>
<p>Vamos ent√£o modificar as fun√ß√µes de convers√£o com Pandoc.</p>
<p>Vamos tamb√©m verificar se o Pandoc suporta
<code>--embed-resources</code>? Se n√£o, podemos remover.</p>
<p>Vamos fazer uma verifica√ß√£o da vers√£o do Pandoc para usar
<code>--embed-resources</code> apenas se a vers√£o for &gt;= 2.19.</p>
<p>No entanto, para simplificar, vamos assumir que o usu√°rio tem uma
vers√£o recente do Pandoc. Se n√£o, o fallback ser√° acionado.</p>
<p>Vamos ent√£o reescrever a fun√ß√£o
<code>_convert_with_pandoc_optimized</code>:</p>
<ol type="1">
<li><p>Verificar a vers√£o do Pandoc para ver se suporta
<code>--embed-resources</code> (opcional, por enquanto n√£o vamos
verificar, mas podemos adicionar um log de aviso se a vers√£o for
antiga).</p></li>
<li><p>Usar as op√ß√µes:</p>
<ul>
<li><code>--standalone</code></li>
<li><code>--mathjax=assets/tex-mml-chtml.js</code> (se o arquivo local
existir, sen√£o <code>--mathjax</code>)</li>
<li><code>--embed-resources</code></li>
<li><code>--highlight-style=pygments</code></li>
<li><code>--table-of-contents</code> (ou <code>--toc</code>)</li>
<li><code>--toc-depth=2</code></li>
<li><code>--number-sections</code></li>
</ul></li>
<li><p>Aumentar o timeout para 180 segundos.</p></li>
</ol>
<p>Vamos tamb√©m atualizar a fun√ß√£o
<code>_convert_with_pandoc_basic</code> para incluir as op√ß√µes de TOC e
numera√ß√£o, mas sem <code>--embed-resources</code>.</p>
<p>Vamos l√°:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_optimized(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Convers√£o OTIMIZADA com Pandoc usando MathJax local, recursos embutidos, TOC e numera√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Convertendo com Pandoc otimizado: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica se o arquivo MathJax local existe</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Comando otimizado para HTML5 com recursos embutidos, TOC e numera√ß√£o</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji+autolink_bare_uris+tex_math_single_backslash&#39;</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--embed-resources&#39;</span>,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--highlight-style=pygments&#39;</span>,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--table-of-contents&#39;</span>,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--toc-depth=2&#39;</span>,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--number-sections&#39;</span>,</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Remove argumentos vazios</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [arg <span class="cf">for</span> arg <span class="kw">in</span> command <span class="cf">if</span> arg]</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">180</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> result.stdout</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Aplica otimiza√ß√µes adicionais</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="va">self</span>._optimize_html_content(html_content)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> html_content</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc otimizado falhou, tentando m√©todo b√°sico: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> subprocess.TimeoutExpired:</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Timeout no Pandoc otimizado&quot;</span>)</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc otimizado: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_basic(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;M√©todo b√°sico de fallback para Pandoc com TOC e numera√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Tentando convers√£o b√°sica: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown&#39;</span>,</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--table-of-contents&#39;</span>,</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--toc-depth=2&#39;</span>,</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--number-sections&#39;</span>,</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">120</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._optimize_html_content(result.stdout)</span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc b√°sico falhou, usando fallback Python: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc b√°sico: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span></code></pre></div>
<p>Agora, note que o fallback Python (usando a biblioteca markdown) n√£o
suporta TOC e numera√ß√£o de se√ß√µes. Portanto, no fallback, vamos manter
como estava.</p>
<p>Vamos tamb√©m ajustar o CSS no m√©todo <code>_inject_custom_css</code>
para estilizar o TOC e as se√ß√µes numeradas. Mas o Pandoc j√° gera classes
CSS para o TOC, ent√£o podemos adicionar algum estilo.</p>
<p>Vamos adicionar no CSS customizado:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Estilo para o Table of Contents */</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#TOC</span> {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">background</span><span class="ch">:</span> <span class="cn">#f8f9fa</span><span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">border</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#e9ecef</span><span class="op">;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">border-radius</span><span class="ch">:</span> <span class="dv">5</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">padding</span><span class="ch">:</span> <span class="dv">15</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin-bottom</span><span class="ch">:</span> <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#TOC</span> ul {</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">list-style-type</span><span class="ch">:</span> <span class="dv">none</span><span class="op">;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">padding-left</span><span class="ch">:</span> <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="pp">#TOC</span> a {</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">text-decoration</span><span class="ch">:</span> <span class="dv">none</span><span class="op">;</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">color</span><span class="ch">:</span> <span class="cn">#495057</span><span class="op">;</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="pp">#TOC</span> a<span class="in">:hover</span> {</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">color</span><span class="ch">:</span> <span class="cn">#007bff</span><span class="op">;</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co">/* Estilo para numera√ß√£o de se√ß√µes */</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>body {</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">counter-reset</span><span class="ch">:</span> <span class="dv">section</span><span class="op">;</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>h1 {</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">counter-reset</span><span class="ch">:</span> <span class="dv">subsection</span><span class="op">;</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>h1<span class="in">:before</span> {</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">counter-increment</span><span class="ch">:</span> <span class="dv">section</span><span class="op">;</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">content</span><span class="ch">:</span> <span class="fu">counter(</span><span class="dv">section</span><span class="fu">)</span> <span class="st">&quot;. &quot;</span><span class="op">;</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>h2<span class="in">:before</span> {</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">counter-increment</span><span class="ch">:</span> <span class="dv">subsection</span><span class="op">;</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">content</span><span class="ch">:</span> <span class="fu">counter(</span><span class="dv">section</span><span class="fu">)</span> <span class="st">&quot;.&quot;</span> <span class="fu">counter(</span><span class="dv">subsection</span><span class="fu">)</span> <span class="st">&quot; &quot;</span><span class="op">;</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>No entanto, a numera√ß√£o de se√ß√µes √© feita pelo Pandoc com a op√ß√£o
<code>--number-sections</code>, que j√° adiciona n√∫meros √†s tags de
cabe√ßalho. O CSS acima seria redundante. O Pandoc usa a classe
<code>numbering</code> para isso, mas na verdade ele insere os n√∫meros
diretamente no HTML. Portanto, n√£o precisamos do CSS de numera√ß√£o.</p>
<p>Vamos ent√£o adicionar apenas o estilo para o TOC.</p>
<p>Vamos atualizar o m√©todo <code>_inject_custom_css</code> para incluir
o estilo do TOC.</p>
<p>Vamos tamb√©m ajustar o m√©todo
<code>_create_enhanced_html_template</code> para incluir o TOC? N√£o,
porque o TOC √© gerado pelo Pandoc. Ent√£o n√£o precisamos mudar o
template.</p>
<p>Vamos ent√£o apenas ajustar o CSS customizado para o TOC.</p>
<p>Vamos modificar o m√©todo <code>_inject_custom_css</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _inject_custom_css(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Injeta CSS personalizado para melhorar a apar√™ncia, incluindo TOC&quot;&quot;&quot;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>        custom_css <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;style&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para c√≥digo e matem√°tica */</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="st">            .math { display: block; text-align: center; margin: 1em 0; }</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="st">            .math inline { display: inline-block; }</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="st">            pre { border-left: 4px solid #3498db; background: #f8f9fa; }</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="st">            code { background: #e9ecef; padding: 0.2em 0.4em; border-radius: 3px; }</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias responsivas */</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 768px) {</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="st">                body { padding: 10px; font-size: 14px; }</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="st">                .container { padding: 15px; }</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="st">                pre { font-size: 12px; }</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para tabelas */</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="st">            table { width: 100%; border-collapse: collapse; margin: 1em 0; }</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="st">            th, td { border: 1px solid #dee2e6; padding: 0.75rem; }</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="st">            th { background-color: #3498db; color: white; }</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para blocos de cita√ß√£o */</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="st">            blockquote { </span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 1em 0; </span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 1em; </span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #6c757d;</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="st">                font-style: italic;</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Estilo para o Table of Contents */</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC {</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #f8f9fa;</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #e9ecef;</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 5px;</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 15px;</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-bottom: 20px;</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul {</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="st">                list-style-type: none;</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 20px;</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a {</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="st">                text-decoration: none;</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #495057;</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a:hover {</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #007bff;</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/style&gt;</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;/head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;/head&gt;&#39;</span>, <span class="ss">f&#39;</span><span class="sc">{</span>custom_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;&#39;</span>)</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>custom_css<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Se n√£o encontrar head, adiciona antes do body</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;&lt;body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;body&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>custom_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;&#39;</span>)</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>custom_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;</span><span class="ch">\n</span><span class="sc">{</span>html_content<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/body&gt;&#39;</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span></code></pre></div>
<p>Agora, vamos atualizar o arquivo completo com essas mudan√ßas.</p>
<p>Vamos tamb√©m ajustar o timeout na fun√ß√£o
<code>_convert_with_pandoc_optimized</code> para 180 segundos e na
fun√ß√£o <code>_convert_with_pandoc_basic</code> para 120 segundos.</p>
<p>Vamos tamb√©m verificar se a op√ß√£o <code>--embed-resources</code> est√°
causando problemas em vers√µes antigas do Pandoc. Se estiver, podemos
tentar detectar a vers√£o do Pandoc e n√£o usar
<code>--embed-resources</code> se a vers√£o for inferior a 2.19.</p>
<p>Vamos adicionar uma verifica√ß√£o da vers√£o do Pandoc:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _get_pandoc_version(<span class="va">self</span>) <span class="op">-&gt;</span> Optional[<span class="bu">tuple</span>]:</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Obt√©m a vers√£o do Pandoc&quot;&quot;&quot;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run([<span class="st">&#39;pandoc&#39;</span>, <span class="st">&#39;--version&#39;</span>], capture_output<span class="op">=</span><span class="va">True</span>, text<span class="op">=</span><span class="va">True</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                first_line <span class="op">=</span> result.stdout.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                version_str <span class="op">=</span> first_line.split()[<span class="dv">1</span>]</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="bu">tuple</span>(<span class="bu">map</span>(<span class="bu">int</span>, version_str.split(<span class="st">&#39;.&#39;</span>)))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_optimized(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Convers√£o OTIMIZADA com Pandoc usando MathJax local, recursos embutidos, TOC e numera√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Convertendo com Pandoc otimizado: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica se o arquivo MathJax local existe</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Comando otimizado para HTML5 com recursos embutidos, TOC e numera√ß√£o</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji+autolink_bare_uris+tex_math_single_backslash&#39;</span>,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--embed-resources&#39;</span>,</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--highlight-style=pygments&#39;</span>,</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--table-of-contents&#39;</span>,</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--toc-depth=2&#39;</span>,</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--number-sections&#39;</span>,</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica a vers√£o do Pandoc para --embed-resources (dispon√≠vel a partir da vers√£o 2.19)</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>            pandoc_version <span class="op">=</span> <span class="va">self</span>._get_pandoc_version()</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pandoc_version <span class="kw">and</span> pandoc_version <span class="op">&lt;</span> (<span class="dv">2</span>, <span class="dv">19</span>):</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>                command.remove(<span class="st">&#39;--embed-resources&#39;</span>)</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  Vers√£o do Pandoc anterior a 2.19, removendo --embed-resources&quot;</span>)</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Remove argumentos vazios</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [arg <span class="cf">for</span> arg <span class="kw">in</span> command <span class="cf">if</span> arg]</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">180</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> result.stdout</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Aplica otimiza√ß√µes adicionais</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="va">self</span>._optimize_html_content(html_content)</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> html_content</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc otimizado falhou, tentando m√©todo b√°sico: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> subprocess.TimeoutExpired:</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Timeout no Pandoc otimizado&quot;</span>)</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc otimizado: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span></code></pre></div>
<p>Agora, vamos incluir a fun√ß√£o <code>_get_pandoc_version</code> e a
verifica√ß√£o.</p>
<p>Vamos ent√£o gerar o arquivo completo com todas as altera√ß√µes.</p>
<p>Vamos tamb√©m atualizar o m√©todo
<code>_convert_with_pandoc_basic</code> para n√£o usar
<code>--embed-resources</code> (j√° que √© b√°sico) e manter as op√ß√µes de
TOC e numera√ß√£o.</p>
<p>Vamos agora gerar o c√≥digo completo do arquivo
<code>comb_fragments_system4_html_export.py</code>. Aqui est√° o arquivo
<code>comb_fragments_system4_html_export.py</code> completo com todas as
otimiza√ß√µes solicitadas:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># comb_fragments_system4_html_export.py</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> webbrowser</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tempfile</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> traceback</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Any, Optional</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> markdown</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CombinedFragmentsSystem:</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dry_run<span class="op">=</span><span class="va">False</span>, force_overwrite<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_dir <span class="op">=</span> Path(<span class="st">&quot;data&quot;</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dry_run <span class="op">=</span> dry_run</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.force_overwrite <span class="op">=</span> force_overwrite</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configurar logging</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>        logging.basicConfig(level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">&#39;</span>)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estrutura de pastas organizada</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dirs <span class="op">=</span> {</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;markdown&#39;</span>: <span class="st">&quot;combined_markdown&quot;</span>,</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_csv&quot;</span>, </span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_json&quot;</span>,</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;pdfs&#39;</span>: <span class="st">&quot;combined_pdfs&quot;</span>,</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;html&#39;</span>: <span class="st">&quot;combined_html&quot;</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.single_files <span class="op">=</span> {</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_all_conversations.csv&quot;</span>,</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_all_conversations.json&quot;</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.index_file <span class="op">=</span> <span class="st">&quot;index.html&quot;</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations <span class="op">=</span> []</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configura√ß√£o de processamento por fonte</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.processors <span class="op">=</span> {</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;qwen&#39;</span>: {</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chat-export.json&quot;</span>,</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_qwen_enhanced,</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;chatgpt&#39;</span>: {</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chatgpt.zip&quot;</span>, </span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_chatgpt,</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;deepseek&#39;</span>: {</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;deepseek_data.zip&quot;</span>,</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_deepseek,</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;grok&#39;</span>: {</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;grok.zip&quot;</span>,</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_grok,</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sanitize_filename(<span class="va">self</span>, text: <span class="bu">str</span>, max_len: <span class="bu">int</span> <span class="op">=</span> <span class="dv">50</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Sanitiza nomes de arquivo REMOVENDO ESPA√áOS e preservando emojis&quot;&quot;&quot;</span></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove caracteres inv√°lidos</span></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="dv">\s</span><span class="pp">]</span><span class="vs">&#39;</span>  <span class="co"># Inclui \s para remover espa√ßos</span></span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;_&#39;</span>, text)  <span class="co"># Substitui espa√ßos por underscores</span></span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;_</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39;_&#39;</span>, sanitized)  <span class="co"># Remove underscores duplicados</span></span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> sanitized.strip(<span class="st">&#39;_&#39;</span>)  <span class="co"># Remove underscores no in√≠cio e fim</span></span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Limita o comprimento</span></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(sanitized) <span class="op">&gt;</span> max_len:</span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Tenta cortar em um ponto l√≥gico (underscore)</span></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;_&#39;</span> <span class="kw">in</span> sanitized[:max_len]:</span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>                last_underscore <span class="op">=</span> sanitized[:max_len].rfind(<span class="st">&#39;_&#39;</span>)</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> last_underscore <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>                    sanitized <span class="op">=</span> sanitized[:last_underscore]</span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a>                sanitized <span class="op">=</span> sanitized[:max_len]</span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_original_title(<span class="va">self</span>, text: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Preserva o t√≠tulo original com espa√ßos, apenas removendo caracteres realmente inv√°lidos&quot;&quot;&quot;</span></span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove apenas caracteres realmente problem√°ticos, mantendo espa√ßos</span></span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="pp">]</span><span class="vs">&#39;</span></span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;&#39;</span>, text)</span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;</span><span class="dv">\s</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39; &#39;</span>, sanitized.strip())</span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_special_content(<span class="va">self</span>, content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Preserva f√≥rmulas matem√°ticas, c√≥digo e formata√ß√£o especial&quot;&quot;&quot;</span></span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;&quot;</span></span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a>        preserved_content <span class="op">=</span> content</span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Corrige problemas com barras invertidas em LaTeX</span></span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a>        latex_corrections <span class="op">=</span> {</span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ärac&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">frac&#39;</span>,</span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Çarepsilon&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">varepsilon&#39;</span>,</span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ç&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span>,</span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ä&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span></span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-127"><a href="#cb14-127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> wrong, correct <span class="kw">in</span> latex_corrections.items():</span>
<span id="cb14-128"><a href="#cb14-128" aria-hidden="true" tabindex="-1"></a>            preserved_content <span class="op">=</span> preserved_content.replace(wrong, correct)</span>
<span id="cb14-129"><a href="#cb14-129" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-130"><a href="#cb14-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> preserved_content</span>
<span id="cb14-131"><a href="#cb14-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-132"><a href="#cb14-132" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ensure_directories(<span class="va">self</span>):</span>
<span id="cb14-133"><a href="#cb14-133" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Cria todas as pastas necess√°rias&quot;&quot;&quot;</span></span>
<span id="cb14-134"><a href="#cb14-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb14-135"><a href="#cb14-135" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;DRY-RUN: Pastas seriam criadas:&quot;</span>)</span>
<span id="cb14-136"><a href="#cb14-136" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb14-137"><a href="#cb14-137" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-138"><a href="#cb14-138" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb14-139"><a href="#cb14-139" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-140"><a href="#cb14-140" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb14-141"><a href="#cb14-141" aria-hidden="true" tabindex="-1"></a>            Path(folder).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-142"><a href="#cb14-142" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;Pasta criada: </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-143"><a href="#cb14-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-144"><a href="#cb14-144" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> run(<span class="va">self</span>):</span>
<span id="cb14-145"><a href="#cb14-145" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Executa o processamento completo&quot;&quot;&quot;</span></span>
<span id="cb14-146"><a href="#cb14-146" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;SISTEMA COMBINADO DE EXPORTA√á√ïES COM HTML (Qwen3, ChatGPT, DeepSeek, Grok)&quot;</span>)</span>
<span id="cb14-147"><a href="#cb14-147" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb14-148"><a href="#cb14-148" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-149"><a href="#cb14-149" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.data_dir.exists():</span>
<span id="cb14-150"><a href="#cb14-150" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;Pasta &#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">}</span><span class="ss">&#39; n√£o encontrada.&quot;</span>)</span>
<span id="cb14-151"><a href="#cb14-151" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;Crie a pasta &#39;data&#39; e coloque os arquivos de exporta√ß√£o:&quot;</span>)</span>
<span id="cb14-152"><a href="#cb14-152" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb14-153"><a href="#cb14-153" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   - </span><span class="sc">{</span>config[<span class="st">&#39;file&#39;</span>]<span class="sc">}</span><span class="ss"> (para </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb14-154"><a href="#cb14-154" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb14-155"><a href="#cb14-155" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-156"><a href="#cb14-156" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;Usando pasta de dados: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-157"><a href="#cb14-157" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-158"><a href="#cb14-158" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ensure_directories()</span>
<span id="cb14-159"><a href="#cb14-159" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-160"><a href="#cb14-160" aria-hidden="true" tabindex="-1"></a>        processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-161"><a href="#cb14-161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb14-162"><a href="#cb14-162" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> config[<span class="st">&#39;enabled&#39;</span>]:</span>
<span id="cb14-163"><a href="#cb14-163" aria-hidden="true" tabindex="-1"></a>                file_path <span class="op">=</span> <span class="va">self</span>.data_dir <span class="op">/</span> config[<span class="st">&#39;file&#39;</span>]</span>
<span id="cb14-164"><a href="#cb14-164" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> file_path.exists():</span>
<span id="cb14-165"><a href="#cb14-165" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Processando </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb14-166"><a href="#cb14-166" aria-hidden="true" tabindex="-1"></a>                    config[<span class="st">&#39;method&#39;</span>](file_path)</span>
<span id="cb14-167"><a href="#cb14-167" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-168"><a href="#cb14-168" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb14-169"><a href="#cb14-169" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.warning(<span class="ss">f&quot;</span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">: arquivo n√£o encontrado - </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-170"><a href="#cb14-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-171"><a href="#cb14-171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> processed_count <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb14-172"><a href="#cb14-172" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhum arquivo de exporta√ß√£o encontrado na pasta &#39;data&#39;.&quot;</span>)</span>
<span id="cb14-173"><a href="#cb14-173" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb14-174"><a href="#cb14-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-175"><a href="#cb14-175" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb14-176"><a href="#cb14-176" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhuma conversa foi extra√≠da dos arquivos.&quot;</span>)</span>
<span id="cb14-177"><a href="#cb14-177" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb14-178"><a href="#cb14-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-179"><a href="#cb14-179" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._post_process_conversations()</span>
<span id="cb14-180"><a href="#cb14-180" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-181"><a href="#cb14-181" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.dry_run:</span>
<span id="cb14-182"><a href="#cb14-182" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._export_all_formats()</span>
<span id="cb14-183"><a href="#cb14-183" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üéâ SISTEMA COMBINADO FINALIZADO!&quot;</span>)</span>
<span id="cb14-184"><a href="#cb14-184" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ √çndice: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-185"><a href="#cb14-185" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> Path(<span class="va">self</span>.index_file).exists():</span>
<span id="cb14-186"><a href="#cb14-186" aria-hidden="true" tabindex="-1"></a>                webbrowser.<span class="bu">open</span>(<span class="ss">f&#39;file://</span><span class="sc">{</span>Path(<span class="va">self</span>.index_file)<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb14-187"><a href="#cb14-187" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb14-188"><a href="#cb14-188" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üîÆ MODO DRY-RUN: Nenhum arquivo foi criado.&quot;</span>)</span>
<span id="cb14-189"><a href="#cb14-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-190"><a href="#cb14-190" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _post_process_conversations(<span class="va">self</span>):</span>
<span id="cb14-191"><a href="#cb14-191" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processamento p√≥s-extra√ß√£o das conversas&quot;&quot;&quot;</span></span>
<span id="cb14-192"><a href="#cb14-192" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations.sort(</span>
<span id="cb14-193"><a href="#cb14-193" aria-hidden="true" tabindex="-1"></a>            key<span class="op">=</span><span class="kw">lambda</span> x: <span class="va">self</span>.parse_timestamp_for_sorting(</span>
<span id="cb14-194"><a href="#cb14-194" aria-hidden="true" tabindex="-1"></a>                x.get(<span class="st">&#39;updated_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;created_at&#39;</span>)</span>
<span id="cb14-195"><a href="#cb14-195" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb14-196"><a href="#cb14-196" aria-hidden="true" tabindex="-1"></a>            reverse<span class="op">=</span><span class="va">True</span></span>
<span id="cb14-197"><a href="#cb14-197" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb14-198"><a href="#cb14-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-199"><a href="#cb14-199" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.all_conversations):</span>
<span id="cb14-200"><a href="#cb14-200" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;number&#39;</span>] <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb14-201"><a href="#cb14-201" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;category&#39;</span>] <span class="op">=</span> <span class="va">self</span>.categorize_conversation(conv[<span class="st">&#39;title&#39;</span>], conv.get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;&#39;</span>))</span>
<span id="cb14-202"><a href="#cb14-202" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;source&#39;</span>, <span class="st">&#39;Desconhecido&#39;</span>)</span>
<span id="cb14-203"><a href="#cb14-203" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;messages&#39;</span>, [])</span>
<span id="cb14-204"><a href="#cb14-204" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;summary&#39;</span>, conv[<span class="st">&#39;messages&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> conv[<span class="st">&#39;messages&#39;</span>] <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>)</span>
<span id="cb14-205"><a href="#cb14-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-206"><a href="#cb14-206" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä Total combinado de conversas: </span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-207"><a href="#cb14-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-208"><a href="#cb14-208" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _export_all_formats(<span class="va">self</span>):</span>
<span id="cb14-209"><a href="#cb14-209" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Exporta para todos os formatos&quot;&quot;&quot;</span></span>
<span id="cb14-210"><a href="#cb14-210" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">üîÑ Exportando para formatos...&quot;</span>)</span>
<span id="cb14-211"><a href="#cb14-211" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_markdown_enhanced()</span>
<span id="cb14-212"><a href="#cb14-212" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_html_robust()</span>
<span id="cb14-213"><a href="#cb14-213" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_csv() </span>
<span id="cb14-214"><a href="#cb14-214" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_json()</span>
<span id="cb14-215"><a href="#cb14-215" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_all_to_single_files()</span>
<span id="cb14-216"><a href="#cb14-216" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.create_searchable_index()</span>
<span id="cb14-217"><a href="#cb14-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-218"><a href="#cb14-218" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _get_pandoc_version(<span class="va">self</span>) <span class="op">-&gt;</span> Optional[<span class="bu">tuple</span>]:</span>
<span id="cb14-219"><a href="#cb14-219" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Obt√©m a vers√£o do Pandoc para compatibilidade&quot;&quot;&quot;</span></span>
<span id="cb14-220"><a href="#cb14-220" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb14-221"><a href="#cb14-221" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run([<span class="st">&#39;pandoc&#39;</span>, <span class="st">&#39;--version&#39;</span>], capture_output<span class="op">=</span><span class="va">True</span>, text<span class="op">=</span><span class="va">True</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>)</span>
<span id="cb14-222"><a href="#cb14-222" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb14-223"><a href="#cb14-223" aria-hidden="true" tabindex="-1"></a>                first_line <span class="op">=</span> result.stdout.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb14-224"><a href="#cb14-224" aria-hidden="true" tabindex="-1"></a>                version_str <span class="op">=</span> first_line.split()[<span class="dv">1</span>]</span>
<span id="cb14-225"><a href="#cb14-225" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="bu">tuple</span>(<span class="bu">map</span>(<span class="bu">int</span>, version_str.split(<span class="st">&#39;.&#39;</span>)))</span>
<span id="cb14-226"><a href="#cb14-226" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb14-227"><a href="#cb14-227" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb14-228"><a href="#cb14-228" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb14-229"><a href="#cb14-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-230"><a href="#cb14-230" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_optimized(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb14-231"><a href="#cb14-231" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Convers√£o OTIMIZADA com Pandoc usando todas as op√ß√µes avan√ßadas&quot;&quot;&quot;</span></span>
<span id="cb14-232"><a href="#cb14-232" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb14-233"><a href="#cb14-233" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Convertendo com Pandoc otimizado: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-234"><a href="#cb14-234" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-235"><a href="#cb14-235" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica se o arquivo MathJax local existe</span></span>
<span id="cb14-236"><a href="#cb14-236" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb14-237"><a href="#cb14-237" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb14-238"><a href="#cb14-238" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-239"><a href="#cb14-239" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Comandos base</span></span>
<span id="cb14-240"><a href="#cb14-240" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb14-241"><a href="#cb14-241" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb14-242"><a href="#cb14-242" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb14-243"><a href="#cb14-243" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji+autolink_bare_uris+tex_math_single_backslash&#39;</span>,</span>
<span id="cb14-244"><a href="#cb14-244" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb14-245"><a href="#cb14-245" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb14-246"><a href="#cb14-246" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span>,</span>
<span id="cb14-247"><a href="#cb14-247" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--table-of-contents&#39;</span>,</span>
<span id="cb14-248"><a href="#cb14-248" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--toc-depth=2&#39;</span>, </span>
<span id="cb14-249"><a href="#cb14-249" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--number-sections&#39;</span></span>
<span id="cb14-250"><a href="#cb14-250" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb14-251"><a href="#cb14-251" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-252"><a href="#cb14-252" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica vers√£o do Pandoc para recursos avan√ßados</span></span>
<span id="cb14-253"><a href="#cb14-253" aria-hidden="true" tabindex="-1"></a>            pandoc_version <span class="op">=</span> <span class="va">self</span>._get_pandoc_version()</span>
<span id="cb14-254"><a href="#cb14-254" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-255"><a href="#cb14-255" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Adiciona --embed-resources apenas se suportado (Pandoc 2.19+)</span></span>
<span id="cb14-256"><a href="#cb14-256" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pandoc_version <span class="kw">and</span> pandoc_version <span class="op">&gt;=</span> (<span class="dv">2</span>, <span class="dv">19</span>):</span>
<span id="cb14-257"><a href="#cb14-257" aria-hidden="true" tabindex="-1"></a>                command.append(<span class="st">&#39;--embed-resources&#39;</span>)</span>
<span id="cb14-258"><a href="#cb14-258" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="st">&quot;‚úÖ Usando --embed-resources (Pandoc 2.19+)&quot;</span>)</span>
<span id="cb14-259"><a href="#cb14-259" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb14-260"><a href="#cb14-260" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="st">&quot;‚ÑπÔ∏è  --embed-resources n√£o suportado, usando recursos externos&quot;</span>)</span>
<span id="cb14-261"><a href="#cb14-261" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-262"><a href="#cb14-262" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Adiciona syntax highlighting</span></span>
<span id="cb14-263"><a href="#cb14-263" aria-hidden="true" tabindex="-1"></a>            command.extend([<span class="st">&#39;--syntax-highlighting=pygments&#39;</span>])</span>
<span id="cb14-264"><a href="#cb14-264" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-265"><a href="#cb14-265" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb14-266"><a href="#cb14-266" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb14-267"><a href="#cb14-267" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb14-268"><a href="#cb14-268" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb14-269"><a href="#cb14-269" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb14-270"><a href="#cb14-270" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">180</span></span>
<span id="cb14-271"><a href="#cb14-271" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb14-272"><a href="#cb14-272" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-273"><a href="#cb14-273" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb14-274"><a href="#cb14-274" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> result.stdout</span>
<span id="cb14-275"><a href="#cb14-275" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-276"><a href="#cb14-276" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Aplica otimiza√ß√µes adicionais</span></span>
<span id="cb14-277"><a href="#cb14-277" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="va">self</span>._optimize_html_content(html_content)</span>
<span id="cb14-278"><a href="#cb14-278" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> html_content</span>
<span id="cb14-279"><a href="#cb14-279" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb14-280"><a href="#cb14-280" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc otimizado falhou, tentando m√©todo b√°sico: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-281"><a href="#cb14-281" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb14-282"><a href="#cb14-282" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-283"><a href="#cb14-283" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> subprocess.TimeoutExpired:</span>
<span id="cb14-284"><a href="#cb14-284" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Timeout no Pandoc otimizado&quot;</span>)</span>
<span id="cb14-285"><a href="#cb14-285" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb14-286"><a href="#cb14-286" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb14-287"><a href="#cb14-287" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc otimizado: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-288"><a href="#cb14-288" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb14-289"><a href="#cb14-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-290"><a href="#cb14-290" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_basic(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb14-291"><a href="#cb14-291" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;M√©todo b√°sico de fallback para Pandoc com TOC e numera√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb14-292"><a href="#cb14-292" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb14-293"><a href="#cb14-293" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Tentando convers√£o b√°sica: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-294"><a href="#cb14-294" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-295"><a href="#cb14-295" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb14-296"><a href="#cb14-296" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb14-297"><a href="#cb14-297" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-298"><a href="#cb14-298" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb14-299"><a href="#cb14-299" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb14-300"><a href="#cb14-300" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb14-301"><a href="#cb14-301" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown&#39;</span>,</span>
<span id="cb14-302"><a href="#cb14-302" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb14-303"><a href="#cb14-303" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb14-304"><a href="#cb14-304" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--table-of-contents&#39;</span>,</span>
<span id="cb14-305"><a href="#cb14-305" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--toc-depth=2&#39;</span>,</span>
<span id="cb14-306"><a href="#cb14-306" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--number-sections&#39;</span>,</span>
<span id="cb14-307"><a href="#cb14-307" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb14-308"><a href="#cb14-308" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb14-309"><a href="#cb14-309" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-310"><a href="#cb14-310" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb14-311"><a href="#cb14-311" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb14-312"><a href="#cb14-312" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb14-313"><a href="#cb14-313" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb14-314"><a href="#cb14-314" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb14-315"><a href="#cb14-315" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">120</span></span>
<span id="cb14-316"><a href="#cb14-316" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb14-317"><a href="#cb14-317" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-318"><a href="#cb14-318" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb14-319"><a href="#cb14-319" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._optimize_html_content(result.stdout)</span>
<span id="cb14-320"><a href="#cb14-320" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb14-321"><a href="#cb14-321" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc b√°sico falhou, usando fallback Python: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-322"><a href="#cb14-322" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb14-323"><a href="#cb14-323" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-324"><a href="#cb14-324" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb14-325"><a href="#cb14-325" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc b√°sico: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-326"><a href="#cb14-326" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb14-327"><a href="#cb14-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-328"><a href="#cb14-328" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _optimize_html_content(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb14-329"><a href="#cb14-329" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Aplica otimiza√ß√µes finais ao conte√∫do HTML&quot;&quot;&quot;</span></span>
<span id="cb14-330"><a href="#cb14-330" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona viewport para responsividade</span></span>
<span id="cb14-331"><a href="#cb14-331" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;viewport&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb14-332"><a href="#cb14-332" aria-hidden="true" tabindex="-1"></a>            viewport_meta <span class="op">=</span> <span class="st">&#39;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#39;</span></span>
<span id="cb14-333"><a href="#cb14-333" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="ss">    </span><span class="sc">{</span>viewport_meta<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb14-334"><a href="#cb14-334" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-335"><a href="#cb14-335" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Melhora acessibilidade</span></span>
<span id="cb14-336"><a href="#cb14-336" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;html&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;lang&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb14-337"><a href="#cb14-337" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;html&gt;&#39;</span>, <span class="st">&#39;&lt;html lang=&quot;pt-BR&quot;&gt;&#39;</span>)</span>
<span id="cb14-338"><a href="#cb14-338" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-339"><a href="#cb14-339" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona CSS personalizado para melhorar TOC e numera√ß√£o</span></span>
<span id="cb14-340"><a href="#cb14-340" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="va">self</span>._inject_enhanced_css(html_content)</span>
<span id="cb14-341"><a href="#cb14-341" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-342"><a href="#cb14-342" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Otimiza TOC gerado pelo Pandoc</span></span>
<span id="cb14-343"><a href="#cb14-343" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="va">self</span>._enhance_toc_styling(html_content)</span>
<span id="cb14-344"><a href="#cb14-344" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-345"><a href="#cb14-345" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb14-346"><a href="#cb14-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-347"><a href="#cb14-347" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _inject_enhanced_css(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb14-348"><a href="#cb14-348" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Injeta CSS personalizado aprimorado para TOC e numera√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb14-349"><a href="#cb14-349" aria-hidden="true" tabindex="-1"></a>        enhanced_css <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb14-350"><a href="#cb14-350" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;style&gt;</span></span>
<span id="cb14-351"><a href="#cb14-351" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Estilos para Table of Contents */</span></span>
<span id="cb14-352"><a href="#cb14-352" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC {</span></span>
<span id="cb14-353"><a href="#cb14-353" aria-hidden="true" tabindex="-1"></a><span class="st">                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);</span></span>
<span id="cb14-354"><a href="#cb14-354" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #dee2e6;</span></span>
<span id="cb14-355"><a href="#cb14-355" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb14-356"><a href="#cb14-356" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb14-357"><a href="#cb14-357" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 20px 0;</span></span>
<span id="cb14-358"><a href="#cb14-358" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb14-359"><a href="#cb14-359" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-360"><a href="#cb14-360" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-361"><a href="#cb14-361" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul {</span></span>
<span id="cb14-362"><a href="#cb14-362" aria-hidden="true" tabindex="-1"></a><span class="st">                list-style-type: none;</span></span>
<span id="cb14-363"><a href="#cb14-363" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 15px;</span></span>
<span id="cb14-364"><a href="#cb14-364" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 10px 0;</span></span>
<span id="cb14-365"><a href="#cb14-365" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-366"><a href="#cb14-366" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-367"><a href="#cb14-367" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul ul {</span></span>
<span id="cb14-368"><a href="#cb14-368" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 25px;</span></span>
<span id="cb14-369"><a href="#cb14-369" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-370"><a href="#cb14-370" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-371"><a href="#cb14-371" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC li {</span></span>
<span id="cb14-372"><a href="#cb14-372" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 8px 0;</span></span>
<span id="cb14-373"><a href="#cb14-373" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.4;</span></span>
<span id="cb14-374"><a href="#cb14-374" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-375"><a href="#cb14-375" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-376"><a href="#cb14-376" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a {</span></span>
<span id="cb14-377"><a href="#cb14-377" aria-hidden="true" tabindex="-1"></a><span class="st">                text-decoration: none;</span></span>
<span id="cb14-378"><a href="#cb14-378" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #495057;</span></span>
<span id="cb14-379"><a href="#cb14-379" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 500;</span></span>
<span id="cb14-380"><a href="#cb14-380" aria-hidden="true" tabindex="-1"></a><span class="st">                transition: color 0.2s ease;</span></span>
<span id="cb14-381"><a href="#cb14-381" aria-hidden="true" tabindex="-1"></a><span class="st">                display: block;</span></span>
<span id="cb14-382"><a href="#cb14-382" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 4px 8px;</span></span>
<span id="cb14-383"><a href="#cb14-383" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 4px;</span></span>
<span id="cb14-384"><a href="#cb14-384" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-385"><a href="#cb14-385" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-386"><a href="#cb14-386" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a:hover {</span></span>
<span id="cb14-387"><a href="#cb14-387" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #007bff;</span></span>
<span id="cb14-388"><a href="#cb14-388" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: rgba(0, 123, 255, 0.1);</span></span>
<span id="cb14-389"><a href="#cb14-389" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-390"><a href="#cb14-390" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-391"><a href="#cb14-391" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC &gt; ul &gt; li &gt; a {</span></span>
<span id="cb14-392"><a href="#cb14-392" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 600;</span></span>
<span id="cb14-393"><a href="#cb14-393" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50;</span></span>
<span id="cb14-394"><a href="#cb14-394" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 3px solid #3498db;</span></span>
<span id="cb14-395"><a href="#cb14-395" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 12px;</span></span>
<span id="cb14-396"><a href="#cb14-396" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-397"><a href="#cb14-397" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-398"><a href="#cb14-398" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Estilos para numera√ß√£o de se√ß√µes */</span></span>
<span id="cb14-399"><a href="#cb14-399" aria-hidden="true" tabindex="-1"></a><span class="st">            .header-section-number {</span></span>
<span id="cb14-400"><a href="#cb14-400" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #3498db;</span></span>
<span id="cb14-401"><a href="#cb14-401" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: bold;</span></span>
<span id="cb14-402"><a href="#cb14-402" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-right: 8px;</span></span>
<span id="cb14-403"><a href="#cb14-403" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-404"><a href="#cb14-404" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-405"><a href="#cb14-405" aria-hidden="true" tabindex="-1"></a><span class="st">            h1 .header-section-number {</span></span>
<span id="cb14-406"><a href="#cb14-406" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.9em;</span></span>
<span id="cb14-407"><a href="#cb14-407" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-408"><a href="#cb14-408" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-409"><a href="#cb14-409" aria-hidden="true" tabindex="-1"></a><span class="st">            h2 .header-section-number {</span></span>
<span id="cb14-410"><a href="#cb14-410" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.85em;</span></span>
<span id="cb14-411"><a href="#cb14-411" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-412"><a href="#cb14-412" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-413"><a href="#cb14-413" aria-hidden="true" tabindex="-1"></a><span class="st">            h3 .header-section-number {</span></span>
<span id="cb14-414"><a href="#cb14-414" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.8em;</span></span>
<span id="cb14-415"><a href="#cb14-415" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-416"><a href="#cb14-416" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-417"><a href="#cb14-417" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para c√≥digo e matem√°tica */</span></span>
<span id="cb14-418"><a href="#cb14-418" aria-hidden="true" tabindex="-1"></a><span class="st">            .math { display: block; text-align: center; margin: 1.5em 0; }</span></span>
<span id="cb14-419"><a href="#cb14-419" aria-hidden="true" tabindex="-1"></a><span class="st">            .math inline { display: inline-block; }</span></span>
<span id="cb14-420"><a href="#cb14-420" aria-hidden="true" tabindex="-1"></a><span class="st">            pre { </span></span>
<span id="cb14-421"><a href="#cb14-421" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb14-422"><a href="#cb14-422" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #2d2d2d; </span></span>
<span id="cb14-423"><a href="#cb14-423" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #f8f8f2;</span></span>
<span id="cb14-424"><a href="#cb14-424" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb14-425"><a href="#cb14-425" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb14-426"><a href="#cb14-426" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow-x: auto;</span></span>
<span id="cb14-427"><a href="#cb14-427" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb14-428"><a href="#cb14-428" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.4;</span></span>
<span id="cb14-429"><a href="#cb14-429" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-430"><a href="#cb14-430" aria-hidden="true" tabindex="-1"></a><span class="st">            code { </span></span>
<span id="cb14-431"><a href="#cb14-431" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #e9ecef; </span></span>
<span id="cb14-432"><a href="#cb14-432" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 0.2em 0.4em; </span></span>
<span id="cb14-433"><a href="#cb14-433" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 3px;</span></span>
<span id="cb14-434"><a href="#cb14-434" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb14-435"><a href="#cb14-435" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #c7254e;</span></span>
<span id="cb14-436"><a href="#cb14-436" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-437"><a href="#cb14-437" aria-hidden="true" tabindex="-1"></a><span class="st">            pre code { </span></span>
<span id="cb14-438"><a href="#cb14-438" aria-hidden="true" tabindex="-1"></a><span class="st">                background: none; </span></span>
<span id="cb14-439"><a href="#cb14-439" aria-hidden="true" tabindex="-1"></a><span class="st">                color: inherit; </span></span>
<span id="cb14-440"><a href="#cb14-440" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 0; </span></span>
<span id="cb14-441"><a href="#cb14-441" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-442"><a href="#cb14-442" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-443"><a href="#cb14-443" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias responsivas */</span></span>
<span id="cb14-444"><a href="#cb14-444" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 768px) {</span></span>
<span id="cb14-445"><a href="#cb14-445" aria-hidden="true" tabindex="-1"></a><span class="st">                body { padding: 10px; font-size: 14px; }</span></span>
<span id="cb14-446"><a href="#cb14-446" aria-hidden="true" tabindex="-1"></a><span class="st">                .container { padding: 15px; }</span></span>
<span id="cb14-447"><a href="#cb14-447" aria-hidden="true" tabindex="-1"></a><span class="st">                pre { font-size: 12px; padding: 15px; }</span></span>
<span id="cb14-448"><a href="#cb14-448" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC { padding: 15px; }</span></span>
<span id="cb14-449"><a href="#cb14-449" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-450"><a href="#cb14-450" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-451"><a href="#cb14-451" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para tabelas */</span></span>
<span id="cb14-452"><a href="#cb14-452" aria-hidden="true" tabindex="-1"></a><span class="st">            table { </span></span>
<span id="cb14-453"><a href="#cb14-453" aria-hidden="true" tabindex="-1"></a><span class="st">                width: 100%; </span></span>
<span id="cb14-454"><a href="#cb14-454" aria-hidden="true" tabindex="-1"></a><span class="st">                border-collapse: collapse; </span></span>
<span id="cb14-455"><a href="#cb14-455" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 1.5em 0;</span></span>
<span id="cb14-456"><a href="#cb14-456" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb14-457"><a href="#cb14-457" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb14-458"><a href="#cb14-458" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow: hidden;</span></span>
<span id="cb14-459"><a href="#cb14-459" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-460"><a href="#cb14-460" aria-hidden="true" tabindex="-1"></a><span class="st">            th, td { </span></span>
<span id="cb14-461"><a href="#cb14-461" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #dee2e6; </span></span>
<span id="cb14-462"><a href="#cb14-462" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 12px 15px; </span></span>
<span id="cb14-463"><a href="#cb14-463" aria-hidden="true" tabindex="-1"></a><span class="st">                text-align: left; </span></span>
<span id="cb14-464"><a href="#cb14-464" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-465"><a href="#cb14-465" aria-hidden="true" tabindex="-1"></a><span class="st">            th { </span></span>
<span id="cb14-466"><a href="#cb14-466" aria-hidden="true" tabindex="-1"></a><span class="st">                background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb14-467"><a href="#cb14-467" aria-hidden="true" tabindex="-1"></a><span class="st">                color: white; </span></span>
<span id="cb14-468"><a href="#cb14-468" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: bold;</span></span>
<span id="cb14-469"><a href="#cb14-469" aria-hidden="true" tabindex="-1"></a><span class="st">                text-transform: uppercase;</span></span>
<span id="cb14-470"><a href="#cb14-470" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.9em;</span></span>
<span id="cb14-471"><a href="#cb14-471" aria-hidden="true" tabindex="-1"></a><span class="st">                letter-spacing: 0.5px;</span></span>
<span id="cb14-472"><a href="#cb14-472" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-473"><a href="#cb14-473" aria-hidden="true" tabindex="-1"></a><span class="st">            tr:nth-child(even) { </span></span>
<span id="cb14-474"><a href="#cb14-474" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #f8f9fa; </span></span>
<span id="cb14-475"><a href="#cb14-475" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-476"><a href="#cb14-476" aria-hidden="true" tabindex="-1"></a><span class="st">            tr:hover { </span></span>
<span id="cb14-477"><a href="#cb14-477" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #e3f2fd; </span></span>
<span id="cb14-478"><a href="#cb14-478" aria-hidden="true" tabindex="-1"></a><span class="st">                transition: background-color 0.2s ease;</span></span>
<span id="cb14-479"><a href="#cb14-479" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-480"><a href="#cb14-480" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-481"><a href="#cb14-481" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para blocos de cita√ß√£o */</span></span>
<span id="cb14-482"><a href="#cb14-482" aria-hidden="true" tabindex="-1"></a><span class="st">            blockquote { </span></span>
<span id="cb14-483"><a href="#cb14-483" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb14-484"><a href="#cb14-484" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 25px 0; </span></span>
<span id="cb14-485"><a href="#cb14-485" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 25px; </span></span>
<span id="cb14-486"><a href="#cb14-486" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #7f8c8d;</span></span>
<span id="cb14-487"><a href="#cb14-487" aria-hidden="true" tabindex="-1"></a><span class="st">                font-style: italic;</span></span>
<span id="cb14-488"><a href="#cb14-488" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #f8f9fa;</span></span>
<span id="cb14-489"><a href="#cb14-489" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb14-490"><a href="#cb14-490" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 0 8px 8px 0;</span></span>
<span id="cb14-491"><a href="#cb14-491" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-492"><a href="#cb14-492" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-493"><a href="#cb14-493" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Container principal */</span></span>
<span id="cb14-494"><a href="#cb14-494" aria-hidden="true" tabindex="-1"></a><span class="st">            body { </span></span>
<span id="cb14-495"><a href="#cb14-495" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb14-496"><a href="#cb14-496" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.6; </span></span>
<span id="cb14-497"><a href="#cb14-497" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0; </span></span>
<span id="cb14-498"><a href="#cb14-498" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px; </span></span>
<span id="cb14-499"><a href="#cb14-499" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #f5f5f5;</span></span>
<span id="cb14-500"><a href="#cb14-500" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #333;</span></span>
<span id="cb14-501"><a href="#cb14-501" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-502"><a href="#cb14-502" aria-hidden="true" tabindex="-1"></a><span class="st">            .container {</span></span>
<span id="cb14-503"><a href="#cb14-503" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: 900px;</span></span>
<span id="cb14-504"><a href="#cb14-504" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0 auto;</span></span>
<span id="cb14-505"><a href="#cb14-505" aria-hidden="true" tabindex="-1"></a><span class="st">                background: white;</span></span>
<span id="cb14-506"><a href="#cb14-506" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 40px;</span></span>
<span id="cb14-507"><a href="#cb14-507" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 10px;</span></span>
<span id="cb14-508"><a href="#cb14-508" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb14-509"><a href="#cb14-509" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-510"><a href="#cb14-510" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-511"><a href="#cb14-511" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Cabe√ßalhos com numera√ß√£o */</span></span>
<span id="cb14-512"><a href="#cb14-512" aria-hidden="true" tabindex="-1"></a><span class="st">            h1, h2, h3, h4, h5 { </span></span>
<span id="cb14-513"><a href="#cb14-513" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50; </span></span>
<span id="cb14-514"><a href="#cb14-514" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-top: 1.8em;</span></span>
<span id="cb14-515"><a href="#cb14-515" aria-hidden="true" tabindex="-1"></a><span class="st">                border-bottom: 1px solid #e9ecef;</span></span>
<span id="cb14-516"><a href="#cb14-516" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-bottom: 0.5em;</span></span>
<span id="cb14-517"><a href="#cb14-517" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-518"><a href="#cb14-518" aria-hidden="true" tabindex="-1"></a><span class="st">            h1 { </span></span>
<span id="cb14-519"><a href="#cb14-519" aria-hidden="true" tabindex="-1"></a><span class="st">                border-bottom: 3px solid #3498db; </span></span>
<span id="cb14-520"><a href="#cb14-520" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-bottom: 15px; </span></span>
<span id="cb14-521"><a href="#cb14-521" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50;</span></span>
<span id="cb14-522"><a href="#cb14-522" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 2.2em;</span></span>
<span id="cb14-523"><a href="#cb14-523" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-524"><a href="#cb14-524" aria-hidden="true" tabindex="-1"></a><span class="st">            h2 {</span></span>
<span id="cb14-525"><a href="#cb14-525" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db;</span></span>
<span id="cb14-526"><a href="#cb14-526" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 15px;</span></span>
<span id="cb14-527"><a href="#cb14-527" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-top: 2em;</span></span>
<span id="cb14-528"><a href="#cb14-528" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-529"><a href="#cb14-529" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/style&gt;</span></span>
<span id="cb14-530"><a href="#cb14-530" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb14-531"><a href="#cb14-531" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-532"><a href="#cb14-532" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;/head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb14-533"><a href="#cb14-533" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;/head&gt;&#39;</span>, <span class="ss">f&#39;</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;&#39;</span>)</span>
<span id="cb14-534"><a href="#cb14-534" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb14-535"><a href="#cb14-535" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb14-536"><a href="#cb14-536" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb14-537"><a href="#cb14-537" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;&lt;body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb14-538"><a href="#cb14-538" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;body&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;&#39;</span>)</span>
<span id="cb14-539"><a href="#cb14-539" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb14-540"><a href="#cb14-540" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;</span><span class="ch">\n</span><span class="sc">{</span>html_content<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/body&gt;&#39;</span></span>
<span id="cb14-541"><a href="#cb14-541" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-542"><a href="#cb14-542" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb14-543"><a href="#cb14-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-544"><a href="#cb14-544" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _enhance_toc_styling(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb14-545"><a href="#cb14-545" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Melhora o estilo do Table of Contents gerado pelo Pandoc&quot;&quot;&quot;</span></span>
<span id="cb14-546"><a href="#cb14-546" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona t√≠tulo ao TOC se n√£o existir</span></span>
<span id="cb14-547"><a href="#cb14-547" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;Table of Contents&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb14-548"><a href="#cb14-548" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(</span>
<span id="cb14-549"><a href="#cb14-549" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span>, </span>
<span id="cb14-550"><a href="#cb14-550" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&lt;h2 style=&quot;margin-top: 0; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;&quot;&gt;üìë Table of Contents&lt;/h2&gt;&#39;</span></span>
<span id="cb14-551"><a href="#cb14-551" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb14-552"><a href="#cb14-552" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-553"><a href="#cb14-553" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb14-554"><a href="#cb14-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-555"><a href="#cb14-555" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_fallback(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb14-556"><a href="#cb14-556" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Fallback para convers√£o quando Pandoc falha&quot;&quot;&quot;</span></span>
<span id="cb14-557"><a href="#cb14-557" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb14-558"><a href="#cb14-558" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(md_file_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb14-559"><a href="#cb14-559" aria-hidden="true" tabindex="-1"></a>                md_content <span class="op">=</span> f.read()</span>
<span id="cb14-560"><a href="#cb14-560" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-561"><a href="#cb14-561" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extens√µes avan√ßadas para melhor convers√£o</span></span>
<span id="cb14-562"><a href="#cb14-562" aria-hidden="true" tabindex="-1"></a>            extensions <span class="op">=</span> [</span>
<span id="cb14-563"><a href="#cb14-563" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;extra&#39;</span>, <span class="st">&#39;tables&#39;</span>, <span class="st">&#39;fenced_code&#39;</span>, <span class="st">&#39;codehilite&#39;</span>, </span>
<span id="cb14-564"><a href="#cb14-564" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;toc&#39;</span>, <span class="st">&#39;md_in_html&#39;</span>, <span class="st">&#39;attr_list&#39;</span></span>
<span id="cb14-565"><a href="#cb14-565" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb14-566"><a href="#cb14-566" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-567"><a href="#cb14-567" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> markdown.markdown(</span>
<span id="cb14-568"><a href="#cb14-568" aria-hidden="true" tabindex="-1"></a>                md_content,</span>
<span id="cb14-569"><a href="#cb14-569" aria-hidden="true" tabindex="-1"></a>                extensions<span class="op">=</span>extensions,</span>
<span id="cb14-570"><a href="#cb14-570" aria-hidden="true" tabindex="-1"></a>                output_format<span class="op">=</span><span class="st">&#39;html5&#39;</span></span>
<span id="cb14-571"><a href="#cb14-571" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb14-572"><a href="#cb14-572" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-573"><a href="#cb14-573" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_enhanced_html_template(html_content, Path(md_file_path).name)</span>
<span id="cb14-574"><a href="#cb14-574" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-575"><a href="#cb14-575" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb14-576"><a href="#cb14-576" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Fallback tamb√©m falhou: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-577"><a href="#cb14-577" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_basic_html(md_content, Path(md_file_path).name)</span>
<span id="cb14-578"><a href="#cb14-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-579"><a href="#cb14-579" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_enhanced_html_template(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb14-580"><a href="#cb14-580" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Template HTML aprimorado com suporte a MathJax local/online&quot;&quot;&quot;</span></span>
<span id="cb14-581"><a href="#cb14-581" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb14-582"><a href="#cb14-582" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-583"><a href="#cb14-583" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb14-584"><a href="#cb14-584" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html lang=&quot;pt-BR&quot;&gt;</span></span>
<span id="cb14-585"><a href="#cb14-585" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb14-586"><a href="#cb14-586" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb14-587"><a href="#cb14-587" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb14-588"><a href="#cb14-588" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb14-589"><a href="#cb14-589" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb14-590"><a href="#cb14-590" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span></span>
<span id="cb14-591"><a href="#cb14-591" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb14-592"><a href="#cb14-592" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb14-593"><a href="#cb14-593" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0;</span></span>
<span id="cb14-594"><a href="#cb14-594" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb14-595"><a href="#cb14-595" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb14-596"><a href="#cb14-596" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333;</span></span>
<span id="cb14-597"><a href="#cb14-597" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-598"><a href="#cb14-598" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb14-599"><a href="#cb14-599" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 900px;</span></span>
<span id="cb14-600"><a href="#cb14-600" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb14-601"><a href="#cb14-601" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb14-602"><a href="#cb14-602" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 40px;</span></span>
<span id="cb14-603"><a href="#cb14-603" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 10px;</span></span>
<span id="cb14-604"><a href="#cb14-604" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb14-605"><a href="#cb14-605" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-606"><a href="#cb14-606" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1, h2, h3, h4, h5 </span><span class="ch">{{</span></span>
<span id="cb14-607"><a href="#cb14-607" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb14-608"><a href="#cb14-608" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 1.8em;</span></span>
<span id="cb14-609"><a href="#cb14-609" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-610"><a href="#cb14-610" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1 </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-611"><a href="#cb14-611" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 3px solid #3498db; </span></span>
<span id="cb14-612"><a href="#cb14-612" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 15px; </span></span>
<span id="cb14-613"><a href="#cb14-613" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb14-614"><a href="#cb14-614" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 2.2em;</span></span>
<span id="cb14-615"><a href="#cb14-615" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-616"><a href="#cb14-616" aria-hidden="true" tabindex="-1"></a><span class="ss">        h2 </span><span class="ch">{{</span></span>
<span id="cb14-617"><a href="#cb14-617" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb14-618"><a href="#cb14-618" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb14-619"><a href="#cb14-619" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 2em;</span></span>
<span id="cb14-620"><a href="#cb14-620" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-621"><a href="#cb14-621" aria-hidden="true" tabindex="-1"></a><span class="ss">        code </span><span class="ch">{{</span></span>
<span id="cb14-622"><a href="#cb14-622" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f4f4f4;</span></span>
<span id="cb14-623"><a href="#cb14-623" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 3px 8px;</span></span>
<span id="cb14-624"><a href="#cb14-624" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb14-625"><a href="#cb14-625" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb14-626"><a href="#cb14-626" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #c7254e;</span></span>
<span id="cb14-627"><a href="#cb14-627" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb14-628"><a href="#cb14-628" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-629"><a href="#cb14-629" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span></span>
<span id="cb14-630"><a href="#cb14-630" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #2d2d2d;</span></span>
<span id="cb14-631"><a href="#cb14-631" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #f8f8f2;</span></span>
<span id="cb14-632"><a href="#cb14-632" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb14-633"><a href="#cb14-633" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb14-634"><a href="#cb14-634" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb14-635"><a href="#cb14-635" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 5px solid #3498db;</span></span>
<span id="cb14-636"><a href="#cb14-636" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb14-637"><a href="#cb14-637" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.4;</span></span>
<span id="cb14-638"><a href="#cb14-638" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-639"><a href="#cb14-639" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre code </span><span class="ch">{{</span></span>
<span id="cb14-640"><a href="#cb14-640" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: none;</span></span>
<span id="cb14-641"><a href="#cb14-641" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: inherit;</span></span>
<span id="cb14-642"><a href="#cb14-642" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 0;</span></span>
<span id="cb14-643"><a href="#cb14-643" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-644"><a href="#cb14-644" aria-hidden="true" tabindex="-1"></a><span class="ss">        blockquote </span><span class="ch">{{</span></span>
<span id="cb14-645"><a href="#cb14-645" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb14-646"><a href="#cb14-646" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 25px 0;</span></span>
<span id="cb14-647"><a href="#cb14-647" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 25px;</span></span>
<span id="cb14-648"><a href="#cb14-648" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb14-649"><a href="#cb14-649" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-style: italic;</span></span>
<span id="cb14-650"><a href="#cb14-650" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb14-651"><a href="#cb14-651" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb14-652"><a href="#cb14-652" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 0 8px 8px 0;</span></span>
<span id="cb14-653"><a href="#cb14-653" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-654"><a href="#cb14-654" aria-hidden="true" tabindex="-1"></a><span class="ss">        table </span><span class="ch">{{</span></span>
<span id="cb14-655"><a href="#cb14-655" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-collapse: collapse;</span></span>
<span id="cb14-656"><a href="#cb14-656" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 100%;</span></span>
<span id="cb14-657"><a href="#cb14-657" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb14-658"><a href="#cb14-658" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb14-659"><a href="#cb14-659" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb14-660"><a href="#cb14-660" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb14-661"><a href="#cb14-661" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-662"><a href="#cb14-662" aria-hidden="true" tabindex="-1"></a><span class="ss">        th, td </span><span class="ch">{{</span></span>
<span id="cb14-663"><a href="#cb14-663" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb14-664"><a href="#cb14-664" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb14-665"><a href="#cb14-665" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: left;</span></span>
<span id="cb14-666"><a href="#cb14-666" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-667"><a href="#cb14-667" aria-hidden="true" tabindex="-1"></a><span class="ss">        th </span><span class="ch">{{</span></span>
<span id="cb14-668"><a href="#cb14-668" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb14-669"><a href="#cb14-669" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb14-670"><a href="#cb14-670" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb14-671"><a href="#cb14-671" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-transform: uppercase;</span></span>
<span id="cb14-672"><a href="#cb14-672" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb14-673"><a href="#cb14-673" aria-hidden="true" tabindex="-1"></a><span class="ss">            letter-spacing: 0.5px;</span></span>
<span id="cb14-674"><a href="#cb14-674" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-675"><a href="#cb14-675" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:nth-child(even) </span><span class="ch">{{</span></span>
<span id="cb14-676"><a href="#cb14-676" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f8f9fa;</span></span>
<span id="cb14-677"><a href="#cb14-677" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-678"><a href="#cb14-678" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:hover </span><span class="ch">{{</span></span>
<span id="cb14-679"><a href="#cb14-679" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #e3f2fd;</span></span>
<span id="cb14-680"><a href="#cb14-680" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: background-color 0.2s ease;</span></span>
<span id="cb14-681"><a href="#cb14-681" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-682"><a href="#cb14-682" aria-hidden="true" tabindex="-1"></a><span class="ss">        .math </span><span class="ch">{{</span></span>
<span id="cb14-683"><a href="#cb14-683" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center;</span></span>
<span id="cb14-684"><a href="#cb14-684" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb14-685"><a href="#cb14-685" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb14-686"><a href="#cb14-686" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb14-687"><a href="#cb14-687" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb14-688"><a href="#cb14-688" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb14-689"><a href="#cb14-689" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-690"><a href="#cb14-690" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-header </span><span class="ch">{{</span></span>
<span id="cb14-691"><a href="#cb14-691" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb14-692"><a href="#cb14-692" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between;</span></span>
<span id="cb14-693"><a href="#cb14-693" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: center;</span></span>
<span id="cb14-694"><a href="#cb14-694" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 15px;</span></span>
<span id="cb14-695"><a href="#cb14-695" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb14-696"><a href="#cb14-696" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 10px;</span></span>
<span id="cb14-697"><a href="#cb14-697" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-698"><a href="#cb14-698" aria-hidden="true" tabindex="-1"></a><span class="ss">        .author </span><span class="ch">{{</span></span>
<span id="cb14-699"><a href="#cb14-699" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb14-700"><a href="#cb14-700" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb14-701"><a href="#cb14-701" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.1em;</span></span>
<span id="cb14-702"><a href="#cb14-702" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-703"><a href="#cb14-703" aria-hidden="true" tabindex="-1"></a><span class="ss">        .timestamp </span><span class="ch">{{</span></span>
<span id="cb14-704"><a href="#cb14-704" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb14-705"><a href="#cb14-705" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb14-706"><a href="#cb14-706" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e9ecef;</span></span>
<span id="cb14-707"><a href="#cb14-707" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 8px;</span></span>
<span id="cb14-708"><a href="#cb14-708" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb14-709"><a href="#cb14-709" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-710"><a href="#cb14-710" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-content </span><span class="ch">{{</span></span>
<span id="cb14-711"><a href="#cb14-711" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb14-712"><a href="#cb14-712" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb14-713"><a href="#cb14-713" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb14-714"><a href="#cb14-714" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb14-715"><a href="#cb14-715" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 20px;</span></span>
<span id="cb14-716"><a href="#cb14-716" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-717"><a href="#cb14-717" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata </span><span class="ch">{{</span></span>
<span id="cb14-718"><a href="#cb14-718" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e8f4fd;</span></span>
<span id="cb14-719"><a href="#cb14-719" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb14-720"><a href="#cb14-720" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb14-721"><a href="#cb14-721" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 25px;</span></span>
<span id="cb14-722"><a href="#cb14-722" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb14-723"><a href="#cb14-723" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-724"><a href="#cb14-724" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata h3 </span><span class="ch">{{</span></span>
<span id="cb14-725"><a href="#cb14-725" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb14-726"><a href="#cb14-726" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb14-727"><a href="#cb14-727" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-728"><a href="#cb14-728" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* Estilos para TOC manual */</span></span>
<span id="cb14-729"><a href="#cb14-729" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc </span><span class="ch">{{</span></span>
<span id="cb14-730"><a href="#cb14-730" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);</span></span>
<span id="cb14-731"><a href="#cb14-731" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #dee2e6;</span></span>
<span id="cb14-732"><a href="#cb14-732" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb14-733"><a href="#cb14-733" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb14-734"><a href="#cb14-734" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 20px 0;</span></span>
<span id="cb14-735"><a href="#cb14-735" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb14-736"><a href="#cb14-736" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-737"><a href="#cb14-737" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc h2 </span><span class="ch">{{</span></span>
<span id="cb14-738"><a href="#cb14-738" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb14-739"><a href="#cb14-739" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb14-740"><a href="#cb14-740" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 2px solid #3498db;</span></span>
<span id="cb14-741"><a href="#cb14-741" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 10px;</span></span>
<span id="cb14-742"><a href="#cb14-742" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-743"><a href="#cb14-743" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc ul </span><span class="ch">{{</span></span>
<span id="cb14-744"><a href="#cb14-744" aria-hidden="true" tabindex="-1"></a><span class="ss">            list-style-type: none;</span></span>
<span id="cb14-745"><a href="#cb14-745" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb14-746"><a href="#cb14-746" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-747"><a href="#cb14-747" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc li </span><span class="ch">{{</span></span>
<span id="cb14-748"><a href="#cb14-748" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 8px 0;</span></span>
<span id="cb14-749"><a href="#cb14-749" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-750"><a href="#cb14-750" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc a </span><span class="ch">{{</span></span>
<span id="cb14-751"><a href="#cb14-751" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb14-752"><a href="#cb14-752" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #495057;</span></span>
<span id="cb14-753"><a href="#cb14-753" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb14-754"><a href="#cb14-754" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-755"><a href="#cb14-755" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc a:hover </span><span class="ch">{{</span></span>
<span id="cb14-756"><a href="#cb14-756" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #007bff;</span></span>
<span id="cb14-757"><a href="#cb14-757" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-758"><a href="#cb14-758" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 768px) </span><span class="ch">{{</span></span>
<span id="cb14-759"><a href="#cb14-759" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb14-760"><a href="#cb14-760" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 20px;</span></span>
<span id="cb14-761"><a href="#cb14-761" aria-hidden="true" tabindex="-1"></a><span class="ss">                margin: 10px;</span></span>
<span id="cb14-762"><a href="#cb14-762" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb14-763"><a href="#cb14-763" aria-hidden="true" tabindex="-1"></a><span class="ss">            body </span><span class="ch">{{</span></span>
<span id="cb14-764"><a href="#cb14-764" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 10px;</span></span>
<span id="cb14-765"><a href="#cb14-765" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb14-766"><a href="#cb14-766" aria-hidden="true" tabindex="-1"></a><span class="ss">            h1 </span><span class="ch">{{</span></span>
<span id="cb14-767"><a href="#cb14-767" aria-hidden="true" tabindex="-1"></a><span class="ss">                font-size: 1.8em;</span></span>
<span id="cb14-768"><a href="#cb14-768" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb14-769"><a href="#cb14-769" aria-hidden="true" tabindex="-1"></a><span class="ss">            .message-header </span><span class="ch">{{</span></span>
<span id="cb14-770"><a href="#cb14-770" aria-hidden="true" tabindex="-1"></a><span class="ss">                flex-direction: column;</span></span>
<span id="cb14-771"><a href="#cb14-771" aria-hidden="true" tabindex="-1"></a><span class="ss">                align-items: flex-start;</span></span>
<span id="cb14-772"><a href="#cb14-772" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb14-773"><a href="#cb14-773" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-774"><a href="#cb14-774" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb14-775"><a href="#cb14-775" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb14-776"><a href="#cb14-776" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb14-777"><a href="#cb14-777" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb14-778"><a href="#cb14-778" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="sc">{</span>content<span class="sc">}</span></span>
<span id="cb14-779"><a href="#cb14-779" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb14-780"><a href="#cb14-780" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb14-781"><a href="#cb14-781" aria-hidden="true" tabindex="-1"></a><span class="ss">        // Configura√ß√£o MathJax para melhor renderiza√ß√£o</span></span>
<span id="cb14-782"><a href="#cb14-782" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb14-783"><a href="#cb14-783" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb14-784"><a href="#cb14-784" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb14-785"><a href="#cb14-785" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb14-786"><a href="#cb14-786" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true,</span></span>
<span id="cb14-787"><a href="#cb14-787" aria-hidden="true" tabindex="-1"></a><span class="ss">                tags: &#39;ams&#39;</span></span>
<span id="cb14-788"><a href="#cb14-788" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb14-789"><a href="#cb14-789" aria-hidden="true" tabindex="-1"></a><span class="ss">            options: </span><span class="ch">{{</span></span>
<span id="cb14-790"><a href="#cb14-790" aria-hidden="true" tabindex="-1"></a><span class="ss">                skipHtmlTags: [&#39;script&#39;, &#39;noscript&#39;, &#39;style&#39;, &#39;textarea&#39;, &#39;pre&#39;],</span></span>
<span id="cb14-791"><a href="#cb14-791" aria-hidden="true" tabindex="-1"></a><span class="ss">                renderActions: </span><span class="ch">{{</span></span>
<span id="cb14-792"><a href="#cb14-792" aria-hidden="true" tabindex="-1"></a><span class="ss">                    addMenu: [0, &#39;&#39;, &#39;&#39;]</span></span>
<span id="cb14-793"><a href="#cb14-793" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb14-794"><a href="#cb14-794" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb14-795"><a href="#cb14-795" aria-hidden="true" tabindex="-1"></a><span class="ss">            startup: </span><span class="ch">{{</span></span>
<span id="cb14-796"><a href="#cb14-796" aria-hidden="true" tabindex="-1"></a><span class="ss">                pageReady() </span><span class="ch">{{</span></span>
<span id="cb14-797"><a href="#cb14-797" aria-hidden="true" tabindex="-1"></a><span class="ss">                    return MathJax.startup.defaultPageReady().then(() =&gt; </span><span class="ch">{{</span></span>
<span id="cb14-798"><a href="#cb14-798" aria-hidden="true" tabindex="-1"></a><span class="ss">                        console.log(&#39;MathJax carregado com sucesso&#39;);</span></span>
<span id="cb14-799"><a href="#cb14-799" aria-hidden="true" tabindex="-1"></a><span class="ss">                    </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb14-800"><a href="#cb14-800" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb14-801"><a href="#cb14-801" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb14-802"><a href="#cb14-802" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb14-803"><a href="#cb14-803" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb14-804"><a href="#cb14-804" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb14-805"><a href="#cb14-805" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb14-806"><a href="#cb14-806" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb14-807"><a href="#cb14-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-808"><a href="#cb14-808" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_basic_html(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb14-809"><a href="#cb14-809" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;HTML b√°sico de √∫ltimo recurso com MathJax&quot;&quot;&quot;</span></span>
<span id="cb14-810"><a href="#cb14-810" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb14-811"><a href="#cb14-811" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-812"><a href="#cb14-812" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb14-813"><a href="#cb14-813" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html&gt;</span></span>
<span id="cb14-814"><a href="#cb14-814" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb14-815"><a href="#cb14-815" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb14-816"><a href="#cb14-816" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb14-817"><a href="#cb14-817" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb14-818"><a href="#cb14-818" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-819"><a href="#cb14-819" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif; </span></span>
<span id="cb14-820"><a href="#cb14-820" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px; </span></span>
<span id="cb14-821"><a href="#cb14-821" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb14-822"><a href="#cb14-822" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb14-823"><a href="#cb14-823" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-824"><a href="#cb14-824" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-825"><a href="#cb14-825" aria-hidden="true" tabindex="-1"></a><span class="ss">            white-space: pre-wrap; </span></span>
<span id="cb14-826"><a href="#cb14-826" aria-hidden="true" tabindex="-1"></a><span class="ss">            word-wrap: break-word; </span></span>
<span id="cb14-827"><a href="#cb14-827" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb14-828"><a href="#cb14-828" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb14-829"><a href="#cb14-829" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 5px;</span></span>
<span id="cb14-830"><a href="#cb14-830" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb14-831"><a href="#cb14-831" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-832"><a href="#cb14-832" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb14-833"><a href="#cb14-833" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 800px;</span></span>
<span id="cb14-834"><a href="#cb14-834" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb14-835"><a href="#cb14-835" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb14-836"><a href="#cb14-836" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 30px;</span></span>
<span id="cb14-837"><a href="#cb14-837" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb14-838"><a href="#cb14-838" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb14-839"><a href="#cb14-839" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-840"><a href="#cb14-840" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb14-841"><a href="#cb14-841" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb14-842"><a href="#cb14-842" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb14-843"><a href="#cb14-843" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb14-844"><a href="#cb14-844" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb14-845"><a href="#cb14-845" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb14-846"><a href="#cb14-846" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true</span></span>
<span id="cb14-847"><a href="#cb14-847" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb14-848"><a href="#cb14-848" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb14-849"><a href="#cb14-849" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb14-850"><a href="#cb14-850" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb14-851"><a href="#cb14-851" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb14-852"><a href="#cb14-852" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb14-853"><a href="#cb14-853" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb14-854"><a href="#cb14-854" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;pre&gt;</span><span class="sc">{</span>content<span class="sc">}</span><span class="ss">&lt;/pre&gt;</span></span>
<span id="cb14-855"><a href="#cb14-855" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb14-856"><a href="#cb14-856" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb14-857"><a href="#cb14-857" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb14-858"><a href="#cb14-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-859"><a href="#cb14-859" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_html_robust(<span class="va">self</span>):</span>
<span id="cb14-860"><a href="#cb14-860" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;M√©todo ROBUSTO para convers√£o HTML - VERS√ÉO OTIMIZADA&quot;&quot;&quot;</span></span>
<span id="cb14-861"><a href="#cb14-861" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb14-862"><a href="#cb14-862" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] HTMLs seriam criados:&quot;</span>)</span>
<span id="cb14-863"><a href="#cb14-863" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb14-864"><a href="#cb14-864" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb14-865"><a href="#cb14-865" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.html&quot;</span></span>
<span id="cb14-866"><a href="#cb14-866" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üåê </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-867"><a href="#cb14-867" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb14-868"><a href="#cb14-868" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-869"><a href="#cb14-869" aria-hidden="true" tabindex="-1"></a>        markdown_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;markdown&#39;</span>])</span>
<span id="cb14-870"><a href="#cb14-870" aria-hidden="true" tabindex="-1"></a>        html_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;html&#39;</span>])</span>
<span id="cb14-871"><a href="#cb14-871" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-872"><a href="#cb14-872" aria-hidden="true" tabindex="-1"></a>        md_files <span class="op">=</span> <span class="bu">list</span>(markdown_folder.glob(<span class="st">&quot;*.md&quot;</span>))</span>
<span id="cb14-873"><a href="#cb14-873" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-874"><a href="#cb14-874" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> md_files:</span>
<span id="cb14-875"><a href="#cb14-875" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Nenhum arquivo Markdown encontrado para convers√£o.&quot;</span>)</span>
<span id="cb14-876"><a href="#cb14-876" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb14-877"><a href="#cb14-877" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-878"><a href="#cb14-878" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÑ Convertendo </span><span class="sc">{</span><span class="bu">len</span>(md_files)<span class="sc">}</span><span class="ss"> arquivos Markdown para HTML (OTIMIZADO)...&quot;</span>)</span>
<span id="cb14-879"><a href="#cb14-879" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-880"><a href="#cb14-880" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verifica se Pandoc est√° dispon√≠vel</span></span>
<span id="cb14-881"><a href="#cb14-881" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb14-882"><a href="#cb14-882" aria-hidden="true" tabindex="-1"></a>            subprocess.run([<span class="st">&#39;pandoc&#39;</span>, <span class="st">&#39;--version&#39;</span>], capture_output<span class="op">=</span><span class="va">True</span>, check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-883"><a href="#cb14-883" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">True</span></span>
<span id="cb14-884"><a href="#cb14-884" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;‚úÖ Pandoc dispon√≠vel - usando convers√£o otimizada&quot;</span>)</span>
<span id="cb14-885"><a href="#cb14-885" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb14-886"><a href="#cb14-886" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">False</span></span>
<span id="cb14-887"><a href="#cb14-887" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è Pandoc n√£o dispon√≠vel - usando fallback Python&quot;</span>)</span>
<span id="cb14-888"><a href="#cb14-888" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-889"><a href="#cb14-889" aria-hidden="true" tabindex="-1"></a>        converted_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-890"><a href="#cb14-890" aria-hidden="true" tabindex="-1"></a>        failed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-891"><a href="#cb14-891" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-892"><a href="#cb14-892" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> md_file <span class="kw">in</span> md_files:</span>
<span id="cb14-893"><a href="#cb14-893" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb14-894"><a href="#cb14-894" aria-hidden="true" tabindex="-1"></a>                html_file <span class="op">=</span> html_folder <span class="op">/</span> md_file.with_suffix(<span class="st">&#39;.html&#39;</span>).name</span>
<span id="cb14-895"><a href="#cb14-895" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-896"><a href="#cb14-896" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> html_file.exists():</span>
<span id="cb14-897"><a href="#cb14-897" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚è≠Ô∏è  J√° existe: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-898"><a href="#cb14-898" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-899"><a href="#cb14-899" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb14-900"><a href="#cb14-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-901"><a href="#cb14-901" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ Processando: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-902"><a href="#cb14-902" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-903"><a href="#cb14-903" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> pandoc_available:</span>
<span id="cb14-904"><a href="#cb14-904" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_pandoc_optimized(<span class="bu">str</span>(md_file))</span>
<span id="cb14-905"><a href="#cb14-905" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb14-906"><a href="#cb14-906" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_fallback(<span class="bu">str</span>(md_file))</span>
<span id="cb14-907"><a href="#cb14-907" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-908"><a href="#cb14-908" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> html_content:</span>
<span id="cb14-909"><a href="#cb14-909" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(html_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb14-910"><a href="#cb14-910" aria-hidden="true" tabindex="-1"></a>                        f.write(html_content)</span>
<span id="cb14-911"><a href="#cb14-911" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb14-912"><a href="#cb14-912" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Criado: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-913"><a href="#cb14-913" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-914"><a href="#cb14-914" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb14-915"><a href="#cb14-915" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Falha na convers√£o: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-916"><a href="#cb14-916" aria-hidden="true" tabindex="-1"></a>                    failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-917"><a href="#cb14-917" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb14-918"><a href="#cb14-918" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb14-919"><a href="#cb14-919" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro em </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-920"><a href="#cb14-920" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(traceback.format_exc())</span>
<span id="cb14-921"><a href="#cb14-921" aria-hidden="true" tabindex="-1"></a>                failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-922"><a href="#cb14-922" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-923"><a href="#cb14-923" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä HTML: </span><span class="sc">{</span>converted_count<span class="sc">}</span><span class="ss"> arquivos criados, </span><span class="sc">{</span>failed_count<span class="sc">}</span><span class="ss"> falhas em &#39;</span><span class="sc">{</span>html_folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb14-924"><a href="#cb14-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-925"><a href="#cb14-925" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> categorize_conversation(<span class="va">self</span>, title: <span class="bu">str</span>, summary: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb14-926"><a href="#cb14-926" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Categoriza√ß√£o otimizada com express√µes regulares&quot;&quot;&quot;</span></span>
<span id="cb14-927"><a href="#cb14-927" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&quot;</span>.lower()</span>
<span id="cb14-928"><a href="#cb14-928" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-929"><a href="#cb14-929" aria-hidden="true" tabindex="-1"></a>        patterns <span class="op">=</span> {</span>
<span id="cb14-930"><a href="#cb14-930" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Tecnologia&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">tecnologia</span><span class="cf">|</span><span class="vs">hardware</span><span class="cf">|</span><span class="vs">software</span><span class="cf">|</span><span class="vs">rede</span><span class="cf">|</span><span class="vs">internet</span><span class="cf">|</span><span class="vs">wifi</span><span class="cf">|</span><span class="vs">bluetooth</span><span class="cf">|</span><span class="pp">[45]</span><span class="vs">g</span><span class="cf">|</span><span class="vs">cloud</span><span class="cf">|</span><span class="vs">aws</span><span class="cf">|</span><span class="vs">azure</span><span class="cf">|</span><span class="vs">gcp</span><span class="cf">|</span><span class="vs">servidor</span><span class="cf">|</span><span class="vs">hosting</span><span class="cf">|</span><span class="vs">dom√≠nio</span><span class="cf">|</span><span class="vs">ssl</span><span class="cf">|</span><span class="vs">router</span><span class="cf">|</span><span class="vs">switch</span><span class="cf">|</span><span class="vs">firewall</span><span class="cf">|</span><span class="vs">iot</span><span class="cf">|</span><span class="vs">smartphone</span><span class="cf">|</span><span class="vs">tablet</span><span class="cf">|</span><span class="vs">navegador</span><span class="cf">|</span><span class="vs">browser</span><span class="cf">|</span><span class="vs">chrome</span><span class="cf">|</span><span class="vs">firefox</span><span class="cf">|</span><span class="vs">edge</span><span class="cf">|</span><span class="vs">safari</span><span class="cf">|</span><span class="vs">email</span><span class="cf">|</span><span class="vs">gmail</span><span class="cf">|</span><span class="vs">outlook</span><span class="cf">|</span><span class="vs">criptografia</span><span class="cf">|</span><span class="vs">seguran√ßa</span><span class="cf">|</span><span class="vs">ciberseguran√ßa</span><span class="cf">|</span><span class="vs">ransomware</span><span class="cf">|</span><span class="vs">phishing</span><span class="cf">|</span><span class="vs">autentica√ß√£o</span><span class="cf">|</span><span class="vs">2fa</span><span class="cf">|</span><span class="vs">biometria</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb14-931"><a href="#cb14-931" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Sa√∫de&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">sa√∫de</span><span class="cf">|</span><span class="vs">medicina</span><span class="cf">|</span><span class="vs">m√©dico</span><span class="cf">|</span><span class="vs">enfermagem</span><span class="cf">|</span><span class="vs">doen√ßa</span><span class="cf">|</span><span class="vs">v√≠rus</span><span class="cf">|</span><span class="vs">bact√©ria</span><span class="cf">|</span><span class="vs">vacina</span><span class="cf">|</span><span class="vs">covid</span><span class="cf">|</span><span class="vs">coronav√≠rus</span><span class="cf">|</span><span class="vs">gripe</span><span class="cf">|</span><span class="vs">febre</span><span class="cf">|</span><span class="vs">dor</span><span class="cf">|</span><span class="vs">an√°lise</span><span class="cf">|</span><span class="vs">exame</span><span class="cf">|</span><span class="vs">raio x</span><span class="cf">|</span><span class="vs">resson√¢ncia</span><span class="cf">|</span><span class="vs">hospital</span><span class="cf">|</span><span class="vs">cl√≠nica</span><span class="cf">|</span><span class="vs">farm√°cia</span><span class="cf">|</span><span class="vs">medicamento</span><span class="cf">|</span><span class="vs">rem√©dio</span><span class="cf">|</span><span class="vs">psicologia</span><span class="cf">|</span><span class="vs">terapia</span><span class="cf">|</span><span class="vs">bem-estar</span><span class="cf">|</span><span class="vs">nutri√ß√£o</span><span class="cf">|</span><span class="vs">dieta</span><span class="cf">|</span><span class="vs">exerc√≠cio</span><span class="cf">|</span><span class="vs">fitness</span><span class="cf">|</span><span class="vs">sono</span><span class="cf">|</span><span class="vs">sa√∫de mental</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb14-932"><a href="#cb14-932" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Programa√ß√£o&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">python</span><span class="cf">|</span><span class="vs">javascript</span><span class="cf">|</span><span class="vs">java</span><span class="cf">|</span><span class="vs">c</span><span class="ch">\+\+</span><span class="cf">|</span><span class="vs">c#</span><span class="cf">|</span><span class="vs">go</span><span class="cf">|</span><span class="vs">rust</span><span class="cf">|</span><span class="vs">lua</span><span class="cf">|</span><span class="vs">bash</span><span class="cf">|</span><span class="vs">script</span><span class="cf">|</span><span class="vs">debug</span><span class="cf">|</span><span class="vs">erro</span><span class="cf">|</span><span class="vs">conda</span><span class="cf">|</span><span class="vs">mamba</span><span class="cf">|</span><span class="vs">pandoc</span><span class="cf">|</span><span class="vs">msys2</span><span class="cf">|</span><span class="vs">spyder</span><span class="cf">|</span><span class="vs">jupyter</span><span class="cf">|</span><span class="vs">pip</span><span class="cf">|</span><span class="vs">venv</span><span class="cf">|</span><span class="vs">docker</span><span class="cf">|</span><span class="vs">git</span><span class="cf">|</span><span class="vs">github</span><span class="cf">|</span><span class="vs">vscode</span><span class="cf">|</span><span class="vs">ide</span><span class="cf">|</span><span class="vs">programa</span><span class="cf">|</span><span class="vs">c√≥digo</span><span class="cf">|</span><span class="vs">fun√ß√£o</span><span class="cf">|</span><span class="vs">classe</span><span class="cf">|</span><span class="vs">api</span><span class="cf">|</span><span class="vs">selenium</span><span class="cf">|</span><span class="vs">playwright</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb14-933"><a href="#cb14-933" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Sistemas&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">windows</span><span class="cf">|</span><span class="vs">linux</span><span class="cf">|</span><span class="vs">macos</span><span class="cf">|</span><span class="vs">so</span><span class="cf">|</span><span class="vs">sistema operacional</span><span class="cf">|</span><span class="vs">driver</span><span class="cf">|</span><span class="vs">registry</span><span class="cf">|</span><span class="vs">process</span><span class="cf">|</span><span class="vs">firewall</span><span class="cf">|</span><span class="vs">bios</span><span class="cf">|</span><span class="vs">boot</span><span class="cf">|</span><span class="vs">path</span><span class="cf">|</span><span class="vs">dll</span><span class="cf">|</span><span class="vs">exe</span><span class="cf">|</span><span class="vs">powershell</span><span class="cf">|</span><span class="vs">cmd</span><span class="cf">|</span><span class="vs">terminal</span><span class="cf">|</span><span class="vs">shell</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb14-934"><a href="#cb14-934" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;IA&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">ia</span><span class="cf">|</span><span class="vs">gpt</span><span class="cf">|</span><span class="vs">chatgpt</span><span class="cf">|</span><span class="vs">grok</span><span class="cf">|</span><span class="vs">qwen</span><span class="cf">|</span><span class="vs">deepseek</span><span class="cf">|</span><span class="vs">llm</span><span class="cf">|</span><span class="vs">modelo</span><span class="cf">|</span><span class="vs">prompt</span><span class="cf">|</span><span class="vs">token</span><span class="cf">|</span><span class="vs">embedding</span><span class="cf">|</span><span class="vs">fine-tune</span><span class="cf">|</span><span class="vs">neural</span><span class="cf">|</span><span class="vs">chatbot</span><span class="cf">|</span><span class="vs">intelig√™ncia artificial</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb14-935"><a href="#cb14-935" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Dados&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">dados</span><span class="cf">|</span><span class="vs">data</span><span class="cf">|</span><span class="vs">csv</span><span class="cf">|</span><span class="vs">json</span><span class="cf">|</span><span class="vs">pandas</span><span class="cf">|</span><span class="vs">numpy</span><span class="cf">|</span><span class="vs">excel</span><span class="cf">|</span><span class="vs">sql</span><span class="cf">|</span><span class="vs">banco</span><span class="cf">|</span><span class="vs">sqlite</span><span class="cf">|</span><span class="vs">postgres</span><span class="cf">|</span><span class="vs">visualiza√ß√£o</span><span class="cf">|</span><span class="vs">gr√°fico</span><span class="cf">|</span><span class="vs">tabela</span><span class="cf">|</span><span class="vs">an√°lise</span><span class="cf">|</span><span class="vs">etl</span><span class="cf">|</span><span class="vs">dashboard</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb14-936"><a href="#cb14-936" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Geral&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">geral</span><span class="cf">|</span><span class="vs">pergunta</span><span class="cf">|</span><span class="vs">ajuda</span><span class="cf">|</span><span class="vs">como fazer</span><span class="cf">|</span><span class="vs">explicar</span><span class="cf">|</span><span class="vs">resumo</span><span class="cf">|</span><span class="vs">tutorial b√°sico</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span></span>
<span id="cb14-937"><a href="#cb14-937" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb14-938"><a href="#cb14-938" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-939"><a href="#cb14-939" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category, pattern <span class="kw">in</span> patterns.items():</span>
<span id="cb14-940"><a href="#cb14-940" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> re.search(pattern, text, re.IGNORECASE):</span>
<span id="cb14-941"><a href="#cb14-941" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> category</span>
<span id="cb14-942"><a href="#cb14-942" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-943"><a href="#cb14-943" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Outros&#39;</span></span>
<span id="cb14-944"><a href="#cb14-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-945"><a href="#cb14-945" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_timestamp_for_sorting(<span class="va">self</span>, timestamp) <span class="op">-&gt;</span> datetime:</span>
<span id="cb14-946"><a href="#cb14-946" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> timestamp:</span>
<span id="cb14-947"><a href="#cb14-947" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> datetime.<span class="bu">min</span></span>
<span id="cb14-948"><a href="#cb14-948" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-949"><a href="#cb14-949" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb14-950"><a href="#cb14-950" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(timestamp, <span class="bu">str</span>):</span>
<span id="cb14-951"><a href="#cb14-951" aria-hidden="true" tabindex="-1"></a>                clean_ts <span class="op">=</span> timestamp.replace(<span class="st">&#39;T&#39;</span>, <span class="st">&#39; &#39;</span>).split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>].split(<span class="st">&#39;+&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb14-952"><a href="#cb14-952" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> clean_ts.endswith(<span class="st">&#39;Z&#39;</span>):</span>
<span id="cb14-953"><a href="#cb14-953" aria-hidden="true" tabindex="-1"></a>                    clean_ts <span class="op">=</span> clean_ts[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb14-954"><a href="#cb14-954" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> datetime.fromisoformat(clean_ts)</span>
<span id="cb14-955"><a href="#cb14-955" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(timestamp, (<span class="bu">int</span>, <span class="bu">float</span>)):</span>
<span id="cb14-956"><a href="#cb14-956" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> datetime.fromtimestamp(timestamp)</span>
<span id="cb14-957"><a href="#cb14-957" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb14-958"><a href="#cb14-958" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb14-959"><a href="#cb14-959" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-960"><a href="#cb14-960" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> datetime.<span class="bu">min</span></span>
<span id="cb14-961"><a href="#cb14-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-962"><a href="#cb14-962" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> format_timestamp(<span class="va">self</span>, timestamp) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb14-963"><a href="#cb14-963" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> timestamp:</span>
<span id="cb14-964"><a href="#cb14-964" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb14-965"><a href="#cb14-965" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-966"><a href="#cb14-966" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb14-967"><a href="#cb14-967" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(timestamp, (<span class="bu">int</span>, <span class="bu">float</span>)):</span>
<span id="cb14-968"><a href="#cb14-968" aria-hidden="true" tabindex="-1"></a>                dt <span class="op">=</span> datetime.fromtimestamp(timestamp)</span>
<span id="cb14-969"><a href="#cb14-969" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> dt.strftime(<span class="st">&#39;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S&#39;</span>)</span>
<span id="cb14-970"><a href="#cb14-970" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(timestamp, <span class="bu">str</span>):</span>
<span id="cb14-971"><a href="#cb14-971" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">&#39;T&#39;</span> <span class="kw">in</span> timestamp:</span>
<span id="cb14-972"><a href="#cb14-972" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> timestamp.replace(<span class="st">&#39;T&#39;</span>, <span class="st">&#39; &#39;</span>).split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb14-973"><a href="#cb14-973" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> timestamp</span>
<span id="cb14-974"><a href="#cb14-974" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb14-975"><a href="#cb14-975" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb14-976"><a href="#cb14-976" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-977"><a href="#cb14-977" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">str</span>(timestamp)</span>
<span id="cb14-978"><a href="#cb14-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-979"><a href="#cb14-979" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_enhanced_markdown_content(<span class="va">self</span>, conversation: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb14-980"><a href="#cb14-980" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Gera conte√∫do Markdown com preserva√ß√£o total de formata√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb14-981"><a href="#cb14-981" aria-hidden="true" tabindex="-1"></a>        lines <span class="op">=</span> [</span>
<span id="cb14-982"><a href="#cb14-982" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;# </span><span class="sc">{</span>conversation[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb14-983"><a href="#cb14-983" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb14-984"><a href="#cb14-984" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;## üìä Informa√ß√µes&quot;</span>,</span>
<span id="cb14-985"><a href="#cb14-985" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **N√∫mero:** #</span><span class="sc">{</span>conversation[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb14-986"><a href="#cb14-986" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Origem:** </span><span class="sc">{</span>conversation[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb14-987"><a href="#cb14-987" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Categoria:** </span><span class="sc">{</span>conversation[<span class="st">&#39;category&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb14-988"><a href="#cb14-988" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **ID:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;id&#39;</span>, <span class="st">&#39;N/A&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb14-989"><a href="#cb14-989" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Criada em:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> conversation<span class="sc">.</span>get(<span class="st">&#39;created_at&#39;</span>) <span class="kw">or</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb14-990"><a href="#cb14-990" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb14-991"><a href="#cb14-991" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-992"><a href="#cb14-992" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> conversation.get(<span class="st">&#39;updated_at&#39;</span>):</span>
<span id="cb14-993"><a href="#cb14-993" aria-hidden="true" tabindex="-1"></a>            lines.append(<span class="ss">f&quot;- **Atualizada em:** </span><span class="sc">{</span>conversation[<span class="st">&#39;updated_at&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-994"><a href="#cb14-994" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-995"><a href="#cb14-995" aria-hidden="true" tabindex="-1"></a>        lines.extend([</span>
<span id="cb14-996"><a href="#cb14-996" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Total de mensagens:** </span><span class="sc">{</span><span class="bu">len</span>(conversation[<span class="st">&#39;messages&#39;</span>])<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb14-997"><a href="#cb14-997" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Resumo:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;Sem resumo&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb14-998"><a href="#cb14-998" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb14-999"><a href="#cb14-999" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;---&quot;</span>,</span>
<span id="cb14-1000"><a href="#cb14-1000" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb14-1001"><a href="#cb14-1001" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;## üí¨ Conversa&quot;</span>,</span>
<span id="cb14-1002"><a href="#cb14-1002" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span></span>
<span id="cb14-1003"><a href="#cb14-1003" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb14-1004"><a href="#cb14-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1005"><a href="#cb14-1005" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, msg <span class="kw">in</span> <span class="bu">enumerate</span>(conversation[<span class="st">&#39;messages&#39;</span>], <span class="dv">1</span>):</span>
<span id="cb14-1006"><a href="#cb14-1006" aria-hidden="true" tabindex="-1"></a>            timestamp <span class="op">=</span> <span class="ss">f&quot; *(</span><span class="sc">{</span>msg[<span class="st">&#39;timestamp&#39;</span>]<span class="sc">}</span><span class="ss">)*&quot;</span> <span class="cf">if</span> msg[<span class="st">&#39;timestamp&#39;</span>] <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb14-1007"><a href="#cb14-1007" aria-hidden="true" tabindex="-1"></a>            model_info <span class="op">=</span> <span class="ss">f&quot; *[</span><span class="sc">{</span>msg<span class="sc">.</span>get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;&#39;</span>)<span class="sc">}</span><span class="ss">]*&quot;</span> <span class="cf">if</span> msg.get(<span class="st">&#39;model&#39;</span>) <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb14-1008"><a href="#cb14-1008" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1009"><a href="#cb14-1009" aria-hidden="true" tabindex="-1"></a>            preserved_content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(msg[<span class="st">&#39;content&#39;</span>])</span>
<span id="cb14-1010"><a href="#cb14-1010" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1011"><a href="#cb14-1011" aria-hidden="true" tabindex="-1"></a>            lines.extend([</span>
<span id="cb14-1012"><a href="#cb14-1012" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;### </span><span class="sc">{</span>msg[<span class="st">&#39;author&#39;</span>]<span class="sc">}{</span>timestamp<span class="sc">}{</span>model_info<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb14-1013"><a href="#cb14-1013" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;&quot;</span>,</span>
<span id="cb14-1014"><a href="#cb14-1014" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;</span><span class="sc">{</span>preserved_content<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb14-1015"><a href="#cb14-1015" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;&quot;</span></span>
<span id="cb14-1016"><a href="#cb14-1016" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb14-1017"><a href="#cb14-1017" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1018"><a href="#cb14-1018" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> j <span class="op">&lt;</span> <span class="bu">len</span>(conversation[<span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb14-1019"><a href="#cb14-1019" aria-hidden="true" tabindex="-1"></a>                lines.extend([<span class="st">&quot;---&quot;</span>, <span class="st">&quot;&quot;</span>])</span>
<span id="cb14-1020"><a href="#cb14-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1021"><a href="#cb14-1021" aria-hidden="true" tabindex="-1"></a>        lines.extend([</span>
<span id="cb14-1022"><a href="#cb14-1022" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;---&quot;</span>,</span>
<span id="cb14-1023"><a href="#cb14-1023" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb14-1024"><a href="#cb14-1024" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;*Conversa exportada do </span><span class="sc">{</span>conversation[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">*&quot;</span>,</span>
<span id="cb14-1025"><a href="#cb14-1025" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;*Processado em: </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">.</span>strftime(<span class="st">&#39;</span><span class="sc">%d</span><span class="st">/%m/%Y %H:%M&#39;</span>)<span class="sc">}</span><span class="ss">*&quot;</span></span>
<span id="cb14-1026"><a href="#cb14-1026" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb14-1027"><a href="#cb14-1027" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-1028"><a href="#cb14-1028" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(lines)</span>
<span id="cb14-1029"><a href="#cb14-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1030"><a href="#cb14-1030" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_qwen_enhanced(<span class="va">self</span>, path: Path):</span>
<span id="cb14-1031"><a href="#cb14-1031" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa Qwen3 com preserva√ß√£o total de conte√∫do&quot;&quot;&quot;</span></span>
<span id="cb14-1032"><a href="#cb14-1032" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb14-1033"><a href="#cb14-1033" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria Qwen3: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1034"><a href="#cb14-1034" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb14-1035"><a href="#cb14-1035" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1036"><a href="#cb14-1036" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb14-1037"><a href="#cb14-1037" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb14-1038"><a href="#cb14-1038" aria-hidden="true" tabindex="-1"></a>                raw <span class="op">=</span> json.load(f)</span>
<span id="cb14-1039"><a href="#cb14-1039" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1040"><a href="#cb14-1040" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> raw.get(<span class="st">&#39;data&#39;</span>, [])</span>
<span id="cb14-1041"><a href="#cb14-1041" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">list</span>):</span>
<span id="cb14-1042"><a href="#cb14-1042" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  Qwen3: &#39;data&#39; n√£o √© uma lista.&quot;</span>)</span>
<span id="cb14-1043"><a href="#cb14-1043" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb14-1044"><a href="#cb14-1044" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1045"><a href="#cb14-1045" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Qwen3: encontradas </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb14-1046"><a href="#cb14-1046" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-1047"><a href="#cb14-1047" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1048"><a href="#cb14-1048" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb14-1049"><a href="#cb14-1049" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa Qwen </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb14-1050"><a href="#cb14-1050" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb14-1051"><a href="#cb14-1051" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb14-1052"><a href="#cb14-1052" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1053"><a href="#cb14-1053" aria-hidden="true" tabindex="-1"></a>                history <span class="op">=</span> conv.get(<span class="st">&#39;chat&#39;</span>, {}).get(<span class="st">&#39;history&#39;</span>, {})</span>
<span id="cb14-1054"><a href="#cb14-1054" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb14-1055"><a href="#cb14-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1056"><a href="#cb14-1056" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> history:</span>
<span id="cb14-1057"><a href="#cb14-1057" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb14-1058"><a href="#cb14-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1059"><a href="#cb14-1059" aria-hidden="true" tabindex="-1"></a>                messages_dict <span class="op">=</span> history.get(<span class="st">&#39;messages&#39;</span>, {})</span>
<span id="cb14-1060"><a href="#cb14-1060" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1061"><a href="#cb14-1061" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(messages_dict, <span class="bu">dict</span>):</span>
<span id="cb14-1062"><a href="#cb14-1062" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb14-1063"><a href="#cb14-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1064"><a href="#cb14-1064" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìù Conversa </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: &#39;</span><span class="sc">{</span>clean_title<span class="sc">}</span><span class="ss">&#39; - </span><span class="sc">{</span><span class="bu">len</span>(messages_dict)<span class="sc">}</span><span class="ss"> mensagens&quot;</span>)</span>
<span id="cb14-1065"><a href="#cb14-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1066"><a href="#cb14-1066" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> message_id, message_data <span class="kw">in</span> messages_dict.items():</span>
<span id="cb14-1067"><a href="#cb14-1067" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(message_data, <span class="bu">dict</span>):</span>
<span id="cb14-1068"><a href="#cb14-1068" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb14-1069"><a href="#cb14-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1070"><a href="#cb14-1070" aria-hidden="true" tabindex="-1"></a>                    role <span class="op">=</span> message_data.get(<span class="st">&#39;role&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb14-1071"><a href="#cb14-1071" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> message_data.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb14-1072"><a href="#cb14-1072" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb14-1073"><a href="#cb14-1073" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content <span class="kw">or</span> <span class="kw">not</span> role:</span>
<span id="cb14-1074"><a href="#cb14-1074" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb14-1075"><a href="#cb14-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1076"><a href="#cb14-1076" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> role <span class="op">==</span> <span class="st">&#39;user&#39;</span>:</span>
<span id="cb14-1077"><a href="#cb14-1077" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb14-1078"><a href="#cb14-1078" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> role <span class="op">==</span> <span class="st">&#39;assistant&#39;</span>:</span>
<span id="cb14-1079"><a href="#cb14-1079" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ Qwen3&quot;</span></span>
<span id="cb14-1080"><a href="#cb14-1080" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb14-1081"><a href="#cb14-1081" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb14-1082"><a href="#cb14-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1083"><a href="#cb14-1083" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(content, <span class="bu">list</span>):</span>
<span id="cb14-1084"><a href="#cb14-1084" aria-hidden="true" tabindex="-1"></a>                        text_parts <span class="op">=</span> []</span>
<span id="cb14-1085"><a href="#cb14-1085" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">for</span> block <span class="kw">in</span> content:</span>
<span id="cb14-1086"><a href="#cb14-1086" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> <span class="bu">isinstance</span>(block, <span class="bu">dict</span>):</span>
<span id="cb14-1087"><a href="#cb14-1087" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> block.get(<span class="st">&#39;type&#39;</span>) <span class="op">==</span> <span class="st">&#39;text&#39;</span>:</span>
<span id="cb14-1088"><a href="#cb14-1088" aria-hidden="true" tabindex="-1"></a>                                    text_parts.append(block.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>))</span>
<span id="cb14-1089"><a href="#cb14-1089" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">elif</span> block.get(<span class="st">&#39;type&#39;</span>) <span class="op">==</span> <span class="st">&#39;image&#39;</span>:</span>
<span id="cb14-1090"><a href="#cb14-1090" aria-hidden="true" tabindex="-1"></a>                                    image_info <span class="op">=</span> block.get(<span class="st">&#39;image&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb14-1091"><a href="#cb14-1091" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">if</span> image_info:</span>
<span id="cb14-1092"><a href="#cb14-1092" aria-hidden="true" tabindex="-1"></a>                                        text_parts.append(<span class="ss">f&quot;![Imagem](</span><span class="sc">{</span>image_info<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb14-1093"><a href="#cb14-1093" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">elif</span> <span class="bu">isinstance</span>(block, <span class="bu">str</span>):</span>
<span id="cb14-1094"><a href="#cb14-1094" aria-hidden="true" tabindex="-1"></a>                                text_parts.append(block)</span>
<span id="cb14-1095"><a href="#cb14-1095" aria-hidden="true" tabindex="-1"></a>                        final_content <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(text_parts).strip()</span>
<span id="cb14-1096"><a href="#cb14-1096" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb14-1097"><a href="#cb14-1097" aria-hidden="true" tabindex="-1"></a>                        final_content <span class="op">=</span> <span class="bu">str</span>(content).strip()</span>
<span id="cb14-1098"><a href="#cb14-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1099"><a href="#cb14-1099" aria-hidden="true" tabindex="-1"></a>                    final_content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(final_content)</span>
<span id="cb14-1100"><a href="#cb14-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1101"><a href="#cb14-1101" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> final_content <span class="kw">or</span> final_content <span class="op">==</span> <span class="st">&#39;null&#39;</span>:</span>
<span id="cb14-1102"><a href="#cb14-1102" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb14-1103"><a href="#cb14-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1104"><a href="#cb14-1104" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb14-1105"><a href="#cb14-1105" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb14-1106"><a href="#cb14-1106" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb14-1107"><a href="#cb14-1107" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: final_content,</span>
<span id="cb14-1108"><a href="#cb14-1108" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(message_data.get(<span class="st">&#39;created_at&#39;</span>)),</span>
<span id="cb14-1109"><a href="#cb14-1109" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: message_data.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;Qwen3&#39;</span>)</span>
<span id="cb14-1110"><a href="#cb14-1110" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb14-1111"><a href="#cb14-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1112"><a href="#cb14-1112" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb14-1113"><a href="#cb14-1113" aria-hidden="true" tabindex="-1"></a>                    messages.sort(key<span class="op">=</span><span class="kw">lambda</span> x: <span class="va">self</span>.parse_timestamp_for_sorting(x[<span class="st">&#39;timestamp&#39;</span>]))</span>
<span id="cb14-1114"><a href="#cb14-1114" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb14-1115"><a href="#cb14-1115" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb14-1116"><a href="#cb14-1116" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb14-1117"><a href="#cb14-1117" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;Qwen3&#39;</span>,</span>
<span id="cb14-1118"><a href="#cb14-1118" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;qwen_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb14-1119"><a href="#cb14-1119" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;created_at&#39;</span>)),</span>
<span id="cb14-1120"><a href="#cb14-1120" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;updated_at&#39;</span>)),</span>
<span id="cb14-1121"><a href="#cb14-1121" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb14-1122"><a href="#cb14-1122" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb14-1123"><a href="#cb14-1123" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb14-1124"><a href="#cb14-1124" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb14-1125"><a href="#cb14-1125" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-1126"><a href="#cb14-1126" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;   ‚úÖ Adicionada: </span><span class="sc">{</span><span class="bu">len</span>(messages)<span class="sc">}</span><span class="ss"> mensagens&quot;</span>)</span>
<span id="cb14-1127"><a href="#cb14-1127" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb14-1128"><a href="#cb14-1128" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Qwen3: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb14-1129"><a href="#cb14-1129" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1130"><a href="#cb14-1130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb14-1131"><a href="#cb14-1131" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar Qwen3: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1132"><a href="#cb14-1132" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb14-1133"><a href="#cb14-1133" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb14-1134"><a href="#cb14-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1135"><a href="#cb14-1135" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_chatgpt(<span class="va">self</span>, path: Path):</span>
<span id="cb14-1136"><a href="#cb14-1136" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do ChatGPT&quot;&quot;&quot;</span></span>
<span id="cb14-1137"><a href="#cb14-1137" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb14-1138"><a href="#cb14-1138" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria ChatGPT: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1139"><a href="#cb14-1139" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb14-1140"><a href="#cb14-1140" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1141"><a href="#cb14-1141" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb14-1142"><a href="#cb14-1142" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;chatgpt_&quot;</span>)</span>
<span id="cb14-1143"><a href="#cb14-1143" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb14-1144"><a href="#cb14-1144" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb14-1145"><a href="#cb14-1145" aria-hidden="true" tabindex="-1"></a>            convs_path <span class="op">=</span> Path(temp_dir) <span class="op">/</span> <span class="st">&quot;conversations.json&quot;</span></span>
<span id="cb14-1146"><a href="#cb14-1146" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> convs_path.exists():</span>
<span id="cb14-1147"><a href="#cb14-1147" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå ChatGPT: conversations.json n√£o encontrado.&quot;</span>)</span>
<span id="cb14-1148"><a href="#cb14-1148" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb14-1149"><a href="#cb14-1149" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1150"><a href="#cb14-1150" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(convs_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb14-1151"><a href="#cb14-1151" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.load(f)</span>
<span id="cb14-1152"><a href="#cb14-1152" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1153"><a href="#cb14-1153" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">list</span>):</span>
<span id="cb14-1154"><a href="#cb14-1154" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  ChatGPT: estrutura inesperada.&quot;</span>)</span>
<span id="cb14-1155"><a href="#cb14-1155" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb14-1156"><a href="#cb14-1156" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1157"><a href="#cb14-1157" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç ChatGPT: encontradas </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb14-1158"><a href="#cb14-1158" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-1159"><a href="#cb14-1159" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1160"><a href="#cb14-1160" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb14-1161"><a href="#cb14-1161" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa ChatGPT </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb14-1162"><a href="#cb14-1162" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb14-1163"><a href="#cb14-1163" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb14-1164"><a href="#cb14-1164" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1165"><a href="#cb14-1165" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb14-1166"><a href="#cb14-1166" aria-hidden="true" tabindex="-1"></a>                mapping <span class="op">=</span> conv.get(<span class="st">&#39;mapping&#39;</span>, {})</span>
<span id="cb14-1167"><a href="#cb14-1167" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1168"><a href="#cb14-1168" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> msg_id, node <span class="kw">in</span> mapping.items():</span>
<span id="cb14-1169"><a href="#cb14-1169" aria-hidden="true" tabindex="-1"></a>                    msg_data <span class="op">=</span> node.get(<span class="st">&#39;message&#39;</span>)</span>
<span id="cb14-1170"><a href="#cb14-1170" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> msg_data <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(msg_data, <span class="bu">dict</span>):</span>
<span id="cb14-1171"><a href="#cb14-1171" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb14-1172"><a href="#cb14-1172" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb14-1173"><a href="#cb14-1173" aria-hidden="true" tabindex="-1"></a>                    author_role <span class="op">=</span> msg_data.get(<span class="st">&#39;author&#39;</span>, {}).get(<span class="st">&#39;role&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb14-1174"><a href="#cb14-1174" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> author_role <span class="op">==</span> <span class="st">&#39;user&#39;</span>:</span>
<span id="cb14-1175"><a href="#cb14-1175" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb14-1176"><a href="#cb14-1176" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;user&#39;</span></span>
<span id="cb14-1177"><a href="#cb14-1177" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> author_role <span class="op">==</span> <span class="st">&#39;assistant&#39;</span>:</span>
<span id="cb14-1178"><a href="#cb14-1178" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ ChatGPT&quot;</span></span>
<span id="cb14-1179"><a href="#cb14-1179" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;assistant&#39;</span></span>
<span id="cb14-1180"><a href="#cb14-1180" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb14-1181"><a href="#cb14-1181" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb14-1182"><a href="#cb14-1182" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb14-1183"><a href="#cb14-1183" aria-hidden="true" tabindex="-1"></a>                    content_parts <span class="op">=</span> []</span>
<span id="cb14-1184"><a href="#cb14-1184" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> part <span class="kw">in</span> msg_data.get(<span class="st">&#39;content&#39;</span>, {}).get(<span class="st">&#39;parts&#39;</span>, []):</span>
<span id="cb14-1185"><a href="#cb14-1185" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(part, <span class="bu">str</span>):</span>
<span id="cb14-1186"><a href="#cb14-1186" aria-hidden="true" tabindex="-1"></a>                            content_parts.append(part)</span>
<span id="cb14-1187"><a href="#cb14-1187" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(content_parts).strip()</span>
<span id="cb14-1188"><a href="#cb14-1188" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb14-1189"><a href="#cb14-1189" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb14-1190"><a href="#cb14-1190" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb14-1191"><a href="#cb14-1191" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb14-1192"><a href="#cb14-1192" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb14-1193"><a href="#cb14-1193" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb14-1194"><a href="#cb14-1194" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb14-1195"><a href="#cb14-1195" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb14-1196"><a href="#cb14-1196" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb14-1197"><a href="#cb14-1197" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb14-1198"><a href="#cb14-1198" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(msg_data.get(<span class="st">&#39;create_time&#39;</span>)),</span>
<span id="cb14-1199"><a href="#cb14-1199" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg_data.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;ChatGPT&#39;</span>)</span>
<span id="cb14-1200"><a href="#cb14-1200" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb14-1201"><a href="#cb14-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1202"><a href="#cb14-1202" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb14-1203"><a href="#cb14-1203" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb14-1204"><a href="#cb14-1204" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb14-1205"><a href="#cb14-1205" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;ChatGPT&#39;</span>,</span>
<span id="cb14-1206"><a href="#cb14-1206" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;chatgpt_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb14-1207"><a href="#cb14-1207" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;create_time&#39;</span>)),</span>
<span id="cb14-1208"><a href="#cb14-1208" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;update_time&#39;</span>)),</span>
<span id="cb14-1209"><a href="#cb14-1209" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb14-1210"><a href="#cb14-1210" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb14-1211"><a href="#cb14-1211" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb14-1212"><a href="#cb14-1212" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb14-1213"><a href="#cb14-1213" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-1214"><a href="#cb14-1214" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb14-1215"><a href="#cb14-1215" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ ChatGPT: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb14-1216"><a href="#cb14-1216" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1217"><a href="#cb14-1217" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb14-1218"><a href="#cb14-1218" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar ChatGPT: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1219"><a href="#cb14-1219" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb14-1220"><a href="#cb14-1220" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb14-1221"><a href="#cb14-1221" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb14-1222"><a href="#cb14-1222" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb14-1223"><a href="#cb14-1223" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-1224"><a href="#cb14-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1225"><a href="#cb14-1225" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_deepseek(<span class="va">self</span>, path: Path):</span>
<span id="cb14-1226"><a href="#cb14-1226" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do DeepSeek&quot;&quot;&quot;</span></span>
<span id="cb14-1227"><a href="#cb14-1227" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb14-1228"><a href="#cb14-1228" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria DeepSeek: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1229"><a href="#cb14-1229" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb14-1230"><a href="#cb14-1230" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1231"><a href="#cb14-1231" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb14-1232"><a href="#cb14-1232" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;deepseek_&quot;</span>)</span>
<span id="cb14-1233"><a href="#cb14-1233" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb14-1234"><a href="#cb14-1234" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb14-1235"><a href="#cb14-1235" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1236"><a href="#cb14-1236" aria-hidden="true" tabindex="-1"></a>            convs_path <span class="op">=</span> Path(temp_dir) <span class="op">/</span> <span class="st">&quot;conversations.json&quot;</span></span>
<span id="cb14-1237"><a href="#cb14-1237" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> convs_path.exists():</span>
<span id="cb14-1238"><a href="#cb14-1238" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå DeepSeek: conversations.json n√£o encontrado.&quot;</span>)</span>
<span id="cb14-1239"><a href="#cb14-1239" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb14-1240"><a href="#cb14-1240" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1241"><a href="#cb14-1241" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(convs_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb14-1242"><a href="#cb14-1242" aria-hidden="true" tabindex="-1"></a>                raw_data <span class="op">=</span> json.load(f)</span>
<span id="cb14-1243"><a href="#cb14-1243" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1244"><a href="#cb14-1244" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">list</span>):</span>
<span id="cb14-1245"><a href="#cb14-1245" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> raw_data</span>
<span id="cb14-1246"><a href="#cb14-1246" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;data&#39;</span> <span class="kw">in</span> raw_data:</span>
<span id="cb14-1247"><a href="#cb14-1247" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> raw_data[<span class="st">&#39;data&#39;</span>]</span>
<span id="cb14-1248"><a href="#cb14-1248" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb14-1249"><a href="#cb14-1249" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  DeepSeek: estrutura inesperada.&quot;</span>)</span>
<span id="cb14-1250"><a href="#cb14-1250" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb14-1251"><a href="#cb14-1251" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1252"><a href="#cb14-1252" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">list</span>):</span>
<span id="cb14-1253"><a href="#cb14-1253" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  DeepSeek: &#39;data&#39; n√£o √© uma lista.&quot;</span>)</span>
<span id="cb14-1254"><a href="#cb14-1254" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb14-1255"><a href="#cb14-1255" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1256"><a href="#cb14-1256" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç DeepSeek: encontradas </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb14-1257"><a href="#cb14-1257" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-1258"><a href="#cb14-1258" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1259"><a href="#cb14-1259" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb14-1260"><a href="#cb14-1260" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa DeepSeek </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb14-1261"><a href="#cb14-1261" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb14-1262"><a href="#cb14-1262" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb14-1263"><a href="#cb14-1263" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1264"><a href="#cb14-1264" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb14-1265"><a href="#cb14-1265" aria-hidden="true" tabindex="-1"></a>                mapping <span class="op">=</span> conv.get(<span class="st">&#39;mapping&#39;</span>, {})</span>
<span id="cb14-1266"><a href="#cb14-1266" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1267"><a href="#cb14-1267" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> node_id, node <span class="kw">in</span> mapping.items():</span>
<span id="cb14-1268"><a href="#cb14-1268" aria-hidden="true" tabindex="-1"></a>                    msg_data <span class="op">=</span> node.get(<span class="st">&#39;message&#39;</span>)</span>
<span id="cb14-1269"><a href="#cb14-1269" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> msg_data <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(msg_data, <span class="bu">dict</span>):</span>
<span id="cb14-1270"><a href="#cb14-1270" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb14-1271"><a href="#cb14-1271" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb14-1272"><a href="#cb14-1272" aria-hidden="true" tabindex="-1"></a>                    fragments <span class="op">=</span> msg_data.get(<span class="st">&#39;fragments&#39;</span>, [])</span>
<span id="cb14-1273"><a href="#cb14-1273" aria-hidden="true" tabindex="-1"></a>                    content_parts <span class="op">=</span> []</span>
<span id="cb14-1274"><a href="#cb14-1274" aria-hidden="true" tabindex="-1"></a>                    msg_type <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-1275"><a href="#cb14-1275" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb14-1276"><a href="#cb14-1276" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> frag <span class="kw">in</span> fragments:</span>
<span id="cb14-1277"><a href="#cb14-1277" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(frag, <span class="bu">dict</span>):</span>
<span id="cb14-1278"><a href="#cb14-1278" aria-hidden="true" tabindex="-1"></a>                            frag_type <span class="op">=</span> frag.get(<span class="st">&#39;type&#39;</span>, <span class="st">&#39;&#39;</span>).upper()</span>
<span id="cb14-1279"><a href="#cb14-1279" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> frag_type <span class="kw">in</span> (<span class="st">&#39;REQUEST&#39;</span>, <span class="st">&#39;RESPONSE&#39;</span>):</span>
<span id="cb14-1280"><a href="#cb14-1280" aria-hidden="true" tabindex="-1"></a>                                msg_type <span class="op">=</span> frag_type</span>
<span id="cb14-1281"><a href="#cb14-1281" aria-hidden="true" tabindex="-1"></a>                            text <span class="op">=</span> frag.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb14-1282"><a href="#cb14-1282" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> text:</span>
<span id="cb14-1283"><a href="#cb14-1283" aria-hidden="true" tabindex="-1"></a>                                content_parts.append(text)</span>
<span id="cb14-1284"><a href="#cb14-1284" aria-hidden="true" tabindex="-1"></a>                            content <span class="op">=</span> frag.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb14-1285"><a href="#cb14-1285" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> content:</span>
<span id="cb14-1286"><a href="#cb14-1286" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> <span class="bu">isinstance</span>(content, <span class="bu">list</span>):</span>
<span id="cb14-1287"><a href="#cb14-1287" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">for</span> item <span class="kw">in</span> content:</span>
<span id="cb14-1288"><a href="#cb14-1288" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">if</span> <span class="bu">isinstance</span>(item, <span class="bu">str</span>):</span>
<span id="cb14-1289"><a href="#cb14-1289" aria-hidden="true" tabindex="-1"></a>                                            content_parts.append(item)</span>
<span id="cb14-1290"><a href="#cb14-1290" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">elif</span> <span class="bu">isinstance</span>(item, <span class="bu">dict</span>):</span>
<span id="cb14-1291"><a href="#cb14-1291" aria-hidden="true" tabindex="-1"></a>                                            item_text <span class="op">=</span> item.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb14-1292"><a href="#cb14-1292" aria-hidden="true" tabindex="-1"></a>                                            <span class="cf">if</span> item_text:</span>
<span id="cb14-1293"><a href="#cb14-1293" aria-hidden="true" tabindex="-1"></a>                                                content_parts.append(<span class="bu">str</span>(item_text))</span>
<span id="cb14-1294"><a href="#cb14-1294" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">else</span>:</span>
<span id="cb14-1295"><a href="#cb14-1295" aria-hidden="true" tabindex="-1"></a>                                    content_parts.append(<span class="bu">str</span>(content))</span>
<span id="cb14-1296"><a href="#cb14-1296" aria-hidden="true" tabindex="-1"></a>                                    </span>
<span id="cb14-1297"><a href="#cb14-1297" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="st">&#39; &#39;</span>.join(content_parts).strip()</span>
<span id="cb14-1298"><a href="#cb14-1298" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb14-1299"><a href="#cb14-1299" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb14-1300"><a href="#cb14-1300" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb14-1301"><a href="#cb14-1301" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb14-1302"><a href="#cb14-1302" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb14-1303"><a href="#cb14-1303" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb14-1304"><a href="#cb14-1304" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> msg_type <span class="op">==</span> <span class="st">&#39;REQUEST&#39;</span>:</span>
<span id="cb14-1305"><a href="#cb14-1305" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb14-1306"><a href="#cb14-1306" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;user&#39;</span></span>
<span id="cb14-1307"><a href="#cb14-1307" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb14-1308"><a href="#cb14-1308" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ DeepSeek&quot;</span></span>
<span id="cb14-1309"><a href="#cb14-1309" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;assistant&#39;</span></span>
<span id="cb14-1310"><a href="#cb14-1310" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb14-1311"><a href="#cb14-1311" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb14-1312"><a href="#cb14-1312" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb14-1313"><a href="#cb14-1313" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb14-1314"><a href="#cb14-1314" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb14-1315"><a href="#cb14-1315" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(msg_data.get(<span class="st">&#39;inserted_at&#39;</span>)),</span>
<span id="cb14-1316"><a href="#cb14-1316" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg_data.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;DeepSeek&#39;</span>)</span>
<span id="cb14-1317"><a href="#cb14-1317" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb14-1318"><a href="#cb14-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1319"><a href="#cb14-1319" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb14-1320"><a href="#cb14-1320" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb14-1321"><a href="#cb14-1321" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb14-1322"><a href="#cb14-1322" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;DeepSeek&#39;</span>,</span>
<span id="cb14-1323"><a href="#cb14-1323" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;deepseek_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb14-1324"><a href="#cb14-1324" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;inserted_at&#39;</span>)),</span>
<span id="cb14-1325"><a href="#cb14-1325" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;updated_at&#39;</span>)),</span>
<span id="cb14-1326"><a href="#cb14-1326" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb14-1327"><a href="#cb14-1327" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb14-1328"><a href="#cb14-1328" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb14-1329"><a href="#cb14-1329" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb14-1330"><a href="#cb14-1330" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-1331"><a href="#cb14-1331" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb14-1332"><a href="#cb14-1332" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ DeepSeek: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb14-1333"><a href="#cb14-1333" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1334"><a href="#cb14-1334" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb14-1335"><a href="#cb14-1335" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar DeepSeek: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1336"><a href="#cb14-1336" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb14-1337"><a href="#cb14-1337" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb14-1338"><a href="#cb14-1338" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb14-1339"><a href="#cb14-1339" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb14-1340"><a href="#cb14-1340" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-1341"><a href="#cb14-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1342"><a href="#cb14-1342" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_grok(<span class="va">self</span>, path: Path):</span>
<span id="cb14-1343"><a href="#cb14-1343" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do Grok&quot;&quot;&quot;</span></span>
<span id="cb14-1344"><a href="#cb14-1344" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb14-1345"><a href="#cb14-1345" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria Grok: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1346"><a href="#cb14-1346" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb14-1347"><a href="#cb14-1347" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1348"><a href="#cb14-1348" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb14-1349"><a href="#cb14-1349" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;grok_&quot;</span>)</span>
<span id="cb14-1350"><a href="#cb14-1350" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb14-1351"><a href="#cb14-1351" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb14-1352"><a href="#cb14-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1353"><a href="#cb14-1353" aria-hidden="true" tabindex="-1"></a>            target_file <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-1354"><a href="#cb14-1354" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> root, _, files <span class="kw">in</span> os.walk(temp_dir):</span>
<span id="cb14-1355"><a href="#cb14-1355" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb14-1356"><a href="#cb14-1356" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">file</span> <span class="op">==</span> <span class="st">&quot;prod-grok-backend.json&quot;</span>:</span>
<span id="cb14-1357"><a href="#cb14-1357" aria-hidden="true" tabindex="-1"></a>                        target_file <span class="op">=</span> Path(root) <span class="op">/</span> <span class="bu">file</span></span>
<span id="cb14-1358"><a href="#cb14-1358" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb14-1359"><a href="#cb14-1359" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> target_file:</span>
<span id="cb14-1360"><a href="#cb14-1360" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb14-1361"><a href="#cb14-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1362"><a href="#cb14-1362" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> target_file:</span>
<span id="cb14-1363"><a href="#cb14-1363" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: ficheiro &#39;prod-grok-backend.json&#39; n√£o encontrado no ZIP.&quot;</span>)</span>
<span id="cb14-1364"><a href="#cb14-1364" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb14-1365"><a href="#cb14-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1366"><a href="#cb14-1366" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Grok: carregando </span><span class="sc">{</span>target_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb14-1367"><a href="#cb14-1367" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(target_file, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb14-1368"><a href="#cb14-1368" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.load(f)</span>
<span id="cb14-1369"><a href="#cb14-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1370"><a href="#cb14-1370" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">dict</span>) <span class="kw">or</span> <span class="st">&#39;conversations&#39;</span> <span class="kw">not</span> <span class="kw">in</span> data:</span>
<span id="cb14-1371"><a href="#cb14-1371" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: estrutura inesperada ‚Äî chave &#39;conversations&#39; n√£o encontrada.&quot;</span>)</span>
<span id="cb14-1372"><a href="#cb14-1372" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb14-1373"><a href="#cb14-1373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1374"><a href="#cb14-1374" aria-hidden="true" tabindex="-1"></a>            conversations_list <span class="op">=</span> data[<span class="st">&#39;conversations&#39;</span>]</span>
<span id="cb14-1375"><a href="#cb14-1375" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conversations_list, <span class="bu">list</span>):</span>
<span id="cb14-1376"><a href="#cb14-1376" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: &#39;conversations&#39; n√£o √© uma lista.&quot;</span>)</span>
<span id="cb14-1377"><a href="#cb14-1377" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb14-1378"><a href="#cb14-1378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1379"><a href="#cb14-1379" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä Grok: encontradas </span><span class="sc">{</span><span class="bu">len</span>(conversations_list)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb14-1380"><a href="#cb14-1380" aria-hidden="true" tabindex="-1"></a>            total_convs <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-1381"><a href="#cb14-1381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1382"><a href="#cb14-1382" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> item <span class="kw">in</span> conversations_list:</span>
<span id="cb14-1383"><a href="#cb14-1383" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(item, <span class="bu">dict</span>):</span>
<span id="cb14-1384"><a href="#cb14-1384" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb14-1385"><a href="#cb14-1385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1386"><a href="#cb14-1386" aria-hidden="true" tabindex="-1"></a>                conv_meta <span class="op">=</span> item.get(<span class="st">&#39;conversation&#39;</span>)</span>
<span id="cb14-1387"><a href="#cb14-1387" aria-hidden="true" tabindex="-1"></a>                responses <span class="op">=</span> item.get(<span class="st">&#39;responses&#39;</span>, [])</span>
<span id="cb14-1388"><a href="#cb14-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1389"><a href="#cb14-1389" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conv_meta, <span class="bu">dict</span>) <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(responses, <span class="bu">list</span>) <span class="kw">or</span> <span class="kw">not</span> responses:</span>
<span id="cb14-1390"><a href="#cb14-1390" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb14-1391"><a href="#cb14-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1392"><a href="#cb14-1392" aria-hidden="true" tabindex="-1"></a>                conv_id <span class="op">=</span> conv_meta.get(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb14-1393"><a href="#cb14-1393" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> conv_id:</span>
<span id="cb14-1394"><a href="#cb14-1394" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb14-1395"><a href="#cb14-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1396"><a href="#cb14-1396" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv_meta.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&quot;Conversa Grok </span><span class="sc">{</span>total_convs <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1397"><a href="#cb14-1397" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb14-1398"><a href="#cb14-1398" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb14-1399"><a href="#cb14-1399" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1400"><a href="#cb14-1400" aria-hidden="true" tabindex="-1"></a>                create_time_str <span class="op">=</span> conv_meta.get(<span class="st">&#39;create_time&#39;</span>)</span>
<span id="cb14-1401"><a href="#cb14-1401" aria-hidden="true" tabindex="-1"></a>                modify_time_str <span class="op">=</span> conv_meta.get(<span class="st">&#39;modify_time&#39;</span>)</span>
<span id="cb14-1402"><a href="#cb14-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1403"><a href="#cb14-1403" aria-hidden="true" tabindex="-1"></a>                <span class="kw">def</span> format_iso_timestamp(ts_str):</span>
<span id="cb14-1404"><a href="#cb14-1404" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> ts_str:</span>
<span id="cb14-1405"><a href="#cb14-1405" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb14-1406"><a href="#cb14-1406" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">try</span>:</span>
<span id="cb14-1407"><a href="#cb14-1407" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="st">&#39;.&#39;</span> <span class="kw">in</span> ts_str:</span>
<span id="cb14-1408"><a href="#cb14-1408" aria-hidden="true" tabindex="-1"></a>                            ts_str <span class="op">=</span> ts_str.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>] <span class="op">+</span> <span class="st">&#39;Z&#39;</span></span>
<span id="cb14-1409"><a href="#cb14-1409" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="va">self</span>.format_timestamp(ts_str)</span>
<span id="cb14-1410"><a href="#cb14-1410" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">except</span>:</span>
<span id="cb14-1411"><a href="#cb14-1411" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="bu">str</span>(ts_str)</span>
<span id="cb14-1412"><a href="#cb14-1412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1413"><a href="#cb14-1413" aria-hidden="true" tabindex="-1"></a>                inserted_at <span class="op">=</span> format_iso_timestamp(create_time_str)</span>
<span id="cb14-1414"><a href="#cb14-1414" aria-hidden="true" tabindex="-1"></a>                updated_at <span class="op">=</span> format_iso_timestamp(modify_time_str)</span>
<span id="cb14-1415"><a href="#cb14-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1416"><a href="#cb14-1416" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb14-1417"><a href="#cb14-1417" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> resp <span class="kw">in</span> responses:</span>
<span id="cb14-1418"><a href="#cb14-1418" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(resp, <span class="bu">dict</span>):</span>
<span id="cb14-1419"><a href="#cb14-1419" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb14-1420"><a href="#cb14-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1421"><a href="#cb14-1421" aria-hidden="true" tabindex="-1"></a>                    resp_data <span class="op">=</span> resp.get(<span class="st">&#39;response&#39;</span>)</span>
<span id="cb14-1422"><a href="#cb14-1422" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(resp_data, <span class="bu">dict</span>):</span>
<span id="cb14-1423"><a href="#cb14-1423" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb14-1424"><a href="#cb14-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1425"><a href="#cb14-1425" aria-hidden="true" tabindex="-1"></a>                    sender <span class="op">=</span> resp_data.get(<span class="st">&#39;sender&#39;</span>, <span class="st">&#39;&#39;</span>).upper()</span>
<span id="cb14-1426"><a href="#cb14-1426" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> sender <span class="op">==</span> <span class="st">&#39;HUMAN&#39;</span>:</span>
<span id="cb14-1427"><a href="#cb14-1427" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb14-1428"><a href="#cb14-1428" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&quot;user&quot;</span></span>
<span id="cb14-1429"><a href="#cb14-1429" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> sender <span class="op">==</span> <span class="st">&#39;ASSISTANT&#39;</span>:</span>
<span id="cb14-1430"><a href="#cb14-1430" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ Grok&quot;</span></span>
<span id="cb14-1431"><a href="#cb14-1431" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&quot;assistant&quot;</span></span>
<span id="cb14-1432"><a href="#cb14-1432" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb14-1433"><a href="#cb14-1433" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb14-1434"><a href="#cb14-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1435"><a href="#cb14-1435" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="bu">str</span>(resp_data.get(<span class="st">&#39;message&#39;</span>, <span class="st">&#39;&#39;</span>)).strip()</span>
<span id="cb14-1436"><a href="#cb14-1436" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb14-1437"><a href="#cb14-1437" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb14-1438"><a href="#cb14-1438" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb14-1439"><a href="#cb14-1439" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb14-1440"><a href="#cb14-1440" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb14-1441"><a href="#cb14-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1442"><a href="#cb14-1442" aria-hidden="true" tabindex="-1"></a>                    create_time <span class="op">=</span> resp_data.get(<span class="st">&#39;create_time&#39;</span>)</span>
<span id="cb14-1443"><a href="#cb14-1443" aria-hidden="true" tabindex="-1"></a>                    timestamp_ms <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-1444"><a href="#cb14-1444" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(create_time, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;$date&#39;</span> <span class="kw">in</span> create_time:</span>
<span id="cb14-1445"><a href="#cb14-1445" aria-hidden="true" tabindex="-1"></a>                        date_obj <span class="op">=</span> create_time[<span class="st">&#39;$date&#39;</span>]</span>
<span id="cb14-1446"><a href="#cb14-1446" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(date_obj, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;$numberLong&#39;</span> <span class="kw">in</span> date_obj:</span>
<span id="cb14-1447"><a href="#cb14-1447" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">try</span>:</span>
<span id="cb14-1448"><a href="#cb14-1448" aria-hidden="true" tabindex="-1"></a>                                timestamp_ms <span class="op">=</span> <span class="bu">int</span>(date_obj[<span class="st">&#39;$numberLong&#39;</span>])</span>
<span id="cb14-1449"><a href="#cb14-1449" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">except</span>:</span>
<span id="cb14-1450"><a href="#cb14-1450" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">pass</span></span>
<span id="cb14-1451"><a href="#cb14-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1452"><a href="#cb14-1452" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb14-1453"><a href="#cb14-1453" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb14-1454"><a href="#cb14-1454" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb14-1455"><a href="#cb14-1455" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb14-1456"><a href="#cb14-1456" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(timestamp_ms <span class="op">/</span> <span class="fl">1000.0</span> <span class="cf">if</span> timestamp_ms <span class="cf">else</span> <span class="va">None</span>),</span>
<span id="cb14-1457"><a href="#cb14-1457" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: <span class="st">&#39;Grok&#39;</span></span>
<span id="cb14-1458"><a href="#cb14-1458" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb14-1459"><a href="#cb14-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1460"><a href="#cb14-1460" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb14-1461"><a href="#cb14-1461" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb14-1462"><a href="#cb14-1462" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb14-1463"><a href="#cb14-1463" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;Grok&#39;</span>,</span>
<span id="cb14-1464"><a href="#cb14-1464" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv_id,</span>
<span id="cb14-1465"><a href="#cb14-1465" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: inserted_at,</span>
<span id="cb14-1466"><a href="#cb14-1466" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: updated_at,</span>
<span id="cb14-1467"><a href="#cb14-1467" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb14-1468"><a href="#cb14-1468" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb14-1469"><a href="#cb14-1469" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb14-1470"><a href="#cb14-1470" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb14-1471"><a href="#cb14-1471" aria-hidden="true" tabindex="-1"></a>                    total_convs <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-1472"><a href="#cb14-1472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1473"><a href="#cb14-1473" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> total_convs <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb14-1474"><a href="#cb14-1474" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Grok: processadas </span><span class="sc">{</span>total_convs<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb14-1475"><a href="#cb14-1475" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb14-1476"><a href="#cb14-1476" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: nenhuma conversa v√°lida encontrada.&quot;</span>)</span>
<span id="cb14-1477"><a href="#cb14-1477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1478"><a href="#cb14-1478" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb14-1479"><a href="#cb14-1479" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar Grok: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1480"><a href="#cb14-1480" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb14-1481"><a href="#cb14-1481" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb14-1482"><a href="#cb14-1482" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb14-1483"><a href="#cb14-1483" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb14-1484"><a href="#cb14-1484" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-1485"><a href="#cb14-1485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1486"><a href="#cb14-1486" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_markdown_enhanced(<span class="va">self</span>):</span>
<span id="cb14-1487"><a href="#cb14-1487" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas com preserva√ß√£o total de formata√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb14-1488"><a href="#cb14-1488" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb14-1489"><a href="#cb14-1489" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] Markdowns seriam criados:&quot;</span>)</span>
<span id="cb14-1490"><a href="#cb14-1490" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb14-1491"><a href="#cb14-1491" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb14-1492"><a href="#cb14-1492" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.md&quot;</span></span>
<span id="cb14-1493"><a href="#cb14-1493" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÑ </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1494"><a href="#cb14-1494" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb14-1495"><a href="#cb14-1495" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1496"><a href="#cb14-1496" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;markdown&#39;</span>])</span>
<span id="cb14-1497"><a href="#cb14-1497" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-1498"><a href="#cb14-1498" aria-hidden="true" tabindex="-1"></a>        failed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-1499"><a href="#cb14-1499" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-1500"><a href="#cb14-1500" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb14-1501"><a href="#cb14-1501" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb14-1502"><a href="#cb14-1502" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb14-1503"><a href="#cb14-1503" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.md&quot;</span></span>
<span id="cb14-1504"><a href="#cb14-1504" aria-hidden="true" tabindex="-1"></a>                filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb14-1505"><a href="#cb14-1505" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1506"><a href="#cb14-1506" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb14-1507"><a href="#cb14-1507" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb14-1508"><a href="#cb14-1508" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb14-1509"><a href="#cb14-1509" aria-hidden="true" tabindex="-1"></a>                markdown_content <span class="op">=</span> <span class="va">self</span>.create_enhanced_markdown_content(conv)</span>
<span id="cb14-1510"><a href="#cb14-1510" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1511"><a href="#cb14-1511" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb14-1512"><a href="#cb14-1512" aria-hidden="true" tabindex="-1"></a>                    f.write(markdown_content)</span>
<span id="cb14-1513"><a href="#cb14-1513" aria-hidden="true" tabindex="-1"></a>                saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-1514"><a href="#cb14-1514" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1515"><a href="#cb14-1515" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb14-1516"><a href="#cb14-1516" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao salvar conversa </span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1517"><a href="#cb14-1517" aria-hidden="true" tabindex="-1"></a>                failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-1518"><a href="#cb14-1518" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb14-1519"><a href="#cb14-1519" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1520"><a href="#cb14-1520" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Markdown: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados, </span><span class="sc">{</span>failed_count<span class="sc">}</span><span class="ss"> falhas em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb14-1521"><a href="#cb14-1521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1522"><a href="#cb14-1522" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_csv(<span class="va">self</span>):</span>
<span id="cb14-1523"><a href="#cb14-1523" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas em arquivos CSV individuais&quot;&quot;&quot;</span></span>
<span id="cb14-1524"><a href="#cb14-1524" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb14-1525"><a href="#cb14-1525" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] CSVs seriam criados:&quot;</span>)</span>
<span id="cb14-1526"><a href="#cb14-1526" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb14-1527"><a href="#cb14-1527" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb14-1528"><a href="#cb14-1528" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.csv&quot;</span></span>
<span id="cb14-1529"><a href="#cb14-1529" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìä </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1530"><a href="#cb14-1530" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb14-1531"><a href="#cb14-1531" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1532"><a href="#cb14-1532" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;csv&#39;</span>])</span>
<span id="cb14-1533"><a href="#cb14-1533" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-1534"><a href="#cb14-1534" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-1535"><a href="#cb14-1535" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb14-1536"><a href="#cb14-1536" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb14-1537"><a href="#cb14-1537" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.csv&quot;</span></span>
<span id="cb14-1538"><a href="#cb14-1538" aria-hidden="true" tabindex="-1"></a>            filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb14-1539"><a href="#cb14-1539" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1540"><a href="#cb14-1540" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb14-1541"><a href="#cb14-1541" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb14-1542"><a href="#cb14-1542" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1543"><a href="#cb14-1543" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb14-1544"><a href="#cb14-1544" aria-hidden="true" tabindex="-1"></a>                writer <span class="op">=</span> csv.DictWriter(f, fieldnames<span class="op">=</span>[</span>
<span id="cb14-1545"><a href="#cb14-1545" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;node_id&#39;</span>, <span class="st">&#39;author&#39;</span>, <span class="st">&#39;role&#39;</span>, <span class="st">&#39;timestamp&#39;</span>, <span class="st">&#39;model&#39;</span>, <span class="st">&#39;content&#39;</span></span>
<span id="cb14-1546"><a href="#cb14-1546" aria-hidden="true" tabindex="-1"></a>                ])</span>
<span id="cb14-1547"><a href="#cb14-1547" aria-hidden="true" tabindex="-1"></a>                writer.writeheader()</span>
<span id="cb14-1548"><a href="#cb14-1548" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i, msg <span class="kw">in</span> <span class="bu">enumerate</span>(conv[<span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb14-1549"><a href="#cb14-1549" aria-hidden="true" tabindex="-1"></a>                    writer.writerow({</span>
<span id="cb14-1550"><a href="#cb14-1550" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;node_id&#39;</span>: <span class="bu">str</span>(i),</span>
<span id="cb14-1551"><a href="#cb14-1551" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: msg[<span class="st">&#39;author&#39;</span>],</span>
<span id="cb14-1552"><a href="#cb14-1552" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: msg[<span class="st">&#39;role&#39;</span>],</span>
<span id="cb14-1553"><a href="#cb14-1553" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: msg[<span class="st">&#39;timestamp&#39;</span>],</span>
<span id="cb14-1554"><a href="#cb14-1554" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg[<span class="st">&#39;model&#39;</span>],</span>
<span id="cb14-1555"><a href="#cb14-1555" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: msg[<span class="st">&#39;content&#39;</span>]</span>
<span id="cb14-1556"><a href="#cb14-1556" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb14-1557"><a href="#cb14-1557" aria-hidden="true" tabindex="-1"></a>            saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-1558"><a href="#cb14-1558" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1559"><a href="#cb14-1559" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ CSV: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb14-1560"><a href="#cb14-1560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1561"><a href="#cb14-1561" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_json(<span class="va">self</span>):</span>
<span id="cb14-1562"><a href="#cb14-1562" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas em arquivos JSON individuais&quot;&quot;&quot;</span></span>
<span id="cb14-1563"><a href="#cb14-1563" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb14-1564"><a href="#cb14-1564" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] JSONs seriam criados:&quot;</span>)</span>
<span id="cb14-1565"><a href="#cb14-1565" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb14-1566"><a href="#cb14-1566" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb14-1567"><a href="#cb14-1567" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.json&quot;</span></span>
<span id="cb14-1568"><a href="#cb14-1568" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìã </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1569"><a href="#cb14-1569" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb14-1570"><a href="#cb14-1570" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1571"><a href="#cb14-1571" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;json&#39;</span>])</span>
<span id="cb14-1572"><a href="#cb14-1572" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-1573"><a href="#cb14-1573" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-1574"><a href="#cb14-1574" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb14-1575"><a href="#cb14-1575" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb14-1576"><a href="#cb14-1576" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.json&quot;</span></span>
<span id="cb14-1577"><a href="#cb14-1577" aria-hidden="true" tabindex="-1"></a>            filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb14-1578"><a href="#cb14-1578" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1579"><a href="#cb14-1579" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb14-1580"><a href="#cb14-1580" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb14-1581"><a href="#cb14-1581" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-1582"><a href="#cb14-1582" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb14-1583"><a href="#cb14-1583" aria-hidden="true" tabindex="-1"></a>                json.dump(conv, f, ensure_ascii<span class="op">=</span><span class="va">False</span>, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb14-1584"><a href="#cb14-1584" aria-hidden="true" tabindex="-1"></a>            saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-1585"><a href="#cb14-1585" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1586"><a href="#cb14-1586" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ JSON: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb14-1587"><a href="#cb14-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1588"><a href="#cb14-1588" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_all_to_single_files(<span class="va">self</span>):</span>
<span id="cb14-1589"><a href="#cb14-1589" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva todas as conversas em arquivos √∫nicos CSV e JSON&quot;&quot;&quot;</span></span>
<span id="cb14-1590"><a href="#cb14-1590" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb14-1591"><a href="#cb14-1591" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] Arquivos √∫nicos seriam criados:&quot;</span>)</span>
<span id="cb14-1592"><a href="#cb14-1592" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÅ </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;csv&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1593"><a href="#cb14-1593" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÅ </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;json&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1594"><a href="#cb14-1594" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb14-1595"><a href="#cb14-1595" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1596"><a href="#cb14-1596" aria-hidden="true" tabindex="-1"></a>        <span class="co"># CSV √∫nico</span></span>
<span id="cb14-1597"><a href="#cb14-1597" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.single_files[<span class="st">&#39;csv&#39;</span>], <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb14-1598"><a href="#cb14-1598" aria-hidden="true" tabindex="-1"></a>            fieldnames <span class="op">=</span> [</span>
<span id="cb14-1599"><a href="#cb14-1599" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;conversation_number&#39;</span>, <span class="st">&#39;source&#39;</span>, <span class="st">&#39;conversation_title&#39;</span>, <span class="st">&#39;category&#39;</span>,</span>
<span id="cb14-1600"><a href="#cb14-1600" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;author&#39;</span>, <span class="st">&#39;role&#39;</span>, <span class="st">&#39;timestamp&#39;</span>, <span class="st">&#39;model&#39;</span>, <span class="st">&#39;content&#39;</span></span>
<span id="cb14-1601"><a href="#cb14-1601" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb14-1602"><a href="#cb14-1602" aria-hidden="true" tabindex="-1"></a>            writer <span class="op">=</span> csv.DictWriter(f, fieldnames<span class="op">=</span>fieldnames)</span>
<span id="cb14-1603"><a href="#cb14-1603" aria-hidden="true" tabindex="-1"></a>            writer.writeheader()</span>
<span id="cb14-1604"><a href="#cb14-1604" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb14-1605"><a href="#cb14-1605" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> msg <span class="kw">in</span> conv[<span class="st">&#39;messages&#39;</span>]:</span>
<span id="cb14-1606"><a href="#cb14-1606" aria-hidden="true" tabindex="-1"></a>                    writer.writerow({</span>
<span id="cb14-1607"><a href="#cb14-1607" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;conversation_number&#39;</span>: conv[<span class="st">&#39;number&#39;</span>],</span>
<span id="cb14-1608"><a href="#cb14-1608" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: conv[<span class="st">&#39;source&#39;</span>],</span>
<span id="cb14-1609"><a href="#cb14-1609" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;conversation_title&#39;</span>: conv[<span class="st">&#39;title&#39;</span>],</span>
<span id="cb14-1610"><a href="#cb14-1610" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: conv[<span class="st">&#39;category&#39;</span>],</span>
<span id="cb14-1611"><a href="#cb14-1611" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: msg[<span class="st">&#39;author&#39;</span>],</span>
<span id="cb14-1612"><a href="#cb14-1612" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: msg[<span class="st">&#39;role&#39;</span>],</span>
<span id="cb14-1613"><a href="#cb14-1613" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: msg[<span class="st">&#39;timestamp&#39;</span>],</span>
<span id="cb14-1614"><a href="#cb14-1614" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg[<span class="st">&#39;model&#39;</span>],</span>
<span id="cb14-1615"><a href="#cb14-1615" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: msg[<span class="st">&#39;content&#39;</span>]</span>
<span id="cb14-1616"><a href="#cb14-1616" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb14-1617"><a href="#cb14-1617" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ CSV √∫nico: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;csv&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1618"><a href="#cb14-1618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1619"><a href="#cb14-1619" aria-hidden="true" tabindex="-1"></a>        <span class="co"># JSON √∫nico</span></span>
<span id="cb14-1620"><a href="#cb14-1620" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.single_files[<span class="st">&#39;json&#39;</span>], <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb14-1621"><a href="#cb14-1621" aria-hidden="true" tabindex="-1"></a>            json.dump(<span class="va">self</span>.all_conversations, f, ensure_ascii<span class="op">=</span><span class="va">False</span>, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb14-1622"><a href="#cb14-1622" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ JSON √∫nico: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;json&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1623"><a href="#cb14-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1624"><a href="#cb14-1624" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_searchable_index(<span class="va">self</span>):</span>
<span id="cb14-1625"><a href="#cb14-1625" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Cria √≠ndice HTML pesquis√°vel com links para HTML&quot;&quot;&quot;</span></span>
<span id="cb14-1626"><a href="#cb14-1626" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb14-1627"><a href="#cb14-1627" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] √çndice HTML seria criado: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-1628"><a href="#cb14-1628" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb14-1629"><a href="#cb14-1629" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1630"><a href="#cb14-1630" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;üéØ Criando √≠ndice HTML combinado...&quot;</span>)</span>
<span id="cb14-1631"><a href="#cb14-1631" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-1632"><a href="#cb14-1632" aria-hidden="true" tabindex="-1"></a>        category_stats <span class="op">=</span> {}</span>
<span id="cb14-1633"><a href="#cb14-1633" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb14-1634"><a href="#cb14-1634" aria-hidden="true" tabindex="-1"></a>            cat <span class="op">=</span> conv[<span class="st">&#39;category&#39;</span>]</span>
<span id="cb14-1635"><a href="#cb14-1635" aria-hidden="true" tabindex="-1"></a>            category_stats[cat] <span class="op">=</span> category_stats.get(cat, <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb14-1636"><a href="#cb14-1636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1637"><a href="#cb14-1637" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb14-1638"><a href="#cb14-1638" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html lang=&quot;pt-PT&quot;&gt;</span></span>
<span id="cb14-1639"><a href="#cb14-1639" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb14-1640"><a href="#cb14-1640" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb14-1641"><a href="#cb14-1641" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb14-1642"><a href="#cb14-1642" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;√çndice Combinado - AI Chats&lt;/title&gt;</span></span>
<span id="cb14-1643"><a href="#cb14-1643" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb14-1644"><a href="#cb14-1644" aria-hidden="true" tabindex="-1"></a><span class="ss">        * </span><span class="ch">{{</span><span class="ss"> margin: 0; padding: 0; box-sizing: border-box; </span><span class="ch">}}</span></span>
<span id="cb14-1645"><a href="#cb14-1645" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span><span class="ss"> font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; color: #333; </span><span class="ch">}}</span></span>
<span id="cb14-1646"><a href="#cb14-1646" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span><span class="ss"> max-width: 1400px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; </span><span class="ch">}}</span></span>
<span id="cb14-1647"><a href="#cb14-1647" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header </span><span class="ch">{{</span><span class="ss"> background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; text-align: center; </span><span class="ch">}}</span></span>
<span id="cb14-1648"><a href="#cb14-1648" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header h1 </span><span class="ch">{{</span><span class="ss"> font-size: 2.8em; margin-bottom: 15px; font-weight: 300; </span><span class="ch">}}</span></span>
<span id="cb14-1649"><a href="#cb14-1649" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header p </span><span class="ch">{{</span><span class="ss"> font-size: 1.2em; opacity: 0.9; margin-bottom: 20px; </span><span class="ch">}}</span></span>
<span id="cb14-1650"><a href="#cb14-1650" aria-hidden="true" tabindex="-1"></a><span class="ss">        .stats </span><span class="ch">{{</span><span class="ss"> display: flex; justify-content: center; gap: 30px; margin-top: 25px; flex-wrap: wrap; </span><span class="ch">}}</span></span>
<span id="cb14-1651"><a href="#cb14-1651" aria-hidden="true" tabindex="-1"></a><span class="ss">        .stat-item </span><span class="ch">{{</span><span class="ss"> background: rgba(255,255,255,0.15); padding: 18px 28px; border-radius: 12px; backdrop-filter: blur(10px); font-size: 1.1em; </span><span class="ch">}}</span></span>
<span id="cb14-1652"><a href="#cb14-1652" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-section </span><span class="ch">{{</span><span class="ss"> padding: 30px; background: #f8f9fa; border-bottom: 1px solid #e9ecef; </span><span class="ch">}}</span></span>
<span id="cb14-1653"><a href="#cb14-1653" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-box </span><span class="ch">{{</span><span class="ss"> width: 100%; padding: 18px 25px; font-size: 16px; border: 2px solid #e9ecef; border-radius: 25px; outline: none; transition: all 0.3s ease; font-family: inherit; </span><span class="ch">}}</span></span>
<span id="cb14-1654"><a href="#cb14-1654" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-box:focus </span><span class="ch">{{</span><span class="ss"> border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); </span><span class="ch">}}</span></span>
<span id="cb14-1655"><a href="#cb14-1655" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-section </span><span class="ch">{{</span></span>
<span id="cb14-1656"><a href="#cb14-1656" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px 30px;</span></span>
<span id="cb14-1657"><a href="#cb14-1657" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb14-1658"><a href="#cb14-1658" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb14-1659"><a href="#cb14-1659" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 12px;</span></span>
<span id="cb14-1660"><a href="#cb14-1660" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: center;</span></span>
<span id="cb14-1661"><a href="#cb14-1661" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb14-1662"><a href="#cb14-1662" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 1px solid #e9ecef;</span></span>
<span id="cb14-1663"><a href="#cb14-1663" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1664"><a href="#cb14-1664" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-btn </span><span class="ch">{{</span></span>
<span id="cb14-1665"><a href="#cb14-1665" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 10px 20px;</span></span>
<span id="cb14-1666"><a href="#cb14-1666" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb14-1667"><a href="#cb14-1667" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 2px solid #e9ecef;</span></span>
<span id="cb14-1668"><a href="#cb14-1668" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 25px;</span></span>
<span id="cb14-1669"><a href="#cb14-1669" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb14-1670"><a href="#cb14-1670" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.95em;</span></span>
<span id="cb14-1671"><a href="#cb14-1671" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb14-1672"><a href="#cb14-1672" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.3s ease;</span></span>
<span id="cb14-1673"><a href="#cb14-1673" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: inherit;</span></span>
<span id="cb14-1674"><a href="#cb14-1674" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1675"><a href="#cb14-1675" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-btn.active, .filter-btn:hover </span><span class="ch">{{</span></span>
<span id="cb14-1676"><a href="#cb14-1676" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #667eea;</span></span>
<span id="cb14-1677"><a href="#cb14-1677" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb14-1678"><a href="#cb14-1678" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb14-1679"><a href="#cb14-1679" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: translateY(-2px);</span></span>
<span id="cb14-1680"><a href="#cb14-1680" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);</span></span>
<span id="cb14-1681"><a href="#cb14-1681" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1682"><a href="#cb14-1682" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversations-grid </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-1683"><a href="#cb14-1683" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: grid; </span></span>
<span id="cb14-1684"><a href="#cb14-1684" aria-hidden="true" tabindex="-1"></a><span class="ss">            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); </span></span>
<span id="cb14-1685"><a href="#cb14-1685" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 25px; </span></span>
<span id="cb14-1686"><a href="#cb14-1686" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 35px;</span></span>
<span id="cb14-1687"><a href="#cb14-1687" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);</span></span>
<span id="cb14-1688"><a href="#cb14-1688" aria-hidden="true" tabindex="-1"></a><span class="ss">            min-height: 400px;</span></span>
<span id="cb14-1689"><a href="#cb14-1689" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1690"><a href="#cb14-1690" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-1691"><a href="#cb14-1691" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white; </span></span>
<span id="cb14-1692"><a href="#cb14-1692" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #e9ecef; </span></span>
<span id="cb14-1693"><a href="#cb14-1693" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 15px; </span></span>
<span id="cb14-1694"><a href="#cb14-1694" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 25px; </span></span>
<span id="cb14-1695"><a href="#cb14-1695" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.4s ease; </span></span>
<span id="cb14-1696"><a href="#cb14-1696" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer; </span></span>
<span id="cb14-1697"><a href="#cb14-1697" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: relative;</span></span>
<span id="cb14-1698"><a href="#cb14-1698" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 15px rgba(0,0,0,0.08);</span></span>
<span id="cb14-1699"><a href="#cb14-1699" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1700"><a href="#cb14-1700" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card:hover </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-1701"><a href="#cb14-1701" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: translateY(-8px); </span></span>
<span id="cb14-1702"><a href="#cb14-1702" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 15px 35px rgba(0,0,0,0.15); </span></span>
<span id="cb14-1703"><a href="#cb14-1703" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb14-1704"><a href="#cb14-1704" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1705"><a href="#cb14-1705" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-header </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-1706"><a href="#cb14-1706" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb14-1707"><a href="#cb14-1707" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between; </span></span>
<span id="cb14-1708"><a href="#cb14-1708" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: flex-start; </span></span>
<span id="cb14-1709"><a href="#cb14-1709" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 18px; </span></span>
<span id="cb14-1710"><a href="#cb14-1710" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1711"><a href="#cb14-1711" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-number </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-1712"><a href="#cb14-1712" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #667eea, #764ba2); </span></span>
<span id="cb14-1713"><a href="#cb14-1713" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb14-1714"><a href="#cb14-1714" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 8px 16px; </span></span>
<span id="cb14-1715"><a href="#cb14-1715" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 20px; </span></span>
<span id="cb14-1716"><a href="#cb14-1716" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em; </span></span>
<span id="cb14-1717"><a href="#cb14-1717" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb14-1718"><a href="#cb14-1718" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);</span></span>
<span id="cb14-1719"><a href="#cb14-1719" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1720"><a href="#cb14-1720" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-source </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-1721"><a href="#cb14-1721" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e3f2fd; </span></span>
<span id="cb14-1722"><a href="#cb14-1722" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #1976d2; </span></span>
<span id="cb14-1723"><a href="#cb14-1723" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 5px 12px; </span></span>
<span id="cb14-1724"><a href="#cb14-1724" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px; </span></span>
<span id="cb14-1725"><a href="#cb14-1725" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.85em; </span></span>
<span id="cb14-1726"><a href="#cb14-1726" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold; </span></span>
<span id="cb14-1727"><a href="#cb14-1727" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 10px;</span></span>
<span id="cb14-1728"><a href="#cb14-1728" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1729"><a href="#cb14-1729" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-title </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-1730"><a href="#cb14-1730" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.3em; </span></span>
<span id="cb14-1731"><a href="#cb14-1731" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 600; </span></span>
<span id="cb14-1732"><a href="#cb14-1732" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50; </span></span>
<span id="cb14-1733"><a href="#cb14-1733" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 12px; </span></span>
<span id="cb14-1734"><a href="#cb14-1734" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.4;</span></span>
<span id="cb14-1735"><a href="#cb14-1735" aria-hidden="true" tabindex="-1"></a><span class="ss">            min-height: 3.6em;</span></span>
<span id="cb14-1736"><a href="#cb14-1736" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb14-1737"><a href="#cb14-1737" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1738"><a href="#cb14-1738" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-summary </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-1739"><a href="#cb14-1739" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #6c757d; </span></span>
<span id="cb14-1740"><a href="#cb14-1740" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.95em; </span></span>
<span id="cb14-1741"><a href="#cb14-1741" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.5; </span></span>
<span id="cb14-1742"><a href="#cb14-1742" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 18px;</span></span>
<span id="cb14-1743"><a href="#cb14-1743" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: -webkit-box;</span></span>
<span id="cb14-1744"><a href="#cb14-1744" aria-hidden="true" tabindex="-1"></a><span class="ss">            -webkit-line-clamp: 3;</span></span>
<span id="cb14-1745"><a href="#cb14-1745" aria-hidden="true" tabindex="-1"></a><span class="ss">            -webkit-box-orient: vertical;</span></span>
<span id="cb14-1746"><a href="#cb14-1746" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb14-1747"><a href="#cb14-1747" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb14-1748"><a href="#cb14-1748" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1749"><a href="#cb14-1749" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-meta </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-1750"><a href="#cb14-1750" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb14-1751"><a href="#cb14-1751" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between; </span></span>
<span id="cb14-1752"><a href="#cb14-1752" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.85em; </span></span>
<span id="cb14-1753"><a href="#cb14-1753" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #868e96; </span></span>
<span id="cb14-1754"><a href="#cb14-1754" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-top: 1px solid #e9ecef; </span></span>
<span id="cb14-1755"><a href="#cb14-1755" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-top: 18px;</span></span>
<span id="cb14-1756"><a href="#cb14-1756" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1757"><a href="#cb14-1757" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-actions </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-1758"><a href="#cb14-1758" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: absolute; </span></span>
<span id="cb14-1759"><a href="#cb14-1759" aria-hidden="true" tabindex="-1"></a><span class="ss">            top: 20px; </span></span>
<span id="cb14-1760"><a href="#cb14-1760" aria-hidden="true" tabindex="-1"></a><span class="ss">            right: 20px; </span></span>
<span id="cb14-1761"><a href="#cb14-1761" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb14-1762"><a href="#cb14-1762" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 8px; </span></span>
<span id="cb14-1763"><a href="#cb14-1763" aria-hidden="true" tabindex="-1"></a><span class="ss">            opacity: 0; </span></span>
<span id="cb14-1764"><a href="#cb14-1764" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: opacity 0.3s ease; </span></span>
<span id="cb14-1765"><a href="#cb14-1765" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1766"><a href="#cb14-1766" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card:hover .card-actions </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-1767"><a href="#cb14-1767" aria-hidden="true" tabindex="-1"></a><span class="ss">            opacity: 1; </span></span>
<span id="cb14-1768"><a href="#cb14-1768" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1769"><a href="#cb14-1769" aria-hidden="true" tabindex="-1"></a><span class="ss">        .action-btn </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-1770"><a href="#cb14-1770" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white; </span></span>
<span id="cb14-1771"><a href="#cb14-1771" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 2px solid #e9ecef; </span></span>
<span id="cb14-1772"><a href="#cb14-1772" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px; </span></span>
<span id="cb14-1773"><a href="#cb14-1773" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 6px 12px; </span></span>
<span id="cb14-1774"><a href="#cb14-1774" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.8em; </span></span>
<span id="cb14-1775"><a href="#cb14-1775" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer; </span></span>
<span id="cb14-1776"><a href="#cb14-1776" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.3s ease;</span></span>
<span id="cb14-1777"><a href="#cb14-1777" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb14-1778"><a href="#cb14-1778" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb14-1779"><a href="#cb14-1779" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333;</span></span>
<span id="cb14-1780"><a href="#cb14-1780" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb14-1781"><a href="#cb14-1781" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1782"><a href="#cb14-1782" aria-hidden="true" tabindex="-1"></a><span class="ss">        .action-btn:hover </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-1783"><a href="#cb14-1783" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #667eea; </span></span>
<span id="cb14-1784"><a href="#cb14-1784" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb14-1785"><a href="#cb14-1785" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb14-1786"><a href="#cb14-1786" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: scale(1.05);</span></span>
<span id="cb14-1787"><a href="#cb14-1787" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1788"><a href="#cb14-1788" aria-hidden="true" tabindex="-1"></a><span class="ss">        .recent-badge </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-1789"><a href="#cb14-1789" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #ff6b6b; </span></span>
<span id="cb14-1790"><a href="#cb14-1790" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb14-1791"><a href="#cb14-1791" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 3px 10px; </span></span>
<span id="cb14-1792"><a href="#cb14-1792" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px; </span></span>
<span id="cb14-1793"><a href="#cb14-1793" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.75em; </span></span>
<span id="cb14-1794"><a href="#cb14-1794" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 8px;</span></span>
<span id="cb14-1795"><a href="#cb14-1795" aria-hidden="true" tabindex="-1"></a><span class="ss">            animation: pulse 2s infinite;</span></span>
<span id="cb14-1796"><a href="#cb14-1796" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1797"><a href="#cb14-1797" aria-hidden="true" tabindex="-1"></a><span class="ss">        .no-results </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb14-1798"><a href="#cb14-1798" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center; </span></span>
<span id="cb14-1799"><a href="#cb14-1799" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 60px 20px; </span></span>
<span id="cb14-1800"><a href="#cb14-1800" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #6c757d;</span></span>
<span id="cb14-1801"><a href="#cb14-1801" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.1em;</span></span>
<span id="cb14-1802"><a href="#cb14-1802" aria-hidden="true" tabindex="-1"></a><span class="ss">            grid-column: 1 / -1;</span></span>
<span id="cb14-1803"><a href="#cb14-1803" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1804"><a href="#cb14-1804" aria-hidden="true" tabindex="-1"></a><span class="ss">        @keyframes pulse </span><span class="ch">{{</span></span>
<span id="cb14-1805"><a href="#cb14-1805" aria-hidden="true" tabindex="-1"></a><span class="ss">            0% </span><span class="ch">{{</span><span class="ss"> transform: scale(1); </span><span class="ch">}}</span></span>
<span id="cb14-1806"><a href="#cb14-1806" aria-hidden="true" tabindex="-1"></a><span class="ss">            50% </span><span class="ch">{{</span><span class="ss"> transform: scale(1.05); </span><span class="ch">}}</span></span>
<span id="cb14-1807"><a href="#cb14-1807" aria-hidden="true" tabindex="-1"></a><span class="ss">            100% </span><span class="ch">{{</span><span class="ss"> transform: scale(1); </span><span class="ch">}}</span></span>
<span id="cb14-1808"><a href="#cb14-1808" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1809"><a href="#cb14-1809" aria-hidden="true" tabindex="-1"></a><span class="ss">        .category-badge </span><span class="ch">{{</span></span>
<span id="cb14-1810"><a href="#cb14-1810" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb14-1811"><a href="#cb14-1811" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e3f2fd;</span></span>
<span id="cb14-1812"><a href="#cb14-1812" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #1976d2;</span></span>
<span id="cb14-1813"><a href="#cb14-1813" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 10px;</span></span>
<span id="cb14-1814"><a href="#cb14-1814" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px;</span></span>
<span id="cb14-1815"><a href="#cb14-1815" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.8em;</span></span>
<span id="cb14-1816"><a href="#cb14-1816" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 8px;</span></span>
<span id="cb14-1817"><a href="#cb14-1817" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb14-1818"><a href="#cb14-1818" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1819"><a href="#cb14-1819" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb14-1820"><a href="#cb14-1820" aria-hidden="true" tabindex="-1"></a><span class="ss">        .direct-link </span><span class="ch">{{</span></span>
<span id="cb14-1821"><a href="#cb14-1821" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb14-1822"><a href="#cb14-1822" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 5px;</span></span>
<span id="cb14-1823"><a href="#cb14-1823" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 8px 15px;</span></span>
<span id="cb14-1824"><a href="#cb14-1824" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #28a745;</span></span>
<span id="cb14-1825"><a href="#cb14-1825" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb14-1826"><a href="#cb14-1826" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb14-1827"><a href="#cb14-1827" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 5px;</span></span>
<span id="cb14-1828"><a href="#cb14-1828" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb14-1829"><a href="#cb14-1829" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1830"><a href="#cb14-1830" aria-hidden="true" tabindex="-1"></a><span class="ss">        .direct-link:hover </span><span class="ch">{{</span></span>
<span id="cb14-1831"><a href="#cb14-1831" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #218838;</span></span>
<span id="cb14-1832"><a href="#cb14-1832" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1833"><a href="#cb14-1833" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb14-1834"><a href="#cb14-1834" aria-hidden="true" tabindex="-1"></a><span class="ss">        .html-btn </span><span class="ch">{{</span></span>
<span id="cb14-1835"><a href="#cb14-1835" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #17a2b8;</span></span>
<span id="cb14-1836"><a href="#cb14-1836" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb14-1837"><a href="#cb14-1837" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1838"><a href="#cb14-1838" aria-hidden="true" tabindex="-1"></a><span class="ss">        .html-btn:hover </span><span class="ch">{{</span></span>
<span id="cb14-1839"><a href="#cb14-1839" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #138496;</span></span>
<span id="cb14-1840"><a href="#cb14-1840" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1841"><a href="#cb14-1841" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb14-1842"><a href="#cb14-1842" aria-hidden="true" tabindex="-1"></a><span class="ss">        .pdf-btn </span><span class="ch">{{</span></span>
<span id="cb14-1843"><a href="#cb14-1843" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #dc3545;</span></span>
<span id="cb14-1844"><a href="#cb14-1844" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb14-1845"><a href="#cb14-1845" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1846"><a href="#cb14-1846" aria-hidden="true" tabindex="-1"></a><span class="ss">        .pdf-btn:hover </span><span class="ch">{{</span></span>
<span id="cb14-1847"><a href="#cb14-1847" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #c82333;</span></span>
<span id="cb14-1848"><a href="#cb14-1848" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb14-1849"><a href="#cb14-1849" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb14-1850"><a href="#cb14-1850" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb14-1851"><a href="#cb14-1851" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb14-1852"><a href="#cb14-1852" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb14-1853"><a href="#cb14-1853" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;header&quot;&gt;</span></span>
<span id="cb14-1854"><a href="#cb14-1854" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;h1&gt;üìö √çndice Combinado de Conversas&lt;/h1&gt;</span></span>
<span id="cb14-1855"><a href="#cb14-1855" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;p&gt;Qwen3 ‚Ä¢ ChatGPT ‚Ä¢ DeepSeek ‚Ä¢ Grok ‚Ä¢ COM HTML (Pandoc + MathJax)&lt;/p&gt;</span></span>
<span id="cb14-1856"><a href="#cb14-1856" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div class=&quot;stats&quot;&gt;</span></span>
<span id="cb14-1857"><a href="#cb14-1857" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb14-1858"><a href="#cb14-1858" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Total:&lt;/strong&gt; &lt;span id=&quot;total-count&quot;&gt;</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">&lt;/span&gt; conversas</span></span>
<span id="cb14-1859"><a href="#cb14-1859" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb14-1860"><a href="#cb14-1860" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb14-1861"><a href="#cb14-1861" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Ordena√ß√£o:&lt;/strong&gt; Mais Recentes Primeiro</span></span>
<span id="cb14-1862"><a href="#cb14-1862" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb14-1863"><a href="#cb14-1863" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb14-1864"><a href="#cb14-1864" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Atualizado:&lt;/strong&gt; </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">.</span>strftime(<span class="st">&#39;</span><span class="sc">%d</span><span class="st">/%m/%Y %H:%M&#39;</span>)<span class="sc">}</span></span>
<span id="cb14-1865"><a href="#cb14-1865" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb14-1866"><a href="#cb14-1866" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb14-1867"><a href="#cb14-1867" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb14-1868"><a href="#cb14-1868" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb14-1869"><a href="#cb14-1869" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;search-section&quot;&gt;</span></span>
<span id="cb14-1870"><a href="#cb14-1870" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;input type=&quot;text&quot; id=&quot;searchInput&quot; class=&quot;search-box&quot; placeholder=&quot;üîç Pesquisar por t√≠tulo, conte√∫do ou categoria...&quot;&gt;</span></span>
<span id="cb14-1871"><a href="#cb14-1871" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb14-1872"><a href="#cb14-1872" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb14-1873"><a href="#cb14-1873" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;filter-section&quot;&gt;</span></span>
<span id="cb14-1874"><a href="#cb14-1874" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;button class=&quot;filter-btn active&quot; data-filter=&quot;todas&quot;&gt;Todas (</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">)&lt;/button&gt;</span></span>
<span id="cb14-1875"><a href="#cb14-1875" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb14-1876"><a href="#cb14-1876" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-1877"><a href="#cb14-1877" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category, count <span class="kw">in</span> category_stats.items():</span>
<span id="cb14-1878"><a href="#cb14-1878" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">+=</span> <span class="ss">f&#39;&lt;button class=&quot;filter-btn&quot; data-filter=&quot;</span><span class="sc">{</span>category<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot;&gt;</span><span class="sc">{</span>category<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">)&lt;/button&gt;</span><span class="ch">\n</span><span class="ss">&#39;</span></span>
<span id="cb14-1879"><a href="#cb14-1879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1880"><a href="#cb14-1880" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb14-1881"><a href="#cb14-1881" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb14-1882"><a href="#cb14-1882" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb14-1883"><a href="#cb14-1883" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div style=&quot;text-align: center; padding: 15px; background: #e9ecef; border-bottom: 1px solid #ddd;&quot;&gt;</span></span>
<span id="cb14-1884"><a href="#cb14-1884" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;strong&gt;Acesso R√°pido:&lt;/strong&gt;</span></span>
<span id="cb14-1885"><a href="#cb14-1885" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_markdown/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìÅ Markdown&lt;/a&gt;</span></span>
<span id="cb14-1886"><a href="#cb14-1886" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_html/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üåê HTML&lt;/a&gt;</span></span>
<span id="cb14-1887"><a href="#cb14-1887" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_pdfs/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìÑ PDF&lt;/a&gt;</span></span>
<span id="cb14-1888"><a href="#cb14-1888" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_json/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìã JSON&lt;/a&gt;</span></span>
<span id="cb14-1889"><a href="#cb14-1889" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb14-1890"><a href="#cb14-1890" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb14-1891"><a href="#cb14-1891" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div class=&quot;conversations-grid&quot; id=&quot;conversationsGrid&quot;&gt;</span></span>
<span id="cb14-1892"><a href="#cb14-1892" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb14-1893"><a href="#cb14-1893" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-1894"><a href="#cb14-1894" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.all_conversations):</span>
<span id="cb14-1895"><a href="#cb14-1895" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb14-1896"><a href="#cb14-1896" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb14-1897"><a href="#cb14-1897" aria-hidden="true" tabindex="-1"></a>            recent_badge <span class="op">=</span> <span class="st">&quot;&lt;span class=&#39;recent-badge&#39;&gt;NOVO&lt;/span&gt;&quot;</span> <span class="cf">if</span> i <span class="op">&lt;</span> <span class="dv">5</span> <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb14-1898"><a href="#cb14-1898" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1899"><a href="#cb14-1899" aria-hidden="true" tabindex="-1"></a>            summary <span class="op">=</span> conv.get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;Sem resumo dispon√≠vel&#39;</span>)</span>
<span id="cb14-1900"><a href="#cb14-1900" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(summary) <span class="op">&gt;</span> <span class="dv">150</span>:</span>
<span id="cb14-1901"><a href="#cb14-1901" aria-hidden="true" tabindex="-1"></a>                summary <span class="op">=</span> summary[:<span class="dv">150</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span></span>
<span id="cb14-1902"><a href="#cb14-1902" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-1903"><a href="#cb14-1903" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">+=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb14-1904"><a href="#cb14-1904" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div class=&quot;conversation-card&quot; data-title=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&quot; data-summary=&quot;</span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&quot; data-source=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot; data-category=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;category&#39;</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot;&gt;</span></span>
<span id="cb14-1905"><a href="#cb14-1905" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-header&quot;&gt;</span></span>
<span id="cb14-1906"><a href="#cb14-1906" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;card-number&quot;&gt;#</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>recent_badge<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb14-1907"><a href="#cb14-1907" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;card-actions&quot;&gt;</span></span>
<span id="cb14-1908"><a href="#cb14-1908" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_markdown/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.md&quot; class=&quot;action-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üìÑ MD&lt;/a&gt;</span></span>
<span id="cb14-1909"><a href="#cb14-1909" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_html/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&quot; class=&quot;action-btn html-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üåê HTML&lt;/a&gt;</span></span>
<span id="cb14-1910"><a href="#cb14-1910" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_pdfs/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.pdf&quot; class=&quot;action-btn pdf-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üìä PDF&lt;/a&gt;</span></span>
<span id="cb14-1911"><a href="#cb14-1911" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;/div&gt;</span></span>
<span id="cb14-1912"><a href="#cb14-1912" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb14-1913"><a href="#cb14-1913" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-title&quot; onclick=&quot;openHTML(&#39;</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&#39;)&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb14-1914"><a href="#cb14-1914" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div&gt;</span></span>
<span id="cb14-1915"><a href="#cb14-1915" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span class=&quot;card-source&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb14-1916"><a href="#cb14-1916" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span class=&quot;category-badge&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;category&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb14-1917"><a href="#cb14-1917" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb14-1918"><a href="#cb14-1918" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-summary&quot; onclick=&quot;openHTML(&#39;</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&#39;)&quot;&gt;</span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb14-1919"><a href="#cb14-1919" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-meta&quot;&gt;</span></span>
<span id="cb14-1920"><a href="#cb14-1920" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span&gt;üìÖ </span><span class="sc">{</span>conv<span class="sc">.</span>get(<span class="st">&#39;updated_at&#39;</span>) <span class="kw">or</span> conv<span class="sc">.</span>get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb14-1921"><a href="#cb14-1921" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span&gt;üí¨ </span><span class="sc">{</span><span class="bu">len</span>(conv[<span class="st">&#39;messages&#39;</span>])<span class="sc">}</span><span class="ss"> mensagens&lt;/span&gt;</span></span>
<span id="cb14-1922"><a href="#cb14-1922" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb14-1923"><a href="#cb14-1923" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb14-1924"><a href="#cb14-1924" aria-hidden="true" tabindex="-1"></a><span class="ss">            &quot;&quot;&quot;</span></span>
<span id="cb14-1925"><a href="#cb14-1925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1926"><a href="#cb14-1926" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb14-1927"><a href="#cb14-1927" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb14-1928"><a href="#cb14-1928" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/div&gt;</span></span>
<span id="cb14-1929"><a href="#cb14-1929" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb14-1930"><a href="#cb14-1930" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;script&gt;</span></span>
<span id="cb14-1931"><a href="#cb14-1931" aria-hidden="true" tabindex="-1"></a><span class="st">        let currentFilter = &#39;todas&#39;;</span></span>
<span id="cb14-1932"><a href="#cb14-1932" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb14-1933"><a href="#cb14-1933" aria-hidden="true" tabindex="-1"></a><span class="st">        document.addEventListener(&#39;DOMContentLoaded&#39;, function() {</span></span>
<span id="cb14-1934"><a href="#cb14-1934" aria-hidden="true" tabindex="-1"></a><span class="st">            updateStats();</span></span>
<span id="cb14-1935"><a href="#cb14-1935" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb14-1936"><a href="#cb14-1936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1937"><a href="#cb14-1937" aria-hidden="true" tabindex="-1"></a><span class="st">        document.querySelectorAll(&#39;.filter-btn&#39;).forEach(btn =&gt; {</span></span>
<span id="cb14-1938"><a href="#cb14-1938" aria-hidden="true" tabindex="-1"></a><span class="st">            btn.addEventListener(&#39;click&#39;, () =&gt; {</span></span>
<span id="cb14-1939"><a href="#cb14-1939" aria-hidden="true" tabindex="-1"></a><span class="st">                document.querySelectorAll(&#39;.filter-btn&#39;).forEach(b =&gt; b.classList.remove(&#39;active&#39;));</span></span>
<span id="cb14-1940"><a href="#cb14-1940" aria-hidden="true" tabindex="-1"></a><span class="st">                btn.classList.add(&#39;active&#39;);</span></span>
<span id="cb14-1941"><a href="#cb14-1941" aria-hidden="true" tabindex="-1"></a><span class="st">                currentFilter = btn.getAttribute(&#39;data-filter&#39;);</span></span>
<span id="cb14-1942"><a href="#cb14-1942" aria-hidden="true" tabindex="-1"></a><span class="st">                filterConversations();</span></span>
<span id="cb14-1943"><a href="#cb14-1943" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb14-1944"><a href="#cb14-1944" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb14-1945"><a href="#cb14-1945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1946"><a href="#cb14-1946" aria-hidden="true" tabindex="-1"></a><span class="st">        document.getElementById(&#39;searchInput&#39;).addEventListener(&#39;input&#39;, filterConversations);</span></span>
<span id="cb14-1947"><a href="#cb14-1947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1948"><a href="#cb14-1948" aria-hidden="true" tabindex="-1"></a><span class="st">        function filterConversations() {</span></span>
<span id="cb14-1949"><a href="#cb14-1949" aria-hidden="true" tabindex="-1"></a><span class="st">            const term = document.getElementById(&#39;searchInput&#39;).value.toLowerCase();</span></span>
<span id="cb14-1950"><a href="#cb14-1950" aria-hidden="true" tabindex="-1"></a><span class="st">            const cards = document.querySelectorAll(&#39;.conversation-card&#39;);</span></span>
<span id="cb14-1951"><a href="#cb14-1951" aria-hidden="true" tabindex="-1"></a><span class="st">            let visible = 0;</span></span>
<span id="cb14-1952"><a href="#cb14-1952" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-1953"><a href="#cb14-1953" aria-hidden="true" tabindex="-1"></a><span class="st">            cards.forEach(card =&gt; {</span></span>
<span id="cb14-1954"><a href="#cb14-1954" aria-hidden="true" tabindex="-1"></a><span class="st">                const title = card.getAttribute(&#39;data-title&#39;).toLowerCase();</span></span>
<span id="cb14-1955"><a href="#cb14-1955" aria-hidden="true" tabindex="-1"></a><span class="st">                const summary = card.getAttribute(&#39;data-summary&#39;).toLowerCase();</span></span>
<span id="cb14-1956"><a href="#cb14-1956" aria-hidden="true" tabindex="-1"></a><span class="st">                const source = card.getAttribute(&#39;data-source&#39;).toLowerCase();</span></span>
<span id="cb14-1957"><a href="#cb14-1957" aria-hidden="true" tabindex="-1"></a><span class="st">                const category = card.getAttribute(&#39;data-category&#39;).toLowerCase();</span></span>
<span id="cb14-1958"><a href="#cb14-1958" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb14-1959"><a href="#cb14-1959" aria-hidden="true" tabindex="-1"></a><span class="st">                const matchesSearch = (title.includes(term) || summary.includes(term) || category.includes(term) || source.includes(term));</span></span>
<span id="cb14-1960"><a href="#cb14-1960" aria-hidden="true" tabindex="-1"></a><span class="st">                const matchesCategory = (currentFilter === &#39;todas&#39; || category === currentFilter);</span></span>
<span id="cb14-1961"><a href="#cb14-1961" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb14-1962"><a href="#cb14-1962" aria-hidden="true" tabindex="-1"></a><span class="st">                if (matchesSearch &amp;&amp; matchesCategory) {</span></span>
<span id="cb14-1963"><a href="#cb14-1963" aria-hidden="true" tabindex="-1"></a><span class="st">                    card.style.display = &#39;block&#39;;</span></span>
<span id="cb14-1964"><a href="#cb14-1964" aria-hidden="true" tabindex="-1"></a><span class="st">                    visible++;</span></span>
<span id="cb14-1965"><a href="#cb14-1965" aria-hidden="true" tabindex="-1"></a><span class="st">                } else {</span></span>
<span id="cb14-1966"><a href="#cb14-1966" aria-hidden="true" tabindex="-1"></a><span class="st">                    card.style.display = &#39;none&#39;;</span></span>
<span id="cb14-1967"><a href="#cb14-1967" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb14-1968"><a href="#cb14-1968" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb14-1969"><a href="#cb14-1969" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-1970"><a href="#cb14-1970" aria-hidden="true" tabindex="-1"></a><span class="st">            updateStats(visible);</span></span>
<span id="cb14-1971"><a href="#cb14-1971" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-1972"><a href="#cb14-1972" aria-hidden="true" tabindex="-1"></a><span class="st">            const grid = document.getElementById(&#39;conversationsGrid&#39;);</span></span>
<span id="cb14-1973"><a href="#cb14-1973" aria-hidden="true" tabindex="-1"></a><span class="st">            const noResults = document.getElementById(&#39;no-results-message&#39;);</span></span>
<span id="cb14-1974"><a href="#cb14-1974" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb14-1975"><a href="#cb14-1975" aria-hidden="true" tabindex="-1"></a><span class="st">            if (visible === 0) {</span></span>
<span id="cb14-1976"><a href="#cb14-1976" aria-hidden="true" tabindex="-1"></a><span class="st">                if (!noResults) {</span></span>
<span id="cb14-1977"><a href="#cb14-1977" aria-hidden="true" tabindex="-1"></a><span class="st">                    const noResultsMsg = document.createElement(&#39;div&#39;);</span></span>
<span id="cb14-1978"><a href="#cb14-1978" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.id = &#39;no-results-message&#39;;</span></span>
<span id="cb14-1979"><a href="#cb14-1979" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.className = &#39;no-results&#39;;</span></span>
<span id="cb14-1980"><a href="#cb14-1980" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.innerHTML = &#39;üîç Nenhuma conversa encontrada. Tente ajustar os filtros ou a pesquisa.&#39;;</span></span>
<span id="cb14-1981"><a href="#cb14-1981" aria-hidden="true" tabindex="-1"></a><span class="st">                    grid.appendChild(noResultsMsg);</span></span>
<span id="cb14-1982"><a href="#cb14-1982" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb14-1983"><a href="#cb14-1983" aria-hidden="true" tabindex="-1"></a><span class="st">            } else if (noResults) {</span></span>
<span id="cb14-1984"><a href="#cb14-1984" aria-hidden="true" tabindex="-1"></a><span class="st">                noResults.remove();</span></span>
<span id="cb14-1985"><a href="#cb14-1985" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-1986"><a href="#cb14-1986" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb14-1987"><a href="#cb14-1987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1988"><a href="#cb14-1988" aria-hidden="true" tabindex="-1"></a><span class="st">        function updateStats(visibleCount = null) {</span></span>
<span id="cb14-1989"><a href="#cb14-1989" aria-hidden="true" tabindex="-1"></a><span class="st">            const totalElement = document.getElementById(&#39;total-count&#39;);</span></span>
<span id="cb14-1990"><a href="#cb14-1990" aria-hidden="true" tabindex="-1"></a><span class="st">            if (visibleCount !== null) {</span></span>
<span id="cb14-1991"><a href="#cb14-1991" aria-hidden="true" tabindex="-1"></a><span class="st">                totalElement.textContent = visibleCount;</span></span>
<span id="cb14-1992"><a href="#cb14-1992" aria-hidden="true" tabindex="-1"></a><span class="st">            } else {</span></span>
<span id="cb14-1993"><a href="#cb14-1993" aria-hidden="true" tabindex="-1"></a><span class="st">                totalElement.textContent = &quot;&quot;&quot;</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(<span class="va">self</span>.all_conversations)) <span class="op">+</span> <span class="st">&quot;&quot;&quot;;</span></span>
<span id="cb14-1994"><a href="#cb14-1994" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-1995"><a href="#cb14-1995" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb14-1996"><a href="#cb14-1996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1997"><a href="#cb14-1997" aria-hidden="true" tabindex="-1"></a><span class="st">        function openHTML(filename) {</span></span>
<span id="cb14-1998"><a href="#cb14-1998" aria-hidden="true" tabindex="-1"></a><span class="st">            const htmlUrl = &#39;combined_html/&#39; + filename;</span></span>
<span id="cb14-1999"><a href="#cb14-1999" aria-hidden="true" tabindex="-1"></a><span class="st">            console.log(&#39;Abrindo HTML:&#39;, htmlUrl);</span></span>
<span id="cb14-2000"><a href="#cb14-2000" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(htmlUrl, &#39;_blank&#39;);</span></span>
<span id="cb14-2001"><a href="#cb14-2001" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb14-2002"><a href="#cb14-2002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2003"><a href="#cb14-2003" aria-hidden="true" tabindex="-1"></a><span class="st">        function openMD(filename) {</span></span>
<span id="cb14-2004"><a href="#cb14-2004" aria-hidden="true" tabindex="-1"></a><span class="st">            const mdUrl = &#39;combined_markdown/&#39; + filename;</span></span>
<span id="cb14-2005"><a href="#cb14-2005" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(mdUrl, &#39;_blank&#39;);</span></span>
<span id="cb14-2006"><a href="#cb14-2006" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb14-2007"><a href="#cb14-2007" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb14-2008"><a href="#cb14-2008" aria-hidden="true" tabindex="-1"></a><span class="st">        function openPDF(filename) {</span></span>
<span id="cb14-2009"><a href="#cb14-2009" aria-hidden="true" tabindex="-1"></a><span class="st">            const pdfFile = filename.replace(&#39;.html&#39;, &#39;.pdf&#39;);</span></span>
<span id="cb14-2010"><a href="#cb14-2010" aria-hidden="true" tabindex="-1"></a><span class="st">            const pdfUrl = &#39;combined_pdfs/&#39; + pdfFile;</span></span>
<span id="cb14-2011"><a href="#cb14-2011" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(pdfUrl, &#39;_blank&#39;);</span></span>
<span id="cb14-2012"><a href="#cb14-2012" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb14-2013"><a href="#cb14-2013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2014"><a href="#cb14-2014" aria-hidden="true" tabindex="-1"></a><span class="st">        document.addEventListener(&#39;keydown&#39;, function(e) {</span></span>
<span id="cb14-2015"><a href="#cb14-2015" aria-hidden="true" tabindex="-1"></a><span class="st">            if (e.key === &#39;Escape&#39;) {</span></span>
<span id="cb14-2016"><a href="#cb14-2016" aria-hidden="true" tabindex="-1"></a><span class="st">                document.getElementById(&#39;searchInput&#39;).value = &#39;&#39;;</span></span>
<span id="cb14-2017"><a href="#cb14-2017" aria-hidden="true" tabindex="-1"></a><span class="st">                filterConversations();</span></span>
<span id="cb14-2018"><a href="#cb14-2018" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb14-2019"><a href="#cb14-2019" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb14-2020"><a href="#cb14-2020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2021"><a href="#cb14-2021" aria-hidden="true" tabindex="-1"></a><span class="st">        document.querySelectorAll(&#39;.conversation-card&#39;).forEach(card =&gt; {</span></span>
<span id="cb14-2022"><a href="#cb14-2022" aria-hidden="true" tabindex="-1"></a><span class="st">            card.addEventListener(&#39;click&#39;, function(e) {</span></span>
<span id="cb14-2023"><a href="#cb14-2023" aria-hidden="true" tabindex="-1"></a><span class="st">                if (e.target.closest(&#39;.action-btn&#39;)) {</span></span>
<span id="cb14-2024"><a href="#cb14-2024" aria-hidden="true" tabindex="-1"></a><span class="st">                    return;</span></span>
<span id="cb14-2025"><a href="#cb14-2025" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb14-2026"><a href="#cb14-2026" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb14-2027"><a href="#cb14-2027" aria-hidden="true" tabindex="-1"></a><span class="st">                const htmlBtn = this.querySelector(&#39;a.html-btn&#39;);</span></span>
<span id="cb14-2028"><a href="#cb14-2028" aria-hidden="true" tabindex="-1"></a><span class="st">                if (htmlBtn) {</span></span>
<span id="cb14-2029"><a href="#cb14-2029" aria-hidden="true" tabindex="-1"></a><span class="st">                    const htmlUrl = htmlBtn.getAttribute(&#39;href&#39;);</span></span>
<span id="cb14-2030"><a href="#cb14-2030" aria-hidden="true" tabindex="-1"></a><span class="st">                    window.open(htmlUrl, &#39;_blank&#39;);</span></span>
<span id="cb14-2031"><a href="#cb14-2031" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb14-2032"><a href="#cb14-2032" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb14-2033"><a href="#cb14-2033" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb14-2034"><a href="#cb14-2034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2035"><a href="#cb14-2035" aria-hidden="true" tabindex="-1"></a><span class="st">        document.getElementById(&#39;searchInput&#39;).focus();</span></span>
<span id="cb14-2036"><a href="#cb14-2036" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb14-2037"><a href="#cb14-2037" aria-hidden="true" tabindex="-1"></a><span class="st">        console.log(&#39;√çndice carregado com&#39;, &quot;&quot;&quot;</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(<span class="va">self</span>.all_conversations)) <span class="op">+</span> <span class="st">&quot;&quot;&quot;, &#39;conversas&#39;);</span></span>
<span id="cb14-2038"><a href="#cb14-2038" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/script&gt;</span></span>
<span id="cb14-2039"><a href="#cb14-2039" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/body&gt;</span></span>
<span id="cb14-2040"><a href="#cb14-2040" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/html&gt;</span></span>
<span id="cb14-2041"><a href="#cb14-2041" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb14-2042"><a href="#cb14-2042" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-2043"><a href="#cb14-2043" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.index_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb14-2044"><a href="#cb14-2044" aria-hidden="true" tabindex="-1"></a>            f.write(html_content)</span>
<span id="cb14-2045"><a href="#cb14-2045" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ √çndice combinado criado: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-2046"><a href="#cb14-2046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2047"><a href="#cb14-2047" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb14-2048"><a href="#cb14-2048" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser(</span>
<span id="cb14-2049"><a href="#cb14-2049" aria-hidden="true" tabindex="-1"></a>        description<span class="op">=</span><span class="st">&quot;Processa exporta√ß√µes combinadas com exporta√ß√£o HTML via Pandoc.&quot;</span></span>
<span id="cb14-2050"><a href="#cb14-2050" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-2051"><a href="#cb14-2051" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">&quot;--dry-run&quot;</span>, action<span class="op">=</span><span class="st">&quot;store_true&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Executa sem salvar arquivos&quot;</span>)</span>
<span id="cb14-2052"><a href="#cb14-2052" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">&quot;--force-overwrite&quot;</span>, action<span class="op">=</span><span class="st">&quot;store_true&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Substitui arquivos existentes&quot;</span>)</span>
<span id="cb14-2053"><a href="#cb14-2053" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-2054"><a href="#cb14-2054" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb14-2055"><a href="#cb14-2055" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-2056"><a href="#cb14-2056" aria-hidden="true" tabindex="-1"></a>    system <span class="op">=</span> CombinedFragmentsSystem(</span>
<span id="cb14-2057"><a href="#cb14-2057" aria-hidden="true" tabindex="-1"></a>        dry_run<span class="op">=</span>args.dry_run,</span>
<span id="cb14-2058"><a href="#cb14-2058" aria-hidden="true" tabindex="-1"></a>        force_overwrite<span class="op">=</span>args.force_overwrite</span>
<span id="cb14-2059"><a href="#cb14-2059" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-2060"><a href="#cb14-2060" aria-hidden="true" tabindex="-1"></a>    system.run()</span>
<span id="cb14-2061"><a href="#cb14-2061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2062"><a href="#cb14-2062" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb14-2063"><a href="#cb14-2063" aria-hidden="true" tabindex="-1"></a>    main()</span></code></pre></div>
<h2 data-number="1.6" id="principais-otimiza√ß√µes-implementadas-1"><span class="header-section-number">1.6</span> Principais otimiza√ß√µes
implementadas:</h2>
<h3 data-number="1.6.1" id="pandoc-com-todas-as-op√ß√µes-avan√ßadas"><span class="header-section-number">1.6.1</span> 1. <strong>Pandoc com todas
as op√ß√µes avan√ßadas:</strong></h3>
<ul>
<li><code>--standalone --mathjax --embed-resources --syntax-highlighting=pygments</code></li>
<li><code>--mathjax=assets/tex-mml-chtml.js</code> (MathJax local)</li>
<li><code>--table-of-contents --toc-depth=2 --number-sections</code></li>
</ul>
<h3 data-number="1.6.2" id="detec√ß√£o-de-vers√£o-do-pandoc"><span class="header-section-number">1.6.2</span> 2. <strong>Detec√ß√£o de vers√£o
do Pandoc:</strong></h3>
<ul>
<li>Verifica automaticamente se <code>--embed-resources</code> √©
suportado (Pandoc 2.19+)</li>
<li>Fallback autom√°tico para vers√µes mais antigas</li>
</ul>
<h3 data-number="1.6.3" id="table-of-contents-toc-aprimorado"><span class="header-section-number">1.6.3</span> 3. <strong>Table of Contents
(TOC) aprimorado:</strong></h3>
<ul>
<li>Estiliza√ß√£o CSS personalizada para o TOC</li>
<li>Hierarquia visual clara com diferentes n√≠veis</li>
<li>Design responsivo e acess√≠vel</li>
</ul>
<h3 data-number="1.6.4" id="numera√ß√£o-de-se√ß√µes"><span class="header-section-number">1.6.4</span> 4. <strong>Numera√ß√£o de
se√ß√µes:</strong></h3>
<ul>
<li>Estilos CSS para n√∫meros de se√ß√£o</li>
<li>Destaque visual para hierarquia</li>
<li>Compat√≠vel com a numera√ß√£o gerada pelo Pandoc</li>
</ul>
<h3 data-number="1.6.5" id="css-otimizado"><span class="header-section-number">1.6.5</span> 5. <strong>CSS
otimizado:</strong></h3>
<ul>
<li>Estilos espec√≠ficos para TOC e numera√ß√£o</li>
<li>Design moderno e responsivo</li>
<li>Melhorias de acessibilidade</li>
</ul>
<h3 data-number="1.6.6" id="sistema-de-fallback-robusto"><span class="header-section-number">1.6.6</span> 6. <strong>Sistema de
fallback robusto:</strong></h3>
<ul>
<li>3 n√≠veis de convers√£o (Pandoc otimizado ‚Üí Pandoc b√°sico ‚Üí
Python)</li>
<li>Timeouts ajustados para processamento pesado</li>
<li>Logs detalhados para debugging</li>
</ul>
<h3 data-number="1.6.7" id="comandos-recomendados"><span class="header-section-number">1.6.7</span> Comandos recomendados:</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar ambiente</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> assets</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span> <span class="at">-O</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Executar o sistema</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> comb_fragments_system4_html_export.py</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Modo dry-run para teste</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> comb_fragments_system4_html_export.py <span class="at">--dry-run</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># For√ßar sobrescrita</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> comb_fragments_system4_html_export.py <span class="at">--force-overwrite</span></span></code></pre></div>
<p>Este sistema agora oferece convers√£o HTML premium com TOC autom√°tico,
numera√ß√£o de se√ß√µes, syntax highlighting avan√ßado e suporte completo a
f√≥rmulas matem√°ticas!</p>
<hr />
<h3 data-number="1.6.8" id="utilizador-2025-11-08-012326-deepseek-reasoner"><span class="header-section-number">1.6.8</span> üë§ Utilizador <em>(2025-11-08
01:23:26)</em> <em>[deepseek-reasoner]</em></h3>
<p>Este sistema agora apresenta o html em meia pagina A4 porqu√™?</p>
<hr />
<h3 data-number="1.6.9" id="deepseek-2025-11-08-012326-deepseek-reasoner"><span class="header-section-number">1.6.9</span> ü§ñ DeepSeek <em>(2025-11-08
01:23:26)</em> <em>[deepseek-reasoner]</em></h3>
<p>O problema de o HTML aparecer em meia p√°gina A4 provavelmente est√°
relacionado com o CSS que est√° a ser aplicado. O sistema atual usa um
container com <code>max-width: 900px</code> e margens autom√°ticas, o que
pode n√£o ser ideal para impress√£o em A4.</p>
<p>Para melhorar a apresenta√ß√£o para impress√£o, podemos adicionar um CSS
espec√≠fico para a media query <code>@media print</code>. Vamos ajustar o
layout para usar a largura total da p√°gina e ajustar o tamanho da fonte
para ser leg√≠vel quando impresso.</p>
<p>Al√©m disso, o sistema atual est√° a usar um layout que √© mais adequado
para ecr√£. Para impress√£o, podemos querer remover sombras, cores de
fundo e ajustar margens.</p>
<p>Vamos modificar a fun√ß√£o <code>_inject_enhanced_css</code> para
incluir uma se√ß√£o de estilos para impress√£o. Tamb√©m podemos ajustar o
container para que, quando impresso, ocupe a largura total e tenha
margens adequadas.</p>
<p>Aqui est√£o as altera√ß√µes sugeridas:</p>
<ol type="1">
<li>Adicionar uma media query para impress√£o no CSS.</li>
<li>Ajustar o container para ter 100% de largura e margens zero quando
impresso.</li>
<li>Ajustar o tamanho da fonte para ser relativo (usar <code>pt</code>
ou <code>cm</code> para impress√£o).</li>
<li>Garantir que o Table of Contents (TOC) e a numera√ß√£o de se√ß√µes s√£o
leg√≠veis na impress√£o.</li>
</ol>
<p>Vamos modificar a fun√ß√£o <code>_inject_enhanced_css</code> para
incluir estes estilos de impress√£o.</p>
<p>No entanto, note que o problema descrito √© que o HTML est√° a ser
apresentado em meia p√°gina A4. Isso pode ser devido ao container ter uma
largura fixa de 900px, o que √© mais que a metade da largura de um A4
(que √© cerca de 595px a 842px de altura). Portanto, para impress√£o,
devemos ajustar a largura para 100% e talvez usar uma unidade relativa
para o tamanho da fonte.</p>
<p>Vamos adicionar o seguinte CSS para impress√£o:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">@media</span> <span class="an">print</span> {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    body { </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">background</span><span class="ch">:</span> <span class="cn">white</span><span class="op">;</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">color</span><span class="ch">:</span> <span class="cn">black</span><span class="op">;</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">font-size</span><span class="ch">:</span> <span class="dv">12</span><span class="dt">pt</span><span class="op">;</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">line-height</span><span class="ch">:</span> <span class="dv">1.3</span><span class="op">;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">padding</span><span class="ch">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.container</span> {</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">max-width</span><span class="ch">:</span> <span class="dv">100</span><span class="dt">%</span><span class="op">;</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">padding</span><span class="ch">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">box-shadow</span><span class="ch">:</span> <span class="dv">none</span><span class="op">;</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">background</span><span class="ch">:</span> <span class="cn">white</span><span class="op">;</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#TOC</span> {</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">background</span><span class="ch">:</span> <span class="cn">white</span> <span class="at">!important</span><span class="op">;</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">border</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#000</span> <span class="at">!important</span><span class="op">;</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Outros ajustes para impress√£o */</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Vamos integrar isso no CSS injetado.</p>
<p>Al√©m disso, note que o Pandoc, quando usado com
<code>--standalone</code>, gera um HTML completo e pode incluir seu
pr√≥prio CSS. No entanto, estamos a injetar CSS personalizado, ent√£o
podemos sobrepor esses estilos.</p>
<p>Vamos modificar a fun√ß√£o <code>_inject_enhanced_css</code> para
incluir uma se√ß√£o de impress√£o.</p>
<p>Como o c√≥digo √© extenso, vou focar apenas na fun√ß√£o
<code>_inject_enhanced_css</code> e na
<code>_create_enhanced_html_template</code> (para o fallback) para
adicionar os estilos de impress√£o.</p>
<p>Vou tamb√©m ajustar o container principal para que, em impress√£o,
ocupe toda a largura e n√£o tenha margens.</p>
<p>Vamos fazer isso. O problema do HTML aparecer em meia p√°gina A4 est√°
relacionado com o CSS que define um <code>max-width</code> muito pequeno
para o container. Vou corrigir isso e otimizar o layout para melhor
utiliza√ß√£o do espa√ßo.</p>
<p>Aqui est√° a corre√ß√£o no arquivo
<code>comb_fragments_system4_html_export.py</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># comb_fragments_system4_html_export.py</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ... (c√≥digo anterior mantido igual)</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _inject_enhanced_css(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Injeta CSS personalizado aprimorado para TOC e numera√ß√£o - CORRIGIDO&quot;&quot;&quot;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        enhanced_css <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;style&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Container principal OTIMIZADO para usar espa√ßo total */</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="st">            body { </span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.6; </span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0; </span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px; </span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #f5f5f5;</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #333;</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: none !important; /* Remove limita√ß√£o de largura */</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="st">            .container {</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: 95% !important; /* Usa 95</span><span class="sc">% d</span><span class="st">a largura dispon√≠vel */</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0 auto;</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="st">                background: white;</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 30px;</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 10px;</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Estilos para Table of Contents */</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC {</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="st">                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #dee2e6;</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 20px 0;</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: 100% !important;</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul {</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="st">                list-style-type: none;</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 15px;</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 10px 0;</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul ul {</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 25px;</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC li {</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 8px 0;</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.4;</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a {</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a><span class="st">                text-decoration: none;</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #495057;</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 500;</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a><span class="st">                transition: color 0.2s ease;</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a><span class="st">                display: block;</span></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 4px 8px;</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 4px;</span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a:hover {</span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #007bff;</span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: rgba(0, 123, 255, 0.1);</span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC &gt; ul &gt; li &gt; a {</span></span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 600;</span></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50;</span></span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 3px solid #3498db;</span></span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 12px;</span></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Estilos para numera√ß√£o de se√ß√µes */</span></span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a><span class="st">            .header-section-number {</span></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #3498db;</span></span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: bold;</span></span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-right: 8px;</span></span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a><span class="st">            h1 .header-section-number {</span></span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.9em;</span></span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a><span class="st">            h2 .header-section-number {</span></span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.85em;</span></span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a><span class="st">            h3 .header-section-number {</span></span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.8em;</span></span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-94"><a href="#cb17-94" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para c√≥digo e matem√°tica */</span></span>
<span id="cb17-95"><a href="#cb17-95" aria-hidden="true" tabindex="-1"></a><span class="st">            .math { </span></span>
<span id="cb17-96"><a href="#cb17-96" aria-hidden="true" tabindex="-1"></a><span class="st">                display: block; </span></span>
<span id="cb17-97"><a href="#cb17-97" aria-hidden="true" tabindex="-1"></a><span class="st">                text-align: center; </span></span>
<span id="cb17-98"><a href="#cb17-98" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 1.5em 0; </span></span>
<span id="cb17-99"><a href="#cb17-99" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: 100% !important;</span></span>
<span id="cb17-100"><a href="#cb17-100" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow-x: auto;</span></span>
<span id="cb17-101"><a href="#cb17-101" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-102"><a href="#cb17-102" aria-hidden="true" tabindex="-1"></a><span class="st">            .math inline { </span></span>
<span id="cb17-103"><a href="#cb17-103" aria-hidden="true" tabindex="-1"></a><span class="st">                display: inline-block; </span></span>
<span id="cb17-104"><a href="#cb17-104" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-105"><a href="#cb17-105" aria-hidden="true" tabindex="-1"></a><span class="st">            pre { </span></span>
<span id="cb17-106"><a href="#cb17-106" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb17-107"><a href="#cb17-107" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #2d2d2d; </span></span>
<span id="cb17-108"><a href="#cb17-108" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #f8f8f2;</span></span>
<span id="cb17-109"><a href="#cb17-109" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb17-110"><a href="#cb17-110" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb17-111"><a href="#cb17-111" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow-x: auto;</span></span>
<span id="cb17-112"><a href="#cb17-112" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb17-113"><a href="#cb17-113" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.4;</span></span>
<span id="cb17-114"><a href="#cb17-114" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: 100% !important;</span></span>
<span id="cb17-115"><a href="#cb17-115" aria-hidden="true" tabindex="-1"></a><span class="st">                white-space: pre-wrap;</span></span>
<span id="cb17-116"><a href="#cb17-116" aria-hidden="true" tabindex="-1"></a><span class="st">                word-wrap: break-word;</span></span>
<span id="cb17-117"><a href="#cb17-117" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-118"><a href="#cb17-118" aria-hidden="true" tabindex="-1"></a><span class="st">            code { </span></span>
<span id="cb17-119"><a href="#cb17-119" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #e9ecef; </span></span>
<span id="cb17-120"><a href="#cb17-120" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 0.2em 0.4em; </span></span>
<span id="cb17-121"><a href="#cb17-121" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 3px;</span></span>
<span id="cb17-122"><a href="#cb17-122" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb17-123"><a href="#cb17-123" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #c7254e;</span></span>
<span id="cb17-124"><a href="#cb17-124" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-125"><a href="#cb17-125" aria-hidden="true" tabindex="-1"></a><span class="st">            pre code { </span></span>
<span id="cb17-126"><a href="#cb17-126" aria-hidden="true" tabindex="-1"></a><span class="st">                background: none; </span></span>
<span id="cb17-127"><a href="#cb17-127" aria-hidden="true" tabindex="-1"></a><span class="st">                color: inherit; </span></span>
<span id="cb17-128"><a href="#cb17-128" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 0; </span></span>
<span id="cb17-129"><a href="#cb17-129" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-130"><a href="#cb17-130" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-131"><a href="#cb17-131" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias responsivas - OTIMIZADO */</span></span>
<span id="cb17-132"><a href="#cb17-132" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 1200px) {</span></span>
<span id="cb17-133"><a href="#cb17-133" aria-hidden="true" tabindex="-1"></a><span class="st">                .container {</span></span>
<span id="cb17-134"><a href="#cb17-134" aria-hidden="true" tabindex="-1"></a><span class="st">                    max-width: 98% !important;</span></span>
<span id="cb17-135"><a href="#cb17-135" aria-hidden="true" tabindex="-1"></a><span class="st">                    padding: 25px;</span></span>
<span id="cb17-136"><a href="#cb17-136" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb17-137"><a href="#cb17-137" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-138"><a href="#cb17-138" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-139"><a href="#cb17-139" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 768px) {</span></span>
<span id="cb17-140"><a href="#cb17-140" aria-hidden="true" tabindex="-1"></a><span class="st">                body { </span></span>
<span id="cb17-141"><a href="#cb17-141" aria-hidden="true" tabindex="-1"></a><span class="st">                    padding: 10px; </span></span>
<span id="cb17-142"><a href="#cb17-142" aria-hidden="true" tabindex="-1"></a><span class="st">                    font-size: 14px; </span></span>
<span id="cb17-143"><a href="#cb17-143" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb17-144"><a href="#cb17-144" aria-hidden="true" tabindex="-1"></a><span class="st">                .container {</span></span>
<span id="cb17-145"><a href="#cb17-145" aria-hidden="true" tabindex="-1"></a><span class="st">                    max-width: 100% !important;</span></span>
<span id="cb17-146"><a href="#cb17-146" aria-hidden="true" tabindex="-1"></a><span class="st">                    padding: 20px;</span></span>
<span id="cb17-147"><a href="#cb17-147" aria-hidden="true" tabindex="-1"></a><span class="st">                    margin: 5px;</span></span>
<span id="cb17-148"><a href="#cb17-148" aria-hidden="true" tabindex="-1"></a><span class="st">                    border-radius: 5px;</span></span>
<span id="cb17-149"><a href="#cb17-149" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb17-150"><a href="#cb17-150" aria-hidden="true" tabindex="-1"></a><span class="st">                pre { </span></span>
<span id="cb17-151"><a href="#cb17-151" aria-hidden="true" tabindex="-1"></a><span class="st">                    font-size: 12px; </span></span>
<span id="cb17-152"><a href="#cb17-152" aria-hidden="true" tabindex="-1"></a><span class="st">                    padding: 15px; </span></span>
<span id="cb17-153"><a href="#cb17-153" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb17-154"><a href="#cb17-154" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC { </span></span>
<span id="cb17-155"><a href="#cb17-155" aria-hidden="true" tabindex="-1"></a><span class="st">                    padding: 15px; </span></span>
<span id="cb17-156"><a href="#cb17-156" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb17-157"><a href="#cb17-157" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-158"><a href="#cb17-158" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-159"><a href="#cb17-159" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para tabelas - OTIMIZADO */</span></span>
<span id="cb17-160"><a href="#cb17-160" aria-hidden="true" tabindex="-1"></a><span class="st">            table { </span></span>
<span id="cb17-161"><a href="#cb17-161" aria-hidden="true" tabindex="-1"></a><span class="st">                width: 100% !important; </span></span>
<span id="cb17-162"><a href="#cb17-162" aria-hidden="true" tabindex="-1"></a><span class="st">                border-collapse: collapse; </span></span>
<span id="cb17-163"><a href="#cb17-163" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 1.5em 0;</span></span>
<span id="cb17-164"><a href="#cb17-164" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb17-165"><a href="#cb17-165" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb17-166"><a href="#cb17-166" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow: hidden;</span></span>
<span id="cb17-167"><a href="#cb17-167" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: 100% !important;</span></span>
<span id="cb17-168"><a href="#cb17-168" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-169"><a href="#cb17-169" aria-hidden="true" tabindex="-1"></a><span class="st">            th, td { </span></span>
<span id="cb17-170"><a href="#cb17-170" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #dee2e6; </span></span>
<span id="cb17-171"><a href="#cb17-171" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 12px 15px; </span></span>
<span id="cb17-172"><a href="#cb17-172" aria-hidden="true" tabindex="-1"></a><span class="st">                text-align: left; </span></span>
<span id="cb17-173"><a href="#cb17-173" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-174"><a href="#cb17-174" aria-hidden="true" tabindex="-1"></a><span class="st">            th { </span></span>
<span id="cb17-175"><a href="#cb17-175" aria-hidden="true" tabindex="-1"></a><span class="st">                background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb17-176"><a href="#cb17-176" aria-hidden="true" tabindex="-1"></a><span class="st">                color: white; </span></span>
<span id="cb17-177"><a href="#cb17-177" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: bold;</span></span>
<span id="cb17-178"><a href="#cb17-178" aria-hidden="true" tabindex="-1"></a><span class="st">                text-transform: uppercase;</span></span>
<span id="cb17-179"><a href="#cb17-179" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.9em;</span></span>
<span id="cb17-180"><a href="#cb17-180" aria-hidden="true" tabindex="-1"></a><span class="st">                letter-spacing: 0.5px;</span></span>
<span id="cb17-181"><a href="#cb17-181" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-182"><a href="#cb17-182" aria-hidden="true" tabindex="-1"></a><span class="st">            tr:nth-child(even) { </span></span>
<span id="cb17-183"><a href="#cb17-183" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #f8f9fa; </span></span>
<span id="cb17-184"><a href="#cb17-184" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-185"><a href="#cb17-185" aria-hidden="true" tabindex="-1"></a><span class="st">            tr:hover { </span></span>
<span id="cb17-186"><a href="#cb17-186" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #e3f2fd; </span></span>
<span id="cb17-187"><a href="#cb17-187" aria-hidden="true" tabindex="-1"></a><span class="st">                transition: background-color 0.2s ease;</span></span>
<span id="cb17-188"><a href="#cb17-188" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-189"><a href="#cb17-189" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-190"><a href="#cb17-190" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para blocos de cita√ß√£o */</span></span>
<span id="cb17-191"><a href="#cb17-191" aria-hidden="true" tabindex="-1"></a><span class="st">            blockquote { </span></span>
<span id="cb17-192"><a href="#cb17-192" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb17-193"><a href="#cb17-193" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 25px 0; </span></span>
<span id="cb17-194"><a href="#cb17-194" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 25px; </span></span>
<span id="cb17-195"><a href="#cb17-195" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #7f8c8d;</span></span>
<span id="cb17-196"><a href="#cb17-196" aria-hidden="true" tabindex="-1"></a><span class="st">                font-style: italic;</span></span>
<span id="cb17-197"><a href="#cb17-197" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #f8f9fa;</span></span>
<span id="cb17-198"><a href="#cb17-198" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb17-199"><a href="#cb17-199" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 0 8px 8px 0;</span></span>
<span id="cb17-200"><a href="#cb17-200" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: 100% !important;</span></span>
<span id="cb17-201"><a href="#cb17-201" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-202"><a href="#cb17-202" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-203"><a href="#cb17-203" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Cabe√ßalhos com numera√ß√£o - OTIMIZADO */</span></span>
<span id="cb17-204"><a href="#cb17-204" aria-hidden="true" tabindex="-1"></a><span class="st">            h1, h2, h3, h4, h5 { </span></span>
<span id="cb17-205"><a href="#cb17-205" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50; </span></span>
<span id="cb17-206"><a href="#cb17-206" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-top: 1.8em;</span></span>
<span id="cb17-207"><a href="#cb17-207" aria-hidden="true" tabindex="-1"></a><span class="st">                border-bottom: 1px solid #e9ecef;</span></span>
<span id="cb17-208"><a href="#cb17-208" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-bottom: 0.5em;</span></span>
<span id="cb17-209"><a href="#cb17-209" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: 100% !important;</span></span>
<span id="cb17-210"><a href="#cb17-210" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-211"><a href="#cb17-211" aria-hidden="true" tabindex="-1"></a><span class="st">            h1 { </span></span>
<span id="cb17-212"><a href="#cb17-212" aria-hidden="true" tabindex="-1"></a><span class="st">                border-bottom: 3px solid #3498db; </span></span>
<span id="cb17-213"><a href="#cb17-213" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-bottom: 15px; </span></span>
<span id="cb17-214"><a href="#cb17-214" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50;</span></span>
<span id="cb17-215"><a href="#cb17-215" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 2.2em;</span></span>
<span id="cb17-216"><a href="#cb17-216" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-217"><a href="#cb17-217" aria-hidden="true" tabindex="-1"></a><span class="st">            h2 {</span></span>
<span id="cb17-218"><a href="#cb17-218" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db;</span></span>
<span id="cb17-219"><a href="#cb17-219" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 15px;</span></span>
<span id="cb17-220"><a href="#cb17-220" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-top: 2em;</span></span>
<span id="cb17-221"><a href="#cb17-221" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-222"><a href="#cb17-222" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-223"><a href="#cb17-223" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Mensagens de conversa - OTIMIZADO */</span></span>
<span id="cb17-224"><a href="#cb17-224" aria-hidden="true" tabindex="-1"></a><span class="st">            .message-header {</span></span>
<span id="cb17-225"><a href="#cb17-225" aria-hidden="true" tabindex="-1"></a><span class="st">                display: flex;</span></span>
<span id="cb17-226"><a href="#cb17-226" aria-hidden="true" tabindex="-1"></a><span class="st">                justify-content: space-between;</span></span>
<span id="cb17-227"><a href="#cb17-227" aria-hidden="true" tabindex="-1"></a><span class="st">                align-items: center;</span></span>
<span id="cb17-228"><a href="#cb17-228" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-bottom: 15px;</span></span>
<span id="cb17-229"><a href="#cb17-229" aria-hidden="true" tabindex="-1"></a><span class="st">                flex-wrap: wrap;</span></span>
<span id="cb17-230"><a href="#cb17-230" aria-hidden="true" tabindex="-1"></a><span class="st">                gap: 10px;</span></span>
<span id="cb17-231"><a href="#cb17-231" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: 100% !important;</span></span>
<span id="cb17-232"><a href="#cb17-232" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-233"><a href="#cb17-233" aria-hidden="true" tabindex="-1"></a><span class="st">            .author {</span></span>
<span id="cb17-234"><a href="#cb17-234" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: bold;</span></span>
<span id="cb17-235"><a href="#cb17-235" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50;</span></span>
<span id="cb17-236"><a href="#cb17-236" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 1.1em;</span></span>
<span id="cb17-237"><a href="#cb17-237" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-238"><a href="#cb17-238" aria-hidden="true" tabindex="-1"></a><span class="st">            .timestamp {</span></span>
<span id="cb17-239"><a href="#cb17-239" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #7f8c8d;</span></span>
<span id="cb17-240"><a href="#cb17-240" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.9em;</span></span>
<span id="cb17-241"><a href="#cb17-241" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #e9ecef;</span></span>
<span id="cb17-242"><a href="#cb17-242" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 4px 8px;</span></span>
<span id="cb17-243"><a href="#cb17-243" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 4px;</span></span>
<span id="cb17-244"><a href="#cb17-244" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-245"><a href="#cb17-245" aria-hidden="true" tabindex="-1"></a><span class="st">            .message-content {</span></span>
<span id="cb17-246"><a href="#cb17-246" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #f8f9fa;</span></span>
<span id="cb17-247"><a href="#cb17-247" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb17-248"><a href="#cb17-248" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb17-249"><a href="#cb17-249" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db;</span></span>
<span id="cb17-250"><a href="#cb17-250" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-bottom: 20px;</span></span>
<span id="cb17-251"><a href="#cb17-251" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: 100% !important;</span></span>
<span id="cb17-252"><a href="#cb17-252" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-253"><a href="#cb17-253" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb17-254"><a href="#cb17-254" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Estilos para impress√£o */</span></span>
<span id="cb17-255"><a href="#cb17-255" aria-hidden="true" tabindex="-1"></a><span class="st">            @media print {</span></span>
<span id="cb17-256"><a href="#cb17-256" aria-hidden="true" tabindex="-1"></a><span class="st">                body {</span></span>
<span id="cb17-257"><a href="#cb17-257" aria-hidden="true" tabindex="-1"></a><span class="st">                    background: white !important;</span></span>
<span id="cb17-258"><a href="#cb17-258" aria-hidden="true" tabindex="-1"></a><span class="st">                    padding: 0 !important;</span></span>
<span id="cb17-259"><a href="#cb17-259" aria-hidden="true" tabindex="-1"></a><span class="st">                    margin: 0 !important;</span></span>
<span id="cb17-260"><a href="#cb17-260" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb17-261"><a href="#cb17-261" aria-hidden="true" tabindex="-1"></a><span class="st">                .container {</span></span>
<span id="cb17-262"><a href="#cb17-262" aria-hidden="true" tabindex="-1"></a><span class="st">                    max-width: 100% !important;</span></span>
<span id="cb17-263"><a href="#cb17-263" aria-hidden="true" tabindex="-1"></a><span class="st">                    box-shadow: none !important;</span></span>
<span id="cb17-264"><a href="#cb17-264" aria-hidden="true" tabindex="-1"></a><span class="st">                    padding: 15px !important;</span></span>
<span id="cb17-265"><a href="#cb17-265" aria-hidden="true" tabindex="-1"></a><span class="st">                    margin: 0 !important;</span></span>
<span id="cb17-266"><a href="#cb17-266" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb17-267"><a href="#cb17-267" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC {</span></span>
<span id="cb17-268"><a href="#cb17-268" aria-hidden="true" tabindex="-1"></a><span class="st">                    page-break-after: always;</span></span>
<span id="cb17-269"><a href="#cb17-269" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb17-270"><a href="#cb17-270" aria-hidden="true" tabindex="-1"></a><span class="st">                pre, code {</span></span>
<span id="cb17-271"><a href="#cb17-271" aria-hidden="true" tabindex="-1"></a><span class="st">                    white-space: pre-wrap !important;</span></span>
<span id="cb17-272"><a href="#cb17-272" aria-hidden="true" tabindex="-1"></a><span class="st">                    word-wrap: break-word !important;</span></span>
<span id="cb17-273"><a href="#cb17-273" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb17-274"><a href="#cb17-274" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb17-275"><a href="#cb17-275" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/style&gt;</span></span>
<span id="cb17-276"><a href="#cb17-276" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb17-277"><a href="#cb17-277" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-278"><a href="#cb17-278" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;/head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb17-279"><a href="#cb17-279" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;/head&gt;&#39;</span>, <span class="ss">f&#39;</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;&#39;</span>)</span>
<span id="cb17-280"><a href="#cb17-280" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb17-281"><a href="#cb17-281" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb17-282"><a href="#cb17-282" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb17-283"><a href="#cb17-283" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;&lt;body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb17-284"><a href="#cb17-284" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;body&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;&#39;</span>)</span>
<span id="cb17-285"><a href="#cb17-285" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb17-286"><a href="#cb17-286" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;</span><span class="ch">\n</span><span class="sc">{</span>html_content<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/body&gt;&#39;</span></span>
<span id="cb17-287"><a href="#cb17-287" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb17-288"><a href="#cb17-288" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb17-289"><a href="#cb17-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-290"><a href="#cb17-290" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_enhanced_html_template(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb17-291"><a href="#cb17-291" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Template HTML aprimorado com suporte a MathJax local/online - CORRIGIDO&quot;&quot;&quot;</span></span>
<span id="cb17-292"><a href="#cb17-292" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb17-293"><a href="#cb17-293" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-294"><a href="#cb17-294" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb17-295"><a href="#cb17-295" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html lang=&quot;pt-BR&quot;&gt;</span></span>
<span id="cb17-296"><a href="#cb17-296" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb17-297"><a href="#cb17-297" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb17-298"><a href="#cb17-298" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb17-299"><a href="#cb17-299" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb17-300"><a href="#cb17-300" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb17-301"><a href="#cb17-301" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* CONTAINER PRINCIPAL OTIMIZADO */</span></span>
<span id="cb17-302"><a href="#cb17-302" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span></span>
<span id="cb17-303"><a href="#cb17-303" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb17-304"><a href="#cb17-304" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb17-305"><a href="#cb17-305" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0;</span></span>
<span id="cb17-306"><a href="#cb17-306" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb17-307"><a href="#cb17-307" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb17-308"><a href="#cb17-308" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333;</span></span>
<span id="cb17-309"><a href="#cb17-309" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: none !important;</span></span>
<span id="cb17-310"><a href="#cb17-310" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-311"><a href="#cb17-311" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb17-312"><a href="#cb17-312" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 95% !important;</span></span>
<span id="cb17-313"><a href="#cb17-313" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb17-314"><a href="#cb17-314" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb17-315"><a href="#cb17-315" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 30px;</span></span>
<span id="cb17-316"><a href="#cb17-316" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 10px;</span></span>
<span id="cb17-317"><a href="#cb17-317" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb17-318"><a href="#cb17-318" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-319"><a href="#cb17-319" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb17-320"><a href="#cb17-320" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1, h2, h3, h4, h5 </span><span class="ch">{{</span></span>
<span id="cb17-321"><a href="#cb17-321" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb17-322"><a href="#cb17-322" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 1.8em;</span></span>
<span id="cb17-323"><a href="#cb17-323" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 100% !important;</span></span>
<span id="cb17-324"><a href="#cb17-324" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-325"><a href="#cb17-325" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1 </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb17-326"><a href="#cb17-326" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 3px solid #3498db; </span></span>
<span id="cb17-327"><a href="#cb17-327" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 15px; </span></span>
<span id="cb17-328"><a href="#cb17-328" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb17-329"><a href="#cb17-329" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 2.2em;</span></span>
<span id="cb17-330"><a href="#cb17-330" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-331"><a href="#cb17-331" aria-hidden="true" tabindex="-1"></a><span class="ss">        h2 </span><span class="ch">{{</span></span>
<span id="cb17-332"><a href="#cb17-332" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb17-333"><a href="#cb17-333" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb17-334"><a href="#cb17-334" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 2em;</span></span>
<span id="cb17-335"><a href="#cb17-335" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-336"><a href="#cb17-336" aria-hidden="true" tabindex="-1"></a><span class="ss">        code </span><span class="ch">{{</span></span>
<span id="cb17-337"><a href="#cb17-337" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f4f4f4;</span></span>
<span id="cb17-338"><a href="#cb17-338" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 3px 8px;</span></span>
<span id="cb17-339"><a href="#cb17-339" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb17-340"><a href="#cb17-340" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb17-341"><a href="#cb17-341" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #c7254e;</span></span>
<span id="cb17-342"><a href="#cb17-342" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb17-343"><a href="#cb17-343" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-344"><a href="#cb17-344" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span></span>
<span id="cb17-345"><a href="#cb17-345" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #2d2d2d;</span></span>
<span id="cb17-346"><a href="#cb17-346" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #f8f8f2;</span></span>
<span id="cb17-347"><a href="#cb17-347" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb17-348"><a href="#cb17-348" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb17-349"><a href="#cb17-349" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb17-350"><a href="#cb17-350" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 5px solid #3498db;</span></span>
<span id="cb17-351"><a href="#cb17-351" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb17-352"><a href="#cb17-352" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.4;</span></span>
<span id="cb17-353"><a href="#cb17-353" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 100% !important;</span></span>
<span id="cb17-354"><a href="#cb17-354" aria-hidden="true" tabindex="-1"></a><span class="ss">            white-space: pre-wrap;</span></span>
<span id="cb17-355"><a href="#cb17-355" aria-hidden="true" tabindex="-1"></a><span class="ss">            word-wrap: break-word;</span></span>
<span id="cb17-356"><a href="#cb17-356" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-357"><a href="#cb17-357" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre code </span><span class="ch">{{</span></span>
<span id="cb17-358"><a href="#cb17-358" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: none;</span></span>
<span id="cb17-359"><a href="#cb17-359" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: inherit;</span></span>
<span id="cb17-360"><a href="#cb17-360" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 0;</span></span>
<span id="cb17-361"><a href="#cb17-361" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-362"><a href="#cb17-362" aria-hidden="true" tabindex="-1"></a><span class="ss">        blockquote </span><span class="ch">{{</span></span>
<span id="cb17-363"><a href="#cb17-363" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb17-364"><a href="#cb17-364" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 25px 0;</span></span>
<span id="cb17-365"><a href="#cb17-365" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 25px;</span></span>
<span id="cb17-366"><a href="#cb17-366" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb17-367"><a href="#cb17-367" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-style: italic;</span></span>
<span id="cb17-368"><a href="#cb17-368" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb17-369"><a href="#cb17-369" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb17-370"><a href="#cb17-370" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 0 8px 8px 0;</span></span>
<span id="cb17-371"><a href="#cb17-371" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 100% !important;</span></span>
<span id="cb17-372"><a href="#cb17-372" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-373"><a href="#cb17-373" aria-hidden="true" tabindex="-1"></a><span class="ss">        table </span><span class="ch">{{</span></span>
<span id="cb17-374"><a href="#cb17-374" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-collapse: collapse;</span></span>
<span id="cb17-375"><a href="#cb17-375" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 100% !important;</span></span>
<span id="cb17-376"><a href="#cb17-376" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb17-377"><a href="#cb17-377" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb17-378"><a href="#cb17-378" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb17-379"><a href="#cb17-379" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb17-380"><a href="#cb17-380" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 100% !important;</span></span>
<span id="cb17-381"><a href="#cb17-381" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-382"><a href="#cb17-382" aria-hidden="true" tabindex="-1"></a><span class="ss">        th, td </span><span class="ch">{{</span></span>
<span id="cb17-383"><a href="#cb17-383" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb17-384"><a href="#cb17-384" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb17-385"><a href="#cb17-385" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: left;</span></span>
<span id="cb17-386"><a href="#cb17-386" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-387"><a href="#cb17-387" aria-hidden="true" tabindex="-1"></a><span class="ss">        th </span><span class="ch">{{</span></span>
<span id="cb17-388"><a href="#cb17-388" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb17-389"><a href="#cb17-389" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb17-390"><a href="#cb17-390" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb17-391"><a href="#cb17-391" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-transform: uppercase;</span></span>
<span id="cb17-392"><a href="#cb17-392" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb17-393"><a href="#cb17-393" aria-hidden="true" tabindex="-1"></a><span class="ss">            letter-spacing: 0.5px;</span></span>
<span id="cb17-394"><a href="#cb17-394" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-395"><a href="#cb17-395" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:nth-child(even) </span><span class="ch">{{</span></span>
<span id="cb17-396"><a href="#cb17-396" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f8f9fa;</span></span>
<span id="cb17-397"><a href="#cb17-397" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-398"><a href="#cb17-398" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:hover </span><span class="ch">{{</span></span>
<span id="cb17-399"><a href="#cb17-399" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #e3f2fd;</span></span>
<span id="cb17-400"><a href="#cb17-400" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: background-color 0.2s ease;</span></span>
<span id="cb17-401"><a href="#cb17-401" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-402"><a href="#cb17-402" aria-hidden="true" tabindex="-1"></a><span class="ss">        .math </span><span class="ch">{{</span></span>
<span id="cb17-403"><a href="#cb17-403" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center;</span></span>
<span id="cb17-404"><a href="#cb17-404" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb17-405"><a href="#cb17-405" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb17-406"><a href="#cb17-406" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb17-407"><a href="#cb17-407" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb17-408"><a href="#cb17-408" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb17-409"><a href="#cb17-409" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 100% !important;</span></span>
<span id="cb17-410"><a href="#cb17-410" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-411"><a href="#cb17-411" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-header </span><span class="ch">{{</span></span>
<span id="cb17-412"><a href="#cb17-412" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb17-413"><a href="#cb17-413" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between;</span></span>
<span id="cb17-414"><a href="#cb17-414" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: center;</span></span>
<span id="cb17-415"><a href="#cb17-415" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 15px;</span></span>
<span id="cb17-416"><a href="#cb17-416" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb17-417"><a href="#cb17-417" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 10px;</span></span>
<span id="cb17-418"><a href="#cb17-418" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 100% !important;</span></span>
<span id="cb17-419"><a href="#cb17-419" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-420"><a href="#cb17-420" aria-hidden="true" tabindex="-1"></a><span class="ss">        .author </span><span class="ch">{{</span></span>
<span id="cb17-421"><a href="#cb17-421" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb17-422"><a href="#cb17-422" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb17-423"><a href="#cb17-423" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.1em;</span></span>
<span id="cb17-424"><a href="#cb17-424" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-425"><a href="#cb17-425" aria-hidden="true" tabindex="-1"></a><span class="ss">        .timestamp </span><span class="ch">{{</span></span>
<span id="cb17-426"><a href="#cb17-426" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb17-427"><a href="#cb17-427" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb17-428"><a href="#cb17-428" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e9ecef;</span></span>
<span id="cb17-429"><a href="#cb17-429" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 8px;</span></span>
<span id="cb17-430"><a href="#cb17-430" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb17-431"><a href="#cb17-431" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-432"><a href="#cb17-432" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-content </span><span class="ch">{{</span></span>
<span id="cb17-433"><a href="#cb17-433" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb17-434"><a href="#cb17-434" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb17-435"><a href="#cb17-435" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb17-436"><a href="#cb17-436" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb17-437"><a href="#cb17-437" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 20px;</span></span>
<span id="cb17-438"><a href="#cb17-438" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 100% !important;</span></span>
<span id="cb17-439"><a href="#cb17-439" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-440"><a href="#cb17-440" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata </span><span class="ch">{{</span></span>
<span id="cb17-441"><a href="#cb17-441" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e8f4fd;</span></span>
<span id="cb17-442"><a href="#cb17-442" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb17-443"><a href="#cb17-443" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb17-444"><a href="#cb17-444" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 25px;</span></span>
<span id="cb17-445"><a href="#cb17-445" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb17-446"><a href="#cb17-446" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 100% !important;</span></span>
<span id="cb17-447"><a href="#cb17-447" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-448"><a href="#cb17-448" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata h3 </span><span class="ch">{{</span></span>
<span id="cb17-449"><a href="#cb17-449" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb17-450"><a href="#cb17-450" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb17-451"><a href="#cb17-451" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-452"><a href="#cb17-452" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* Estilos para TOC manual */</span></span>
<span id="cb17-453"><a href="#cb17-453" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc </span><span class="ch">{{</span></span>
<span id="cb17-454"><a href="#cb17-454" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);</span></span>
<span id="cb17-455"><a href="#cb17-455" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #dee2e6;</span></span>
<span id="cb17-456"><a href="#cb17-456" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb17-457"><a href="#cb17-457" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb17-458"><a href="#cb17-458" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 20px 0;</span></span>
<span id="cb17-459"><a href="#cb17-459" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb17-460"><a href="#cb17-460" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 100% !important;</span></span>
<span id="cb17-461"><a href="#cb17-461" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-462"><a href="#cb17-462" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc h2 </span><span class="ch">{{</span></span>
<span id="cb17-463"><a href="#cb17-463" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb17-464"><a href="#cb17-464" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb17-465"><a href="#cb17-465" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 2px solid #3498db;</span></span>
<span id="cb17-466"><a href="#cb17-466" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 10px;</span></span>
<span id="cb17-467"><a href="#cb17-467" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-468"><a href="#cb17-468" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc ul </span><span class="ch">{{</span></span>
<span id="cb17-469"><a href="#cb17-469" aria-hidden="true" tabindex="-1"></a><span class="ss">            list-style-type: none;</span></span>
<span id="cb17-470"><a href="#cb17-470" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb17-471"><a href="#cb17-471" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-472"><a href="#cb17-472" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc li </span><span class="ch">{{</span></span>
<span id="cb17-473"><a href="#cb17-473" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 8px 0;</span></span>
<span id="cb17-474"><a href="#cb17-474" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-475"><a href="#cb17-475" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc a </span><span class="ch">{{</span></span>
<span id="cb17-476"><a href="#cb17-476" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb17-477"><a href="#cb17-477" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #495057;</span></span>
<span id="cb17-478"><a href="#cb17-478" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb17-479"><a href="#cb17-479" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-480"><a href="#cb17-480" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc a:hover </span><span class="ch">{{</span></span>
<span id="cb17-481"><a href="#cb17-481" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #007bff;</span></span>
<span id="cb17-482"><a href="#cb17-482" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-483"><a href="#cb17-483" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb17-484"><a href="#cb17-484" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* RESPONSIVIDADE OTIMIZADA */</span></span>
<span id="cb17-485"><a href="#cb17-485" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 1200px) </span><span class="ch">{{</span></span>
<span id="cb17-486"><a href="#cb17-486" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb17-487"><a href="#cb17-487" aria-hidden="true" tabindex="-1"></a><span class="ss">                max-width: 98% !important;</span></span>
<span id="cb17-488"><a href="#cb17-488" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 25px;</span></span>
<span id="cb17-489"><a href="#cb17-489" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb17-490"><a href="#cb17-490" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-491"><a href="#cb17-491" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb17-492"><a href="#cb17-492" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 768px) </span><span class="ch">{{</span></span>
<span id="cb17-493"><a href="#cb17-493" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb17-494"><a href="#cb17-494" aria-hidden="true" tabindex="-1"></a><span class="ss">                max-width: 100% !important;</span></span>
<span id="cb17-495"><a href="#cb17-495" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 20px;</span></span>
<span id="cb17-496"><a href="#cb17-496" aria-hidden="true" tabindex="-1"></a><span class="ss">                margin: 5px;</span></span>
<span id="cb17-497"><a href="#cb17-497" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb17-498"><a href="#cb17-498" aria-hidden="true" tabindex="-1"></a><span class="ss">            body </span><span class="ch">{{</span></span>
<span id="cb17-499"><a href="#cb17-499" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 10px;</span></span>
<span id="cb17-500"><a href="#cb17-500" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb17-501"><a href="#cb17-501" aria-hidden="true" tabindex="-1"></a><span class="ss">            h1 </span><span class="ch">{{</span></span>
<span id="cb17-502"><a href="#cb17-502" aria-hidden="true" tabindex="-1"></a><span class="ss">                font-size: 1.8em;</span></span>
<span id="cb17-503"><a href="#cb17-503" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb17-504"><a href="#cb17-504" aria-hidden="true" tabindex="-1"></a><span class="ss">            .message-header </span><span class="ch">{{</span></span>
<span id="cb17-505"><a href="#cb17-505" aria-hidden="true" tabindex="-1"></a><span class="ss">                flex-direction: column;</span></span>
<span id="cb17-506"><a href="#cb17-506" aria-hidden="true" tabindex="-1"></a><span class="ss">                align-items: flex-start;</span></span>
<span id="cb17-507"><a href="#cb17-507" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb17-508"><a href="#cb17-508" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-509"><a href="#cb17-509" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb17-510"><a href="#cb17-510" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* ESTILOS PARA IMPRESS√ÉO */</span></span>
<span id="cb17-511"><a href="#cb17-511" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media print </span><span class="ch">{{</span></span>
<span id="cb17-512"><a href="#cb17-512" aria-hidden="true" tabindex="-1"></a><span class="ss">            body </span><span class="ch">{{</span></span>
<span id="cb17-513"><a href="#cb17-513" aria-hidden="true" tabindex="-1"></a><span class="ss">                background: white !important;</span></span>
<span id="cb17-514"><a href="#cb17-514" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 0 !important;</span></span>
<span id="cb17-515"><a href="#cb17-515" aria-hidden="true" tabindex="-1"></a><span class="ss">                margin: 0 !important;</span></span>
<span id="cb17-516"><a href="#cb17-516" aria-hidden="true" tabindex="-1"></a><span class="ss">                font-size: 12pt;</span></span>
<span id="cb17-517"><a href="#cb17-517" aria-hidden="true" tabindex="-1"></a><span class="ss">                line-height: 1.4;</span></span>
<span id="cb17-518"><a href="#cb17-518" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb17-519"><a href="#cb17-519" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb17-520"><a href="#cb17-520" aria-hidden="true" tabindex="-1"></a><span class="ss">                max-width: 100% !important;</span></span>
<span id="cb17-521"><a href="#cb17-521" aria-hidden="true" tabindex="-1"></a><span class="ss">                box-shadow: none !important;</span></span>
<span id="cb17-522"><a href="#cb17-522" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 15px !important;</span></span>
<span id="cb17-523"><a href="#cb17-523" aria-hidden="true" tabindex="-1"></a><span class="ss">                margin: 0 !important;</span></span>
<span id="cb17-524"><a href="#cb17-524" aria-hidden="true" tabindex="-1"></a><span class="ss">                border-radius: 0 !important;</span></span>
<span id="cb17-525"><a href="#cb17-525" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb17-526"><a href="#cb17-526" aria-hidden="true" tabindex="-1"></a><span class="ss">            #TOC </span><span class="ch">{{</span></span>
<span id="cb17-527"><a href="#cb17-527" aria-hidden="true" tabindex="-1"></a><span class="ss">                page-break-after: always;</span></span>
<span id="cb17-528"><a href="#cb17-528" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb17-529"><a href="#cb17-529" aria-hidden="true" tabindex="-1"></a><span class="ss">            pre, code </span><span class="ch">{{</span></span>
<span id="cb17-530"><a href="#cb17-530" aria-hidden="true" tabindex="-1"></a><span class="ss">                white-space: pre-wrap !important;</span></span>
<span id="cb17-531"><a href="#cb17-531" aria-hidden="true" tabindex="-1"></a><span class="ss">                word-wrap: break-word !important;</span></span>
<span id="cb17-532"><a href="#cb17-532" aria-hidden="true" tabindex="-1"></a><span class="ss">                background: #f8f8f8 !important;</span></span>
<span id="cb17-533"><a href="#cb17-533" aria-hidden="true" tabindex="-1"></a><span class="ss">                border: 1px solid #ddd !important;</span></span>
<span id="cb17-534"><a href="#cb17-534" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb17-535"><a href="#cb17-535" aria-hidden="true" tabindex="-1"></a><span class="ss">            .message-content </span><span class="ch">{{</span></span>
<span id="cb17-536"><a href="#cb17-536" aria-hidden="true" tabindex="-1"></a><span class="ss">                background: #f8f8f8 !important;</span></span>
<span id="cb17-537"><a href="#cb17-537" aria-hidden="true" tabindex="-1"></a><span class="ss">                border-left: 3px solid #3498db !important;</span></span>
<span id="cb17-538"><a href="#cb17-538" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb17-539"><a href="#cb17-539" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb17-540"><a href="#cb17-540" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb17-541"><a href="#cb17-541" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb17-542"><a href="#cb17-542" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb17-543"><a href="#cb17-543" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb17-544"><a href="#cb17-544" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="sc">{</span>content<span class="sc">}</span></span>
<span id="cb17-545"><a href="#cb17-545" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb17-546"><a href="#cb17-546" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb17-547"><a href="#cb17-547" aria-hidden="true" tabindex="-1"></a><span class="ss">        // Configura√ß√£o MathJax para melhor renderiza√ß√£o</span></span>
<span id="cb17-548"><a href="#cb17-548" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb17-549"><a href="#cb17-549" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb17-550"><a href="#cb17-550" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb17-551"><a href="#cb17-551" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb17-552"><a href="#cb17-552" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true,</span></span>
<span id="cb17-553"><a href="#cb17-553" aria-hidden="true" tabindex="-1"></a><span class="ss">                tags: &#39;ams&#39;</span></span>
<span id="cb17-554"><a href="#cb17-554" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb17-555"><a href="#cb17-555" aria-hidden="true" tabindex="-1"></a><span class="ss">            options: </span><span class="ch">{{</span></span>
<span id="cb17-556"><a href="#cb17-556" aria-hidden="true" tabindex="-1"></a><span class="ss">                skipHtmlTags: [&#39;script&#39;, &#39;noscript&#39;, &#39;style&#39;, &#39;textarea&#39;, &#39;pre&#39;],</span></span>
<span id="cb17-557"><a href="#cb17-557" aria-hidden="true" tabindex="-1"></a><span class="ss">                renderActions: </span><span class="ch">{{</span></span>
<span id="cb17-558"><a href="#cb17-558" aria-hidden="true" tabindex="-1"></a><span class="ss">                    addMenu: [0, &#39;&#39;, &#39;&#39;]</span></span>
<span id="cb17-559"><a href="#cb17-559" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb17-560"><a href="#cb17-560" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb17-561"><a href="#cb17-561" aria-hidden="true" tabindex="-1"></a><span class="ss">            startup: </span><span class="ch">{{</span></span>
<span id="cb17-562"><a href="#cb17-562" aria-hidden="true" tabindex="-1"></a><span class="ss">                pageReady() </span><span class="ch">{{</span></span>
<span id="cb17-563"><a href="#cb17-563" aria-hidden="true" tabindex="-1"></a><span class="ss">                    return MathJax.startup.defaultPageReady().then(() =&gt; </span><span class="ch">{{</span></span>
<span id="cb17-564"><a href="#cb17-564" aria-hidden="true" tabindex="-1"></a><span class="ss">                        console.log(&#39;MathJax carregado com sucesso&#39;);</span></span>
<span id="cb17-565"><a href="#cb17-565" aria-hidden="true" tabindex="-1"></a><span class="ss">                    </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb17-566"><a href="#cb17-566" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb17-567"><a href="#cb17-567" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb17-568"><a href="#cb17-568" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb17-569"><a href="#cb17-569" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb17-570"><a href="#cb17-570" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb17-571"><a href="#cb17-571" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb17-572"><a href="#cb17-572" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb17-573"><a href="#cb17-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-574"><a href="#cb17-574" aria-hidden="true" tabindex="-1"></a><span class="co"># ... (o resto do c√≥digo permanece exatamente igual)</span></span></code></pre></div>
<h2 data-number="1.7" id="principais-corre√ß√µes-implementadas"><span class="header-section-number">1.7</span> Principais corre√ß√µes
implementadas:</h2>
<h3 data-number="1.7.1" id="container-principal-otimizado"><span class="header-section-number">1.7.1</span> 1. <strong>Container
Principal Otimizado:</strong></h3>
<ul>
<li><code>max-width: 95% !important</code> (em vez de 900px fixo)</li>
<li>Remove limita√ß√µes desnecess√°rias de largura</li>
<li>Usa quase toda a largura dispon√≠vel</li>
</ul>
<h3 data-number="1.7.2" id="css-com-important-para-sobrescrever"><span class="header-section-number">1.7.2</span> 2. <strong>CSS com
<code>!important</code> para Sobrescrever:</strong></h3>
<ul>
<li>For√ßa a largura m√°xima para evitar conflitos</li>
<li>Garante que o container use o espa√ßo dispon√≠vel</li>
</ul>
<h3 data-number="1.7.3" id="responsividade-melhorada"><span class="header-section-number">1.7.3</span> 3. <strong>Responsividade
Melhorada:</strong></h3>
<ul>
<li>Breakpoints otimizados (1200px, 768px)</li>
<li>Container adapta-se melhor a diferentes tamanhos de ecr√£</li>
</ul>
<h3 data-number="1.7.4" id="elementos-com-largura-total"><span class="header-section-number">1.7.4</span> 4. <strong>Elementos com
Largura Total:</strong></h3>
<ul>
<li>Tabelas, pre, blockquote, math com
<code>max-width: 100% !important</code></li>
<li>Remove limita√ß√µes artificiais de largura</li>
</ul>
<h3 data-number="1.7.5" id="estilos-de-impress√£o"><span class="header-section-number">1.7.5</span> 5. <strong>Estilos de
Impress√£o:</strong></h3>
<ul>
<li>Layout otimizado para impress√£o em A4</li>
<li>Remove sombras e cores de fundo desnecess√°rias</li>
<li>Mant√©m a legibilidade</li>
</ul>
<h3 data-number="1.7.6" id="wrap-de-texto-melhorado"><span class="header-section-number">1.7.6</span> 6. <strong>Wrap de Texto
Melhorado:</strong></h3>
<ul>
<li><code>white-space: pre-wrap</code> e
<code>word-wrap: break-word</code> para c√≥digo</li>
<li>Evita overflow horizontal</li>
</ul>
<h2 data-number="1.8" id="resultado"><span class="header-section-number">1.8</span> Resultado:</h2>
<p>Agora o HTML deve utilizar <strong>quase toda a largura
dispon√≠vel</strong> no navegador, em vez de ficar confinado a uma
pequena coluna central. O conte√∫do ter√° uma</p>
<hr />
<h3 data-number="1.8.1" id="utilizador-2025-11-08-012709-deepseek-reasoner"><span class="header-section-number">1.8.1</span> üë§ Utilizador <em>(2025-11-08
01:27:09)</em> <em>[deepseek-reasoner]</em></h3>
<p>Este sistema agora apresenta o html em meia pagina A4 porqu√™? Estou
apenas a falar da apresenta√ß√£o no browser</p>
<hr />
<h3 data-number="1.8.2" id="deepseek-2025-11-08-012709-deepseek-reasoner"><span class="header-section-number">1.8.2</span> ü§ñ DeepSeek <em>(2025-11-08
01:27:09)</em> <em>[deepseek-reasoner]</em></h3>
<p>O problema descrito sugere que o HTML gerado est√° sendo exibido em
uma largura equivalente a meia p√°gina A4 no navegador. Isso
provavelmente se deve ao CSS que define uma largura m√°xima (max-width)
para o container principal. No c√≥digo, o container tem
<code>max-width: 900px</code> em v√°rios lugares, o que pode ser muito
pequeno para uma tela de desktop, especialmente se o usu√°rio estiver com
o navegador em tela cheia.</p>
<p>Vamos ajustar o CSS para que o container ocupe uma largura mais
adequada. Al√©m disso, podemos tornar o layout mais responsivo, usando
porcentagens ou unidades relativas para que se adapte melhor a
diferentes tamanhos de tela.</p>
<p>No m√©todo <code>_create_enhanced_html_template</code>, o container
est√° com <code>max-width: 900px</code>. Vamos aumentar isso para algo em
torno de 1200px ou usar uma porcentagem para que ocupe a maior parte da
tela. Tamb√©m devemos verificar o mesmo no CSS injetado no m√©todo
<code>_inject_enhanced_css</code> e no m√©todo
<code>_optimize_html_content</code> (que injeta CSS adicional).</p>
<p>Al√©m disso, no m√©todo <code>_create_enhanced_html_template</code>, o
container est√° com uma largura m√°xima fixa. Vamos alterar para:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.container</span> {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">max-width</span><span class="ch">:</span> <span class="dv">95</span><span class="dt">%</span><span class="op">;</span> <span class="co">/* Ou 1200px, dependendo do desejado */</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0</span> <span class="bu">auto</span><span class="op">;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">background</span><span class="ch">:</span> <span class="cn">white</span><span class="op">;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">padding</span><span class="ch">:</span> <span class="dv">40</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">border-radius</span><span class="ch">:</span> <span class="dv">10</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">box-shadow</span><span class="ch">:</span> <span class="dv">0</span> <span class="dv">5</span><span class="dt">px</span> <span class="dv">20</span><span class="dt">px</span> <span class="fu">rgba(</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0.1</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Da mesma forma, no CSS injetado no m√©todo
<code>_inject_enhanced_css</code> (que √© usado quando o Pandoc gera o
HTML) devemos ajustar o container. No entanto, note que o HTML gerado
pelo Pandoc pode n√£o estar usando a classe <code>container</code> que
definimos. O Pandoc gera um HTML com sua pr√≥pria estrutura. Precisamos
garantir que o CSS que injetamos no m√©todo
<code>_inject_enhanced_css</code> tamb√©m ajuste a largura do
conte√∫do.</p>
<p>No m√©todo <code>_inject_enhanced_css</code>, o CSS atual para o
container √©:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.container</span> {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">max-width</span><span class="ch">:</span> <span class="dv">900</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0</span> <span class="bu">auto</span><span class="op">;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">background</span><span class="ch">:</span> <span class="cn">white</span><span class="op">;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">padding</span><span class="ch">:</span> <span class="dv">40</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">border-radius</span><span class="ch">:</span> <span class="dv">10</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">box-shadow</span><span class="ch">:</span> <span class="dv">0</span> <span class="dv">5</span><span class="dt">px</span> <span class="dv">20</span><span class="dt">px</span> <span class="fu">rgba(</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0.1</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Vamos alterar para:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.container</span> {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">max-width</span><span class="ch">:</span> <span class="dv">1200</span><span class="dt">px</span><span class="op">;</span> <span class="co">/* Ou 95% */</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0</span> <span class="bu">auto</span><span class="op">;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">background</span><span class="ch">:</span> <span class="cn">white</span><span class="op">;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">padding</span><span class="ch">:</span> <span class="dv">40</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">border-radius</span><span class="ch">:</span> <span class="dv">10</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">box-shadow</span><span class="ch">:</span> <span class="dv">0</span> <span class="dv">5</span><span class="dt">px</span> <span class="dv">20</span><span class="dt">px</span> <span class="fu">rgba(</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0.1</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Al√©m disso, note que o Pandoc gera um documento HTML completo e o
conte√∫do √© colocado dentro de tags <code>&lt;body&gt;</code>. O CSS que
injetamos no m√©todo <code>_inject_enhanced_css</code> √© aplicado a todo
o documento. Se o Pandoc gerar um container com uma classe espec√≠fica,
podemos precisar ajustar essa classe. Mas, no m√©todo
<code>_inject_enhanced_css</code>, estamos definindo estilos para a
classe <code>container</code> que n√£o √© necessariamente usada pelo
Pandoc. O Pandoc, por padr√£o, n√£o usa uma classe <code>container</code>
para o conte√∫do. Portanto, precisamos garantir que o CSS que injetamos
afete o corpo do documento de maneira adequada.</p>
<p>Na verdade, o m√©todo <code>_inject_enhanced_css</code> injeta CSS que
√© aplicado a todo o documento. Se o Pandoc gera um HTML sem a classe
<code>container</code>, ent√£o o CSS que definimos para
<code>container</code> n√£o ter√° efeito. Precisamos, portanto, ajustar o
CSS para que afete o elemento <code>body</code> ou o elemento
<code>main</code> que o Pandoc gera.</p>
<p>O Pandoc, quando usa <code>--standalone</code>, gera um HTML com uma
estrutura t√≠pica, incluindo <code>&lt;body&gt;</code>. O conte√∫do √©
colocado diretamente no <code>&lt;body&gt;</code>. Portanto, para
ajustar a largura, podemos definir no CSS que o <code>body</code> tenha
um padding e que o conte√∫do dentro do <code>body</code> use uma largura
m√°xima.</p>
<p>Vamos modificar o CSS injetado no m√©todo
<code>_inject_enhanced_css</code> para:</p>
<ol type="1">
<li><p>Remover a classe <code>container</code> e em vez disso estilizar
o <code>body</code> e talvez um container que envolva o conte√∫do? Mas
note que o Pandoc n√£o gera um container com classe. Ent√£o, podemos criar
uma regra para o <code>body</code> e para um elemento que envolva o
conte√∫do? N√£o, o Pandoc n√£o gera esse container.</p></li>
<li><p>Uma alternativa √© injetar um container no HTML gerado pelo
Pandoc? Mas isso √© mais complexo.</p></li>
<li><p>Outra alternativa √© modificar o CSS para que o <code>body</code>
tenha um layout que centralize o conte√∫do e defina uma largura m√°xima.
Podemos fazer:</p></li>
</ol>
<div class="sourceCode" id="cb21"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>body {</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">max-width</span><span class="ch">:</span> <span class="dv">1200</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0</span> <span class="bu">auto</span><span class="op">;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">padding</span><span class="ch">:</span> <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">background-color</span><span class="ch">:</span> <span class="cn">#f5f5f5</span><span class="op">;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">color</span><span class="ch">:</span> <span class="cn">#333</span><span class="op">;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">font-family</span><span class="ch">:</span> <span class="st">&#39;Segoe UI&#39;</span><span class="op">,</span> <span class="dv">Tahoma</span><span class="op">,</span> <span class="dv">Geneva</span><span class="op">,</span> <span class="dv">Verdana</span><span class="op">,</span> <span class="dv">sans-serif</span><span class="op">;</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">line-height</span><span class="ch">:</span> <span class="dv">1.6</span><span class="op">;</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>No entanto, note que no m√©todo <code>_inject_enhanced_css</code> j√°
existem regras para o <code>body</code>. Vamos substituir a regra atual
do <code>body</code> por:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>body {</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">font-family</span><span class="ch">:</span> <span class="st">&#39;Segoe UI&#39;</span><span class="op">,</span> <span class="dv">Tahoma</span><span class="op">,</span> <span class="dv">Geneva</span><span class="op">,</span> <span class="dv">Verdana</span><span class="op">,</span> <span class="dv">sans-serif</span><span class="op">;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">line-height</span><span class="ch">:</span> <span class="dv">1.6</span><span class="op">;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0</span> <span class="bu">auto</span><span class="op">;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">padding</span><span class="ch">:</span> <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">background-color</span><span class="ch">:</span> <span class="cn">#f5f5f5</span><span class="op">;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">color</span><span class="ch">:</span> <span class="cn">#333</span><span class="op">;</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">max-width</span><span class="ch">:</span> <span class="dv">1200</span><span class="dt">px</span><span class="op">;</span> <span class="co">/* Adicionamos max-width ao body */</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Dessa forma, o corpo todo ter√° uma largura m√°xima de 1200px e ser√°
centralizado.</p>
<p>Al√©m disso, no m√©todo <code>_create_enhanced_html_template</code>
(usado no fallback) temos um container com classe <code>container</code>
que est√° com <code>max-width: 900px</code>. Vamos alterar para
1200px.</p>
<p>Vamos fazer as seguintes altera√ß√µes:</p>
<ol type="1">
<li>No m√©todo <code>_inject_enhanced_css</code>:
<ul>
<li>Alterar a regra do <code>body</code> para adicionar
<code>max-width: 1200px;</code> e <code>margin: 0 auto;</code></li>
<li>Remover a regra para <code>.container</code> (pois n√£o est√° sendo
usada pelo Pandoc) ou mant√™-la se houver algum elemento com essa classe?
Na verdade, o Pandoc n√£o gera essa classe, ent√£o podemos remover? Mas
note que no m√©todo <code>_create_enhanced_html_template</code> usamos a
classe <code>container</code>. Portanto, vamos manter a regra para
<code>.container</code> no CSS injetado, mas ajustar sua largura para
1200px.</li>
</ul></li>
<li>No m√©todo <code>_create_enhanced_html_template</code>:
<ul>
<li>Alterar o <code>max-width</code> do container para 1200px.</li>
</ul></li>
<li>No m√©todo <code>_create_basic_html</code> (fallback b√°sico) tamb√©m
ajustar o container para 1200px.</li>
</ol>
<p>Vamos implementar essas altera√ß√µes.</p>
<p>No m√©todo <code>_inject_enhanced_css</code>:</p>
<p>Substitua:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>body {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">font-family</span><span class="ch">:</span> <span class="st">&#39;Segoe UI&#39;</span><span class="op">,</span> <span class="dv">Tahoma</span><span class="op">,</span> <span class="dv">Geneva</span><span class="op">,</span> <span class="dv">Verdana</span><span class="op">,</span> <span class="dv">sans-serif</span><span class="op">;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">line-height</span><span class="ch">:</span> <span class="dv">1.6</span><span class="op">;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">padding</span><span class="ch">:</span> <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">background-color</span><span class="ch">:</span> <span class="cn">#f5f5f5</span><span class="op">;</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">color</span><span class="ch">:</span> <span class="cn">#333</span><span class="op">;</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Por:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>body {</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">font-family</span><span class="ch">:</span> <span class="st">&#39;Segoe UI&#39;</span><span class="op">,</span> <span class="dv">Tahoma</span><span class="op">,</span> <span class="dv">Geneva</span><span class="op">,</span> <span class="dv">Verdana</span><span class="op">,</span> <span class="dv">sans-serif</span><span class="op">;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">line-height</span><span class="ch">:</span> <span class="dv">1.6</span><span class="op">;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0</span> <span class="bu">auto</span><span class="op">;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">padding</span><span class="ch">:</span> <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">background-color</span><span class="ch">:</span> <span class="cn">#f5f5f5</span><span class="op">;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">color</span><span class="ch">:</span> <span class="cn">#333</span><span class="op">;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">max-width</span><span class="ch">:</span> <span class="dv">1200</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>E tamb√©m altere a regra para <code>.container</code> (se existir)
para 1200px. No m√©todo <code>_inject_enhanced_css</code> n√£o h√° uma
regra para <code>.container</code> atualmente. Ent√£o, vamos deixar como
est√°.</p>
<p>No m√©todo <code>_create_enhanced_html_template</code>:</p>
<p>Altere:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.container</span> {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">max-width</span><span class="ch">:</span> <span class="dv">900</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Para:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.container</span> {</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">max-width</span><span class="ch">:</span> <span class="dv">1200</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>No m√©todo <code>_create_basic_html</code>:</p>
<p>Altere:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.container</span> {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">max-width</span><span class="ch">:</span> <span class="dv">800</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Para:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.container</span> {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">max-width</span><span class="ch">:</span> <span class="dv">1200</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Al√©m disso, no m√©todo <code>_optimize_html_content</code> injetamos
CSS adicional? N√£o, o m√©todo <code>_optimize_html_content</code> chama
<code>_inject_enhanced_css</code> que j√° ajustamos.</p>
<p>Vamos fazer essas altera√ß√µes no c√≥digo.</p>
<p>Nota: O m√©todo <code>_inject_enhanced_css</code> √© chamado pelo
m√©todo <code>_optimize_html_content</code> para injetar CSS no HTML
gerado pelo Pandoc. Portanto, essa altera√ß√£o no <code>body</code> no
m√©todo <code>_inject_enhanced_css</code> afetar√° o HTML do Pandoc.</p>
<p>Vamos agora gerar o c√≥digo com essas altera√ß√µes. O problema da
apresenta√ß√£o do HTML em ‚Äúmeia p√°gina A4‚Äù no browser √© causado pelo CSS
que define uma largura m√°xima fixa. Vou ajustar o sistema para usar uma
largura mais adequada para desktop. Aqui est√° a vers√£o corrigida:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># comb_fragments_system4_html_export.py</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> webbrowser</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tempfile</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> traceback</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Any, Optional</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> markdown</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CombinedFragmentsSystem:</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dry_run<span class="op">=</span><span class="va">False</span>, force_overwrite<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_dir <span class="op">=</span> Path(<span class="st">&quot;data&quot;</span>)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dry_run <span class="op">=</span> dry_run</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.force_overwrite <span class="op">=</span> force_overwrite</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configurar logging</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>        logging.basicConfig(level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">&#39;</span>)</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estrutura de pastas organizada</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dirs <span class="op">=</span> {</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;markdown&#39;</span>: <span class="st">&quot;combined_markdown&quot;</span>,</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_csv&quot;</span>, </span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_json&quot;</span>,</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;pdfs&#39;</span>: <span class="st">&quot;combined_pdfs&quot;</span>,</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;html&#39;</span>: <span class="st">&quot;combined_html&quot;</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.single_files <span class="op">=</span> {</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_all_conversations.csv&quot;</span>,</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_all_conversations.json&quot;</span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.index_file <span class="op">=</span> <span class="st">&quot;index.html&quot;</span></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations <span class="op">=</span> []</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configura√ß√£o de processamento por fonte</span></span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.processors <span class="op">=</span> {</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;qwen&#39;</span>: {</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chat-export.json&quot;</span>,</span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_qwen_enhanced,</span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;chatgpt&#39;</span>: {</span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chatgpt.zip&quot;</span>, </span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_chatgpt,</span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;deepseek&#39;</span>: {</span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;deepseek_data.zip&quot;</span>,</span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_deepseek,</span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;grok&#39;</span>: {</span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;grok.zip&quot;</span>,</span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_grok,</span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sanitize_filename(<span class="va">self</span>, text: <span class="bu">str</span>, max_len: <span class="bu">int</span> <span class="op">=</span> <span class="dv">50</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Sanitiza nomes de arquivo REMOVENDO ESPA√áOS e preservando emojis&quot;&quot;&quot;</span></span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove caracteres inv√°lidos</span></span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="dv">\s</span><span class="pp">]</span><span class="vs">&#39;</span>  <span class="co"># Inclui \s para remover espa√ßos</span></span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;_&#39;</span>, text)  <span class="co"># Substitui espa√ßos por underscores</span></span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;_</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39;_&#39;</span>, sanitized)  <span class="co"># Remove underscores duplicados</span></span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> sanitized.strip(<span class="st">&#39;_&#39;</span>)  <span class="co"># Remove underscores no in√≠cio e fim</span></span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Limita o comprimento</span></span>
<span id="cb29-86"><a href="#cb29-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(sanitized) <span class="op">&gt;</span> max_len:</span>
<span id="cb29-87"><a href="#cb29-87" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Tenta cortar em um ponto l√≥gico (underscore)</span></span>
<span id="cb29-88"><a href="#cb29-88" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;_&#39;</span> <span class="kw">in</span> sanitized[:max_len]:</span>
<span id="cb29-89"><a href="#cb29-89" aria-hidden="true" tabindex="-1"></a>                last_underscore <span class="op">=</span> sanitized[:max_len].rfind(<span class="st">&#39;_&#39;</span>)</span>
<span id="cb29-90"><a href="#cb29-90" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> last_underscore <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb29-91"><a href="#cb29-91" aria-hidden="true" tabindex="-1"></a>                    sanitized <span class="op">=</span> sanitized[:last_underscore]</span>
<span id="cb29-92"><a href="#cb29-92" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb29-93"><a href="#cb29-93" aria-hidden="true" tabindex="-1"></a>                sanitized <span class="op">=</span> sanitized[:max_len]</span>
<span id="cb29-94"><a href="#cb29-94" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-95"><a href="#cb29-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb29-96"><a href="#cb29-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-97"><a href="#cb29-97" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_original_title(<span class="va">self</span>, text: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb29-98"><a href="#cb29-98" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Preserva o t√≠tulo original com espa√ßos, apenas removendo caracteres realmente inv√°lidos&quot;&quot;&quot;</span></span>
<span id="cb29-99"><a href="#cb29-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb29-100"><a href="#cb29-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb29-101"><a href="#cb29-101" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-102"><a href="#cb29-102" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove apenas caracteres realmente problem√°ticos, mantendo espa√ßos</span></span>
<span id="cb29-103"><a href="#cb29-103" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="pp">]</span><span class="vs">&#39;</span></span>
<span id="cb29-104"><a href="#cb29-104" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;&#39;</span>, text)</span>
<span id="cb29-105"><a href="#cb29-105" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;</span><span class="dv">\s</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39; &#39;</span>, sanitized.strip())</span>
<span id="cb29-106"><a href="#cb29-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-107"><a href="#cb29-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb29-108"><a href="#cb29-108" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb29-109"><a href="#cb29-109" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-110"><a href="#cb29-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb29-111"><a href="#cb29-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-112"><a href="#cb29-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_special_content(<span class="va">self</span>, content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb29-113"><a href="#cb29-113" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Preserva f√≥rmulas matem√°ticas, c√≥digo e formata√ß√£o especial&quot;&quot;&quot;</span></span>
<span id="cb29-114"><a href="#cb29-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb29-115"><a href="#cb29-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;&quot;</span></span>
<span id="cb29-116"><a href="#cb29-116" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-117"><a href="#cb29-117" aria-hidden="true" tabindex="-1"></a>        preserved_content <span class="op">=</span> content</span>
<span id="cb29-118"><a href="#cb29-118" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-119"><a href="#cb29-119" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Corrige problemas com barras invertidas em LaTeX</span></span>
<span id="cb29-120"><a href="#cb29-120" aria-hidden="true" tabindex="-1"></a>        latex_corrections <span class="op">=</span> {</span>
<span id="cb29-121"><a href="#cb29-121" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ärac&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">frac&#39;</span>,</span>
<span id="cb29-122"><a href="#cb29-122" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Çarepsilon&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">varepsilon&#39;</span>,</span>
<span id="cb29-123"><a href="#cb29-123" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ç&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span>,</span>
<span id="cb29-124"><a href="#cb29-124" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ä&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span></span>
<span id="cb29-125"><a href="#cb29-125" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb29-126"><a href="#cb29-126" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-127"><a href="#cb29-127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> wrong, correct <span class="kw">in</span> latex_corrections.items():</span>
<span id="cb29-128"><a href="#cb29-128" aria-hidden="true" tabindex="-1"></a>            preserved_content <span class="op">=</span> preserved_content.replace(wrong, correct)</span>
<span id="cb29-129"><a href="#cb29-129" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-130"><a href="#cb29-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> preserved_content</span>
<span id="cb29-131"><a href="#cb29-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-132"><a href="#cb29-132" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ensure_directories(<span class="va">self</span>):</span>
<span id="cb29-133"><a href="#cb29-133" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Cria todas as pastas necess√°rias&quot;&quot;&quot;</span></span>
<span id="cb29-134"><a href="#cb29-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb29-135"><a href="#cb29-135" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;DRY-RUN: Pastas seriam criadas:&quot;</span>)</span>
<span id="cb29-136"><a href="#cb29-136" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb29-137"><a href="#cb29-137" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-138"><a href="#cb29-138" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb29-139"><a href="#cb29-139" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-140"><a href="#cb29-140" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb29-141"><a href="#cb29-141" aria-hidden="true" tabindex="-1"></a>            Path(folder).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-142"><a href="#cb29-142" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;Pasta criada: </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-143"><a href="#cb29-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-144"><a href="#cb29-144" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> run(<span class="va">self</span>):</span>
<span id="cb29-145"><a href="#cb29-145" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Executa o processamento completo&quot;&quot;&quot;</span></span>
<span id="cb29-146"><a href="#cb29-146" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;SISTEMA COMBINADO DE EXPORTA√á√ïES COM HTML (Qwen3, ChatGPT, DeepSeek, Grok)&quot;</span>)</span>
<span id="cb29-147"><a href="#cb29-147" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb29-148"><a href="#cb29-148" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-149"><a href="#cb29-149" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.data_dir.exists():</span>
<span id="cb29-150"><a href="#cb29-150" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;Pasta &#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">}</span><span class="ss">&#39; n√£o encontrada.&quot;</span>)</span>
<span id="cb29-151"><a href="#cb29-151" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;Crie a pasta &#39;data&#39; e coloque os arquivos de exporta√ß√£o:&quot;</span>)</span>
<span id="cb29-152"><a href="#cb29-152" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb29-153"><a href="#cb29-153" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   - </span><span class="sc">{</span>config[<span class="st">&#39;file&#39;</span>]<span class="sc">}</span><span class="ss"> (para </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb29-154"><a href="#cb29-154" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb29-155"><a href="#cb29-155" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-156"><a href="#cb29-156" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;Usando pasta de dados: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-157"><a href="#cb29-157" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-158"><a href="#cb29-158" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ensure_directories()</span>
<span id="cb29-159"><a href="#cb29-159" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-160"><a href="#cb29-160" aria-hidden="true" tabindex="-1"></a>        processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-161"><a href="#cb29-161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb29-162"><a href="#cb29-162" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> config[<span class="st">&#39;enabled&#39;</span>]:</span>
<span id="cb29-163"><a href="#cb29-163" aria-hidden="true" tabindex="-1"></a>                file_path <span class="op">=</span> <span class="va">self</span>.data_dir <span class="op">/</span> config[<span class="st">&#39;file&#39;</span>]</span>
<span id="cb29-164"><a href="#cb29-164" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> file_path.exists():</span>
<span id="cb29-165"><a href="#cb29-165" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Processando </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb29-166"><a href="#cb29-166" aria-hidden="true" tabindex="-1"></a>                    config[<span class="st">&#39;method&#39;</span>](file_path)</span>
<span id="cb29-167"><a href="#cb29-167" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb29-168"><a href="#cb29-168" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb29-169"><a href="#cb29-169" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.warning(<span class="ss">f&quot;</span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">: arquivo n√£o encontrado - </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-170"><a href="#cb29-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-171"><a href="#cb29-171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> processed_count <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb29-172"><a href="#cb29-172" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhum arquivo de exporta√ß√£o encontrado na pasta &#39;data&#39;.&quot;</span>)</span>
<span id="cb29-173"><a href="#cb29-173" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb29-174"><a href="#cb29-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-175"><a href="#cb29-175" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb29-176"><a href="#cb29-176" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhuma conversa foi extra√≠da dos arquivos.&quot;</span>)</span>
<span id="cb29-177"><a href="#cb29-177" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb29-178"><a href="#cb29-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-179"><a href="#cb29-179" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._post_process_conversations()</span>
<span id="cb29-180"><a href="#cb29-180" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-181"><a href="#cb29-181" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.dry_run:</span>
<span id="cb29-182"><a href="#cb29-182" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._export_all_formats()</span>
<span id="cb29-183"><a href="#cb29-183" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üéâ SISTEMA COMBINADO FINALIZADO!&quot;</span>)</span>
<span id="cb29-184"><a href="#cb29-184" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ √çndice: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-185"><a href="#cb29-185" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> Path(<span class="va">self</span>.index_file).exists():</span>
<span id="cb29-186"><a href="#cb29-186" aria-hidden="true" tabindex="-1"></a>                webbrowser.<span class="bu">open</span>(<span class="ss">f&#39;file://</span><span class="sc">{</span>Path(<span class="va">self</span>.index_file)<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb29-187"><a href="#cb29-187" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb29-188"><a href="#cb29-188" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üîÆ MODO DRY-RUN: Nenhum arquivo foi criado.&quot;</span>)</span>
<span id="cb29-189"><a href="#cb29-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-190"><a href="#cb29-190" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _post_process_conversations(<span class="va">self</span>):</span>
<span id="cb29-191"><a href="#cb29-191" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processamento p√≥s-extra√ß√£o das conversas&quot;&quot;&quot;</span></span>
<span id="cb29-192"><a href="#cb29-192" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations.sort(</span>
<span id="cb29-193"><a href="#cb29-193" aria-hidden="true" tabindex="-1"></a>            key<span class="op">=</span><span class="kw">lambda</span> x: <span class="va">self</span>.parse_timestamp_for_sorting(</span>
<span id="cb29-194"><a href="#cb29-194" aria-hidden="true" tabindex="-1"></a>                x.get(<span class="st">&#39;updated_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;created_at&#39;</span>)</span>
<span id="cb29-195"><a href="#cb29-195" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb29-196"><a href="#cb29-196" aria-hidden="true" tabindex="-1"></a>            reverse<span class="op">=</span><span class="va">True</span></span>
<span id="cb29-197"><a href="#cb29-197" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-198"><a href="#cb29-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-199"><a href="#cb29-199" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.all_conversations):</span>
<span id="cb29-200"><a href="#cb29-200" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;number&#39;</span>] <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb29-201"><a href="#cb29-201" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;category&#39;</span>] <span class="op">=</span> <span class="va">self</span>.categorize_conversation(conv[<span class="st">&#39;title&#39;</span>], conv.get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;&#39;</span>))</span>
<span id="cb29-202"><a href="#cb29-202" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;source&#39;</span>, <span class="st">&#39;Desconhecido&#39;</span>)</span>
<span id="cb29-203"><a href="#cb29-203" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;messages&#39;</span>, [])</span>
<span id="cb29-204"><a href="#cb29-204" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;summary&#39;</span>, conv[<span class="st">&#39;messages&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> conv[<span class="st">&#39;messages&#39;</span>] <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>)</span>
<span id="cb29-205"><a href="#cb29-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-206"><a href="#cb29-206" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä Total combinado de conversas: </span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-207"><a href="#cb29-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-208"><a href="#cb29-208" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _export_all_formats(<span class="va">self</span>):</span>
<span id="cb29-209"><a href="#cb29-209" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Exporta para todos os formatos&quot;&quot;&quot;</span></span>
<span id="cb29-210"><a href="#cb29-210" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">üîÑ Exportando para formatos...&quot;</span>)</span>
<span id="cb29-211"><a href="#cb29-211" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_markdown_enhanced()</span>
<span id="cb29-212"><a href="#cb29-212" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_html_robust()</span>
<span id="cb29-213"><a href="#cb29-213" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_csv() </span>
<span id="cb29-214"><a href="#cb29-214" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_json()</span>
<span id="cb29-215"><a href="#cb29-215" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_all_to_single_files()</span>
<span id="cb29-216"><a href="#cb29-216" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.create_searchable_index()</span>
<span id="cb29-217"><a href="#cb29-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-218"><a href="#cb29-218" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _get_pandoc_version(<span class="va">self</span>) <span class="op">-&gt;</span> Optional[<span class="bu">tuple</span>]:</span>
<span id="cb29-219"><a href="#cb29-219" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Obt√©m a vers√£o do Pandoc para compatibilidade&quot;&quot;&quot;</span></span>
<span id="cb29-220"><a href="#cb29-220" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb29-221"><a href="#cb29-221" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run([<span class="st">&#39;pandoc&#39;</span>, <span class="st">&#39;--version&#39;</span>], capture_output<span class="op">=</span><span class="va">True</span>, text<span class="op">=</span><span class="va">True</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>)</span>
<span id="cb29-222"><a href="#cb29-222" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb29-223"><a href="#cb29-223" aria-hidden="true" tabindex="-1"></a>                first_line <span class="op">=</span> result.stdout.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb29-224"><a href="#cb29-224" aria-hidden="true" tabindex="-1"></a>                version_str <span class="op">=</span> first_line.split()[<span class="dv">1</span>]</span>
<span id="cb29-225"><a href="#cb29-225" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="bu">tuple</span>(<span class="bu">map</span>(<span class="bu">int</span>, version_str.split(<span class="st">&#39;.&#39;</span>)))</span>
<span id="cb29-226"><a href="#cb29-226" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb29-227"><a href="#cb29-227" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb29-228"><a href="#cb29-228" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb29-229"><a href="#cb29-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-230"><a href="#cb29-230" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_optimized(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb29-231"><a href="#cb29-231" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Convers√£o OTIMIZADA com Pandoc usando todas as op√ß√µes avan√ßadas&quot;&quot;&quot;</span></span>
<span id="cb29-232"><a href="#cb29-232" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb29-233"><a href="#cb29-233" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Convertendo com Pandoc otimizado: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-234"><a href="#cb29-234" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-235"><a href="#cb29-235" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica se o arquivo MathJax local existe</span></span>
<span id="cb29-236"><a href="#cb29-236" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb29-237"><a href="#cb29-237" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb29-238"><a href="#cb29-238" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-239"><a href="#cb29-239" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Comandos base</span></span>
<span id="cb29-240"><a href="#cb29-240" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb29-241"><a href="#cb29-241" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb29-242"><a href="#cb29-242" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb29-243"><a href="#cb29-243" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji+autolink_bare_uris+tex_math_single_backslash&#39;</span>,</span>
<span id="cb29-244"><a href="#cb29-244" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb29-245"><a href="#cb29-245" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb29-246"><a href="#cb29-246" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span>,</span>
<span id="cb29-247"><a href="#cb29-247" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--table-of-contents&#39;</span>,</span>
<span id="cb29-248"><a href="#cb29-248" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--toc-depth=2&#39;</span>, </span>
<span id="cb29-249"><a href="#cb29-249" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--number-sections&#39;</span></span>
<span id="cb29-250"><a href="#cb29-250" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb29-251"><a href="#cb29-251" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-252"><a href="#cb29-252" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica vers√£o do Pandoc para recursos avan√ßados</span></span>
<span id="cb29-253"><a href="#cb29-253" aria-hidden="true" tabindex="-1"></a>            pandoc_version <span class="op">=</span> <span class="va">self</span>._get_pandoc_version()</span>
<span id="cb29-254"><a href="#cb29-254" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-255"><a href="#cb29-255" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Adiciona --embed-resources apenas se suportado (Pandoc 2.19+)</span></span>
<span id="cb29-256"><a href="#cb29-256" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pandoc_version <span class="kw">and</span> pandoc_version <span class="op">&gt;=</span> (<span class="dv">2</span>, <span class="dv">19</span>):</span>
<span id="cb29-257"><a href="#cb29-257" aria-hidden="true" tabindex="-1"></a>                command.append(<span class="st">&#39;--embed-resources&#39;</span>)</span>
<span id="cb29-258"><a href="#cb29-258" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="st">&quot;‚úÖ Usando --embed-resources (Pandoc 2.19+)&quot;</span>)</span>
<span id="cb29-259"><a href="#cb29-259" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb29-260"><a href="#cb29-260" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="st">&quot;‚ÑπÔ∏è  --embed-resources n√£o suportado, usando recursos externos&quot;</span>)</span>
<span id="cb29-261"><a href="#cb29-261" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-262"><a href="#cb29-262" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Adiciona syntax highlighting</span></span>
<span id="cb29-263"><a href="#cb29-263" aria-hidden="true" tabindex="-1"></a>            command.extend([<span class="st">&#39;--syntax-highlighting=pygments&#39;</span>])</span>
<span id="cb29-264"><a href="#cb29-264" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-265"><a href="#cb29-265" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb29-266"><a href="#cb29-266" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb29-267"><a href="#cb29-267" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb29-268"><a href="#cb29-268" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb29-269"><a href="#cb29-269" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb29-270"><a href="#cb29-270" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">180</span></span>
<span id="cb29-271"><a href="#cb29-271" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb29-272"><a href="#cb29-272" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-273"><a href="#cb29-273" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb29-274"><a href="#cb29-274" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> result.stdout</span>
<span id="cb29-275"><a href="#cb29-275" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb29-276"><a href="#cb29-276" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Aplica otimiza√ß√µes adicionais</span></span>
<span id="cb29-277"><a href="#cb29-277" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="va">self</span>._optimize_html_content(html_content)</span>
<span id="cb29-278"><a href="#cb29-278" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> html_content</span>
<span id="cb29-279"><a href="#cb29-279" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb29-280"><a href="#cb29-280" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc otimizado falhou, tentando m√©todo b√°sico: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-281"><a href="#cb29-281" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb29-282"><a href="#cb29-282" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb29-283"><a href="#cb29-283" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> subprocess.TimeoutExpired:</span>
<span id="cb29-284"><a href="#cb29-284" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Timeout no Pandoc otimizado&quot;</span>)</span>
<span id="cb29-285"><a href="#cb29-285" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb29-286"><a href="#cb29-286" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb29-287"><a href="#cb29-287" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc otimizado: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-288"><a href="#cb29-288" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb29-289"><a href="#cb29-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-290"><a href="#cb29-290" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_basic(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb29-291"><a href="#cb29-291" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;M√©todo b√°sico de fallback para Pandoc com TOC e numera√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb29-292"><a href="#cb29-292" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb29-293"><a href="#cb29-293" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Tentando convers√£o b√°sica: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-294"><a href="#cb29-294" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-295"><a href="#cb29-295" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb29-296"><a href="#cb29-296" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb29-297"><a href="#cb29-297" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-298"><a href="#cb29-298" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb29-299"><a href="#cb29-299" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb29-300"><a href="#cb29-300" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb29-301"><a href="#cb29-301" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown&#39;</span>,</span>
<span id="cb29-302"><a href="#cb29-302" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb29-303"><a href="#cb29-303" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb29-304"><a href="#cb29-304" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--table-of-contents&#39;</span>,</span>
<span id="cb29-305"><a href="#cb29-305" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--toc-depth=2&#39;</span>,</span>
<span id="cb29-306"><a href="#cb29-306" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--number-sections&#39;</span>,</span>
<span id="cb29-307"><a href="#cb29-307" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb29-308"><a href="#cb29-308" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb29-309"><a href="#cb29-309" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-310"><a href="#cb29-310" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb29-311"><a href="#cb29-311" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb29-312"><a href="#cb29-312" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb29-313"><a href="#cb29-313" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb29-314"><a href="#cb29-314" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb29-315"><a href="#cb29-315" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">120</span></span>
<span id="cb29-316"><a href="#cb29-316" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb29-317"><a href="#cb29-317" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-318"><a href="#cb29-318" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb29-319"><a href="#cb29-319" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._optimize_html_content(result.stdout)</span>
<span id="cb29-320"><a href="#cb29-320" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb29-321"><a href="#cb29-321" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc b√°sico falhou, usando fallback Python: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-322"><a href="#cb29-322" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb29-323"><a href="#cb29-323" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb29-324"><a href="#cb29-324" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb29-325"><a href="#cb29-325" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc b√°sico: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-326"><a href="#cb29-326" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb29-327"><a href="#cb29-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-328"><a href="#cb29-328" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _optimize_html_content(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb29-329"><a href="#cb29-329" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Aplica otimiza√ß√µes finais ao conte√∫do HTML&quot;&quot;&quot;</span></span>
<span id="cb29-330"><a href="#cb29-330" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona viewport para responsividade</span></span>
<span id="cb29-331"><a href="#cb29-331" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;viewport&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb29-332"><a href="#cb29-332" aria-hidden="true" tabindex="-1"></a>            viewport_meta <span class="op">=</span> <span class="st">&#39;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#39;</span></span>
<span id="cb29-333"><a href="#cb29-333" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="ss">    </span><span class="sc">{</span>viewport_meta<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb29-334"><a href="#cb29-334" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-335"><a href="#cb29-335" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Melhora acessibilidade</span></span>
<span id="cb29-336"><a href="#cb29-336" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;html&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;lang&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb29-337"><a href="#cb29-337" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;html&gt;&#39;</span>, <span class="st">&#39;&lt;html lang=&quot;pt-BR&quot;&gt;&#39;</span>)</span>
<span id="cb29-338"><a href="#cb29-338" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-339"><a href="#cb29-339" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona CSS personalizado para melhorar TOC e numera√ß√£o</span></span>
<span id="cb29-340"><a href="#cb29-340" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="va">self</span>._inject_enhanced_css(html_content)</span>
<span id="cb29-341"><a href="#cb29-341" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-342"><a href="#cb29-342" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Otimiza TOC gerado pelo Pandoc</span></span>
<span id="cb29-343"><a href="#cb29-343" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="va">self</span>._enhance_toc_styling(html_content)</span>
<span id="cb29-344"><a href="#cb29-344" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-345"><a href="#cb29-345" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb29-346"><a href="#cb29-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-347"><a href="#cb29-347" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _inject_enhanced_css(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb29-348"><a href="#cb29-348" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Injeta CSS personalizado aprimorado para TOC e numera√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb29-349"><a href="#cb29-349" aria-hidden="true" tabindex="-1"></a>        enhanced_css <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb29-350"><a href="#cb29-350" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;style&gt;</span></span>
<span id="cb29-351"><a href="#cb29-351" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Layout principal melhorado para desktop */</span></span>
<span id="cb29-352"><a href="#cb29-352" aria-hidden="true" tabindex="-1"></a><span class="st">            body {</span></span>
<span id="cb29-353"><a href="#cb29-353" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb29-354"><a href="#cb29-354" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.6;</span></span>
<span id="cb29-355"><a href="#cb29-355" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0;</span></span>
<span id="cb29-356"><a href="#cb29-356" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb29-357"><a href="#cb29-357" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #f5f5f5;</span></span>
<span id="cb29-358"><a href="#cb29-358" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #333;</span></span>
<span id="cb29-359"><a href="#cb29-359" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: none; /* Remove limita√ß√£o de largura */</span></span>
<span id="cb29-360"><a href="#cb29-360" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-361"><a href="#cb29-361" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-362"><a href="#cb29-362" aria-hidden="true" tabindex="-1"></a><span class="st">            .container {</span></span>
<span id="cb29-363"><a href="#cb29-363" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb29-364"><a href="#cb29-364" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0 auto;</span></span>
<span id="cb29-365"><a href="#cb29-365" aria-hidden="true" tabindex="-1"></a><span class="st">                background: white;</span></span>
<span id="cb29-366"><a href="#cb29-366" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 40px;</span></span>
<span id="cb29-367"><a href="#cb29-367" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 10px;</span></span>
<span id="cb29-368"><a href="#cb29-368" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb29-369"><a href="#cb29-369" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-370"><a href="#cb29-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-371"><a href="#cb29-371" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Estilos para Table of Contents */</span></span>
<span id="cb29-372"><a href="#cb29-372" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC {</span></span>
<span id="cb29-373"><a href="#cb29-373" aria-hidden="true" tabindex="-1"></a><span class="st">                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);</span></span>
<span id="cb29-374"><a href="#cb29-374" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #dee2e6;</span></span>
<span id="cb29-375"><a href="#cb29-375" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb29-376"><a href="#cb29-376" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb29-377"><a href="#cb29-377" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 20px 0;</span></span>
<span id="cb29-378"><a href="#cb29-378" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb29-379"><a href="#cb29-379" aria-hidden="true" tabindex="-1"></a><span class="st">                float: right;</span></span>
<span id="cb29-380"><a href="#cb29-380" aria-hidden="true" tabindex="-1"></a><span class="st">                width: 300px;</span></span>
<span id="cb29-381"><a href="#cb29-381" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-left: 30px;</span></span>
<span id="cb29-382"><a href="#cb29-382" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-bottom: 30px;</span></span>
<span id="cb29-383"><a href="#cb29-383" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-384"><a href="#cb29-384" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-385"><a href="#cb29-385" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul {</span></span>
<span id="cb29-386"><a href="#cb29-386" aria-hidden="true" tabindex="-1"></a><span class="st">                list-style-type: none;</span></span>
<span id="cb29-387"><a href="#cb29-387" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 15px;</span></span>
<span id="cb29-388"><a href="#cb29-388" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 10px 0;</span></span>
<span id="cb29-389"><a href="#cb29-389" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-390"><a href="#cb29-390" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-391"><a href="#cb29-391" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul ul {</span></span>
<span id="cb29-392"><a href="#cb29-392" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 25px;</span></span>
<span id="cb29-393"><a href="#cb29-393" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-394"><a href="#cb29-394" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-395"><a href="#cb29-395" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC li {</span></span>
<span id="cb29-396"><a href="#cb29-396" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 8px 0;</span></span>
<span id="cb29-397"><a href="#cb29-397" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.4;</span></span>
<span id="cb29-398"><a href="#cb29-398" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-399"><a href="#cb29-399" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-400"><a href="#cb29-400" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a {</span></span>
<span id="cb29-401"><a href="#cb29-401" aria-hidden="true" tabindex="-1"></a><span class="st">                text-decoration: none;</span></span>
<span id="cb29-402"><a href="#cb29-402" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #495057;</span></span>
<span id="cb29-403"><a href="#cb29-403" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 500;</span></span>
<span id="cb29-404"><a href="#cb29-404" aria-hidden="true" tabindex="-1"></a><span class="st">                transition: color 0.2s ease;</span></span>
<span id="cb29-405"><a href="#cb29-405" aria-hidden="true" tabindex="-1"></a><span class="st">                display: block;</span></span>
<span id="cb29-406"><a href="#cb29-406" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 4px 8px;</span></span>
<span id="cb29-407"><a href="#cb29-407" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 4px;</span></span>
<span id="cb29-408"><a href="#cb29-408" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-409"><a href="#cb29-409" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-410"><a href="#cb29-410" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a:hover {</span></span>
<span id="cb29-411"><a href="#cb29-411" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #007bff;</span></span>
<span id="cb29-412"><a href="#cb29-412" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: rgba(0, 123, 255, 0.1);</span></span>
<span id="cb29-413"><a href="#cb29-413" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-414"><a href="#cb29-414" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-415"><a href="#cb29-415" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC &gt; ul &gt; li &gt; a {</span></span>
<span id="cb29-416"><a href="#cb29-416" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 600;</span></span>
<span id="cb29-417"><a href="#cb29-417" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50;</span></span>
<span id="cb29-418"><a href="#cb29-418" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 3px solid #3498db;</span></span>
<span id="cb29-419"><a href="#cb29-419" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 12px;</span></span>
<span id="cb29-420"><a href="#cb29-420" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-421"><a href="#cb29-421" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-422"><a href="#cb29-422" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Estilos para numera√ß√£o de se√ß√µes */</span></span>
<span id="cb29-423"><a href="#cb29-423" aria-hidden="true" tabindex="-1"></a><span class="st">            .header-section-number {</span></span>
<span id="cb29-424"><a href="#cb29-424" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #3498db;</span></span>
<span id="cb29-425"><a href="#cb29-425" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: bold;</span></span>
<span id="cb29-426"><a href="#cb29-426" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-right: 8px;</span></span>
<span id="cb29-427"><a href="#cb29-427" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-428"><a href="#cb29-428" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-429"><a href="#cb29-429" aria-hidden="true" tabindex="-1"></a><span class="st">            h1 .header-section-number {</span></span>
<span id="cb29-430"><a href="#cb29-430" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.9em;</span></span>
<span id="cb29-431"><a href="#cb29-431" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-432"><a href="#cb29-432" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-433"><a href="#cb29-433" aria-hidden="true" tabindex="-1"></a><span class="st">            h2 .header-section-number {</span></span>
<span id="cb29-434"><a href="#cb29-434" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.85em;</span></span>
<span id="cb29-435"><a href="#cb29-435" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-436"><a href="#cb29-436" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-437"><a href="#cb29-437" aria-hidden="true" tabindex="-1"></a><span class="st">            h3 .header-section-number {</span></span>
<span id="cb29-438"><a href="#cb29-438" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.8em;</span></span>
<span id="cb29-439"><a href="#cb29-439" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-440"><a href="#cb29-440" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-441"><a href="#cb29-441" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para c√≥digo e matem√°tica */</span></span>
<span id="cb29-442"><a href="#cb29-442" aria-hidden="true" tabindex="-1"></a><span class="st">            .math { display: block; text-align: center; margin: 1.5em 0; }</span></span>
<span id="cb29-443"><a href="#cb29-443" aria-hidden="true" tabindex="-1"></a><span class="st">            .math inline { display: inline-block; }</span></span>
<span id="cb29-444"><a href="#cb29-444" aria-hidden="true" tabindex="-1"></a><span class="st">            pre { </span></span>
<span id="cb29-445"><a href="#cb29-445" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb29-446"><a href="#cb29-446" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #2d2d2d; </span></span>
<span id="cb29-447"><a href="#cb29-447" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #f8f8f2;</span></span>
<span id="cb29-448"><a href="#cb29-448" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb29-449"><a href="#cb29-449" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb29-450"><a href="#cb29-450" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow-x: auto;</span></span>
<span id="cb29-451"><a href="#cb29-451" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb29-452"><a href="#cb29-452" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.4;</span></span>
<span id="cb29-453"><a href="#cb29-453" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-454"><a href="#cb29-454" aria-hidden="true" tabindex="-1"></a><span class="st">            code { </span></span>
<span id="cb29-455"><a href="#cb29-455" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #e9ecef; </span></span>
<span id="cb29-456"><a href="#cb29-456" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 0.2em 0.4em; </span></span>
<span id="cb29-457"><a href="#cb29-457" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 3px;</span></span>
<span id="cb29-458"><a href="#cb29-458" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb29-459"><a href="#cb29-459" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #c7254e;</span></span>
<span id="cb29-460"><a href="#cb29-460" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-461"><a href="#cb29-461" aria-hidden="true" tabindex="-1"></a><span class="st">            pre code { </span></span>
<span id="cb29-462"><a href="#cb29-462" aria-hidden="true" tabindex="-1"></a><span class="st">                background: none; </span></span>
<span id="cb29-463"><a href="#cb29-463" aria-hidden="true" tabindex="-1"></a><span class="st">                color: inherit; </span></span>
<span id="cb29-464"><a href="#cb29-464" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 0; </span></span>
<span id="cb29-465"><a href="#cb29-465" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-466"><a href="#cb29-466" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-467"><a href="#cb29-467" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias responsivas */</span></span>
<span id="cb29-468"><a href="#cb29-468" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 1200px) {</span></span>
<span id="cb29-469"><a href="#cb29-469" aria-hidden="true" tabindex="-1"></a><span class="st">                .container {</span></span>
<span id="cb29-470"><a href="#cb29-470" aria-hidden="true" tabindex="-1"></a><span class="st">                    max-width: 98%;</span></span>
<span id="cb29-471"><a href="#cb29-471" aria-hidden="true" tabindex="-1"></a><span class="st">                    padding: 30px;</span></span>
<span id="cb29-472"><a href="#cb29-472" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb29-473"><a href="#cb29-473" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC {</span></span>
<span id="cb29-474"><a href="#cb29-474" aria-hidden="true" tabindex="-1"></a><span class="st">                    float: none;</span></span>
<span id="cb29-475"><a href="#cb29-475" aria-hidden="true" tabindex="-1"></a><span class="st">                    width: auto;</span></span>
<span id="cb29-476"><a href="#cb29-476" aria-hidden="true" tabindex="-1"></a><span class="st">                    margin: 20px 0;</span></span>
<span id="cb29-477"><a href="#cb29-477" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb29-478"><a href="#cb29-478" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-479"><a href="#cb29-479" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-480"><a href="#cb29-480" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 768px) {</span></span>
<span id="cb29-481"><a href="#cb29-481" aria-hidden="true" tabindex="-1"></a><span class="st">                body { padding: 10px; font-size: 14px; }</span></span>
<span id="cb29-482"><a href="#cb29-482" aria-hidden="true" tabindex="-1"></a><span class="st">                .container { padding: 20px; max-width: 100%; }</span></span>
<span id="cb29-483"><a href="#cb29-483" aria-hidden="true" tabindex="-1"></a><span class="st">                pre { font-size: 12px; padding: 15px; }</span></span>
<span id="cb29-484"><a href="#cb29-484" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC { padding: 15px; }</span></span>
<span id="cb29-485"><a href="#cb29-485" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-486"><a href="#cb29-486" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-487"><a href="#cb29-487" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para tabelas */</span></span>
<span id="cb29-488"><a href="#cb29-488" aria-hidden="true" tabindex="-1"></a><span class="st">            table { </span></span>
<span id="cb29-489"><a href="#cb29-489" aria-hidden="true" tabindex="-1"></a><span class="st">                width: 100%; </span></span>
<span id="cb29-490"><a href="#cb29-490" aria-hidden="true" tabindex="-1"></a><span class="st">                border-collapse: collapse; </span></span>
<span id="cb29-491"><a href="#cb29-491" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 1.5em 0;</span></span>
<span id="cb29-492"><a href="#cb29-492" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb29-493"><a href="#cb29-493" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb29-494"><a href="#cb29-494" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow: hidden;</span></span>
<span id="cb29-495"><a href="#cb29-495" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-496"><a href="#cb29-496" aria-hidden="true" tabindex="-1"></a><span class="st">            th, td { </span></span>
<span id="cb29-497"><a href="#cb29-497" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #dee2e6; </span></span>
<span id="cb29-498"><a href="#cb29-498" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 12px 15px; </span></span>
<span id="cb29-499"><a href="#cb29-499" aria-hidden="true" tabindex="-1"></a><span class="st">                text-align: left; </span></span>
<span id="cb29-500"><a href="#cb29-500" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-501"><a href="#cb29-501" aria-hidden="true" tabindex="-1"></a><span class="st">            th { </span></span>
<span id="cb29-502"><a href="#cb29-502" aria-hidden="true" tabindex="-1"></a><span class="st">                background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb29-503"><a href="#cb29-503" aria-hidden="true" tabindex="-1"></a><span class="st">                color: white; </span></span>
<span id="cb29-504"><a href="#cb29-504" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: bold;</span></span>
<span id="cb29-505"><a href="#cb29-505" aria-hidden="true" tabindex="-1"></a><span class="st">                text-transform: uppercase;</span></span>
<span id="cb29-506"><a href="#cb29-506" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.9em;</span></span>
<span id="cb29-507"><a href="#cb29-507" aria-hidden="true" tabindex="-1"></a><span class="st">                letter-spacing: 0.5px;</span></span>
<span id="cb29-508"><a href="#cb29-508" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-509"><a href="#cb29-509" aria-hidden="true" tabindex="-1"></a><span class="st">            tr:nth-child(even) { </span></span>
<span id="cb29-510"><a href="#cb29-510" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #f8f9fa; </span></span>
<span id="cb29-511"><a href="#cb29-511" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-512"><a href="#cb29-512" aria-hidden="true" tabindex="-1"></a><span class="st">            tr:hover { </span></span>
<span id="cb29-513"><a href="#cb29-513" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #e3f2fd; </span></span>
<span id="cb29-514"><a href="#cb29-514" aria-hidden="true" tabindex="-1"></a><span class="st">                transition: background-color 0.2s ease;</span></span>
<span id="cb29-515"><a href="#cb29-515" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-516"><a href="#cb29-516" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-517"><a href="#cb29-517" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para blocos de cita√ß√£o */</span></span>
<span id="cb29-518"><a href="#cb29-518" aria-hidden="true" tabindex="-1"></a><span class="st">            blockquote { </span></span>
<span id="cb29-519"><a href="#cb29-519" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb29-520"><a href="#cb29-520" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 25px 0; </span></span>
<span id="cb29-521"><a href="#cb29-521" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 25px; </span></span>
<span id="cb29-522"><a href="#cb29-522" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #7f8c8d;</span></span>
<span id="cb29-523"><a href="#cb29-523" aria-hidden="true" tabindex="-1"></a><span class="st">                font-style: italic;</span></span>
<span id="cb29-524"><a href="#cb29-524" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #f8f9fa;</span></span>
<span id="cb29-525"><a href="#cb29-525" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb29-526"><a href="#cb29-526" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 0 8px 8px 0;</span></span>
<span id="cb29-527"><a href="#cb29-527" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-528"><a href="#cb29-528" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-529"><a href="#cb29-529" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Cabe√ßalhos com numera√ß√£o */</span></span>
<span id="cb29-530"><a href="#cb29-530" aria-hidden="true" tabindex="-1"></a><span class="st">            h1, h2, h3, h4, h5 { </span></span>
<span id="cb29-531"><a href="#cb29-531" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50; </span></span>
<span id="cb29-532"><a href="#cb29-532" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-top: 1.8em;</span></span>
<span id="cb29-533"><a href="#cb29-533" aria-hidden="true" tabindex="-1"></a><span class="st">                border-bottom: 1px solid #e9ecef;</span></span>
<span id="cb29-534"><a href="#cb29-534" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-bottom: 0.5em;</span></span>
<span id="cb29-535"><a href="#cb29-535" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-536"><a href="#cb29-536" aria-hidden="true" tabindex="-1"></a><span class="st">            h1 { </span></span>
<span id="cb29-537"><a href="#cb29-537" aria-hidden="true" tabindex="-1"></a><span class="st">                border-bottom: 3px solid #3498db; </span></span>
<span id="cb29-538"><a href="#cb29-538" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-bottom: 15px; </span></span>
<span id="cb29-539"><a href="#cb29-539" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50;</span></span>
<span id="cb29-540"><a href="#cb29-540" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 2.2em;</span></span>
<span id="cb29-541"><a href="#cb29-541" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-542"><a href="#cb29-542" aria-hidden="true" tabindex="-1"></a><span class="st">            h2 {</span></span>
<span id="cb29-543"><a href="#cb29-543" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db;</span></span>
<span id="cb29-544"><a href="#cb29-544" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 15px;</span></span>
<span id="cb29-545"><a href="#cb29-545" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-top: 2em;</span></span>
<span id="cb29-546"><a href="#cb29-546" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-547"><a href="#cb29-547" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb29-548"><a href="#cb29-548" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Clearfix para layout com TOC flutuante */</span></span>
<span id="cb29-549"><a href="#cb29-549" aria-hidden="true" tabindex="-1"></a><span class="st">            .main-content {</span></span>
<span id="cb29-550"><a href="#cb29-550" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow: hidden;</span></span>
<span id="cb29-551"><a href="#cb29-551" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb29-552"><a href="#cb29-552" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/style&gt;</span></span>
<span id="cb29-553"><a href="#cb29-553" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb29-554"><a href="#cb29-554" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-555"><a href="#cb29-555" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;/head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb29-556"><a href="#cb29-556" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;/head&gt;&#39;</span>, <span class="ss">f&#39;</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;&#39;</span>)</span>
<span id="cb29-557"><a href="#cb29-557" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb29-558"><a href="#cb29-558" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb29-559"><a href="#cb29-559" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb29-560"><a href="#cb29-560" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;&lt;body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb29-561"><a href="#cb29-561" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;body&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;&#39;</span>)</span>
<span id="cb29-562"><a href="#cb29-562" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb29-563"><a href="#cb29-563" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;</span><span class="ch">\n</span><span class="sc">{</span>html_content<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/body&gt;&#39;</span></span>
<span id="cb29-564"><a href="#cb29-564" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb29-565"><a href="#cb29-565" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb29-566"><a href="#cb29-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-567"><a href="#cb29-567" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _enhance_toc_styling(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb29-568"><a href="#cb29-568" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Melhora o estilo do Table of Contents gerado pelo Pandoc&quot;&quot;&quot;</span></span>
<span id="cb29-569"><a href="#cb29-569" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona t√≠tulo ao TOC se n√£o existir</span></span>
<span id="cb29-570"><a href="#cb29-570" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;Table of Contents&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb29-571"><a href="#cb29-571" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(</span>
<span id="cb29-572"><a href="#cb29-572" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span>, </span>
<span id="cb29-573"><a href="#cb29-573" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&lt;h2 style=&quot;margin-top: 0; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;&quot;&gt;üìë Table of Contents&lt;/h2&gt;&#39;</span></span>
<span id="cb29-574"><a href="#cb29-574" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb29-575"><a href="#cb29-575" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-576"><a href="#cb29-576" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona wrapper para conte√∫do principal</span></span>
<span id="cb29-577"><a href="#cb29-577" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;&lt;body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb29-578"><a href="#cb29-578" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Encontra o TOC e envolve o conte√∫do restante</span></span>
<span id="cb29-579"><a href="#cb29-579" aria-hidden="true" tabindex="-1"></a>            toc_end <span class="op">=</span> html_content.find(<span class="st">&#39;&lt;/div&gt;&#39;</span>, html_content.find(<span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span>)) <span class="op">+</span> <span class="dv">6</span></span>
<span id="cb29-580"><a href="#cb29-580" aria-hidden="true" tabindex="-1"></a>            body_content <span class="op">=</span> html_content[toc_end:]</span>
<span id="cb29-581"><a href="#cb29-581" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;&lt;div class=&quot;main-content&quot;&gt;&#39;</span> <span class="kw">not</span> <span class="kw">in</span> body_content:</span>
<span id="cb29-582"><a href="#cb29-582" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> html_content[:toc_end] <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&lt;div class=&quot;main-content&quot;&gt;&#39;</span> <span class="op">+</span> body_content <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&lt;/div&gt;&#39;</span></span>
<span id="cb29-583"><a href="#cb29-583" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-584"><a href="#cb29-584" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb29-585"><a href="#cb29-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-586"><a href="#cb29-586" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_fallback(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb29-587"><a href="#cb29-587" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Fallback para convers√£o quando Pandoc falha&quot;&quot;&quot;</span></span>
<span id="cb29-588"><a href="#cb29-588" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb29-589"><a href="#cb29-589" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(md_file_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb29-590"><a href="#cb29-590" aria-hidden="true" tabindex="-1"></a>                md_content <span class="op">=</span> f.read()</span>
<span id="cb29-591"><a href="#cb29-591" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-592"><a href="#cb29-592" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extens√µes avan√ßadas para melhor convers√£o</span></span>
<span id="cb29-593"><a href="#cb29-593" aria-hidden="true" tabindex="-1"></a>            extensions <span class="op">=</span> [</span>
<span id="cb29-594"><a href="#cb29-594" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;extra&#39;</span>, <span class="st">&#39;tables&#39;</span>, <span class="st">&#39;fenced_code&#39;</span>, <span class="st">&#39;codehilite&#39;</span>, </span>
<span id="cb29-595"><a href="#cb29-595" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;toc&#39;</span>, <span class="st">&#39;md_in_html&#39;</span>, <span class="st">&#39;attr_list&#39;</span></span>
<span id="cb29-596"><a href="#cb29-596" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb29-597"><a href="#cb29-597" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-598"><a href="#cb29-598" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> markdown.markdown(</span>
<span id="cb29-599"><a href="#cb29-599" aria-hidden="true" tabindex="-1"></a>                md_content,</span>
<span id="cb29-600"><a href="#cb29-600" aria-hidden="true" tabindex="-1"></a>                extensions<span class="op">=</span>extensions,</span>
<span id="cb29-601"><a href="#cb29-601" aria-hidden="true" tabindex="-1"></a>                output_format<span class="op">=</span><span class="st">&#39;html5&#39;</span></span>
<span id="cb29-602"><a href="#cb29-602" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb29-603"><a href="#cb29-603" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-604"><a href="#cb29-604" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_enhanced_html_template(html_content, Path(md_file_path).name)</span>
<span id="cb29-605"><a href="#cb29-605" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-606"><a href="#cb29-606" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb29-607"><a href="#cb29-607" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Fallback tamb√©m falhou: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-608"><a href="#cb29-608" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_basic_html(md_content, Path(md_file_path).name)</span>
<span id="cb29-609"><a href="#cb29-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-610"><a href="#cb29-610" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_enhanced_html_template(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb29-611"><a href="#cb29-611" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Template HTML aprimorado com suporte a MathJax local/online&quot;&quot;&quot;</span></span>
<span id="cb29-612"><a href="#cb29-612" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb29-613"><a href="#cb29-613" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-614"><a href="#cb29-614" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb29-615"><a href="#cb29-615" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html lang=&quot;pt-BR&quot;&gt;</span></span>
<span id="cb29-616"><a href="#cb29-616" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb29-617"><a href="#cb29-617" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb29-618"><a href="#cb29-618" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb29-619"><a href="#cb29-619" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb29-620"><a href="#cb29-620" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb29-621"><a href="#cb29-621" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span></span>
<span id="cb29-622"><a href="#cb29-622" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb29-623"><a href="#cb29-623" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb29-624"><a href="#cb29-624" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0;</span></span>
<span id="cb29-625"><a href="#cb29-625" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb29-626"><a href="#cb29-626" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb29-627"><a href="#cb29-627" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333;</span></span>
<span id="cb29-628"><a href="#cb29-628" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: none; /* Remove limita√ß√£o de largura */</span></span>
<span id="cb29-629"><a href="#cb29-629" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-630"><a href="#cb29-630" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb29-631"><a href="#cb29-631" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb29-632"><a href="#cb29-632" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb29-633"><a href="#cb29-633" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb29-634"><a href="#cb29-634" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 40px;</span></span>
<span id="cb29-635"><a href="#cb29-635" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 10px;</span></span>
<span id="cb29-636"><a href="#cb29-636" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb29-637"><a href="#cb29-637" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-638"><a href="#cb29-638" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1, h2, h3, h4, h5 </span><span class="ch">{{</span></span>
<span id="cb29-639"><a href="#cb29-639" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb29-640"><a href="#cb29-640" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 1.8em;</span></span>
<span id="cb29-641"><a href="#cb29-641" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-642"><a href="#cb29-642" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1 </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb29-643"><a href="#cb29-643" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 3px solid #3498db; </span></span>
<span id="cb29-644"><a href="#cb29-644" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 15px; </span></span>
<span id="cb29-645"><a href="#cb29-645" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb29-646"><a href="#cb29-646" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 2.2em;</span></span>
<span id="cb29-647"><a href="#cb29-647" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-648"><a href="#cb29-648" aria-hidden="true" tabindex="-1"></a><span class="ss">        h2 </span><span class="ch">{{</span></span>
<span id="cb29-649"><a href="#cb29-649" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb29-650"><a href="#cb29-650" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb29-651"><a href="#cb29-651" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 2em;</span></span>
<span id="cb29-652"><a href="#cb29-652" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-653"><a href="#cb29-653" aria-hidden="true" tabindex="-1"></a><span class="ss">        code </span><span class="ch">{{</span></span>
<span id="cb29-654"><a href="#cb29-654" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f4f4f4;</span></span>
<span id="cb29-655"><a href="#cb29-655" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 3px 8px;</span></span>
<span id="cb29-656"><a href="#cb29-656" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb29-657"><a href="#cb29-657" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb29-658"><a href="#cb29-658" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #c7254e;</span></span>
<span id="cb29-659"><a href="#cb29-659" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb29-660"><a href="#cb29-660" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-661"><a href="#cb29-661" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span></span>
<span id="cb29-662"><a href="#cb29-662" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #2d2d2d;</span></span>
<span id="cb29-663"><a href="#cb29-663" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #f8f8f2;</span></span>
<span id="cb29-664"><a href="#cb29-664" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb29-665"><a href="#cb29-665" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb29-666"><a href="#cb29-666" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb29-667"><a href="#cb29-667" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 5px solid #3498db;</span></span>
<span id="cb29-668"><a href="#cb29-668" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb29-669"><a href="#cb29-669" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.4;</span></span>
<span id="cb29-670"><a href="#cb29-670" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-671"><a href="#cb29-671" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre code </span><span class="ch">{{</span></span>
<span id="cb29-672"><a href="#cb29-672" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: none;</span></span>
<span id="cb29-673"><a href="#cb29-673" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: inherit;</span></span>
<span id="cb29-674"><a href="#cb29-674" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 0;</span></span>
<span id="cb29-675"><a href="#cb29-675" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-676"><a href="#cb29-676" aria-hidden="true" tabindex="-1"></a><span class="ss">        blockquote </span><span class="ch">{{</span></span>
<span id="cb29-677"><a href="#cb29-677" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb29-678"><a href="#cb29-678" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 25px 0;</span></span>
<span id="cb29-679"><a href="#cb29-679" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 25px;</span></span>
<span id="cb29-680"><a href="#cb29-680" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb29-681"><a href="#cb29-681" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-style: italic;</span></span>
<span id="cb29-682"><a href="#cb29-682" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb29-683"><a href="#cb29-683" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb29-684"><a href="#cb29-684" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 0 8px 8px 0;</span></span>
<span id="cb29-685"><a href="#cb29-685" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-686"><a href="#cb29-686" aria-hidden="true" tabindex="-1"></a><span class="ss">        table </span><span class="ch">{{</span></span>
<span id="cb29-687"><a href="#cb29-687" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-collapse: collapse;</span></span>
<span id="cb29-688"><a href="#cb29-688" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 100%;</span></span>
<span id="cb29-689"><a href="#cb29-689" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb29-690"><a href="#cb29-690" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb29-691"><a href="#cb29-691" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb29-692"><a href="#cb29-692" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb29-693"><a href="#cb29-693" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-694"><a href="#cb29-694" aria-hidden="true" tabindex="-1"></a><span class="ss">        th, td </span><span class="ch">{{</span></span>
<span id="cb29-695"><a href="#cb29-695" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb29-696"><a href="#cb29-696" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb29-697"><a href="#cb29-697" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: left;</span></span>
<span id="cb29-698"><a href="#cb29-698" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-699"><a href="#cb29-699" aria-hidden="true" tabindex="-1"></a><span class="ss">        th </span><span class="ch">{{</span></span>
<span id="cb29-700"><a href="#cb29-700" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb29-701"><a href="#cb29-701" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb29-702"><a href="#cb29-702" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb29-703"><a href="#cb29-703" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-transform: uppercase;</span></span>
<span id="cb29-704"><a href="#cb29-704" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb29-705"><a href="#cb29-705" aria-hidden="true" tabindex="-1"></a><span class="ss">            letter-spacing: 0.5px;</span></span>
<span id="cb29-706"><a href="#cb29-706" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-707"><a href="#cb29-707" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:nth-child(even) </span><span class="ch">{{</span></span>
<span id="cb29-708"><a href="#cb29-708" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f8f9fa;</span></span>
<span id="cb29-709"><a href="#cb29-709" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-710"><a href="#cb29-710" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:hover </span><span class="ch">{{</span></span>
<span id="cb29-711"><a href="#cb29-711" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #e3f2fd;</span></span>
<span id="cb29-712"><a href="#cb29-712" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: background-color 0.2s ease;</span></span>
<span id="cb29-713"><a href="#cb29-713" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-714"><a href="#cb29-714" aria-hidden="true" tabindex="-1"></a><span class="ss">        .math </span><span class="ch">{{</span></span>
<span id="cb29-715"><a href="#cb29-715" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center;</span></span>
<span id="cb29-716"><a href="#cb29-716" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb29-717"><a href="#cb29-717" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb29-718"><a href="#cb29-718" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb29-719"><a href="#cb29-719" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb29-720"><a href="#cb29-720" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb29-721"><a href="#cb29-721" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-722"><a href="#cb29-722" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-header </span><span class="ch">{{</span></span>
<span id="cb29-723"><a href="#cb29-723" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb29-724"><a href="#cb29-724" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between;</span></span>
<span id="cb29-725"><a href="#cb29-725" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: center;</span></span>
<span id="cb29-726"><a href="#cb29-726" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 15px;</span></span>
<span id="cb29-727"><a href="#cb29-727" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb29-728"><a href="#cb29-728" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 10px;</span></span>
<span id="cb29-729"><a href="#cb29-729" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-730"><a href="#cb29-730" aria-hidden="true" tabindex="-1"></a><span class="ss">        .author </span><span class="ch">{{</span></span>
<span id="cb29-731"><a href="#cb29-731" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb29-732"><a href="#cb29-732" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb29-733"><a href="#cb29-733" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.1em;</span></span>
<span id="cb29-734"><a href="#cb29-734" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-735"><a href="#cb29-735" aria-hidden="true" tabindex="-1"></a><span class="ss">        .timestamp </span><span class="ch">{{</span></span>
<span id="cb29-736"><a href="#cb29-736" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb29-737"><a href="#cb29-737" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb29-738"><a href="#cb29-738" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e9ecef;</span></span>
<span id="cb29-739"><a href="#cb29-739" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 8px;</span></span>
<span id="cb29-740"><a href="#cb29-740" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb29-741"><a href="#cb29-741" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-742"><a href="#cb29-742" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-content </span><span class="ch">{{</span></span>
<span id="cb29-743"><a href="#cb29-743" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb29-744"><a href="#cb29-744" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb29-745"><a href="#cb29-745" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb29-746"><a href="#cb29-746" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb29-747"><a href="#cb29-747" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 20px;</span></span>
<span id="cb29-748"><a href="#cb29-748" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-749"><a href="#cb29-749" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata </span><span class="ch">{{</span></span>
<span id="cb29-750"><a href="#cb29-750" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e8f4fd;</span></span>
<span id="cb29-751"><a href="#cb29-751" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb29-752"><a href="#cb29-752" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb29-753"><a href="#cb29-753" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 25px;</span></span>
<span id="cb29-754"><a href="#cb29-754" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb29-755"><a href="#cb29-755" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-756"><a href="#cb29-756" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata h3 </span><span class="ch">{{</span></span>
<span id="cb29-757"><a href="#cb29-757" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb29-758"><a href="#cb29-758" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb29-759"><a href="#cb29-759" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-760"><a href="#cb29-760" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* Estilos para TOC manual */</span></span>
<span id="cb29-761"><a href="#cb29-761" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc </span><span class="ch">{{</span></span>
<span id="cb29-762"><a href="#cb29-762" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);</span></span>
<span id="cb29-763"><a href="#cb29-763" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #dee2e6;</span></span>
<span id="cb29-764"><a href="#cb29-764" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb29-765"><a href="#cb29-765" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb29-766"><a href="#cb29-766" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 20px 0;</span></span>
<span id="cb29-767"><a href="#cb29-767" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb29-768"><a href="#cb29-768" aria-hidden="true" tabindex="-1"></a><span class="ss">            float: right;</span></span>
<span id="cb29-769"><a href="#cb29-769" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 300px;</span></span>
<span id="cb29-770"><a href="#cb29-770" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 30px;</span></span>
<span id="cb29-771"><a href="#cb29-771" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-772"><a href="#cb29-772" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc h2 </span><span class="ch">{{</span></span>
<span id="cb29-773"><a href="#cb29-773" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb29-774"><a href="#cb29-774" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb29-775"><a href="#cb29-775" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 2px solid #3498db;</span></span>
<span id="cb29-776"><a href="#cb29-776" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 10px;</span></span>
<span id="cb29-777"><a href="#cb29-777" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-778"><a href="#cb29-778" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc ul </span><span class="ch">{{</span></span>
<span id="cb29-779"><a href="#cb29-779" aria-hidden="true" tabindex="-1"></a><span class="ss">            list-style-type: none;</span></span>
<span id="cb29-780"><a href="#cb29-780" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb29-781"><a href="#cb29-781" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-782"><a href="#cb29-782" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc li </span><span class="ch">{{</span></span>
<span id="cb29-783"><a href="#cb29-783" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 8px 0;</span></span>
<span id="cb29-784"><a href="#cb29-784" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-785"><a href="#cb29-785" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc a </span><span class="ch">{{</span></span>
<span id="cb29-786"><a href="#cb29-786" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb29-787"><a href="#cb29-787" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #495057;</span></span>
<span id="cb29-788"><a href="#cb29-788" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb29-789"><a href="#cb29-789" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-790"><a href="#cb29-790" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc a:hover </span><span class="ch">{{</span></span>
<span id="cb29-791"><a href="#cb29-791" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #007bff;</span></span>
<span id="cb29-792"><a href="#cb29-792" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-793"><a href="#cb29-793" aria-hidden="true" tabindex="-1"></a><span class="ss">        .main-content </span><span class="ch">{{</span></span>
<span id="cb29-794"><a href="#cb29-794" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb29-795"><a href="#cb29-795" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-796"><a href="#cb29-796" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 1200px) </span><span class="ch">{{</span></span>
<span id="cb29-797"><a href="#cb29-797" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb29-798"><a href="#cb29-798" aria-hidden="true" tabindex="-1"></a><span class="ss">                max-width: 98%;</span></span>
<span id="cb29-799"><a href="#cb29-799" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 30px;</span></span>
<span id="cb29-800"><a href="#cb29-800" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb29-801"><a href="#cb29-801" aria-hidden="true" tabindex="-1"></a><span class="ss">            .toc </span><span class="ch">{{</span></span>
<span id="cb29-802"><a href="#cb29-802" aria-hidden="true" tabindex="-1"></a><span class="ss">                float: none;</span></span>
<span id="cb29-803"><a href="#cb29-803" aria-hidden="true" tabindex="-1"></a><span class="ss">                width: auto;</span></span>
<span id="cb29-804"><a href="#cb29-804" aria-hidden="true" tabindex="-1"></a><span class="ss">                margin: 20px 0;</span></span>
<span id="cb29-805"><a href="#cb29-805" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb29-806"><a href="#cb29-806" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-807"><a href="#cb29-807" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 768px) </span><span class="ch">{{</span></span>
<span id="cb29-808"><a href="#cb29-808" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb29-809"><a href="#cb29-809" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 20px;</span></span>
<span id="cb29-810"><a href="#cb29-810" aria-hidden="true" tabindex="-1"></a><span class="ss">                max-width: 100%;</span></span>
<span id="cb29-811"><a href="#cb29-811" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb29-812"><a href="#cb29-812" aria-hidden="true" tabindex="-1"></a><span class="ss">            body </span><span class="ch">{{</span></span>
<span id="cb29-813"><a href="#cb29-813" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 10px;</span></span>
<span id="cb29-814"><a href="#cb29-814" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb29-815"><a href="#cb29-815" aria-hidden="true" tabindex="-1"></a><span class="ss">            h1 </span><span class="ch">{{</span></span>
<span id="cb29-816"><a href="#cb29-816" aria-hidden="true" tabindex="-1"></a><span class="ss">                font-size: 1.8em;</span></span>
<span id="cb29-817"><a href="#cb29-817" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb29-818"><a href="#cb29-818" aria-hidden="true" tabindex="-1"></a><span class="ss">            .message-header </span><span class="ch">{{</span></span>
<span id="cb29-819"><a href="#cb29-819" aria-hidden="true" tabindex="-1"></a><span class="ss">                flex-direction: column;</span></span>
<span id="cb29-820"><a href="#cb29-820" aria-hidden="true" tabindex="-1"></a><span class="ss">                align-items: flex-start;</span></span>
<span id="cb29-821"><a href="#cb29-821" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb29-822"><a href="#cb29-822" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-823"><a href="#cb29-823" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb29-824"><a href="#cb29-824" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb29-825"><a href="#cb29-825" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb29-826"><a href="#cb29-826" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb29-827"><a href="#cb29-827" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="sc">{</span>content<span class="sc">}</span></span>
<span id="cb29-828"><a href="#cb29-828" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb29-829"><a href="#cb29-829" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb29-830"><a href="#cb29-830" aria-hidden="true" tabindex="-1"></a><span class="ss">        // Configura√ß√£o MathJax para melhor renderiza√ß√£o</span></span>
<span id="cb29-831"><a href="#cb29-831" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb29-832"><a href="#cb29-832" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb29-833"><a href="#cb29-833" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb29-834"><a href="#cb29-834" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb29-835"><a href="#cb29-835" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true,</span></span>
<span id="cb29-836"><a href="#cb29-836" aria-hidden="true" tabindex="-1"></a><span class="ss">                tags: &#39;ams&#39;</span></span>
<span id="cb29-837"><a href="#cb29-837" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb29-838"><a href="#cb29-838" aria-hidden="true" tabindex="-1"></a><span class="ss">            options: </span><span class="ch">{{</span></span>
<span id="cb29-839"><a href="#cb29-839" aria-hidden="true" tabindex="-1"></a><span class="ss">                skipHtmlTags: [&#39;script&#39;, &#39;noscript&#39;, &#39;style&#39;, &#39;textarea&#39;, &#39;pre&#39;],</span></span>
<span id="cb29-840"><a href="#cb29-840" aria-hidden="true" tabindex="-1"></a><span class="ss">                renderActions: </span><span class="ch">{{</span></span>
<span id="cb29-841"><a href="#cb29-841" aria-hidden="true" tabindex="-1"></a><span class="ss">                    addMenu: [0, &#39;&#39;, &#39;&#39;]</span></span>
<span id="cb29-842"><a href="#cb29-842" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb29-843"><a href="#cb29-843" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb29-844"><a href="#cb29-844" aria-hidden="true" tabindex="-1"></a><span class="ss">            startup: </span><span class="ch">{{</span></span>
<span id="cb29-845"><a href="#cb29-845" aria-hidden="true" tabindex="-1"></a><span class="ss">                pageReady() </span><span class="ch">{{</span></span>
<span id="cb29-846"><a href="#cb29-846" aria-hidden="true" tabindex="-1"></a><span class="ss">                    return MathJax.startup.defaultPageReady().then(() =&gt; </span><span class="ch">{{</span></span>
<span id="cb29-847"><a href="#cb29-847" aria-hidden="true" tabindex="-1"></a><span class="ss">                        console.log(&#39;MathJax carregado com sucesso&#39;);</span></span>
<span id="cb29-848"><a href="#cb29-848" aria-hidden="true" tabindex="-1"></a><span class="ss">                    </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb29-849"><a href="#cb29-849" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb29-850"><a href="#cb29-850" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb29-851"><a href="#cb29-851" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb29-852"><a href="#cb29-852" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb29-853"><a href="#cb29-853" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb29-854"><a href="#cb29-854" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb29-855"><a href="#cb29-855" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb29-856"><a href="#cb29-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-857"><a href="#cb29-857" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_basic_html(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb29-858"><a href="#cb29-858" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;HTML b√°sico de √∫ltimo recurso com MathJax&quot;&quot;&quot;</span></span>
<span id="cb29-859"><a href="#cb29-859" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb29-860"><a href="#cb29-860" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-861"><a href="#cb29-861" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb29-862"><a href="#cb29-862" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html&gt;</span></span>
<span id="cb29-863"><a href="#cb29-863" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb29-864"><a href="#cb29-864" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb29-865"><a href="#cb29-865" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb29-866"><a href="#cb29-866" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb29-867"><a href="#cb29-867" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb29-868"><a href="#cb29-868" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif; </span></span>
<span id="cb29-869"><a href="#cb29-869" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px; </span></span>
<span id="cb29-870"><a href="#cb29-870" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb29-871"><a href="#cb29-871" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb29-872"><a href="#cb29-872" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: none; /* Remove limita√ß√£o de largura */</span></span>
<span id="cb29-873"><a href="#cb29-873" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-874"><a href="#cb29-874" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb29-875"><a href="#cb29-875" aria-hidden="true" tabindex="-1"></a><span class="ss">            white-space: pre-wrap; </span></span>
<span id="cb29-876"><a href="#cb29-876" aria-hidden="true" tabindex="-1"></a><span class="ss">            word-wrap: break-word; </span></span>
<span id="cb29-877"><a href="#cb29-877" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb29-878"><a href="#cb29-878" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb29-879"><a href="#cb29-879" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 5px;</span></span>
<span id="cb29-880"><a href="#cb29-880" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb29-881"><a href="#cb29-881" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-882"><a href="#cb29-882" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb29-883"><a href="#cb29-883" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb29-884"><a href="#cb29-884" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb29-885"><a href="#cb29-885" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb29-886"><a href="#cb29-886" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 30px;</span></span>
<span id="cb29-887"><a href="#cb29-887" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb29-888"><a href="#cb29-888" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb29-889"><a href="#cb29-889" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb29-890"><a href="#cb29-890" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb29-891"><a href="#cb29-891" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb29-892"><a href="#cb29-892" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb29-893"><a href="#cb29-893" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb29-894"><a href="#cb29-894" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb29-895"><a href="#cb29-895" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb29-896"><a href="#cb29-896" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true</span></span>
<span id="cb29-897"><a href="#cb29-897" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb29-898"><a href="#cb29-898" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb29-899"><a href="#cb29-899" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb29-900"><a href="#cb29-900" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb29-901"><a href="#cb29-901" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb29-902"><a href="#cb29-902" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb29-903"><a href="#cb29-903" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb29-904"><a href="#cb29-904" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;pre&gt;</span><span class="sc">{</span>content<span class="sc">}</span><span class="ss">&lt;/pre&gt;</span></span>
<span id="cb29-905"><a href="#cb29-905" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb29-906"><a href="#cb29-906" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb29-907"><a href="#cb29-907" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb29-908"><a href="#cb29-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-909"><a href="#cb29-909" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ... (restante dos m√©todos permanecem inalterados)</span></span>
<span id="cb29-910"><a href="#cb29-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-911"><a href="#cb29-911" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_html_robust(<span class="va">self</span>):</span>
<span id="cb29-912"><a href="#cb29-912" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;M√©todo ROBUSTO para convers√£o HTML - VERS√ÉO OTIMIZADA&quot;&quot;&quot;</span></span>
<span id="cb29-913"><a href="#cb29-913" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb29-914"><a href="#cb29-914" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] HTMLs seriam criados:&quot;</span>)</span>
<span id="cb29-915"><a href="#cb29-915" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb29-916"><a href="#cb29-916" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb29-917"><a href="#cb29-917" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.html&quot;</span></span>
<span id="cb29-918"><a href="#cb29-918" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üåê </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-919"><a href="#cb29-919" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb29-920"><a href="#cb29-920" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-921"><a href="#cb29-921" aria-hidden="true" tabindex="-1"></a>        markdown_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;markdown&#39;</span>])</span>
<span id="cb29-922"><a href="#cb29-922" aria-hidden="true" tabindex="-1"></a>        html_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;html&#39;</span>])</span>
<span id="cb29-923"><a href="#cb29-923" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-924"><a href="#cb29-924" aria-hidden="true" tabindex="-1"></a>        md_files <span class="op">=</span> <span class="bu">list</span>(markdown_folder.glob(<span class="st">&quot;*.md&quot;</span>))</span>
<span id="cb29-925"><a href="#cb29-925" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-926"><a href="#cb29-926" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> md_files:</span>
<span id="cb29-927"><a href="#cb29-927" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Nenhum arquivo Markdown encontrado para convers√£o.&quot;</span>)</span>
<span id="cb29-928"><a href="#cb29-928" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb29-929"><a href="#cb29-929" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-930"><a href="#cb29-930" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÑ Convertendo </span><span class="sc">{</span><span class="bu">len</span>(md_files)<span class="sc">}</span><span class="ss"> arquivos Markdown para HTML (OTIMIZADO)...&quot;</span>)</span>
<span id="cb29-931"><a href="#cb29-931" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-932"><a href="#cb29-932" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verifica se Pandoc est√° dispon√≠vel</span></span>
<span id="cb29-933"><a href="#cb29-933" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb29-934"><a href="#cb29-934" aria-hidden="true" tabindex="-1"></a>            subprocess.run([<span class="st">&#39;pandoc&#39;</span>, <span class="st">&#39;--version&#39;</span>], capture_output<span class="op">=</span><span class="va">True</span>, check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-935"><a href="#cb29-935" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">True</span></span>
<span id="cb29-936"><a href="#cb29-936" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;‚úÖ Pandoc dispon√≠vel - usando convers√£o otimizada&quot;</span>)</span>
<span id="cb29-937"><a href="#cb29-937" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb29-938"><a href="#cb29-938" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">False</span></span>
<span id="cb29-939"><a href="#cb29-939" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è Pandoc n√£o dispon√≠vel - usando fallback Python&quot;</span>)</span>
<span id="cb29-940"><a href="#cb29-940" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-941"><a href="#cb29-941" aria-hidden="true" tabindex="-1"></a>        converted_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-942"><a href="#cb29-942" aria-hidden="true" tabindex="-1"></a>        failed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-943"><a href="#cb29-943" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-944"><a href="#cb29-944" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> md_file <span class="kw">in</span> md_files:</span>
<span id="cb29-945"><a href="#cb29-945" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb29-946"><a href="#cb29-946" aria-hidden="true" tabindex="-1"></a>                html_file <span class="op">=</span> html_folder <span class="op">/</span> md_file.with_suffix(<span class="st">&#39;.html&#39;</span>).name</span>
<span id="cb29-947"><a href="#cb29-947" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb29-948"><a href="#cb29-948" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> html_file.exists():</span>
<span id="cb29-949"><a href="#cb29-949" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚è≠Ô∏è  J√° existe: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-950"><a href="#cb29-950" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb29-951"><a href="#cb29-951" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb29-952"><a href="#cb29-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-953"><a href="#cb29-953" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ Processando: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-954"><a href="#cb29-954" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb29-955"><a href="#cb29-955" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> pandoc_available:</span>
<span id="cb29-956"><a href="#cb29-956" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_pandoc_optimized(<span class="bu">str</span>(md_file))</span>
<span id="cb29-957"><a href="#cb29-957" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb29-958"><a href="#cb29-958" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_fallback(<span class="bu">str</span>(md_file))</span>
<span id="cb29-959"><a href="#cb29-959" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb29-960"><a href="#cb29-960" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> html_content:</span>
<span id="cb29-961"><a href="#cb29-961" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(html_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb29-962"><a href="#cb29-962" aria-hidden="true" tabindex="-1"></a>                        f.write(html_content)</span>
<span id="cb29-963"><a href="#cb29-963" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb29-964"><a href="#cb29-964" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Criado: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-965"><a href="#cb29-965" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb29-966"><a href="#cb29-966" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb29-967"><a href="#cb29-967" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Falha na convers√£o: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-968"><a href="#cb29-968" aria-hidden="true" tabindex="-1"></a>                    failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb29-969"><a href="#cb29-969" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb29-970"><a href="#cb29-970" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb29-971"><a href="#cb29-971" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro em </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb29-972"><a href="#cb29-972" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(traceback.format_exc())</span>
<span id="cb29-973"><a href="#cb29-973" aria-hidden="true" tabindex="-1"></a>                failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb29-974"><a href="#cb29-974" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb29-975"><a href="#cb29-975" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä HTML: </span><span class="sc">{</span>converted_count<span class="sc">}</span><span class="ss"> arquivos criados, </span><span class="sc">{</span>failed_count<span class="sc">}</span><span class="ss"> falhas em &#39;</span><span class="sc">{</span>html_folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb29-976"><a href="#cb29-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-977"><a href="#cb29-977" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ... (restante dos m√©todos permanecem inalterados)</span></span>
<span id="cb29-978"><a href="#cb29-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-979"><a href="#cb29-979" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb29-980"><a href="#cb29-980" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser(</span>
<span id="cb29-981"><a href="#cb29-981" aria-hidden="true" tabindex="-1"></a>        description<span class="op">=</span><span class="st">&quot;Processa exporta√ß√µes combinadas com exporta√ß√£o HTML via Pandoc.&quot;</span></span>
<span id="cb29-982"><a href="#cb29-982" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-983"><a href="#cb29-983" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">&quot;--dry-run&quot;</span>, action<span class="op">=</span><span class="st">&quot;store_true&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Executa sem salvar arquivos&quot;</span>)</span>
<span id="cb29-984"><a href="#cb29-984" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">&quot;--force-overwrite&quot;</span>, action<span class="op">=</span><span class="st">&quot;store_true&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Substitui arquivos existentes&quot;</span>)</span>
<span id="cb29-985"><a href="#cb29-985" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-986"><a href="#cb29-986" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb29-987"><a href="#cb29-987" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-988"><a href="#cb29-988" aria-hidden="true" tabindex="-1"></a>    system <span class="op">=</span> CombinedFragmentsSystem(</span>
<span id="cb29-989"><a href="#cb29-989" aria-hidden="true" tabindex="-1"></a>        dry_run<span class="op">=</span>args.dry_run,</span>
<span id="cb29-990"><a href="#cb29-990" aria-hidden="true" tabindex="-1"></a>        force_overwrite<span class="op">=</span>args.force_overwrite</span>
<span id="cb29-991"><a href="#cb29-991" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-992"><a href="#cb29-992" aria-hidden="true" tabindex="-1"></a>    system.run()</span>
<span id="cb29-993"><a href="#cb29-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-994"><a href="#cb29-994" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb29-995"><a href="#cb29-995" aria-hidden="true" tabindex="-1"></a>    main()</span></code></pre></div>
<h2 data-number="1.9" id="principais-corre√ß√µes-para-o-layout"><span class="header-section-number">1.9</span> Principais corre√ß√µes para o
layout:</h2>
<h3 data-number="1.9.1" id="remo√ß√£o-de-limita√ß√µes-de-largura"><span class="header-section-number">1.9.1</span> 1. <strong>Remo√ß√£o de
limita√ß√µes de largura:</strong></h3>
<ul>
<li><code>max-width: none</code> no elemento <code>body</code></li>
<li><code>max-width: 95%</code> no container principal (em vez de 900px
fixos)</li>
<li>Layout adaptativo que usa quase toda a largura dispon√≠vel</li>
</ul>
<h3 data-number="1.9.2" id="toc-flutuante"><span class="header-section-number">1.9.2</span> 2. <strong>TOC
flutuante:</strong></h3>
<ul>
<li>TOC posicionado √† direita com <code>float: right</code></li>
<li>Largura fixa de 300px para o TOC</li>
<li>Conte√∫do principal flui ao redor do TOC</li>
</ul>
<h3 data-number="1.9.3" id="design-responsivo-melhorado"><span class="header-section-number">1.9.3</span> 3. <strong>Design responsivo
melhorado:</strong></h3>
<ul>
<li>Breakpoints ajustados para 1200px e 768px</li>
<li>TOC torna-se n√£o-flutuante em telas menores</li>
<li>Container expande para 98% em telas m√©dias</li>
</ul>
<h3 data-number="1.9.4" id="clearfix-para-layout"><span class="header-section-number">1.9.4</span> 4. <strong>Clearfix para
layout:</strong></h3>
<ul>
<li>Classe <code>.main-content</code> com
<code>overflow: hidden</code></li>
<li>Previne problemas de float e garante layout consistente</li>
</ul>
<h3 data-number="1.9.5" id="melhor-utiliza√ß√£o-do-espa√ßo"><span class="header-section-number">1.9.5</span> 5. <strong>Melhor utiliza√ß√£o
do espa√ßo:</strong></h3>
<ul>
<li>Padding otimizado para desktop</li>
<li>Margens ajustadas para melhor aproveitamento do espa√ßo</li>
<li>Container centralizado mas com m√°xima largura poss√≠vel</li>
</ul>
<p>Agora o HTML deve ocupar praticamente toda a largura dispon√≠vel no
browser, proporcionando uma experi√™ncia de leitura muito melhor em
desktop, enquanto mant√©m a responsividade para dispositivos m√≥veis.</p>
<hr />
<h3 data-number="1.9.6" id="utilizador-2025-11-08-013659-deepseek-reasoner"><span class="header-section-number">1.9.6</span> üë§ Utilizador <em>(2025-11-08
01:36:59)</em> <em>[deepseek-reasoner]</em></h3>
<p>pretendo comb_fragments_system4_html_export.py completo</p>
<hr />
<h3 data-number="1.9.7" id="deepseek-2025-11-08-013659-deepseek-reasoner"><span class="header-section-number">1.9.7</span> ü§ñ DeepSeek <em>(2025-11-08
01:36:59)</em> <em>[deepseek-reasoner]</em></h3>
<p>Vamos ajustar o CSS para que o conte√∫do ocupe a largura total da
tela, removendo a limita√ß√£o de largura m√°xima que estava causando a
apar√™ncia de ‚Äúmeia p√°gina A4‚Äù. As altera√ß√µes principais ser√£o: 1.
Remover a largura m√°xima (max-width) do container principal. 2. Ajustar
o padding e margens para melhor aproveitamento do espa√ßo. 3. Manter o
TOC flutuante √† direita, mas ajustar sua largura e posicionamento. 4.
Garantir que o conte√∫do principal ocupe a maior parte da tela.</p>
<p>No entanto, note que o c√≥digo atual j√° define no m√©todo
<code>_inject_enhanced_css</code> um container com
<code>max-width: 95%</code>. Vamos alterar para
<code>max-width: none</code> e ajustar o container para usar uma largura
mais flex√≠vel.</p>
<p>Vou fornecer o arquivo completo com as corre√ß√µes necess√°rias para o
layout ocupar a tela inteira. Aqui est√° o arquivo
<code>comb_fragments_system4_html_export.py</code> completo com todas as
corre√ß√µes de layout:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># comb_fragments_system4_html_export.py</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> webbrowser</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tempfile</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> traceback</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Any, Optional</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> markdown</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CombinedFragmentsSystem:</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dry_run<span class="op">=</span><span class="va">False</span>, force_overwrite<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_dir <span class="op">=</span> Path(<span class="st">&quot;data&quot;</span>)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dry_run <span class="op">=</span> dry_run</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.force_overwrite <span class="op">=</span> force_overwrite</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configurar logging</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>        logging.basicConfig(level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">&#39;</span>)</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estrutura de pastas organizada</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dirs <span class="op">=</span> {</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;markdown&#39;</span>: <span class="st">&quot;combined_markdown&quot;</span>,</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_csv&quot;</span>, </span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_json&quot;</span>,</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;pdfs&#39;</span>: <span class="st">&quot;combined_pdfs&quot;</span>,</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;html&#39;</span>: <span class="st">&quot;combined_html&quot;</span></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.single_files <span class="op">=</span> {</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_all_conversations.csv&quot;</span>,</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_all_conversations.json&quot;</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.index_file <span class="op">=</span> <span class="st">&quot;index.html&quot;</span></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations <span class="op">=</span> []</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configura√ß√£o de processamento por fonte</span></span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.processors <span class="op">=</span> {</span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;qwen&#39;</span>: {</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chat-export.json&quot;</span>,</span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_qwen_enhanced,</span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;chatgpt&#39;</span>: {</span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chatgpt.zip&quot;</span>, </span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_chatgpt,</span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;deepseek&#39;</span>: {</span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;deepseek_data.zip&quot;</span>,</span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_deepseek,</span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;grok&#39;</span>: {</span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;grok.zip&quot;</span>,</span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_grok,</span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sanitize_filename(<span class="va">self</span>, text: <span class="bu">str</span>, max_len: <span class="bu">int</span> <span class="op">=</span> <span class="dv">50</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Sanitiza nomes de arquivo REMOVENDO ESPA√áOS e preservando emojis&quot;&quot;&quot;</span></span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb30-74"><a href="#cb30-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb30-75"><a href="#cb30-75" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-76"><a href="#cb30-76" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove caracteres inv√°lidos</span></span>
<span id="cb30-77"><a href="#cb30-77" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="dv">\s</span><span class="pp">]</span><span class="vs">&#39;</span>  <span class="co"># Inclui \s para remover espa√ßos</span></span>
<span id="cb30-78"><a href="#cb30-78" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;_&#39;</span>, text)  <span class="co"># Substitui espa√ßos por underscores</span></span>
<span id="cb30-79"><a href="#cb30-79" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;_</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39;_&#39;</span>, sanitized)  <span class="co"># Remove underscores duplicados</span></span>
<span id="cb30-80"><a href="#cb30-80" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> sanitized.strip(<span class="st">&#39;_&#39;</span>)  <span class="co"># Remove underscores no in√≠cio e fim</span></span>
<span id="cb30-81"><a href="#cb30-81" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-82"><a href="#cb30-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb30-83"><a href="#cb30-83" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb30-84"><a href="#cb30-84" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-85"><a href="#cb30-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Limita o comprimento</span></span>
<span id="cb30-86"><a href="#cb30-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(sanitized) <span class="op">&gt;</span> max_len:</span>
<span id="cb30-87"><a href="#cb30-87" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Tenta cortar em um ponto l√≥gico (underscore)</span></span>
<span id="cb30-88"><a href="#cb30-88" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;_&#39;</span> <span class="kw">in</span> sanitized[:max_len]:</span>
<span id="cb30-89"><a href="#cb30-89" aria-hidden="true" tabindex="-1"></a>                last_underscore <span class="op">=</span> sanitized[:max_len].rfind(<span class="st">&#39;_&#39;</span>)</span>
<span id="cb30-90"><a href="#cb30-90" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> last_underscore <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb30-91"><a href="#cb30-91" aria-hidden="true" tabindex="-1"></a>                    sanitized <span class="op">=</span> sanitized[:last_underscore]</span>
<span id="cb30-92"><a href="#cb30-92" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb30-93"><a href="#cb30-93" aria-hidden="true" tabindex="-1"></a>                sanitized <span class="op">=</span> sanitized[:max_len]</span>
<span id="cb30-94"><a href="#cb30-94" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-95"><a href="#cb30-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb30-96"><a href="#cb30-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-97"><a href="#cb30-97" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_original_title(<span class="va">self</span>, text: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb30-98"><a href="#cb30-98" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Preserva o t√≠tulo original com espa√ßos, apenas removendo caracteres realmente inv√°lidos&quot;&quot;&quot;</span></span>
<span id="cb30-99"><a href="#cb30-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb30-100"><a href="#cb30-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb30-101"><a href="#cb30-101" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-102"><a href="#cb30-102" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove apenas caracteres realmente problem√°ticos, mantendo espa√ßos</span></span>
<span id="cb30-103"><a href="#cb30-103" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="pp">]</span><span class="vs">&#39;</span></span>
<span id="cb30-104"><a href="#cb30-104" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;&#39;</span>, text)</span>
<span id="cb30-105"><a href="#cb30-105" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;</span><span class="dv">\s</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39; &#39;</span>, sanitized.strip())</span>
<span id="cb30-106"><a href="#cb30-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-107"><a href="#cb30-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb30-108"><a href="#cb30-108" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb30-109"><a href="#cb30-109" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-110"><a href="#cb30-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb30-111"><a href="#cb30-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-112"><a href="#cb30-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_special_content(<span class="va">self</span>, content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb30-113"><a href="#cb30-113" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Preserva f√≥rmulas matem√°ticas, c√≥digo e formata√ß√£o especial&quot;&quot;&quot;</span></span>
<span id="cb30-114"><a href="#cb30-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb30-115"><a href="#cb30-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;&quot;</span></span>
<span id="cb30-116"><a href="#cb30-116" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-117"><a href="#cb30-117" aria-hidden="true" tabindex="-1"></a>        preserved_content <span class="op">=</span> content</span>
<span id="cb30-118"><a href="#cb30-118" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-119"><a href="#cb30-119" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Corrige problemas com barras invertidas em LaTeX</span></span>
<span id="cb30-120"><a href="#cb30-120" aria-hidden="true" tabindex="-1"></a>        latex_corrections <span class="op">=</span> {</span>
<span id="cb30-121"><a href="#cb30-121" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ärac&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">frac&#39;</span>,</span>
<span id="cb30-122"><a href="#cb30-122" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Çarepsilon&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">varepsilon&#39;</span>,</span>
<span id="cb30-123"><a href="#cb30-123" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ç&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span>,</span>
<span id="cb30-124"><a href="#cb30-124" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ä&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span></span>
<span id="cb30-125"><a href="#cb30-125" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb30-126"><a href="#cb30-126" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-127"><a href="#cb30-127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> wrong, correct <span class="kw">in</span> latex_corrections.items():</span>
<span id="cb30-128"><a href="#cb30-128" aria-hidden="true" tabindex="-1"></a>            preserved_content <span class="op">=</span> preserved_content.replace(wrong, correct)</span>
<span id="cb30-129"><a href="#cb30-129" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-130"><a href="#cb30-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> preserved_content</span>
<span id="cb30-131"><a href="#cb30-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-132"><a href="#cb30-132" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ensure_directories(<span class="va">self</span>):</span>
<span id="cb30-133"><a href="#cb30-133" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Cria todas as pastas necess√°rias&quot;&quot;&quot;</span></span>
<span id="cb30-134"><a href="#cb30-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb30-135"><a href="#cb30-135" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;DRY-RUN: Pastas seriam criadas:&quot;</span>)</span>
<span id="cb30-136"><a href="#cb30-136" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb30-137"><a href="#cb30-137" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-138"><a href="#cb30-138" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb30-139"><a href="#cb30-139" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-140"><a href="#cb30-140" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb30-141"><a href="#cb30-141" aria-hidden="true" tabindex="-1"></a>            Path(folder).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-142"><a href="#cb30-142" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;Pasta criada: </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-143"><a href="#cb30-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-144"><a href="#cb30-144" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> run(<span class="va">self</span>):</span>
<span id="cb30-145"><a href="#cb30-145" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Executa o processamento completo&quot;&quot;&quot;</span></span>
<span id="cb30-146"><a href="#cb30-146" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;SISTEMA COMBINADO DE EXPORTA√á√ïES COM HTML (Qwen3, ChatGPT, DeepSeek, Grok)&quot;</span>)</span>
<span id="cb30-147"><a href="#cb30-147" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb30-148"><a href="#cb30-148" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-149"><a href="#cb30-149" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.data_dir.exists():</span>
<span id="cb30-150"><a href="#cb30-150" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;Pasta &#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">}</span><span class="ss">&#39; n√£o encontrada.&quot;</span>)</span>
<span id="cb30-151"><a href="#cb30-151" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;Crie a pasta &#39;data&#39; e coloque os arquivos de exporta√ß√£o:&quot;</span>)</span>
<span id="cb30-152"><a href="#cb30-152" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb30-153"><a href="#cb30-153" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   - </span><span class="sc">{</span>config[<span class="st">&#39;file&#39;</span>]<span class="sc">}</span><span class="ss"> (para </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb30-154"><a href="#cb30-154" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb30-155"><a href="#cb30-155" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-156"><a href="#cb30-156" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;Usando pasta de dados: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-157"><a href="#cb30-157" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-158"><a href="#cb30-158" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ensure_directories()</span>
<span id="cb30-159"><a href="#cb30-159" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-160"><a href="#cb30-160" aria-hidden="true" tabindex="-1"></a>        processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-161"><a href="#cb30-161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb30-162"><a href="#cb30-162" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> config[<span class="st">&#39;enabled&#39;</span>]:</span>
<span id="cb30-163"><a href="#cb30-163" aria-hidden="true" tabindex="-1"></a>                file_path <span class="op">=</span> <span class="va">self</span>.data_dir <span class="op">/</span> config[<span class="st">&#39;file&#39;</span>]</span>
<span id="cb30-164"><a href="#cb30-164" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> file_path.exists():</span>
<span id="cb30-165"><a href="#cb30-165" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Processando </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb30-166"><a href="#cb30-166" aria-hidden="true" tabindex="-1"></a>                    config[<span class="st">&#39;method&#39;</span>](file_path)</span>
<span id="cb30-167"><a href="#cb30-167" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb30-168"><a href="#cb30-168" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb30-169"><a href="#cb30-169" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.warning(<span class="ss">f&quot;</span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">: arquivo n√£o encontrado - </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-170"><a href="#cb30-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-171"><a href="#cb30-171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> processed_count <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb30-172"><a href="#cb30-172" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhum arquivo de exporta√ß√£o encontrado na pasta &#39;data&#39;.&quot;</span>)</span>
<span id="cb30-173"><a href="#cb30-173" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb30-174"><a href="#cb30-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-175"><a href="#cb30-175" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb30-176"><a href="#cb30-176" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhuma conversa foi extra√≠da dos arquivos.&quot;</span>)</span>
<span id="cb30-177"><a href="#cb30-177" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb30-178"><a href="#cb30-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-179"><a href="#cb30-179" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._post_process_conversations()</span>
<span id="cb30-180"><a href="#cb30-180" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-181"><a href="#cb30-181" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.dry_run:</span>
<span id="cb30-182"><a href="#cb30-182" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._export_all_formats()</span>
<span id="cb30-183"><a href="#cb30-183" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üéâ SISTEMA COMBINADO FINALIZADO!&quot;</span>)</span>
<span id="cb30-184"><a href="#cb30-184" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ √çndice: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-185"><a href="#cb30-185" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> Path(<span class="va">self</span>.index_file).exists():</span>
<span id="cb30-186"><a href="#cb30-186" aria-hidden="true" tabindex="-1"></a>                webbrowser.<span class="bu">open</span>(<span class="ss">f&#39;file://</span><span class="sc">{</span>Path(<span class="va">self</span>.index_file)<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb30-187"><a href="#cb30-187" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb30-188"><a href="#cb30-188" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üîÆ MODO DRY-RUN: Nenhum arquivo foi criado.&quot;</span>)</span>
<span id="cb30-189"><a href="#cb30-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-190"><a href="#cb30-190" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _post_process_conversations(<span class="va">self</span>):</span>
<span id="cb30-191"><a href="#cb30-191" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processamento p√≥s-extra√ß√£o das conversas&quot;&quot;&quot;</span></span>
<span id="cb30-192"><a href="#cb30-192" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations.sort(</span>
<span id="cb30-193"><a href="#cb30-193" aria-hidden="true" tabindex="-1"></a>            key<span class="op">=</span><span class="kw">lambda</span> x: <span class="va">self</span>.parse_timestamp_for_sorting(</span>
<span id="cb30-194"><a href="#cb30-194" aria-hidden="true" tabindex="-1"></a>                x.get(<span class="st">&#39;updated_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;created_at&#39;</span>)</span>
<span id="cb30-195"><a href="#cb30-195" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb30-196"><a href="#cb30-196" aria-hidden="true" tabindex="-1"></a>            reverse<span class="op">=</span><span class="va">True</span></span>
<span id="cb30-197"><a href="#cb30-197" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb30-198"><a href="#cb30-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-199"><a href="#cb30-199" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.all_conversations):</span>
<span id="cb30-200"><a href="#cb30-200" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;number&#39;</span>] <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb30-201"><a href="#cb30-201" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;category&#39;</span>] <span class="op">=</span> <span class="va">self</span>.categorize_conversation(conv[<span class="st">&#39;title&#39;</span>], conv.get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;&#39;</span>))</span>
<span id="cb30-202"><a href="#cb30-202" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;source&#39;</span>, <span class="st">&#39;Desconhecido&#39;</span>)</span>
<span id="cb30-203"><a href="#cb30-203" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;messages&#39;</span>, [])</span>
<span id="cb30-204"><a href="#cb30-204" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;summary&#39;</span>, conv[<span class="st">&#39;messages&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> conv[<span class="st">&#39;messages&#39;</span>] <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>)</span>
<span id="cb30-205"><a href="#cb30-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-206"><a href="#cb30-206" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä Total combinado de conversas: </span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-207"><a href="#cb30-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-208"><a href="#cb30-208" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _export_all_formats(<span class="va">self</span>):</span>
<span id="cb30-209"><a href="#cb30-209" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Exporta para todos os formatos&quot;&quot;&quot;</span></span>
<span id="cb30-210"><a href="#cb30-210" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">üîÑ Exportando para formatos...&quot;</span>)</span>
<span id="cb30-211"><a href="#cb30-211" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_markdown_enhanced()</span>
<span id="cb30-212"><a href="#cb30-212" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_html_robust()</span>
<span id="cb30-213"><a href="#cb30-213" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_csv() </span>
<span id="cb30-214"><a href="#cb30-214" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_json()</span>
<span id="cb30-215"><a href="#cb30-215" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_all_to_single_files()</span>
<span id="cb30-216"><a href="#cb30-216" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.create_searchable_index()</span>
<span id="cb30-217"><a href="#cb30-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-218"><a href="#cb30-218" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _get_pandoc_version(<span class="va">self</span>) <span class="op">-&gt;</span> Optional[<span class="bu">tuple</span>]:</span>
<span id="cb30-219"><a href="#cb30-219" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Obt√©m a vers√£o do Pandoc para compatibilidade&quot;&quot;&quot;</span></span>
<span id="cb30-220"><a href="#cb30-220" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb30-221"><a href="#cb30-221" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run([<span class="st">&#39;pandoc&#39;</span>, <span class="st">&#39;--version&#39;</span>], capture_output<span class="op">=</span><span class="va">True</span>, text<span class="op">=</span><span class="va">True</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>)</span>
<span id="cb30-222"><a href="#cb30-222" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb30-223"><a href="#cb30-223" aria-hidden="true" tabindex="-1"></a>                first_line <span class="op">=</span> result.stdout.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb30-224"><a href="#cb30-224" aria-hidden="true" tabindex="-1"></a>                version_str <span class="op">=</span> first_line.split()[<span class="dv">1</span>]</span>
<span id="cb30-225"><a href="#cb30-225" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="bu">tuple</span>(<span class="bu">map</span>(<span class="bu">int</span>, version_str.split(<span class="st">&#39;.&#39;</span>)))</span>
<span id="cb30-226"><a href="#cb30-226" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb30-227"><a href="#cb30-227" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb30-228"><a href="#cb30-228" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb30-229"><a href="#cb30-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-230"><a href="#cb30-230" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_optimized(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb30-231"><a href="#cb30-231" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Convers√£o OTIMIZADA com Pandoc usando todas as op√ß√µes avan√ßadas&quot;&quot;&quot;</span></span>
<span id="cb30-232"><a href="#cb30-232" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb30-233"><a href="#cb30-233" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Convertendo com Pandoc otimizado: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-234"><a href="#cb30-234" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-235"><a href="#cb30-235" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica se o arquivo MathJax local existe</span></span>
<span id="cb30-236"><a href="#cb30-236" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb30-237"><a href="#cb30-237" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb30-238"><a href="#cb30-238" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-239"><a href="#cb30-239" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Comandos base</span></span>
<span id="cb30-240"><a href="#cb30-240" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb30-241"><a href="#cb30-241" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb30-242"><a href="#cb30-242" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb30-243"><a href="#cb30-243" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji+autolink_bare_uris+tex_math_single_backslash&#39;</span>,</span>
<span id="cb30-244"><a href="#cb30-244" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb30-245"><a href="#cb30-245" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb30-246"><a href="#cb30-246" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span>,</span>
<span id="cb30-247"><a href="#cb30-247" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--table-of-contents&#39;</span>,</span>
<span id="cb30-248"><a href="#cb30-248" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--toc-depth=2&#39;</span>, </span>
<span id="cb30-249"><a href="#cb30-249" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--number-sections&#39;</span></span>
<span id="cb30-250"><a href="#cb30-250" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb30-251"><a href="#cb30-251" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-252"><a href="#cb30-252" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica vers√£o do Pandoc para recursos avan√ßados</span></span>
<span id="cb30-253"><a href="#cb30-253" aria-hidden="true" tabindex="-1"></a>            pandoc_version <span class="op">=</span> <span class="va">self</span>._get_pandoc_version()</span>
<span id="cb30-254"><a href="#cb30-254" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-255"><a href="#cb30-255" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Adiciona --embed-resources apenas se suportado (Pandoc 2.19+)</span></span>
<span id="cb30-256"><a href="#cb30-256" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pandoc_version <span class="kw">and</span> pandoc_version <span class="op">&gt;=</span> (<span class="dv">2</span>, <span class="dv">19</span>):</span>
<span id="cb30-257"><a href="#cb30-257" aria-hidden="true" tabindex="-1"></a>                command.append(<span class="st">&#39;--embed-resources&#39;</span>)</span>
<span id="cb30-258"><a href="#cb30-258" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="st">&quot;‚úÖ Usando --embed-resources (Pandoc 2.19+)&quot;</span>)</span>
<span id="cb30-259"><a href="#cb30-259" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb30-260"><a href="#cb30-260" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="st">&quot;‚ÑπÔ∏è  --embed-resources n√£o suportado, usando recursos externos&quot;</span>)</span>
<span id="cb30-261"><a href="#cb30-261" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-262"><a href="#cb30-262" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Adiciona syntax highlighting</span></span>
<span id="cb30-263"><a href="#cb30-263" aria-hidden="true" tabindex="-1"></a>            command.extend([<span class="st">&#39;--syntax-highlighting=pygments&#39;</span>])</span>
<span id="cb30-264"><a href="#cb30-264" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-265"><a href="#cb30-265" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb30-266"><a href="#cb30-266" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb30-267"><a href="#cb30-267" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb30-268"><a href="#cb30-268" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb30-269"><a href="#cb30-269" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb30-270"><a href="#cb30-270" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">180</span></span>
<span id="cb30-271"><a href="#cb30-271" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb30-272"><a href="#cb30-272" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-273"><a href="#cb30-273" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb30-274"><a href="#cb30-274" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> result.stdout</span>
<span id="cb30-275"><a href="#cb30-275" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-276"><a href="#cb30-276" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Aplica otimiza√ß√µes adicionais</span></span>
<span id="cb30-277"><a href="#cb30-277" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="va">self</span>._optimize_html_content(html_content)</span>
<span id="cb30-278"><a href="#cb30-278" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> html_content</span>
<span id="cb30-279"><a href="#cb30-279" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb30-280"><a href="#cb30-280" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc otimizado falhou, tentando m√©todo b√°sico: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-281"><a href="#cb30-281" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb30-282"><a href="#cb30-282" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-283"><a href="#cb30-283" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> subprocess.TimeoutExpired:</span>
<span id="cb30-284"><a href="#cb30-284" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Timeout no Pandoc otimizado&quot;</span>)</span>
<span id="cb30-285"><a href="#cb30-285" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb30-286"><a href="#cb30-286" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb30-287"><a href="#cb30-287" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc otimizado: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-288"><a href="#cb30-288" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb30-289"><a href="#cb30-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-290"><a href="#cb30-290" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_basic(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb30-291"><a href="#cb30-291" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;M√©todo b√°sico de fallback para Pandoc com TOC e numera√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb30-292"><a href="#cb30-292" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb30-293"><a href="#cb30-293" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Tentando convers√£o b√°sica: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-294"><a href="#cb30-294" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-295"><a href="#cb30-295" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb30-296"><a href="#cb30-296" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb30-297"><a href="#cb30-297" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-298"><a href="#cb30-298" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb30-299"><a href="#cb30-299" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb30-300"><a href="#cb30-300" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb30-301"><a href="#cb30-301" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown&#39;</span>,</span>
<span id="cb30-302"><a href="#cb30-302" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb30-303"><a href="#cb30-303" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb30-304"><a href="#cb30-304" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--table-of-contents&#39;</span>,</span>
<span id="cb30-305"><a href="#cb30-305" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--toc-depth=2&#39;</span>,</span>
<span id="cb30-306"><a href="#cb30-306" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--number-sections&#39;</span>,</span>
<span id="cb30-307"><a href="#cb30-307" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb30-308"><a href="#cb30-308" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb30-309"><a href="#cb30-309" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-310"><a href="#cb30-310" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb30-311"><a href="#cb30-311" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb30-312"><a href="#cb30-312" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb30-313"><a href="#cb30-313" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb30-314"><a href="#cb30-314" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb30-315"><a href="#cb30-315" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">120</span></span>
<span id="cb30-316"><a href="#cb30-316" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb30-317"><a href="#cb30-317" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-318"><a href="#cb30-318" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb30-319"><a href="#cb30-319" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._optimize_html_content(result.stdout)</span>
<span id="cb30-320"><a href="#cb30-320" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb30-321"><a href="#cb30-321" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc b√°sico falhou, usando fallback Python: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-322"><a href="#cb30-322" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb30-323"><a href="#cb30-323" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-324"><a href="#cb30-324" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb30-325"><a href="#cb30-325" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc b√°sico: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-326"><a href="#cb30-326" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb30-327"><a href="#cb30-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-328"><a href="#cb30-328" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _optimize_html_content(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb30-329"><a href="#cb30-329" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Aplica otimiza√ß√µes finais ao conte√∫do HTML&quot;&quot;&quot;</span></span>
<span id="cb30-330"><a href="#cb30-330" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona viewport para responsividade</span></span>
<span id="cb30-331"><a href="#cb30-331" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;viewport&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb30-332"><a href="#cb30-332" aria-hidden="true" tabindex="-1"></a>            viewport_meta <span class="op">=</span> <span class="st">&#39;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#39;</span></span>
<span id="cb30-333"><a href="#cb30-333" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="ss">    </span><span class="sc">{</span>viewport_meta<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb30-334"><a href="#cb30-334" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-335"><a href="#cb30-335" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Melhora acessibilidade</span></span>
<span id="cb30-336"><a href="#cb30-336" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;html&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;lang&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb30-337"><a href="#cb30-337" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;html&gt;&#39;</span>, <span class="st">&#39;&lt;html lang=&quot;pt-BR&quot;&gt;&#39;</span>)</span>
<span id="cb30-338"><a href="#cb30-338" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-339"><a href="#cb30-339" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona CSS personalizado para melhorar TOC e numera√ß√£o</span></span>
<span id="cb30-340"><a href="#cb30-340" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="va">self</span>._inject_enhanced_css(html_content)</span>
<span id="cb30-341"><a href="#cb30-341" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-342"><a href="#cb30-342" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Otimiza TOC gerado pelo Pandoc</span></span>
<span id="cb30-343"><a href="#cb30-343" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="va">self</span>._enhance_toc_styling(html_content)</span>
<span id="cb30-344"><a href="#cb30-344" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-345"><a href="#cb30-345" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb30-346"><a href="#cb30-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-347"><a href="#cb30-347" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _inject_enhanced_css(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb30-348"><a href="#cb30-348" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Injeta CSS personalizado aprimorado para TOC e numera√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb30-349"><a href="#cb30-349" aria-hidden="true" tabindex="-1"></a>        enhanced_css <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb30-350"><a href="#cb30-350" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;style&gt;</span></span>
<span id="cb30-351"><a href="#cb30-351" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Layout principal melhorado para desktop */</span></span>
<span id="cb30-352"><a href="#cb30-352" aria-hidden="true" tabindex="-1"></a><span class="st">            body {</span></span>
<span id="cb30-353"><a href="#cb30-353" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb30-354"><a href="#cb30-354" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.6;</span></span>
<span id="cb30-355"><a href="#cb30-355" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0;</span></span>
<span id="cb30-356"><a href="#cb30-356" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb30-357"><a href="#cb30-357" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #f5f5f5;</span></span>
<span id="cb30-358"><a href="#cb30-358" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #333;</span></span>
<span id="cb30-359"><a href="#cb30-359" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: none; /* Remove limita√ß√£o de largura */</span></span>
<span id="cb30-360"><a href="#cb30-360" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-361"><a href="#cb30-361" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-362"><a href="#cb30-362" aria-hidden="true" tabindex="-1"></a><span class="st">            .container {</span></span>
<span id="cb30-363"><a href="#cb30-363" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb30-364"><a href="#cb30-364" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0 auto;</span></span>
<span id="cb30-365"><a href="#cb30-365" aria-hidden="true" tabindex="-1"></a><span class="st">                background: white;</span></span>
<span id="cb30-366"><a href="#cb30-366" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 40px;</span></span>
<span id="cb30-367"><a href="#cb30-367" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 10px;</span></span>
<span id="cb30-368"><a href="#cb30-368" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb30-369"><a href="#cb30-369" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-370"><a href="#cb30-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-371"><a href="#cb30-371" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Estilos para Table of Contents */</span></span>
<span id="cb30-372"><a href="#cb30-372" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC {</span></span>
<span id="cb30-373"><a href="#cb30-373" aria-hidden="true" tabindex="-1"></a><span class="st">                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);</span></span>
<span id="cb30-374"><a href="#cb30-374" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #dee2e6;</span></span>
<span id="cb30-375"><a href="#cb30-375" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb30-376"><a href="#cb30-376" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb30-377"><a href="#cb30-377" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 20px 0;</span></span>
<span id="cb30-378"><a href="#cb30-378" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb30-379"><a href="#cb30-379" aria-hidden="true" tabindex="-1"></a><span class="st">                float: right;</span></span>
<span id="cb30-380"><a href="#cb30-380" aria-hidden="true" tabindex="-1"></a><span class="st">                width: 300px;</span></span>
<span id="cb30-381"><a href="#cb30-381" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-left: 30px;</span></span>
<span id="cb30-382"><a href="#cb30-382" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-bottom: 30px;</span></span>
<span id="cb30-383"><a href="#cb30-383" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-384"><a href="#cb30-384" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-385"><a href="#cb30-385" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul {</span></span>
<span id="cb30-386"><a href="#cb30-386" aria-hidden="true" tabindex="-1"></a><span class="st">                list-style-type: none;</span></span>
<span id="cb30-387"><a href="#cb30-387" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 15px;</span></span>
<span id="cb30-388"><a href="#cb30-388" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 10px 0;</span></span>
<span id="cb30-389"><a href="#cb30-389" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-390"><a href="#cb30-390" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-391"><a href="#cb30-391" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul ul {</span></span>
<span id="cb30-392"><a href="#cb30-392" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 25px;</span></span>
<span id="cb30-393"><a href="#cb30-393" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-394"><a href="#cb30-394" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-395"><a href="#cb30-395" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC li {</span></span>
<span id="cb30-396"><a href="#cb30-396" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 8px 0;</span></span>
<span id="cb30-397"><a href="#cb30-397" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.4;</span></span>
<span id="cb30-398"><a href="#cb30-398" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-399"><a href="#cb30-399" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-400"><a href="#cb30-400" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a {</span></span>
<span id="cb30-401"><a href="#cb30-401" aria-hidden="true" tabindex="-1"></a><span class="st">                text-decoration: none;</span></span>
<span id="cb30-402"><a href="#cb30-402" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #495057;</span></span>
<span id="cb30-403"><a href="#cb30-403" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 500;</span></span>
<span id="cb30-404"><a href="#cb30-404" aria-hidden="true" tabindex="-1"></a><span class="st">                transition: color 0.2s ease;</span></span>
<span id="cb30-405"><a href="#cb30-405" aria-hidden="true" tabindex="-1"></a><span class="st">                display: block;</span></span>
<span id="cb30-406"><a href="#cb30-406" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 4px 8px;</span></span>
<span id="cb30-407"><a href="#cb30-407" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 4px;</span></span>
<span id="cb30-408"><a href="#cb30-408" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-409"><a href="#cb30-409" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-410"><a href="#cb30-410" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a:hover {</span></span>
<span id="cb30-411"><a href="#cb30-411" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #007bff;</span></span>
<span id="cb30-412"><a href="#cb30-412" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: rgba(0, 123, 255, 0.1);</span></span>
<span id="cb30-413"><a href="#cb30-413" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-414"><a href="#cb30-414" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-415"><a href="#cb30-415" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC &gt; ul &gt; li &gt; a {</span></span>
<span id="cb30-416"><a href="#cb30-416" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 600;</span></span>
<span id="cb30-417"><a href="#cb30-417" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50;</span></span>
<span id="cb30-418"><a href="#cb30-418" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 3px solid #3498db;</span></span>
<span id="cb30-419"><a href="#cb30-419" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 12px;</span></span>
<span id="cb30-420"><a href="#cb30-420" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-421"><a href="#cb30-421" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-422"><a href="#cb30-422" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Estilos para numera√ß√£o de se√ß√µes */</span></span>
<span id="cb30-423"><a href="#cb30-423" aria-hidden="true" tabindex="-1"></a><span class="st">            .header-section-number {</span></span>
<span id="cb30-424"><a href="#cb30-424" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #3498db;</span></span>
<span id="cb30-425"><a href="#cb30-425" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: bold;</span></span>
<span id="cb30-426"><a href="#cb30-426" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-right: 8px;</span></span>
<span id="cb30-427"><a href="#cb30-427" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-428"><a href="#cb30-428" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-429"><a href="#cb30-429" aria-hidden="true" tabindex="-1"></a><span class="st">            h1 .header-section-number {</span></span>
<span id="cb30-430"><a href="#cb30-430" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.9em;</span></span>
<span id="cb30-431"><a href="#cb30-431" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-432"><a href="#cb30-432" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-433"><a href="#cb30-433" aria-hidden="true" tabindex="-1"></a><span class="st">            h2 .header-section-number {</span></span>
<span id="cb30-434"><a href="#cb30-434" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.85em;</span></span>
<span id="cb30-435"><a href="#cb30-435" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-436"><a href="#cb30-436" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-437"><a href="#cb30-437" aria-hidden="true" tabindex="-1"></a><span class="st">            h3 .header-section-number {</span></span>
<span id="cb30-438"><a href="#cb30-438" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.8em;</span></span>
<span id="cb30-439"><a href="#cb30-439" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-440"><a href="#cb30-440" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-441"><a href="#cb30-441" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para c√≥digo e matem√°tica */</span></span>
<span id="cb30-442"><a href="#cb30-442" aria-hidden="true" tabindex="-1"></a><span class="st">            .math { display: block; text-align: center; margin: 1.5em 0; }</span></span>
<span id="cb30-443"><a href="#cb30-443" aria-hidden="true" tabindex="-1"></a><span class="st">            .math inline { display: inline-block; }</span></span>
<span id="cb30-444"><a href="#cb30-444" aria-hidden="true" tabindex="-1"></a><span class="st">            pre { </span></span>
<span id="cb30-445"><a href="#cb30-445" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb30-446"><a href="#cb30-446" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #2d2d2d; </span></span>
<span id="cb30-447"><a href="#cb30-447" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #f8f8f2;</span></span>
<span id="cb30-448"><a href="#cb30-448" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb30-449"><a href="#cb30-449" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb30-450"><a href="#cb30-450" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow-x: auto;</span></span>
<span id="cb30-451"><a href="#cb30-451" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb30-452"><a href="#cb30-452" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.4;</span></span>
<span id="cb30-453"><a href="#cb30-453" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-454"><a href="#cb30-454" aria-hidden="true" tabindex="-1"></a><span class="st">            code { </span></span>
<span id="cb30-455"><a href="#cb30-455" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #e9ecef; </span></span>
<span id="cb30-456"><a href="#cb30-456" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 0.2em 0.4em; </span></span>
<span id="cb30-457"><a href="#cb30-457" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 3px;</span></span>
<span id="cb30-458"><a href="#cb30-458" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb30-459"><a href="#cb30-459" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #c7254e;</span></span>
<span id="cb30-460"><a href="#cb30-460" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-461"><a href="#cb30-461" aria-hidden="true" tabindex="-1"></a><span class="st">            pre code { </span></span>
<span id="cb30-462"><a href="#cb30-462" aria-hidden="true" tabindex="-1"></a><span class="st">                background: none; </span></span>
<span id="cb30-463"><a href="#cb30-463" aria-hidden="true" tabindex="-1"></a><span class="st">                color: inherit; </span></span>
<span id="cb30-464"><a href="#cb30-464" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 0; </span></span>
<span id="cb30-465"><a href="#cb30-465" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-466"><a href="#cb30-466" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-467"><a href="#cb30-467" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias responsivas */</span></span>
<span id="cb30-468"><a href="#cb30-468" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 1200px) {</span></span>
<span id="cb30-469"><a href="#cb30-469" aria-hidden="true" tabindex="-1"></a><span class="st">                .container {</span></span>
<span id="cb30-470"><a href="#cb30-470" aria-hidden="true" tabindex="-1"></a><span class="st">                    max-width: 98%;</span></span>
<span id="cb30-471"><a href="#cb30-471" aria-hidden="true" tabindex="-1"></a><span class="st">                    padding: 30px;</span></span>
<span id="cb30-472"><a href="#cb30-472" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb30-473"><a href="#cb30-473" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC {</span></span>
<span id="cb30-474"><a href="#cb30-474" aria-hidden="true" tabindex="-1"></a><span class="st">                    float: none;</span></span>
<span id="cb30-475"><a href="#cb30-475" aria-hidden="true" tabindex="-1"></a><span class="st">                    width: auto;</span></span>
<span id="cb30-476"><a href="#cb30-476" aria-hidden="true" tabindex="-1"></a><span class="st">                    margin: 20px 0;</span></span>
<span id="cb30-477"><a href="#cb30-477" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb30-478"><a href="#cb30-478" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-479"><a href="#cb30-479" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-480"><a href="#cb30-480" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 768px) {</span></span>
<span id="cb30-481"><a href="#cb30-481" aria-hidden="true" tabindex="-1"></a><span class="st">                body { padding: 10px; font-size: 14px; }</span></span>
<span id="cb30-482"><a href="#cb30-482" aria-hidden="true" tabindex="-1"></a><span class="st">                .container { padding: 20px; max-width: 100%; }</span></span>
<span id="cb30-483"><a href="#cb30-483" aria-hidden="true" tabindex="-1"></a><span class="st">                pre { font-size: 12px; padding: 15px; }</span></span>
<span id="cb30-484"><a href="#cb30-484" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC { padding: 15px; }</span></span>
<span id="cb30-485"><a href="#cb30-485" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-486"><a href="#cb30-486" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-487"><a href="#cb30-487" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para tabelas */</span></span>
<span id="cb30-488"><a href="#cb30-488" aria-hidden="true" tabindex="-1"></a><span class="st">            table { </span></span>
<span id="cb30-489"><a href="#cb30-489" aria-hidden="true" tabindex="-1"></a><span class="st">                width: 100%; </span></span>
<span id="cb30-490"><a href="#cb30-490" aria-hidden="true" tabindex="-1"></a><span class="st">                border-collapse: collapse; </span></span>
<span id="cb30-491"><a href="#cb30-491" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 1.5em 0;</span></span>
<span id="cb30-492"><a href="#cb30-492" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb30-493"><a href="#cb30-493" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb30-494"><a href="#cb30-494" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow: hidden;</span></span>
<span id="cb30-495"><a href="#cb30-495" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-496"><a href="#cb30-496" aria-hidden="true" tabindex="-1"></a><span class="st">            th, td { </span></span>
<span id="cb30-497"><a href="#cb30-497" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #dee2e6; </span></span>
<span id="cb30-498"><a href="#cb30-498" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 12px 15px; </span></span>
<span id="cb30-499"><a href="#cb30-499" aria-hidden="true" tabindex="-1"></a><span class="st">                text-align: left; </span></span>
<span id="cb30-500"><a href="#cb30-500" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-501"><a href="#cb30-501" aria-hidden="true" tabindex="-1"></a><span class="st">            th { </span></span>
<span id="cb30-502"><a href="#cb30-502" aria-hidden="true" tabindex="-1"></a><span class="st">                background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb30-503"><a href="#cb30-503" aria-hidden="true" tabindex="-1"></a><span class="st">                color: white; </span></span>
<span id="cb30-504"><a href="#cb30-504" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: bold;</span></span>
<span id="cb30-505"><a href="#cb30-505" aria-hidden="true" tabindex="-1"></a><span class="st">                text-transform: uppercase;</span></span>
<span id="cb30-506"><a href="#cb30-506" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.9em;</span></span>
<span id="cb30-507"><a href="#cb30-507" aria-hidden="true" tabindex="-1"></a><span class="st">                letter-spacing: 0.5px;</span></span>
<span id="cb30-508"><a href="#cb30-508" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-509"><a href="#cb30-509" aria-hidden="true" tabindex="-1"></a><span class="st">            tr:nth-child(even) { </span></span>
<span id="cb30-510"><a href="#cb30-510" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #f8f9fa; </span></span>
<span id="cb30-511"><a href="#cb30-511" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-512"><a href="#cb30-512" aria-hidden="true" tabindex="-1"></a><span class="st">            tr:hover { </span></span>
<span id="cb30-513"><a href="#cb30-513" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #e3f2fd; </span></span>
<span id="cb30-514"><a href="#cb30-514" aria-hidden="true" tabindex="-1"></a><span class="st">                transition: background-color 0.2s ease;</span></span>
<span id="cb30-515"><a href="#cb30-515" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-516"><a href="#cb30-516" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-517"><a href="#cb30-517" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para blocos de cita√ß√£o */</span></span>
<span id="cb30-518"><a href="#cb30-518" aria-hidden="true" tabindex="-1"></a><span class="st">            blockquote { </span></span>
<span id="cb30-519"><a href="#cb30-519" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb30-520"><a href="#cb30-520" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 25px 0; </span></span>
<span id="cb30-521"><a href="#cb30-521" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 25px; </span></span>
<span id="cb30-522"><a href="#cb30-522" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #7f8c8d;</span></span>
<span id="cb30-523"><a href="#cb30-523" aria-hidden="true" tabindex="-1"></a><span class="st">                font-style: italic;</span></span>
<span id="cb30-524"><a href="#cb30-524" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #f8f9fa;</span></span>
<span id="cb30-525"><a href="#cb30-525" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb30-526"><a href="#cb30-526" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 0 8px 8px 0;</span></span>
<span id="cb30-527"><a href="#cb30-527" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-528"><a href="#cb30-528" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-529"><a href="#cb30-529" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Cabe√ßalhos com numera√ß√£o */</span></span>
<span id="cb30-530"><a href="#cb30-530" aria-hidden="true" tabindex="-1"></a><span class="st">            h1, h2, h3, h4, h5 { </span></span>
<span id="cb30-531"><a href="#cb30-531" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50; </span></span>
<span id="cb30-532"><a href="#cb30-532" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-top: 1.8em;</span></span>
<span id="cb30-533"><a href="#cb30-533" aria-hidden="true" tabindex="-1"></a><span class="st">                border-bottom: 1px solid #e9ecef;</span></span>
<span id="cb30-534"><a href="#cb30-534" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-bottom: 0.5em;</span></span>
<span id="cb30-535"><a href="#cb30-535" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-536"><a href="#cb30-536" aria-hidden="true" tabindex="-1"></a><span class="st">            h1 { </span></span>
<span id="cb30-537"><a href="#cb30-537" aria-hidden="true" tabindex="-1"></a><span class="st">                border-bottom: 3px solid #3498db; </span></span>
<span id="cb30-538"><a href="#cb30-538" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-bottom: 15px; </span></span>
<span id="cb30-539"><a href="#cb30-539" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50;</span></span>
<span id="cb30-540"><a href="#cb30-540" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 2.2em;</span></span>
<span id="cb30-541"><a href="#cb30-541" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-542"><a href="#cb30-542" aria-hidden="true" tabindex="-1"></a><span class="st">            h2 {</span></span>
<span id="cb30-543"><a href="#cb30-543" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db;</span></span>
<span id="cb30-544"><a href="#cb30-544" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 15px;</span></span>
<span id="cb30-545"><a href="#cb30-545" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-top: 2em;</span></span>
<span id="cb30-546"><a href="#cb30-546" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-547"><a href="#cb30-547" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-548"><a href="#cb30-548" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Clearfix para layout com TOC flutuante */</span></span>
<span id="cb30-549"><a href="#cb30-549" aria-hidden="true" tabindex="-1"></a><span class="st">            .main-content {</span></span>
<span id="cb30-550"><a href="#cb30-550" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow: hidden;</span></span>
<span id="cb30-551"><a href="#cb30-551" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-552"><a href="#cb30-552" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/style&gt;</span></span>
<span id="cb30-553"><a href="#cb30-553" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb30-554"><a href="#cb30-554" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-555"><a href="#cb30-555" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;/head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb30-556"><a href="#cb30-556" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;/head&gt;&#39;</span>, <span class="ss">f&#39;</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;&#39;</span>)</span>
<span id="cb30-557"><a href="#cb30-557" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb30-558"><a href="#cb30-558" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb30-559"><a href="#cb30-559" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb30-560"><a href="#cb30-560" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;&lt;body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb30-561"><a href="#cb30-561" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;body&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;&#39;</span>)</span>
<span id="cb30-562"><a href="#cb30-562" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb30-563"><a href="#cb30-563" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;</span><span class="ch">\n</span><span class="sc">{</span>html_content<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/body&gt;&#39;</span></span>
<span id="cb30-564"><a href="#cb30-564" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-565"><a href="#cb30-565" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb30-566"><a href="#cb30-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-567"><a href="#cb30-567" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _enhance_toc_styling(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb30-568"><a href="#cb30-568" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Melhora o estilo do Table of Contents gerado pelo Pandoc&quot;&quot;&quot;</span></span>
<span id="cb30-569"><a href="#cb30-569" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona t√≠tulo ao TOC se n√£o existir</span></span>
<span id="cb30-570"><a href="#cb30-570" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;Table of Contents&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb30-571"><a href="#cb30-571" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(</span>
<span id="cb30-572"><a href="#cb30-572" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span>, </span>
<span id="cb30-573"><a href="#cb30-573" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&lt;h2 style=&quot;margin-top: 0; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;&quot;&gt;üìë Table of Contents&lt;/h2&gt;&#39;</span></span>
<span id="cb30-574"><a href="#cb30-574" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb30-575"><a href="#cb30-575" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-576"><a href="#cb30-576" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona wrapper para conte√∫do principal</span></span>
<span id="cb30-577"><a href="#cb30-577" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;&lt;body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb30-578"><a href="#cb30-578" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Encontra o TOC e envolve o conte√∫do restante</span></span>
<span id="cb30-579"><a href="#cb30-579" aria-hidden="true" tabindex="-1"></a>            toc_end <span class="op">=</span> html_content.find(<span class="st">&#39;&lt;/div&gt;&#39;</span>, html_content.find(<span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span>)) <span class="op">+</span> <span class="dv">6</span></span>
<span id="cb30-580"><a href="#cb30-580" aria-hidden="true" tabindex="-1"></a>            body_content <span class="op">=</span> html_content[toc_end:]</span>
<span id="cb30-581"><a href="#cb30-581" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;&lt;div class=&quot;main-content&quot;&gt;&#39;</span> <span class="kw">not</span> <span class="kw">in</span> body_content:</span>
<span id="cb30-582"><a href="#cb30-582" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> html_content[:toc_end] <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&lt;div class=&quot;main-content&quot;&gt;&#39;</span> <span class="op">+</span> body_content <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&lt;/div&gt;&#39;</span></span>
<span id="cb30-583"><a href="#cb30-583" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-584"><a href="#cb30-584" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb30-585"><a href="#cb30-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-586"><a href="#cb30-586" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_fallback(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb30-587"><a href="#cb30-587" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Fallback para convers√£o quando Pandoc falha&quot;&quot;&quot;</span></span>
<span id="cb30-588"><a href="#cb30-588" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb30-589"><a href="#cb30-589" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(md_file_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb30-590"><a href="#cb30-590" aria-hidden="true" tabindex="-1"></a>                md_content <span class="op">=</span> f.read()</span>
<span id="cb30-591"><a href="#cb30-591" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-592"><a href="#cb30-592" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extens√µes avan√ßadas para melhor convers√£o</span></span>
<span id="cb30-593"><a href="#cb30-593" aria-hidden="true" tabindex="-1"></a>            extensions <span class="op">=</span> [</span>
<span id="cb30-594"><a href="#cb30-594" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;extra&#39;</span>, <span class="st">&#39;tables&#39;</span>, <span class="st">&#39;fenced_code&#39;</span>, <span class="st">&#39;codehilite&#39;</span>, </span>
<span id="cb30-595"><a href="#cb30-595" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;toc&#39;</span>, <span class="st">&#39;md_in_html&#39;</span>, <span class="st">&#39;attr_list&#39;</span></span>
<span id="cb30-596"><a href="#cb30-596" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb30-597"><a href="#cb30-597" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-598"><a href="#cb30-598" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> markdown.markdown(</span>
<span id="cb30-599"><a href="#cb30-599" aria-hidden="true" tabindex="-1"></a>                md_content,</span>
<span id="cb30-600"><a href="#cb30-600" aria-hidden="true" tabindex="-1"></a>                extensions<span class="op">=</span>extensions,</span>
<span id="cb30-601"><a href="#cb30-601" aria-hidden="true" tabindex="-1"></a>                output_format<span class="op">=</span><span class="st">&#39;html5&#39;</span></span>
<span id="cb30-602"><a href="#cb30-602" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb30-603"><a href="#cb30-603" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-604"><a href="#cb30-604" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_enhanced_html_template(html_content, Path(md_file_path).name)</span>
<span id="cb30-605"><a href="#cb30-605" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-606"><a href="#cb30-606" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb30-607"><a href="#cb30-607" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Fallback tamb√©m falhou: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-608"><a href="#cb30-608" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_basic_html(md_content, Path(md_file_path).name)</span>
<span id="cb30-609"><a href="#cb30-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-610"><a href="#cb30-610" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_enhanced_html_template(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb30-611"><a href="#cb30-611" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Template HTML aprimorado com suporte a MathJax local/online&quot;&quot;&quot;</span></span>
<span id="cb30-612"><a href="#cb30-612" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb30-613"><a href="#cb30-613" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-614"><a href="#cb30-614" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb30-615"><a href="#cb30-615" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html lang=&quot;pt-BR&quot;&gt;</span></span>
<span id="cb30-616"><a href="#cb30-616" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb30-617"><a href="#cb30-617" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb30-618"><a href="#cb30-618" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb30-619"><a href="#cb30-619" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb30-620"><a href="#cb30-620" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb30-621"><a href="#cb30-621" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span></span>
<span id="cb30-622"><a href="#cb30-622" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb30-623"><a href="#cb30-623" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb30-624"><a href="#cb30-624" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0;</span></span>
<span id="cb30-625"><a href="#cb30-625" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb30-626"><a href="#cb30-626" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb30-627"><a href="#cb30-627" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333;</span></span>
<span id="cb30-628"><a href="#cb30-628" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: none; /* Remove limita√ß√£o de largura */</span></span>
<span id="cb30-629"><a href="#cb30-629" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-630"><a href="#cb30-630" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb30-631"><a href="#cb30-631" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb30-632"><a href="#cb30-632" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb30-633"><a href="#cb30-633" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb30-634"><a href="#cb30-634" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 40px;</span></span>
<span id="cb30-635"><a href="#cb30-635" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 10px;</span></span>
<span id="cb30-636"><a href="#cb30-636" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb30-637"><a href="#cb30-637" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-638"><a href="#cb30-638" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1, h2, h3, h4, h5 </span><span class="ch">{{</span></span>
<span id="cb30-639"><a href="#cb30-639" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb30-640"><a href="#cb30-640" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 1.8em;</span></span>
<span id="cb30-641"><a href="#cb30-641" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-642"><a href="#cb30-642" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1 </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-643"><a href="#cb30-643" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 3px solid #3498db; </span></span>
<span id="cb30-644"><a href="#cb30-644" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 15px; </span></span>
<span id="cb30-645"><a href="#cb30-645" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb30-646"><a href="#cb30-646" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 2.2em;</span></span>
<span id="cb30-647"><a href="#cb30-647" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-648"><a href="#cb30-648" aria-hidden="true" tabindex="-1"></a><span class="ss">        h2 </span><span class="ch">{{</span></span>
<span id="cb30-649"><a href="#cb30-649" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb30-650"><a href="#cb30-650" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb30-651"><a href="#cb30-651" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 2em;</span></span>
<span id="cb30-652"><a href="#cb30-652" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-653"><a href="#cb30-653" aria-hidden="true" tabindex="-1"></a><span class="ss">        code </span><span class="ch">{{</span></span>
<span id="cb30-654"><a href="#cb30-654" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f4f4f4;</span></span>
<span id="cb30-655"><a href="#cb30-655" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 3px 8px;</span></span>
<span id="cb30-656"><a href="#cb30-656" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb30-657"><a href="#cb30-657" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb30-658"><a href="#cb30-658" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #c7254e;</span></span>
<span id="cb30-659"><a href="#cb30-659" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb30-660"><a href="#cb30-660" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-661"><a href="#cb30-661" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span></span>
<span id="cb30-662"><a href="#cb30-662" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #2d2d2d;</span></span>
<span id="cb30-663"><a href="#cb30-663" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #f8f8f2;</span></span>
<span id="cb30-664"><a href="#cb30-664" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb30-665"><a href="#cb30-665" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb30-666"><a href="#cb30-666" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb30-667"><a href="#cb30-667" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 5px solid #3498db;</span></span>
<span id="cb30-668"><a href="#cb30-668" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb30-669"><a href="#cb30-669" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.4;</span></span>
<span id="cb30-670"><a href="#cb30-670" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-671"><a href="#cb30-671" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre code </span><span class="ch">{{</span></span>
<span id="cb30-672"><a href="#cb30-672" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: none;</span></span>
<span id="cb30-673"><a href="#cb30-673" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: inherit;</span></span>
<span id="cb30-674"><a href="#cb30-674" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 0;</span></span>
<span id="cb30-675"><a href="#cb30-675" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-676"><a href="#cb30-676" aria-hidden="true" tabindex="-1"></a><span class="ss">        blockquote </span><span class="ch">{{</span></span>
<span id="cb30-677"><a href="#cb30-677" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb30-678"><a href="#cb30-678" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 25px 0;</span></span>
<span id="cb30-679"><a href="#cb30-679" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 25px;</span></span>
<span id="cb30-680"><a href="#cb30-680" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb30-681"><a href="#cb30-681" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-style: italic;</span></span>
<span id="cb30-682"><a href="#cb30-682" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb30-683"><a href="#cb30-683" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb30-684"><a href="#cb30-684" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 0 8px 8px 0;</span></span>
<span id="cb30-685"><a href="#cb30-685" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-686"><a href="#cb30-686" aria-hidden="true" tabindex="-1"></a><span class="ss">        table </span><span class="ch">{{</span></span>
<span id="cb30-687"><a href="#cb30-687" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-collapse: collapse;</span></span>
<span id="cb30-688"><a href="#cb30-688" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 100%;</span></span>
<span id="cb30-689"><a href="#cb30-689" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb30-690"><a href="#cb30-690" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb30-691"><a href="#cb30-691" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb30-692"><a href="#cb30-692" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb30-693"><a href="#cb30-693" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-694"><a href="#cb30-694" aria-hidden="true" tabindex="-1"></a><span class="ss">        th, td </span><span class="ch">{{</span></span>
<span id="cb30-695"><a href="#cb30-695" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb30-696"><a href="#cb30-696" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb30-697"><a href="#cb30-697" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: left;</span></span>
<span id="cb30-698"><a href="#cb30-698" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-699"><a href="#cb30-699" aria-hidden="true" tabindex="-1"></a><span class="ss">        th </span><span class="ch">{{</span></span>
<span id="cb30-700"><a href="#cb30-700" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb30-701"><a href="#cb30-701" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb30-702"><a href="#cb30-702" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb30-703"><a href="#cb30-703" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-transform: uppercase;</span></span>
<span id="cb30-704"><a href="#cb30-704" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb30-705"><a href="#cb30-705" aria-hidden="true" tabindex="-1"></a><span class="ss">            letter-spacing: 0.5px;</span></span>
<span id="cb30-706"><a href="#cb30-706" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-707"><a href="#cb30-707" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:nth-child(even) </span><span class="ch">{{</span></span>
<span id="cb30-708"><a href="#cb30-708" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f8f9fa;</span></span>
<span id="cb30-709"><a href="#cb30-709" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-710"><a href="#cb30-710" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:hover </span><span class="ch">{{</span></span>
<span id="cb30-711"><a href="#cb30-711" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #e3f2fd;</span></span>
<span id="cb30-712"><a href="#cb30-712" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: background-color 0.2s ease;</span></span>
<span id="cb30-713"><a href="#cb30-713" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-714"><a href="#cb30-714" aria-hidden="true" tabindex="-1"></a><span class="ss">        .math </span><span class="ch">{{</span></span>
<span id="cb30-715"><a href="#cb30-715" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center;</span></span>
<span id="cb30-716"><a href="#cb30-716" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb30-717"><a href="#cb30-717" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb30-718"><a href="#cb30-718" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb30-719"><a href="#cb30-719" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb30-720"><a href="#cb30-720" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb30-721"><a href="#cb30-721" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-722"><a href="#cb30-722" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-header </span><span class="ch">{{</span></span>
<span id="cb30-723"><a href="#cb30-723" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb30-724"><a href="#cb30-724" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between;</span></span>
<span id="cb30-725"><a href="#cb30-725" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: center;</span></span>
<span id="cb30-726"><a href="#cb30-726" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 15px;</span></span>
<span id="cb30-727"><a href="#cb30-727" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb30-728"><a href="#cb30-728" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 10px;</span></span>
<span id="cb30-729"><a href="#cb30-729" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-730"><a href="#cb30-730" aria-hidden="true" tabindex="-1"></a><span class="ss">        .author </span><span class="ch">{{</span></span>
<span id="cb30-731"><a href="#cb30-731" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb30-732"><a href="#cb30-732" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb30-733"><a href="#cb30-733" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.1em;</span></span>
<span id="cb30-734"><a href="#cb30-734" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-735"><a href="#cb30-735" aria-hidden="true" tabindex="-1"></a><span class="ss">        .timestamp </span><span class="ch">{{</span></span>
<span id="cb30-736"><a href="#cb30-736" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb30-737"><a href="#cb30-737" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb30-738"><a href="#cb30-738" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e9ecef;</span></span>
<span id="cb30-739"><a href="#cb30-739" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 8px;</span></span>
<span id="cb30-740"><a href="#cb30-740" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb30-741"><a href="#cb30-741" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-742"><a href="#cb30-742" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-content </span><span class="ch">{{</span></span>
<span id="cb30-743"><a href="#cb30-743" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb30-744"><a href="#cb30-744" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb30-745"><a href="#cb30-745" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb30-746"><a href="#cb30-746" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb30-747"><a href="#cb30-747" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 20px;</span></span>
<span id="cb30-748"><a href="#cb30-748" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-749"><a href="#cb30-749" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata </span><span class="ch">{{</span></span>
<span id="cb30-750"><a href="#cb30-750" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e8f4fd;</span></span>
<span id="cb30-751"><a href="#cb30-751" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb30-752"><a href="#cb30-752" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb30-753"><a href="#cb30-753" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 25px;</span></span>
<span id="cb30-754"><a href="#cb30-754" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb30-755"><a href="#cb30-755" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-756"><a href="#cb30-756" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata h3 </span><span class="ch">{{</span></span>
<span id="cb30-757"><a href="#cb30-757" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb30-758"><a href="#cb30-758" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb30-759"><a href="#cb30-759" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-760"><a href="#cb30-760" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* Estilos para TOC manual */</span></span>
<span id="cb30-761"><a href="#cb30-761" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc </span><span class="ch">{{</span></span>
<span id="cb30-762"><a href="#cb30-762" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);</span></span>
<span id="cb30-763"><a href="#cb30-763" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #dee2e6;</span></span>
<span id="cb30-764"><a href="#cb30-764" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb30-765"><a href="#cb30-765" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb30-766"><a href="#cb30-766" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 20px 0;</span></span>
<span id="cb30-767"><a href="#cb30-767" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb30-768"><a href="#cb30-768" aria-hidden="true" tabindex="-1"></a><span class="ss">            float: right;</span></span>
<span id="cb30-769"><a href="#cb30-769" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 300px;</span></span>
<span id="cb30-770"><a href="#cb30-770" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 30px;</span></span>
<span id="cb30-771"><a href="#cb30-771" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-772"><a href="#cb30-772" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc h2 </span><span class="ch">{{</span></span>
<span id="cb30-773"><a href="#cb30-773" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb30-774"><a href="#cb30-774" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb30-775"><a href="#cb30-775" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 2px solid #3498db;</span></span>
<span id="cb30-776"><a href="#cb30-776" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 10px;</span></span>
<span id="cb30-777"><a href="#cb30-777" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-778"><a href="#cb30-778" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc ul </span><span class="ch">{{</span></span>
<span id="cb30-779"><a href="#cb30-779" aria-hidden="true" tabindex="-1"></a><span class="ss">            list-style-type: none;</span></span>
<span id="cb30-780"><a href="#cb30-780" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb30-781"><a href="#cb30-781" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-782"><a href="#cb30-782" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc li </span><span class="ch">{{</span></span>
<span id="cb30-783"><a href="#cb30-783" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 8px 0;</span></span>
<span id="cb30-784"><a href="#cb30-784" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-785"><a href="#cb30-785" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc a </span><span class="ch">{{</span></span>
<span id="cb30-786"><a href="#cb30-786" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb30-787"><a href="#cb30-787" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #495057;</span></span>
<span id="cb30-788"><a href="#cb30-788" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb30-789"><a href="#cb30-789" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-790"><a href="#cb30-790" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc a:hover </span><span class="ch">{{</span></span>
<span id="cb30-791"><a href="#cb30-791" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #007bff;</span></span>
<span id="cb30-792"><a href="#cb30-792" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-793"><a href="#cb30-793" aria-hidden="true" tabindex="-1"></a><span class="ss">        .main-content </span><span class="ch">{{</span></span>
<span id="cb30-794"><a href="#cb30-794" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb30-795"><a href="#cb30-795" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-796"><a href="#cb30-796" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 1200px) </span><span class="ch">{{</span></span>
<span id="cb30-797"><a href="#cb30-797" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb30-798"><a href="#cb30-798" aria-hidden="true" tabindex="-1"></a><span class="ss">                max-width: 98%;</span></span>
<span id="cb30-799"><a href="#cb30-799" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 30px;</span></span>
<span id="cb30-800"><a href="#cb30-800" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb30-801"><a href="#cb30-801" aria-hidden="true" tabindex="-1"></a><span class="ss">            .toc </span><span class="ch">{{</span></span>
<span id="cb30-802"><a href="#cb30-802" aria-hidden="true" tabindex="-1"></a><span class="ss">                float: none;</span></span>
<span id="cb30-803"><a href="#cb30-803" aria-hidden="true" tabindex="-1"></a><span class="ss">                width: auto;</span></span>
<span id="cb30-804"><a href="#cb30-804" aria-hidden="true" tabindex="-1"></a><span class="ss">                margin: 20px 0;</span></span>
<span id="cb30-805"><a href="#cb30-805" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb30-806"><a href="#cb30-806" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-807"><a href="#cb30-807" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 768px) </span><span class="ch">{{</span></span>
<span id="cb30-808"><a href="#cb30-808" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb30-809"><a href="#cb30-809" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 20px;</span></span>
<span id="cb30-810"><a href="#cb30-810" aria-hidden="true" tabindex="-1"></a><span class="ss">                max-width: 100%;</span></span>
<span id="cb30-811"><a href="#cb30-811" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb30-812"><a href="#cb30-812" aria-hidden="true" tabindex="-1"></a><span class="ss">            body </span><span class="ch">{{</span></span>
<span id="cb30-813"><a href="#cb30-813" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 10px;</span></span>
<span id="cb30-814"><a href="#cb30-814" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb30-815"><a href="#cb30-815" aria-hidden="true" tabindex="-1"></a><span class="ss">            h1 </span><span class="ch">{{</span></span>
<span id="cb30-816"><a href="#cb30-816" aria-hidden="true" tabindex="-1"></a><span class="ss">                font-size: 1.8em;</span></span>
<span id="cb30-817"><a href="#cb30-817" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb30-818"><a href="#cb30-818" aria-hidden="true" tabindex="-1"></a><span class="ss">            .message-header </span><span class="ch">{{</span></span>
<span id="cb30-819"><a href="#cb30-819" aria-hidden="true" tabindex="-1"></a><span class="ss">                flex-direction: column;</span></span>
<span id="cb30-820"><a href="#cb30-820" aria-hidden="true" tabindex="-1"></a><span class="ss">                align-items: flex-start;</span></span>
<span id="cb30-821"><a href="#cb30-821" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb30-822"><a href="#cb30-822" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-823"><a href="#cb30-823" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb30-824"><a href="#cb30-824" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb30-825"><a href="#cb30-825" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb30-826"><a href="#cb30-826" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb30-827"><a href="#cb30-827" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="sc">{</span>content<span class="sc">}</span></span>
<span id="cb30-828"><a href="#cb30-828" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb30-829"><a href="#cb30-829" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb30-830"><a href="#cb30-830" aria-hidden="true" tabindex="-1"></a><span class="ss">        // Configura√ß√£o MathJax para melhor renderiza√ß√£o</span></span>
<span id="cb30-831"><a href="#cb30-831" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb30-832"><a href="#cb30-832" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb30-833"><a href="#cb30-833" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb30-834"><a href="#cb30-834" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb30-835"><a href="#cb30-835" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true,</span></span>
<span id="cb30-836"><a href="#cb30-836" aria-hidden="true" tabindex="-1"></a><span class="ss">                tags: &#39;ams&#39;</span></span>
<span id="cb30-837"><a href="#cb30-837" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb30-838"><a href="#cb30-838" aria-hidden="true" tabindex="-1"></a><span class="ss">            options: </span><span class="ch">{{</span></span>
<span id="cb30-839"><a href="#cb30-839" aria-hidden="true" tabindex="-1"></a><span class="ss">                skipHtmlTags: [&#39;script&#39;, &#39;noscript&#39;, &#39;style&#39;, &#39;textarea&#39;, &#39;pre&#39;],</span></span>
<span id="cb30-840"><a href="#cb30-840" aria-hidden="true" tabindex="-1"></a><span class="ss">                renderActions: </span><span class="ch">{{</span></span>
<span id="cb30-841"><a href="#cb30-841" aria-hidden="true" tabindex="-1"></a><span class="ss">                    addMenu: [0, &#39;&#39;, &#39;&#39;]</span></span>
<span id="cb30-842"><a href="#cb30-842" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb30-843"><a href="#cb30-843" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb30-844"><a href="#cb30-844" aria-hidden="true" tabindex="-1"></a><span class="ss">            startup: </span><span class="ch">{{</span></span>
<span id="cb30-845"><a href="#cb30-845" aria-hidden="true" tabindex="-1"></a><span class="ss">                pageReady() </span><span class="ch">{{</span></span>
<span id="cb30-846"><a href="#cb30-846" aria-hidden="true" tabindex="-1"></a><span class="ss">                    return MathJax.startup.defaultPageReady().then(() =&gt; </span><span class="ch">{{</span></span>
<span id="cb30-847"><a href="#cb30-847" aria-hidden="true" tabindex="-1"></a><span class="ss">                        console.log(&#39;MathJax carregado com sucesso&#39;);</span></span>
<span id="cb30-848"><a href="#cb30-848" aria-hidden="true" tabindex="-1"></a><span class="ss">                    </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb30-849"><a href="#cb30-849" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb30-850"><a href="#cb30-850" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb30-851"><a href="#cb30-851" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb30-852"><a href="#cb30-852" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb30-853"><a href="#cb30-853" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb30-854"><a href="#cb30-854" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb30-855"><a href="#cb30-855" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb30-856"><a href="#cb30-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-857"><a href="#cb30-857" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_basic_html(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb30-858"><a href="#cb30-858" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;HTML b√°sico de √∫ltimo recurso com MathJax&quot;&quot;&quot;</span></span>
<span id="cb30-859"><a href="#cb30-859" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb30-860"><a href="#cb30-860" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-861"><a href="#cb30-861" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb30-862"><a href="#cb30-862" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html&gt;</span></span>
<span id="cb30-863"><a href="#cb30-863" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb30-864"><a href="#cb30-864" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb30-865"><a href="#cb30-865" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb30-866"><a href="#cb30-866" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb30-867"><a href="#cb30-867" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-868"><a href="#cb30-868" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif; </span></span>
<span id="cb30-869"><a href="#cb30-869" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px; </span></span>
<span id="cb30-870"><a href="#cb30-870" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb30-871"><a href="#cb30-871" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb30-872"><a href="#cb30-872" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: none; /* Remove limita√ß√£o de largura */</span></span>
<span id="cb30-873"><a href="#cb30-873" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-874"><a href="#cb30-874" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-875"><a href="#cb30-875" aria-hidden="true" tabindex="-1"></a><span class="ss">            white-space: pre-wrap; </span></span>
<span id="cb30-876"><a href="#cb30-876" aria-hidden="true" tabindex="-1"></a><span class="ss">            word-wrap: break-word; </span></span>
<span id="cb30-877"><a href="#cb30-877" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb30-878"><a href="#cb30-878" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb30-879"><a href="#cb30-879" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 5px;</span></span>
<span id="cb30-880"><a href="#cb30-880" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb30-881"><a href="#cb30-881" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-882"><a href="#cb30-882" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb30-883"><a href="#cb30-883" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb30-884"><a href="#cb30-884" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb30-885"><a href="#cb30-885" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb30-886"><a href="#cb30-886" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 30px;</span></span>
<span id="cb30-887"><a href="#cb30-887" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb30-888"><a href="#cb30-888" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb30-889"><a href="#cb30-889" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-890"><a href="#cb30-890" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb30-891"><a href="#cb30-891" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb30-892"><a href="#cb30-892" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb30-893"><a href="#cb30-893" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb30-894"><a href="#cb30-894" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb30-895"><a href="#cb30-895" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb30-896"><a href="#cb30-896" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true</span></span>
<span id="cb30-897"><a href="#cb30-897" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb30-898"><a href="#cb30-898" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb30-899"><a href="#cb30-899" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb30-900"><a href="#cb30-900" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb30-901"><a href="#cb30-901" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb30-902"><a href="#cb30-902" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb30-903"><a href="#cb30-903" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb30-904"><a href="#cb30-904" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;pre&gt;</span><span class="sc">{</span>content<span class="sc">}</span><span class="ss">&lt;/pre&gt;</span></span>
<span id="cb30-905"><a href="#cb30-905" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb30-906"><a href="#cb30-906" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb30-907"><a href="#cb30-907" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb30-908"><a href="#cb30-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-909"><a href="#cb30-909" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_html_robust(<span class="va">self</span>):</span>
<span id="cb30-910"><a href="#cb30-910" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;M√©todo ROBUSTO para convers√£o HTML - VERS√ÉO OTIMIZADA&quot;&quot;&quot;</span></span>
<span id="cb30-911"><a href="#cb30-911" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb30-912"><a href="#cb30-912" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] HTMLs seriam criados:&quot;</span>)</span>
<span id="cb30-913"><a href="#cb30-913" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb30-914"><a href="#cb30-914" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb30-915"><a href="#cb30-915" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.html&quot;</span></span>
<span id="cb30-916"><a href="#cb30-916" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üåê </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-917"><a href="#cb30-917" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb30-918"><a href="#cb30-918" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-919"><a href="#cb30-919" aria-hidden="true" tabindex="-1"></a>        markdown_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;markdown&#39;</span>])</span>
<span id="cb30-920"><a href="#cb30-920" aria-hidden="true" tabindex="-1"></a>        html_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;html&#39;</span>])</span>
<span id="cb30-921"><a href="#cb30-921" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-922"><a href="#cb30-922" aria-hidden="true" tabindex="-1"></a>        md_files <span class="op">=</span> <span class="bu">list</span>(markdown_folder.glob(<span class="st">&quot;*.md&quot;</span>))</span>
<span id="cb30-923"><a href="#cb30-923" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-924"><a href="#cb30-924" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> md_files:</span>
<span id="cb30-925"><a href="#cb30-925" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Nenhum arquivo Markdown encontrado para convers√£o.&quot;</span>)</span>
<span id="cb30-926"><a href="#cb30-926" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb30-927"><a href="#cb30-927" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-928"><a href="#cb30-928" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÑ Convertendo </span><span class="sc">{</span><span class="bu">len</span>(md_files)<span class="sc">}</span><span class="ss"> arquivos Markdown para HTML (OTIMIZADO)...&quot;</span>)</span>
<span id="cb30-929"><a href="#cb30-929" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-930"><a href="#cb30-930" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verifica se Pandoc est√° dispon√≠vel</span></span>
<span id="cb30-931"><a href="#cb30-931" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb30-932"><a href="#cb30-932" aria-hidden="true" tabindex="-1"></a>            subprocess.run([<span class="st">&#39;pandoc&#39;</span>, <span class="st">&#39;--version&#39;</span>], capture_output<span class="op">=</span><span class="va">True</span>, check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-933"><a href="#cb30-933" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">True</span></span>
<span id="cb30-934"><a href="#cb30-934" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;‚úÖ Pandoc dispon√≠vel - usando convers√£o otimizada&quot;</span>)</span>
<span id="cb30-935"><a href="#cb30-935" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb30-936"><a href="#cb30-936" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">False</span></span>
<span id="cb30-937"><a href="#cb30-937" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è Pandoc n√£o dispon√≠vel - usando fallback Python&quot;</span>)</span>
<span id="cb30-938"><a href="#cb30-938" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-939"><a href="#cb30-939" aria-hidden="true" tabindex="-1"></a>        converted_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-940"><a href="#cb30-940" aria-hidden="true" tabindex="-1"></a>        failed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-941"><a href="#cb30-941" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-942"><a href="#cb30-942" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> md_file <span class="kw">in</span> md_files:</span>
<span id="cb30-943"><a href="#cb30-943" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb30-944"><a href="#cb30-944" aria-hidden="true" tabindex="-1"></a>                html_file <span class="op">=</span> html_folder <span class="op">/</span> md_file.with_suffix(<span class="st">&#39;.html&#39;</span>).name</span>
<span id="cb30-945"><a href="#cb30-945" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-946"><a href="#cb30-946" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> html_file.exists():</span>
<span id="cb30-947"><a href="#cb30-947" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚è≠Ô∏è  J√° existe: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-948"><a href="#cb30-948" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb30-949"><a href="#cb30-949" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb30-950"><a href="#cb30-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-951"><a href="#cb30-951" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ Processando: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-952"><a href="#cb30-952" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-953"><a href="#cb30-953" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> pandoc_available:</span>
<span id="cb30-954"><a href="#cb30-954" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_pandoc_optimized(<span class="bu">str</span>(md_file))</span>
<span id="cb30-955"><a href="#cb30-955" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb30-956"><a href="#cb30-956" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_fallback(<span class="bu">str</span>(md_file))</span>
<span id="cb30-957"><a href="#cb30-957" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-958"><a href="#cb30-958" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> html_content:</span>
<span id="cb30-959"><a href="#cb30-959" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(html_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb30-960"><a href="#cb30-960" aria-hidden="true" tabindex="-1"></a>                        f.write(html_content)</span>
<span id="cb30-961"><a href="#cb30-961" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb30-962"><a href="#cb30-962" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Criado: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-963"><a href="#cb30-963" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb30-964"><a href="#cb30-964" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb30-965"><a href="#cb30-965" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Falha na convers√£o: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-966"><a href="#cb30-966" aria-hidden="true" tabindex="-1"></a>                    failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb30-967"><a href="#cb30-967" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb30-968"><a href="#cb30-968" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb30-969"><a href="#cb30-969" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro em </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-970"><a href="#cb30-970" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(traceback.format_exc())</span>
<span id="cb30-971"><a href="#cb30-971" aria-hidden="true" tabindex="-1"></a>                failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb30-972"><a href="#cb30-972" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-973"><a href="#cb30-973" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä HTML: </span><span class="sc">{</span>converted_count<span class="sc">}</span><span class="ss"> arquivos criados, </span><span class="sc">{</span>failed_count<span class="sc">}</span><span class="ss"> falhas em &#39;</span><span class="sc">{</span>html_folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb30-974"><a href="#cb30-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-975"><a href="#cb30-975" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> categorize_conversation(<span class="va">self</span>, title: <span class="bu">str</span>, summary: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb30-976"><a href="#cb30-976" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Categoriza√ß√£o otimizada com express√µes regulares&quot;&quot;&quot;</span></span>
<span id="cb30-977"><a href="#cb30-977" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&quot;</span>.lower()</span>
<span id="cb30-978"><a href="#cb30-978" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-979"><a href="#cb30-979" aria-hidden="true" tabindex="-1"></a>        patterns <span class="op">=</span> {</span>
<span id="cb30-980"><a href="#cb30-980" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Tecnologia&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">tecnologia</span><span class="cf">|</span><span class="vs">hardware</span><span class="cf">|</span><span class="vs">software</span><span class="cf">|</span><span class="vs">rede</span><span class="cf">|</span><span class="vs">internet</span><span class="cf">|</span><span class="vs">wifi</span><span class="cf">|</span><span class="vs">bluetooth</span><span class="cf">|</span><span class="pp">[45]</span><span class="vs">g</span><span class="cf">|</span><span class="vs">cloud</span><span class="cf">|</span><span class="vs">aws</span><span class="cf">|</span><span class="vs">azure</span><span class="cf">|</span><span class="vs">gcp</span><span class="cf">|</span><span class="vs">servidor</span><span class="cf">|</span><span class="vs">hosting</span><span class="cf">|</span><span class="vs">dom√≠nio</span><span class="cf">|</span><span class="vs">ssl</span><span class="cf">|</span><span class="vs">router</span><span class="cf">|</span><span class="vs">switch</span><span class="cf">|</span><span class="vs">firewall</span><span class="cf">|</span><span class="vs">iot</span><span class="cf">|</span><span class="vs">smartphone</span><span class="cf">|</span><span class="vs">tablet</span><span class="cf">|</span><span class="vs">navegador</span><span class="cf">|</span><span class="vs">browser</span><span class="cf">|</span><span class="vs">chrome</span><span class="cf">|</span><span class="vs">firefox</span><span class="cf">|</span><span class="vs">edge</span><span class="cf">|</span><span class="vs">safari</span><span class="cf">|</span><span class="vs">email</span><span class="cf">|</span><span class="vs">gmail</span><span class="cf">|</span><span class="vs">outlook</span><span class="cf">|</span><span class="vs">criptografia</span><span class="cf">|</span><span class="vs">seguran√ßa</span><span class="cf">|</span><span class="vs">ciberseguran√ßa</span><span class="cf">|</span><span class="vs">ransomware</span><span class="cf">|</span><span class="vs">phishing</span><span class="cf">|</span><span class="vs">autentica√ß√£o</span><span class="cf">|</span><span class="vs">2fa</span><span class="cf">|</span><span class="vs">biometria</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb30-981"><a href="#cb30-981" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Sa√∫de&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">sa√∫de</span><span class="cf">|</span><span class="vs">medicina</span><span class="cf">|</span><span class="vs">m√©dico</span><span class="cf">|</span><span class="vs">enfermagem</span><span class="cf">|</span><span class="vs">doen√ßa</span><span class="cf">|</span><span class="vs">v√≠rus</span><span class="cf">|</span><span class="vs">bact√©ria</span><span class="cf">|</span><span class="vs">vacina</span><span class="cf">|</span><span class="vs">covid</span><span class="cf">|</span><span class="vs">coronav√≠rus</span><span class="cf">|</span><span class="vs">gripe</span><span class="cf">|</span><span class="vs">febre</span><span class="cf">|</span><span class="vs">dor</span><span class="cf">|</span><span class="vs">an√°lise</span><span class="cf">|</span><span class="vs">exame</span><span class="cf">|</span><span class="vs">raio x</span><span class="cf">|</span><span class="vs">resson√¢ncia</span><span class="cf">|</span><span class="vs">hospital</span><span class="cf">|</span><span class="vs">cl√≠nica</span><span class="cf">|</span><span class="vs">farm√°cia</span><span class="cf">|</span><span class="vs">medicamento</span><span class="cf">|</span><span class="vs">rem√©dio</span><span class="cf">|</span><span class="vs">psicologia</span><span class="cf">|</span><span class="vs">terapia</span><span class="cf">|</span><span class="vs">bem-estar</span><span class="cf">|</span><span class="vs">nutri√ß√£o</span><span class="cf">|</span><span class="vs">dieta</span><span class="cf">|</span><span class="vs">exerc√≠cio</span><span class="cf">|</span><span class="vs">fitness</span><span class="cf">|</span><span class="vs">sono</span><span class="cf">|</span><span class="vs">sa√∫de mental</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb30-982"><a href="#cb30-982" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Programa√ß√£o&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">python</span><span class="cf">|</span><span class="vs">javascript</span><span class="cf">|</span><span class="vs">java</span><span class="cf">|</span><span class="vs">c</span><span class="ch">\+\+</span><span class="cf">|</span><span class="vs">c#</span><span class="cf">|</span><span class="vs">go</span><span class="cf">|</span><span class="vs">rust</span><span class="cf">|</span><span class="vs">lua</span><span class="cf">|</span><span class="vs">bash</span><span class="cf">|</span><span class="vs">script</span><span class="cf">|</span><span class="vs">debug</span><span class="cf">|</span><span class="vs">erro</span><span class="cf">|</span><span class="vs">conda</span><span class="cf">|</span><span class="vs">mamba</span><span class="cf">|</span><span class="vs">pandoc</span><span class="cf">|</span><span class="vs">msys2</span><span class="cf">|</span><span class="vs">spyder</span><span class="cf">|</span><span class="vs">jupyter</span><span class="cf">|</span><span class="vs">pip</span><span class="cf">|</span><span class="vs">venv</span><span class="cf">|</span><span class="vs">docker</span><span class="cf">|</span><span class="vs">git</span><span class="cf">|</span><span class="vs">github</span><span class="cf">|</span><span class="vs">vscode</span><span class="cf">|</span><span class="vs">ide</span><span class="cf">|</span><span class="vs">programa</span><span class="cf">|</span><span class="vs">c√≥digo</span><span class="cf">|</span><span class="vs">fun√ß√£o</span><span class="cf">|</span><span class="vs">classe</span><span class="cf">|</span><span class="vs">api</span><span class="cf">|</span><span class="vs">selenium</span><span class="cf">|</span><span class="vs">playwright</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb30-983"><a href="#cb30-983" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Sistemas&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">windows</span><span class="cf">|</span><span class="vs">linux</span><span class="cf">|</span><span class="vs">macos</span><span class="cf">|</span><span class="vs">so</span><span class="cf">|</span><span class="vs">sistema operacional</span><span class="cf">|</span><span class="vs">driver</span><span class="cf">|</span><span class="vs">registry</span><span class="cf">|</span><span class="vs">process</span><span class="cf">|</span><span class="vs">firewall</span><span class="cf">|</span><span class="vs">bios</span><span class="cf">|</span><span class="vs">boot</span><span class="cf">|</span><span class="vs">path</span><span class="cf">|</span><span class="vs">dll</span><span class="cf">|</span><span class="vs">exe</span><span class="cf">|</span><span class="vs">powershell</span><span class="cf">|</span><span class="vs">cmd</span><span class="cf">|</span><span class="vs">terminal</span><span class="cf">|</span><span class="vs">shell</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb30-984"><a href="#cb30-984" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;IA&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">ia</span><span class="cf">|</span><span class="vs">gpt</span><span class="cf">|</span><span class="vs">chatgpt</span><span class="cf">|</span><span class="vs">grok</span><span class="cf">|</span><span class="vs">qwen</span><span class="cf">|</span><span class="vs">deepseek</span><span class="cf">|</span><span class="vs">llm</span><span class="cf">|</span><span class="vs">modelo</span><span class="cf">|</span><span class="vs">prompt</span><span class="cf">|</span><span class="vs">token</span><span class="cf">|</span><span class="vs">embedding</span><span class="cf">|</span><span class="vs">fine-tune</span><span class="cf">|</span><span class="vs">neural</span><span class="cf">|</span><span class="vs">chatbot</span><span class="cf">|</span><span class="vs">intelig√™ncia artificial</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb30-985"><a href="#cb30-985" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Dados&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">dados</span><span class="cf">|</span><span class="vs">data</span><span class="cf">|</span><span class="vs">csv</span><span class="cf">|</span><span class="vs">json</span><span class="cf">|</span><span class="vs">pandas</span><span class="cf">|</span><span class="vs">numpy</span><span class="cf">|</span><span class="vs">excel</span><span class="cf">|</span><span class="vs">sql</span><span class="cf">|</span><span class="vs">banco</span><span class="cf">|</span><span class="vs">sqlite</span><span class="cf">|</span><span class="vs">postgres</span><span class="cf">|</span><span class="vs">visualiza√ß√£o</span><span class="cf">|</span><span class="vs">gr√°fico</span><span class="cf">|</span><span class="vs">tabela</span><span class="cf">|</span><span class="vs">an√°lise</span><span class="cf">|</span><span class="vs">etl</span><span class="cf">|</span><span class="vs">dashboard</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb30-986"><a href="#cb30-986" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Geral&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">geral</span><span class="cf">|</span><span class="vs">pergunta</span><span class="cf">|</span><span class="vs">ajuda</span><span class="cf">|</span><span class="vs">como fazer</span><span class="cf">|</span><span class="vs">explicar</span><span class="cf">|</span><span class="vs">resumo</span><span class="cf">|</span><span class="vs">tutorial b√°sico</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span></span>
<span id="cb30-987"><a href="#cb30-987" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb30-988"><a href="#cb30-988" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-989"><a href="#cb30-989" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category, pattern <span class="kw">in</span> patterns.items():</span>
<span id="cb30-990"><a href="#cb30-990" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> re.search(pattern, text, re.IGNORECASE):</span>
<span id="cb30-991"><a href="#cb30-991" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> category</span>
<span id="cb30-992"><a href="#cb30-992" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-993"><a href="#cb30-993" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Outros&#39;</span></span>
<span id="cb30-994"><a href="#cb30-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-995"><a href="#cb30-995" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_timestamp_for_sorting(<span class="va">self</span>, timestamp) <span class="op">-&gt;</span> datetime:</span>
<span id="cb30-996"><a href="#cb30-996" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> timestamp:</span>
<span id="cb30-997"><a href="#cb30-997" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> datetime.<span class="bu">min</span></span>
<span id="cb30-998"><a href="#cb30-998" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-999"><a href="#cb30-999" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb30-1000"><a href="#cb30-1000" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(timestamp, <span class="bu">str</span>):</span>
<span id="cb30-1001"><a href="#cb30-1001" aria-hidden="true" tabindex="-1"></a>                clean_ts <span class="op">=</span> timestamp.replace(<span class="st">&#39;T&#39;</span>, <span class="st">&#39; &#39;</span>).split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>].split(<span class="st">&#39;+&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb30-1002"><a href="#cb30-1002" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> clean_ts.endswith(<span class="st">&#39;Z&#39;</span>):</span>
<span id="cb30-1003"><a href="#cb30-1003" aria-hidden="true" tabindex="-1"></a>                    clean_ts <span class="op">=</span> clean_ts[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb30-1004"><a href="#cb30-1004" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> datetime.fromisoformat(clean_ts)</span>
<span id="cb30-1005"><a href="#cb30-1005" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(timestamp, (<span class="bu">int</span>, <span class="bu">float</span>)):</span>
<span id="cb30-1006"><a href="#cb30-1006" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> datetime.fromtimestamp(timestamp)</span>
<span id="cb30-1007"><a href="#cb30-1007" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb30-1008"><a href="#cb30-1008" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb30-1009"><a href="#cb30-1009" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1010"><a href="#cb30-1010" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> datetime.<span class="bu">min</span></span>
<span id="cb30-1011"><a href="#cb30-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1012"><a href="#cb30-1012" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> format_timestamp(<span class="va">self</span>, timestamp) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb30-1013"><a href="#cb30-1013" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> timestamp:</span>
<span id="cb30-1014"><a href="#cb30-1014" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb30-1015"><a href="#cb30-1015" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1016"><a href="#cb30-1016" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb30-1017"><a href="#cb30-1017" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(timestamp, (<span class="bu">int</span>, <span class="bu">float</span>)):</span>
<span id="cb30-1018"><a href="#cb30-1018" aria-hidden="true" tabindex="-1"></a>                dt <span class="op">=</span> datetime.fromtimestamp(timestamp)</span>
<span id="cb30-1019"><a href="#cb30-1019" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> dt.strftime(<span class="st">&#39;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S&#39;</span>)</span>
<span id="cb30-1020"><a href="#cb30-1020" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(timestamp, <span class="bu">str</span>):</span>
<span id="cb30-1021"><a href="#cb30-1021" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">&#39;T&#39;</span> <span class="kw">in</span> timestamp:</span>
<span id="cb30-1022"><a href="#cb30-1022" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> timestamp.replace(<span class="st">&#39;T&#39;</span>, <span class="st">&#39; &#39;</span>).split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb30-1023"><a href="#cb30-1023" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> timestamp</span>
<span id="cb30-1024"><a href="#cb30-1024" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb30-1025"><a href="#cb30-1025" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb30-1026"><a href="#cb30-1026" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1027"><a href="#cb30-1027" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">str</span>(timestamp)</span>
<span id="cb30-1028"><a href="#cb30-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1029"><a href="#cb30-1029" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_enhanced_markdown_content(<span class="va">self</span>, conversation: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb30-1030"><a href="#cb30-1030" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Gera conte√∫do Markdown com preserva√ß√£o total de formata√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb30-1031"><a href="#cb30-1031" aria-hidden="true" tabindex="-1"></a>        lines <span class="op">=</span> [</span>
<span id="cb30-1032"><a href="#cb30-1032" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;# </span><span class="sc">{</span>conversation[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb30-1033"><a href="#cb30-1033" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb30-1034"><a href="#cb30-1034" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;## üìä Informa√ß√µes&quot;</span>,</span>
<span id="cb30-1035"><a href="#cb30-1035" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **N√∫mero:** #</span><span class="sc">{</span>conversation[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb30-1036"><a href="#cb30-1036" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Origem:** </span><span class="sc">{</span>conversation[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb30-1037"><a href="#cb30-1037" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Categoria:** </span><span class="sc">{</span>conversation[<span class="st">&#39;category&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb30-1038"><a href="#cb30-1038" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **ID:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;id&#39;</span>, <span class="st">&#39;N/A&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb30-1039"><a href="#cb30-1039" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Criada em:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> conversation<span class="sc">.</span>get(<span class="st">&#39;created_at&#39;</span>) <span class="kw">or</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb30-1040"><a href="#cb30-1040" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb30-1041"><a href="#cb30-1041" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-1042"><a href="#cb30-1042" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> conversation.get(<span class="st">&#39;updated_at&#39;</span>):</span>
<span id="cb30-1043"><a href="#cb30-1043" aria-hidden="true" tabindex="-1"></a>            lines.append(<span class="ss">f&quot;- **Atualizada em:** </span><span class="sc">{</span>conversation[<span class="st">&#39;updated_at&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1044"><a href="#cb30-1044" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1045"><a href="#cb30-1045" aria-hidden="true" tabindex="-1"></a>        lines.extend([</span>
<span id="cb30-1046"><a href="#cb30-1046" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Total de mensagens:** </span><span class="sc">{</span><span class="bu">len</span>(conversation[<span class="st">&#39;messages&#39;</span>])<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb30-1047"><a href="#cb30-1047" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Resumo:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;Sem resumo&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb30-1048"><a href="#cb30-1048" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb30-1049"><a href="#cb30-1049" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;---&quot;</span>,</span>
<span id="cb30-1050"><a href="#cb30-1050" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb30-1051"><a href="#cb30-1051" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;## üí¨ Conversa&quot;</span>,</span>
<span id="cb30-1052"><a href="#cb30-1052" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span></span>
<span id="cb30-1053"><a href="#cb30-1053" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb30-1054"><a href="#cb30-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1055"><a href="#cb30-1055" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, msg <span class="kw">in</span> <span class="bu">enumerate</span>(conversation[<span class="st">&#39;messages&#39;</span>], <span class="dv">1</span>):</span>
<span id="cb30-1056"><a href="#cb30-1056" aria-hidden="true" tabindex="-1"></a>            timestamp <span class="op">=</span> <span class="ss">f&quot; *(</span><span class="sc">{</span>msg[<span class="st">&#39;timestamp&#39;</span>]<span class="sc">}</span><span class="ss">)*&quot;</span> <span class="cf">if</span> msg[<span class="st">&#39;timestamp&#39;</span>] <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb30-1057"><a href="#cb30-1057" aria-hidden="true" tabindex="-1"></a>            model_info <span class="op">=</span> <span class="ss">f&quot; *[</span><span class="sc">{</span>msg<span class="sc">.</span>get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;&#39;</span>)<span class="sc">}</span><span class="ss">]*&quot;</span> <span class="cf">if</span> msg.get(<span class="st">&#39;model&#39;</span>) <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb30-1058"><a href="#cb30-1058" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1059"><a href="#cb30-1059" aria-hidden="true" tabindex="-1"></a>            preserved_content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(msg[<span class="st">&#39;content&#39;</span>])</span>
<span id="cb30-1060"><a href="#cb30-1060" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1061"><a href="#cb30-1061" aria-hidden="true" tabindex="-1"></a>            lines.extend([</span>
<span id="cb30-1062"><a href="#cb30-1062" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;### </span><span class="sc">{</span>msg[<span class="st">&#39;author&#39;</span>]<span class="sc">}{</span>timestamp<span class="sc">}{</span>model_info<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb30-1063"><a href="#cb30-1063" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;&quot;</span>,</span>
<span id="cb30-1064"><a href="#cb30-1064" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;</span><span class="sc">{</span>preserved_content<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb30-1065"><a href="#cb30-1065" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;&quot;</span></span>
<span id="cb30-1066"><a href="#cb30-1066" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb30-1067"><a href="#cb30-1067" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1068"><a href="#cb30-1068" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> j <span class="op">&lt;</span> <span class="bu">len</span>(conversation[<span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb30-1069"><a href="#cb30-1069" aria-hidden="true" tabindex="-1"></a>                lines.extend([<span class="st">&quot;---&quot;</span>, <span class="st">&quot;&quot;</span>])</span>
<span id="cb30-1070"><a href="#cb30-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1071"><a href="#cb30-1071" aria-hidden="true" tabindex="-1"></a>        lines.extend([</span>
<span id="cb30-1072"><a href="#cb30-1072" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;---&quot;</span>,</span>
<span id="cb30-1073"><a href="#cb30-1073" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb30-1074"><a href="#cb30-1074" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;*Conversa exportada do </span><span class="sc">{</span>conversation[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">*&quot;</span>,</span>
<span id="cb30-1075"><a href="#cb30-1075" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;*Processado em: </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">.</span>strftime(<span class="st">&#39;</span><span class="sc">%d</span><span class="st">/%m/%Y %H:%M&#39;</span>)<span class="sc">}</span><span class="ss">*&quot;</span></span>
<span id="cb30-1076"><a href="#cb30-1076" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb30-1077"><a href="#cb30-1077" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-1078"><a href="#cb30-1078" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(lines)</span>
<span id="cb30-1079"><a href="#cb30-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1080"><a href="#cb30-1080" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_qwen_enhanced(<span class="va">self</span>, path: Path):</span>
<span id="cb30-1081"><a href="#cb30-1081" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa Qwen3 com preserva√ß√£o total de conte√∫do&quot;&quot;&quot;</span></span>
<span id="cb30-1082"><a href="#cb30-1082" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb30-1083"><a href="#cb30-1083" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria Qwen3: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1084"><a href="#cb30-1084" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb30-1085"><a href="#cb30-1085" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1086"><a href="#cb30-1086" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb30-1087"><a href="#cb30-1087" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb30-1088"><a href="#cb30-1088" aria-hidden="true" tabindex="-1"></a>                raw <span class="op">=</span> json.load(f)</span>
<span id="cb30-1089"><a href="#cb30-1089" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1090"><a href="#cb30-1090" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> raw.get(<span class="st">&#39;data&#39;</span>, [])</span>
<span id="cb30-1091"><a href="#cb30-1091" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">list</span>):</span>
<span id="cb30-1092"><a href="#cb30-1092" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  Qwen3: &#39;data&#39; n√£o √© uma lista.&quot;</span>)</span>
<span id="cb30-1093"><a href="#cb30-1093" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb30-1094"><a href="#cb30-1094" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1095"><a href="#cb30-1095" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Qwen3: encontradas </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb30-1096"><a href="#cb30-1096" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-1097"><a href="#cb30-1097" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1098"><a href="#cb30-1098" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb30-1099"><a href="#cb30-1099" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa Qwen </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb30-1100"><a href="#cb30-1100" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb30-1101"><a href="#cb30-1101" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb30-1102"><a href="#cb30-1102" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1103"><a href="#cb30-1103" aria-hidden="true" tabindex="-1"></a>                history <span class="op">=</span> conv.get(<span class="st">&#39;chat&#39;</span>, {}).get(<span class="st">&#39;history&#39;</span>, {})</span>
<span id="cb30-1104"><a href="#cb30-1104" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb30-1105"><a href="#cb30-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1106"><a href="#cb30-1106" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> history:</span>
<span id="cb30-1107"><a href="#cb30-1107" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb30-1108"><a href="#cb30-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1109"><a href="#cb30-1109" aria-hidden="true" tabindex="-1"></a>                messages_dict <span class="op">=</span> history.get(<span class="st">&#39;messages&#39;</span>, {})</span>
<span id="cb30-1110"><a href="#cb30-1110" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1111"><a href="#cb30-1111" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(messages_dict, <span class="bu">dict</span>):</span>
<span id="cb30-1112"><a href="#cb30-1112" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb30-1113"><a href="#cb30-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1114"><a href="#cb30-1114" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìù Conversa </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: &#39;</span><span class="sc">{</span>clean_title<span class="sc">}</span><span class="ss">&#39; - </span><span class="sc">{</span><span class="bu">len</span>(messages_dict)<span class="sc">}</span><span class="ss"> mensagens&quot;</span>)</span>
<span id="cb30-1115"><a href="#cb30-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1116"><a href="#cb30-1116" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> message_id, message_data <span class="kw">in</span> messages_dict.items():</span>
<span id="cb30-1117"><a href="#cb30-1117" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(message_data, <span class="bu">dict</span>):</span>
<span id="cb30-1118"><a href="#cb30-1118" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb30-1119"><a href="#cb30-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1120"><a href="#cb30-1120" aria-hidden="true" tabindex="-1"></a>                    role <span class="op">=</span> message_data.get(<span class="st">&#39;role&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb30-1121"><a href="#cb30-1121" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> message_data.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb30-1122"><a href="#cb30-1122" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb30-1123"><a href="#cb30-1123" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content <span class="kw">or</span> <span class="kw">not</span> role:</span>
<span id="cb30-1124"><a href="#cb30-1124" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb30-1125"><a href="#cb30-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1126"><a href="#cb30-1126" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> role <span class="op">==</span> <span class="st">&#39;user&#39;</span>:</span>
<span id="cb30-1127"><a href="#cb30-1127" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb30-1128"><a href="#cb30-1128" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> role <span class="op">==</span> <span class="st">&#39;assistant&#39;</span>:</span>
<span id="cb30-1129"><a href="#cb30-1129" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ Qwen3&quot;</span></span>
<span id="cb30-1130"><a href="#cb30-1130" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb30-1131"><a href="#cb30-1131" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb30-1132"><a href="#cb30-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1133"><a href="#cb30-1133" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(content, <span class="bu">list</span>):</span>
<span id="cb30-1134"><a href="#cb30-1134" aria-hidden="true" tabindex="-1"></a>                        text_parts <span class="op">=</span> []</span>
<span id="cb30-1135"><a href="#cb30-1135" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">for</span> block <span class="kw">in</span> content:</span>
<span id="cb30-1136"><a href="#cb30-1136" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> <span class="bu">isinstance</span>(block, <span class="bu">dict</span>):</span>
<span id="cb30-1137"><a href="#cb30-1137" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> block.get(<span class="st">&#39;type&#39;</span>) <span class="op">==</span> <span class="st">&#39;text&#39;</span>:</span>
<span id="cb30-1138"><a href="#cb30-1138" aria-hidden="true" tabindex="-1"></a>                                    text_parts.append(block.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>))</span>
<span id="cb30-1139"><a href="#cb30-1139" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">elif</span> block.get(<span class="st">&#39;type&#39;</span>) <span class="op">==</span> <span class="st">&#39;image&#39;</span>:</span>
<span id="cb30-1140"><a href="#cb30-1140" aria-hidden="true" tabindex="-1"></a>                                    image_info <span class="op">=</span> block.get(<span class="st">&#39;image&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb30-1141"><a href="#cb30-1141" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">if</span> image_info:</span>
<span id="cb30-1142"><a href="#cb30-1142" aria-hidden="true" tabindex="-1"></a>                                        text_parts.append(<span class="ss">f&quot;![Imagem](</span><span class="sc">{</span>image_info<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb30-1143"><a href="#cb30-1143" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">elif</span> <span class="bu">isinstance</span>(block, <span class="bu">str</span>):</span>
<span id="cb30-1144"><a href="#cb30-1144" aria-hidden="true" tabindex="-1"></a>                                text_parts.append(block)</span>
<span id="cb30-1145"><a href="#cb30-1145" aria-hidden="true" tabindex="-1"></a>                        final_content <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(text_parts).strip()</span>
<span id="cb30-1146"><a href="#cb30-1146" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb30-1147"><a href="#cb30-1147" aria-hidden="true" tabindex="-1"></a>                        final_content <span class="op">=</span> <span class="bu">str</span>(content).strip()</span>
<span id="cb30-1148"><a href="#cb30-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1149"><a href="#cb30-1149" aria-hidden="true" tabindex="-1"></a>                    final_content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(final_content)</span>
<span id="cb30-1150"><a href="#cb30-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1151"><a href="#cb30-1151" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> final_content <span class="kw">or</span> final_content <span class="op">==</span> <span class="st">&#39;null&#39;</span>:</span>
<span id="cb30-1152"><a href="#cb30-1152" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb30-1153"><a href="#cb30-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1154"><a href="#cb30-1154" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb30-1155"><a href="#cb30-1155" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb30-1156"><a href="#cb30-1156" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb30-1157"><a href="#cb30-1157" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: final_content,</span>
<span id="cb30-1158"><a href="#cb30-1158" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(message_data.get(<span class="st">&#39;created_at&#39;</span>)),</span>
<span id="cb30-1159"><a href="#cb30-1159" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: message_data.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;Qwen3&#39;</span>)</span>
<span id="cb30-1160"><a href="#cb30-1160" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb30-1161"><a href="#cb30-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1162"><a href="#cb30-1162" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb30-1163"><a href="#cb30-1163" aria-hidden="true" tabindex="-1"></a>                    messages.sort(key<span class="op">=</span><span class="kw">lambda</span> x: <span class="va">self</span>.parse_timestamp_for_sorting(x[<span class="st">&#39;timestamp&#39;</span>]))</span>
<span id="cb30-1164"><a href="#cb30-1164" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb30-1165"><a href="#cb30-1165" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb30-1166"><a href="#cb30-1166" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb30-1167"><a href="#cb30-1167" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;Qwen3&#39;</span>,</span>
<span id="cb30-1168"><a href="#cb30-1168" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;qwen_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb30-1169"><a href="#cb30-1169" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;created_at&#39;</span>)),</span>
<span id="cb30-1170"><a href="#cb30-1170" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;updated_at&#39;</span>)),</span>
<span id="cb30-1171"><a href="#cb30-1171" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb30-1172"><a href="#cb30-1172" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb30-1173"><a href="#cb30-1173" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb30-1174"><a href="#cb30-1174" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb30-1175"><a href="#cb30-1175" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb30-1176"><a href="#cb30-1176" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;   ‚úÖ Adicionada: </span><span class="sc">{</span><span class="bu">len</span>(messages)<span class="sc">}</span><span class="ss"> mensagens&quot;</span>)</span>
<span id="cb30-1177"><a href="#cb30-1177" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb30-1178"><a href="#cb30-1178" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Qwen3: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb30-1179"><a href="#cb30-1179" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1180"><a href="#cb30-1180" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb30-1181"><a href="#cb30-1181" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar Qwen3: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1182"><a href="#cb30-1182" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb30-1183"><a href="#cb30-1183" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb30-1184"><a href="#cb30-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1185"><a href="#cb30-1185" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_chatgpt(<span class="va">self</span>, path: Path):</span>
<span id="cb30-1186"><a href="#cb30-1186" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do ChatGPT&quot;&quot;&quot;</span></span>
<span id="cb30-1187"><a href="#cb30-1187" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb30-1188"><a href="#cb30-1188" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria ChatGPT: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1189"><a href="#cb30-1189" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb30-1190"><a href="#cb30-1190" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1191"><a href="#cb30-1191" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb30-1192"><a href="#cb30-1192" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;chatgpt_&quot;</span>)</span>
<span id="cb30-1193"><a href="#cb30-1193" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb30-1194"><a href="#cb30-1194" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb30-1195"><a href="#cb30-1195" aria-hidden="true" tabindex="-1"></a>            convs_path <span class="op">=</span> Path(temp_dir) <span class="op">/</span> <span class="st">&quot;conversations.json&quot;</span></span>
<span id="cb30-1196"><a href="#cb30-1196" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> convs_path.exists():</span>
<span id="cb30-1197"><a href="#cb30-1197" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå ChatGPT: conversations.json n√£o encontrado.&quot;</span>)</span>
<span id="cb30-1198"><a href="#cb30-1198" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb30-1199"><a href="#cb30-1199" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1200"><a href="#cb30-1200" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(convs_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb30-1201"><a href="#cb30-1201" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.load(f)</span>
<span id="cb30-1202"><a href="#cb30-1202" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1203"><a href="#cb30-1203" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">list</span>):</span>
<span id="cb30-1204"><a href="#cb30-1204" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  ChatGPT: estrutura inesperada.&quot;</span>)</span>
<span id="cb30-1205"><a href="#cb30-1205" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb30-1206"><a href="#cb30-1206" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1207"><a href="#cb30-1207" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç ChatGPT: encontradas </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb30-1208"><a href="#cb30-1208" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-1209"><a href="#cb30-1209" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1210"><a href="#cb30-1210" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb30-1211"><a href="#cb30-1211" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa ChatGPT </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb30-1212"><a href="#cb30-1212" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb30-1213"><a href="#cb30-1213" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb30-1214"><a href="#cb30-1214" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1215"><a href="#cb30-1215" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb30-1216"><a href="#cb30-1216" aria-hidden="true" tabindex="-1"></a>                mapping <span class="op">=</span> conv.get(<span class="st">&#39;mapping&#39;</span>, {})</span>
<span id="cb30-1217"><a href="#cb30-1217" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1218"><a href="#cb30-1218" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> msg_id, node <span class="kw">in</span> mapping.items():</span>
<span id="cb30-1219"><a href="#cb30-1219" aria-hidden="true" tabindex="-1"></a>                    msg_data <span class="op">=</span> node.get(<span class="st">&#39;message&#39;</span>)</span>
<span id="cb30-1220"><a href="#cb30-1220" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> msg_data <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(msg_data, <span class="bu">dict</span>):</span>
<span id="cb30-1221"><a href="#cb30-1221" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb30-1222"><a href="#cb30-1222" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb30-1223"><a href="#cb30-1223" aria-hidden="true" tabindex="-1"></a>                    author_role <span class="op">=</span> msg_data.get(<span class="st">&#39;author&#39;</span>, {}).get(<span class="st">&#39;role&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb30-1224"><a href="#cb30-1224" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> author_role <span class="op">==</span> <span class="st">&#39;user&#39;</span>:</span>
<span id="cb30-1225"><a href="#cb30-1225" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb30-1226"><a href="#cb30-1226" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;user&#39;</span></span>
<span id="cb30-1227"><a href="#cb30-1227" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> author_role <span class="op">==</span> <span class="st">&#39;assistant&#39;</span>:</span>
<span id="cb30-1228"><a href="#cb30-1228" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ ChatGPT&quot;</span></span>
<span id="cb30-1229"><a href="#cb30-1229" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;assistant&#39;</span></span>
<span id="cb30-1230"><a href="#cb30-1230" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb30-1231"><a href="#cb30-1231" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb30-1232"><a href="#cb30-1232" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb30-1233"><a href="#cb30-1233" aria-hidden="true" tabindex="-1"></a>                    content_parts <span class="op">=</span> []</span>
<span id="cb30-1234"><a href="#cb30-1234" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> part <span class="kw">in</span> msg_data.get(<span class="st">&#39;content&#39;</span>, {}).get(<span class="st">&#39;parts&#39;</span>, []):</span>
<span id="cb30-1235"><a href="#cb30-1235" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(part, <span class="bu">str</span>):</span>
<span id="cb30-1236"><a href="#cb30-1236" aria-hidden="true" tabindex="-1"></a>                            content_parts.append(part)</span>
<span id="cb30-1237"><a href="#cb30-1237" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(content_parts).strip()</span>
<span id="cb30-1238"><a href="#cb30-1238" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb30-1239"><a href="#cb30-1239" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb30-1240"><a href="#cb30-1240" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb30-1241"><a href="#cb30-1241" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb30-1242"><a href="#cb30-1242" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb30-1243"><a href="#cb30-1243" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb30-1244"><a href="#cb30-1244" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb30-1245"><a href="#cb30-1245" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb30-1246"><a href="#cb30-1246" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb30-1247"><a href="#cb30-1247" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb30-1248"><a href="#cb30-1248" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(msg_data.get(<span class="st">&#39;create_time&#39;</span>)),</span>
<span id="cb30-1249"><a href="#cb30-1249" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg_data.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;ChatGPT&#39;</span>)</span>
<span id="cb30-1250"><a href="#cb30-1250" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb30-1251"><a href="#cb30-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1252"><a href="#cb30-1252" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb30-1253"><a href="#cb30-1253" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb30-1254"><a href="#cb30-1254" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb30-1255"><a href="#cb30-1255" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;ChatGPT&#39;</span>,</span>
<span id="cb30-1256"><a href="#cb30-1256" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;chatgpt_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb30-1257"><a href="#cb30-1257" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;create_time&#39;</span>)),</span>
<span id="cb30-1258"><a href="#cb30-1258" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;update_time&#39;</span>)),</span>
<span id="cb30-1259"><a href="#cb30-1259" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb30-1260"><a href="#cb30-1260" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb30-1261"><a href="#cb30-1261" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb30-1262"><a href="#cb30-1262" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb30-1263"><a href="#cb30-1263" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb30-1264"><a href="#cb30-1264" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb30-1265"><a href="#cb30-1265" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ ChatGPT: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb30-1266"><a href="#cb30-1266" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1267"><a href="#cb30-1267" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb30-1268"><a href="#cb30-1268" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar ChatGPT: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1269"><a href="#cb30-1269" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb30-1270"><a href="#cb30-1270" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb30-1271"><a href="#cb30-1271" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb30-1272"><a href="#cb30-1272" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb30-1273"><a href="#cb30-1273" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-1274"><a href="#cb30-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1275"><a href="#cb30-1275" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_deepseek(<span class="va">self</span>, path: Path):</span>
<span id="cb30-1276"><a href="#cb30-1276" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do DeepSeek&quot;&quot;&quot;</span></span>
<span id="cb30-1277"><a href="#cb30-1277" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb30-1278"><a href="#cb30-1278" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria DeepSeek: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1279"><a href="#cb30-1279" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb30-1280"><a href="#cb30-1280" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1281"><a href="#cb30-1281" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb30-1282"><a href="#cb30-1282" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;deepseek_&quot;</span>)</span>
<span id="cb30-1283"><a href="#cb30-1283" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb30-1284"><a href="#cb30-1284" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb30-1285"><a href="#cb30-1285" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1286"><a href="#cb30-1286" aria-hidden="true" tabindex="-1"></a>            convs_path <span class="op">=</span> Path(temp_dir) <span class="op">/</span> <span class="st">&quot;conversations.json&quot;</span></span>
<span id="cb30-1287"><a href="#cb30-1287" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> convs_path.exists():</span>
<span id="cb30-1288"><a href="#cb30-1288" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå DeepSeek: conversations.json n√£o encontrado.&quot;</span>)</span>
<span id="cb30-1289"><a href="#cb30-1289" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb30-1290"><a href="#cb30-1290" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1291"><a href="#cb30-1291" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(convs_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb30-1292"><a href="#cb30-1292" aria-hidden="true" tabindex="-1"></a>                raw_data <span class="op">=</span> json.load(f)</span>
<span id="cb30-1293"><a href="#cb30-1293" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1294"><a href="#cb30-1294" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">list</span>):</span>
<span id="cb30-1295"><a href="#cb30-1295" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> raw_data</span>
<span id="cb30-1296"><a href="#cb30-1296" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;data&#39;</span> <span class="kw">in</span> raw_data:</span>
<span id="cb30-1297"><a href="#cb30-1297" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> raw_data[<span class="st">&#39;data&#39;</span>]</span>
<span id="cb30-1298"><a href="#cb30-1298" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb30-1299"><a href="#cb30-1299" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  DeepSeek: estrutura inesperada.&quot;</span>)</span>
<span id="cb30-1300"><a href="#cb30-1300" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb30-1301"><a href="#cb30-1301" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1302"><a href="#cb30-1302" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">list</span>):</span>
<span id="cb30-1303"><a href="#cb30-1303" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  DeepSeek: &#39;data&#39; n√£o √© uma lista.&quot;</span>)</span>
<span id="cb30-1304"><a href="#cb30-1304" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb30-1305"><a href="#cb30-1305" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1306"><a href="#cb30-1306" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç DeepSeek: encontradas </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb30-1307"><a href="#cb30-1307" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-1308"><a href="#cb30-1308" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1309"><a href="#cb30-1309" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb30-1310"><a href="#cb30-1310" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa DeepSeek </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb30-1311"><a href="#cb30-1311" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb30-1312"><a href="#cb30-1312" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb30-1313"><a href="#cb30-1313" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1314"><a href="#cb30-1314" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb30-1315"><a href="#cb30-1315" aria-hidden="true" tabindex="-1"></a>                mapping <span class="op">=</span> conv.get(<span class="st">&#39;mapping&#39;</span>, {})</span>
<span id="cb30-1316"><a href="#cb30-1316" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1317"><a href="#cb30-1317" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> node_id, node <span class="kw">in</span> mapping.items():</span>
<span id="cb30-1318"><a href="#cb30-1318" aria-hidden="true" tabindex="-1"></a>                    msg_data <span class="op">=</span> node.get(<span class="st">&#39;message&#39;</span>)</span>
<span id="cb30-1319"><a href="#cb30-1319" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> msg_data <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(msg_data, <span class="bu">dict</span>):</span>
<span id="cb30-1320"><a href="#cb30-1320" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb30-1321"><a href="#cb30-1321" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb30-1322"><a href="#cb30-1322" aria-hidden="true" tabindex="-1"></a>                    fragments <span class="op">=</span> msg_data.get(<span class="st">&#39;fragments&#39;</span>, [])</span>
<span id="cb30-1323"><a href="#cb30-1323" aria-hidden="true" tabindex="-1"></a>                    content_parts <span class="op">=</span> []</span>
<span id="cb30-1324"><a href="#cb30-1324" aria-hidden="true" tabindex="-1"></a>                    msg_type <span class="op">=</span> <span class="va">None</span></span>
<span id="cb30-1325"><a href="#cb30-1325" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb30-1326"><a href="#cb30-1326" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> frag <span class="kw">in</span> fragments:</span>
<span id="cb30-1327"><a href="#cb30-1327" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(frag, <span class="bu">dict</span>):</span>
<span id="cb30-1328"><a href="#cb30-1328" aria-hidden="true" tabindex="-1"></a>                            frag_type <span class="op">=</span> frag.get(<span class="st">&#39;type&#39;</span>, <span class="st">&#39;&#39;</span>).upper()</span>
<span id="cb30-1329"><a href="#cb30-1329" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> frag_type <span class="kw">in</span> (<span class="st">&#39;REQUEST&#39;</span>, <span class="st">&#39;RESPONSE&#39;</span>):</span>
<span id="cb30-1330"><a href="#cb30-1330" aria-hidden="true" tabindex="-1"></a>                                msg_type <span class="op">=</span> frag_type</span>
<span id="cb30-1331"><a href="#cb30-1331" aria-hidden="true" tabindex="-1"></a>                            text <span class="op">=</span> frag.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb30-1332"><a href="#cb30-1332" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> text:</span>
<span id="cb30-1333"><a href="#cb30-1333" aria-hidden="true" tabindex="-1"></a>                                content_parts.append(text)</span>
<span id="cb30-1334"><a href="#cb30-1334" aria-hidden="true" tabindex="-1"></a>                            content <span class="op">=</span> frag.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb30-1335"><a href="#cb30-1335" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> content:</span>
<span id="cb30-1336"><a href="#cb30-1336" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> <span class="bu">isinstance</span>(content, <span class="bu">list</span>):</span>
<span id="cb30-1337"><a href="#cb30-1337" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">for</span> item <span class="kw">in</span> content:</span>
<span id="cb30-1338"><a href="#cb30-1338" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">if</span> <span class="bu">isinstance</span>(item, <span class="bu">str</span>):</span>
<span id="cb30-1339"><a href="#cb30-1339" aria-hidden="true" tabindex="-1"></a>                                            content_parts.append(item)</span>
<span id="cb30-1340"><a href="#cb30-1340" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">elif</span> <span class="bu">isinstance</span>(item, <span class="bu">dict</span>):</span>
<span id="cb30-1341"><a href="#cb30-1341" aria-hidden="true" tabindex="-1"></a>                                            item_text <span class="op">=</span> item.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb30-1342"><a href="#cb30-1342" aria-hidden="true" tabindex="-1"></a>                                            <span class="cf">if</span> item_text:</span>
<span id="cb30-1343"><a href="#cb30-1343" aria-hidden="true" tabindex="-1"></a>                                                content_parts.append(<span class="bu">str</span>(item_text))</span>
<span id="cb30-1344"><a href="#cb30-1344" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">else</span>:</span>
<span id="cb30-1345"><a href="#cb30-1345" aria-hidden="true" tabindex="-1"></a>                                    content_parts.append(<span class="bu">str</span>(content))</span>
<span id="cb30-1346"><a href="#cb30-1346" aria-hidden="true" tabindex="-1"></a>                                    </span>
<span id="cb30-1347"><a href="#cb30-1347" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="st">&#39; &#39;</span>.join(content_parts).strip()</span>
<span id="cb30-1348"><a href="#cb30-1348" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb30-1349"><a href="#cb30-1349" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb30-1350"><a href="#cb30-1350" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb30-1351"><a href="#cb30-1351" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb30-1352"><a href="#cb30-1352" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb30-1353"><a href="#cb30-1353" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb30-1354"><a href="#cb30-1354" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> msg_type <span class="op">==</span> <span class="st">&#39;REQUEST&#39;</span>:</span>
<span id="cb30-1355"><a href="#cb30-1355" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb30-1356"><a href="#cb30-1356" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;user&#39;</span></span>
<span id="cb30-1357"><a href="#cb30-1357" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb30-1358"><a href="#cb30-1358" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ DeepSeek&quot;</span></span>
<span id="cb30-1359"><a href="#cb30-1359" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;assistant&#39;</span></span>
<span id="cb30-1360"><a href="#cb30-1360" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb30-1361"><a href="#cb30-1361" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb30-1362"><a href="#cb30-1362" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb30-1363"><a href="#cb30-1363" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb30-1364"><a href="#cb30-1364" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb30-1365"><a href="#cb30-1365" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(msg_data.get(<span class="st">&#39;inserted_at&#39;</span>)),</span>
<span id="cb30-1366"><a href="#cb30-1366" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg_data.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;DeepSeek&#39;</span>)</span>
<span id="cb30-1367"><a href="#cb30-1367" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb30-1368"><a href="#cb30-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1369"><a href="#cb30-1369" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb30-1370"><a href="#cb30-1370" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb30-1371"><a href="#cb30-1371" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb30-1372"><a href="#cb30-1372" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;DeepSeek&#39;</span>,</span>
<span id="cb30-1373"><a href="#cb30-1373" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;deepseek_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb30-1374"><a href="#cb30-1374" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;inserted_at&#39;</span>)),</span>
<span id="cb30-1375"><a href="#cb30-1375" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;updated_at&#39;</span>)),</span>
<span id="cb30-1376"><a href="#cb30-1376" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb30-1377"><a href="#cb30-1377" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb30-1378"><a href="#cb30-1378" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb30-1379"><a href="#cb30-1379" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb30-1380"><a href="#cb30-1380" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb30-1381"><a href="#cb30-1381" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb30-1382"><a href="#cb30-1382" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ DeepSeek: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb30-1383"><a href="#cb30-1383" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1384"><a href="#cb30-1384" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb30-1385"><a href="#cb30-1385" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar DeepSeek: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1386"><a href="#cb30-1386" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb30-1387"><a href="#cb30-1387" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb30-1388"><a href="#cb30-1388" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb30-1389"><a href="#cb30-1389" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb30-1390"><a href="#cb30-1390" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-1391"><a href="#cb30-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1392"><a href="#cb30-1392" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_grok(<span class="va">self</span>, path: Path):</span>
<span id="cb30-1393"><a href="#cb30-1393" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do Grok&quot;&quot;&quot;</span></span>
<span id="cb30-1394"><a href="#cb30-1394" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb30-1395"><a href="#cb30-1395" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria Grok: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1396"><a href="#cb30-1396" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb30-1397"><a href="#cb30-1397" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1398"><a href="#cb30-1398" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb30-1399"><a href="#cb30-1399" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;grok_&quot;</span>)</span>
<span id="cb30-1400"><a href="#cb30-1400" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb30-1401"><a href="#cb30-1401" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb30-1402"><a href="#cb30-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1403"><a href="#cb30-1403" aria-hidden="true" tabindex="-1"></a>            target_file <span class="op">=</span> <span class="va">None</span></span>
<span id="cb30-1404"><a href="#cb30-1404" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> root, _, files <span class="kw">in</span> os.walk(temp_dir):</span>
<span id="cb30-1405"><a href="#cb30-1405" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb30-1406"><a href="#cb30-1406" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">file</span> <span class="op">==</span> <span class="st">&quot;prod-grok-backend.json&quot;</span>:</span>
<span id="cb30-1407"><a href="#cb30-1407" aria-hidden="true" tabindex="-1"></a>                        target_file <span class="op">=</span> Path(root) <span class="op">/</span> <span class="bu">file</span></span>
<span id="cb30-1408"><a href="#cb30-1408" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb30-1409"><a href="#cb30-1409" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> target_file:</span>
<span id="cb30-1410"><a href="#cb30-1410" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb30-1411"><a href="#cb30-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1412"><a href="#cb30-1412" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> target_file:</span>
<span id="cb30-1413"><a href="#cb30-1413" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: ficheiro &#39;prod-grok-backend.json&#39; n√£o encontrado no ZIP.&quot;</span>)</span>
<span id="cb30-1414"><a href="#cb30-1414" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb30-1415"><a href="#cb30-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1416"><a href="#cb30-1416" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Grok: carregando </span><span class="sc">{</span>target_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb30-1417"><a href="#cb30-1417" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(target_file, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb30-1418"><a href="#cb30-1418" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.load(f)</span>
<span id="cb30-1419"><a href="#cb30-1419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1420"><a href="#cb30-1420" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">dict</span>) <span class="kw">or</span> <span class="st">&#39;conversations&#39;</span> <span class="kw">not</span> <span class="kw">in</span> data:</span>
<span id="cb30-1421"><a href="#cb30-1421" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: estrutura inesperada ‚Äî chave &#39;conversations&#39; n√£o encontrada.&quot;</span>)</span>
<span id="cb30-1422"><a href="#cb30-1422" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb30-1423"><a href="#cb30-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1424"><a href="#cb30-1424" aria-hidden="true" tabindex="-1"></a>            conversations_list <span class="op">=</span> data[<span class="st">&#39;conversations&#39;</span>]</span>
<span id="cb30-1425"><a href="#cb30-1425" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conversations_list, <span class="bu">list</span>):</span>
<span id="cb30-1426"><a href="#cb30-1426" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: &#39;conversations&#39; n√£o √© uma lista.&quot;</span>)</span>
<span id="cb30-1427"><a href="#cb30-1427" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb30-1428"><a href="#cb30-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1429"><a href="#cb30-1429" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä Grok: encontradas </span><span class="sc">{</span><span class="bu">len</span>(conversations_list)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb30-1430"><a href="#cb30-1430" aria-hidden="true" tabindex="-1"></a>            total_convs <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-1431"><a href="#cb30-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1432"><a href="#cb30-1432" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> item <span class="kw">in</span> conversations_list:</span>
<span id="cb30-1433"><a href="#cb30-1433" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(item, <span class="bu">dict</span>):</span>
<span id="cb30-1434"><a href="#cb30-1434" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb30-1435"><a href="#cb30-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1436"><a href="#cb30-1436" aria-hidden="true" tabindex="-1"></a>                conv_meta <span class="op">=</span> item.get(<span class="st">&#39;conversation&#39;</span>)</span>
<span id="cb30-1437"><a href="#cb30-1437" aria-hidden="true" tabindex="-1"></a>                responses <span class="op">=</span> item.get(<span class="st">&#39;responses&#39;</span>, [])</span>
<span id="cb30-1438"><a href="#cb30-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1439"><a href="#cb30-1439" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conv_meta, <span class="bu">dict</span>) <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(responses, <span class="bu">list</span>) <span class="kw">or</span> <span class="kw">not</span> responses:</span>
<span id="cb30-1440"><a href="#cb30-1440" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb30-1441"><a href="#cb30-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1442"><a href="#cb30-1442" aria-hidden="true" tabindex="-1"></a>                conv_id <span class="op">=</span> conv_meta.get(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb30-1443"><a href="#cb30-1443" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> conv_id:</span>
<span id="cb30-1444"><a href="#cb30-1444" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb30-1445"><a href="#cb30-1445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1446"><a href="#cb30-1446" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv_meta.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&quot;Conversa Grok </span><span class="sc">{</span>total_convs <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1447"><a href="#cb30-1447" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb30-1448"><a href="#cb30-1448" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb30-1449"><a href="#cb30-1449" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1450"><a href="#cb30-1450" aria-hidden="true" tabindex="-1"></a>                create_time_str <span class="op">=</span> conv_meta.get(<span class="st">&#39;create_time&#39;</span>)</span>
<span id="cb30-1451"><a href="#cb30-1451" aria-hidden="true" tabindex="-1"></a>                modify_time_str <span class="op">=</span> conv_meta.get(<span class="st">&#39;modify_time&#39;</span>)</span>
<span id="cb30-1452"><a href="#cb30-1452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1453"><a href="#cb30-1453" aria-hidden="true" tabindex="-1"></a>                <span class="kw">def</span> format_iso_timestamp(ts_str):</span>
<span id="cb30-1454"><a href="#cb30-1454" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> ts_str:</span>
<span id="cb30-1455"><a href="#cb30-1455" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb30-1456"><a href="#cb30-1456" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">try</span>:</span>
<span id="cb30-1457"><a href="#cb30-1457" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="st">&#39;.&#39;</span> <span class="kw">in</span> ts_str:</span>
<span id="cb30-1458"><a href="#cb30-1458" aria-hidden="true" tabindex="-1"></a>                            ts_str <span class="op">=</span> ts_str.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>] <span class="op">+</span> <span class="st">&#39;Z&#39;</span></span>
<span id="cb30-1459"><a href="#cb30-1459" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="va">self</span>.format_timestamp(ts_str)</span>
<span id="cb30-1460"><a href="#cb30-1460" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">except</span>:</span>
<span id="cb30-1461"><a href="#cb30-1461" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="bu">str</span>(ts_str)</span>
<span id="cb30-1462"><a href="#cb30-1462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1463"><a href="#cb30-1463" aria-hidden="true" tabindex="-1"></a>                inserted_at <span class="op">=</span> format_iso_timestamp(create_time_str)</span>
<span id="cb30-1464"><a href="#cb30-1464" aria-hidden="true" tabindex="-1"></a>                updated_at <span class="op">=</span> format_iso_timestamp(modify_time_str)</span>
<span id="cb30-1465"><a href="#cb30-1465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1466"><a href="#cb30-1466" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb30-1467"><a href="#cb30-1467" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> resp <span class="kw">in</span> responses:</span>
<span id="cb30-1468"><a href="#cb30-1468" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(resp, <span class="bu">dict</span>):</span>
<span id="cb30-1469"><a href="#cb30-1469" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb30-1470"><a href="#cb30-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1471"><a href="#cb30-1471" aria-hidden="true" tabindex="-1"></a>                    resp_data <span class="op">=</span> resp.get(<span class="st">&#39;response&#39;</span>)</span>
<span id="cb30-1472"><a href="#cb30-1472" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(resp_data, <span class="bu">dict</span>):</span>
<span id="cb30-1473"><a href="#cb30-1473" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb30-1474"><a href="#cb30-1474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1475"><a href="#cb30-1475" aria-hidden="true" tabindex="-1"></a>                    sender <span class="op">=</span> resp_data.get(<span class="st">&#39;sender&#39;</span>, <span class="st">&#39;&#39;</span>).upper()</span>
<span id="cb30-1476"><a href="#cb30-1476" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> sender <span class="op">==</span> <span class="st">&#39;HUMAN&#39;</span>:</span>
<span id="cb30-1477"><a href="#cb30-1477" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb30-1478"><a href="#cb30-1478" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&quot;user&quot;</span></span>
<span id="cb30-1479"><a href="#cb30-1479" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> sender <span class="op">==</span> <span class="st">&#39;ASSISTANT&#39;</span>:</span>
<span id="cb30-1480"><a href="#cb30-1480" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ Grok&quot;</span></span>
<span id="cb30-1481"><a href="#cb30-1481" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&quot;assistant&quot;</span></span>
<span id="cb30-1482"><a href="#cb30-1482" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb30-1483"><a href="#cb30-1483" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb30-1484"><a href="#cb30-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1485"><a href="#cb30-1485" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="bu">str</span>(resp_data.get(<span class="st">&#39;message&#39;</span>, <span class="st">&#39;&#39;</span>)).strip()</span>
<span id="cb30-1486"><a href="#cb30-1486" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb30-1487"><a href="#cb30-1487" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb30-1488"><a href="#cb30-1488" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb30-1489"><a href="#cb30-1489" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb30-1490"><a href="#cb30-1490" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb30-1491"><a href="#cb30-1491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1492"><a href="#cb30-1492" aria-hidden="true" tabindex="-1"></a>                    create_time <span class="op">=</span> resp_data.get(<span class="st">&#39;create_time&#39;</span>)</span>
<span id="cb30-1493"><a href="#cb30-1493" aria-hidden="true" tabindex="-1"></a>                    timestamp_ms <span class="op">=</span> <span class="va">None</span></span>
<span id="cb30-1494"><a href="#cb30-1494" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(create_time, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;$date&#39;</span> <span class="kw">in</span> create_time:</span>
<span id="cb30-1495"><a href="#cb30-1495" aria-hidden="true" tabindex="-1"></a>                        date_obj <span class="op">=</span> create_time[<span class="st">&#39;$date&#39;</span>]</span>
<span id="cb30-1496"><a href="#cb30-1496" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(date_obj, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;$numberLong&#39;</span> <span class="kw">in</span> date_obj:</span>
<span id="cb30-1497"><a href="#cb30-1497" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">try</span>:</span>
<span id="cb30-1498"><a href="#cb30-1498" aria-hidden="true" tabindex="-1"></a>                                timestamp_ms <span class="op">=</span> <span class="bu">int</span>(date_obj[<span class="st">&#39;$numberLong&#39;</span>])</span>
<span id="cb30-1499"><a href="#cb30-1499" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">except</span>:</span>
<span id="cb30-1500"><a href="#cb30-1500" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">pass</span></span>
<span id="cb30-1501"><a href="#cb30-1501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1502"><a href="#cb30-1502" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb30-1503"><a href="#cb30-1503" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb30-1504"><a href="#cb30-1504" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb30-1505"><a href="#cb30-1505" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb30-1506"><a href="#cb30-1506" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(timestamp_ms <span class="op">/</span> <span class="fl">1000.0</span> <span class="cf">if</span> timestamp_ms <span class="cf">else</span> <span class="va">None</span>),</span>
<span id="cb30-1507"><a href="#cb30-1507" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: <span class="st">&#39;Grok&#39;</span></span>
<span id="cb30-1508"><a href="#cb30-1508" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb30-1509"><a href="#cb30-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1510"><a href="#cb30-1510" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb30-1511"><a href="#cb30-1511" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb30-1512"><a href="#cb30-1512" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb30-1513"><a href="#cb30-1513" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;Grok&#39;</span>,</span>
<span id="cb30-1514"><a href="#cb30-1514" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv_id,</span>
<span id="cb30-1515"><a href="#cb30-1515" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: inserted_at,</span>
<span id="cb30-1516"><a href="#cb30-1516" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: updated_at,</span>
<span id="cb30-1517"><a href="#cb30-1517" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb30-1518"><a href="#cb30-1518" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb30-1519"><a href="#cb30-1519" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb30-1520"><a href="#cb30-1520" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb30-1521"><a href="#cb30-1521" aria-hidden="true" tabindex="-1"></a>                    total_convs <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb30-1522"><a href="#cb30-1522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1523"><a href="#cb30-1523" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> total_convs <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb30-1524"><a href="#cb30-1524" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Grok: processadas </span><span class="sc">{</span>total_convs<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb30-1525"><a href="#cb30-1525" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb30-1526"><a href="#cb30-1526" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: nenhuma conversa v√°lida encontrada.&quot;</span>)</span>
<span id="cb30-1527"><a href="#cb30-1527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1528"><a href="#cb30-1528" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb30-1529"><a href="#cb30-1529" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar Grok: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1530"><a href="#cb30-1530" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb30-1531"><a href="#cb30-1531" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb30-1532"><a href="#cb30-1532" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb30-1533"><a href="#cb30-1533" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb30-1534"><a href="#cb30-1534" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-1535"><a href="#cb30-1535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1536"><a href="#cb30-1536" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_markdown_enhanced(<span class="va">self</span>):</span>
<span id="cb30-1537"><a href="#cb30-1537" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas com preserva√ß√£o total de formata√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb30-1538"><a href="#cb30-1538" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb30-1539"><a href="#cb30-1539" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] Markdowns seriam criados:&quot;</span>)</span>
<span id="cb30-1540"><a href="#cb30-1540" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb30-1541"><a href="#cb30-1541" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb30-1542"><a href="#cb30-1542" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.md&quot;</span></span>
<span id="cb30-1543"><a href="#cb30-1543" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÑ </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1544"><a href="#cb30-1544" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb30-1545"><a href="#cb30-1545" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1546"><a href="#cb30-1546" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;markdown&#39;</span>])</span>
<span id="cb30-1547"><a href="#cb30-1547" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-1548"><a href="#cb30-1548" aria-hidden="true" tabindex="-1"></a>        failed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-1549"><a href="#cb30-1549" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-1550"><a href="#cb30-1550" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb30-1551"><a href="#cb30-1551" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb30-1552"><a href="#cb30-1552" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb30-1553"><a href="#cb30-1553" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.md&quot;</span></span>
<span id="cb30-1554"><a href="#cb30-1554" aria-hidden="true" tabindex="-1"></a>                filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb30-1555"><a href="#cb30-1555" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1556"><a href="#cb30-1556" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb30-1557"><a href="#cb30-1557" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb30-1558"><a href="#cb30-1558" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb30-1559"><a href="#cb30-1559" aria-hidden="true" tabindex="-1"></a>                markdown_content <span class="op">=</span> <span class="va">self</span>.create_enhanced_markdown_content(conv)</span>
<span id="cb30-1560"><a href="#cb30-1560" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1561"><a href="#cb30-1561" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb30-1562"><a href="#cb30-1562" aria-hidden="true" tabindex="-1"></a>                    f.write(markdown_content)</span>
<span id="cb30-1563"><a href="#cb30-1563" aria-hidden="true" tabindex="-1"></a>                saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb30-1564"><a href="#cb30-1564" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1565"><a href="#cb30-1565" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb30-1566"><a href="#cb30-1566" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao salvar conversa </span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1567"><a href="#cb30-1567" aria-hidden="true" tabindex="-1"></a>                failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb30-1568"><a href="#cb30-1568" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb30-1569"><a href="#cb30-1569" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1570"><a href="#cb30-1570" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Markdown: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados, </span><span class="sc">{</span>failed_count<span class="sc">}</span><span class="ss"> falhas em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb30-1571"><a href="#cb30-1571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1572"><a href="#cb30-1572" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_csv(<span class="va">self</span>):</span>
<span id="cb30-1573"><a href="#cb30-1573" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas em arquivos CSV individuais&quot;&quot;&quot;</span></span>
<span id="cb30-1574"><a href="#cb30-1574" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb30-1575"><a href="#cb30-1575" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] CSVs seriam criados:&quot;</span>)</span>
<span id="cb30-1576"><a href="#cb30-1576" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb30-1577"><a href="#cb30-1577" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb30-1578"><a href="#cb30-1578" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.csv&quot;</span></span>
<span id="cb30-1579"><a href="#cb30-1579" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìä </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1580"><a href="#cb30-1580" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb30-1581"><a href="#cb30-1581" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1582"><a href="#cb30-1582" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;csv&#39;</span>])</span>
<span id="cb30-1583"><a href="#cb30-1583" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-1584"><a href="#cb30-1584" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-1585"><a href="#cb30-1585" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb30-1586"><a href="#cb30-1586" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb30-1587"><a href="#cb30-1587" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.csv&quot;</span></span>
<span id="cb30-1588"><a href="#cb30-1588" aria-hidden="true" tabindex="-1"></a>            filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb30-1589"><a href="#cb30-1589" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1590"><a href="#cb30-1590" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb30-1591"><a href="#cb30-1591" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb30-1592"><a href="#cb30-1592" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1593"><a href="#cb30-1593" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb30-1594"><a href="#cb30-1594" aria-hidden="true" tabindex="-1"></a>                writer <span class="op">=</span> csv.DictWriter(f, fieldnames<span class="op">=</span>[</span>
<span id="cb30-1595"><a href="#cb30-1595" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;node_id&#39;</span>, <span class="st">&#39;author&#39;</span>, <span class="st">&#39;role&#39;</span>, <span class="st">&#39;timestamp&#39;</span>, <span class="st">&#39;model&#39;</span>, <span class="st">&#39;content&#39;</span></span>
<span id="cb30-1596"><a href="#cb30-1596" aria-hidden="true" tabindex="-1"></a>                ])</span>
<span id="cb30-1597"><a href="#cb30-1597" aria-hidden="true" tabindex="-1"></a>                writer.writeheader()</span>
<span id="cb30-1598"><a href="#cb30-1598" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i, msg <span class="kw">in</span> <span class="bu">enumerate</span>(conv[<span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb30-1599"><a href="#cb30-1599" aria-hidden="true" tabindex="-1"></a>                    writer.writerow({</span>
<span id="cb30-1600"><a href="#cb30-1600" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;node_id&#39;</span>: <span class="bu">str</span>(i),</span>
<span id="cb30-1601"><a href="#cb30-1601" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: msg[<span class="st">&#39;author&#39;</span>],</span>
<span id="cb30-1602"><a href="#cb30-1602" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: msg[<span class="st">&#39;role&#39;</span>],</span>
<span id="cb30-1603"><a href="#cb30-1603" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: msg[<span class="st">&#39;timestamp&#39;</span>],</span>
<span id="cb30-1604"><a href="#cb30-1604" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg[<span class="st">&#39;model&#39;</span>],</span>
<span id="cb30-1605"><a href="#cb30-1605" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: msg[<span class="st">&#39;content&#39;</span>]</span>
<span id="cb30-1606"><a href="#cb30-1606" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb30-1607"><a href="#cb30-1607" aria-hidden="true" tabindex="-1"></a>            saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb30-1608"><a href="#cb30-1608" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1609"><a href="#cb30-1609" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ CSV: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb30-1610"><a href="#cb30-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1611"><a href="#cb30-1611" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_json(<span class="va">self</span>):</span>
<span id="cb30-1612"><a href="#cb30-1612" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas em arquivos JSON individuais&quot;&quot;&quot;</span></span>
<span id="cb30-1613"><a href="#cb30-1613" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb30-1614"><a href="#cb30-1614" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] JSONs seriam criados:&quot;</span>)</span>
<span id="cb30-1615"><a href="#cb30-1615" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb30-1616"><a href="#cb30-1616" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb30-1617"><a href="#cb30-1617" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.json&quot;</span></span>
<span id="cb30-1618"><a href="#cb30-1618" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìã </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1619"><a href="#cb30-1619" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb30-1620"><a href="#cb30-1620" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1621"><a href="#cb30-1621" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;json&#39;</span>])</span>
<span id="cb30-1622"><a href="#cb30-1622" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-1623"><a href="#cb30-1623" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-1624"><a href="#cb30-1624" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb30-1625"><a href="#cb30-1625" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb30-1626"><a href="#cb30-1626" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.json&quot;</span></span>
<span id="cb30-1627"><a href="#cb30-1627" aria-hidden="true" tabindex="-1"></a>            filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb30-1628"><a href="#cb30-1628" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1629"><a href="#cb30-1629" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb30-1630"><a href="#cb30-1630" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb30-1631"><a href="#cb30-1631" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-1632"><a href="#cb30-1632" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb30-1633"><a href="#cb30-1633" aria-hidden="true" tabindex="-1"></a>                json.dump(conv, f, ensure_ascii<span class="op">=</span><span class="va">False</span>, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb30-1634"><a href="#cb30-1634" aria-hidden="true" tabindex="-1"></a>            saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb30-1635"><a href="#cb30-1635" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1636"><a href="#cb30-1636" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ JSON: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb30-1637"><a href="#cb30-1637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1638"><a href="#cb30-1638" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_all_to_single_files(<span class="va">self</span>):</span>
<span id="cb30-1639"><a href="#cb30-1639" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva todas as conversas em arquivos √∫nicos CSV e JSON&quot;&quot;&quot;</span></span>
<span id="cb30-1640"><a href="#cb30-1640" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb30-1641"><a href="#cb30-1641" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] Arquivos √∫nicos seriam criados:&quot;</span>)</span>
<span id="cb30-1642"><a href="#cb30-1642" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÅ </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;csv&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1643"><a href="#cb30-1643" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÅ </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;json&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1644"><a href="#cb30-1644" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb30-1645"><a href="#cb30-1645" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1646"><a href="#cb30-1646" aria-hidden="true" tabindex="-1"></a>        <span class="co"># CSV √∫nico</span></span>
<span id="cb30-1647"><a href="#cb30-1647" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.single_files[<span class="st">&#39;csv&#39;</span>], <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb30-1648"><a href="#cb30-1648" aria-hidden="true" tabindex="-1"></a>            fieldnames <span class="op">=</span> [</span>
<span id="cb30-1649"><a href="#cb30-1649" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;conversation_number&#39;</span>, <span class="st">&#39;source&#39;</span>, <span class="st">&#39;conversation_title&#39;</span>, <span class="st">&#39;category&#39;</span>,</span>
<span id="cb30-1650"><a href="#cb30-1650" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;author&#39;</span>, <span class="st">&#39;role&#39;</span>, <span class="st">&#39;timestamp&#39;</span>, <span class="st">&#39;model&#39;</span>, <span class="st">&#39;content&#39;</span></span>
<span id="cb30-1651"><a href="#cb30-1651" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb30-1652"><a href="#cb30-1652" aria-hidden="true" tabindex="-1"></a>            writer <span class="op">=</span> csv.DictWriter(f, fieldnames<span class="op">=</span>fieldnames)</span>
<span id="cb30-1653"><a href="#cb30-1653" aria-hidden="true" tabindex="-1"></a>            writer.writeheader()</span>
<span id="cb30-1654"><a href="#cb30-1654" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb30-1655"><a href="#cb30-1655" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> msg <span class="kw">in</span> conv[<span class="st">&#39;messages&#39;</span>]:</span>
<span id="cb30-1656"><a href="#cb30-1656" aria-hidden="true" tabindex="-1"></a>                    writer.writerow({</span>
<span id="cb30-1657"><a href="#cb30-1657" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;conversation_number&#39;</span>: conv[<span class="st">&#39;number&#39;</span>],</span>
<span id="cb30-1658"><a href="#cb30-1658" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: conv[<span class="st">&#39;source&#39;</span>],</span>
<span id="cb30-1659"><a href="#cb30-1659" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;conversation_title&#39;</span>: conv[<span class="st">&#39;title&#39;</span>],</span>
<span id="cb30-1660"><a href="#cb30-1660" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: conv[<span class="st">&#39;category&#39;</span>],</span>
<span id="cb30-1661"><a href="#cb30-1661" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: msg[<span class="st">&#39;author&#39;</span>],</span>
<span id="cb30-1662"><a href="#cb30-1662" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: msg[<span class="st">&#39;role&#39;</span>],</span>
<span id="cb30-1663"><a href="#cb30-1663" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: msg[<span class="st">&#39;timestamp&#39;</span>],</span>
<span id="cb30-1664"><a href="#cb30-1664" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg[<span class="st">&#39;model&#39;</span>],</span>
<span id="cb30-1665"><a href="#cb30-1665" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: msg[<span class="st">&#39;content&#39;</span>]</span>
<span id="cb30-1666"><a href="#cb30-1666" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb30-1667"><a href="#cb30-1667" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ CSV √∫nico: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;csv&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1668"><a href="#cb30-1668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1669"><a href="#cb30-1669" aria-hidden="true" tabindex="-1"></a>        <span class="co"># JSON √∫nico</span></span>
<span id="cb30-1670"><a href="#cb30-1670" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.single_files[<span class="st">&#39;json&#39;</span>], <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb30-1671"><a href="#cb30-1671" aria-hidden="true" tabindex="-1"></a>            json.dump(<span class="va">self</span>.all_conversations, f, ensure_ascii<span class="op">=</span><span class="va">False</span>, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb30-1672"><a href="#cb30-1672" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ JSON √∫nico: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;json&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1673"><a href="#cb30-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1674"><a href="#cb30-1674" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_searchable_index(<span class="va">self</span>):</span>
<span id="cb30-1675"><a href="#cb30-1675" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Cria √≠ndice HTML pesquis√°vel com links para HTML&quot;&quot;&quot;</span></span>
<span id="cb30-1676"><a href="#cb30-1676" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb30-1677"><a href="#cb30-1677" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] √çndice HTML seria criado: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-1678"><a href="#cb30-1678" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb30-1679"><a href="#cb30-1679" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1680"><a href="#cb30-1680" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;üéØ Criando √≠ndice HTML combinado...&quot;</span>)</span>
<span id="cb30-1681"><a href="#cb30-1681" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-1682"><a href="#cb30-1682" aria-hidden="true" tabindex="-1"></a>        category_stats <span class="op">=</span> {}</span>
<span id="cb30-1683"><a href="#cb30-1683" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb30-1684"><a href="#cb30-1684" aria-hidden="true" tabindex="-1"></a>            cat <span class="op">=</span> conv[<span class="st">&#39;category&#39;</span>]</span>
<span id="cb30-1685"><a href="#cb30-1685" aria-hidden="true" tabindex="-1"></a>            category_stats[cat] <span class="op">=</span> category_stats.get(cat, <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb30-1686"><a href="#cb30-1686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1687"><a href="#cb30-1687" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb30-1688"><a href="#cb30-1688" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html lang=&quot;pt-PT&quot;&gt;</span></span>
<span id="cb30-1689"><a href="#cb30-1689" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb30-1690"><a href="#cb30-1690" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb30-1691"><a href="#cb30-1691" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb30-1692"><a href="#cb30-1692" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;√çndice Combinado - AI Chats&lt;/title&gt;</span></span>
<span id="cb30-1693"><a href="#cb30-1693" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb30-1694"><a href="#cb30-1694" aria-hidden="true" tabindex="-1"></a><span class="ss">        * </span><span class="ch">{{</span><span class="ss"> margin: 0; padding: 0; box-sizing: border-box; </span><span class="ch">}}</span></span>
<span id="cb30-1695"><a href="#cb30-1695" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span><span class="ss"> font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; color: #333; </span><span class="ch">}}</span></span>
<span id="cb30-1696"><a href="#cb30-1696" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span><span class="ss"> max-width: 1400px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; </span><span class="ch">}}</span></span>
<span id="cb30-1697"><a href="#cb30-1697" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header </span><span class="ch">{{</span><span class="ss"> background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; text-align: center; </span><span class="ch">}}</span></span>
<span id="cb30-1698"><a href="#cb30-1698" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header h1 </span><span class="ch">{{</span><span class="ss"> font-size: 2.8em; margin-bottom: 15px; font-weight: 300; </span><span class="ch">}}</span></span>
<span id="cb30-1699"><a href="#cb30-1699" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header p </span><span class="ch">{{</span><span class="ss"> font-size: 1.2em; opacity: 0.9; margin-bottom: 20px; </span><span class="ch">}}</span></span>
<span id="cb30-1700"><a href="#cb30-1700" aria-hidden="true" tabindex="-1"></a><span class="ss">        .stats </span><span class="ch">{{</span><span class="ss"> display: flex; justify-content: center; gap: 30px; margin-top: 25px; flex-wrap: wrap; </span><span class="ch">}}</span></span>
<span id="cb30-1701"><a href="#cb30-1701" aria-hidden="true" tabindex="-1"></a><span class="ss">        .stat-item </span><span class="ch">{{</span><span class="ss"> background: rgba(255,255,255,0.15); padding: 18px 28px; border-radius: 12px; backdrop-filter: blur(10px); font-size: 1.1em; </span><span class="ch">}}</span></span>
<span id="cb30-1702"><a href="#cb30-1702" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-section </span><span class="ch">{{</span><span class="ss"> padding: 30px; background: #f8f9fa; border-bottom: 1px solid #e9ecef; </span><span class="ch">}}</span></span>
<span id="cb30-1703"><a href="#cb30-1703" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-box </span><span class="ch">{{</span><span class="ss"> width: 100%; padding: 18px 25px; font-size: 16px; border: 2px solid #e9ecef; border-radius: 25px; outline: none; transition: all 0.3s ease; font-family: inherit; </span><span class="ch">}}</span></span>
<span id="cb30-1704"><a href="#cb30-1704" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-box:focus </span><span class="ch">{{</span><span class="ss"> border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); </span><span class="ch">}}</span></span>
<span id="cb30-1705"><a href="#cb30-1705" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-section </span><span class="ch">{{</span></span>
<span id="cb30-1706"><a href="#cb30-1706" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px 30px;</span></span>
<span id="cb30-1707"><a href="#cb30-1707" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb30-1708"><a href="#cb30-1708" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb30-1709"><a href="#cb30-1709" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 12px;</span></span>
<span id="cb30-1710"><a href="#cb30-1710" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: center;</span></span>
<span id="cb30-1711"><a href="#cb30-1711" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb30-1712"><a href="#cb30-1712" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 1px solid #e9ecef;</span></span>
<span id="cb30-1713"><a href="#cb30-1713" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1714"><a href="#cb30-1714" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-btn </span><span class="ch">{{</span></span>
<span id="cb30-1715"><a href="#cb30-1715" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 10px 20px;</span></span>
<span id="cb30-1716"><a href="#cb30-1716" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb30-1717"><a href="#cb30-1717" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 2px solid #e9ecef;</span></span>
<span id="cb30-1718"><a href="#cb30-1718" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 25px;</span></span>
<span id="cb30-1719"><a href="#cb30-1719" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb30-1720"><a href="#cb30-1720" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.95em;</span></span>
<span id="cb30-1721"><a href="#cb30-1721" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb30-1722"><a href="#cb30-1722" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.3s ease;</span></span>
<span id="cb30-1723"><a href="#cb30-1723" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: inherit;</span></span>
<span id="cb30-1724"><a href="#cb30-1724" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1725"><a href="#cb30-1725" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-btn.active, .filter-btn:hover </span><span class="ch">{{</span></span>
<span id="cb30-1726"><a href="#cb30-1726" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #667eea;</span></span>
<span id="cb30-1727"><a href="#cb30-1727" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb30-1728"><a href="#cb30-1728" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb30-1729"><a href="#cb30-1729" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: translateY(-2px);</span></span>
<span id="cb30-1730"><a href="#cb30-1730" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);</span></span>
<span id="cb30-1731"><a href="#cb30-1731" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1732"><a href="#cb30-1732" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversations-grid </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-1733"><a href="#cb30-1733" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: grid; </span></span>
<span id="cb30-1734"><a href="#cb30-1734" aria-hidden="true" tabindex="-1"></a><span class="ss">            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); </span></span>
<span id="cb30-1735"><a href="#cb30-1735" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 25px; </span></span>
<span id="cb30-1736"><a href="#cb30-1736" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 35px;</span></span>
<span id="cb30-1737"><a href="#cb30-1737" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);</span></span>
<span id="cb30-1738"><a href="#cb30-1738" aria-hidden="true" tabindex="-1"></a><span class="ss">            min-height: 400px;</span></span>
<span id="cb30-1739"><a href="#cb30-1739" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1740"><a href="#cb30-1740" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-1741"><a href="#cb30-1741" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white; </span></span>
<span id="cb30-1742"><a href="#cb30-1742" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #e9ecef; </span></span>
<span id="cb30-1743"><a href="#cb30-1743" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 15px; </span></span>
<span id="cb30-1744"><a href="#cb30-1744" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 25px; </span></span>
<span id="cb30-1745"><a href="#cb30-1745" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.4s ease; </span></span>
<span id="cb30-1746"><a href="#cb30-1746" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer; </span></span>
<span id="cb30-1747"><a href="#cb30-1747" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: relative;</span></span>
<span id="cb30-1748"><a href="#cb30-1748" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 15px rgba(0,0,0,0.08);</span></span>
<span id="cb30-1749"><a href="#cb30-1749" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1750"><a href="#cb30-1750" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card:hover </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-1751"><a href="#cb30-1751" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: translateY(-8px); </span></span>
<span id="cb30-1752"><a href="#cb30-1752" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 15px 35px rgba(0,0,0,0.15); </span></span>
<span id="cb30-1753"><a href="#cb30-1753" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb30-1754"><a href="#cb30-1754" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1755"><a href="#cb30-1755" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-header </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-1756"><a href="#cb30-1756" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb30-1757"><a href="#cb30-1757" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between; </span></span>
<span id="cb30-1758"><a href="#cb30-1758" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: flex-start; </span></span>
<span id="cb30-1759"><a href="#cb30-1759" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 18px; </span></span>
<span id="cb30-1760"><a href="#cb30-1760" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1761"><a href="#cb30-1761" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-number </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-1762"><a href="#cb30-1762" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #667eea, #764ba2); </span></span>
<span id="cb30-1763"><a href="#cb30-1763" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb30-1764"><a href="#cb30-1764" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 8px 16px; </span></span>
<span id="cb30-1765"><a href="#cb30-1765" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 20px; </span></span>
<span id="cb30-1766"><a href="#cb30-1766" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em; </span></span>
<span id="cb30-1767"><a href="#cb30-1767" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb30-1768"><a href="#cb30-1768" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);</span></span>
<span id="cb30-1769"><a href="#cb30-1769" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1770"><a href="#cb30-1770" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-source </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-1771"><a href="#cb30-1771" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e3f2fd; </span></span>
<span id="cb30-1772"><a href="#cb30-1772" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #1976d2; </span></span>
<span id="cb30-1773"><a href="#cb30-1773" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 5px 12px; </span></span>
<span id="cb30-1774"><a href="#cb30-1774" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px; </span></span>
<span id="cb30-1775"><a href="#cb30-1775" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.85em; </span></span>
<span id="cb30-1776"><a href="#cb30-1776" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold; </span></span>
<span id="cb30-1777"><a href="#cb30-1777" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 10px;</span></span>
<span id="cb30-1778"><a href="#cb30-1778" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1779"><a href="#cb30-1779" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-title </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-1780"><a href="#cb30-1780" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.3em; </span></span>
<span id="cb30-1781"><a href="#cb30-1781" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 600; </span></span>
<span id="cb30-1782"><a href="#cb30-1782" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50; </span></span>
<span id="cb30-1783"><a href="#cb30-1783" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 12px; </span></span>
<span id="cb30-1784"><a href="#cb30-1784" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.4;</span></span>
<span id="cb30-1785"><a href="#cb30-1785" aria-hidden="true" tabindex="-1"></a><span class="ss">            min-height: 3.6em;</span></span>
<span id="cb30-1786"><a href="#cb30-1786" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb30-1787"><a href="#cb30-1787" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1788"><a href="#cb30-1788" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-summary </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-1789"><a href="#cb30-1789" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #6c757d; </span></span>
<span id="cb30-1790"><a href="#cb30-1790" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.95em; </span></span>
<span id="cb30-1791"><a href="#cb30-1791" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.5; </span></span>
<span id="cb30-1792"><a href="#cb30-1792" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 18px;</span></span>
<span id="cb30-1793"><a href="#cb30-1793" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: -webkit-box;</span></span>
<span id="cb30-1794"><a href="#cb30-1794" aria-hidden="true" tabindex="-1"></a><span class="ss">            -webkit-line-clamp: 3;</span></span>
<span id="cb30-1795"><a href="#cb30-1795" aria-hidden="true" tabindex="-1"></a><span class="ss">            -webkit-box-orient: vertical;</span></span>
<span id="cb30-1796"><a href="#cb30-1796" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb30-1797"><a href="#cb30-1797" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb30-1798"><a href="#cb30-1798" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1799"><a href="#cb30-1799" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-meta </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-1800"><a href="#cb30-1800" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb30-1801"><a href="#cb30-1801" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between; </span></span>
<span id="cb30-1802"><a href="#cb30-1802" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.85em; </span></span>
<span id="cb30-1803"><a href="#cb30-1803" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #868e96; </span></span>
<span id="cb30-1804"><a href="#cb30-1804" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-top: 1px solid #e9ecef; </span></span>
<span id="cb30-1805"><a href="#cb30-1805" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-top: 18px;</span></span>
<span id="cb30-1806"><a href="#cb30-1806" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1807"><a href="#cb30-1807" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-actions </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-1808"><a href="#cb30-1808" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: absolute; </span></span>
<span id="cb30-1809"><a href="#cb30-1809" aria-hidden="true" tabindex="-1"></a><span class="ss">            top: 20px; </span></span>
<span id="cb30-1810"><a href="#cb30-1810" aria-hidden="true" tabindex="-1"></a><span class="ss">            right: 20px; </span></span>
<span id="cb30-1811"><a href="#cb30-1811" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb30-1812"><a href="#cb30-1812" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 8px; </span></span>
<span id="cb30-1813"><a href="#cb30-1813" aria-hidden="true" tabindex="-1"></a><span class="ss">            opacity: 0; </span></span>
<span id="cb30-1814"><a href="#cb30-1814" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: opacity 0.3s ease; </span></span>
<span id="cb30-1815"><a href="#cb30-1815" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1816"><a href="#cb30-1816" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card:hover .card-actions </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-1817"><a href="#cb30-1817" aria-hidden="true" tabindex="-1"></a><span class="ss">            opacity: 1; </span></span>
<span id="cb30-1818"><a href="#cb30-1818" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1819"><a href="#cb30-1819" aria-hidden="true" tabindex="-1"></a><span class="ss">        .action-btn </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-1820"><a href="#cb30-1820" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white; </span></span>
<span id="cb30-1821"><a href="#cb30-1821" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 2px solid #e9ecef; </span></span>
<span id="cb30-1822"><a href="#cb30-1822" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px; </span></span>
<span id="cb30-1823"><a href="#cb30-1823" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 6px 12px; </span></span>
<span id="cb30-1824"><a href="#cb30-1824" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.8em; </span></span>
<span id="cb30-1825"><a href="#cb30-1825" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer; </span></span>
<span id="cb30-1826"><a href="#cb30-1826" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.3s ease;</span></span>
<span id="cb30-1827"><a href="#cb30-1827" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb30-1828"><a href="#cb30-1828" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb30-1829"><a href="#cb30-1829" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333;</span></span>
<span id="cb30-1830"><a href="#cb30-1830" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb30-1831"><a href="#cb30-1831" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1832"><a href="#cb30-1832" aria-hidden="true" tabindex="-1"></a><span class="ss">        .action-btn:hover </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-1833"><a href="#cb30-1833" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #667eea; </span></span>
<span id="cb30-1834"><a href="#cb30-1834" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb30-1835"><a href="#cb30-1835" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb30-1836"><a href="#cb30-1836" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: scale(1.05);</span></span>
<span id="cb30-1837"><a href="#cb30-1837" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1838"><a href="#cb30-1838" aria-hidden="true" tabindex="-1"></a><span class="ss">        .recent-badge </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-1839"><a href="#cb30-1839" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #ff6b6b; </span></span>
<span id="cb30-1840"><a href="#cb30-1840" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb30-1841"><a href="#cb30-1841" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 3px 10px; </span></span>
<span id="cb30-1842"><a href="#cb30-1842" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px; </span></span>
<span id="cb30-1843"><a href="#cb30-1843" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.75em; </span></span>
<span id="cb30-1844"><a href="#cb30-1844" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 8px;</span></span>
<span id="cb30-1845"><a href="#cb30-1845" aria-hidden="true" tabindex="-1"></a><span class="ss">            animation: pulse 2s infinite;</span></span>
<span id="cb30-1846"><a href="#cb30-1846" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1847"><a href="#cb30-1847" aria-hidden="true" tabindex="-1"></a><span class="ss">        .no-results </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb30-1848"><a href="#cb30-1848" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center; </span></span>
<span id="cb30-1849"><a href="#cb30-1849" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 60px 20px; </span></span>
<span id="cb30-1850"><a href="#cb30-1850" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #6c757d;</span></span>
<span id="cb30-1851"><a href="#cb30-1851" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.1em;</span></span>
<span id="cb30-1852"><a href="#cb30-1852" aria-hidden="true" tabindex="-1"></a><span class="ss">            grid-column: 1 / -1;</span></span>
<span id="cb30-1853"><a href="#cb30-1853" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1854"><a href="#cb30-1854" aria-hidden="true" tabindex="-1"></a><span class="ss">        @keyframes pulse </span><span class="ch">{{</span></span>
<span id="cb30-1855"><a href="#cb30-1855" aria-hidden="true" tabindex="-1"></a><span class="ss">            0% </span><span class="ch">{{</span><span class="ss"> transform: scale(1); </span><span class="ch">}}</span></span>
<span id="cb30-1856"><a href="#cb30-1856" aria-hidden="true" tabindex="-1"></a><span class="ss">            50% </span><span class="ch">{{</span><span class="ss"> transform: scale(1.05); </span><span class="ch">}}</span></span>
<span id="cb30-1857"><a href="#cb30-1857" aria-hidden="true" tabindex="-1"></a><span class="ss">            100% </span><span class="ch">{{</span><span class="ss"> transform: scale(1); </span><span class="ch">}}</span></span>
<span id="cb30-1858"><a href="#cb30-1858" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1859"><a href="#cb30-1859" aria-hidden="true" tabindex="-1"></a><span class="ss">        .category-badge </span><span class="ch">{{</span></span>
<span id="cb30-1860"><a href="#cb30-1860" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb30-1861"><a href="#cb30-1861" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e3f2fd;</span></span>
<span id="cb30-1862"><a href="#cb30-1862" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #1976d2;</span></span>
<span id="cb30-1863"><a href="#cb30-1863" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 10px;</span></span>
<span id="cb30-1864"><a href="#cb30-1864" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px;</span></span>
<span id="cb30-1865"><a href="#cb30-1865" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.8em;</span></span>
<span id="cb30-1866"><a href="#cb30-1866" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 8px;</span></span>
<span id="cb30-1867"><a href="#cb30-1867" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb30-1868"><a href="#cb30-1868" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1869"><a href="#cb30-1869" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb30-1870"><a href="#cb30-1870" aria-hidden="true" tabindex="-1"></a><span class="ss">        .direct-link </span><span class="ch">{{</span></span>
<span id="cb30-1871"><a href="#cb30-1871" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb30-1872"><a href="#cb30-1872" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 5px;</span></span>
<span id="cb30-1873"><a href="#cb30-1873" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 8px 15px;</span></span>
<span id="cb30-1874"><a href="#cb30-1874" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #28a745;</span></span>
<span id="cb30-1875"><a href="#cb30-1875" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb30-1876"><a href="#cb30-1876" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb30-1877"><a href="#cb30-1877" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 5px;</span></span>
<span id="cb30-1878"><a href="#cb30-1878" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb30-1879"><a href="#cb30-1879" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1880"><a href="#cb30-1880" aria-hidden="true" tabindex="-1"></a><span class="ss">        .direct-link:hover </span><span class="ch">{{</span></span>
<span id="cb30-1881"><a href="#cb30-1881" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #218838;</span></span>
<span id="cb30-1882"><a href="#cb30-1882" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1883"><a href="#cb30-1883" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb30-1884"><a href="#cb30-1884" aria-hidden="true" tabindex="-1"></a><span class="ss">        .html-btn </span><span class="ch">{{</span></span>
<span id="cb30-1885"><a href="#cb30-1885" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #17a2b8;</span></span>
<span id="cb30-1886"><a href="#cb30-1886" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb30-1887"><a href="#cb30-1887" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1888"><a href="#cb30-1888" aria-hidden="true" tabindex="-1"></a><span class="ss">        .html-btn:hover </span><span class="ch">{{</span></span>
<span id="cb30-1889"><a href="#cb30-1889" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #138496;</span></span>
<span id="cb30-1890"><a href="#cb30-1890" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1891"><a href="#cb30-1891" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb30-1892"><a href="#cb30-1892" aria-hidden="true" tabindex="-1"></a><span class="ss">        .pdf-btn </span><span class="ch">{{</span></span>
<span id="cb30-1893"><a href="#cb30-1893" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #dc3545;</span></span>
<span id="cb30-1894"><a href="#cb30-1894" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb30-1895"><a href="#cb30-1895" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1896"><a href="#cb30-1896" aria-hidden="true" tabindex="-1"></a><span class="ss">        .pdf-btn:hover </span><span class="ch">{{</span></span>
<span id="cb30-1897"><a href="#cb30-1897" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #c82333;</span></span>
<span id="cb30-1898"><a href="#cb30-1898" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb30-1899"><a href="#cb30-1899" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb30-1900"><a href="#cb30-1900" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb30-1901"><a href="#cb30-1901" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb30-1902"><a href="#cb30-1902" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb30-1903"><a href="#cb30-1903" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;header&quot;&gt;</span></span>
<span id="cb30-1904"><a href="#cb30-1904" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;h1&gt;üìö √çndice Combinado de Conversas&lt;/h1&gt;</span></span>
<span id="cb30-1905"><a href="#cb30-1905" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;p&gt;Qwen3 ‚Ä¢ ChatGPT ‚Ä¢ DeepSeek ‚Ä¢ Grok ‚Ä¢ COM HTML (Pandoc + MathJax)&lt;/p&gt;</span></span>
<span id="cb30-1906"><a href="#cb30-1906" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div class=&quot;stats&quot;&gt;</span></span>
<span id="cb30-1907"><a href="#cb30-1907" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb30-1908"><a href="#cb30-1908" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Total:&lt;/strong&gt; &lt;span id=&quot;total-count&quot;&gt;</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">&lt;/span&gt; conversas</span></span>
<span id="cb30-1909"><a href="#cb30-1909" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb30-1910"><a href="#cb30-1910" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb30-1911"><a href="#cb30-1911" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Ordena√ß√£o:&lt;/strong&gt; Mais Recentes Primeiro</span></span>
<span id="cb30-1912"><a href="#cb30-1912" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb30-1913"><a href="#cb30-1913" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb30-1914"><a href="#cb30-1914" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Atualizado:&lt;/strong&gt; </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">.</span>strftime(<span class="st">&#39;</span><span class="sc">%d</span><span class="st">/%m/%Y %H:%M&#39;</span>)<span class="sc">}</span></span>
<span id="cb30-1915"><a href="#cb30-1915" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb30-1916"><a href="#cb30-1916" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb30-1917"><a href="#cb30-1917" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb30-1918"><a href="#cb30-1918" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb30-1919"><a href="#cb30-1919" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;search-section&quot;&gt;</span></span>
<span id="cb30-1920"><a href="#cb30-1920" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;input type=&quot;text&quot; id=&quot;searchInput&quot; class=&quot;search-box&quot; placeholder=&quot;üîç Pesquisar por t√≠tulo, conte√∫do ou categoria...&quot;&gt;</span></span>
<span id="cb30-1921"><a href="#cb30-1921" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb30-1922"><a href="#cb30-1922" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb30-1923"><a href="#cb30-1923" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;filter-section&quot;&gt;</span></span>
<span id="cb30-1924"><a href="#cb30-1924" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;button class=&quot;filter-btn active&quot; data-filter=&quot;todas&quot;&gt;Todas (</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">)&lt;/button&gt;</span></span>
<span id="cb30-1925"><a href="#cb30-1925" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb30-1926"><a href="#cb30-1926" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-1927"><a href="#cb30-1927" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category, count <span class="kw">in</span> category_stats.items():</span>
<span id="cb30-1928"><a href="#cb30-1928" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">+=</span> <span class="ss">f&#39;&lt;button class=&quot;filter-btn&quot; data-filter=&quot;</span><span class="sc">{</span>category<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot;&gt;</span><span class="sc">{</span>category<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">)&lt;/button&gt;</span><span class="ch">\n</span><span class="ss">&#39;</span></span>
<span id="cb30-1929"><a href="#cb30-1929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1930"><a href="#cb30-1930" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb30-1931"><a href="#cb30-1931" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb30-1932"><a href="#cb30-1932" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb30-1933"><a href="#cb30-1933" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div style=&quot;text-align: center; padding: 15px; background: #e9ecef; border-bottom: 1px solid #ddd;&quot;&gt;</span></span>
<span id="cb30-1934"><a href="#cb30-1934" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;strong&gt;Acesso R√°pido:&lt;/strong&gt;</span></span>
<span id="cb30-1935"><a href="#cb30-1935" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_markdown/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìÅ Markdown&lt;/a&gt;</span></span>
<span id="cb30-1936"><a href="#cb30-1936" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_html/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üåê HTML&lt;/a&gt;</span></span>
<span id="cb30-1937"><a href="#cb30-1937" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_pdfs/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìÑ PDF&lt;/a&gt;</span></span>
<span id="cb30-1938"><a href="#cb30-1938" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_json/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìã JSON&lt;/a&gt;</span></span>
<span id="cb30-1939"><a href="#cb30-1939" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb30-1940"><a href="#cb30-1940" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb30-1941"><a href="#cb30-1941" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div class=&quot;conversations-grid&quot; id=&quot;conversationsGrid&quot;&gt;</span></span>
<span id="cb30-1942"><a href="#cb30-1942" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb30-1943"><a href="#cb30-1943" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-1944"><a href="#cb30-1944" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.all_conversations):</span>
<span id="cb30-1945"><a href="#cb30-1945" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb30-1946"><a href="#cb30-1946" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb30-1947"><a href="#cb30-1947" aria-hidden="true" tabindex="-1"></a>            recent_badge <span class="op">=</span> <span class="st">&quot;&lt;span class=&#39;recent-badge&#39;&gt;NOVO&lt;/span&gt;&quot;</span> <span class="cf">if</span> i <span class="op">&lt;</span> <span class="dv">5</span> <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb30-1948"><a href="#cb30-1948" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1949"><a href="#cb30-1949" aria-hidden="true" tabindex="-1"></a>            summary <span class="op">=</span> conv.get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;Sem resumo dispon√≠vel&#39;</span>)</span>
<span id="cb30-1950"><a href="#cb30-1950" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(summary) <span class="op">&gt;</span> <span class="dv">150</span>:</span>
<span id="cb30-1951"><a href="#cb30-1951" aria-hidden="true" tabindex="-1"></a>                summary <span class="op">=</span> summary[:<span class="dv">150</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span></span>
<span id="cb30-1952"><a href="#cb30-1952" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb30-1953"><a href="#cb30-1953" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">+=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb30-1954"><a href="#cb30-1954" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div class=&quot;conversation-card&quot; data-title=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&quot; data-summary=&quot;</span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&quot; data-source=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot; data-category=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;category&#39;</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot;&gt;</span></span>
<span id="cb30-1955"><a href="#cb30-1955" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-header&quot;&gt;</span></span>
<span id="cb30-1956"><a href="#cb30-1956" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;card-number&quot;&gt;#</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>recent_badge<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb30-1957"><a href="#cb30-1957" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;card-actions&quot;&gt;</span></span>
<span id="cb30-1958"><a href="#cb30-1958" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_markdown/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.md&quot; class=&quot;action-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üìÑ MD&lt;/a&gt;</span></span>
<span id="cb30-1959"><a href="#cb30-1959" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_html/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&quot; class=&quot;action-btn html-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üåê HTML&lt;/a&gt;</span></span>
<span id="cb30-1960"><a href="#cb30-1960" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_pdfs/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.pdf&quot; class=&quot;action-btn pdf-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üìä PDF&lt;/a&gt;</span></span>
<span id="cb30-1961"><a href="#cb30-1961" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;/div&gt;</span></span>
<span id="cb30-1962"><a href="#cb30-1962" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb30-1963"><a href="#cb30-1963" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-title&quot; onclick=&quot;openHTML(&#39;</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&#39;)&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb30-1964"><a href="#cb30-1964" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div&gt;</span></span>
<span id="cb30-1965"><a href="#cb30-1965" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span class=&quot;card-source&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb30-1966"><a href="#cb30-1966" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span class=&quot;category-badge&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;category&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb30-1967"><a href="#cb30-1967" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb30-1968"><a href="#cb30-1968" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-summary&quot; onclick=&quot;openHTML(&#39;</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&#39;)&quot;&gt;</span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb30-1969"><a href="#cb30-1969" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-meta&quot;&gt;</span></span>
<span id="cb30-1970"><a href="#cb30-1970" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span&gt;üìÖ </span><span class="sc">{</span>conv<span class="sc">.</span>get(<span class="st">&#39;updated_at&#39;</span>) <span class="kw">or</span> conv<span class="sc">.</span>get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb30-1971"><a href="#cb30-1971" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span&gt;üí¨ </span><span class="sc">{</span><span class="bu">len</span>(conv[<span class="st">&#39;messages&#39;</span>])<span class="sc">}</span><span class="ss"> mensagens&lt;/span&gt;</span></span>
<span id="cb30-1972"><a href="#cb30-1972" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb30-1973"><a href="#cb30-1973" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb30-1974"><a href="#cb30-1974" aria-hidden="true" tabindex="-1"></a><span class="ss">            &quot;&quot;&quot;</span></span>
<span id="cb30-1975"><a href="#cb30-1975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1976"><a href="#cb30-1976" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb30-1977"><a href="#cb30-1977" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb30-1978"><a href="#cb30-1978" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/div&gt;</span></span>
<span id="cb30-1979"><a href="#cb30-1979" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb30-1980"><a href="#cb30-1980" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;script&gt;</span></span>
<span id="cb30-1981"><a href="#cb30-1981" aria-hidden="true" tabindex="-1"></a><span class="st">        let currentFilter = &#39;todas&#39;;</span></span>
<span id="cb30-1982"><a href="#cb30-1982" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb30-1983"><a href="#cb30-1983" aria-hidden="true" tabindex="-1"></a><span class="st">        document.addEventListener(&#39;DOMContentLoaded&#39;, function() {</span></span>
<span id="cb30-1984"><a href="#cb30-1984" aria-hidden="true" tabindex="-1"></a><span class="st">            updateStats();</span></span>
<span id="cb30-1985"><a href="#cb30-1985" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb30-1986"><a href="#cb30-1986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1987"><a href="#cb30-1987" aria-hidden="true" tabindex="-1"></a><span class="st">        document.querySelectorAll(&#39;.filter-btn&#39;).forEach(btn =&gt; {</span></span>
<span id="cb30-1988"><a href="#cb30-1988" aria-hidden="true" tabindex="-1"></a><span class="st">            btn.addEventListener(&#39;click&#39;, () =&gt; {</span></span>
<span id="cb30-1989"><a href="#cb30-1989" aria-hidden="true" tabindex="-1"></a><span class="st">                document.querySelectorAll(&#39;.filter-btn&#39;).forEach(b =&gt; b.classList.remove(&#39;active&#39;));</span></span>
<span id="cb30-1990"><a href="#cb30-1990" aria-hidden="true" tabindex="-1"></a><span class="st">                btn.classList.add(&#39;active&#39;);</span></span>
<span id="cb30-1991"><a href="#cb30-1991" aria-hidden="true" tabindex="-1"></a><span class="st">                currentFilter = btn.getAttribute(&#39;data-filter&#39;);</span></span>
<span id="cb30-1992"><a href="#cb30-1992" aria-hidden="true" tabindex="-1"></a><span class="st">                filterConversations();</span></span>
<span id="cb30-1993"><a href="#cb30-1993" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb30-1994"><a href="#cb30-1994" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb30-1995"><a href="#cb30-1995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1996"><a href="#cb30-1996" aria-hidden="true" tabindex="-1"></a><span class="st">        document.getElementById(&#39;searchInput&#39;).addEventListener(&#39;input&#39;, filterConversations);</span></span>
<span id="cb30-1997"><a href="#cb30-1997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1998"><a href="#cb30-1998" aria-hidden="true" tabindex="-1"></a><span class="st">        function filterConversations() {</span></span>
<span id="cb30-1999"><a href="#cb30-1999" aria-hidden="true" tabindex="-1"></a><span class="st">            const term = document.getElementById(&#39;searchInput&#39;).value.toLowerCase();</span></span>
<span id="cb30-2000"><a href="#cb30-2000" aria-hidden="true" tabindex="-1"></a><span class="st">            const cards = document.querySelectorAll(&#39;.conversation-card&#39;);</span></span>
<span id="cb30-2001"><a href="#cb30-2001" aria-hidden="true" tabindex="-1"></a><span class="st">            let visible = 0;</span></span>
<span id="cb30-2002"><a href="#cb30-2002" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-2003"><a href="#cb30-2003" aria-hidden="true" tabindex="-1"></a><span class="st">            cards.forEach(card =&gt; {</span></span>
<span id="cb30-2004"><a href="#cb30-2004" aria-hidden="true" tabindex="-1"></a><span class="st">                const title = card.getAttribute(&#39;data-title&#39;).toLowerCase();</span></span>
<span id="cb30-2005"><a href="#cb30-2005" aria-hidden="true" tabindex="-1"></a><span class="st">                const summary = card.getAttribute(&#39;data-summary&#39;).toLowerCase();</span></span>
<span id="cb30-2006"><a href="#cb30-2006" aria-hidden="true" tabindex="-1"></a><span class="st">                const source = card.getAttribute(&#39;data-source&#39;).toLowerCase();</span></span>
<span id="cb30-2007"><a href="#cb30-2007" aria-hidden="true" tabindex="-1"></a><span class="st">                const category = card.getAttribute(&#39;data-category&#39;).toLowerCase();</span></span>
<span id="cb30-2008"><a href="#cb30-2008" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb30-2009"><a href="#cb30-2009" aria-hidden="true" tabindex="-1"></a><span class="st">                const matchesSearch = (title.includes(term) || summary.includes(term) || category.includes(term) || source.includes(term));</span></span>
<span id="cb30-2010"><a href="#cb30-2010" aria-hidden="true" tabindex="-1"></a><span class="st">                const matchesCategory = (currentFilter === &#39;todas&#39; || category === currentFilter);</span></span>
<span id="cb30-2011"><a href="#cb30-2011" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb30-2012"><a href="#cb30-2012" aria-hidden="true" tabindex="-1"></a><span class="st">                if (matchesSearch &amp;&amp; matchesCategory) {</span></span>
<span id="cb30-2013"><a href="#cb30-2013" aria-hidden="true" tabindex="-1"></a><span class="st">                    card.style.display = &#39;block&#39;;</span></span>
<span id="cb30-2014"><a href="#cb30-2014" aria-hidden="true" tabindex="-1"></a><span class="st">                    visible++;</span></span>
<span id="cb30-2015"><a href="#cb30-2015" aria-hidden="true" tabindex="-1"></a><span class="st">                } else {</span></span>
<span id="cb30-2016"><a href="#cb30-2016" aria-hidden="true" tabindex="-1"></a><span class="st">                    card.style.display = &#39;none&#39;;</span></span>
<span id="cb30-2017"><a href="#cb30-2017" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb30-2018"><a href="#cb30-2018" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb30-2019"><a href="#cb30-2019" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-2020"><a href="#cb30-2020" aria-hidden="true" tabindex="-1"></a><span class="st">            updateStats(visible);</span></span>
<span id="cb30-2021"><a href="#cb30-2021" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-2022"><a href="#cb30-2022" aria-hidden="true" tabindex="-1"></a><span class="st">            const grid = document.getElementById(&#39;conversationsGrid&#39;);</span></span>
<span id="cb30-2023"><a href="#cb30-2023" aria-hidden="true" tabindex="-1"></a><span class="st">            const noResults = document.getElementById(&#39;no-results-message&#39;);</span></span>
<span id="cb30-2024"><a href="#cb30-2024" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb30-2025"><a href="#cb30-2025" aria-hidden="true" tabindex="-1"></a><span class="st">            if (visible === 0) {</span></span>
<span id="cb30-2026"><a href="#cb30-2026" aria-hidden="true" tabindex="-1"></a><span class="st">                if (!noResults) {</span></span>
<span id="cb30-2027"><a href="#cb30-2027" aria-hidden="true" tabindex="-1"></a><span class="st">                    const noResultsMsg = document.createElement(&#39;div&#39;);</span></span>
<span id="cb30-2028"><a href="#cb30-2028" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.id = &#39;no-results-message&#39;;</span></span>
<span id="cb30-2029"><a href="#cb30-2029" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.className = &#39;no-results&#39;;</span></span>
<span id="cb30-2030"><a href="#cb30-2030" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.innerHTML = &#39;üîç Nenhuma conversa encontrada. Tente ajustar os filtros ou a pesquisa.&#39;;</span></span>
<span id="cb30-2031"><a href="#cb30-2031" aria-hidden="true" tabindex="-1"></a><span class="st">                    grid.appendChild(noResultsMsg);</span></span>
<span id="cb30-2032"><a href="#cb30-2032" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb30-2033"><a href="#cb30-2033" aria-hidden="true" tabindex="-1"></a><span class="st">            } else if (noResults) {</span></span>
<span id="cb30-2034"><a href="#cb30-2034" aria-hidden="true" tabindex="-1"></a><span class="st">                noResults.remove();</span></span>
<span id="cb30-2035"><a href="#cb30-2035" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-2036"><a href="#cb30-2036" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb30-2037"><a href="#cb30-2037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2038"><a href="#cb30-2038" aria-hidden="true" tabindex="-1"></a><span class="st">        function updateStats(visibleCount = null) {</span></span>
<span id="cb30-2039"><a href="#cb30-2039" aria-hidden="true" tabindex="-1"></a><span class="st">            const totalElement = document.getElementById(&#39;total-count&#39;);</span></span>
<span id="cb30-2040"><a href="#cb30-2040" aria-hidden="true" tabindex="-1"></a><span class="st">            if (visibleCount !== null) {</span></span>
<span id="cb30-2041"><a href="#cb30-2041" aria-hidden="true" tabindex="-1"></a><span class="st">                totalElement.textContent = visibleCount;</span></span>
<span id="cb30-2042"><a href="#cb30-2042" aria-hidden="true" tabindex="-1"></a><span class="st">            } else {</span></span>
<span id="cb30-2043"><a href="#cb30-2043" aria-hidden="true" tabindex="-1"></a><span class="st">                totalElement.textContent = &quot;&quot;&quot;</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(<span class="va">self</span>.all_conversations)) <span class="op">+</span> <span class="st">&quot;&quot;&quot;;</span></span>
<span id="cb30-2044"><a href="#cb30-2044" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-2045"><a href="#cb30-2045" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb30-2046"><a href="#cb30-2046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2047"><a href="#cb30-2047" aria-hidden="true" tabindex="-1"></a><span class="st">        function openHTML(filename) {</span></span>
<span id="cb30-2048"><a href="#cb30-2048" aria-hidden="true" tabindex="-1"></a><span class="st">            const htmlUrl = &#39;combined_html/&#39; + filename;</span></span>
<span id="cb30-2049"><a href="#cb30-2049" aria-hidden="true" tabindex="-1"></a><span class="st">            console.log(&#39;Abrindo HTML:&#39;, htmlUrl);</span></span>
<span id="cb30-2050"><a href="#cb30-2050" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(htmlUrl, &#39;_blank&#39;);</span></span>
<span id="cb30-2051"><a href="#cb30-2051" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb30-2052"><a href="#cb30-2052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2053"><a href="#cb30-2053" aria-hidden="true" tabindex="-1"></a><span class="st">        function openMD(filename) {</span></span>
<span id="cb30-2054"><a href="#cb30-2054" aria-hidden="true" tabindex="-1"></a><span class="st">            const mdUrl = &#39;combined_markdown/&#39; + filename;</span></span>
<span id="cb30-2055"><a href="#cb30-2055" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(mdUrl, &#39;_blank&#39;);</span></span>
<span id="cb30-2056"><a href="#cb30-2056" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb30-2057"><a href="#cb30-2057" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb30-2058"><a href="#cb30-2058" aria-hidden="true" tabindex="-1"></a><span class="st">        function openPDF(filename) {</span></span>
<span id="cb30-2059"><a href="#cb30-2059" aria-hidden="true" tabindex="-1"></a><span class="st">            const pdfFile = filename.replace(&#39;.html&#39;, &#39;.pdf&#39;);</span></span>
<span id="cb30-2060"><a href="#cb30-2060" aria-hidden="true" tabindex="-1"></a><span class="st">            const pdfUrl = &#39;combined_pdfs/&#39; + pdfFile;</span></span>
<span id="cb30-2061"><a href="#cb30-2061" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(pdfUrl, &#39;_blank&#39;);</span></span>
<span id="cb30-2062"><a href="#cb30-2062" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb30-2063"><a href="#cb30-2063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2064"><a href="#cb30-2064" aria-hidden="true" tabindex="-1"></a><span class="st">        document.addEventListener(&#39;keydown&#39;, function(e) {</span></span>
<span id="cb30-2065"><a href="#cb30-2065" aria-hidden="true" tabindex="-1"></a><span class="st">            if (e.key === &#39;Escape&#39;) {</span></span>
<span id="cb30-2066"><a href="#cb30-2066" aria-hidden="true" tabindex="-1"></a><span class="st">                document.getElementById(&#39;searchInput&#39;).value = &#39;&#39;;</span></span>
<span id="cb30-2067"><a href="#cb30-2067" aria-hidden="true" tabindex="-1"></a><span class="st">                filterConversations();</span></span>
<span id="cb30-2068"><a href="#cb30-2068" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb30-2069"><a href="#cb30-2069" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb30-2070"><a href="#cb30-2070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2071"><a href="#cb30-2071" aria-hidden="true" tabindex="-1"></a><span class="st">        document.querySelectorAll(&#39;.conversation-card&#39;).forEach(card =&gt; {</span></span>
<span id="cb30-2072"><a href="#cb30-2072" aria-hidden="true" tabindex="-1"></a><span class="st">            card.addEventListener(&#39;click&#39;, function(e) {</span></span>
<span id="cb30-2073"><a href="#cb30-2073" aria-hidden="true" tabindex="-1"></a><span class="st">                if (e.target.closest(&#39;.action-btn&#39;)) {</span></span>
<span id="cb30-2074"><a href="#cb30-2074" aria-hidden="true" tabindex="-1"></a><span class="st">                    return;</span></span>
<span id="cb30-2075"><a href="#cb30-2075" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb30-2076"><a href="#cb30-2076" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb30-2077"><a href="#cb30-2077" aria-hidden="true" tabindex="-1"></a><span class="st">                const htmlBtn = this.querySelector(&#39;a.html-btn&#39;);</span></span>
<span id="cb30-2078"><a href="#cb30-2078" aria-hidden="true" tabindex="-1"></a><span class="st">                if (htmlBtn) {</span></span>
<span id="cb30-2079"><a href="#cb30-2079" aria-hidden="true" tabindex="-1"></a><span class="st">                    const htmlUrl = htmlBtn.getAttribute(&#39;href&#39;);</span></span>
<span id="cb30-2080"><a href="#cb30-2080" aria-hidden="true" tabindex="-1"></a><span class="st">                    window.open(htmlUrl, &#39;_blank&#39;);</span></span>
<span id="cb30-2081"><a href="#cb30-2081" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb30-2082"><a href="#cb30-2082" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb30-2083"><a href="#cb30-2083" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb30-2084"><a href="#cb30-2084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2085"><a href="#cb30-2085" aria-hidden="true" tabindex="-1"></a><span class="st">        document.getElementById(&#39;searchInput&#39;).focus();</span></span>
<span id="cb30-2086"><a href="#cb30-2086" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb30-2087"><a href="#cb30-2087" aria-hidden="true" tabindex="-1"></a><span class="st">        console.log(&#39;√çndice carregado com&#39;, &quot;&quot;&quot;</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(<span class="va">self</span>.all_conversations)) <span class="op">+</span> <span class="st">&quot;&quot;&quot;, &#39;conversas&#39;);</span></span>
<span id="cb30-2088"><a href="#cb30-2088" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/script&gt;</span></span>
<span id="cb30-2089"><a href="#cb30-2089" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/body&gt;</span></span>
<span id="cb30-2090"><a href="#cb30-2090" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/html&gt;</span></span>
<span id="cb30-2091"><a href="#cb30-2091" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb30-2092"><a href="#cb30-2092" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-2093"><a href="#cb30-2093" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.index_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb30-2094"><a href="#cb30-2094" aria-hidden="true" tabindex="-1"></a>            f.write(html_content)</span>
<span id="cb30-2095"><a href="#cb30-2095" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ √çndice combinado criado: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-2096"><a href="#cb30-2096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2097"><a href="#cb30-2097" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb30-2098"><a href="#cb30-2098" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser(</span>
<span id="cb30-2099"><a href="#cb30-2099" aria-hidden="true" tabindex="-1"></a>        description<span class="op">=</span><span class="st">&quot;Processa exporta√ß√µes combinadas com exporta√ß√£o HTML via Pandoc.&quot;</span></span>
<span id="cb30-2100"><a href="#cb30-2100" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-2101"><a href="#cb30-2101" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">&quot;--dry-run&quot;</span>, action<span class="op">=</span><span class="st">&quot;store_true&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Executa sem salvar arquivos&quot;</span>)</span>
<span id="cb30-2102"><a href="#cb30-2102" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">&quot;--force-overwrite&quot;</span>, action<span class="op">=</span><span class="st">&quot;store_true&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Substitui arquivos existentes&quot;</span>)</span>
<span id="cb30-2103"><a href="#cb30-2103" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-2104"><a href="#cb30-2104" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb30-2105"><a href="#cb30-2105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-2106"><a href="#cb30-2106" aria-hidden="true" tabindex="-1"></a>    system <span class="op">=</span> CombinedFragmentsSystem(</span>
<span id="cb30-2107"><a href="#cb30-2107" aria-hidden="true" tabindex="-1"></a>        dry_run<span class="op">=</span>args.dry_run,</span>
<span id="cb30-2108"><a href="#cb30-2108" aria-hidden="true" tabindex="-1"></a>        force_overwrite<span class="op">=</span>args.force_overwrite</span>
<span id="cb30-2109"><a href="#cb30-2109" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-2110"><a href="#cb30-2110" aria-hidden="true" tabindex="-1"></a>    system.run()</span>
<span id="cb30-2111"><a href="#cb30-2111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2112"><a href="#cb30-2112" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb30-2113"><a href="#cb30-2113" aria-hidden="true" tabindex="-1"></a>    main()</span></code></pre></div>
<h2 data-number="1.10" id="principais-corre√ß√µes-de-layout-implementadas"><span class="header-section-number">1.10</span> Principais corre√ß√µes de layout
implementadas:</h2>
<h3 data-number="1.10.1" id="layout-de-tela-completa"><span class="header-section-number">1.10.1</span> 1. <strong>Layout de tela
completa:</strong></h3>
<ul>
<li><code>max-width: none</code> no elemento <code>body</code></li>
<li><code>max-width: 95%</code> no container principal</li>
<li>Remove limita√ß√µes artificiais de largura</li>
</ul>
<h3 data-number="1.10.2" id="toc-flutuante-otimizado"><span class="header-section-number">1.10.2</span> 2. <strong>TOC flutuante
otimizado:</strong></h3>
<ul>
<li>Posicionado √† direita com <code>float: right</code></li>
<li>Largura fixa de 300px</li>
<li>Margens adequadas para n√£o comprimir o conte√∫do</li>
</ul>
<h3 data-number="1.10.3" id="design-responsivo"><span class="header-section-number">1.10.3</span> 3. <strong>Design
responsivo:</strong></h3>
<ul>
<li>Breakpoints em 1200px e 768px</li>
<li>TOC torna-se n√£o-flutuante em telas menores</li>
<li>Container expande conforme o tamanho da tela</li>
</ul>
<h3 data-number="1.10.4" id="clearfix-para-layout-1"><span class="header-section-number">1.10.4</span> 4. <strong>Clearfix para
layout:</strong></h3>
<ul>
<li>Classe <code>.main-content</code> com
<code>overflow: hidden</code></li>
<li>Previne problemas com elementos flutuantes</li>
</ul>
<h3 data-number="1.10.5" id="melhor-aproveitamento-do-espa√ßo"><span class="header-section-number">1.10.5</span> 5. <strong>Melhor
aproveitamento do espa√ßo:</strong></h3>
<ul>
<li>Padding otimizado para desktop</li>
<li>Container usa 95% da largura dispon√≠vel</li>
<li>Layout adaptativo que se expande conforme a tela</li>
</ul>
<p>Agora o HTML deve ocupar praticamente toda a largura dispon√≠vel no
browser, proporcionando uma experi√™ncia de leitura muito melhor em
desktop, enquanto mant√©m a responsividade para dispositivos m√≥veis.</p>
<hr />
<p><em>Conversa exportada do DeepSeek</em> <em>Processado em: 24/11/2025
22:27</em></p>

        <script id="fixed-toc-script">
        document.addEventListener('DOMContentLoaded', function() {
            const toc = document.getElementById('TOC');
            if (toc) {
                const tocTitle = toc.querySelector('h2');
                if (tocTitle) {
                    const toggleBtn = document.createElement('button');
                    toggleBtn.innerHTML = '‚ò∞';
                    toggleBtn.className = 'toc-toggle-btn';
                    toggleBtn.title = 'Minimizar/Expandir TOC';
                    let isMinimized = false;
                    toggleBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        isMinimized = !isMinimized;
                        if (isMinimized) {
                            toc.classList.add('toc-minimized');
                        } else {
                            toc.classList.remove('toc-minimized');
                        }
                    });
                    tocTitle.appendChild(toggleBtn);
                }
            }
            
            // SCROLLSPY
            const sections = document.querySelectorAll('h1, h2, h3, h4, h5');
            const tocLinks = document.querySelectorAll('#TOC a');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.getAttribute('id');
                        tocLinks.forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href') === '#' + id) {
                                link.classList.add('active');
                            }
                        });
                    }
                });
            }, { 
                rootMargin: '-20% 0px -60% 0px', 
                threshold: 0 
            });
            
            sections.forEach(section => {
                if (section.id) observer.observe(section);
            });
            
            // Scroll suave
            tocLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        const offsetTop = targetElement.offsetTop - 80;
                        window.scrollTo({ top: offsetTop, behavior: 'smooth' });
                    }
                });
            });
            
            // BOT√ÉO VOLTAR AO TOPO
            const backToTopBtn = document.createElement('button');
            backToTopBtn.className = 'back-to-top-content';
            backToTopBtn.innerHTML = '‚Üë';
            backToTopBtn.title = 'Voltar ao Topo';
            document.body.appendChild(backToTopBtn);
            
            window.addEventListener('scroll', () => {
                if (window.pageYOffset > 300) {
                    backToTopBtn.classList.add('show');
                } else {
                    backToTopBtn.classList.remove('show');
                }
            });
            
            backToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
        </script>
        
</body>
</html>
