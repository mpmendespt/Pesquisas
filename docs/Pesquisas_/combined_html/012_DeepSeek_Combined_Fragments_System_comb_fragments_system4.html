<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>

        <style id="fixed-toc-styles">
        /* === ESTILOS PRINCIPAIS - TOC FIXO √Ä DIREITA === */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
            scroll-behavior: smooth;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            position: relative;
        }
        /* === TOC FIXO √Ä DIREITA - POSI√á√ÉO CORRIGIDA === */
        #TOC {
            position: fixed !important;
            top: 50% !important;
            right: 20px !important;
            transform: translateY(-50%) !important;
            width: 320px !important;
            max-height: 80vh !important;
            overflow-y: auto !important;
            z-index: 1000 !important;
            background: rgba(255, 255, 255, 0.98) !important;
            padding: 20px !important;
            border-radius: 12px !important;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15) !important;
            border: 1px solid #e0e0e0 !important;
            backdrop-filter: blur(10px) !important;
            transition: all 0.3s ease-in-out !important;
        }
        #TOC.toc-minimized {
            transform: translateY(-50%) translateX(calc(320px - 50px)) !important;
            opacity: 0.3;
            width: 50px !important;
            overflow: hidden;
        }
        #TOC.toc-minimized > *:not(.toc-toggle-btn) {
            display: none !important;
        }
        #TOC h2 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            font-size: 1.2em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .toc-toggle-btn {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .toc-toggle-btn:hover {
            background-color: rgba(0,0,0,0.1);
        }
        #TOC ul {
            list-style-type: none;
            padding-left: 15px;
            margin: 10px 0;
        }
        #TOC ul ul {
            padding-left: 20px;
        }
        #TOC li {
            margin: 8px 0;
            line-height: 1.4;
        }
        #TOC a {
            text-decoration: none;
            color: #495057;
            font-weight: 500;
            transition: all 0.2s ease;
            display: block;
            padding: 6px 10px;
            border-radius: 6px;
            border-left: 3px solid transparent;
        }
        #TOC a:hover {
            color: #007bff;
            background-color: rgba(0, 123, 255, 0.1);
            border-left-color: #007bff;
        }
        #TOC a.active {
            background-color: #007bff !important;
            color: white !important;
            font-weight: bold;
            border-left-color: #0056b3;
        }
        /* Conte√∫do principal com margem para o TOC */
        .main-content {
            margin-right: calc(320px + 40px) !important;
        }
        /* Barra de scroll personalizada APENAS para TOC */
        #TOC::-webkit-scrollbar {
            width: 8px;
        }
        #TOC::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        #TOC::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        #TOC::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        /* === BOT√ÉO VOLTAR AO TOPO (HTMLs individuais) === */
        .back-to-top-content {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .back-to-top-content.show {
            opacity: 1;
            transform: translateY(0);
        }
        .back-to-top-content:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }
        /* === RESPONSIVIDADE === */
        @media (max-width: 1400px) {
            .container {
                max-width: 95%;
                padding: 30px;
            }
            #TOC {
                width: 280px !important;
            }
            .main-content {
                margin-right: 320px !important;
            }
        }
        @media (max-width: 1200px) {
            #TOC {
                width: 260px !important;
                right: 15px !important;
            }
            .main-content {
                margin-right: 300px !important;
            }
        }
        @media (max-width: 992px) {
            #TOC {
                position: relative !important;
                width: 100% !important;
                right: 0 !important;
                top: 0 !important;
                transform: none !important;
                margin: 20px 0;
                max-height: 300px !important;
            }
            .main-content {
                margin-right: 0 !important;
            }
            .back-to-top-content {
                right: 20px;
                bottom: 20px;
            }
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px;
                max-width: 100%;
            }
            #TOC {
                max-height: 250px !important;
                padding: 15px !important;
            }
        }
        </style>
        
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>012_DeepSeek_Combined_Fragments_System_comb_fragments_system4</title>
  <style>

html {
color: #1a1a1a;
background-color: #fdfdfd;
}
body {
margin: 0 auto;
max-width: 36em;
padding-left: 50px;
padding-right: 50px;
padding-top: 50px;
padding-bottom: 50px;
hyphens: auto;
overflow-wrap: break-word;
text-rendering: optimizeLegibility;
font-kerning: normal;
}
@media (max-width: 600px) {
body {
font-size: 0.9em;
padding: 12px;
}
h1 {
font-size: 1.8em;
}
}
@media print {
html {
background-color: white;
}
body {
background-color: transparent;
color: black;
font-size: 12pt;
}
p, h2, h3 {
orphans: 3;
widows: 3;
}
h2, h3, h4 {
page-break-after: avoid;
}
}
p {
margin: 1em 0;
}
a {
color: #1a1a1a;
}
a:visited {
color: #1a1a1a;
}
img {
max-width: 100%;
}
svg {
height: auto;
max-width: 100%;
}
h1, h2, h3, h4, h5, h6 {
margin-top: 1.4em;
}
h5, h6 {
font-size: 1em;
font-style: italic;
}
h6 {
font-weight: normal;
}
ol, ul {
padding-left: 1.7em;
margin-top: 1em;
}
li > ol, li > ul {
margin-top: 0;
}
blockquote {
margin: 1em 0 1em 1.7em;
padding-left: 1em;
border-left: 2px solid #e6e6e6;
color: #606060;
}
code {
font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
font-size: 85%;
margin: 0;
hyphens: manual;
}
pre {
margin: 1em 0;
overflow: auto;
}
pre code {
padding: 0;
overflow: visible;
overflow-wrap: normal;
}
.sourceCode {
background-color: transparent;
overflow: visible;
}
hr {
border: none;
border-top: 1px solid #1a1a1a;
height: 1px;
margin: 1em 0;
}
table {
margin: 1em 0;
border-collapse: collapse;
width: 100%;
overflow-x: auto;
display: block;
font-variant-numeric: lining-nums tabular-nums;
}
table caption {
margin-bottom: 0.75em;
}
tbody {
margin-top: 0.5em;
border-top: 1px solid #1a1a1a;
border-bottom: 1px solid #1a1a1a;
}
th {
border-top: 1px solid #1a1a1a;
padding: 0.25em 0.5em 0.25em 0.5em;
}
td {
padding: 0.125em 0.5em 0.25em 0.5em;
}
header {
margin-bottom: 4em;
text-align: center;
}
#TOC li {
list-style: none;
}
#TOC ul {
padding-left: 1.3em;
}
#TOC > ul {
padding-left: 0;
}
#TOC a:not(:hover) {
text-decoration: none;
}
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}

ul.task-list[class]{list-style: none;}
ul.task-list li input[type="checkbox"] {
font-size: inherit;
width: 0.8em;
margin: 0 0.8em 0.2em -1.6em;
vertical-align: middle;
}

html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
</head>
<body>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#combined-fragments-system-comb_fragments_system4_html_export.py-2" id="toc-combined-fragments-system-comb_fragments_system4_html_export.py-2"><span class="toc-section-number">1</span> Combined Fragments System
comb_fragments_system4_html_export.py 2</a>
<ul>
<li><a href="#informa√ß√µes" id="toc-informa√ß√µes"><span class="toc-section-number">1.1</span> üìä Informa√ß√µes</a></li>
<li><a href="#conversa" id="toc-conversa"><span class="toc-section-number">1.2</span> üí¨ Conversa</a></li>
</ul></li>
</ul>
</nav>
<h1 data-number="1" id="combined-fragments-system-comb_fragments_system4_html_export.py-2"><span class="header-section-number">1</span> Combined Fragments System
comb_fragments_system4_html_export.py 2</h1>
<h2 data-number="1.1" id="informa√ß√µes"><span class="header-section-number">1.1</span> üìä Informa√ß√µes</h2>
<ul>
<li><strong>N√∫mero:</strong> #12</li>
<li><strong>Origem:</strong> DeepSeek</li>
<li><strong>Categoria:</strong> Outros</li>
<li><strong>ID:</strong> 5d283780-dc00-4bac-9e1d-10aaea5c2bdf</li>
<li><strong>Criada em:</strong> 2025-11-08 06:10:01</li>
<li><strong>Atualizada em:</strong> 2025-11-08 08:04:13</li>
<li><strong>Total de mensagens:</strong> 16</li>
<li><strong>Resumo:</strong> Aqui est√°‚Ä¶</li>
</ul>
<hr />
<h2 data-number="1.2" id="conversa"><span class="header-section-number">1.2</span> üí¨ Conversa</h2>
<h3 data-number="1.2.1" id="utilizador-2025-11-08-061004-deepseek-reasoner"><span class="header-section-number">1.2.1</span> üë§ Utilizador <em>(2025-11-08
06:10:04)</em> <em>[deepseek-reasoner]</em></h3>
<p>Aqui est√°</p>
<hr />
<h3 data-number="1.2.2" id="deepseek-2025-11-08-061004-deepseek-reasoner"><span class="header-section-number">1.2.2</span> ü§ñ DeepSeek <em>(2025-11-08
06:10:04)</em> <em>[deepseek-reasoner]</em></h3>
<p>Vamos extrair o comando final em uma √∫nica linha, sem quebras, que
foi discutido no hist√≥rico de conversa.</p>
<p>No hist√≥rico, o usu√°rio pediu para converter o arquivo
<code>exemplo_completo3.md</code> para HTML usando Pandoc, com v√°rias
op√ß√µes para preservar o conte√∫do (f√≥rmulas matem√°ticas, c√≥digo, emojis,
etc.) e que o comando fosse apresentado em uma √∫nica linha, sem usar a
barra invertida para quebras.</p>
<p>O comando final em uma √∫nica linha, que atende a essas necessidades,
√©:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pandoc</span> exemplo_completo3.md <span class="at">--standalone</span> <span class="at">--mathjax</span><span class="op">=</span>https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js <span class="at">--embed-resources</span> <span class="at">--syntax-highlighting</span><span class="op">=</span>pygments <span class="at">--to</span><span class="op">=</span>html5 <span class="at">-o</span> exemplo_completo3.html</span></code></pre></div>
<p>Este comando: - Usa <code>--standalone</code> para gerar um documento
HTML completo. - Usa <code>--mathjax</code> com uma URL espec√≠fica para
renderizar f√≥rmulas matem√°ticas. - Usa <code>--embed-resources</code>
para incorporar CSS, JavaScript e outros recursos no arquivo HTML. - Usa
<code>--syntax-highlighting=pygments</code> para realce de sintaxe do
c√≥digo (substitui o <code>--highlight-style</code> obsoleto). - Usa
<code>--to=html5</code> para gerar HTML</p>
<hr />
<h3 data-number="1.2.3" id="utilizador-2025-11-08-061124-deepseek-reasoner"><span class="header-section-number">1.2.3</span> üë§ Utilizador <em>(2025-11-08
06:11:24)</em> <em>[deepseek-reasoner]</em></h3>
<p>A quest√£o √© <a href="https://chat.deepseek.com/a/chat/s/bbc9c651-5f18-4138-8cc0-8b1107919c28" class="uri">https://chat.deepseek.com/a/chat/s/bbc9c651-5f18-4138-8cc0-8b1107919c28</a>
e <a href="https://chat.deepseek.com/a/chat/s/29e5a40c-3d03-4dd2-82df-68f392158534" class="uri">https://chat.deepseek.com/a/chat/s/29e5a40c-3d03-4dd2-82df-68f392158534</a></p>
<hr />
<h3 data-number="1.2.4" id="deepseek-2025-11-08-061124-deepseek-reasoner"><span class="header-section-number">1.2.4</span> ü§ñ DeepSeek <em>(2025-11-08
06:11:24)</em> <em>[deepseek-reasoner]</em></h3>
<p>First, the user has provided two links to DeepSeek chats. I need to
understand what the question is. Since the links are from DeepSeek, I
should assume that the user wants me to refer to those chats or perhaps
summarize or continue from them. But I don‚Äôt have access to those links
directly because they are specific to the DeepSeek platform. As an AI, I
can only work with the text provided.</p>
<p>The user said: ‚ÄúA quest√£o √©‚Äù which means ‚ÄúThe question is‚Äù in
Portuguese, and then provided two URLs. But the URLs are not the
question itself; they point to previous chats. I need to infer what the
user is asking.</p>
<p>Perhaps the user wants me to look at those chats and answer based on
them, but since I can‚Äôt access them, I might need to ask for more
information. However, the user might have copied the content from those
chats into this message, but in this case, only the links are
provided.</p>
<p>Let me check the links: they are from ‚Äúchat.deepseek.com‚Äù which is
the platform I‚Äôm on, but as an AI, I don‚Äôt have browsing capabilities to
open those links. My system prompt says I can only process text and
files uploaded by the user.</p>
<p>So, I should respond by stating that I cannot access external links
and request that the user paste the relevant content from those chats
here.</p>
<p>But let‚Äôs think about the context. The user might be referring to
previous conversations we had, but since this is a new session, I don‚Äôt
have memory of those chats. The links might be to other chats that the
user had with me, but in this instance, I don‚Äôt have access to that
history.</p>
<p>Therefore, the best approach is to politely explain that I cannot
access the links and ask the user to provide the question or the content
directly.</p>
<p>My response should be in Portuguese since the user started in
Portuguese.</p>
<p>So, I‚Äôll say: ‚ÄúDesculpe, mas n√£o consigo acessar links externos. Por
favor, copie e cole o conte√∫do das conversas ou me diga qual √© a sua
pergunta diretamente aqui.‚Äù</p>
<p>That means: ‚ÄúSorry, but I cannot access external links. Please copy
and paste the content of the conversations or tell me your question
directly here.‚Äù</p>
<p>This seems reasonable. I don‚Äôt want to assume anything about the
question without more information. Desculpe, mas n√£o consigo acessar
links externos, incluindo os que voc√™ forneceu do chat.deepseek.com.
Como assistente de IA, s√≥ posso processar textos e arquivos enviados
diretamente aqui.</p>
<p>Para que eu possa ajud√°-lo, por favor, copie e cole o conte√∫do
relevante dessas conversas ou me diga qual √© a sua pergunta diretamente
nesta mensagem. Estou aqui para ajudar!</p>
<hr />
<h3 data-number="1.2.5" id="utilizador-2025-11-08-061257-deepseek-reasoner"><span class="header-section-number">1.2.5</span> üë§ Utilizador <em>(2025-11-08
06:12:57)</em> <em>[deepseek-reasoner]</em></h3>
<p>Continuando a analise anterior. Pretende-se a correc√ß√£o relativa a
Qwen on algumas partes das conversa n√£o aparecem. Mas pretende-se manter
todas as outras funcionalidades que funcionam bem, com deepseek, chatgpt
ou grok.</p>
<hr />
<h3 data-number="1.2.6" id="deepseek-2025-11-08-061257-deepseek-reasoner"><span class="header-section-number">1.2.6</span> ü§ñ DeepSeek <em>(2025-11-08
06:12:57)</em> <em>[deepseek-reasoner]</em></h3>
<p>Vamos focar na corre√ß√£o do processador Qwen, mantendo as outras
funcionalidades intactas. O problema reportado √© que algumas partes das
conversas do Qwen n√£o aparecem.</p>
<p>Analisando o c√≥digo, o m√©todo <code>process_qwen_enhanced</code> √©
respons√°vel por processar o Qwen. Nele, h√° uma chamada para
<code>_extract_all_qwen_messages</code> que usa m√∫ltiplas estrat√©gias
para extrair mensagens.</p>
<p>No entanto, notei que na estrat√©gia 1 (Hist√≥rico de chat) h√° uma
sub-estrat√©gia 1A que extrai mensagens de um dicion√°rio e 1B de uma
lista. Mas observei que a fun√ß√£o
<code>_extract_from_messages_dict</code> e
<code>_extract_from_messages_list</code> podem n√£o estar capturando toda
a estrutura.</p>
<p>Al√©m disso, notei que o m√©todo <code>_process_qwen_content</code>
pode n√£o estar lidando com todos os tipos de conte√∫do, especialmente
quando o conte√∫do √© uma lista de blocos.</p>
<p>Vamos revisar a fun√ß√£o <code>_process_qwen_content</code> para
garantir que est√° extraindo todo o texto dos blocos.</p>
<p>Outro ponto: a fun√ß√£o <code>_extract_all_qwen_messages</code> pode
n√£o estar considerando todas as poss√≠veis localiza√ß√µes das
mensagens.</p>
<p>Vamos tamb√©m adicionar mais logs para debug e tentar extrair de mais
locais.</p>
<p>No entanto, como o problema √© espec√≠fico do Qwen e n√£o queremos
afetar os outros, vamos focar apenas no processador Qwen.</p>
<p>Proposta de altera√ß√µes:</p>
<ol type="1">
<li><p>Melhorar a fun√ß√£o <code>_process_qwen_content</code> para lidar
com todos os tipos de blocos que podem aparecer no Qwen. Atualmente, ela
s√≥ processa blocos do tipo ‚Äòtext‚Äô e ‚Äòimage‚Äô. Vamos tentar extrair texto
de qualquer bloco que tenha um campo ‚Äòtext‚Äô ou ‚Äòcontent‚Äô.</p></li>
<li><p>Na extra√ß√£o de mensagens, vamos tamb√©m tentar extrair de mais
campos, como ‚Äòcontent‚Äô direto da mensagem, al√©m de ‚Äòparts‚Äô.</p></li>
<li><p>Vamos adicionar uma estrat√©gia de fallback que tenta extrair
mensagens de qualquer campo que seja uma lista e que contenha objetos
com ‚Äòrole‚Äô e ‚Äòcontent‚Äô.</p></li>
<li><p>Vamos tamb√©m melhorar a remo√ß√£o de duplicatas, pois pode estar
removendo mensagens leg√≠timas.</p></li>
<li><p>Vamos adicionar mais logs para entender quais mensagens est√£o
sendo extra√≠das.</p></li>
</ol>
<p>Vamos implementar essas altera√ß√µes passo a passo.</p>
<p>Primeiro, vamos melhorar <code>_process_qwen_content</code>:</p>
<ul>
<li>Se o conte√∫do for uma string, retorna a string.</li>
<li>Se for uma lista, percorre cada item:
<ul>
<li>Se o item for string, adiciona.</li>
<li>Se for dicion√°rio, tenta obter o texto dos campos ‚Äòtext‚Äô, ‚Äòcontent‚Äô,
ou qualquer campo que possa conter texto.</li>
</ul></li>
<li>Se for dicion√°rio, tenta extrair texto dos campos.</li>
</ul>
<p>Vamos reescrever a fun√ß√£o <code>_process_qwen_content</code> para ser
mais robusta.</p>
<p>Segundo, vamos modificar <code>_extract_from_messages_dict</code> e
<code>_extract_from_messages_list</code> para tamb√©m olhar para o campo
‚Äòcontent‚Äô da mensagem, se existir, e process√°-lo.</p>
<p>Terceiro, vamos adicionar uma estrat√©gia 5: extrair mensagens de
qualquer campo que seja uma lista e que contenha objetos com ‚Äòrole‚Äô e
‚Äòcontent‚Äô.</p>
<p>No entanto, para n√£o quebrar o que j√° funciona, vamos fazer isso de
forma incremental e com logs.</p>
<p>Vamos come√ßar pela fun√ß√£o <code>_process_qwen_content</code>:</p>
<p>Vamos criar uma fun√ß√£o auxiliar recursiva para extrair texto de
qualquer estrutura.</p>
<p>Devido √† complexidade, vou propor uma fun√ß√£o
<code>_extract_text_from_any</code> que tenta extrair texto de qualquer
objeto.</p>
<p>Vamos tamb√©m modificar a fun√ß√£o
<code>_extract_all_qwen_messages</code> para incluir a nova
estrat√©gia.</p>
<p>Como tempo √© curto, vou focar em melhorar a extra√ß√£o de texto e a
extra√ß√£o de mensagens.</p>
<p>Vamos refatorar <code>_process_qwen_content</code> para usar a nova
fun√ß√£o <code>_extract_text_from_any</code>:</p>
<p>Vamos criar:</p>
<p>def _extract_text_from_any(self, obj: Any) -&gt; str:</p>
<p>Esta fun√ß√£o vai tentar extrair texto de obj, que pode ser string,
lista, dicion√°rio, etc.</p>
<p>Vamos us√°-la em <code>_process_qwen_content</code>:</p>
<p>final_content = self._extract_text_from_any(content)</p>
<p>E remover a l√≥gica atual.</p>
<p>Vamos implementar <code>_extract_text_from_any</code>:</p>
<ul>
<li>Se obj for string, retorna a string.</li>
<li>Se for lista, concatena o resultado de
<code>_extract_text_from_any</code> para cada item.</li>
<li>Se for dicion√°rio, procura por chaves como ‚Äòtext‚Äô, ‚Äòcontent‚Äô,
‚Äòvalue‚Äô, ‚Äòmessage‚Äô e chama recursivamente.</li>
<li>Se for outro tipo, converte para string.</li>
</ul>
<p>Vamos tamb√©m limitar o tamanho do texto para evitar problemas, mas
n√£o vamos truncar agora.</p>
<p>Vamos tamb√©m modificar a extra√ß√£o de mensagens para usar essa nova
fun√ß√£o.</p>
<p>Vamos tamb√©m adicionar uma estrat√©gia 5 em
<code>_extract_all_qwen_messages</code> que procura por qualquer lista
que contenha objetos com ‚Äòrole‚Äô e ‚Äòcontent‚Äô na conversa.</p>
<p>Vamos fazer isso depois de testar as melhorias na extra√ß√£o de
texto.</p>
<p>Vamos implementar a fun√ß√£o <code>_extract_text_from_any</code>:</p>
<p>Vamos tamb√©m adicionar um par√¢metro opcional <code>max_depth</code>
para evitar recurs√£o infinita.</p>
<p>Vamos come√ßar com max_depth=5.</p>
<p>Vamos implementar:</p>
<p>def _extract_text_from_any(self, obj: Any, depth=0) -&gt; str: if
depth &gt; 5: return ‚Äú‚Äù</p>
<pre><code>    if isinstance(obj, str):
        return obj
    elif isinstance(obj, list):
        texts = []
        for item in obj:
            text = self._extract_text_from_any(item, depth+1)
            if text:
                texts.append(text)
        return &quot;\n&quot;.join(texts)
    elif isinstance(obj, dict):
        # Ordem de prioridade das chaves
        for key in [&#39;text&#39;, &#39;content&#39;, &#39;value&#39;, &#39;message&#39;, &#39;input&#39;, &#39;output&#39;]:
            if key in obj:
                text = self._extract_text_from_any(obj[key], depth+1)
                if text:
                    return text
        # Se n√£o encontrou, tenta extrair de todos os valores
        texts = []
        for value in obj.values():
            text = self._extract_text_from_any(value, depth+1)
            if text:
                texts.append(text)
        return &quot;\n&quot;.join(texts)
    else:
        return str(obj) if obj is not None else &quot;&quot;</code></pre>
<p>Vamos substituir o uso de <code>_process_qwen_content</code> por esta
nova fun√ß√£o.</p>
<p>Na verdade, vamos manter <code>_process_qwen_content</code> mas vamos
reimplement√°-la usando <code>_extract_text_from_any</code>.</p>
<p>Vamos modificar <code>_process_qwen_content</code>:</p>
<p>def _process_qwen_content(self, content) -&gt; str: if not content:
return ‚Äú‚Äù extracted = self._extract_text_from_any(content) return
self.preserve_special_content(extracted)</p>
<p>Vamos tamb√©m modificar a extra√ß√£o de mensagens para usar
<code>_extract_text_from_any</code> no conte√∫do.</p>
<p>Vamos remover a l√≥gica de extra√ß√£o de partes que t√≠nhamos antes.</p>
<p>Vamos testar com um exemplo complexo.</p>
<p>Vamos tamb√©m adicionar a estrat√©gia 5 em
<code>_extract_all_qwen_messages</code>:</p>
<p># ESTRAT√âGIA 5: Busca por listas de mensagens em qualquer campo
self.logger.info(f‚Äù üîç Estrat√©gia 5: Busca por listas de mensagens‚Äù)
extracted = self._deep_search_message_lists(conv)
all_messages.extend(extracted) self.logger.info(f‚Äù üìä 5:
{len(extracted)} mensagens de busca por listas‚Äù)</p>
<p>E implementar <code>_deep_search_message_lists</code>:</p>
<p>def _deep_search_message_lists(self, obj, path=‚Äú‚Äú) -&gt;
List[Dict[str, Any]]: messages_found = []</p>
<pre><code>    if isinstance(obj, list):
        # Verifica se esta lista √© uma lista de mensagens (objetos com role e content)
        if all(isinstance(item, dict) and &#39;role&#39; in item and &#39;content&#39; in item for item in obj):
            extracted = self._extract_from_messages_list(obj)
            messages_found.extend(extracted)
        else:
            for item in obj:
                messages_found.extend(self._deep_search_message_lists(item, path))
    elif isinstance(obj, dict):
        for key, value in obj.items():
            messages_found.extend(self._deep_search_message_lists(value, f&quot;{path}.{key}&quot;))

    return messages_found</code></pre>
<p>Vamos adicionar essa fun√ß√£o.</p>
<p>Vamos tamb√©m modificar a fun√ß√£o <code>_deep_search_messages</code>
para tamb√©m procurar por objetos de mensagem (com role e content) que
estejam soltos.</p>
<p>Vamos unificar a l√≥gica de reconhecimento de mensagem em
<code>_is_message_object</code>:</p>
<p>def _is_message_object(self, obj: Dict) -&gt; bool: return
(isinstance(obj, dict) and ‚Äòrole‚Äô in obj and ‚Äòcontent‚Äô in obj and
obj.get(‚Äòrole‚Äô) in [‚Äòuser‚Äô, ‚Äòassistant‚Äô] and obj.get(‚Äòcontent‚Äô))</p>
<p>E em <code>_create_message_from_object</code> vamos usar
<code>_extract_text_from_any</code> para o conte√∫do.</p>
<p>Vamos modificar <code>_create_message_from_object</code>:</p>
<p>final_content = self._extract_text_from_any(content)</p>
<p>Vamos tamb√©m modificar <code>_extract_from_messages_list</code> e
<code>_extract_from_messages_dict</code> para usar
<code>_extract_text_from_any</code> no conte√∫do.</p>
<p>Vamos fazer essas altera√ß√µes e ver se resolve o problema.</p>
<p>Como s√£o muitas altera√ß√µes, vamos faz√™-las uma a uma e testar.</p>
<p>Vamos come√ßar pela fun√ß√£o <code>_extract_text_from_any</code> e sua
integra√ß√£o.</p>
<p>Depois, vamos para a estrat√©gia 5.</p>
<p>Vamos tamb√©m adicionar logs para ver o que est√° sendo extra√≠do.</p>
<p>Vamos modificar o c√≥digo conforme descrito.</p>
<p>Nota: Vamos manter o fallback para o m√©todo antigo em caso de erro,
mas a inten√ß√£o √© substituir.</p>
<p>Vamos implementar a fun√ß√£o <code>_extract_text_from_any</code> e
substituir o processamento de conte√∫do.</p>
<p>Vamos tamb√©m modificar a fun√ß√£o
<code>_deep_search_message_lists</code> e adicion√°-la.</p>
<p>Vamos modificar o m√©todo <code>_extract_all_qwen_messages</code> para
incluir a estrat√©gia 5.</p>
<p>Vamos tamb√©m modificar a fun√ß√£o <code>_deep_search_messages</code>
para usar a nova fun√ß√£o de extra√ß√£o de texto.</p>
<p>Vamos fazer isso passo a passo.</p>
<p>Primeiro, a fun√ß√£o <code>_extract_text_from_any</code>:</p>
<p>Vamos adicionar a fun√ß√£o:</p>
<p>def _extract_text_from_any(self, obj: Any, depth=0) -&gt; str: if
depth &gt; 5: return ‚Äú‚Äù</p>
<pre><code>    if isinstance(obj, str):
        return obj
    elif isinstance(obj, list):
        texts = []
        for item in obj:
            text = self._extract_text_from_any(item, depth+1)
            if text:
                texts.append(text)
        return &quot;\n&quot;.join(texts)
    elif isinstance(obj, dict):
        # Ordem de prioridade das chaves
        for key in [&#39;text&#39;, &#39;content&#39;, &#39;value&#39;, &#39;message&#39;, &#39;input&#39;, &#39;output&#39;]:
            if key in obj:
                text = self._extract_text_from_any(obj[key], depth+1)
                if text:
                    return text
        # Se n√£o encontrou, tenta extrair de todos os valores
        texts = []
        for value in obj.values():
            text = self._extract_text_from_any(value, depth+1)
            if text:
                texts.append(text)
        return &quot;\n&quot;.join(texts)
    else:
        return str(obj) if obj is not None else &quot;&quot;</code></pre>
<p>Segundo, modificar <code>_process_qwen_content</code>:</p>
<p>def _process_qwen_content(self, content) -&gt; str: if not content:
return ‚Äú‚Äù extracted = self._extract_text_from_any(content) return
self.preserve_special_content(extracted)</p>
<p>Terceiro, modificar <code>_create_message_from_object</code>:</p>
<p>final_content = self._process_qwen_content(content)</p>
<p>(j√° est√° chamando <code>_process_qwen_content</code>)</p>
<p>Quarto, modificar <code>_extract_from_messages_list</code> e
<code>_extract_from_messages_dict</code> para usar
<code>_process_qwen_content</code> no conte√∫do.</p>
<p>J√° est√£o usando? Vamos ver:</p>
<p>No <code>_extract_from_messages_list</code>:</p>
<p>final_content = self._process_qwen_content(content)</p>
<p>No <code>_extract_from_messages_dict</code>:</p>
<p>final_content = self._process_qwen_content(content)</p>
<p>Est√£o sim.</p>
<p>Quinto, adicionar a estrat√©gia 5 em
<code>_extract_all_qwen_messages</code>:</p>
<p># ESTRAT√âGIA 5: Busca por listas de mensagens em qualquer campo
self.logger.info(f‚Äù üîç Estrat√©gia 5: Busca por listas de mensagens‚Äù)
extracted = self._deep_search_message_lists(conv)
all_messages.extend(extracted) self.logger.info(f‚Äù üìä 5:
{len(extracted)} mensagens de busca por listas‚Äù)</p>
<p>Sexto, implementar <code>_deep_search_message_lists</code>:</p>
<p>def _deep_search_message_lists(self, obj, path=‚Äú‚Äú) -&gt;
List[Dict[str, Any]]: messages_found = []</p>
<pre><code>    if isinstance(obj, list):
        # Verifica se esta lista √© uma lista de mensagens (objetos com role e content)
        if all(isinstance(item, dict) and &#39;role&#39; in item and &#39;content&#39; in item for item in obj):
            extracted = self._extract_from_messages_list(obj)
            messages_found.extend(extracted)
        else:
            for item in obj:
                messages_found.extend(self._deep_search_message_lists(item, path))
    elif isinstance(obj, dict):
        for key, value in obj.items():
            messages_found.extend(self._deep_search_message_lists(value, f&quot;{path}.{key}&quot;))

    return messages_found</code></pre>
<p>S√©timo, vamos modificar a fun√ß√£o <code>_deep_search_messages</code>
para tamb√©m usar <code>_extract_text_from_any</code>? Na verdade,
<code>_deep_search_messages</code> j√° usa
<code>_create_message_from_object</code> que por sua vez usa
<code>_process_qwen_content</code> que agora usa
<code>_extract_text_from_any</code>.</p>
<p>Acho que j√° est√°.</p>
<p>Vamos tamb√©m modificar a fun√ß√£o
<code>_search_alternative_structures</code> para usar a nova extra√ß√£o de
texto? Ela chama <code>_extract_from_messages_list</code> e
<code>_extract_from_messages_dict</code> que j√° usam
<code>_process_qwen_content</code>.</p>
<p>Acho que sim.</p>
<p>Vamos testar com um arquivo Qwen que n√£o estava funcionando.</p>
<p>Se n√£o funcionar, podemos adicionar mais logs.</p>
<p>Vamos tamb√©m adicionar um log em <code>_extract_text_from_any</code>
para ver o que est√° sendo extra√≠do? Talvez apenas em modo debug.</p>
<p>Vamos adicionar um log opcional.</p>
<p>Vamos modificar a fun√ß√£o <code>_extract_text_from_any</code> para
logar quando depth=0 e o resultado.</p>
<p>def _extract_text_from_any(self, obj: Any, depth=0) -&gt; str: if
depth &gt; 5: return ‚Äú‚Äù</p>
<pre><code>    if depth == 0:
        self.logger.debug(f&quot;Extracting text from: {type(obj)}&quot;)

    ... o resto ...

    result = ... 
    if depth == 0:
        self.logger.debug(f&quot;Extracted text: {result[:100]}...&quot;)

    return result</code></pre>
<p>Mas vamos tomar cuidado para n√£o logar demais.</p>
<p>Vamos fazer isso apenas se um flag de debug estiver ativo.</p>
<p>Vamos adicionar um flag <code>debug_extraction</code> na classe e
us√°-lo.</p>
<p>Vamos inicializar com <code>debug_extraction=False</code> e, se
necess√°rio, ativar via argumento.</p>
<p>Por enquanto, vamos deixar False.</p>
<p>Vamos fazer as altera√ß√µes e ver se resolve.</p>
<p>Vamos tamb√©m adicionar uma estrat√©gia 6: extrair mensagens de campos
que s√£o listas de listas? Acho que por enquanto n√£o.</p>
<p>Vamos implementar o descrito.</p>
<p>Vamos modificar o c√≥digo. Analisando o c√≥digo, identifiquei o
problema com o processamento do Qwen. O sistema est√° funcionando bem
para DeepSeek, ChatGPT e Grok, mas precisa de corre√ß√µes espec√≠ficas para
o Qwen. Vou fornecer as corre√ß√µes necess√°rias:</p>
<p><strong>Problemas identificados no processamento Qwen:</strong></p>
<ol type="1">
<li><strong>Estrutura de dados complexa e vari√°vel</strong> - O Qwen tem
m√∫ltiplas formas de armazenar mensagens</li>
<li><strong>Conte√∫do em formato de lista</strong> - As mensagens podem
vir como listas de blocos</li>
<li><strong>Campos aninhados</strong> - As mensagens est√£o em estruturas
profundamente aninhadas</li>
</ol>
<p><strong>Corre√ß√µes espec√≠ficas para o Qwen:</strong></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_qwen_enhanced(<span class="va">self</span>, path: Path):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Processa Qwen3 com preserva√ß√£o total de conte√∫do - VERS√ÉO CORRIGIDA&quot;&quot;&quot;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria Qwen3: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            raw_data <span class="op">=</span> json.load(f)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># DEBUG: Salvar estrutura completa para an√°lise</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        debug_file <span class="op">=</span> Path(<span class="st">&quot;qwen_debug_structure.json&quot;</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(debug_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>            json.dump(raw_data, f, indent<span class="op">=</span><span class="dv">2</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Estrutura Qwen salva em: </span><span class="sc">{</span>debug_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estrat</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="op">---</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">### üë§ Utilizador *(2025-11-08 06:15:09)* *[deepseek-reasoner]*</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>https:<span class="op">//</span>chat.deepseek.com<span class="op">/</span>a<span class="op">/</span>chat<span class="op">/</span>s<span class="op">/</span>bbc9c651<span class="op">-</span><span class="dv">5</span><span class="er">f18</span><span class="op">-</span><span class="dv">4138</span><span class="op">-</span><span class="dv">8</span><span class="er">cc0</span><span class="op">-</span><span class="dv">8</span><span class="er">b1107919c28</span>  (Pesquisas) D:\Downloads\_DOCS_\_DOCS_\Pesquisas__D_C_G_Qwen_Op<span class="op">&gt;</span>python analyze_chat.py</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>üîç ANALISADOR DE CHAT<span class="op">-</span>EXPORT.JSON</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="op">============================================================</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>üìä Total de conversas encontradas: <span class="dv">11</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>üí¨ CONVERSA <span class="dv">1</span>: Converter MD para HTML Preservando Conte√∫do</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>   ID: be91a6cf<span class="op">-</span>dc23<span class="op">-</span><span class="dv">44</span><span class="er">bf</span><span class="op">-</span><span class="fl">979e-6</span><span class="er">ec21545643b</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>   üì® Total de mensagens nesta conversa: <span class="dv">50</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>üí¨ CONVERSA <span class="dv">2</span>: Teste de files Python</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>   ID: f58b67ea<span class="op">-</span><span class="dv">3962</span><span class="op">-</span><span class="dv">4</span><span class="er">be7</span><span class="op">-</span><span class="fl">9e69</span><span class="op">-</span>cb567846762f</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>   üì® Total de mensagens nesta conversa: <span class="dv">26</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>üí¨ CONVERSA <span class="dv">3</span>: Convert MD to HTML <span class="kw">and</span> PDF</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>   ID: a81057ae<span class="op">-</span>a784<span class="op">-</span><span class="dv">49</span><span class="er">c1</span><span class="op">-</span>bb4c<span class="op">-</span><span class="dv">2</span><span class="er">fc5deaaaf43</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>   üì® Total de mensagens nesta conversa: <span class="dv">42</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>üí¨ CONVERSA <span class="dv">4</span>: HTML to PDF Conversion <span class="cf">with</span> Python</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>   ID: f29c5183<span class="op">-</span><span class="dv">7</span><span class="er">fdf</span><span class="op">-</span><span class="dv">4279</span><span class="op">-</span><span class="dv">9313</span><span class="op">-</span>a31f5fa3b504</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>   üì® Total de mensagens nesta conversa: <span class="dv">9</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>üí¨ CONVERSA <span class="dv">5</span>: Sistema Combinado AI Chats</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>   ID: e8a3f71e<span class="op">-</span><span class="dv">7</span><span class="er">d74</span><span class="op">-</span><span class="dv">42</span><span class="er">a9</span><span class="op">-</span><span class="fl">9e9</span><span class="er">d</span><span class="op">-</span><span class="fl">5e814</span><span class="er">ed52c12</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>   üì® Total de mensagens nesta conversa: <span class="dv">64</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>üí¨ CONVERSA <span class="dv">6</span>: Python Advanced File Explanation</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>   ID: <span class="dv">8</span><span class="er">bb4b724</span><span class="op">-</span><span class="dv">4</span><span class="er">a18</span><span class="op">-</span><span class="dv">42</span><span class="er">cb</span><span class="op">-</span>b7d5<span class="op">-</span><span class="dv">5</span><span class="er">cc67edca710</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>   üì® Total de mensagens nesta conversa: <span class="dv">72</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>üí¨ CONVERSA <span class="dv">7</span>: Converter Markdown PDF Windows Conda</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>   ID: <span class="dv">329777</span><span class="er">d5</span><span class="op">-</span><span class="dv">82</span><span class="er">b9</span><span class="op">-</span><span class="dv">4</span><span class="er">a35</span><span class="op">-</span><span class="dv">9</span><span class="er">fcf</span><span class="op">-</span><span class="dv">0</span><span class="er">32fc96eafbb</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>   üì® Total de mensagens nesta conversa: <span class="dv">2</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>üí¨ CONVERSA <span class="dv">8</span>: Python Advanced Optimiza√ß√£o de Export Qwen</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>   ID: <span class="dv">4546281</span><span class="er">d</span><span class="op">-</span><span class="dv">7661</span><span class="op">-</span><span class="dv">4</span><span class="er">c2d</span><span class="op">-</span>b2b3<span class="op">-</span><span class="dv">793</span><span class="er">b53657e4d</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>   üì® Total de mensagens nesta conversa: <span class="dv">14</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>üí¨ CONVERSA <span class="dv">9</span>: Dieta Saud√°vel para Pequeno<span class="op">-</span>Almo√ßo</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>   ID: <span class="dv">729</span><span class="er">b23a6</span><span class="op">-</span><span class="dv">20</span><span class="er">c5</span><span class="op">-</span><span class="dv">46</span><span class="er">b9</span><span class="op">-</span><span class="dv">93</span><span class="er">f9</span><span class="op">-</span><span class="dv">0</span><span class="er">4ffbbb32b44</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>   üì® Total de mensagens nesta conversa: <span class="dv">8</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>üí¨ CONVERSA <span class="dv">10</span>: Autom√≥veis Diesel Fi√°veis em Portugal</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>   ID: <span class="dv">42</span><span class="er">c0aa8a</span><span class="op">-</span><span class="dv">8</span><span class="er">f1a</span><span class="op">-</span><span class="dv">4585</span><span class="op">-</span>aede<span class="op">-</span>f7247b0b1a25</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>   üì® Total de mensagens nesta conversa: <span class="dv">2</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>üí¨ CONVERSA <span class="dv">11</span>: Perguntas em Portugu√™s</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>   ID: c956c3c0<span class="op">-</span><span class="dv">8</span><span class="er">df9</span><span class="op">-</span><span class="dv">4</span><span class="er">f5d</span><span class="op">-</span><span class="dv">948</span><span class="er">b</span><span class="op">-</span>b429c827cef4</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>   üì® Total de mensagens nesta conversa: <span class="dv">8</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>üìà RELAT√ìRIO DE AN√ÅLISE</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a><span class="op">============================================================</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>üì® Total de mensagens: <span class="dv">297</span></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>üë§ Mensagens do usu√°rio: <span class="dv">148</span></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>ü§ñ Mensagens do assistente: <span class="dv">149</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>üîß ESTAT√çSTICAS DO ASSISTENTE:</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ Content vazio: <span class="dv">144</span><span class="op">/</span><span class="dv">149</span> (<span class="fl">96.6</span><span class="op">%</span>)</span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ Com content_list: <span class="dv">144</span><span class="op">/</span><span class="dv">149</span> (<span class="fl">96.6</span><span class="op">%</span>)</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>ü§ñ MODELOS UTILIZADOS:</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ qwen3<span class="op">-</span><span class="bu">max</span><span class="op">-</span><span class="dv">2025</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">30</span>: <span class="dv">144</span></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ qwen<span class="op">-</span>plus<span class="op">-</span>latest: <span class="dv">5</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>üìã ESTAT√çSTICAS DO CONTENT_LIST:</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ Status <span class="st">&#39;finished&#39;</span>: <span class="dv">195</span></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ Fase <span class="st">&#39;answer&#39;</span>: <span class="dv">144</span></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ Content_list com <span class="dv">1</span> itens: <span class="dv">115</span></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ Fase <span class="st">&#39;think&#39;</span>: <span class="dv">39</span></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ Content_list com <span class="dv">2</span> itens: <span class="dv">22</span></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ Fase <span class="st">&#39;web_search&#39;</span>: <span class="dv">12</span></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ Content_list com <span class="dv">4</span> itens: <span class="dv">5</span></span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ Content_list com <span class="dv">8</span> itens: <span class="dv">2</span></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>üö® PADR√ïES PROBLEM√ÅTICOS IDENTIFICADOS:</span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ Total de padr√µes problem√°ticos: <span class="dv">144</span></span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>     <span class="fl">1.</span> Chat: be91a6cf...</span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>        Mensagem: <span class="dv">53</span><span class="er">f53724</span>...</span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>        Modelo: qwen3<span class="op">-</span><span class="bu">max</span><span class="op">-</span><span class="dv">2025</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">30</span></span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>        Content vazio: <span class="dv">0</span> chars</span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>        Content_list: <span class="dv">1</span> itens</span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>        Conte√∫do real: <span class="dv">4205</span> chars</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>        Fase: answer</span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>     <span class="fl">2.</span> Chat: be91a6cf...</span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>        Mensagem: e2cbc6ed...</span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>        Modelo: qwen3<span class="op">-</span><span class="bu">max</span><span class="op">-</span><span class="dv">2025</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">30</span></span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>        Content vazio: <span class="dv">0</span> chars</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>        Content_list: <span class="dv">2</span> itens</span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>        Conte√∫do real: <span class="dv">1390</span> chars</span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>        Fase: answer</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>     <span class="fl">3.</span> Chat: be91a6cf...</span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>        Mensagem: a20b7f4c...</span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>        Modelo: qwen3<span class="op">-</span><span class="bu">max</span><span class="op">-</span><span class="dv">2025</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">30</span></span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>        Content vazio: <span class="dv">0</span> chars</span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>        Content_list: <span class="dv">4</span> itens</span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>        Conte√∫do real: <span class="dv">1835</span> chars</span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>        Fase: answer</span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a>     <span class="fl">4.</span> Chat: be91a6cf...</span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>        Mensagem: <span class="dv">45358</span><span class="er">c01</span>...</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>        Modelo: qwen3<span class="op">-</span><span class="bu">max</span><span class="op">-</span><span class="dv">2025</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">30</span></span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a>        Content vazio: <span class="dv">0</span> chars</span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>        Content_list: <span class="dv">2</span> itens</span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>        Conte√∫do real: <span class="dv">7822</span> chars</span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>        Fase: answer</span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a>     <span class="fl">5.</span> Chat: be91a6cf...</span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>        Mensagem: f1e5af8e...</span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>        Modelo: qwen3<span class="op">-</span><span class="bu">max</span><span class="op">-</span><span class="dv">2025</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">30</span></span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>        Content vazio: <span class="dv">0</span> chars</span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>        Content_list: <span class="dv">8</span> itens</span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a>        Conte√∫do real: <span class="dv">3620</span> chars</span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a>        Fase: answer</span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a>     <span class="fl">6.</span> Chat: be91a6cf...</span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a>        Mensagem: <span class="dv">2</span><span class="er">f6edf41</span>...</span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a>        Modelo: qwen3<span class="op">-</span><span class="bu">max</span><span class="op">-</span><span class="dv">2025</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">30</span></span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a>        Content vazio: <span class="dv">0</span> chars</span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a>        Content_list: <span class="dv">4</span> itens</span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a>        Conte√∫do real: <span class="dv">3168</span> chars</span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a>        Fase: answer</span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a>     <span class="fl">7.</span> Chat: be91a6cf...</span>
<span id="cb7-147"><a href="#cb7-147" aria-hidden="true" tabindex="-1"></a>        Mensagem: <span class="dv">20</span><span class="er">a529af</span>...</span>
<span id="cb7-148"><a href="#cb7-148" aria-hidden="true" tabindex="-1"></a>        Modelo: qwen3<span class="op">-</span><span class="bu">max</span><span class="op">-</span><span class="dv">2025</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">30</span></span>
<span id="cb7-149"><a href="#cb7-149" aria-hidden="true" tabindex="-1"></a>        Content vazio: <span class="dv">0</span> chars</span>
<span id="cb7-150"><a href="#cb7-150" aria-hidden="true" tabindex="-1"></a>        Content_list: <span class="dv">4</span> itens</span>
<span id="cb7-151"><a href="#cb7-151" aria-hidden="true" tabindex="-1"></a>        Conte√∫do real: <span class="dv">6214</span> chars</span>
<span id="cb7-152"><a href="#cb7-152" aria-hidden="true" tabindex="-1"></a>        Fase: answer</span>
<span id="cb7-153"><a href="#cb7-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-154"><a href="#cb7-154" aria-hidden="true" tabindex="-1"></a>     <span class="fl">8.</span> Chat: be91a6cf...</span>
<span id="cb7-155"><a href="#cb7-155" aria-hidden="true" tabindex="-1"></a>        Mensagem: f1cd62a5...</span>
<span id="cb7-156"><a href="#cb7-156" aria-hidden="true" tabindex="-1"></a>        Modelo: qwen3<span class="op">-</span><span class="bu">max</span><span class="op">-</span><span class="dv">2025</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">30</span></span>
<span id="cb7-157"><a href="#cb7-157" aria-hidden="true" tabindex="-1"></a>        Content vazio: <span class="dv">0</span> chars</span>
<span id="cb7-158"><a href="#cb7-158" aria-hidden="true" tabindex="-1"></a>        Content_list: <span class="dv">2</span> itens</span>
<span id="cb7-159"><a href="#cb7-159" aria-hidden="true" tabindex="-1"></a>        Conte√∫do real: <span class="dv">5363</span> chars</span>
<span id="cb7-160"><a href="#cb7-160" aria-hidden="true" tabindex="-1"></a>        Fase: answer</span>
<span id="cb7-161"><a href="#cb7-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-162"><a href="#cb7-162" aria-hidden="true" tabindex="-1"></a>     <span class="fl">9.</span> Chat: be91a6cf...</span>
<span id="cb7-163"><a href="#cb7-163" aria-hidden="true" tabindex="-1"></a>        Mensagem: <span class="fl">34e16</span><span class="er">fbb</span>...</span>
<span id="cb7-164"><a href="#cb7-164" aria-hidden="true" tabindex="-1"></a>        Modelo: qwen3<span class="op">-</span><span class="bu">max</span><span class="op">-</span><span class="dv">2025</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">30</span></span>
<span id="cb7-165"><a href="#cb7-165" aria-hidden="true" tabindex="-1"></a>        Content vazio: <span class="dv">0</span> chars</span>
<span id="cb7-166"><a href="#cb7-166" aria-hidden="true" tabindex="-1"></a>        Content_list: <span class="dv">2</span> itens</span>
<span id="cb7-167"><a href="#cb7-167" aria-hidden="true" tabindex="-1"></a>        Conte√∫do real: <span class="dv">3751</span> chars</span>
<span id="cb7-168"><a href="#cb7-168" aria-hidden="true" tabindex="-1"></a>        Fase: answer</span>
<span id="cb7-169"><a href="#cb7-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-170"><a href="#cb7-170" aria-hidden="true" tabindex="-1"></a>     <span class="fl">10.</span> Chat: be91a6cf...</span>
<span id="cb7-171"><a href="#cb7-171" aria-hidden="true" tabindex="-1"></a>        Mensagem: <span class="dv">7</span><span class="er">dfd87e9</span>...</span>
<span id="cb7-172"><a href="#cb7-172" aria-hidden="true" tabindex="-1"></a>        Modelo: qwen3<span class="op">-</span><span class="bu">max</span><span class="op">-</span><span class="dv">2025</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">30</span></span>
<span id="cb7-173"><a href="#cb7-173" aria-hidden="true" tabindex="-1"></a>        Content vazio: <span class="dv">0</span> chars</span>
<span id="cb7-174"><a href="#cb7-174" aria-hidden="true" tabindex="-1"></a>        Content_list: <span class="dv">2</span> itens</span>
<span id="cb7-175"><a href="#cb7-175" aria-hidden="true" tabindex="-1"></a>        Conte√∫do real: <span class="dv">5295</span> chars</span>
<span id="cb7-176"><a href="#cb7-176" aria-hidden="true" tabindex="-1"></a>        Fase: answer</span>
<span id="cb7-177"><a href="#cb7-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-178"><a href="#cb7-178" aria-hidden="true" tabindex="-1"></a>     ... e mais <span class="dv">134</span> padr√µes</span>
<span id="cb7-179"><a href="#cb7-179" aria-hidden="true" tabindex="-1"></a>üí° RECOMENDA√á√ïES:</span>
<span id="cb7-180"><a href="#cb7-180" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ Implementar fallback para content_list quando content estiver vazio</span>
<span id="cb7-181"><a href="#cb7-181" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ Verificar se o cliente est√° processando content_list corretamente</span>
<span id="cb7-182"><a href="#cb7-182" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ Revisar a l√≥gica de extra√ß√£o de conte√∫do das mensagens</span>
<span id="cb7-183"><a href="#cb7-183" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ Considerar m√∫ltiplas fases de resposta nos parsers</span>
<span id="cb7-184"><a href="#cb7-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-185"><a href="#cb7-185" aria-hidden="true" tabindex="-1"></a>üîç AN√ÅLISE DETALHADA DO PROBLEMA:</span>
<span id="cb7-186"><a href="#cb7-186" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ <span class="dv">144</span> de <span class="dv">149</span> mensagens do assistente t√™m <span class="st">&#39;content&#39;</span> vazio</span>
<span id="cb7-187"><a href="#cb7-187" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ <span class="dv">144</span> de <span class="dv">149</span> mensagens t√™m <span class="st">&#39;content_list&#39;</span></span>
<span id="cb7-188"><a href="#cb7-188" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ Isso explica por que partes das respostas n√£o aparecem nas conversas</span>
<span id="cb7-189"><a href="#cb7-189" aria-hidden="true" tabindex="-1"></a>   ‚Ä¢ O conte√∫do real est√° em content_list[].content, n√£o no campo content principal</span>
<span id="cb7-190"><a href="#cb7-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-191"><a href="#cb7-191" aria-hidden="true" tabindex="-1"></a><span class="op">---</span></span>
<span id="cb7-192"><a href="#cb7-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-193"><a href="#cb7-193" aria-hidden="true" tabindex="-1"></a><span class="co">### ü§ñ DeepSeek *(2025-11-08 06:15:09)* *[deepseek-reasoner]*</span></span>
<span id="cb7-194"><a href="#cb7-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-195"><a href="#cb7-195" aria-hidden="true" tabindex="-1"></a>Estamos cientes de que o problema no Qwen √© que o conte√∫do real das mensagens do assistente est√° no campo `content_list` e n√£o no campo `content` (que est√° vazio). Precisamos modificar o m√©todo `_process_qwen_content` para lidar com `content_list`.</span>
<span id="cb7-196"><a href="#cb7-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-197"><a href="#cb7-197" aria-hidden="true" tabindex="-1"></a> Vamos ajustar a fun√ß√£o `_process_qwen_content` para:</span>
<span id="cb7-198"><a href="#cb7-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-199"><a href="#cb7-199" aria-hidden="true" tabindex="-1"></a> <span class="fl">1.</span> Se `content` <span class="cf">for</span> uma string n√£o vazia, us√°<span class="op">-</span>la.</span>
<span id="cb7-200"><a href="#cb7-200" aria-hidden="true" tabindex="-1"></a> <span class="fl">2.</span> Se `content` <span class="cf">for</span> vazio, mas houver `content_list`, extrair o conte√∫do de `content_list`.</span>
<span id="cb7-201"><a href="#cb7-201" aria-hidden="true" tabindex="-1"></a> <span class="fl">3.</span> `content_list` √© uma lista de objetos, cada um com um campo `content` (e possivelmente outros campos como `type`).</span>
<span id="cb7-202"><a href="#cb7-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-203"><a href="#cb7-203" aria-hidden="true" tabindex="-1"></a> Al√©m disso, note que a an√°lise mostrou que `content_list` pode ter m√∫ltiplos itens, e estamos interessados no conte√∫do da fase <span class="st">&#39;answer&#39;</span>.</span>
<span id="cb7-204"><a href="#cb7-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-205"><a href="#cb7-205" aria-hidden="true" tabindex="-1"></a> No entanto, a an√°lise tamb√©m mostra que existem fases como <span class="st">&#39;think&#39;</span> e <span class="st">&#39;web_search&#39;</span>. Precisamos decidir se vamos incluir todas <span class="im">as</span> fases ou apenas a <span class="st">&#39;answer&#39;</span>.</span>
<span id="cb7-206"><a href="#cb7-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-207"><a href="#cb7-207" aria-hidden="true" tabindex="-1"></a> Como queremos preservar a conversa como foi mostrada ao usu√°rio, provavelmente queremos apenas a fase <span class="st">&#39;answer&#39;</span>. Mas note que em alguns casos, a resposta final pode ser composta por m√∫ltiplos itens (por exemplo, <span class="dv">2</span> itens na fase <span class="st">&#39;answer&#39;</span>).</span>
<span id="cb7-208"><a href="#cb7-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-209"><a href="#cb7-209" aria-hidden="true" tabindex="-1"></a> Vamos modificar a fun√ß√£o `_process_qwen_content` para:</span>
<span id="cb7-210"><a href="#cb7-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-211"><a href="#cb7-211" aria-hidden="true" tabindex="-1"></a> <span class="op">-</span> Se `content` <span class="cf">for</span> uma string n√£o vazia, us√°<span class="op">-</span>la.</span>
<span id="cb7-212"><a href="#cb7-212" aria-hidden="true" tabindex="-1"></a> <span class="op">-</span> Caso contr√°rio, se existir `content_list`, vamos filtrar os itens pela fase <span class="st">&#39;answer&#39;</span> e concatenar o conte√∫do desses itens.</span>
<span id="cb7-213"><a href="#cb7-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-214"><a href="#cb7-214" aria-hidden="true" tabindex="-1"></a> No entanto, note que a an√°lise mostrou que existem mensagens com `content_list` de <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span> itens. Aparentemente, a fase <span class="st">&#39;answer&#39;</span> pode ter m√∫ltiplos itens. Vamos considerar que a fase <span class="st">&#39;answer&#39;</span> √© a que deve ser exibida.</span>
<span id="cb7-215"><a href="#cb7-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-216"><a href="#cb7-216" aria-hidden="true" tabindex="-1"></a> Mas note: a an√°lise mostra que a mensagem com <span class="dv">8</span> itens na `content_list` tem fase <span class="st">&#39;answer&#39;</span>. Portanto, vamos extrair todos os itens da `content_list` que t√™m fase <span class="st">&#39;answer&#39;</span> e concatenar seus conte√∫dos.</span>
<span id="cb7-217"><a href="#cb7-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-218"><a href="#cb7-218" aria-hidden="true" tabindex="-1"></a> No entanto, a estrutura real do `content_list` √© uma lista de dicion√°rios, e cada dicion√°rio tem:</span>
<span id="cb7-219"><a href="#cb7-219" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> `content`: string</span>
<span id="cb7-220"><a href="#cb7-220" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> `phase`: string (por exemplo, <span class="st">&#39;answer&#39;</span>, <span class="st">&#39;think&#39;</span>, <span class="st">&#39;web_search&#39;</span>)</span>
<span id="cb7-221"><a href="#cb7-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-222"><a href="#cb7-222" aria-hidden="true" tabindex="-1"></a> Portanto, a estrat√©gia √©:</span>
<span id="cb7-223"><a href="#cb7-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-224"><a href="#cb7-224" aria-hidden="true" tabindex="-1"></a>   Se `content` estiver vazio e existir `content_list`:</span>
<span id="cb7-225"><a href="#cb7-225" aria-hidden="true" tabindex="-1"></a>      Para cada item em `content_list`:</span>
<span id="cb7-226"><a href="#cb7-226" aria-hidden="true" tabindex="-1"></a>          Se o item <span class="cf">for</span> um dicion√°rio e tiver a chave <span class="st">&#39;phase&#39;</span> com valor <span class="st">&#39;answer&#39;</span> e a chave <span class="st">&#39;content&#39;</span> n√£o vazia, ent√£o acrescentar o conte√∫do.</span>
<span id="cb7-227"><a href="#cb7-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-228"><a href="#cb7-228" aria-hidden="true" tabindex="-1"></a>   Se n√£o houver itens de <span class="st">&#39;answer&#39;</span>, podemos tentar pegar o √∫ltimo item? Ou talvez todos? Mas a an√°lise mostra que a fase <span class="st">&#39;answer&#39;</span> √© a que cont√©m a resposta final.</span>
<span id="cb7-229"><a href="#cb7-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-230"><a href="#cb7-230" aria-hidden="true" tabindex="-1"></a> Vamos focar na fase <span class="st">&#39;answer&#39;</span>.</span>
<span id="cb7-231"><a href="#cb7-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-232"><a href="#cb7-232" aria-hidden="true" tabindex="-1"></a> No entanto, note que a an√°lise mostra que a mensagem do assistente pode ter `content_list` com <span class="dv">1</span> item na fase <span class="st">&#39;answer&#39;</span>, mas tamb√©m pode ter <span class="dv">2</span>, <span class="dv">4</span>, <span class="fl">8.</span> Portanto, vamos juntar todos os conte√∫dos da fase <span class="st">&#39;answer&#39;</span>.</span>
<span id="cb7-233"><a href="#cb7-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-234"><a href="#cb7-234" aria-hidden="true" tabindex="-1"></a> Vamos modificar a fun√ß√£o `_process_qwen_content` para lidar com isso.</span>
<span id="cb7-235"><a href="#cb7-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-236"><a href="#cb7-236" aria-hidden="true" tabindex="-1"></a> Al√©m disso, note que a fun√ß√£o `_process_qwen_content` atualmente lida com `content` sendo uma lista (que √© o caso do Qwen?). Precisamos verificar se essa lista √© a mesma que `content_list` ou se √© uma estrutura diferente.</span>
<span id="cb7-237"><a href="#cb7-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-238"><a href="#cb7-238" aria-hidden="true" tabindex="-1"></a> Pela an√°lise, o problema √© que o campo `content` da mensagem est√° vazio, mas o campo `content_list` est√° presente. Portanto, precisamos acessar `content_list` na mensagem.</span>
<span id="cb7-239"><a href="#cb7-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-240"><a href="#cb7-240" aria-hidden="true" tabindex="-1"></a> No entanto, a fun√ß√£o `_process_qwen_content` atualmente s√≥ recebe o `content` (que √© o campo da mensagem). Precisamos modificar para que a fun√ß√£o tenha acesso √† mensagem completa, ou ent√£o modificar a chamada para passar a mensagem completa.</span>
<span id="cb7-241"><a href="#cb7-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-242"><a href="#cb7-242" aria-hidden="true" tabindex="-1"></a> Vamos revisar a chamada de `_process_qwen_content`:</span>
<span id="cb7-243"><a href="#cb7-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-244"><a href="#cb7-244" aria-hidden="true" tabindex="-1"></a> Atualmente, em `_extract_from_messages_dict` e `_extract_from_messages_list`, chamamos:</span>
<span id="cb7-245"><a href="#cb7-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-246"><a href="#cb7-246" aria-hidden="true" tabindex="-1"></a>   final_content <span class="op">=</span> <span class="va">self</span>._process_qwen_content(content)</span>
<span id="cb7-247"><a href="#cb7-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-248"><a href="#cb7-248" aria-hidden="true" tabindex="-1"></a> Mas note que a mensagem (message_data) pode ter o campo `content_list`. Portanto, precisamos passar a mensagem completa para `_process_qwen_content` e n√£o apenas o campo `content`.</span>
<span id="cb7-249"><a href="#cb7-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-250"><a href="#cb7-250" aria-hidden="true" tabindex="-1"></a> Vamos modificar:</span>
<span id="cb7-251"><a href="#cb7-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-252"><a href="#cb7-252" aria-hidden="true" tabindex="-1"></a>   Em `_extract_from_messages_dict` e `_extract_from_messages_list`, em vez de passar apenas `content`, vamos passar a `message_data` (o dicion√°rio completo da mensagem).</span>
<span id="cb7-253"><a href="#cb7-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-254"><a href="#cb7-254" aria-hidden="true" tabindex="-1"></a> E ent√£o, em `_process_qwen_content`, vamos:</span>
<span id="cb7-255"><a href="#cb7-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-256"><a href="#cb7-256" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Se message_data tiver `content` n√£o vazio, us√°<span class="op">-</span>lo.</span>
<span id="cb7-257"><a href="#cb7-257" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Sen√£o, se message_data tiver `content_list`, extrair o conte√∫do da fase <span class="st">&#39;answer&#39;</span>.</span>
<span id="cb7-258"><a href="#cb7-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-259"><a href="#cb7-259" aria-hidden="true" tabindex="-1"></a> Vamos renomear a fun√ß√£o para `_process_qwen_message` e modificar sua assinatura.</span>
<span id="cb7-260"><a href="#cb7-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-261"><a href="#cb7-261" aria-hidden="true" tabindex="-1"></a> Vamos fazer isso apenas para o Qwen, pois os outros modelos n√£o t√™m `content_list`.</span>
<span id="cb7-262"><a href="#cb7-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-263"><a href="#cb7-263" aria-hidden="true" tabindex="-1"></a> Portanto, vamos refatorar:</span>
<span id="cb7-264"><a href="#cb7-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-265"><a href="#cb7-265" aria-hidden="true" tabindex="-1"></a>  <span class="fl">1.</span> Modificar `_extract_from_messages_dict` e `_extract_from_messages_list` para passar a mensagem completa para `_process_qwen_message`.</span>
<span id="cb7-266"><a href="#cb7-266" aria-hidden="true" tabindex="-1"></a>  <span class="fl">2.</span> Criar `_process_qwen_message` que processa a mensagem completa.</span>
<span id="cb7-267"><a href="#cb7-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-268"><a href="#cb7-268" aria-hidden="true" tabindex="-1"></a> Al√©m disso, note que a mensagem do usu√°rio n√£o tem `content_list`? A an√°lise mostrou que o problema √© apenas com <span class="im">as</span> mensagens do assistente.</span>
<span id="cb7-269"><a href="#cb7-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-270"><a href="#cb7-270" aria-hidden="true" tabindex="-1"></a> Vamos implementar:</span>
<span id="cb7-271"><a href="#cb7-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-272"><a href="#cb7-272" aria-hidden="true" tabindex="-1"></a>   <span class="kw">def</span> _process_qwen_message(<span class="va">self</span>, message_data: Dict) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-273"><a href="#cb7-273" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Primeiro, tenta o campo &#39;content&#39;</span></span>
<span id="cb7-274"><a href="#cb7-274" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> message_data.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb7-275"><a href="#cb7-275" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> content <span class="kw">and</span> <span class="bu">isinstance</span>(content, <span class="bu">str</span>) <span class="kw">and</span> content.strip():</span>
<span id="cb7-276"><a href="#cb7-276" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb7-277"><a href="#cb7-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-278"><a href="#cb7-278" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se content estiver vazio, tenta o content_list</span></span>
<span id="cb7-279"><a href="#cb7-279" aria-hidden="true" tabindex="-1"></a>        content_list <span class="op">=</span> message_data.get(<span class="st">&#39;content_list&#39;</span>, [])</span>
<span id="cb7-280"><a href="#cb7-280" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> content_list <span class="kw">and</span> <span class="bu">isinstance</span>(content_list, <span class="bu">list</span>):</span>
<span id="cb7-281"><a href="#cb7-281" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Filtra apenas os itens da fase &#39;answer&#39;</span></span>
<span id="cb7-282"><a href="#cb7-282" aria-hidden="true" tabindex="-1"></a>            answer_contents <span class="op">=</span> []</span>
<span id="cb7-283"><a href="#cb7-283" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> item <span class="kw">in</span> content_list:</span>
<span id="cb7-284"><a href="#cb7-284" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">isinstance</span>(item, <span class="bu">dict</span>) <span class="kw">and</span> item.get(<span class="st">&#39;phase&#39;</span>) <span class="op">==</span> <span class="st">&#39;answer&#39;</span>:</span>
<span id="cb7-285"><a href="#cb7-285" aria-hidden="true" tabindex="-1"></a>                    item_content <span class="op">=</span> item.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb7-286"><a href="#cb7-286" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> item_content <span class="kw">and</span> <span class="bu">isinstance</span>(item_content, <span class="bu">str</span>):</span>
<span id="cb7-287"><a href="#cb7-287" aria-hidden="true" tabindex="-1"></a>                        answer_contents.append(item_content)</span>
<span id="cb7-288"><a href="#cb7-288" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> answer_contents:</span>
<span id="cb7-289"><a href="#cb7-289" aria-hidden="true" tabindex="-1"></a>                combined_content <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(answer_contents)</span>
<span id="cb7-290"><a href="#cb7-290" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>.preserve_special_content(combined_content)</span>
<span id="cb7-291"><a href="#cb7-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-292"><a href="#cb7-292" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se n√£o encontrou conte√∫do, retorna string vazia</span></span>
<span id="cb7-293"><a href="#cb7-293" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;&#39;</span></span>
<span id="cb7-294"><a href="#cb7-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-295"><a href="#cb7-295" aria-hidden="true" tabindex="-1"></a>  <span class="fl">3.</span> Substituir todas <span class="im">as</span> chamadas de `_process_qwen_content` por `_process_qwen_message` e passar a mensagem completa.</span>
<span id="cb7-296"><a href="#cb7-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-297"><a href="#cb7-297" aria-hidden="true" tabindex="-1"></a>  <span class="fl">4.</span> Remover a fun√ß√£o `_process_qwen_content` antiga.</span>
<span id="cb7-298"><a href="#cb7-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-299"><a href="#cb7-299" aria-hidden="true" tabindex="-1"></a> No entanto, note que a fun√ß√£o `_process_qwen_content` tamb√©m era usada para processar o conte√∫do quando ele era uma lista (no caso de blocos de texto e imagem). Precisamos manter essa funcionalidade? A an√°lise n√£o mostrou isso, mas vamos manter a compatibilidade.</span>
<span id="cb7-300"><a href="#cb7-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-301"><a href="#cb7-301" aria-hidden="true" tabindex="-1"></a> Mas note: a nova fun√ß√£o `_process_qwen_message` s√≥ est√° sendo usada para mensagens do Qwen. E a estrutura do Qwen pode ter o `content` como uma lista? N√£o tenho certeza.</span>
<span id="cb7-302"><a href="#cb7-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-303"><a href="#cb7-303" aria-hidden="true" tabindex="-1"></a> Vamos manter a fun√ß√£o `_process_qwen_content` para o caso de `content` ser uma lista, mas agora n√£o a estamos usando. Vamos remover a fun√ß√£o `_process_qwen_content` antiga e integrar sua funcionalidade na nova `_process_qwen_message`?</span>
<span id="cb7-304"><a href="#cb7-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-305"><a href="#cb7-305" aria-hidden="true" tabindex="-1"></a> Na verdade, a fun√ß√£o `_process_qwen_content` antiga era:</span>
<span id="cb7-306"><a href="#cb7-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-307"><a href="#cb7-307" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _process_qwen_content(<span class="va">self</span>, content) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-308"><a href="#cb7-308" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb7-309"><a href="#cb7-309" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;&quot;</span></span>
<span id="cb7-310"><a href="#cb7-310" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-311"><a href="#cb7-311" aria-hidden="true" tabindex="-1"></a>        final_content <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb7-312"><a href="#cb7-312" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-313"><a href="#cb7-313" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(content, <span class="bu">list</span>):</span>
<span id="cb7-314"><a href="#cb7-314" aria-hidden="true" tabindex="-1"></a>            text_parts <span class="op">=</span> []</span>
<span id="cb7-315"><a href="#cb7-315" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> block <span class="kw">in</span> content:</span>
<span id="cb7-316"><a href="#cb7-316" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">isinstance</span>(block, <span class="bu">dict</span>):</span>
<span id="cb7-317"><a href="#cb7-317" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> block.get(<span class="st">&#39;type&#39;</span>) <span class="op">==</span> <span class="st">&#39;text&#39;</span>:</span>
<span id="cb7-318"><a href="#cb7-318" aria-hidden="true" tabindex="-1"></a>                        text_content <span class="op">=</span> block.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb7-319"><a href="#cb7-319" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> text_content:</span>
<span id="cb7-320"><a href="#cb7-320" aria-hidden="true" tabindex="-1"></a>                            text_parts.append(text_content)</span>
<span id="cb7-321"><a href="#cb7-321" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> block.get(<span class="st">&#39;type&#39;</span>) <span class="op">==</span> <span class="st">&#39;image&#39;</span>:</span>
<span id="cb7-322"><a href="#cb7-322" aria-hidden="true" tabindex="-1"></a>                        image_info <span class="op">=</span> block.get(<span class="st">&#39;image&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb7-323"><a href="#cb7-323" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> image_info:</span>
<span id="cb7-324"><a href="#cb7-324" aria-hidden="true" tabindex="-1"></a>                            text_parts.append(<span class="ss">f&quot;![Imagem](</span><span class="sc">{</span>image_info<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb7-325"><a href="#cb7-325" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb7-326"><a href="#cb7-326" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Processar outros tipos de blocos</span></span>
<span id="cb7-327"><a href="#cb7-327" aria-hidden="true" tabindex="-1"></a>                        block_type <span class="op">=</span> block.get(<span class="st">&#39;type&#39;</span>, <span class="st">&#39;desconhecido&#39;</span>)</span>
<span id="cb7-328"><a href="#cb7-328" aria-hidden="true" tabindex="-1"></a>                        block_content <span class="op">=</span> <span class="bu">str</span>(block.get(<span class="st">&#39;content&#39;</span>, block.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)))</span>
<span id="cb7-329"><a href="#cb7-329" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> block_content:</span>
<span id="cb7-330"><a href="#cb7-330" aria-hidden="true" tabindex="-1"></a>                            text_parts.append(<span class="ss">f&quot;[</span><span class="sc">{</span>block_type<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>block_content<span class="sc">}</span><span class="ss">]&quot;</span>)</span>
<span id="cb7-331"><a href="#cb7-331" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> <span class="bu">isinstance</span>(block, <span class="bu">str</span>):</span>
<span id="cb7-332"><a href="#cb7-332" aria-hidden="true" tabindex="-1"></a>                    text_parts.append(block)</span>
<span id="cb7-333"><a href="#cb7-333" aria-hidden="true" tabindex="-1"></a>            final_content <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(text_parts).strip()</span>
<span id="cb7-334"><a href="#cb7-334" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-335"><a href="#cb7-335" aria-hidden="true" tabindex="-1"></a>            final_content <span class="op">=</span> <span class="bu">str</span>(content).strip()</span>
<span id="cb7-336"><a href="#cb7-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-337"><a href="#cb7-337" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.preserve_special_content(final_content)</span>
<span id="cb7-338"><a href="#cb7-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-339"><a href="#cb7-339" aria-hidden="true" tabindex="-1"></a> Vamos integrar essa l√≥gica na nova fun√ß√£o? N√£o, porque a nova fun√ß√£o est√° lidando com a mensagem completa, e o campo `content` pode ser uma lista. Precisamos manter essa l√≥gica.</span>
<span id="cb7-340"><a href="#cb7-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-341"><a href="#cb7-341" aria-hidden="true" tabindex="-1"></a> Vamos modificar a nova fun√ß√£o para:</span>
<span id="cb7-342"><a href="#cb7-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-343"><a href="#cb7-343" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Se `content` <span class="cf">for</span> uma string n√£o vazia, us√°<span class="op">-</span>la (passando por `preserve_special_content`).</span>
<span id="cb7-344"><a href="#cb7-344" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Se `content` <span class="cf">for</span> uma lista, processar como antes (usando a l√≥gica da fun√ß√£o antiga).</span>
<span id="cb7-345"><a href="#cb7-345" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Se `content` <span class="cf">for</span> vazio, ent√£o usar `content_list` (fase <span class="st">&#39;answer&#39;</span>).</span>
<span id="cb7-346"><a href="#cb7-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-347"><a href="#cb7-347" aria-hidden="true" tabindex="-1"></a> Portanto, vamos manter a l√≥gica da fun√ß√£o antiga para quando `content` √© uma lista, e adicionar a l√≥gica do `content_list`.</span>
<span id="cb7-348"><a href="#cb7-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-349"><a href="#cb7-349" aria-hidden="true" tabindex="-1"></a> Vamos criar uma fun√ß√£o auxiliar para processar o `content` quando ele √© uma lista (a mesma l√≥gica da fun√ß√£o antiga) e cham√°<span class="op">-</span>la quando necess√°rio.</span>
<span id="cb7-350"><a href="#cb7-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-351"><a href="#cb7-351" aria-hidden="true" tabindex="-1"></a> Vamos reorganizar:</span>
<span id="cb7-352"><a href="#cb7-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-353"><a href="#cb7-353" aria-hidden="true" tabindex="-1"></a>   <span class="kw">def</span> _process_qwen_message(<span class="va">self</span>, message_data: Dict) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-354"><a href="#cb7-354" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> message_data.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb7-355"><a href="#cb7-355" aria-hidden="true" tabindex="-1"></a>        content_list <span class="op">=</span> message_data.get(<span class="st">&#39;content_list&#39;</span>, [])</span>
<span id="cb7-356"><a href="#cb7-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-357"><a href="#cb7-357" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se content for uma lista, processa como lista</span></span>
<span id="cb7-358"><a href="#cb7-358" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(content, <span class="bu">list</span>):</span>
<span id="cb7-359"><a href="#cb7-359" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._process_qwen_content_list(content)  <span class="co"># Esta fun√ß√£o √© a antiga _process_qwen_content para listas</span></span>
<span id="cb7-360"><a href="#cb7-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-361"><a href="#cb7-361" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se content for string n√£o vazia, usa</span></span>
<span id="cb7-362"><a href="#cb7-362" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> content <span class="kw">and</span> <span class="bu">isinstance</span>(content, <span class="bu">str</span>) <span class="kw">and</span> content.strip():</span>
<span id="cb7-363"><a href="#cb7-363" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb7-364"><a href="#cb7-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-365"><a href="#cb7-365" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se content estiver vazio, tenta o content_list (fase &#39;answer&#39;)</span></span>
<span id="cb7-366"><a href="#cb7-366" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> content_list <span class="kw">and</span> <span class="bu">isinstance</span>(content_list, <span class="bu">list</span>):</span>
<span id="cb7-367"><a href="#cb7-367" aria-hidden="true" tabindex="-1"></a>            answer_contents <span class="op">=</span> []</span>
<span id="cb7-368"><a href="#cb7-368" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> item <span class="kw">in</span> content_list:</span>
<span id="cb7-369"><a href="#cb7-369" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">isinstance</span>(item, <span class="bu">dict</span>) <span class="kw">and</span> item.get(<span class="st">&#39;phase&#39;</span>) <span class="op">==</span> <span class="st">&#39;answer&#39;</span>:</span>
<span id="cb7-370"><a href="#cb7-370" aria-hidden="true" tabindex="-1"></a>                    item_content <span class="op">=</span> item.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb7-371"><a href="#cb7-371" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> item_content <span class="kw">and</span> <span class="bu">isinstance</span>(item_content, <span class="bu">str</span>):</span>
<span id="cb7-372"><a href="#cb7-372" aria-hidden="true" tabindex="-1"></a>                        answer_contents.append(item_content)</span>
<span id="cb7-373"><a href="#cb7-373" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> answer_contents:</span>
<span id="cb7-374"><a href="#cb7-374" aria-hidden="true" tabindex="-1"></a>                combined_content <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(answer_contents)</span>
<span id="cb7-375"><a href="#cb7-375" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>.preserve_special_content(combined_content)</span>
<span id="cb7-376"><a href="#cb7-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-377"><a href="#cb7-377" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;&#39;</span></span>
<span id="cb7-378"><a href="#cb7-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-379"><a href="#cb7-379" aria-hidden="true" tabindex="-1"></a>   <span class="kw">def</span> _process_qwen_content_list(<span class="va">self</span>, content_list: List) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-380"><a href="#cb7-380" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Esta √© a l√≥gica da antiga _process_qwen_content para listas</span></span>
<span id="cb7-381"><a href="#cb7-381" aria-hidden="true" tabindex="-1"></a>        text_parts <span class="op">=</span> []</span>
<span id="cb7-382"><a href="#cb7-382" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> block <span class="kw">in</span> content_list:</span>
<span id="cb7-383"><a href="#cb7-383" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(block, <span class="bu">dict</span>):</span>
<span id="cb7-384"><a href="#cb7-384" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> block.get(<span class="st">&#39;type&#39;</span>) <span class="op">==</span> <span class="st">&#39;text&#39;</span>:</span>
<span id="cb7-385"><a href="#cb7-385" aria-hidden="true" tabindex="-1"></a>                    text_content <span class="op">=</span> block.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb7-386"><a href="#cb7-386" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> text_content:</span>
<span id="cb7-387"><a href="#cb7-387" aria-hidden="true" tabindex="-1"></a>                        text_parts.append(text_content)</span>
<span id="cb7-388"><a href="#cb7-388" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> block.get(<span class="st">&#39;type&#39;</span>) <span class="op">==</span> <span class="st">&#39;image&#39;</span>:</span>
<span id="cb7-389"><a href="#cb7-389" aria-hidden="true" tabindex="-1"></a>                    image_info <span class="op">=</span> block.get(<span class="st">&#39;image&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb7-390"><a href="#cb7-390" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> image_info:</span>
<span id="cb7-391"><a href="#cb7-391" aria-hidden="true" tabindex="-1"></a>                        text_parts.append(<span class="ss">f&quot;![Imagem](</span><span class="sc">{</span>image_info<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb7-392"><a href="#cb7-392" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb7-393"><a href="#cb7-393" aria-hidden="true" tabindex="-1"></a>                    block_type <span class="op">=</span> block.get(<span class="st">&#39;type&#39;</span>, <span class="st">&#39;desconhecido&#39;</span>)</span>
<span id="cb7-394"><a href="#cb7-394" aria-hidden="true" tabindex="-1"></a>                    block_content <span class="op">=</span> <span class="bu">str</span>(block.get(<span class="st">&#39;content&#39;</span>, block.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)))</span>
<span id="cb7-395"><a href="#cb7-395" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> block_content:</span>
<span id="cb7-396"><a href="#cb7-396" aria-hidden="true" tabindex="-1"></a>                        text_parts.append(<span class="ss">f&quot;[</span><span class="sc">{</span>block_type<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>block_content<span class="sc">}</span><span class="ss">]&quot;</span>)</span>
<span id="cb7-397"><a href="#cb7-397" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(block, <span class="bu">str</span>):</span>
<span id="cb7-398"><a href="#cb7-398" aria-hidden="true" tabindex="-1"></a>                text_parts.append(block)</span>
<span id="cb7-399"><a href="#cb7-399" aria-hidden="true" tabindex="-1"></a>        final_content <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(text_parts).strip()</span>
<span id="cb7-400"><a href="#cb7-400" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.preserve_special_content(final_content)</span>
<span id="cb7-401"><a href="#cb7-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-402"><a href="#cb7-402" aria-hidden="true" tabindex="-1"></a> No entanto, note que a fun√ß√£o `_process_qwen_content_list` √© usada para processar o campo `content` quando ele √© uma lista, e tamb√©m para processar o `content_list`? N√£o, o `content_list` √© uma lista de dicion√°rios com estrutura diferente (com campos <span class="st">&#39;phase&#39;</span> e <span class="st">&#39;content&#39;</span>). Portanto, n√£o usamos `_process_qwen_content_list` para o `content_list` da mensagem.</span>
<span id="cb7-403"><a href="#cb7-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-404"><a href="#cb7-404" aria-hidden="true" tabindex="-1"></a> Vamos manter a separa√ß√£o:</span>
<span id="cb7-405"><a href="#cb7-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-406"><a href="#cb7-406" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> O campo `content` da mensagem pode ser uma lista de blocos (texto, imagem) <span class="op">-&gt;</span> usamos `_process_qwen_content_list`</span>
<span id="cb7-407"><a href="#cb7-407" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> O campo `content_list` da mensagem √© uma lista de itens de fase <span class="op">-&gt;</span> usamos a extra√ß√£o da fase <span class="st">&#39;answer&#39;</span></span>
<span id="cb7-408"><a href="#cb7-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-409"><a href="#cb7-409" aria-hidden="true" tabindex="-1"></a> Vamos implementar dessa forma.</span>
<span id="cb7-410"><a href="#cb7-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-411"><a href="#cb7-411" aria-hidden="true" tabindex="-1"></a> Agora, precisamos ajustar <span class="im">as</span> chamadas:</span>
<span id="cb7-412"><a href="#cb7-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-413"><a href="#cb7-413" aria-hidden="true" tabindex="-1"></a>   Em `_extract_from_messages_dict` e `_extract_from_messages_list`, onde atualmente temos:</span>
<span id="cb7-414"><a href="#cb7-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-415"><a href="#cb7-415" aria-hidden="true" tabindex="-1"></a>        final_content <span class="op">=</span> <span class="va">self</span>._process_qwen_content(content)</span>
<span id="cb7-416"><a href="#cb7-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-417"><a href="#cb7-417" aria-hidden="true" tabindex="-1"></a>   Vamos mudar para:</span>
<span id="cb7-418"><a href="#cb7-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-419"><a href="#cb7-419" aria-hidden="true" tabindex="-1"></a>        final_content <span class="op">=</span> <span class="va">self</span>._process_qwen_message(message_data)</span>
<span id="cb7-420"><a href="#cb7-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-421"><a href="#cb7-421" aria-hidden="true" tabindex="-1"></a>   E remover a fun√ß√£o `_process_qwen_content` antiga.</span>
<span id="cb7-422"><a href="#cb7-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-423"><a href="#cb7-423" aria-hidden="true" tabindex="-1"></a> Vamos fazer essas altera√ß√µes.</span>
<span id="cb7-424"><a href="#cb7-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-425"><a href="#cb7-425" aria-hidden="true" tabindex="-1"></a> Al√©m disso, note que a fun√ß√£o `_create_message_from_object` tamb√©m usa `_process_qwen_content`. Vamos mudar para `_process_qwen_message` e passar o objeto completo.</span>
<span id="cb7-426"><a href="#cb7-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-427"><a href="#cb7-427" aria-hidden="true" tabindex="-1"></a> Vamos fazer isso.</span>
<span id="cb7-428"><a href="#cb7-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-429"><a href="#cb7-429" aria-hidden="true" tabindex="-1"></a> Vamos tamb√©m remover a fun√ß√£o `_process_qwen_content` antiga.</span>
<span id="cb7-430"><a href="#cb7-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-431"><a href="#cb7-431" aria-hidden="true" tabindex="-1"></a> Vamos testar mentalmente:</span>
<span id="cb7-432"><a href="#cb7-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-433"><a href="#cb7-433" aria-hidden="true" tabindex="-1"></a>   Para uma mensagem do assistente Qwen:</span>
<span id="cb7-434"><a href="#cb7-434" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> Se a mensagem tiver `content` como string n√£o vazia: usa.</span>
<span id="cb7-435"><a href="#cb7-435" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> Se `content` <span class="cf">for</span> uma lista: processa a lista (blocos) e retorna.</span>
<span id="cb7-436"><a href="#cb7-436" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> Se `content` <span class="cf">for</span> vazio e houver `content_list`: extrai a fase <span class="st">&#39;answer&#39;</span> e retorna.</span>
<span id="cb7-437"><a href="#cb7-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-438"><a href="#cb7-438" aria-hidden="true" tabindex="-1"></a>   Para mensagens do usu√°rio, normalmente n√£o ter√£o `content_list`, ent√£o usar√£o o `content` (que deve ser string).</span>
<span id="cb7-439"><a href="#cb7-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-440"><a href="#cb7-440" aria-hidden="true" tabindex="-1"></a> Vamos esperar que isso resolva o problema.</span>
<span id="cb7-441"><a href="#cb7-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-442"><a href="#cb7-442" aria-hidden="true" tabindex="-1"></a> Vamos escrever o c√≥digo corrigido. Com base na an√°lise que voc√™ compartilhou, identifiquei o problema principal: <span class="op">**</span><span class="dv">144</span> de <span class="dv">149</span> mensagens do assistente Qwen t√™m o campo `content` vazio, mas o conte√∫do real est√° em `content_list`<span class="op">**</span>. </span>
<span id="cb7-443"><a href="#cb7-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-444"><a href="#cb7-444" aria-hidden="true" tabindex="-1"></a>Vou fornecer <span class="im">as</span> corre√ß√µes espec√≠ficas para o m√©todo `process_qwen_enhanced`:</span>
<span id="cb7-445"><a href="#cb7-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-446"><a href="#cb7-446" aria-hidden="true" tabindex="-1"></a>```python</span>
<span id="cb7-447"><a href="#cb7-447" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_qwen_enhanced(<span class="va">self</span>, path: Path):</span>
<span id="cb7-448"><a href="#cb7-448" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Processa Qwen3 com corre√ß√£o para content_list - VERS√ÉO CORRIGIDA&quot;&quot;&quot;</span></span>
<span id="cb7-449"><a href="#cb7-449" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb7-450"><a href="#cb7-450" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria Qwen3: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-451"><a href="#cb7-451" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb7-452"><a href="#cb7-452" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-453"><a href="#cb7-453" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb7-454"><a href="#cb7-454" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb7-455"><a href="#cb7-455" aria-hidden="true" tabindex="-1"></a>            raw_data <span class="op">=</span> json.load(f)</span>
<span id="cb7-456"><a href="#cb7-456" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-457"><a href="#cb7-457" aria-hidden="true" tabindex="-1"></a>        <span class="co"># DEBUG: Salvar estrutura completa para an√°lise</span></span>
<span id="cb7-458"><a href="#cb7-458" aria-hidden="true" tabindex="-1"></a>        debug_file <span class="op">=</span> Path(<span class="st">&quot;qwen_debug_structure.json&quot;</span>)</span>
<span id="cb7-459"><a href="#cb7-459" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(debug_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb7-460"><a href="#cb7-460" aria-hidden="true" tabindex="-1"></a>            json.dump(raw_data, f, indent<span class="op">=</span><span class="dv">2</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-461"><a href="#cb7-461" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Estrutura Qwen salva em: </span><span class="sc">{</span>debug_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-462"><a href="#cb7-462" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-463"><a href="#cb7-463" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extrair conversas</span></span>
<span id="cb7-464"><a href="#cb7-464" aria-hidden="true" tabindex="-1"></a>        conversations <span class="op">=</span> []</span>
<span id="cb7-465"><a href="#cb7-465" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-466"><a href="#cb7-466" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;data&#39;</span> <span class="kw">in</span> raw_data <span class="kw">and</span> <span class="bu">isinstance</span>(raw_data[<span class="st">&#39;data&#39;</span>], <span class="bu">list</span>):</span>
<span id="cb7-467"><a href="#cb7-467" aria-hidden="true" tabindex="-1"></a>            conversations <span class="op">=</span> raw_data[<span class="st">&#39;data&#39;</span>]</span>
<span id="cb7-468"><a href="#cb7-468" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÅ Estrutura 1: </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas em &#39;data&#39;&quot;</span>)</span>
<span id="cb7-469"><a href="#cb7-469" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">list</span>):</span>
<span id="cb7-470"><a href="#cb7-470" aria-hidden="true" tabindex="-1"></a>            conversations <span class="op">=</span> raw_data</span>
<span id="cb7-471"><a href="#cb7-471" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÅ Estrutura 2: </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas na raiz&quot;</span>)</span>
<span id="cb7-472"><a href="#cb7-472" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-473"><a href="#cb7-473" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> key, value <span class="kw">in</span> raw_data.items():</span>
<span id="cb7-474"><a href="#cb7-474" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">isinstance</span>(value, <span class="bu">list</span>) <span class="kw">and</span> <span class="bu">len</span>(value) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb7-475"><a href="#cb7-475" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(value[<span class="dv">0</span>], <span class="bu">dict</span>) <span class="kw">and</span> <span class="bu">any</span>(k <span class="kw">in</span> value[<span class="dv">0</span>] <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">&#39;title&#39;</span>, <span class="st">&#39;chat&#39;</span>, <span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb7-476"><a href="#cb7-476" aria-hidden="true" tabindex="-1"></a>                        conversations <span class="op">=</span> value</span>
<span id="cb7-477"><a href="#cb7-477" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÅ Estrutura alternativa: </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas em &#39;</span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb7-478"><a href="#cb7-478" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb7-479"><a href="#cb7-479" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-480"><a href="#cb7-480" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> conversations:</span>
<span id="cb7-481"><a href="#cb7-481" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Nenhuma conversa encontrada no arquivo Qwen&quot;</span>)</span>
<span id="cb7-482"><a href="#cb7-482" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-483"><a href="#cb7-483" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-484"><a href="#cb7-484" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Qwen: encontradas </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb7-485"><a href="#cb7-485" aria-hidden="true" tabindex="-1"></a>        processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-486"><a href="#cb7-486" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-487"><a href="#cb7-487" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(conversations):</span>
<span id="cb7-488"><a href="#cb7-488" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conv, <span class="bu">dict</span>):</span>
<span id="cb7-489"><a href="#cb7-489" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb7-490"><a href="#cb7-490" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-491"><a href="#cb7-491" aria-hidden="true" tabindex="-1"></a>            original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa Qwen </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb7-492"><a href="#cb7-492" aria-hidden="true" tabindex="-1"></a>            clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb7-493"><a href="#cb7-493" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-494"><a href="#cb7-494" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üîç Processando: &#39;</span><span class="sc">{</span>clean_title<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb7-495"><a href="#cb7-495" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-496"><a href="#cb7-496" aria-hidden="true" tabindex="-1"></a>            <span class="co"># EXTRA√á√ÉO CORRIGIDA - foco em content_list</span></span>
<span id="cb7-497"><a href="#cb7-497" aria-hidden="true" tabindex="-1"></a>            messages <span class="op">=</span> <span class="va">self</span>._extract_qwen_messages_corrected(conv, clean_title, i)</span>
<span id="cb7-498"><a href="#cb7-498" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-499"><a href="#cb7-499" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> messages:</span>
<span id="cb7-500"><a href="#cb7-500" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Ordenar mensagens por timestamp</span></span>
<span id="cb7-501"><a href="#cb7-501" aria-hidden="true" tabindex="-1"></a>                messages.sort(key<span class="op">=</span><span class="kw">lambda</span> x: <span class="va">self</span>.parse_timestamp_for_sorting(x[<span class="st">&#39;timestamp&#39;</span>]))</span>
<span id="cb7-502"><a href="#cb7-502" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-503"><a href="#cb7-503" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.all_conversations.append({</span>
<span id="cb7-504"><a href="#cb7-504" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;title&#39;</span>: clean_title,</span>
<span id="cb7-505"><a href="#cb7-505" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;source&#39;</span>: <span class="st">&#39;Qwen3&#39;</span>,</span>
<span id="cb7-506"><a href="#cb7-506" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;qwen_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb7-507"><a href="#cb7-507" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;created_at&#39;</span>)),</span>
<span id="cb7-508"><a href="#cb7-508" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;updated_at&#39;</span>)),</span>
<span id="cb7-509"><a href="#cb7-509" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb7-510"><a href="#cb7-510" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb7-511"><a href="#cb7-511" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;category&#39;</span>: <span class="va">self</span>.categorize_conversation(clean_title, messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb7-512"><a href="#cb7-512" aria-hidden="true" tabindex="-1"></a>                })</span>
<span id="cb7-513"><a href="#cb7-513" aria-hidden="true" tabindex="-1"></a>                processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-514"><a href="#cb7-514" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   ‚úÖ Adicionada: </span><span class="sc">{</span><span class="bu">len</span>(messages)<span class="sc">}</span><span class="ss"> mensagens&quot;</span>)</span>
<span id="cb7-515"><a href="#cb7-515" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb7-516"><a href="#cb7-516" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;   ‚ùå Conversa </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: nenhuma mensagem extra√≠da&quot;</span>)</span>
<span id="cb7-517"><a href="#cb7-517" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-518"><a href="#cb7-518" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Qwen3: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb7-519"><a href="#cb7-519" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-520"><a href="#cb7-520" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-521"><a href="#cb7-521" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar Qwen3: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-522"><a href="#cb7-522" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.error(traceback.format_exc())</span>
<span id="cb7-523"><a href="#cb7-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-524"><a href="#cb7-524" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _extract_qwen_messages_corrected(<span class="va">self</span>, conv: Dict[<span class="bu">str</span>, Any], clean_title: <span class="bu">str</span>, conv_index: <span class="bu">int</span>) <span class="op">-&gt;</span> List[Dict[<span class="bu">str</span>, Any]]:</span>
<span id="cb7-525"><a href="#cb7-525" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Extrai mensagens do Qwen com corre√ß√£o para content_list&quot;&quot;&quot;</span></span>
<span id="cb7-526"><a href="#cb7-526" aria-hidden="true" tabindex="-1"></a>    all_messages <span class="op">=</span> []</span>
<span id="cb7-527"><a href="#cb7-527" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-528"><a href="#cb7-528" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ESTRAT√âGIA PRINCIPAL: Buscar em toda a estrutura por mensagens</span></span>
<span id="cb7-529"><a href="#cb7-529" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_from_object(obj, path<span class="op">=</span><span class="st">&quot;&quot;</span>):</span>
<span id="cb7-530"><a href="#cb7-530" aria-hidden="true" tabindex="-1"></a>        messages_found <span class="op">=</span> []</span>
<span id="cb7-531"><a href="#cb7-531" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-532"><a href="#cb7-532" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(obj, <span class="bu">dict</span>):</span>
<span id="cb7-533"><a href="#cb7-533" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verificar se √© uma mensagem com content_list (CASO CORRIGIDO)</span></span>
<span id="cb7-534"><a href="#cb7-534" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>._is_qwen_message_with_content(obj):</span>
<span id="cb7-535"><a href="#cb7-535" aria-hidden="true" tabindex="-1"></a>                message <span class="op">=</span> <span class="va">self</span>._create_message_from_qwen_object(obj)</span>
<span id="cb7-536"><a href="#cb7-536" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> message:</span>
<span id="cb7-537"><a href="#cb7-537" aria-hidden="true" tabindex="-1"></a>                    messages_found.append(message)</span>
<span id="cb7-538"><a href="#cb7-538" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-539"><a href="#cb7-539" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Buscar recursivamente</span></span>
<span id="cb7-540"><a href="#cb7-540" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> key, value <span class="kw">in</span> obj.items():</span>
<span id="cb7-541"><a href="#cb7-541" aria-hidden="true" tabindex="-1"></a>                messages_found.extend(extract_from_object(value, <span class="ss">f&quot;</span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">&quot;</span>))</span>
<span id="cb7-542"><a href="#cb7-542" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-543"><a href="#cb7-543" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">isinstance</span>(obj, <span class="bu">list</span>):</span>
<span id="cb7-544"><a href="#cb7-544" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> item <span class="kw">in</span> obj:</span>
<span id="cb7-545"><a href="#cb7-545" aria-hidden="true" tabindex="-1"></a>                messages_found.extend(extract_from_object(item, path))</span>
<span id="cb7-546"><a href="#cb7-546" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-547"><a href="#cb7-547" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> messages_found</span>
<span id="cb7-548"><a href="#cb7-548" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-549"><a href="#cb7-549" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Aplicar extra√ß√£o recursiva</span></span>
<span id="cb7-550"><a href="#cb7-550" aria-hidden="true" tabindex="-1"></a>    all_messages <span class="op">=</span> extract_from_object(conv, <span class="st">&quot;root&quot;</span>)</span>
<span id="cb7-551"><a href="#cb7-551" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-552"><a href="#cb7-552" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remover duplicatas</span></span>
<span id="cb7-553"><a href="#cb7-553" aria-hidden="true" tabindex="-1"></a>    unique_messages <span class="op">=</span> <span class="va">self</span>._remove_duplicate_messages(all_messages)</span>
<span id="cb7-554"><a href="#cb7-554" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-555"><a href="#cb7-555" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(unique_messages) <span class="op">!=</span> <span class="bu">len</span>(all_messages):</span>
<span id="cb7-556"><a href="#cb7-556" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;         üîÑ Removidas </span><span class="sc">{</span><span class="bu">len</span>(all_messages) <span class="op">-</span> <span class="bu">len</span>(unique_messages)<span class="sc">}</span><span class="ss"> mensagens duplicadas&quot;</span>)</span>
<span id="cb7-557"><a href="#cb7-557" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-558"><a href="#cb7-558" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> unique_messages</span>
<span id="cb7-559"><a href="#cb7-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-560"><a href="#cb7-560" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _is_qwen_message_with_content(<span class="va">self</span>, obj: Dict) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb7-561"><a href="#cb7-561" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Verifica se √© uma mensagem Qwen v√°lida (incluindo content_list)&quot;&quot;&quot;</span></span>
<span id="cb7-562"><a href="#cb7-562" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verificar campos b√°sicos de mensagem</span></span>
<span id="cb7-563"><a href="#cb7-563" aria-hidden="true" tabindex="-1"></a>    has_basic_structure <span class="op">=</span> (<span class="st">&#39;role&#39;</span> <span class="kw">in</span> obj <span class="kw">and</span> <span class="st">&#39;content&#39;</span> <span class="kw">in</span> obj)</span>
<span id="cb7-564"><a href="#cb7-564" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-565"><a href="#cb7-565" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verificar se tem content_list (</span></span>
<span id="cb7-566"><a href="#cb7-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-567"><a href="#cb7-567" aria-hidden="true" tabindex="-1"></a><span class="op">---</span></span>
<span id="cb7-568"><a href="#cb7-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-569"><a href="#cb7-569" aria-hidden="true" tabindex="-1"></a><span class="co">### üë§ Utilizador *(2025-11-08 06:17:57)* *[deepseek-reasoner]*</span></span>
<span id="cb7-570"><a href="#cb7-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-571"><a href="#cb7-571" aria-hidden="true" tabindex="-1"></a>Pretendo comb_fragments_system4_html_export.py completo</span>
<span id="cb7-572"><a href="#cb7-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-573"><a href="#cb7-573" aria-hidden="true" tabindex="-1"></a><span class="op">---</span></span>
<span id="cb7-574"><a href="#cb7-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-575"><a href="#cb7-575" aria-hidden="true" tabindex="-1"></a><span class="co">### ü§ñ DeepSeek *(2025-11-08 06:17:57)* *[deepseek-reasoner]*</span></span>
<span id="cb7-576"><a href="#cb7-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-577"><a href="#cb7-577" aria-hidden="true" tabindex="-1"></a>Vamos corrigir o problema do Qwen, mantendo <span class="im">as</span> outras funcionalidades.</span>
<span id="cb7-578"><a href="#cb7-578" aria-hidden="true" tabindex="-1"></a> O problema principal √© que o Qwen armazena o conte√∫do real em `content_list` quando o `content` est√° vazio.</span>
<span id="cb7-579"><a href="#cb7-579" aria-hidden="true" tabindex="-1"></a> A an√°lise mostrou que <span class="dv">144</span> de <span class="dv">149</span> mensagens do assistente t√™m `content` vazio, mas `content_list` cont√©m o conte√∫do.</span>
<span id="cb7-580"><a href="#cb7-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-581"><a href="#cb7-581" aria-hidden="true" tabindex="-1"></a> Vamos modificar o m√©todo `_is_qwen_message_with_content` e `_create_message_from_qwen_object` para lidar com `content_list`.</span>
<span id="cb7-582"><a href="#cb7-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-583"><a href="#cb7-583" aria-hidden="true" tabindex="-1"></a> Al√©m disso, vamos ajustar o m√©todo `_extract_qwen_messages_corrected` para garantir que estamos extraindo todas <span class="im">as</span> mensagens.</span>
<span id="cb7-584"><a href="#cb7-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-585"><a href="#cb7-585" aria-hidden="true" tabindex="-1"></a> No entanto, note que o c√≥digo atual j√° tem v√°rias estrat√©gias de extra√ß√£o. Vamos focar na corre√ß√£o do problema do `content_list`.</span>
<span id="cb7-586"><a href="#cb7-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-587"><a href="#cb7-587" aria-hidden="true" tabindex="-1"></a> Vamos modificar:</span>
<span id="cb7-588"><a href="#cb7-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-589"><a href="#cb7-589" aria-hidden="true" tabindex="-1"></a> <span class="fl">1.</span> `_is_qwen_message_with_content`: para considerar que uma mensagem √© v√°lida se tiver `content_list` mesmo que `content` esteja vazio.</span>
<span id="cb7-590"><a href="#cb7-590" aria-hidden="true" tabindex="-1"></a> <span class="fl">2.</span> `_create_message_from_qwen_object`: para extrair o conte√∫do de `content_list` quando `content` estiver vazio.</span>
<span id="cb7-591"><a href="#cb7-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-592"><a href="#cb7-592" aria-hidden="true" tabindex="-1"></a> Tamb√©m vamos simplificar a extra√ß√£o, pois a an√°lise mostrou que a estrutura do Qwen √© complexa e vari√°vel.</span>
<span id="cb7-593"><a href="#cb7-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-594"><a href="#cb7-594" aria-hidden="true" tabindex="-1"></a> Vamos criar uma fun√ß√£o `_extract_content_from_qwen_message` que lida com:</span>
<span id="cb7-595"><a href="#cb7-595" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> conte√∫do em `content` (string)</span>
<span id="cb7-596"><a href="#cb7-596" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> conte√∫do em `content_list` (lista de dicion√°rios)</span>
<span id="cb7-597"><a href="#cb7-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-598"><a href="#cb7-598" aria-hidden="true" tabindex="-1"></a> E vamos remover a estrat√©gia de extra√ß√£o antiga e substituir por uma mais robusta.</span>
<span id="cb7-599"><a href="#cb7-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-600"><a href="#cb7-600" aria-hidden="true" tabindex="-1"></a> No entanto, note que o c√≥digo atual j√° tem um m√©todo `_process_qwen_content` que lida com conte√∫do em lista. Vamos ajust√°<span class="op">-</span>lo.</span>
<span id="cb7-601"><a href="#cb7-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-602"><a href="#cb7-602" aria-hidden="true" tabindex="-1"></a> Vamos reescrever o m√©todo `_process_qwen_content` para lidar com `content_list`:</span>
<span id="cb7-603"><a href="#cb7-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-604"><a href="#cb7-604" aria-hidden="true" tabindex="-1"></a> O `content_list` √© uma lista de dicion√°rios, cada um com:</span>
<span id="cb7-605"><a href="#cb7-605" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> `type`: por exemplo, <span class="st">&quot;text&quot;</span>, <span class="st">&quot;image&quot;</span></span>
<span id="cb7-606"><a href="#cb7-606" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> `content` ou `text`: o conte√∫do real</span>
<span id="cb7-607"><a href="#cb7-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-608"><a href="#cb7-608" aria-hidden="true" tabindex="-1"></a> Vamos modificar `_process_qwen_content` para aceitar tanto uma string quanto uma lista (que √© o `content_list`).</span>
<span id="cb7-609"><a href="#cb7-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-610"><a href="#cb7-610" aria-hidden="true" tabindex="-1"></a> Mas note: a an√°lise mostrou que o conte√∫do real est√° em `content_list[].content` (e n√£o em `content_list[].text`).</span>
<span id="cb7-611"><a href="#cb7-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-612"><a href="#cb7-612" aria-hidden="true" tabindex="-1"></a> Vamos ajustar:</span>
<span id="cb7-613"><a href="#cb7-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-614"><a href="#cb7-614" aria-hidden="true" tabindex="-1"></a> No m√©todo `_process_qwen_content`:</span>
<span id="cb7-615"><a href="#cb7-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-616"><a href="#cb7-616" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Se `content` <span class="cf">for</span> uma string, retorna a string.</span>
<span id="cb7-617"><a href="#cb7-617" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Se `content` <span class="cf">for</span> uma lista, ent√£o processa cada item da lista:</span>
<span id="cb7-618"><a href="#cb7-618" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> Se o item <span class="cf">for</span> um dicion√°rio com chave <span class="st">&#39;content&#39;</span> (e tipo <span class="st">&#39;text&#39;</span>), pega o valor de <span class="st">&#39;content&#39;</span></span>
<span id="cb7-619"><a href="#cb7-619" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> Se o item <span class="cf">for</span> um dicion√°rio com chave <span class="st">&#39;text&#39;</span>, pega o valor de <span class="st">&#39;text&#39;</span></span>
<span id="cb7-620"><a href="#cb7-620" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> Se o item <span class="cf">for</span> uma string, usa a string.</span>
<span id="cb7-621"><a href="#cb7-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-622"><a href="#cb7-622" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Concatena todos os conte√∫dos de texto.</span>
<span id="cb7-623"><a href="#cb7-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-624"><a href="#cb7-624" aria-hidden="true" tabindex="-1"></a> No entanto, note que a an√°lise mostrou que o `content_list` tem itens com `type` e `content`. Vamos focar em extrair o texto.</span>
<span id="cb7-625"><a href="#cb7-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-626"><a href="#cb7-626" aria-hidden="true" tabindex="-1"></a> Vamos modificar o m√©todo `_process_qwen_content` para:</span>
<span id="cb7-627"><a href="#cb7-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-628"><a href="#cb7-628" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Se o conte√∫do <span class="cf">for</span> uma lista, percorrer cada item e extrair o texto dos itens do tipo <span class="st">&#39;text&#39;</span>.</span>
<span id="cb7-629"><a href="#cb7-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-630"><a href="#cb7-630" aria-hidden="true" tabindex="-1"></a> Vamos tamb√©m modificar o m√©todo `_create_message_from_qwen_object` para usar `_process_qwen_content` no campo `content` e tamb√©m no campo `content_list`?</span>
<span id="cb7-631"><a href="#cb7-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-632"><a href="#cb7-632" aria-hidden="true" tabindex="-1"></a> Na verdade, note que a mensagem do Qwen pode ter:</span>
<span id="cb7-633"><a href="#cb7-633" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Um campo `content` (que pode ser string ou lista) E<span class="op">/</span>OU</span>
<span id="cb7-634"><a href="#cb7-634" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span> Um campo `content_list` (que √© uma</span>
<span id="cb7-635"><a href="#cb7-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-636"><a href="#cb7-636" aria-hidden="true" tabindex="-1"></a><span class="op">---</span></span>
<span id="cb7-637"><a href="#cb7-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-638"><a href="#cb7-638" aria-hidden="true" tabindex="-1"></a><span class="co">### üë§ Utilizador *(2025-11-08 06:27:00)* *[deepseek-reasoner]*</span></span>
<span id="cb7-639"><a href="#cb7-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-640"><a href="#cb7-640" aria-hidden="true" tabindex="-1"></a>Pretendo comb_fragments_system4_html_export.py completo. E que n√£o fosse repetido o erro anterior</span>
<span id="cb7-641"><a href="#cb7-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-642"><a href="#cb7-642" aria-hidden="true" tabindex="-1"></a><span class="op">---</span></span>
<span id="cb7-643"><a href="#cb7-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-644"><a href="#cb7-644" aria-hidden="true" tabindex="-1"></a><span class="co">### ü§ñ DeepSeek *(2025-11-08 06:27:00)* *[deepseek-reasoner]*</span></span>
<span id="cb7-645"><a href="#cb7-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-646"><a href="#cb7-646" aria-hidden="true" tabindex="-1"></a>Vamos corrigir o m√©todo `process_qwen_enhanced` e fun√ß√µes auxiliares para lidar com a estrutura do Qwen, especialmente o problema do `content` vazio e o conte√∫do real em `content_list`.</span>
<span id="cb7-647"><a href="#cb7-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-648"><a href="#cb7-648" aria-hidden="true" tabindex="-1"></a>A an√°lise mostrou que <span class="dv">144</span> de <span class="dv">149</span> mensagens do assistente t√™m `content` vazio, mas t√™m `content_list` com o conte√∫do real. Portanto, precisamos modificar a extra√ß√£o para priorizar `content_list` quando `content` estiver vazio.</span>
<span id="cb7-649"><a href="#cb7-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-650"><a href="#cb7-650" aria-hidden="true" tabindex="-1"></a>Al√©m disso, vamos simplificar a extra√ß√£o para evitar a complexidade desnecess√°ria e focar na estrutura real dos dados.</span>
<span id="cb7-651"><a href="#cb7-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-652"><a href="#cb7-652" aria-hidden="true" tabindex="-1"></a>Vou fornecer o c√≥digo completo do arquivo com <span class="im">as</span> corre√ß√µes necess√°rias:</span>
<span id="cb7-653"><a href="#cb7-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-654"><a href="#cb7-654" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> Modificar `_extract_qwen_messages_corrected` para extrair mensagens de forma mais direta.</span>
<span id="cb7-655"><a href="#cb7-655" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> Corrigir `_is_qwen_message_with_content` para considerar `content_list`.</span>
<span id="cb7-656"><a href="#cb7-656" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> Corrigir `_create_message_from_qwen_object` para extrair o conte√∫do de `content_list` quando `content` estiver vazio.</span>
<span id="cb7-657"><a href="#cb7-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-658"><a href="#cb7-658" aria-hidden="true" tabindex="-1"></a>Vamos l√°: Aqui est√° o c√≥digo completo corrigido para o `comb_fragments_system4_html_export.py`:</span>
<span id="cb7-659"><a href="#cb7-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-660"><a href="#cb7-660" aria-hidden="true" tabindex="-1"></a>```python</span>
<span id="cb7-661"><a href="#cb7-661" aria-hidden="true" tabindex="-1"></a><span class="co"># comb_fragments_system4_html_export.py</span></span>
<span id="cb7-662"><a href="#cb7-662" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb7-663"><a href="#cb7-663" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb7-664"><a href="#cb7-664" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb7-665"><a href="#cb7-665" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb7-666"><a href="#cb7-666" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb7-667"><a href="#cb7-667" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb7-668"><a href="#cb7-668" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb7-669"><a href="#cb7-669" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb7-670"><a href="#cb7-670" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> webbrowser</span>
<span id="cb7-671"><a href="#cb7-671" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb7-672"><a href="#cb7-672" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tempfile</span>
<span id="cb7-673"><a href="#cb7-673" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> traceback</span>
<span id="cb7-674"><a href="#cb7-674" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb7-675"><a href="#cb7-675" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb7-676"><a href="#cb7-676" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Any, Optional</span>
<span id="cb7-677"><a href="#cb7-677" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> markdown</span>
<span id="cb7-678"><a href="#cb7-678" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb7-679"><a href="#cb7-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-680"><a href="#cb7-680" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CombinedFragmentsSystem:</span>
<span id="cb7-681"><a href="#cb7-681" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dry_run<span class="op">=</span><span class="va">False</span>, force_overwrite<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb7-682"><a href="#cb7-682" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_dir <span class="op">=</span> Path(<span class="st">&quot;data&quot;</span>)</span>
<span id="cb7-683"><a href="#cb7-683" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dry_run <span class="op">=</span> dry_run</span>
<span id="cb7-684"><a href="#cb7-684" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.force_overwrite <span class="op">=</span> force_overwrite</span>
<span id="cb7-685"><a href="#cb7-685" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-686"><a href="#cb7-686" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configurar logging</span></span>
<span id="cb7-687"><a href="#cb7-687" aria-hidden="true" tabindex="-1"></a>        logging.basicConfig(level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">&#39;</span>)</span>
<span id="cb7-688"><a href="#cb7-688" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb7-689"><a href="#cb7-689" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-690"><a href="#cb7-690" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estrutura de pastas organizada</span></span>
<span id="cb7-691"><a href="#cb7-691" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dirs <span class="op">=</span> {</span>
<span id="cb7-692"><a href="#cb7-692" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;markdown&#39;</span>: <span class="st">&quot;combined_markdown&quot;</span>,</span>
<span id="cb7-693"><a href="#cb7-693" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_csv&quot;</span>, </span>
<span id="cb7-694"><a href="#cb7-694" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_json&quot;</span>,</span>
<span id="cb7-695"><a href="#cb7-695" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;pdfs&#39;</span>: <span class="st">&quot;combined_pdfs&quot;</span>,</span>
<span id="cb7-696"><a href="#cb7-696" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;html&#39;</span>: <span class="st">&quot;combined_html&quot;</span></span>
<span id="cb7-697"><a href="#cb7-697" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-698"><a href="#cb7-698" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-699"><a href="#cb7-699" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.single_files <span class="op">=</span> {</span>
<span id="cb7-700"><a href="#cb7-700" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_all_conversations.csv&quot;</span>,</span>
<span id="cb7-701"><a href="#cb7-701" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_all_conversations.json&quot;</span></span>
<span id="cb7-702"><a href="#cb7-702" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-703"><a href="#cb7-703" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-704"><a href="#cb7-704" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.index_file <span class="op">=</span> <span class="st">&quot;index.html&quot;</span></span>
<span id="cb7-705"><a href="#cb7-705" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations <span class="op">=</span> []</span>
<span id="cb7-706"><a href="#cb7-706" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-707"><a href="#cb7-707" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configura√ß√£o de processamento por fonte</span></span>
<span id="cb7-708"><a href="#cb7-708" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.processors <span class="op">=</span> {</span>
<span id="cb7-709"><a href="#cb7-709" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;qwen&#39;</span>: {</span>
<span id="cb7-710"><a href="#cb7-710" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chat-export.json&quot;</span>,</span>
<span id="cb7-711"><a href="#cb7-711" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_qwen_corrected,</span>
<span id="cb7-712"><a href="#cb7-712" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb7-713"><a href="#cb7-713" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb7-714"><a href="#cb7-714" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;chatgpt&#39;</span>: {</span>
<span id="cb7-715"><a href="#cb7-715" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chatgpt.zip&quot;</span>, </span>
<span id="cb7-716"><a href="#cb7-716" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_chatgpt,</span>
<span id="cb7-717"><a href="#cb7-717" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb7-718"><a href="#cb7-718" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb7-719"><a href="#cb7-719" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;deepseek&#39;</span>: {</span>
<span id="cb7-720"><a href="#cb7-720" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;deepseek_data.zip&quot;</span>,</span>
<span id="cb7-721"><a href="#cb7-721" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_deepseek,</span>
<span id="cb7-722"><a href="#cb7-722" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb7-723"><a href="#cb7-723" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb7-724"><a href="#cb7-724" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;grok&#39;</span>: {</span>
<span id="cb7-725"><a href="#cb7-725" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;grok.zip&quot;</span>,</span>
<span id="cb7-726"><a href="#cb7-726" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_grok,</span>
<span id="cb7-727"><a href="#cb7-727" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb7-728"><a href="#cb7-728" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb7-729"><a href="#cb7-729" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-730"><a href="#cb7-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-731"><a href="#cb7-731" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sanitize_filename(<span class="va">self</span>, text: <span class="bu">str</span>, max_len: <span class="bu">int</span> <span class="op">=</span> <span class="dv">50</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-732"><a href="#cb7-732" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Sanitiza nomes de arquivo REMOVENDO ESPA√áOS e preservando emojis&quot;&quot;&quot;</span></span>
<span id="cb7-733"><a href="#cb7-733" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb7-734"><a href="#cb7-734" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb7-735"><a href="#cb7-735" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-736"><a href="#cb7-736" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove caracteres inv√°lidos</span></span>
<span id="cb7-737"><a href="#cb7-737" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="dv">\s</span><span class="pp">]</span><span class="vs">&#39;</span>  <span class="co"># Inclui \s para remover espa√ßos</span></span>
<span id="cb7-738"><a href="#cb7-738" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;_&#39;</span>, text)  <span class="co"># Substitui espa√ßos por underscores</span></span>
<span id="cb7-739"><a href="#cb7-739" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;_</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39;_&#39;</span>, sanitized)  <span class="co"># Remove underscores duplicados</span></span>
<span id="cb7-740"><a href="#cb7-740" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> sanitized.strip(<span class="st">&#39;_&#39;</span>)  <span class="co"># Remove underscores no in√≠cio e fim</span></span>
<span id="cb7-741"><a href="#cb7-741" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-742"><a href="#cb7-742" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb7-743"><a href="#cb7-743" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb7-744"><a href="#cb7-744" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-745"><a href="#cb7-745" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Limita o comprimento</span></span>
<span id="cb7-746"><a href="#cb7-746" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(sanitized) <span class="op">&gt;</span> max_len:</span>
<span id="cb7-747"><a href="#cb7-747" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Tenta cortar em um ponto l√≥gico (underscore)</span></span>
<span id="cb7-748"><a href="#cb7-748" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;_&#39;</span> <span class="kw">in</span> sanitized[:max_len]:</span>
<span id="cb7-749"><a href="#cb7-749" aria-hidden="true" tabindex="-1"></a>                last_underscore <span class="op">=</span> sanitized[:max_len].rfind(<span class="st">&#39;_&#39;</span>)</span>
<span id="cb7-750"><a href="#cb7-750" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> last_underscore <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb7-751"><a href="#cb7-751" aria-hidden="true" tabindex="-1"></a>                    sanitized <span class="op">=</span> sanitized[:last_underscore]</span>
<span id="cb7-752"><a href="#cb7-752" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb7-753"><a href="#cb7-753" aria-hidden="true" tabindex="-1"></a>                sanitized <span class="op">=</span> sanitized[:max_len]</span>
<span id="cb7-754"><a href="#cb7-754" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-755"><a href="#cb7-755" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb7-756"><a href="#cb7-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-757"><a href="#cb7-757" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_original_title(<span class="va">self</span>, text: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-758"><a href="#cb7-758" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Preserva o t√≠tulo original com espa√ßos, apenas removendo caracteres realmente inv√°lidos&quot;&quot;&quot;</span></span>
<span id="cb7-759"><a href="#cb7-759" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb7-760"><a href="#cb7-760" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb7-761"><a href="#cb7-761" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-762"><a href="#cb7-762" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove apenas caracteres realmente problem√°ticos, mantendo espa√ßos</span></span>
<span id="cb7-763"><a href="#cb7-763" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="pp">]</span><span class="vs">&#39;</span></span>
<span id="cb7-764"><a href="#cb7-764" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;&#39;</span>, text)</span>
<span id="cb7-765"><a href="#cb7-765" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;</span><span class="dv">\s</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39; &#39;</span>, sanitized.strip())</span>
<span id="cb7-766"><a href="#cb7-766" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-767"><a href="#cb7-767" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb7-768"><a href="#cb7-768" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb7-769"><a href="#cb7-769" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-770"><a href="#cb7-770" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb7-771"><a href="#cb7-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-772"><a href="#cb7-772" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_special_content(<span class="va">self</span>, content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-773"><a href="#cb7-773" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Preserva f√≥rmulas matem√°ticas, c√≥digo e formata√ß√£o especial&quot;&quot;&quot;</span></span>
<span id="cb7-774"><a href="#cb7-774" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb7-775"><a href="#cb7-775" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;&quot;</span></span>
<span id="cb7-776"><a href="#cb7-776" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-777"><a href="#cb7-777" aria-hidden="true" tabindex="-1"></a>        preserved_content <span class="op">=</span> content</span>
<span id="cb7-778"><a href="#cb7-778" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-779"><a href="#cb7-779" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Corrige problemas com barras invertidas em LaTeX</span></span>
<span id="cb7-780"><a href="#cb7-780" aria-hidden="true" tabindex="-1"></a>        latex_corrections <span class="op">=</span> {</span>
<span id="cb7-781"><a href="#cb7-781" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ärac&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">frac&#39;</span>,</span>
<span id="cb7-782"><a href="#cb7-782" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Çarepsilon&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">varepsilon&#39;</span>,</span>
<span id="cb7-783"><a href="#cb7-783" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ç&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span>,</span>
<span id="cb7-784"><a href="#cb7-784" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ä&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span></span>
<span id="cb7-785"><a href="#cb7-785" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-786"><a href="#cb7-786" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-787"><a href="#cb7-787" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> wrong, correct <span class="kw">in</span> latex_corrections.items():</span>
<span id="cb7-788"><a href="#cb7-788" aria-hidden="true" tabindex="-1"></a>            preserved_content <span class="op">=</span> preserved_content.replace(wrong, correct)</span>
<span id="cb7-789"><a href="#cb7-789" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-790"><a href="#cb7-790" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> preserved_content</span>
<span id="cb7-791"><a href="#cb7-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-792"><a href="#cb7-792" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ensure_directories(<span class="va">self</span>):</span>
<span id="cb7-793"><a href="#cb7-793" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Cria todas as pastas necess√°rias&quot;&quot;&quot;</span></span>
<span id="cb7-794"><a href="#cb7-794" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb7-795"><a href="#cb7-795" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;DRY-RUN: Pastas seriam criadas:&quot;</span>)</span>
<span id="cb7-796"><a href="#cb7-796" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb7-797"><a href="#cb7-797" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-798"><a href="#cb7-798" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-799"><a href="#cb7-799" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-800"><a href="#cb7-800" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb7-801"><a href="#cb7-801" aria-hidden="true" tabindex="-1"></a>            Path(folder).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-802"><a href="#cb7-802" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;Pasta criada: </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-803"><a href="#cb7-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-804"><a href="#cb7-804" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> run(<span class="va">self</span>):</span>
<span id="cb7-805"><a href="#cb7-805" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Executa o processamento completo&quot;&quot;&quot;</span></span>
<span id="cb7-806"><a href="#cb7-806" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;SISTEMA COMBINADO DE EXPORTA√á√ïES COM HTML (Qwen3, ChatGPT, DeepSeek, Grok)&quot;</span>)</span>
<span id="cb7-807"><a href="#cb7-807" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb7-808"><a href="#cb7-808" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-809"><a href="#cb7-809" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.data_dir.exists():</span>
<span id="cb7-810"><a href="#cb7-810" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;Pasta &#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">}</span><span class="ss">&#39; n√£o encontrada.&quot;</span>)</span>
<span id="cb7-811"><a href="#cb7-811" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;Crie a pasta &#39;data&#39; e coloque os arquivos de exporta√ß√£o:&quot;</span>)</span>
<span id="cb7-812"><a href="#cb7-812" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb7-813"><a href="#cb7-813" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   - </span><span class="sc">{</span>config[<span class="st">&#39;file&#39;</span>]<span class="sc">}</span><span class="ss"> (para </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb7-814"><a href="#cb7-814" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-815"><a href="#cb7-815" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-816"><a href="#cb7-816" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;Usando pasta de dados: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-817"><a href="#cb7-817" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-818"><a href="#cb7-818" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ensure_directories()</span>
<span id="cb7-819"><a href="#cb7-819" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-820"><a href="#cb7-820" aria-hidden="true" tabindex="-1"></a>        processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-821"><a href="#cb7-821" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb7-822"><a href="#cb7-822" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> config[<span class="st">&#39;enabled&#39;</span>]:</span>
<span id="cb7-823"><a href="#cb7-823" aria-hidden="true" tabindex="-1"></a>                file_path <span class="op">=</span> <span class="va">self</span>.data_dir <span class="op">/</span> config[<span class="st">&#39;file&#39;</span>]</span>
<span id="cb7-824"><a href="#cb7-824" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> file_path.exists():</span>
<span id="cb7-825"><a href="#cb7-825" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Processando </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb7-826"><a href="#cb7-826" aria-hidden="true" tabindex="-1"></a>                    config[<span class="st">&#39;method&#39;</span>](file_path)</span>
<span id="cb7-827"><a href="#cb7-827" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-828"><a href="#cb7-828" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb7-829"><a href="#cb7-829" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.warning(<span class="ss">f&quot;</span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">: arquivo n√£o encontrado - </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-830"><a href="#cb7-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-831"><a href="#cb7-831" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> processed_count <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb7-832"><a href="#cb7-832" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhum arquivo de exporta√ß√£o encontrado na pasta &#39;data&#39;.&quot;</span>)</span>
<span id="cb7-833"><a href="#cb7-833" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-834"><a href="#cb7-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-835"><a href="#cb7-835" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb7-836"><a href="#cb7-836" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhuma conversa foi extra√≠da dos arquivos.&quot;</span>)</span>
<span id="cb7-837"><a href="#cb7-837" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-838"><a href="#cb7-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-839"><a href="#cb7-839" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._post_process_conversations()</span>
<span id="cb7-840"><a href="#cb7-840" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-841"><a href="#cb7-841" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.dry_run:</span>
<span id="cb7-842"><a href="#cb7-842" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._export_all_formats()</span>
<span id="cb7-843"><a href="#cb7-843" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üéâ SISTEMA COMBINADO FINALIZADO!&quot;</span>)</span>
<span id="cb7-844"><a href="#cb7-844" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ √çndice: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-845"><a href="#cb7-845" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> Path(<span class="va">self</span>.index_file).exists():</span>
<span id="cb7-846"><a href="#cb7-846" aria-hidden="true" tabindex="-1"></a>                webbrowser.<span class="bu">open</span>(<span class="ss">f&#39;file://</span><span class="sc">{</span>Path(<span class="va">self</span>.index_file)<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb7-847"><a href="#cb7-847" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-848"><a href="#cb7-848" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üîÆ MODO DRY-RUN: Nenhum arquivo foi criado.&quot;</span>)</span>
<span id="cb7-849"><a href="#cb7-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-850"><a href="#cb7-850" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _post_process_conversations(<span class="va">self</span>):</span>
<span id="cb7-851"><a href="#cb7-851" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Processamento p√≥s-extra√ß√£o das conversas&quot;&quot;&quot;</span></span>
<span id="cb7-852"><a href="#cb7-852" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations.sort(</span>
<span id="cb7-853"><a href="#cb7-853" aria-hidden="true" tabindex="-1"></a>            key<span class="op">=</span><span class="kw">lambda</span> x: <span class="va">self</span>.parse_timestamp_for_sorting(</span>
<span id="cb7-854"><a href="#cb7-854" aria-hidden="true" tabindex="-1"></a>                x.get(<span class="st">&#39;updated_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;created_at&#39;</span>)</span>
<span id="cb7-855"><a href="#cb7-855" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb7-856"><a href="#cb7-856" aria-hidden="true" tabindex="-1"></a>            reverse<span class="op">=</span><span class="va">True</span></span>
<span id="cb7-857"><a href="#cb7-857" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-858"><a href="#cb7-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-859"><a href="#cb7-859" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.all_conversations):</span>
<span id="cb7-860"><a href="#cb7-860" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;number&#39;</span>] <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb7-861"><a href="#cb7-861" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;category&#39;</span>] <span class="op">=</span> <span class="va">self</span>.categorize_conversation(conv[<span class="st">&#39;title&#39;</span>], conv.get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;&#39;</span>))</span>
<span id="cb7-862"><a href="#cb7-862" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;source&#39;</span>, <span class="st">&#39;Desconhecido&#39;</span>)</span>
<span id="cb7-863"><a href="#cb7-863" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;messages&#39;</span>, [])</span>
<span id="cb7-864"><a href="#cb7-864" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;summary&#39;</span>, conv[<span class="st">&#39;messages&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> conv[<span class="st">&#39;messages&#39;</span>] <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>)</span>
<span id="cb7-865"><a href="#cb7-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-866"><a href="#cb7-866" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä Total combinado de conversas: </span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-867"><a href="#cb7-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-868"><a href="#cb7-868" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _export_all_formats(<span class="va">self</span>):</span>
<span id="cb7-869"><a href="#cb7-869" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Exporta para todos os formatos&quot;&quot;&quot;</span></span>
<span id="cb7-870"><a href="#cb7-870" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">üîÑ Exportando para formatos...&quot;</span>)</span>
<span id="cb7-871"><a href="#cb7-871" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_markdown_enhanced()</span>
<span id="cb7-872"><a href="#cb7-872" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_html_robust()</span>
<span id="cb7-873"><a href="#cb7-873" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_csv() </span>
<span id="cb7-874"><a href="#cb7-874" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_json()</span>
<span id="cb7-875"><a href="#cb7-875" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_all_to_single_files()</span>
<span id="cb7-876"><a href="#cb7-876" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.create_searchable_index()</span>
<span id="cb7-877"><a href="#cb7-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-878"><a href="#cb7-878" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _get_pandoc_version(<span class="va">self</span>) <span class="op">-&gt;</span> Optional[<span class="bu">tuple</span>]:</span>
<span id="cb7-879"><a href="#cb7-879" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Obt√©m a vers√£o do Pandoc para compatibilidade&quot;&quot;&quot;</span></span>
<span id="cb7-880"><a href="#cb7-880" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb7-881"><a href="#cb7-881" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run([<span class="st">&#39;pandoc&#39;</span>, <span class="st">&#39;--version&#39;</span>], capture_output<span class="op">=</span><span class="va">True</span>, text<span class="op">=</span><span class="va">True</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>)</span>
<span id="cb7-882"><a href="#cb7-882" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb7-883"><a href="#cb7-883" aria-hidden="true" tabindex="-1"></a>                first_line <span class="op">=</span> result.stdout.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb7-884"><a href="#cb7-884" aria-hidden="true" tabindex="-1"></a>                version_str <span class="op">=</span> first_line.split()[<span class="dv">1</span>]</span>
<span id="cb7-885"><a href="#cb7-885" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="bu">tuple</span>(<span class="bu">map</span>(<span class="bu">int</span>, version_str.split(<span class="st">&#39;.&#39;</span>)))</span>
<span id="cb7-886"><a href="#cb7-886" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb7-887"><a href="#cb7-887" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb7-888"><a href="#cb7-888" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb7-889"><a href="#cb7-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-890"><a href="#cb7-890" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_optimized(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb7-891"><a href="#cb7-891" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Convers√£o OTIMIZADA com Pandoc usando todas as op√ß√µes avan√ßadas&quot;&quot;&quot;</span></span>
<span id="cb7-892"><a href="#cb7-892" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb7-893"><a href="#cb7-893" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Convertendo com Pandoc otimizado: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-894"><a href="#cb7-894" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-895"><a href="#cb7-895" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica se o arquivo MathJax local existe</span></span>
<span id="cb7-896"><a href="#cb7-896" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb7-897"><a href="#cb7-897" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb7-898"><a href="#cb7-898" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-899"><a href="#cb7-899" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Comandos base</span></span>
<span id="cb7-900"><a href="#cb7-900" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb7-901"><a href="#cb7-901" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb7-902"><a href="#cb7-902" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb7-903"><a href="#cb7-903" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji+autolink_bare_uris+tex_math_single_backslash&#39;</span>,</span>
<span id="cb7-904"><a href="#cb7-904" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb7-905"><a href="#cb7-905" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb7-906"><a href="#cb7-906" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span>,</span>
<span id="cb7-907"><a href="#cb7-907" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--table-of-contents&#39;</span>,</span>
<span id="cb7-908"><a href="#cb7-908" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--toc-depth=2&#39;</span>, </span>
<span id="cb7-909"><a href="#cb7-909" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--number-sections&#39;</span></span>
<span id="cb7-910"><a href="#cb7-910" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb7-911"><a href="#cb7-911" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-912"><a href="#cb7-912" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica vers√£o do Pandoc para recursos avan√ßados</span></span>
<span id="cb7-913"><a href="#cb7-913" aria-hidden="true" tabindex="-1"></a>            pandoc_version <span class="op">=</span> <span class="va">self</span>._get_pandoc_version()</span>
<span id="cb7-914"><a href="#cb7-914" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-915"><a href="#cb7-915" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Adiciona --embed-resources apenas se suportado (Pandoc 2.19+)</span></span>
<span id="cb7-916"><a href="#cb7-916" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pandoc_version <span class="kw">and</span> pandoc_version <span class="op">&gt;=</span> (<span class="dv">2</span>, <span class="dv">19</span>):</span>
<span id="cb7-917"><a href="#cb7-917" aria-hidden="true" tabindex="-1"></a>                command.append(<span class="st">&#39;--embed-resources&#39;</span>)</span>
<span id="cb7-918"><a href="#cb7-918" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="st">&quot;‚úÖ Usando --embed-resources (Pandoc 2.19+)&quot;</span>)</span>
<span id="cb7-919"><a href="#cb7-919" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb7-920"><a href="#cb7-920" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="st">&quot;‚ÑπÔ∏è  --embed-resources n√£o suportado, usando recursos externos&quot;</span>)</span>
<span id="cb7-921"><a href="#cb7-921" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-922"><a href="#cb7-922" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Adiciona syntax highlighting</span></span>
<span id="cb7-923"><a href="#cb7-923" aria-hidden="true" tabindex="-1"></a>            command.extend([<span class="st">&#39;--syntax-highlighting=pygments&#39;</span>])</span>
<span id="cb7-924"><a href="#cb7-924" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-925"><a href="#cb7-925" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb7-926"><a href="#cb7-926" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb7-927"><a href="#cb7-927" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb7-928"><a href="#cb7-928" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb7-929"><a href="#cb7-929" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb7-930"><a href="#cb7-930" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">180</span></span>
<span id="cb7-931"><a href="#cb7-931" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb7-932"><a href="#cb7-932" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-933"><a href="#cb7-933" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb7-934"><a href="#cb7-934" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> result.stdout</span>
<span id="cb7-935"><a href="#cb7-935" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-936"><a href="#cb7-936" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Aplica otimiza√ß√µes adicionais</span></span>
<span id="cb7-937"><a href="#cb7-937" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="va">self</span>._optimize_html_content(html_content)</span>
<span id="cb7-938"><a href="#cb7-938" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> html_content</span>
<span id="cb7-939"><a href="#cb7-939" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb7-940"><a href="#cb7-940" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc otimizado falhou, tentando m√©todo b√°sico: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-941"><a href="#cb7-941" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb7-942"><a href="#cb7-942" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-943"><a href="#cb7-943" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> subprocess.TimeoutExpired:</span>
<span id="cb7-944"><a href="#cb7-944" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Timeout no Pandoc otimizado&quot;</span>)</span>
<span id="cb7-945"><a href="#cb7-945" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb7-946"><a href="#cb7-946" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-947"><a href="#cb7-947" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc otimizado: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-948"><a href="#cb7-948" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb7-949"><a href="#cb7-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-950"><a href="#cb7-950" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_basic(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb7-951"><a href="#cb7-951" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;M√©todo b√°sico de fallback para Pandoc com TOC e numera√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb7-952"><a href="#cb7-952" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb7-953"><a href="#cb7-953" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Tentando convers√£o b√°sica: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-954"><a href="#cb7-954" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-955"><a href="#cb7-955" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb7-956"><a href="#cb7-956" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb7-957"><a href="#cb7-957" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-958"><a href="#cb7-958" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb7-959"><a href="#cb7-959" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb7-960"><a href="#cb7-960" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb7-961"><a href="#cb7-961" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown&#39;</span>,</span>
<span id="cb7-962"><a href="#cb7-962" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb7-963"><a href="#cb7-963" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb7-964"><a href="#cb7-964" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--table-of-contents&#39;</span>,</span>
<span id="cb7-965"><a href="#cb7-965" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--toc-depth=2&#39;</span>,</span>
<span id="cb7-966"><a href="#cb7-966" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--number-sections&#39;</span>,</span>
<span id="cb7-967"><a href="#cb7-967" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb7-968"><a href="#cb7-968" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb7-969"><a href="#cb7-969" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-970"><a href="#cb7-970" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb7-971"><a href="#cb7-971" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb7-972"><a href="#cb7-972" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb7-973"><a href="#cb7-973" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb7-974"><a href="#cb7-974" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb7-975"><a href="#cb7-975" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">120</span></span>
<span id="cb7-976"><a href="#cb7-976" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb7-977"><a href="#cb7-977" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-978"><a href="#cb7-978" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb7-979"><a href="#cb7-979" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._optimize_html_content(result.stdout)</span>
<span id="cb7-980"><a href="#cb7-980" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb7-981"><a href="#cb7-981" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc b√°sico falhou, usando fallback Python: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-982"><a href="#cb7-982" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb7-983"><a href="#cb7-983" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-984"><a href="#cb7-984" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-985"><a href="#cb7-985" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc b√°sico: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-986"><a href="#cb7-986" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb7-987"><a href="#cb7-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-988"><a href="#cb7-988" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _optimize_html_content(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-989"><a href="#cb7-989" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Aplica otimiza√ß√µes finais ao conte√∫do HTML&quot;&quot;&quot;</span></span>
<span id="cb7-990"><a href="#cb7-990" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona viewport para responsividade</span></span>
<span id="cb7-991"><a href="#cb7-991" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;viewport&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb7-992"><a href="#cb7-992" aria-hidden="true" tabindex="-1"></a>            viewport_meta <span class="op">=</span> <span class="st">&#39;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#39;</span></span>
<span id="cb7-993"><a href="#cb7-993" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="ss">    </span><span class="sc">{</span>viewport_meta<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb7-994"><a href="#cb7-994" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-995"><a href="#cb7-995" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Melhora acessibilidade</span></span>
<span id="cb7-996"><a href="#cb7-996" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;html&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;lang&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb7-997"><a href="#cb7-997" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;html&gt;&#39;</span>, <span class="st">&#39;&lt;html lang=&quot;pt-BR&quot;&gt;&#39;</span>)</span>
<span id="cb7-998"><a href="#cb7-998" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-999"><a href="#cb7-999" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona CSS personalizado para melhorar TOC e numera√ß√£o</span></span>
<span id="cb7-1000"><a href="#cb7-1000" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="va">self</span>._inject_enhanced_css(html_content)</span>
<span id="cb7-1001"><a href="#cb7-1001" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1002"><a href="#cb7-1002" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Otimiza TOC gerado pelo Pandoc</span></span>
<span id="cb7-1003"><a href="#cb7-1003" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="va">self</span>._enhance_toc_styling(html_content)</span>
<span id="cb7-1004"><a href="#cb7-1004" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1005"><a href="#cb7-1005" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb7-1006"><a href="#cb7-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1007"><a href="#cb7-1007" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _inject_enhanced_css(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-1008"><a href="#cb7-1008" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Injeta CSS personalizado aprimorado para TOC e numera√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb7-1009"><a href="#cb7-1009" aria-hidden="true" tabindex="-1"></a>        enhanced_css <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb7-1010"><a href="#cb7-1010" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;style&gt;</span></span>
<span id="cb7-1011"><a href="#cb7-1011" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Layout principal melhorado para desktop */</span></span>
<span id="cb7-1012"><a href="#cb7-1012" aria-hidden="true" tabindex="-1"></a><span class="st">            body {</span></span>
<span id="cb7-1013"><a href="#cb7-1013" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb7-1014"><a href="#cb7-1014" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.6;</span></span>
<span id="cb7-1015"><a href="#cb7-1015" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0;</span></span>
<span id="cb7-1016"><a href="#cb7-1016" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb7-1017"><a href="#cb7-1017" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #f5f5f5;</span></span>
<span id="cb7-1018"><a href="#cb7-1018" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #333;</span></span>
<span id="cb7-1019"><a href="#cb7-1019" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: none; /* Remove limita√ß√£o de largura */</span></span>
<span id="cb7-1020"><a href="#cb7-1020" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1021"><a href="#cb7-1021" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1022"><a href="#cb7-1022" aria-hidden="true" tabindex="-1"></a><span class="st">            .container {</span></span>
<span id="cb7-1023"><a href="#cb7-1023" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb7-1024"><a href="#cb7-1024" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0 auto;</span></span>
<span id="cb7-1025"><a href="#cb7-1025" aria-hidden="true" tabindex="-1"></a><span class="st">                background: white;</span></span>
<span id="cb7-1026"><a href="#cb7-1026" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 40px;</span></span>
<span id="cb7-1027"><a href="#cb7-1027" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 10px;</span></span>
<span id="cb7-1028"><a href="#cb7-1028" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb7-1029"><a href="#cb7-1029" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1030"><a href="#cb7-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1031"><a href="#cb7-1031" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Estilos para Table of Contents */</span></span>
<span id="cb7-1032"><a href="#cb7-1032" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC {</span></span>
<span id="cb7-1033"><a href="#cb7-1033" aria-hidden="true" tabindex="-1"></a><span class="st">                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);</span></span>
<span id="cb7-1034"><a href="#cb7-1034" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #dee2e6;</span></span>
<span id="cb7-1035"><a href="#cb7-1035" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb7-1036"><a href="#cb7-1036" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb7-1037"><a href="#cb7-1037" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 20px 0;</span></span>
<span id="cb7-1038"><a href="#cb7-1038" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb7-1039"><a href="#cb7-1039" aria-hidden="true" tabindex="-1"></a><span class="st">                float: right;</span></span>
<span id="cb7-1040"><a href="#cb7-1040" aria-hidden="true" tabindex="-1"></a><span class="st">                width: 300px;</span></span>
<span id="cb7-1041"><a href="#cb7-1041" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-left: 30px;</span></span>
<span id="cb7-1042"><a href="#cb7-1042" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-bottom: 30px;</span></span>
<span id="cb7-1043"><a href="#cb7-1043" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1044"><a href="#cb7-1044" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1045"><a href="#cb7-1045" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul {</span></span>
<span id="cb7-1046"><a href="#cb7-1046" aria-hidden="true" tabindex="-1"></a><span class="st">                list-style-type: none;</span></span>
<span id="cb7-1047"><a href="#cb7-1047" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 15px;</span></span>
<span id="cb7-1048"><a href="#cb7-1048" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 10px 0;</span></span>
<span id="cb7-1049"><a href="#cb7-1049" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1050"><a href="#cb7-1050" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1051"><a href="#cb7-1051" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul ul {</span></span>
<span id="cb7-1052"><a href="#cb7-1052" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 25px;</span></span>
<span id="cb7-1053"><a href="#cb7-1053" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1054"><a href="#cb7-1054" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1055"><a href="#cb7-1055" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC li {</span></span>
<span id="cb7-1056"><a href="#cb7-1056" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 8px 0;</span></span>
<span id="cb7-1057"><a href="#cb7-1057" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.4;</span></span>
<span id="cb7-1058"><a href="#cb7-1058" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1059"><a href="#cb7-1059" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1060"><a href="#cb7-1060" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a {</span></span>
<span id="cb7-1061"><a href="#cb7-1061" aria-hidden="true" tabindex="-1"></a><span class="st">                text-decoration: none;</span></span>
<span id="cb7-1062"><a href="#cb7-1062" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #495057;</span></span>
<span id="cb7-1063"><a href="#cb7-1063" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 500;</span></span>
<span id="cb7-1064"><a href="#cb7-1064" aria-hidden="true" tabindex="-1"></a><span class="st">                transition: color 0.2s ease;</span></span>
<span id="cb7-1065"><a href="#cb7-1065" aria-hidden="true" tabindex="-1"></a><span class="st">                display: block;</span></span>
<span id="cb7-1066"><a href="#cb7-1066" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 4px 8px;</span></span>
<span id="cb7-1067"><a href="#cb7-1067" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 4px;</span></span>
<span id="cb7-1068"><a href="#cb7-1068" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1069"><a href="#cb7-1069" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1070"><a href="#cb7-1070" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a:hover {</span></span>
<span id="cb7-1071"><a href="#cb7-1071" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #007bff;</span></span>
<span id="cb7-1072"><a href="#cb7-1072" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: rgba(0, 123, 255, 0.1);</span></span>
<span id="cb7-1073"><a href="#cb7-1073" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1074"><a href="#cb7-1074" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1075"><a href="#cb7-1075" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC &gt; ul &gt; li &gt; a {</span></span>
<span id="cb7-1076"><a href="#cb7-1076" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 600;</span></span>
<span id="cb7-1077"><a href="#cb7-1077" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50;</span></span>
<span id="cb7-1078"><a href="#cb7-1078" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 3px solid #3498db;</span></span>
<span id="cb7-1079"><a href="#cb7-1079" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 12px;</span></span>
<span id="cb7-1080"><a href="#cb7-1080" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1081"><a href="#cb7-1081" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1082"><a href="#cb7-1082" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Estilos para numera√ß√£o de se√ß√µes */</span></span>
<span id="cb7-1083"><a href="#cb7-1083" aria-hidden="true" tabindex="-1"></a><span class="st">            .header-section-number {</span></span>
<span id="cb7-1084"><a href="#cb7-1084" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #3498db;</span></span>
<span id="cb7-1085"><a href="#cb7-1085" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: bold;</span></span>
<span id="cb7-1086"><a href="#cb7-1086" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-right: 8px;</span></span>
<span id="cb7-1087"><a href="#cb7-1087" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1088"><a href="#cb7-1088" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1089"><a href="#cb7-1089" aria-hidden="true" tabindex="-1"></a><span class="st">            h1 .header-section-number {</span></span>
<span id="cb7-1090"><a href="#cb7-1090" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.9em;</span></span>
<span id="cb7-1091"><a href="#cb7-1091" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1092"><a href="#cb7-1092" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1093"><a href="#cb7-1093" aria-hidden="true" tabindex="-1"></a><span class="st">            h2 .header-section-number {</span></span>
<span id="cb7-1094"><a href="#cb7-1094" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.85em;</span></span>
<span id="cb7-1095"><a href="#cb7-1095" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1096"><a href="#cb7-1096" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1097"><a href="#cb7-1097" aria-hidden="true" tabindex="-1"></a><span class="st">            h3 .header-section-number {</span></span>
<span id="cb7-1098"><a href="#cb7-1098" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.8em;</span></span>
<span id="cb7-1099"><a href="#cb7-1099" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1100"><a href="#cb7-1100" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1101"><a href="#cb7-1101" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para c√≥digo e matem√°tica */</span></span>
<span id="cb7-1102"><a href="#cb7-1102" aria-hidden="true" tabindex="-1"></a><span class="st">            .math { display: block; text-align: center; margin: 1.5em 0; }</span></span>
<span id="cb7-1103"><a href="#cb7-1103" aria-hidden="true" tabindex="-1"></a><span class="st">            .math inline { display: inline-block; }</span></span>
<span id="cb7-1104"><a href="#cb7-1104" aria-hidden="true" tabindex="-1"></a><span class="st">            pre { </span></span>
<span id="cb7-1105"><a href="#cb7-1105" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb7-1106"><a href="#cb7-1106" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #2d2d2d; </span></span>
<span id="cb7-1107"><a href="#cb7-1107" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #f8f8f2;</span></span>
<span id="cb7-1108"><a href="#cb7-1108" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb7-1109"><a href="#cb7-1109" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb7-1110"><a href="#cb7-1110" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow-x: auto;</span></span>
<span id="cb7-1111"><a href="#cb7-1111" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb7-1112"><a href="#cb7-1112" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.4;</span></span>
<span id="cb7-1113"><a href="#cb7-1113" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1114"><a href="#cb7-1114" aria-hidden="true" tabindex="-1"></a><span class="st">            code { </span></span>
<span id="cb7-1115"><a href="#cb7-1115" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #e9ecef; </span></span>
<span id="cb7-1116"><a href="#cb7-1116" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 0.2em 0.4em; </span></span>
<span id="cb7-1117"><a href="#cb7-1117" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 3px;</span></span>
<span id="cb7-1118"><a href="#cb7-1118" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb7-1119"><a href="#cb7-1119" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #c7254e;</span></span>
<span id="cb7-1120"><a href="#cb7-1120" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1121"><a href="#cb7-1121" aria-hidden="true" tabindex="-1"></a><span class="st">            pre code { </span></span>
<span id="cb7-1122"><a href="#cb7-1122" aria-hidden="true" tabindex="-1"></a><span class="st">                background: none; </span></span>
<span id="cb7-1123"><a href="#cb7-1123" aria-hidden="true" tabindex="-1"></a><span class="st">                color: inherit; </span></span>
<span id="cb7-1124"><a href="#cb7-1124" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 0; </span></span>
<span id="cb7-1125"><a href="#cb7-1125" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1126"><a href="#cb7-1126" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1127"><a href="#cb7-1127" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias responsivas */</span></span>
<span id="cb7-1128"><a href="#cb7-1128" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 1200px) {</span></span>
<span id="cb7-1129"><a href="#cb7-1129" aria-hidden="true" tabindex="-1"></a><span class="st">                .container {</span></span>
<span id="cb7-1130"><a href="#cb7-1130" aria-hidden="true" tabindex="-1"></a><span class="st">                    max-width: 98%;</span></span>
<span id="cb7-1131"><a href="#cb7-1131" aria-hidden="true" tabindex="-1"></a><span class="st">                    padding: 30px;</span></span>
<span id="cb7-1132"><a href="#cb7-1132" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb7-1133"><a href="#cb7-1133" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC {</span></span>
<span id="cb7-1134"><a href="#cb7-1134" aria-hidden="true" tabindex="-1"></a><span class="st">                    float: none;</span></span>
<span id="cb7-1135"><a href="#cb7-1135" aria-hidden="true" tabindex="-1"></a><span class="st">                    width: auto;</span></span>
<span id="cb7-1136"><a href="#cb7-1136" aria-hidden="true" tabindex="-1"></a><span class="st">                    margin: 20px 0;</span></span>
<span id="cb7-1137"><a href="#cb7-1137" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb7-1138"><a href="#cb7-1138" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1139"><a href="#cb7-1139" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1140"><a href="#cb7-1140" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 768px) {</span></span>
<span id="cb7-1141"><a href="#cb7-1141" aria-hidden="true" tabindex="-1"></a><span class="st">                body { padding: 10px; font-size: 14px; }</span></span>
<span id="cb7-1142"><a href="#cb7-1142" aria-hidden="true" tabindex="-1"></a><span class="st">                .container { padding: 20px; max-width: 100%; }</span></span>
<span id="cb7-1143"><a href="#cb7-1143" aria-hidden="true" tabindex="-1"></a><span class="st">                pre { font-size: 12px; padding: 15px; }</span></span>
<span id="cb7-1144"><a href="#cb7-1144" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC { padding: 15px; }</span></span>
<span id="cb7-1145"><a href="#cb7-1145" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1146"><a href="#cb7-1146" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1147"><a href="#cb7-1147" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para tabelas */</span></span>
<span id="cb7-1148"><a href="#cb7-1148" aria-hidden="true" tabindex="-1"></a><span class="st">            table { </span></span>
<span id="cb7-1149"><a href="#cb7-1149" aria-hidden="true" tabindex="-1"></a><span class="st">                width: 100%; </span></span>
<span id="cb7-1150"><a href="#cb7-1150" aria-hidden="true" tabindex="-1"></a><span class="st">                border-collapse: collapse; </span></span>
<span id="cb7-1151"><a href="#cb7-1151" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 1.5em 0;</span></span>
<span id="cb7-1152"><a href="#cb7-1152" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb7-1153"><a href="#cb7-1153" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb7-1154"><a href="#cb7-1154" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow: hidden;</span></span>
<span id="cb7-1155"><a href="#cb7-1155" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1156"><a href="#cb7-1156" aria-hidden="true" tabindex="-1"></a><span class="st">            th, td { </span></span>
<span id="cb7-1157"><a href="#cb7-1157" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #dee2e6; </span></span>
<span id="cb7-1158"><a href="#cb7-1158" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 12px 15px; </span></span>
<span id="cb7-1159"><a href="#cb7-1159" aria-hidden="true" tabindex="-1"></a><span class="st">                text-align: left; </span></span>
<span id="cb7-1160"><a href="#cb7-1160" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1161"><a href="#cb7-1161" aria-hidden="true" tabindex="-1"></a><span class="st">            th { </span></span>
<span id="cb7-1162"><a href="#cb7-1162" aria-hidden="true" tabindex="-1"></a><span class="st">                background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb7-1163"><a href="#cb7-1163" aria-hidden="true" tabindex="-1"></a><span class="st">                color: white; </span></span>
<span id="cb7-1164"><a href="#cb7-1164" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: bold;</span></span>
<span id="cb7-1165"><a href="#cb7-1165" aria-hidden="true" tabindex="-1"></a><span class="st">                text-transform: uppercase;</span></span>
<span id="cb7-1166"><a href="#cb7-1166" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.9em;</span></span>
<span id="cb7-1167"><a href="#cb7-1167" aria-hidden="true" tabindex="-1"></a><span class="st">                letter-spacing: 0.5px;</span></span>
<span id="cb7-1168"><a href="#cb7-1168" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1169"><a href="#cb7-1169" aria-hidden="true" tabindex="-1"></a><span class="st">            tr:nth-child(even) { </span></span>
<span id="cb7-1170"><a href="#cb7-1170" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #f8f9fa; </span></span>
<span id="cb7-1171"><a href="#cb7-1171" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1172"><a href="#cb7-1172" aria-hidden="true" tabindex="-1"></a><span class="st">            tr:hover { </span></span>
<span id="cb7-1173"><a href="#cb7-1173" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #e3f2fd; </span></span>
<span id="cb7-1174"><a href="#cb7-1174" aria-hidden="true" tabindex="-1"></a><span class="st">                transition: background-color 0.2s ease;</span></span>
<span id="cb7-1175"><a href="#cb7-1175" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1176"><a href="#cb7-1176" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1177"><a href="#cb7-1177" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para blocos de cita√ß√£o */</span></span>
<span id="cb7-1178"><a href="#cb7-1178" aria-hidden="true" tabindex="-1"></a><span class="st">            blockquote { </span></span>
<span id="cb7-1179"><a href="#cb7-1179" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb7-1180"><a href="#cb7-1180" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 25px 0; </span></span>
<span id="cb7-1181"><a href="#cb7-1181" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 25px; </span></span>
<span id="cb7-1182"><a href="#cb7-1182" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #7f8c8d;</span></span>
<span id="cb7-1183"><a href="#cb7-1183" aria-hidden="true" tabindex="-1"></a><span class="st">                font-style: italic;</span></span>
<span id="cb7-1184"><a href="#cb7-1184" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #f8f9fa;</span></span>
<span id="cb7-1185"><a href="#cb7-1185" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb7-1186"><a href="#cb7-1186" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 0 8px 8px 0;</span></span>
<span id="cb7-1187"><a href="#cb7-1187" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1188"><a href="#cb7-1188" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1189"><a href="#cb7-1189" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Cabe√ßalhos com numera√ß√£o */</span></span>
<span id="cb7-1190"><a href="#cb7-1190" aria-hidden="true" tabindex="-1"></a><span class="st">            h1, h2, h3, h4, h5 { </span></span>
<span id="cb7-1191"><a href="#cb7-1191" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50; </span></span>
<span id="cb7-1192"><a href="#cb7-1192" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-top: 1.8em;</span></span>
<span id="cb7-1193"><a href="#cb7-1193" aria-hidden="true" tabindex="-1"></a><span class="st">                border-bottom: 1px solid #e9ecef;</span></span>
<span id="cb7-1194"><a href="#cb7-1194" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-bottom: 0.5em;</span></span>
<span id="cb7-1195"><a href="#cb7-1195" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1196"><a href="#cb7-1196" aria-hidden="true" tabindex="-1"></a><span class="st">            h1 { </span></span>
<span id="cb7-1197"><a href="#cb7-1197" aria-hidden="true" tabindex="-1"></a><span class="st">                border-bottom: 3px solid #3498db; </span></span>
<span id="cb7-1198"><a href="#cb7-1198" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-bottom: 15px; </span></span>
<span id="cb7-1199"><a href="#cb7-1199" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50;</span></span>
<span id="cb7-1200"><a href="#cb7-1200" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 2.2em;</span></span>
<span id="cb7-1201"><a href="#cb7-1201" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1202"><a href="#cb7-1202" aria-hidden="true" tabindex="-1"></a><span class="st">            h2 {</span></span>
<span id="cb7-1203"><a href="#cb7-1203" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db;</span></span>
<span id="cb7-1204"><a href="#cb7-1204" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 15px;</span></span>
<span id="cb7-1205"><a href="#cb7-1205" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-top: 2em;</span></span>
<span id="cb7-1206"><a href="#cb7-1206" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1207"><a href="#cb7-1207" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-1208"><a href="#cb7-1208" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Clearfix para layout com TOC flutuante */</span></span>
<span id="cb7-1209"><a href="#cb7-1209" aria-hidden="true" tabindex="-1"></a><span class="st">            .main-content {</span></span>
<span id="cb7-1210"><a href="#cb7-1210" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow: hidden;</span></span>
<span id="cb7-1211"><a href="#cb7-1211" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-1212"><a href="#cb7-1212" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/style&gt;</span></span>
<span id="cb7-1213"><a href="#cb7-1213" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb7-1214"><a href="#cb7-1214" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1215"><a href="#cb7-1215" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;/head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb7-1216"><a href="#cb7-1216" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;/head&gt;&#39;</span>, <span class="ss">f&#39;</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;&#39;</span>)</span>
<span id="cb7-1217"><a href="#cb7-1217" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb7-1218"><a href="#cb7-1218" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb7-1219"><a href="#cb7-1219" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-1220"><a href="#cb7-1220" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;&lt;body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb7-1221"><a href="#cb7-1221" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;body&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;&#39;</span>)</span>
<span id="cb7-1222"><a href="#cb7-1222" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb7-1223"><a href="#cb7-1223" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;</span><span class="ch">\n</span><span class="sc">{</span>html_content<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/body&gt;&#39;</span></span>
<span id="cb7-1224"><a href="#cb7-1224" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1225"><a href="#cb7-1225" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb7-1226"><a href="#cb7-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1227"><a href="#cb7-1227" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _enhance_toc_styling(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-1228"><a href="#cb7-1228" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Melhora o estilo do Table of Contents gerado pelo Pandoc&quot;&quot;&quot;</span></span>
<span id="cb7-1229"><a href="#cb7-1229" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona t√≠tulo ao TOC se n√£o existir</span></span>
<span id="cb7-1230"><a href="#cb7-1230" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;Table of Contents&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb7-1231"><a href="#cb7-1231" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(</span>
<span id="cb7-1232"><a href="#cb7-1232" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span>, </span>
<span id="cb7-1233"><a href="#cb7-1233" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&lt;h2 style=&quot;margin-top: 0; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;&quot;&gt;üìë Table of Contents&lt;/h2&gt;&#39;</span></span>
<span id="cb7-1234"><a href="#cb7-1234" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb7-1235"><a href="#cb7-1235" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1236"><a href="#cb7-1236" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona wrapper para conte√∫do principal</span></span>
<span id="cb7-1237"><a href="#cb7-1237" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;&lt;body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb7-1238"><a href="#cb7-1238" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Encontra o TOC e envolve o conte√∫do restante</span></span>
<span id="cb7-1239"><a href="#cb7-1239" aria-hidden="true" tabindex="-1"></a>            toc_end <span class="op">=</span> html_content.find(<span class="st">&#39;&lt;/div&gt;&#39;</span>, html_content.find(<span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span>)) <span class="op">+</span> <span class="dv">6</span></span>
<span id="cb7-1240"><a href="#cb7-1240" aria-hidden="true" tabindex="-1"></a>            body_content <span class="op">=</span> html_content[toc_end:]</span>
<span id="cb7-1241"><a href="#cb7-1241" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;&lt;div class=&quot;main-content&quot;&gt;&#39;</span> <span class="kw">not</span> <span class="kw">in</span> body_content:</span>
<span id="cb7-1242"><a href="#cb7-1242" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> html_content[:toc_end] <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&lt;div class=&quot;main-content&quot;&gt;&#39;</span> <span class="op">+</span> body_content <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&lt;/div&gt;&#39;</span></span>
<span id="cb7-1243"><a href="#cb7-1243" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1244"><a href="#cb7-1244" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb7-1245"><a href="#cb7-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1246"><a href="#cb7-1246" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_fallback(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-1247"><a href="#cb7-1247" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Fallback para convers√£o quando Pandoc falha&quot;&quot;&quot;</span></span>
<span id="cb7-1248"><a href="#cb7-1248" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb7-1249"><a href="#cb7-1249" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(md_file_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb7-1250"><a href="#cb7-1250" aria-hidden="true" tabindex="-1"></a>                md_content <span class="op">=</span> f.read()</span>
<span id="cb7-1251"><a href="#cb7-1251" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1252"><a href="#cb7-1252" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extens√µes avan√ßadas para melhor convers√£o</span></span>
<span id="cb7-1253"><a href="#cb7-1253" aria-hidden="true" tabindex="-1"></a>            extensions <span class="op">=</span> [</span>
<span id="cb7-1254"><a href="#cb7-1254" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;extra&#39;</span>, <span class="st">&#39;tables&#39;</span>, <span class="st">&#39;fenced_code&#39;</span>, <span class="st">&#39;codehilite&#39;</span>, </span>
<span id="cb7-1255"><a href="#cb7-1255" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;toc&#39;</span>, <span class="st">&#39;md_in_html&#39;</span>, <span class="st">&#39;attr_list&#39;</span></span>
<span id="cb7-1256"><a href="#cb7-1256" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb7-1257"><a href="#cb7-1257" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1258"><a href="#cb7-1258" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> markdown.markdown(</span>
<span id="cb7-1259"><a href="#cb7-1259" aria-hidden="true" tabindex="-1"></a>                md_content,</span>
<span id="cb7-1260"><a href="#cb7-1260" aria-hidden="true" tabindex="-1"></a>                extensions<span class="op">=</span>extensions,</span>
<span id="cb7-1261"><a href="#cb7-1261" aria-hidden="true" tabindex="-1"></a>                output_format<span class="op">=</span><span class="st">&#39;html5&#39;</span></span>
<span id="cb7-1262"><a href="#cb7-1262" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb7-1263"><a href="#cb7-1263" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1264"><a href="#cb7-1264" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_enhanced_html_template(html_content, Path(md_file_path).name)</span>
<span id="cb7-1265"><a href="#cb7-1265" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1266"><a href="#cb7-1266" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-1267"><a href="#cb7-1267" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Fallback tamb√©m falhou: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-1268"><a href="#cb7-1268" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_basic_html(md_content, Path(md_file_path).name)</span>
<span id="cb7-1269"><a href="#cb7-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1270"><a href="#cb7-1270" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_enhanced_html_template(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-1271"><a href="#cb7-1271" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Template HTML aprimorado com suporte a MathJax local/online&quot;&quot;&quot;</span></span>
<span id="cb7-1272"><a href="#cb7-1272" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb7-1273"><a href="#cb7-1273" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1274"><a href="#cb7-1274" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb7-1275"><a href="#cb7-1275" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html lang=&quot;pt-BR&quot;&gt;</span></span>
<span id="cb7-1276"><a href="#cb7-1276" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb7-1277"><a href="#cb7-1277" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb7-1278"><a href="#cb7-1278" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb7-1279"><a href="#cb7-1279" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb7-1280"><a href="#cb7-1280" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb7-1281"><a href="#cb7-1281" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span></span>
<span id="cb7-1282"><a href="#cb7-1282" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb7-1283"><a href="#cb7-1283" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb7-1284"><a href="#cb7-1284" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0;</span></span>
<span id="cb7-1285"><a href="#cb7-1285" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb7-1286"><a href="#cb7-1286" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb7-1287"><a href="#cb7-1287" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333;</span></span>
<span id="cb7-1288"><a href="#cb7-1288" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: none; /* Remove limita√ß√£o de largura */</span></span>
<span id="cb7-1289"><a href="#cb7-1289" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1290"><a href="#cb7-1290" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb7-1291"><a href="#cb7-1291" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb7-1292"><a href="#cb7-1292" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb7-1293"><a href="#cb7-1293" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb7-1294"><a href="#cb7-1294" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 40px;</span></span>
<span id="cb7-1295"><a href="#cb7-1295" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 10px;</span></span>
<span id="cb7-1296"><a href="#cb7-1296" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb7-1297"><a href="#cb7-1297" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1298"><a href="#cb7-1298" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1, h2, h3, h4, h5 </span><span class="ch">{{</span></span>
<span id="cb7-1299"><a href="#cb7-1299" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb7-1300"><a href="#cb7-1300" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 1.8em;</span></span>
<span id="cb7-1301"><a href="#cb7-1301" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1302"><a href="#cb7-1302" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1 </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-1303"><a href="#cb7-1303" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 3px solid #3498db; </span></span>
<span id="cb7-1304"><a href="#cb7-1304" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 15px; </span></span>
<span id="cb7-1305"><a href="#cb7-1305" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb7-1306"><a href="#cb7-1306" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 2.2em;</span></span>
<span id="cb7-1307"><a href="#cb7-1307" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1308"><a href="#cb7-1308" aria-hidden="true" tabindex="-1"></a><span class="ss">        h2 </span><span class="ch">{{</span></span>
<span id="cb7-1309"><a href="#cb7-1309" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb7-1310"><a href="#cb7-1310" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb7-1311"><a href="#cb7-1311" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 2em;</span></span>
<span id="cb7-1312"><a href="#cb7-1312" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1313"><a href="#cb7-1313" aria-hidden="true" tabindex="-1"></a><span class="ss">        code </span><span class="ch">{{</span></span>
<span id="cb7-1314"><a href="#cb7-1314" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f4f4f4;</span></span>
<span id="cb7-1315"><a href="#cb7-1315" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 3px 8px;</span></span>
<span id="cb7-1316"><a href="#cb7-1316" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb7-1317"><a href="#cb7-1317" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb7-1318"><a href="#cb7-1318" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #c7254e;</span></span>
<span id="cb7-1319"><a href="#cb7-1319" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb7-1320"><a href="#cb7-1320" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1321"><a href="#cb7-1321" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span></span>
<span id="cb7-1322"><a href="#cb7-1322" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #2d2d2d;</span></span>
<span id="cb7-1323"><a href="#cb7-1323" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #f8f8f2;</span></span>
<span id="cb7-1324"><a href="#cb7-1324" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb7-1325"><a href="#cb7-1325" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb7-1326"><a href="#cb7-1326" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb7-1327"><a href="#cb7-1327" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 5px solid #3498db;</span></span>
<span id="cb7-1328"><a href="#cb7-1328" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb7-1329"><a href="#cb7-1329" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.4;</span></span>
<span id="cb7-1330"><a href="#cb7-1330" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1331"><a href="#cb7-1331" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre code </span><span class="ch">{{</span></span>
<span id="cb7-1332"><a href="#cb7-1332" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: none;</span></span>
<span id="cb7-1333"><a href="#cb7-1333" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: inherit;</span></span>
<span id="cb7-1334"><a href="#cb7-1334" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 0;</span></span>
<span id="cb7-1335"><a href="#cb7-1335" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1336"><a href="#cb7-1336" aria-hidden="true" tabindex="-1"></a><span class="ss">        blockquote </span><span class="ch">{{</span></span>
<span id="cb7-1337"><a href="#cb7-1337" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb7-1338"><a href="#cb7-1338" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 25px 0;</span></span>
<span id="cb7-1339"><a href="#cb7-1339" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 25px;</span></span>
<span id="cb7-1340"><a href="#cb7-1340" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb7-1341"><a href="#cb7-1341" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-style: italic;</span></span>
<span id="cb7-1342"><a href="#cb7-1342" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb7-1343"><a href="#cb7-1343" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb7-1344"><a href="#cb7-1344" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 0 8px 8px 0;</span></span>
<span id="cb7-1345"><a href="#cb7-1345" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1346"><a href="#cb7-1346" aria-hidden="true" tabindex="-1"></a><span class="ss">        table </span><span class="ch">{{</span></span>
<span id="cb7-1347"><a href="#cb7-1347" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-collapse: collapse;</span></span>
<span id="cb7-1348"><a href="#cb7-1348" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 100%;</span></span>
<span id="cb7-1349"><a href="#cb7-1349" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb7-1350"><a href="#cb7-1350" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb7-1351"><a href="#cb7-1351" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb7-1352"><a href="#cb7-1352" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb7-1353"><a href="#cb7-1353" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1354"><a href="#cb7-1354" aria-hidden="true" tabindex="-1"></a><span class="ss">        th, td </span><span class="ch">{{</span></span>
<span id="cb7-1355"><a href="#cb7-1355" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb7-1356"><a href="#cb7-1356" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb7-1357"><a href="#cb7-1357" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: left;</span></span>
<span id="cb7-1358"><a href="#cb7-1358" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1359"><a href="#cb7-1359" aria-hidden="true" tabindex="-1"></a><span class="ss">        th </span><span class="ch">{{</span></span>
<span id="cb7-1360"><a href="#cb7-1360" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb7-1361"><a href="#cb7-1361" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb7-1362"><a href="#cb7-1362" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb7-1363"><a href="#cb7-1363" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-transform: uppercase;</span></span>
<span id="cb7-1364"><a href="#cb7-1364" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb7-1365"><a href="#cb7-1365" aria-hidden="true" tabindex="-1"></a><span class="ss">            letter-spacing: 0.5px;</span></span>
<span id="cb7-1366"><a href="#cb7-1366" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1367"><a href="#cb7-1367" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:nth-child(even) </span><span class="ch">{{</span></span>
<span id="cb7-1368"><a href="#cb7-1368" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f8f9fa;</span></span>
<span id="cb7-1369"><a href="#cb7-1369" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1370"><a href="#cb7-1370" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:hover </span><span class="ch">{{</span></span>
<span id="cb7-1371"><a href="#cb7-1371" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #e3f2fd;</span></span>
<span id="cb7-1372"><a href="#cb7-1372" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: background-color 0.2s ease;</span></span>
<span id="cb7-1373"><a href="#cb7-1373" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1374"><a href="#cb7-1374" aria-hidden="true" tabindex="-1"></a><span class="ss">        .math </span><span class="ch">{{</span></span>
<span id="cb7-1375"><a href="#cb7-1375" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center;</span></span>
<span id="cb7-1376"><a href="#cb7-1376" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb7-1377"><a href="#cb7-1377" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb7-1378"><a href="#cb7-1378" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb7-1379"><a href="#cb7-1379" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb7-1380"><a href="#cb7-1380" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb7-1381"><a href="#cb7-1381" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1382"><a href="#cb7-1382" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-header </span><span class="ch">{{</span></span>
<span id="cb7-1383"><a href="#cb7-1383" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb7-1384"><a href="#cb7-1384" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between;</span></span>
<span id="cb7-1385"><a href="#cb7-1385" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: center;</span></span>
<span id="cb7-1386"><a href="#cb7-1386" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 15px;</span></span>
<span id="cb7-1387"><a href="#cb7-1387" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb7-1388"><a href="#cb7-1388" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 10px;</span></span>
<span id="cb7-1389"><a href="#cb7-1389" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1390"><a href="#cb7-1390" aria-hidden="true" tabindex="-1"></a><span class="ss">        .author </span><span class="ch">{{</span></span>
<span id="cb7-1391"><a href="#cb7-1391" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb7-1392"><a href="#cb7-1392" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb7-1393"><a href="#cb7-1393" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.1em;</span></span>
<span id="cb7-1394"><a href="#cb7-1394" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1395"><a href="#cb7-1395" aria-hidden="true" tabindex="-1"></a><span class="ss">        .timestamp </span><span class="ch">{{</span></span>
<span id="cb7-1396"><a href="#cb7-1396" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb7-1397"><a href="#cb7-1397" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb7-1398"><a href="#cb7-1398" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e9ecef;</span></span>
<span id="cb7-1399"><a href="#cb7-1399" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 8px;</span></span>
<span id="cb7-1400"><a href="#cb7-1400" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb7-1401"><a href="#cb7-1401" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1402"><a href="#cb7-1402" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-content </span><span class="ch">{{</span></span>
<span id="cb7-1403"><a href="#cb7-1403" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb7-1404"><a href="#cb7-1404" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb7-1405"><a href="#cb7-1405" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb7-1406"><a href="#cb7-1406" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb7-1407"><a href="#cb7-1407" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 20px;</span></span>
<span id="cb7-1408"><a href="#cb7-1408" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1409"><a href="#cb7-1409" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata </span><span class="ch">{{</span></span>
<span id="cb7-1410"><a href="#cb7-1410" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e8f4fd;</span></span>
<span id="cb7-1411"><a href="#cb7-1411" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb7-1412"><a href="#cb7-1412" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb7-1413"><a href="#cb7-1413" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 25px;</span></span>
<span id="cb7-1414"><a href="#cb7-1414" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb7-1415"><a href="#cb7-1415" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1416"><a href="#cb7-1416" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata h3 </span><span class="ch">{{</span></span>
<span id="cb7-1417"><a href="#cb7-1417" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb7-1418"><a href="#cb7-1418" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb7-1419"><a href="#cb7-1419" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1420"><a href="#cb7-1420" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* Estilos para TOC manual */</span></span>
<span id="cb7-1421"><a href="#cb7-1421" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc </span><span class="ch">{{</span></span>
<span id="cb7-1422"><a href="#cb7-1422" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);</span></span>
<span id="cb7-1423"><a href="#cb7-1423" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #dee2e6;</span></span>
<span id="cb7-1424"><a href="#cb7-1424" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb7-1425"><a href="#cb7-1425" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb7-1426"><a href="#cb7-1426" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 20px 0;</span></span>
<span id="cb7-1427"><a href="#cb7-1427" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb7-1428"><a href="#cb7-1428" aria-hidden="true" tabindex="-1"></a><span class="ss">            float: right;</span></span>
<span id="cb7-1429"><a href="#cb7-1429" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 300px;</span></span>
<span id="cb7-1430"><a href="#cb7-1430" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 30px;</span></span>
<span id="cb7-1431"><a href="#cb7-1431" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1432"><a href="#cb7-1432" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc h2 </span><span class="ch">{{</span></span>
<span id="cb7-1433"><a href="#cb7-1433" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb7-1434"><a href="#cb7-1434" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb7-1435"><a href="#cb7-1435" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 2px solid #3498db;</span></span>
<span id="cb7-1436"><a href="#cb7-1436" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 10px;</span></span>
<span id="cb7-1437"><a href="#cb7-1437" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1438"><a href="#cb7-1438" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc ul </span><span class="ch">{{</span></span>
<span id="cb7-1439"><a href="#cb7-1439" aria-hidden="true" tabindex="-1"></a><span class="ss">            list-style-type: none;</span></span>
<span id="cb7-1440"><a href="#cb7-1440" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb7-1441"><a href="#cb7-1441" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1442"><a href="#cb7-1442" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc li </span><span class="ch">{{</span></span>
<span id="cb7-1443"><a href="#cb7-1443" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 8px 0;</span></span>
<span id="cb7-1444"><a href="#cb7-1444" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1445"><a href="#cb7-1445" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc a </span><span class="ch">{{</span></span>
<span id="cb7-1446"><a href="#cb7-1446" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb7-1447"><a href="#cb7-1447" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #495057;</span></span>
<span id="cb7-1448"><a href="#cb7-1448" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb7-1449"><a href="#cb7-1449" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1450"><a href="#cb7-1450" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc a:hover </span><span class="ch">{{</span></span>
<span id="cb7-1451"><a href="#cb7-1451" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #007bff;</span></span>
<span id="cb7-1452"><a href="#cb7-1452" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1453"><a href="#cb7-1453" aria-hidden="true" tabindex="-1"></a><span class="ss">        .main-content </span><span class="ch">{{</span></span>
<span id="cb7-1454"><a href="#cb7-1454" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb7-1455"><a href="#cb7-1455" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1456"><a href="#cb7-1456" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 1200px) </span><span class="ch">{{</span></span>
<span id="cb7-1457"><a href="#cb7-1457" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb7-1458"><a href="#cb7-1458" aria-hidden="true" tabindex="-1"></a><span class="ss">                max-width: 98%;</span></span>
<span id="cb7-1459"><a href="#cb7-1459" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 30px;</span></span>
<span id="cb7-1460"><a href="#cb7-1460" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb7-1461"><a href="#cb7-1461" aria-hidden="true" tabindex="-1"></a><span class="ss">            .toc </span><span class="ch">{{</span></span>
<span id="cb7-1462"><a href="#cb7-1462" aria-hidden="true" tabindex="-1"></a><span class="ss">                float: none;</span></span>
<span id="cb7-1463"><a href="#cb7-1463" aria-hidden="true" tabindex="-1"></a><span class="ss">                width: auto;</span></span>
<span id="cb7-1464"><a href="#cb7-1464" aria-hidden="true" tabindex="-1"></a><span class="ss">                margin: 20px 0;</span></span>
<span id="cb7-1465"><a href="#cb7-1465" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb7-1466"><a href="#cb7-1466" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1467"><a href="#cb7-1467" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 768px) </span><span class="ch">{{</span></span>
<span id="cb7-1468"><a href="#cb7-1468" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb7-1469"><a href="#cb7-1469" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 20px;</span></span>
<span id="cb7-1470"><a href="#cb7-1470" aria-hidden="true" tabindex="-1"></a><span class="ss">                max-width: 100%;</span></span>
<span id="cb7-1471"><a href="#cb7-1471" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb7-1472"><a href="#cb7-1472" aria-hidden="true" tabindex="-1"></a><span class="ss">            body </span><span class="ch">{{</span></span>
<span id="cb7-1473"><a href="#cb7-1473" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 10px;</span></span>
<span id="cb7-1474"><a href="#cb7-1474" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb7-1475"><a href="#cb7-1475" aria-hidden="true" tabindex="-1"></a><span class="ss">            h1 </span><span class="ch">{{</span></span>
<span id="cb7-1476"><a href="#cb7-1476" aria-hidden="true" tabindex="-1"></a><span class="ss">                font-size: 1.8em;</span></span>
<span id="cb7-1477"><a href="#cb7-1477" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb7-1478"><a href="#cb7-1478" aria-hidden="true" tabindex="-1"></a><span class="ss">            .message-header </span><span class="ch">{{</span></span>
<span id="cb7-1479"><a href="#cb7-1479" aria-hidden="true" tabindex="-1"></a><span class="ss">                flex-direction: column;</span></span>
<span id="cb7-1480"><a href="#cb7-1480" aria-hidden="true" tabindex="-1"></a><span class="ss">                align-items: flex-start;</span></span>
<span id="cb7-1481"><a href="#cb7-1481" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb7-1482"><a href="#cb7-1482" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1483"><a href="#cb7-1483" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb7-1484"><a href="#cb7-1484" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb7-1485"><a href="#cb7-1485" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb7-1486"><a href="#cb7-1486" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb7-1487"><a href="#cb7-1487" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="sc">{</span>content<span class="sc">}</span></span>
<span id="cb7-1488"><a href="#cb7-1488" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb7-1489"><a href="#cb7-1489" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb7-1490"><a href="#cb7-1490" aria-hidden="true" tabindex="-1"></a><span class="ss">        // Configura√ß√£o MathJax para melhor renderiza√ß√£o</span></span>
<span id="cb7-1491"><a href="#cb7-1491" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb7-1492"><a href="#cb7-1492" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb7-1493"><a href="#cb7-1493" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb7-1494"><a href="#cb7-1494" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb7-1495"><a href="#cb7-1495" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true,</span></span>
<span id="cb7-1496"><a href="#cb7-1496" aria-hidden="true" tabindex="-1"></a><span class="ss">                tags: &#39;ams&#39;</span></span>
<span id="cb7-1497"><a href="#cb7-1497" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb7-1498"><a href="#cb7-1498" aria-hidden="true" tabindex="-1"></a><span class="ss">            options: </span><span class="ch">{{</span></span>
<span id="cb7-1499"><a href="#cb7-1499" aria-hidden="true" tabindex="-1"></a><span class="ss">                skipHtmlTags: [&#39;script&#39;, &#39;noscript&#39;, &#39;style&#39;, &#39;textarea&#39;, &#39;pre&#39;],</span></span>
<span id="cb7-1500"><a href="#cb7-1500" aria-hidden="true" tabindex="-1"></a><span class="ss">                renderActions: </span><span class="ch">{{</span></span>
<span id="cb7-1501"><a href="#cb7-1501" aria-hidden="true" tabindex="-1"></a><span class="ss">                    addMenu: [0, &#39;&#39;, &#39;&#39;]</span></span>
<span id="cb7-1502"><a href="#cb7-1502" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb7-1503"><a href="#cb7-1503" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb7-1504"><a href="#cb7-1504" aria-hidden="true" tabindex="-1"></a><span class="ss">            startup: </span><span class="ch">{{</span></span>
<span id="cb7-1505"><a href="#cb7-1505" aria-hidden="true" tabindex="-1"></a><span class="ss">                pageReady() </span><span class="ch">{{</span></span>
<span id="cb7-1506"><a href="#cb7-1506" aria-hidden="true" tabindex="-1"></a><span class="ss">                    return MathJax.startup.defaultPageReady().then(() =&gt; </span><span class="ch">{{</span></span>
<span id="cb7-1507"><a href="#cb7-1507" aria-hidden="true" tabindex="-1"></a><span class="ss">                        console.log(&#39;MathJax carregado com sucesso&#39;);</span></span>
<span id="cb7-1508"><a href="#cb7-1508" aria-hidden="true" tabindex="-1"></a><span class="ss">                    </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb7-1509"><a href="#cb7-1509" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb7-1510"><a href="#cb7-1510" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb7-1511"><a href="#cb7-1511" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb7-1512"><a href="#cb7-1512" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb7-1513"><a href="#cb7-1513" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb7-1514"><a href="#cb7-1514" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb7-1515"><a href="#cb7-1515" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb7-1516"><a href="#cb7-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1517"><a href="#cb7-1517" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_basic_html(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-1518"><a href="#cb7-1518" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;HTML b√°sico de √∫ltimo recurso com MathJax&quot;&quot;&quot;</span></span>
<span id="cb7-1519"><a href="#cb7-1519" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb7-1520"><a href="#cb7-1520" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1521"><a href="#cb7-1521" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb7-1522"><a href="#cb7-1522" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html&gt;</span></span>
<span id="cb7-1523"><a href="#cb7-1523" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb7-1524"><a href="#cb7-1524" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb7-1525"><a href="#cb7-1525" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb7-1526"><a href="#cb7-1526" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb7-1527"><a href="#cb7-1527" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-1528"><a href="#cb7-1528" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif; </span></span>
<span id="cb7-1529"><a href="#cb7-1529" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px; </span></span>
<span id="cb7-1530"><a href="#cb7-1530" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb7-1531"><a href="#cb7-1531" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb7-1532"><a href="#cb7-1532" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: none; /* Remove limita√ß√£o de largura */</span></span>
<span id="cb7-1533"><a href="#cb7-1533" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1534"><a href="#cb7-1534" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-1535"><a href="#cb7-1535" aria-hidden="true" tabindex="-1"></a><span class="ss">            white-space: pre-wrap; </span></span>
<span id="cb7-1536"><a href="#cb7-1536" aria-hidden="true" tabindex="-1"></a><span class="ss">            word-wrap: break-word; </span></span>
<span id="cb7-1537"><a href="#cb7-1537" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb7-1538"><a href="#cb7-1538" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb7-1539"><a href="#cb7-1539" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 5px;</span></span>
<span id="cb7-1540"><a href="#cb7-1540" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb7-1541"><a href="#cb7-1541" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1542"><a href="#cb7-1542" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb7-1543"><a href="#cb7-1543" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb7-1544"><a href="#cb7-1544" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb7-1545"><a href="#cb7-1545" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb7-1546"><a href="#cb7-1546" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 30px;</span></span>
<span id="cb7-1547"><a href="#cb7-1547" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb7-1548"><a href="#cb7-1548" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb7-1549"><a href="#cb7-1549" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-1550"><a href="#cb7-1550" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb7-1551"><a href="#cb7-1551" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb7-1552"><a href="#cb7-1552" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb7-1553"><a href="#cb7-1553" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb7-1554"><a href="#cb7-1554" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb7-1555"><a href="#cb7-1555" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb7-1556"><a href="#cb7-1556" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true</span></span>
<span id="cb7-1557"><a href="#cb7-1557" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb7-1558"><a href="#cb7-1558" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb7-1559"><a href="#cb7-1559" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb7-1560"><a href="#cb7-1560" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb7-1561"><a href="#cb7-1561" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb7-1562"><a href="#cb7-1562" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb7-1563"><a href="#cb7-1563" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb7-1564"><a href="#cb7-1564" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;pre&gt;</span><span class="sc">{</span>content<span class="sc">}</span><span class="ss">&lt;/pre&gt;</span></span>
<span id="cb7-1565"><a href="#cb7-1565" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb7-1566"><a href="#cb7-1566" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb7-1567"><a href="#cb7-1567" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb7-1568"><a href="#cb7-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1569"><a href="#cb7-1569" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_html_robust(<span class="va">self</span>):</span>
<span id="cb7-1570"><a href="#cb7-1570" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;M√©todo ROBUSTO para convers√£o HTML - VERS√ÉO OTIMIZADA&quot;&quot;&quot;</span></span>
<span id="cb7-1571"><a href="#cb7-1571" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb7-1572"><a href="#cb7-1572" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] HTMLs seriam criados:&quot;</span>)</span>
<span id="cb7-1573"><a href="#cb7-1573" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb7-1574"><a href="#cb7-1574" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb7-1575"><a href="#cb7-1575" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.html&quot;</span></span>
<span id="cb7-1576"><a href="#cb7-1576" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üåê </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-1577"><a href="#cb7-1577" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-1578"><a href="#cb7-1578" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1579"><a href="#cb7-1579" aria-hidden="true" tabindex="-1"></a>        markdown_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;markdown&#39;</span>])</span>
<span id="cb7-1580"><a href="#cb7-1580" aria-hidden="true" tabindex="-1"></a>        html_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;html&#39;</span>])</span>
<span id="cb7-1581"><a href="#cb7-1581" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1582"><a href="#cb7-1582" aria-hidden="true" tabindex="-1"></a>        md_files <span class="op">=</span> <span class="bu">list</span>(markdown_folder.glob(<span class="st">&quot;*.md&quot;</span>))</span>
<span id="cb7-1583"><a href="#cb7-1583" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1584"><a href="#cb7-1584" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> md_files:</span>
<span id="cb7-1585"><a href="#cb7-1585" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Nenhum arquivo Markdown encontrado para convers√£o.&quot;</span>)</span>
<span id="cb7-1586"><a href="#cb7-1586" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-1587"><a href="#cb7-1587" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1588"><a href="#cb7-1588" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÑ Convertendo </span><span class="sc">{</span><span class="bu">len</span>(md_files)<span class="sc">}</span><span class="ss"> arquivos Markdown para HTML (OTIMIZADO)...&quot;</span>)</span>
<span id="cb7-1589"><a href="#cb7-1589" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1590"><a href="#cb7-1590" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verifica se Pandoc est√° dispon√≠vel</span></span>
<span id="cb7-1591"><a href="#cb7-1591" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb7-1592"><a href="#cb7-1592" aria-hidden="true" tabindex="-1"></a>            subprocess.run([<span class="st">&#39;pandoc&#39;</span>, <span class="st">&#39;--version&#39;</span>], capture_output<span class="op">=</span><span class="va">True</span>, check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-1593"><a href="#cb7-1593" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">True</span></span>
<span id="cb7-1594"><a href="#cb7-1594" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;‚úÖ Pandoc dispon√≠vel - usando convers√£o otimizada&quot;</span>)</span>
<span id="cb7-1595"><a href="#cb7-1595" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb7-1596"><a href="#cb7-1596" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">False</span></span>
<span id="cb7-1597"><a href="#cb7-1597" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è Pandoc n√£o dispon√≠vel - usando fallback Python&quot;</span>)</span>
<span id="cb7-1598"><a href="#cb7-1598" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1599"><a href="#cb7-1599" aria-hidden="true" tabindex="-1"></a>        converted_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-1600"><a href="#cb7-1600" aria-hidden="true" tabindex="-1"></a>        failed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-1601"><a href="#cb7-1601" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1602"><a href="#cb7-1602" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> md_file <span class="kw">in</span> md_files:</span>
<span id="cb7-1603"><a href="#cb7-1603" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb7-1604"><a href="#cb7-1604" aria-hidden="true" tabindex="-1"></a>                html_file <span class="op">=</span> html_folder <span class="op">/</span> md_file.with_suffix(<span class="st">&#39;.html&#39;</span>).name</span>
<span id="cb7-1605"><a href="#cb7-1605" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1606"><a href="#cb7-1606" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> html_file.exists():</span>
<span id="cb7-1607"><a href="#cb7-1607" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚è≠Ô∏è  J√° existe: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-1608"><a href="#cb7-1608" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-1609"><a href="#cb7-1609" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb7-1610"><a href="#cb7-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1611"><a href="#cb7-1611" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ Processando: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-1612"><a href="#cb7-1612" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1613"><a href="#cb7-1613" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> pandoc_available:</span>
<span id="cb7-1614"><a href="#cb7-1614" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_pandoc_optimized(<span class="bu">str</span>(md_file))</span>
<span id="cb7-1615"><a href="#cb7-1615" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb7-1616"><a href="#cb7-1616" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_fallback(<span class="bu">str</span>(md_file))</span>
<span id="cb7-1617"><a href="#cb7-1617" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1618"><a href="#cb7-1618" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> html_content:</span>
<span id="cb7-1619"><a href="#cb7-1619" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(html_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb7-1620"><a href="#cb7-1620" aria-hidden="true" tabindex="-1"></a>                        f.write(html_content)</span>
<span id="cb7-1621"><a href="#cb7-1621" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-1622"><a href="#cb7-1622" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Criado: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-1623"><a href="#cb7-1623" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-1624"><a href="#cb7-1624" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb7-1625"><a href="#cb7-1625" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Falha na convers√£o: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-1626"><a href="#cb7-1626" aria-hidden="true" tabindex="-1"></a>                    failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-1627"><a href="#cb7-1627" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-1628"><a href="#cb7-1628" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-1629"><a href="#cb7-1629" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro em </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-1630"><a href="#cb7-1630" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(traceback.format_exc())</span>
<span id="cb7-1631"><a href="#cb7-1631" aria-hidden="true" tabindex="-1"></a>                failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-1632"><a href="#cb7-1632" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1633"><a href="#cb7-1633" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä HTML: </span><span class="sc">{</span>converted_count<span class="sc">}</span><span class="ss"> arquivos criados, </span><span class="sc">{</span>failed_count<span class="sc">}</span><span class="ss"> falhas em &#39;</span><span class="sc">{</span>html_folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb7-1634"><a href="#cb7-1634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1635"><a href="#cb7-1635" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> categorize_conversation(<span class="va">self</span>, title: <span class="bu">str</span>, summary: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-1636"><a href="#cb7-1636" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Categoriza√ß√£o otimizada com express√µes regulares&quot;&quot;&quot;</span></span>
<span id="cb7-1637"><a href="#cb7-1637" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&quot;</span>.lower()</span>
<span id="cb7-1638"><a href="#cb7-1638" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1639"><a href="#cb7-1639" aria-hidden="true" tabindex="-1"></a>        patterns <span class="op">=</span> {</span>
<span id="cb7-1640"><a href="#cb7-1640" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Tecnologia&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">tecnologia</span><span class="cf">|</span><span class="vs">hardware</span><span class="cf">|</span><span class="vs">software</span><span class="cf">|</span><span class="vs">rede</span><span class="cf">|</span><span class="vs">internet</span><span class="cf">|</span><span class="vs">wifi</span><span class="cf">|</span><span class="vs">bluetooth</span><span class="cf">|</span><span class="pp">[45]</span><span class="vs">g</span><span class="cf">|</span><span class="vs">cloud</span><span class="cf">|</span><span class="vs">aws</span><span class="cf">|</span><span class="vs">azure</span><span class="cf">|</span><span class="vs">gcp</span><span class="cf">|</span><span class="vs">servidor</span><span class="cf">|</span><span class="vs">hosting</span><span class="cf">|</span><span class="vs">dom√≠nio</span><span class="cf">|</span><span class="vs">ssl</span><span class="cf">|</span><span class="vs">router</span><span class="cf">|</span><span class="vs">switch</span><span class="cf">|</span><span class="vs">firewall</span><span class="cf">|</span><span class="vs">iot</span><span class="cf">|</span><span class="vs">smartphone</span><span class="cf">|</span><span class="vs">tablet</span><span class="cf">|</span><span class="vs">navegador</span><span class="cf">|</span><span class="vs">browser</span><span class="cf">|</span><span class="vs">chrome</span><span class="cf">|</span><span class="vs">firefox</span><span class="cf">|</span><span class="vs">edge</span><span class="cf">|</span><span class="vs">safari</span><span class="cf">|</span><span class="vs">email</span><span class="cf">|</span><span class="vs">gmail</span><span class="cf">|</span><span class="vs">outlook</span><span class="cf">|</span><span class="vs">criptografia</span><span class="cf">|</span><span class="vs">seguran√ßa</span><span class="cf">|</span><span class="vs">ciberseguran√ßa</span><span class="cf">|</span><span class="vs">ransomware</span><span class="cf">|</span><span class="vs">phishing</span><span class="cf">|</span><span class="vs">autentica√ß√£o</span><span class="cf">|</span><span class="vs">2fa</span><span class="cf">|</span><span class="vs">biometria</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb7-1641"><a href="#cb7-1641" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Sa√∫de&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">sa√∫de</span><span class="cf">|</span><span class="vs">medicina</span><span class="cf">|</span><span class="vs">m√©dico</span><span class="cf">|</span><span class="vs">enfermagem</span><span class="cf">|</span><span class="vs">doen√ßa</span><span class="cf">|</span><span class="vs">v√≠rus</span><span class="cf">|</span><span class="vs">bact√©ria</span><span class="cf">|</span><span class="vs">vacina</span><span class="cf">|</span><span class="vs">covid</span><span class="cf">|</span><span class="vs">coronav√≠rus</span><span class="cf">|</span><span class="vs">gripe</span><span class="cf">|</span><span class="vs">febre</span><span class="cf">|</span><span class="vs">dor</span><span class="cf">|</span><span class="vs">an√°lise</span><span class="cf">|</span><span class="vs">exame</span><span class="cf">|</span><span class="vs">raio x</span><span class="cf">|</span><span class="vs">resson√¢ncia</span><span class="cf">|</span><span class="vs">hospital</span><span class="cf">|</span><span class="vs">cl√≠nica</span><span class="cf">|</span><span class="vs">farm√°cia</span><span class="cf">|</span><span class="vs">medicamento</span><span class="cf">|</span><span class="vs">rem√©dio</span><span class="cf">|</span><span class="vs">psicologia</span><span class="cf">|</span><span class="vs">terapia</span><span class="cf">|</span><span class="vs">bem-estar</span><span class="cf">|</span><span class="vs">nutri√ß√£o</span><span class="cf">|</span><span class="vs">dieta</span><span class="cf">|</span><span class="vs">exerc√≠cio</span><span class="cf">|</span><span class="vs">fitness</span><span class="cf">|</span><span class="vs">sono</span><span class="cf">|</span><span class="vs">sa√∫de mental</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb7-1642"><a href="#cb7-1642" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Programa√ß√£o&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">python</span><span class="cf">|</span><span class="vs">javascript</span><span class="cf">|</span><span class="vs">java</span><span class="cf">|</span><span class="vs">c</span><span class="ch">\+\+</span><span class="cf">|</span><span class="vs">c#</span><span class="cf">|</span><span class="vs">go</span><span class="cf">|</span><span class="vs">rust</span><span class="cf">|</span><span class="vs">lua</span><span class="cf">|</span><span class="vs">bash</span><span class="cf">|</span><span class="vs">script</span><span class="cf">|</span><span class="vs">debug</span><span class="cf">|</span><span class="vs">erro</span><span class="cf">|</span><span class="vs">conda</span><span class="cf">|</span><span class="vs">mamba</span><span class="cf">|</span><span class="vs">pandoc</span><span class="cf">|</span><span class="vs">msys2</span><span class="cf">|</span><span class="vs">spyder</span><span class="cf">|</span><span class="vs">jupyter</span><span class="cf">|</span><span class="vs">pip</span><span class="cf">|</span><span class="vs">venv</span><span class="cf">|</span><span class="vs">docker</span><span class="cf">|</span><span class="vs">git</span><span class="cf">|</span><span class="vs">github</span><span class="cf">|</span><span class="vs">vscode</span><span class="cf">|</span><span class="vs">ide</span><span class="cf">|</span><span class="vs">programa</span><span class="cf">|</span><span class="vs">c√≥digo</span><span class="cf">|</span><span class="vs">fun√ß√£o</span><span class="cf">|</span><span class="vs">classe</span><span class="cf">|</span><span class="vs">api</span><span class="cf">|</span><span class="vs">selenium</span><span class="cf">|</span><span class="vs">playwright</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb7-1643"><a href="#cb7-1643" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Sistemas&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">windows</span><span class="cf">|</span><span class="vs">linux</span><span class="cf">|</span><span class="vs">macos</span><span class="cf">|</span><span class="vs">so</span><span class="cf">|</span><span class="vs">sistema operacional</span><span class="cf">|</span><span class="vs">driver</span><span class="cf">|</span><span class="vs">registry</span><span class="cf">|</span><span class="vs">process</span><span class="cf">|</span><span class="vs">firewall</span><span class="cf">|</span><span class="vs">bios</span><span class="cf">|</span><span class="vs">boot</span><span class="cf">|</span><span class="vs">path</span><span class="cf">|</span><span class="vs">dll</span><span class="cf">|</span><span class="vs">exe</span><span class="cf">|</span><span class="vs">powershell</span><span class="cf">|</span><span class="vs">cmd</span><span class="cf">|</span><span class="vs">terminal</span><span class="cf">|</span><span class="vs">shell</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb7-1644"><a href="#cb7-1644" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;IA&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">ia</span><span class="cf">|</span><span class="vs">gpt</span><span class="cf">|</span><span class="vs">chatgpt</span><span class="cf">|</span><span class="vs">grok</span><span class="cf">|</span><span class="vs">qwen</span><span class="cf">|</span><span class="vs">deepseek</span><span class="cf">|</span><span class="vs">llm</span><span class="cf">|</span><span class="vs">modelo</span><span class="cf">|</span><span class="vs">prompt</span><span class="cf">|</span><span class="vs">token</span><span class="cf">|</span><span class="vs">embedding</span><span class="cf">|</span><span class="vs">fine-tune</span><span class="cf">|</span><span class="vs">neural</span><span class="cf">|</span><span class="vs">chatbot</span><span class="cf">|</span><span class="vs">intelig√™ncia artificial</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb7-1645"><a href="#cb7-1645" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Dados&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">dados</span><span class="cf">|</span><span class="vs">data</span><span class="cf">|</span><span class="vs">csv</span><span class="cf">|</span><span class="vs">json</span><span class="cf">|</span><span class="vs">pandas</span><span class="cf">|</span><span class="vs">numpy</span><span class="cf">|</span><span class="vs">excel</span><span class="cf">|</span><span class="vs">sql</span><span class="cf">|</span><span class="vs">banco</span><span class="cf">|</span><span class="vs">sqlite</span><span class="cf">|</span><span class="vs">postgres</span><span class="cf">|</span><span class="vs">visualiza√ß√£o</span><span class="cf">|</span><span class="vs">gr√°fico</span><span class="cf">|</span><span class="vs">tabela</span><span class="cf">|</span><span class="vs">an√°lise</span><span class="cf">|</span><span class="vs">etl</span><span class="cf">|</span><span class="vs">dashboard</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb7-1646"><a href="#cb7-1646" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Geral&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">geral</span><span class="cf">|</span><span class="vs">pergunta</span><span class="cf">|</span><span class="vs">ajuda</span><span class="cf">|</span><span class="vs">como fazer</span><span class="cf">|</span><span class="vs">explicar</span><span class="cf">|</span><span class="vs">resumo</span><span class="cf">|</span><span class="vs">tutorial b√°sico</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span></span>
<span id="cb7-1647"><a href="#cb7-1647" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-1648"><a href="#cb7-1648" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1649"><a href="#cb7-1649" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category, pattern <span class="kw">in</span> patterns.items():</span>
<span id="cb7-1650"><a href="#cb7-1650" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> re.search(pattern, text, re.IGNORECASE):</span>
<span id="cb7-1651"><a href="#cb7-1651" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> category</span>
<span id="cb7-1652"><a href="#cb7-1652" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1653"><a href="#cb7-1653" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Outros&#39;</span></span>
<span id="cb7-1654"><a href="#cb7-1654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1655"><a href="#cb7-1655" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_timestamp_for_sorting(<span class="va">self</span>, timestamp) <span class="op">-&gt;</span> datetime:</span>
<span id="cb7-1656"><a href="#cb7-1656" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> timestamp:</span>
<span id="cb7-1657"><a href="#cb7-1657" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> datetime.<span class="bu">min</span></span>
<span id="cb7-1658"><a href="#cb7-1658" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1659"><a href="#cb7-1659" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb7-1660"><a href="#cb7-1660" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(timestamp, <span class="bu">str</span>):</span>
<span id="cb7-1661"><a href="#cb7-1661" aria-hidden="true" tabindex="-1"></a>                clean_ts <span class="op">=</span> timestamp.replace(<span class="st">&#39;T&#39;</span>, <span class="st">&#39; &#39;</span>).split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>].split(<span class="st">&#39;+&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb7-1662"><a href="#cb7-1662" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> clean_ts.endswith(<span class="st">&#39;Z&#39;</span>):</span>
<span id="cb7-1663"><a href="#cb7-1663" aria-hidden="true" tabindex="-1"></a>                    clean_ts <span class="op">=</span> clean_ts[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb7-1664"><a href="#cb7-1664" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> datetime.fromisoformat(clean_ts)</span>
<span id="cb7-1665"><a href="#cb7-1665" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(timestamp, (<span class="bu">int</span>, <span class="bu">float</span>)):</span>
<span id="cb7-1666"><a href="#cb7-1666" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> datetime.fromtimestamp(timestamp)</span>
<span id="cb7-1667"><a href="#cb7-1667" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb7-1668"><a href="#cb7-1668" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb7-1669"><a href="#cb7-1669" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1670"><a href="#cb7-1670" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> datetime.<span class="bu">min</span></span>
<span id="cb7-1671"><a href="#cb7-1671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1672"><a href="#cb7-1672" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> format_timestamp(<span class="va">self</span>, timestamp) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb7-1673"><a href="#cb7-1673" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> timestamp:</span>
<span id="cb7-1674"><a href="#cb7-1674" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb7-1675"><a href="#cb7-1675" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1676"><a href="#cb7-1676" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb7-1677"><a href="#cb7-1677" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(timestamp, (<span class="bu">int</span>, <span class="bu">float</span>)):</span>
<span id="cb7-1678"><a href="#cb7-1678" aria-hidden="true" tabindex="-1"></a>                dt <span class="op">=</span> datetime.fromtimestamp(timestamp)</span>
<span id="cb7-1679"><a href="#cb7-1679" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> dt.strftime(<span class="st">&#39;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S&#39;</span>)</span>
<span id="cb7-1680"><a href="#cb7-1680" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(timestamp, <span class="bu">str</span>):</span>
<span id="cb7-1681"><a href="#cb7-1681" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">&#39;T&#39;</span> <span class="kw">in</span> timestamp:</span>
<span id="cb7-1682"><a href="#cb7-1682" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> timestamp.replace(<span class="st">&#39;T&#39;</span>, <span class="st">&#39; &#39;</span>).split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb7-1683"><a href="#cb7-1683" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> timestamp</span>
<span id="cb7-1684"><a href="#cb7-1684" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb7-1685"><a href="#cb7-1685" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb7-1686"><a href="#cb7-1686" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1687"><a href="#cb7-1687" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">str</span>(timestamp)</span>
<span id="cb7-1688"><a href="#cb7-1688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1689"><a href="#cb7-1689" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_enhanced_markdown_content(<span class="va">self</span>, conversation: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-1690"><a href="#cb7-1690" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Gera conte√∫do Markdown com preserva√ß√£o total de formata√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb7-1691"><a href="#cb7-1691" aria-hidden="true" tabindex="-1"></a>        lines <span class="op">=</span> [</span>
<span id="cb7-1692"><a href="#cb7-1692" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;# </span><span class="sc">{</span>conversation[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb7-1693"><a href="#cb7-1693" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb7-1694"><a href="#cb7-1694" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;## üìä Informa√ß√µes&quot;</span>,</span>
<span id="cb7-1695"><a href="#cb7-1695" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **N√∫mero:** #</span><span class="sc">{</span>conversation[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb7-1696"><a href="#cb7-1696" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Origem:** </span><span class="sc">{</span>conversation[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb7-1697"><a href="#cb7-1697" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Categoria:** </span><span class="sc">{</span>conversation[<span class="st">&#39;category&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb7-1698"><a href="#cb7-1698" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **ID:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;id&#39;</span>, <span class="st">&#39;N/A&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb7-1699"><a href="#cb7-1699" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Criada em:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> conversation<span class="sc">.</span>get(<span class="st">&#39;created_at&#39;</span>) <span class="kw">or</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb7-1700"><a href="#cb7-1700" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb7-1701"><a href="#cb7-1701" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1702"><a href="#cb7-1702" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> conversation.get(<span class="st">&#39;updated_at&#39;</span>):</span>
<span id="cb7-1703"><a href="#cb7-1703" aria-hidden="true" tabindex="-1"></a>            lines.append(<span class="ss">f&quot;- **Atualizada em:** </span><span class="sc">{</span>conversation[<span class="st">&#39;updated_at&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-1704"><a href="#cb7-1704" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1705"><a href="#cb7-1705" aria-hidden="true" tabindex="-1"></a>        lines.extend([</span>
<span id="cb7-1706"><a href="#cb7-1706" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Total de mensagens:** </span><span class="sc">{</span><span class="bu">len</span>(conversation[<span class="st">&#39;messages&#39;</span>])<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb7-1707"><a href="#cb7-1707" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Resumo:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;Sem resumo&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb7-1708"><a href="#cb7-1708" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb7-1709"><a href="#cb7-1709" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;---&quot;</span>,</span>
<span id="cb7-1710"><a href="#cb7-1710" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb7-1711"><a href="#cb7-1711" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;## üí¨ Conversa&quot;</span>,</span>
<span id="cb7-1712"><a href="#cb7-1712" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span></span>
<span id="cb7-1713"><a href="#cb7-1713" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb7-1714"><a href="#cb7-1714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1715"><a href="#cb7-1715" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, msg <span class="kw">in</span> <span class="bu">enumerate</span>(conversation[<span class="st">&#39;messages&#39;</span>], <span class="dv">1</span>):</span>
<span id="cb7-1716"><a href="#cb7-1716" aria-hidden="true" tabindex="-1"></a>            timestamp <span class="op">=</span> <span class="ss">f&quot; *(</span><span class="sc">{</span>msg[<span class="st">&#39;timestamp&#39;</span>]<span class="sc">}</span><span class="ss">)*&quot;</span> <span class="cf">if</span> msg[<span class="st">&#39;timestamp&#39;</span>] <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb7-1717"><a href="#cb7-1717" aria-hidden="true" tabindex="-1"></a>            model_info <span class="op">=</span> <span class="ss">f&quot; *[</span><span class="sc">{</span>msg<span class="sc">.</span>get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;&#39;</span>)<span class="sc">}</span><span class="ss">]*&quot;</span> <span class="cf">if</span> msg.get(<span class="st">&#39;model&#39;</span>) <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb7-1718"><a href="#cb7-1718" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1719"><a href="#cb7-1719" aria-hidden="true" tabindex="-1"></a>            preserved_content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(msg[<span class="st">&#39;content&#39;</span>])</span>
<span id="cb7-1720"><a href="#cb7-1720" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1721"><a href="#cb7-1721" aria-hidden="true" tabindex="-1"></a>            lines.extend([</span>
<span id="cb7-1722"><a href="#cb7-1722" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;### </span><span class="sc">{</span>msg[<span class="st">&#39;author&#39;</span>]<span class="sc">}{</span>timestamp<span class="sc">}{</span>model_info<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb7-1723"><a href="#cb7-1723" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;&quot;</span>,</span>
<span id="cb7-1724"><a href="#cb7-1724" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;</span><span class="sc">{</span>preserved_content<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb7-1725"><a href="#cb7-1725" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;&quot;</span></span>
<span id="cb7-1726"><a href="#cb7-1726" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb7-1727"><a href="#cb7-1727" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1728"><a href="#cb7-1728" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> j <span class="op">&lt;</span> <span class="bu">len</span>(conversation[<span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb7-1729"><a href="#cb7-1729" aria-hidden="true" tabindex="-1"></a>                lines.extend([<span class="st">&quot;---&quot;</span>, <span class="st">&quot;&quot;</span>])</span>
<span id="cb7-1730"><a href="#cb7-1730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1731"><a href="#cb7-1731" aria-hidden="true" tabindex="-1"></a>        lines.extend([</span>
<span id="cb7-1732"><a href="#cb7-1732" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;---&quot;</span>,</span>
<span id="cb7-1733"><a href="#cb7-1733" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb7-1734"><a href="#cb7-1734" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;*Conversa exportada do </span><span class="sc">{</span>conversation[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">*&quot;</span>,</span>
<span id="cb7-1735"><a href="#cb7-1735" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;*Processado em: </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">.</span>strftime(<span class="st">&#39;</span><span class="sc">%d</span><span class="st">/%m/%Y %H:%M&#39;</span>)<span class="sc">}</span><span class="ss">*&quot;</span></span>
<span id="cb7-1736"><a href="#cb7-1736" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb7-1737"><a href="#cb7-1737" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1738"><a href="#cb7-1738" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(lines)</span>
<span id="cb7-1739"><a href="#cb7-1739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1740"><a href="#cb7-1740" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_qwen_corrected(<span class="va">self</span>, path: Path):</span>
<span id="cb7-1741"><a href="#cb7-1741" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Processa Qwen3 com corre√ß√£o para content_list - VERS√ÉO CORRIGIDA&quot;&quot;&quot;</span></span>
<span id="cb7-1742"><a href="#cb7-1742" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb7-1743"><a href="#cb7-1743" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria Qwen3: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-1744"><a href="#cb7-1744" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-1745"><a href="#cb7-1745" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1746"><a href="#cb7-1746" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb7-1747"><a href="#cb7-1747" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb7-1748"><a href="#cb7-1748" aria-hidden="true" tabindex="-1"></a>                raw_data <span class="op">=</span> json.load(f)</span>
<span id="cb7-1749"><a href="#cb7-1749" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1750"><a href="#cb7-1750" aria-hidden="true" tabindex="-1"></a>            <span class="co"># DEBUG: Salvar estrutura completa para an√°lise</span></span>
<span id="cb7-1751"><a href="#cb7-1751" aria-hidden="true" tabindex="-1"></a>            debug_file <span class="op">=</span> Path(<span class="st">&quot;qwen_debug_structure.json&quot;</span>)</span>
<span id="cb7-1752"><a href="#cb7-1752" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(debug_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb7-1753"><a href="#cb7-1753" aria-hidden="true" tabindex="-1"></a>                json.dump(raw_data, f, indent<span class="op">=</span><span class="dv">2</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-1754"><a href="#cb7-1754" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Estrutura Qwen salva em: </span><span class="sc">{</span>debug_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-1755"><a href="#cb7-1755" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1756"><a href="#cb7-1756" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extrair conversas</span></span>
<span id="cb7-1757"><a href="#cb7-1757" aria-hidden="true" tabindex="-1"></a>            conversations <span class="op">=</span> []</span>
<span id="cb7-1758"><a href="#cb7-1758" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1759"><a href="#cb7-1759" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;data&#39;</span> <span class="kw">in</span> raw_data <span class="kw">and</span> <span class="bu">isinstance</span>(raw_data[<span class="st">&#39;data&#39;</span>], <span class="bu">list</span>):</span>
<span id="cb7-1760"><a href="#cb7-1760" aria-hidden="true" tabindex="-1"></a>                conversations <span class="op">=</span> raw_data[<span class="st">&#39;data&#39;</span>]</span>
<span id="cb7-1761"><a href="#cb7-1761" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÅ Estrutura 1: </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas em &#39;data&#39;&quot;</span>)</span>
<span id="cb7-1762"><a href="#cb7-1762" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">list</span>):</span>
<span id="cb7-1763"><a href="#cb7-1763" aria-hidden="true" tabindex="-1"></a>                conversations <span class="op">=</span> raw_data</span>
<span id="cb7-1764"><a href="#cb7-1764" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÅ Estrutura 2: </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas na raiz&quot;</span>)</span>
<span id="cb7-1765"><a href="#cb7-1765" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb7-1766"><a href="#cb7-1766" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> key, value <span class="kw">in</span> raw_data.items():</span>
<span id="cb7-1767"><a href="#cb7-1767" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(value, <span class="bu">list</span>) <span class="kw">and</span> <span class="bu">len</span>(value) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb7-1768"><a href="#cb7-1768" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(value[<span class="dv">0</span>], <span class="bu">dict</span>) <span class="kw">and</span> <span class="bu">any</span>(k <span class="kw">in</span> value[<span class="dv">0</span>] <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">&#39;title&#39;</span>, <span class="st">&#39;chat&#39;</span>, <span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb7-1769"><a href="#cb7-1769" aria-hidden="true" tabindex="-1"></a>                            conversations <span class="op">=</span> value</span>
<span id="cb7-1770"><a href="#cb7-1770" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÅ Estrutura alternativa: </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas em &#39;</span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb7-1771"><a href="#cb7-1771" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">break</span></span>
<span id="cb7-1772"><a href="#cb7-1772" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1773"><a href="#cb7-1773" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> conversations:</span>
<span id="cb7-1774"><a href="#cb7-1774" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Nenhuma conversa encontrada no arquivo Qwen&quot;</span>)</span>
<span id="cb7-1775"><a href="#cb7-1775" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb7-1776"><a href="#cb7-1776" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1777"><a href="#cb7-1777" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Qwen: encontradas </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb7-1778"><a href="#cb7-1778" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-1779"><a href="#cb7-1779" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1780"><a href="#cb7-1780" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(conversations):</span>
<span id="cb7-1781"><a href="#cb7-1781" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conv, <span class="bu">dict</span>):</span>
<span id="cb7-1782"><a href="#cb7-1782" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb7-1783"><a href="#cb7-1783" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-1784"><a href="#cb7-1784" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa Qwen </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb7-1785"><a href="#cb7-1785" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb7-1786"><a href="#cb7-1786" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1787"><a href="#cb7-1787" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üîç Processando: &#39;</span><span class="sc">{</span>clean_title<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb7-1788"><a href="#cb7-1788" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1789"><a href="#cb7-1789" aria-hidden="true" tabindex="-1"></a>                <span class="co"># EXTRA√á√ÉO CORRIGIDA - foco em content_list</span></span>
<span id="cb7-1790"><a href="#cb7-1790" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> <span class="va">self</span>._extract_qwen_messages_corrected(conv, clean_title, i)</span>
<span id="cb7-1791"><a href="#cb7-1791" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1792"><a href="#cb7-1792" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb7-1793"><a href="#cb7-1793" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Ordenar mensagens por timestamp</span></span>
<span id="cb7-1794"><a href="#cb7-1794" aria-hidden="true" tabindex="-1"></a>                    messages.sort(key<span class="op">=</span><span class="kw">lambda</span> x: <span class="va">self</span>.parse_timestamp_for_sorting(x[<span class="st">&#39;timestamp&#39;</span>]))</span>
<span id="cb7-1795"><a href="#cb7-1795" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-1796"><a href="#cb7-1796" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb7-1797"><a href="#cb7-1797" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,</span>
<span id="cb7-1798"><a href="#cb7-1798" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;Qwen3&#39;</span>,</span>
<span id="cb7-1799"><a href="#cb7-1799" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;qwen_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb7-1800"><a href="#cb7-1800" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;created_at&#39;</span>)),</span>
<span id="cb7-1801"><a href="#cb7-1801" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;updated_at&#39;</span>)),</span>
<span id="cb7-1802"><a href="#cb7-1802" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb7-1803"><a href="#cb7-1803" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb7-1804"><a href="#cb7-1804" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="va">self</span>.categorize_conversation(clean_title, messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb7-1805"><a href="#cb7-1805" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb7-1806"><a href="#cb7-1806" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-1807"><a href="#cb7-1807" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;   ‚úÖ Adicionada: </span><span class="sc">{</span><span class="bu">len</span>(messages)<span class="sc">}</span><span class="ss"> mensagens&quot;</span>)</span>
<span id="cb7-1808"><a href="#cb7-1808" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb7-1809"><a href="#cb7-1809" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.warning(<span class="ss">f&quot;   ‚ùå Conversa </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: nenhuma mensagem extra√≠da&quot;</span>)</span>
<span id="cb7-1810"><a href="#cb7-1810" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-1811"><a href="#cb7-1811" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Qwen3: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb7-1812"><a href="#cb7-1812" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1813"><a href="#cb7-1813" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-1814"><a href="#cb7-1814" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar Qwen3: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-1815"><a href="#cb7-1815" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(traceback.format_exc())</span>
<span id="cb7-1816"><a href="#cb7-1816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1817"><a href="#cb7-1817" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _extract_qwen_messages_corrected(<span class="va">self</span>, conv: Dict[<span class="bu">str</span>, Any], clean_title: <span class="bu">str</span>, conv_index: <span class="bu">int</span>) <span class="op">-&gt;</span> List[Dict[<span class="bu">str</span>, Any]]:</span>
<span id="cb7-1818"><a href="#cb7-1818" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Extrai mensagens do Qwen com corre√ß√£o para content_list&quot;&quot;&quot;</span></span>
<span id="cb7-1819"><a href="#cb7-1819" aria-hidden="true" tabindex="-1"></a>        all_messages <span class="op">=</span> []</span>
<span id="cb7-1820"><a href="#cb7-1820" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1821"><a href="#cb7-1821" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ESTRAT√âGIA PRINCIPAL: Buscar em toda a estrutura por mensagens</span></span>
<span id="cb7-1822"><a href="#cb7-1822" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> extract_from_object(obj, path<span class="op">=</span><span class="st">&quot;&quot;</span>):</span>
<span id="cb7-1823"><a href="#cb7-1823" aria-hidden="true" tabindex="-1"></a>            messages_found <span class="op">=</span> []</span>
<span id="cb7-1824"><a href="#cb7-1824" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1825"><a href="#cb7-1825" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(obj, <span class="bu">dict</span>):</span>
<span id="cb7-1826"><a href="#cb7-1826" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Verificar se √© uma mensagem com content_list (CASO CORRIGIDO)</span></span>
<span id="cb7-1827"><a href="#cb7-1827" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>._is_qwen_message_with_content(obj):</span>
<span id="cb7-1828"><a href="#cb7-1828" aria-hidden="true" tabindex="-1"></a>                    message <span class="op">=</span> <span class="va">self</span>._create_message_from_qwen_object(obj)</span>
<span id="cb7-1829"><a href="#cb7-1829" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> message:</span>
<span id="cb7-1830"><a href="#cb7-1830" aria-hidden="true" tabindex="-1"></a>                        messages_found.append(message)</span>
<span id="cb7-1831"><a href="#cb7-1831" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1832"><a href="#cb7-1832" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Buscar recursivamente</span></span>
<span id="cb7-1833"><a href="#cb7-1833" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> key, value <span class="kw">in</span> obj.items():</span>
<span id="cb7-1834"><a href="#cb7-1834" aria-hidden="true" tabindex="-1"></a>                    messages_found.extend(extract_from_object(value, <span class="ss">f&quot;</span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">&quot;</span>))</span>
<span id="cb7-1835"><a href="#cb7-1835" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-1836"><a href="#cb7-1836" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(obj, <span class="bu">list</span>):</span>
<span id="cb7-1837"><a href="#cb7-1837" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> item <span class="kw">in</span> obj:</span>
<span id="cb7-1838"><a href="#cb7-1838" aria-hidden="true" tabindex="-1"></a>                    messages_found.extend(extract_from_object(item, path))</span>
<span id="cb7-1839"><a href="#cb7-1839" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-1840"><a href="#cb7-1840" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> messages_found</span>
<span id="cb7-1841"><a href="#cb7-1841" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1842"><a href="#cb7-1842" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Aplicar extra√ß√£o recursiva</span></span>
<span id="cb7-1843"><a href="#cb7-1843" aria-hidden="true" tabindex="-1"></a>        all_messages <span class="op">=</span> extract_from_object(conv, <span class="st">&quot;root&quot;</span>)</span>
<span id="cb7-1844"><a href="#cb7-1844" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1845"><a href="#cb7-1845" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remover duplicatas</span></span>
<span id="cb7-1846"><a href="#cb7-1846" aria-hidden="true" tabindex="-1"></a>        unique_messages <span class="op">=</span> <span class="va">self</span>._remove_duplicate_messages(all_messages)</span>
<span id="cb7-1847"><a href="#cb7-1847" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1848"><a href="#cb7-1848" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(unique_messages) <span class="op">!=</span> <span class="bu">len</span>(all_messages):</span>
<span id="cb7-1849"><a href="#cb7-1849" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;         üîÑ Removidas </span><span class="sc">{</span><span class="bu">len</span>(all_messages) <span class="op">-</span> <span class="bu">len</span>(unique_messages)<span class="sc">}</span><span class="ss"> mensagens duplicadas&quot;</span>)</span>
<span id="cb7-1850"><a href="#cb7-1850" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1851"><a href="#cb7-1851" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> unique_messages</span>
<span id="cb7-1852"><a href="#cb7-1852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1853"><a href="#cb7-1853" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _is_qwen_message_with_content(<span class="va">self</span>, obj: Dict) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb7-1854"><a href="#cb7-1854" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Verifica se √© uma mensagem Qwen v√°lida (incluindo content_list)&quot;&quot;&quot;</span></span>
<span id="cb7-1855"><a href="#cb7-1855" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verificar campos b√°sicos de mensagem</span></span>
<span id="cb7-1856"><a href="#cb7-1856" aria-hidden="true" tabindex="-1"></a>        has_basic_structure <span class="op">=</span> (<span class="st">&#39;role&#39;</span> <span class="kw">in</span> obj <span class="kw">and</span> <span class="st">&#39;content&#39;</span> <span class="kw">in</span> obj)</span>
<span id="cb7-1857"><a href="#cb7-1857" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1858"><a href="#cb7-1858" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verificar se tem content_list (CORRE√á√ÉO DO PROBLEMA)</span></span>
<span id="cb7-1859"><a href="#cb7-1859" aria-hidden="true" tabindex="-1"></a>        has_content_list <span class="op">=</span> <span class="st">&#39;content_list&#39;</span> <span class="kw">in</span> obj <span class="kw">and</span> <span class="bu">isinstance</span>(obj[<span class="st">&#39;content_list&#39;</span>], <span class="bu">list</span>)</span>
<span id="cb7-1860"><a href="#cb7-1860" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1861"><a href="#cb7-1861" aria-hidden="true" tabindex="-1"></a>        <span class="co"># √â uma mensagem v√°lida se tiver estrutura b√°sica E (conte√∫do n√£o vazio OU content_list)</span></span>
<span id="cb7-1862"><a href="#cb7-1862" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (has_basic_structure <span class="kw">and</span> </span>
<span id="cb7-1863"><a href="#cb7-1863" aria-hidden="true" tabindex="-1"></a>                (obj.get(<span class="st">&#39;content&#39;</span>) <span class="kw">or</span> has_content_list) <span class="kw">and</span></span>
<span id="cb7-1864"><a href="#cb7-1864" aria-hidden="true" tabindex="-1"></a>                obj.get(<span class="st">&#39;role&#39;</span>) <span class="kw">in</span> [<span class="st">&#39;user&#39;</span>, <span class="st">&#39;assistant&#39;</span>])</span>
<span id="cb7-1865"><a href="#cb7-1865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1866"><a href="#cb7-1866" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_message_from_qwen_object(<span class="va">self</span>, obj: Dict) <span class="op">-&gt;</span> Optional[Dict[<span class="bu">str</span>, Any]]:</span>
<span id="cb7-1867"><a href="#cb7-1867" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Cria uma mensagem a partir de um objeto Qwen, priorizando content_list&quot;&quot;&quot;</span></span>
<span id="cb7-1868"><a href="#cb7-1868" aria-hidden="true" tabindex="-1"></a>        role <span class="op">=</span> obj.get(<span class="st">&#39;role&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb7-1869"><a href="#cb7-1869" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> obj.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb7-1870"><a href="#cb7-1870" aria-hidden="true" tabindex="-1"></a>        content_list <span class="op">=</span> obj.get(<span class="st">&#39;content_list&#39;</span>, [])</span>
<span id="cb7-1871"><a href="#cb7-1871" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1872"><a href="#cb7-1872" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> role:</span>
<span id="cb7-1873"><a href="#cb7-1873" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb7-1874"><a href="#cb7-1874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1875"><a href="#cb7-1875" aria-hidden="true" tabindex="-1"></a>        <span class="co"># CORRE√á√ÉO PRINCIPAL: Priorizar content_list quando content estiver vazio</span></span>
<span id="cb7-1876"><a href="#cb7-1876" aria-hidden="true" tabindex="-1"></a>        final_content <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb7-1877"><a href="#cb7-1877" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1878"><a href="#cb7-1878" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> content_list <span class="kw">and</span> <span class="bu">isinstance</span>(content_list, <span class="bu">list</span>):</span>
<span id="cb7-1879"><a href="#cb7-1879" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extrair conte√∫do de content_list</span></span>
<span id="cb7-1880"><a href="#cb7-1880" aria-hidden="true" tabindex="-1"></a>            content_parts <span class="op">=</span> []</span>
<span id="cb7-1881"><a href="#cb7-1881" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> content_item <span class="kw">in</span> content_list:</span>
<span id="cb7-1882"><a href="#cb7-1882" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">isinstance</span>(content_item, <span class="bu">dict</span>):</span>
<span id="cb7-1883"><a href="#cb7-1883" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Verificar diferentes estruturas de content_list</span></span>
<span id="cb7-1884"><a href="#cb7-1884" aria-hidden="true" tabindex="-1"></a>                    item_content <span class="op">=</span> content_item.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb7-1885"><a href="#cb7-1885" aria-hidden="true" tabindex="-1"></a>                    item_text <span class="op">=</span> content_item.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb7-1886"><a href="#cb7-1886" aria-hidden="true" tabindex="-1"></a>                    item_type <span class="op">=</span> content_item.get(<span class="st">&#39;type&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb7-1887"><a href="#cb7-1887" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-1888"><a href="#cb7-1888" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> item_content:</span>
<span id="cb7-1889"><a href="#cb7-1889" aria-hidden="true" tabindex="-1"></a>                        content_parts.append(<span class="bu">str</span>(item_content))</span>
<span id="cb7-1890"><a href="#cb7-1890" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> item_text:</span>
<span id="cb7-1891"><a href="#cb7-1891" aria-hidden="true" tabindex="-1"></a>                        content_parts.append(<span class="bu">str</span>(item_text))</span>
<span id="cb7-1892"><a href="#cb7-1892" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> item_type <span class="op">==</span> <span class="st">&#39;text&#39;</span> <span class="kw">and</span> <span class="st">&#39;text&#39;</span> <span class="kw">in</span> content_item:</span>
<span id="cb7-1893"><a href="#cb7-1893" aria-hidden="true" tabindex="-1"></a>                        content_parts.append(<span class="bu">str</span>(content_item[<span class="st">&#39;text&#39;</span>]))</span>
<span id="cb7-1894"><a href="#cb7-1894" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1895"><a href="#cb7-1895" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> content_parts:</span>
<span id="cb7-1896"><a href="#cb7-1896" aria-hidden="true" tabindex="-1"></a>                final_content <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(content_parts).strip()</span>
<span id="cb7-1897"><a href="#cb7-1897" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1898"><a href="#cb7-1898" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se content_list n√£o forneceu conte√∫do, usar o campo content tradicional</span></span>
<span id="cb7-1899"><a href="#cb7-1899" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> final_content <span class="kw">and</span> content:</span>
<span id="cb7-1900"><a href="#cb7-1900" aria-hidden="true" tabindex="-1"></a>            final_content <span class="op">=</span> <span class="bu">str</span>(content).strip()</span>
<span id="cb7-1901"><a href="#cb7-1901" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1902"><a href="#cb7-1902" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se ainda n√£o tem conte√∫do, pular</span></span>
<span id="cb7-1903"><a href="#cb7-1903" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> final_content <span class="kw">or</span> final_content <span class="op">==</span> <span class="st">&#39;null&#39;</span>:</span>
<span id="cb7-1904"><a href="#cb7-1904" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb7-1905"><a href="#cb7-1905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1906"><a href="#cb7-1906" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Determinar autor</span></span>
<span id="cb7-1907"><a href="#cb7-1907" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> role <span class="op">==</span> <span class="st">&#39;user&#39;</span>:</span>
<span id="cb7-1908"><a href="#cb7-1908" aria-hidden="true" tabindex="-1"></a>            author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb7-1909"><a href="#cb7-1909" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> role <span class="op">==</span> <span class="st">&#39;assistant&#39;</span>:</span>
<span id="cb7-1910"><a href="#cb7-1910" aria-hidden="true" tabindex="-1"></a>            author <span class="op">=</span> <span class="st">&quot;ü§ñ Qwen3&quot;</span></span>
<span id="cb7-1911"><a href="#cb7-1911" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-1912"><a href="#cb7-1912" aria-hidden="true" tabindex="-1"></a>            author <span class="op">=</span> <span class="ss">f&quot;üîπ </span><span class="sc">{</span>role<span class="sc">.</span>title()<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb7-1913"><a href="#cb7-1913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1914"><a href="#cb7-1914" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Processar conte√∫do especial</span></span>
<span id="cb7-1915"><a href="#cb7-1915" aria-hidden="true" tabindex="-1"></a>        final_content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(final_content)</span>
<span id="cb7-1916"><a href="#cb7-1916" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1917"><a href="#cb7-1917" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb7-1918"><a href="#cb7-1918" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb7-1919"><a href="#cb7-1919" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb7-1920"><a href="#cb7-1920" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;content&#39;</span>: final_content,</span>
<span id="cb7-1921"><a href="#cb7-1921" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(obj.get(<span class="st">&#39;created_at&#39;</span>)),</span>
<span id="cb7-1922"><a href="#cb7-1922" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;model&#39;</span>: obj.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;Qwen3&#39;</span>)</span>
<span id="cb7-1923"><a href="#cb7-1923" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-1924"><a href="#cb7-1924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1925"><a href="#cb7-1925" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _remove_duplicate_messages(<span class="va">self</span>, messages: List[Dict[<span class="bu">str</span>, Any]]) <span class="op">-&gt;</span> List[Dict[<span class="bu">str</span>, Any]]:</span>
<span id="cb7-1926"><a href="#cb7-1926" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Remove mensagens duplicadas baseadas no conte√∫do&quot;&quot;&quot;</span></span>
<span id="cb7-1927"><a href="#cb7-1927" aria-hidden="true" tabindex="-1"></a>        seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb7-1928"><a href="#cb7-1928" aria-hidden="true" tabindex="-1"></a>        unique_messages <span class="op">=</span> []</span>
<span id="cb7-1929"><a href="#cb7-1929" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1930"><a href="#cb7-1930" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> msg <span class="kw">in</span> messages:</span>
<span id="cb7-1931"><a href="#cb7-1931" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Criar uma chave √∫nica baseada no conte√∫do e timestamp</span></span>
<span id="cb7-1932"><a href="#cb7-1932" aria-hidden="true" tabindex="-1"></a>            content_key <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>msg[<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>msg[<span class="st">&#39;timestamp&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb7-1933"><a href="#cb7-1933" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1934"><a href="#cb7-1934" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> content_key <span class="kw">not</span> <span class="kw">in</span> seen:</span>
<span id="cb7-1935"><a href="#cb7-1935" aria-hidden="true" tabindex="-1"></a>                seen.add(content_key)</span>
<span id="cb7-1936"><a href="#cb7-1936" aria-hidden="true" tabindex="-1"></a>                unique_messages.append(msg)</span>
<span id="cb7-1937"><a href="#cb7-1937" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1938"><a href="#cb7-1938" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> unique_messages</span>
<span id="cb7-1939"><a href="#cb7-1939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1940"><a href="#cb7-1940" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_chatgpt(<span class="va">self</span>, path: Path):</span>
<span id="cb7-1941"><a href="#cb7-1941" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Processa exporta√ß√£o do ChatGPT&quot;&quot;&quot;</span></span>
<span id="cb7-1942"><a href="#cb7-1942" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb7-1943"><a href="#cb7-1943" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria ChatGPT: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-1944"><a href="#cb7-1944" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-1945"><a href="#cb7-1945" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1946"><a href="#cb7-1946" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb7-1947"><a href="#cb7-1947" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;chatgpt_&quot;</span>)</span>
<span id="cb7-1948"><a href="#cb7-1948" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb7-1949"><a href="#cb7-1949" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb7-1950"><a href="#cb7-1950" aria-hidden="true" tabindex="-1"></a>            convs_path <span class="op">=</span> Path(temp_dir) <span class="op">/</span> <span class="st">&quot;conversations.json&quot;</span></span>
<span id="cb7-1951"><a href="#cb7-1951" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> convs_path.exists():</span>
<span id="cb7-1952"><a href="#cb7-1952" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå ChatGPT: conversations.json n√£o encontrado.&quot;</span>)</span>
<span id="cb7-1953"><a href="#cb7-1953" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb7-1954"><a href="#cb7-1954" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1955"><a href="#cb7-1955" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(convs_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb7-1956"><a href="#cb7-1956" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.load(f)</span>
<span id="cb7-1957"><a href="#cb7-1957" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1958"><a href="#cb7-1958" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">list</span>):</span>
<span id="cb7-1959"><a href="#cb7-1959" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  ChatGPT: estrutura inesperada.&quot;</span>)</span>
<span id="cb7-1960"><a href="#cb7-1960" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb7-1961"><a href="#cb7-1961" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1962"><a href="#cb7-1962" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç ChatGPT: encontradas </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb7-1963"><a href="#cb7-1963" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-1964"><a href="#cb7-1964" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-1965"><a href="#cb7-1965" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb7-1966"><a href="#cb7-1966" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa ChatGPT </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb7-1967"><a href="#cb7-1967" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb7-1968"><a href="#cb7-1968" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb7-1969"><a href="#cb7-1969" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1970"><a href="#cb7-1970" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb7-1971"><a href="#cb7-1971" aria-hidden="true" tabindex="-1"></a>                mapping <span class="op">=</span> conv.get(<span class="st">&#39;mapping&#39;</span>, {})</span>
<span id="cb7-1972"><a href="#cb7-1972" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1973"><a href="#cb7-1973" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> msg_id, node <span class="kw">in</span> mapping.items():</span>
<span id="cb7-1974"><a href="#cb7-1974" aria-hidden="true" tabindex="-1"></a>                    msg_data <span class="op">=</span> node.get(<span class="st">&#39;message&#39;</span>)</span>
<span id="cb7-1975"><a href="#cb7-1975" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> msg_data <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(msg_data, <span class="bu">dict</span>):</span>
<span id="cb7-1976"><a href="#cb7-1976" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb7-1977"><a href="#cb7-1977" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb7-1978"><a href="#cb7-1978" aria-hidden="true" tabindex="-1"></a>                    author_role <span class="op">=</span> msg_data.get(<span class="st">&#39;author&#39;</span>, {}).get(<span class="st">&#39;role&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb7-1979"><a href="#cb7-1979" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> author_role <span class="op">==</span> <span class="st">&#39;user&#39;</span>:</span>
<span id="cb7-1980"><a href="#cb7-1980" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb7-1981"><a href="#cb7-1981" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;user&#39;</span></span>
<span id="cb7-1982"><a href="#cb7-1982" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> author_role <span class="op">==</span> <span class="st">&#39;assistant&#39;</span>:</span>
<span id="cb7-1983"><a href="#cb7-1983" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ ChatGPT&quot;</span></span>
<span id="cb7-1984"><a href="#cb7-1984" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;assistant&#39;</span></span>
<span id="cb7-1985"><a href="#cb7-1985" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb7-1986"><a href="#cb7-1986" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb7-1987"><a href="#cb7-1987" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb7-1988"><a href="#cb7-1988" aria-hidden="true" tabindex="-1"></a>                    content_parts <span class="op">=</span> []</span>
<span id="cb7-1989"><a href="#cb7-1989" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> part <span class="kw">in</span> msg_data.get(<span class="st">&#39;content&#39;</span>, {}).get(<span class="st">&#39;parts&#39;</span>, []):</span>
<span id="cb7-1990"><a href="#cb7-1990" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(part, <span class="bu">str</span>):</span>
<span id="cb7-1991"><a href="#cb7-1991" aria-hidden="true" tabindex="-1"></a>                            content_parts.append(part)</span>
<span id="cb7-1992"><a href="#cb7-1992" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(content_parts).strip()</span>
<span id="cb7-1993"><a href="#cb7-1993" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-1994"><a href="#cb7-1994" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb7-1995"><a href="#cb7-1995" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-1996"><a href="#cb7-1996" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb7-1997"><a href="#cb7-1997" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb7-1998"><a href="#cb7-1998" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb7-1999"><a href="#cb7-1999" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb7-2000"><a href="#cb7-2000" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb7-2001"><a href="#cb7-2001" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb7-2002"><a href="#cb7-2002" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb7-2003"><a href="#cb7-2003" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(msg_data.get(<span class="st">&#39;create_time&#39;</span>)),</span>
<span id="cb7-2004"><a href="#cb7-2004" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg_data.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;ChatGPT&#39;</span>)</span>
<span id="cb7-2005"><a href="#cb7-2005" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb7-2006"><a href="#cb7-2006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2007"><a href="#cb7-2007" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb7-2008"><a href="#cb7-2008" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb7-2009"><a href="#cb7-2009" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb7-2010"><a href="#cb7-2010" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;ChatGPT&#39;</span>,</span>
<span id="cb7-2011"><a href="#cb7-2011" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;chatgpt_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb7-2012"><a href="#cb7-2012" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;create_time&#39;</span>)),</span>
<span id="cb7-2013"><a href="#cb7-2013" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;update_time&#39;</span>)),</span>
<span id="cb7-2014"><a href="#cb7-2014" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb7-2015"><a href="#cb7-2015" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb7-2016"><a href="#cb7-2016" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb7-2017"><a href="#cb7-2017" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb7-2018"><a href="#cb7-2018" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-2019"><a href="#cb7-2019" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-2020"><a href="#cb7-2020" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ ChatGPT: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb7-2021"><a href="#cb7-2021" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-2022"><a href="#cb7-2022" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-2023"><a href="#cb7-2023" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar ChatGPT: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-2024"><a href="#cb7-2024" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb7-2025"><a href="#cb7-2025" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb7-2026"><a href="#cb7-2026" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb7-2027"><a href="#cb7-2027" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb7-2028"><a href="#cb7-2028" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-2029"><a href="#cb7-2029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2030"><a href="#cb7-2030" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_deepseek(<span class="va">self</span>, path: Path):</span>
<span id="cb7-2031"><a href="#cb7-2031" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Processa exporta√ß√£o do DeepSeek&quot;&quot;&quot;</span></span>
<span id="cb7-2032"><a href="#cb7-2032" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb7-2033"><a href="#cb7-2033" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria DeepSeek: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-2034"><a href="#cb7-2034" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-2035"><a href="#cb7-2035" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-2036"><a href="#cb7-2036" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb7-2037"><a href="#cb7-2037" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;deepseek_&quot;</span>)</span>
<span id="cb7-2038"><a href="#cb7-2038" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb7-2039"><a href="#cb7-2039" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb7-2040"><a href="#cb7-2040" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2041"><a href="#cb7-2041" aria-hidden="true" tabindex="-1"></a>            convs_path <span class="op">=</span> Path(temp_dir) <span class="op">/</span> <span class="st">&quot;conversations.json&quot;</span></span>
<span id="cb7-2042"><a href="#cb7-2042" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> convs_path.exists():</span>
<span id="cb7-2043"><a href="#cb7-2043" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå DeepSeek: conversations.json n√£o encontrado.&quot;</span>)</span>
<span id="cb7-2044"><a href="#cb7-2044" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb7-2045"><a href="#cb7-2045" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2046"><a href="#cb7-2046" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(convs_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb7-2047"><a href="#cb7-2047" aria-hidden="true" tabindex="-1"></a>                raw_data <span class="op">=</span> json.load(f)</span>
<span id="cb7-2048"><a href="#cb7-2048" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2049"><a href="#cb7-2049" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">list</span>):</span>
<span id="cb7-2050"><a href="#cb7-2050" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> raw_data</span>
<span id="cb7-2051"><a href="#cb7-2051" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;data&#39;</span> <span class="kw">in</span> raw_data:</span>
<span id="cb7-2052"><a href="#cb7-2052" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> raw_data[<span class="st">&#39;data&#39;</span>]</span>
<span id="cb7-2053"><a href="#cb7-2053" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb7-2054"><a href="#cb7-2054" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  DeepSeek: estrutura inesperada.&quot;</span>)</span>
<span id="cb7-2055"><a href="#cb7-2055" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb7-2056"><a href="#cb7-2056" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2057"><a href="#cb7-2057" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">list</span>):</span>
<span id="cb7-2058"><a href="#cb7-2058" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  DeepSeek: &#39;data&#39; n√£o √© uma lista.&quot;</span>)</span>
<span id="cb7-2059"><a href="#cb7-2059" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb7-2060"><a href="#cb7-2060" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2061"><a href="#cb7-2061" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç DeepSeek: encontradas </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb7-2062"><a href="#cb7-2062" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-2063"><a href="#cb7-2063" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-2064"><a href="#cb7-2064" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb7-2065"><a href="#cb7-2065" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa DeepSeek </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb7-2066"><a href="#cb7-2066" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb7-2067"><a href="#cb7-2067" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb7-2068"><a href="#cb7-2068" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2069"><a href="#cb7-2069" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb7-2070"><a href="#cb7-2070" aria-hidden="true" tabindex="-1"></a>                mapping <span class="op">=</span> conv.get(<span class="st">&#39;mapping&#39;</span>, {})</span>
<span id="cb7-2071"><a href="#cb7-2071" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2072"><a href="#cb7-2072" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> node_id, node <span class="kw">in</span> mapping.items():</span>
<span id="cb7-2073"><a href="#cb7-2073" aria-hidden="true" tabindex="-1"></a>                    msg_data <span class="op">=</span> node.get(<span class="st">&#39;message&#39;</span>)</span>
<span id="cb7-2074"><a href="#cb7-2074" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> msg_data <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(msg_data, <span class="bu">dict</span>):</span>
<span id="cb7-2075"><a href="#cb7-2075" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb7-2076"><a href="#cb7-2076" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb7-2077"><a href="#cb7-2077" aria-hidden="true" tabindex="-1"></a>                    fragments <span class="op">=</span> msg_data.get(<span class="st">&#39;fragments&#39;</span>, [])</span>
<span id="cb7-2078"><a href="#cb7-2078" aria-hidden="true" tabindex="-1"></a>                    content_parts <span class="op">=</span> []</span>
<span id="cb7-2079"><a href="#cb7-2079" aria-hidden="true" tabindex="-1"></a>                    msg_type <span class="op">=</span> <span class="va">None</span></span>
<span id="cb7-2080"><a href="#cb7-2080" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-2081"><a href="#cb7-2081" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> frag <span class="kw">in</span> fragments:</span>
<span id="cb7-2082"><a href="#cb7-2082" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(frag, <span class="bu">dict</span>):</span>
<span id="cb7-2083"><a href="#cb7-2083" aria-hidden="true" tabindex="-1"></a>                            frag_type <span class="op">=</span> frag.get(<span class="st">&#39;type&#39;</span>, <span class="st">&#39;&#39;</span>).upper()</span>
<span id="cb7-2084"><a href="#cb7-2084" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> frag_type <span class="kw">in</span> (<span class="st">&#39;REQUEST&#39;</span>, <span class="st">&#39;RESPONSE&#39;</span>):</span>
<span id="cb7-2085"><a href="#cb7-2085" aria-hidden="true" tabindex="-1"></a>                                msg_type <span class="op">=</span> frag_type</span>
<span id="cb7-2086"><a href="#cb7-2086" aria-hidden="true" tabindex="-1"></a>                            text <span class="op">=</span> frag.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb7-2087"><a href="#cb7-2087" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> text:</span>
<span id="cb7-2088"><a href="#cb7-2088" aria-hidden="true" tabindex="-1"></a>                                content_parts.append(text)</span>
<span id="cb7-2089"><a href="#cb7-2089" aria-hidden="true" tabindex="-1"></a>                            content <span class="op">=</span> frag.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb7-2090"><a href="#cb7-2090" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> content:</span>
<span id="cb7-2091"><a href="#cb7-2091" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> <span class="bu">isinstance</span>(content, <span class="bu">list</span>):</span>
<span id="cb7-2092"><a href="#cb7-2092" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">for</span> item <span class="kw">in</span> content:</span>
<span id="cb7-2093"><a href="#cb7-2093" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">if</span> <span class="bu">isinstance</span>(item, <span class="bu">str</span>):</span>
<span id="cb7-2094"><a href="#cb7-2094" aria-hidden="true" tabindex="-1"></a>                                            content_parts.append(item)</span>
<span id="cb7-2095"><a href="#cb7-2095" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">elif</span> <span class="bu">isinstance</span>(item, <span class="bu">dict</span>):</span>
<span id="cb7-2096"><a href="#cb7-2096" aria-hidden="true" tabindex="-1"></a>                                            item_text <span class="op">=</span> item.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb7-2097"><a href="#cb7-2097" aria-hidden="true" tabindex="-1"></a>                                            <span class="cf">if</span> item_text:</span>
<span id="cb7-2098"><a href="#cb7-2098" aria-hidden="true" tabindex="-1"></a>                                                content_parts.append(<span class="bu">str</span>(item_text))</span>
<span id="cb7-2099"><a href="#cb7-2099" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">else</span>:</span>
<span id="cb7-2100"><a href="#cb7-2100" aria-hidden="true" tabindex="-1"></a>                                    content_parts.append(<span class="bu">str</span>(content))</span>
<span id="cb7-2101"><a href="#cb7-2101" aria-hidden="true" tabindex="-1"></a>                                    </span>
<span id="cb7-2102"><a href="#cb7-2102" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="st">&#39; &#39;</span>.join(content_parts).strip()</span>
<span id="cb7-2103"><a href="#cb7-2103" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-2104"><a href="#cb7-2104" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb7-2105"><a href="#cb7-2105" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-2106"><a href="#cb7-2106" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb7-2107"><a href="#cb7-2107" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb7-2108"><a href="#cb7-2108" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb7-2109"><a href="#cb7-2109" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> msg_type <span class="op">==</span> <span class="st">&#39;REQUEST&#39;</span>:</span>
<span id="cb7-2110"><a href="#cb7-2110" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb7-2111"><a href="#cb7-2111" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;user&#39;</span></span>
<span id="cb7-2112"><a href="#cb7-2112" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb7-2113"><a href="#cb7-2113" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ DeepSeek&quot;</span></span>
<span id="cb7-2114"><a href="#cb7-2114" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;assistant&#39;</span></span>
<span id="cb7-2115"><a href="#cb7-2115" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb7-2116"><a href="#cb7-2116" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb7-2117"><a href="#cb7-2117" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb7-2118"><a href="#cb7-2118" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb7-2119"><a href="#cb7-2119" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb7-2120"><a href="#cb7-2120" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(msg_data.get(<span class="st">&#39;inserted_at&#39;</span>)),</span>
<span id="cb7-2121"><a href="#cb7-2121" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg_data.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;DeepSeek&#39;</span>)</span>
<span id="cb7-2122"><a href="#cb7-2122" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb7-2123"><a href="#cb7-2123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2124"><a href="#cb7-2124" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb7-2125"><a href="#cb7-2125" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb7-2126"><a href="#cb7-2126" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb7-2127"><a href="#cb7-2127" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;DeepSeek&#39;</span>,</span>
<span id="cb7-2128"><a href="#cb7-2128" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;deepseek_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb7-2129"><a href="#cb7-2129" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;inserted_at&#39;</span>)),</span>
<span id="cb7-2130"><a href="#cb7-2130" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;updated_at&#39;</span>)),</span>
<span id="cb7-2131"><a href="#cb7-2131" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb7-2132"><a href="#cb7-2132" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb7-2133"><a href="#cb7-2133" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb7-2134"><a href="#cb7-2134" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb7-2135"><a href="#cb7-2135" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-2136"><a href="#cb7-2136" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-2137"><a href="#cb7-2137" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ DeepSeek: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb7-2138"><a href="#cb7-2138" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-2139"><a href="#cb7-2139" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-2140"><a href="#cb7-2140" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar DeepSeek: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-2141"><a href="#cb7-2141" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb7-2142"><a href="#cb7-2142" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb7-2143"><a href="#cb7-2143" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb7-2144"><a href="#cb7-2144" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb7-2145"><a href="#cb7-2145" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-2146"><a href="#cb7-2146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2147"><a href="#cb7-2147" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_grok(<span class="va">self</span>, path: Path):</span>
<span id="cb7-2148"><a href="#cb7-2148" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Processa exporta√ß√£o do Grok&quot;&quot;&quot;</span></span>
<span id="cb7-2149"><a href="#cb7-2149" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb7-2150"><a href="#cb7-2150" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria Grok: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-2151"><a href="#cb7-2151" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-2152"><a href="#cb7-2152" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-2153"><a href="#cb7-2153" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb7-2154"><a href="#cb7-2154" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;grok_&quot;</span>)</span>
<span id="cb7-2155"><a href="#cb7-2155" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb7-2156"><a href="#cb7-2156" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb7-2157"><a href="#cb7-2157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2158"><a href="#cb7-2158" aria-hidden="true" tabindex="-1"></a>            target_file <span class="op">=</span> <span class="va">None</span></span>
<span id="cb7-2159"><a href="#cb7-2159" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> root, _, files <span class="kw">in</span> os.walk(temp_dir):</span>
<span id="cb7-2160"><a href="#cb7-2160" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb7-2161"><a href="#cb7-2161" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">file</span> <span class="op">==</span> <span class="st">&quot;prod-grok-backend.json&quot;</span>:</span>
<span id="cb7-2162"><a href="#cb7-2162" aria-hidden="true" tabindex="-1"></a>                        target_file <span class="op">=</span> Path(root) <span class="op">/</span> <span class="bu">file</span></span>
<span id="cb7-2163"><a href="#cb7-2163" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb7-2164"><a href="#cb7-2164" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> target_file:</span>
<span id="cb7-2165"><a href="#cb7-2165" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb7-2166"><a href="#cb7-2166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2167"><a href="#cb7-2167" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> target_file:</span>
<span id="cb7-2168"><a href="#cb7-2168" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: ficheiro &#39;prod-grok-backend.json&#39; n√£o encontrado no ZIP.&quot;</span>)</span>
<span id="cb7-2169"><a href="#cb7-2169" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb7-2170"><a href="#cb7-2170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2171"><a href="#cb7-2171" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Grok: carregando </span><span class="sc">{</span>target_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb7-2172"><a href="#cb7-2172" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(target_file, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb7-2173"><a href="#cb7-2173" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.load(f)</span>
<span id="cb7-2174"><a href="#cb7-2174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2175"><a href="#cb7-2175" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">dict</span>) <span class="kw">or</span> <span class="st">&#39;conversations&#39;</span> <span class="kw">not</span> <span class="kw">in</span> data:</span>
<span id="cb7-2176"><a href="#cb7-2176" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: estrutura inesperada ‚Äî chave &#39;conversations&#39; n√£o encontrada.&quot;</span>)</span>
<span id="cb7-2177"><a href="#cb7-2177" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb7-2178"><a href="#cb7-2178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2179"><a href="#cb7-2179" aria-hidden="true" tabindex="-1"></a>            conversations_list <span class="op">=</span> data[<span class="st">&#39;conversations&#39;</span>]</span>
<span id="cb7-2180"><a href="#cb7-2180" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conversations_list, <span class="bu">list</span>):</span>
<span id="cb7-2181"><a href="#cb7-2181" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: &#39;conversations&#39; n√£o √© uma lista.&quot;</span>)</span>
<span id="cb7-2182"><a href="#cb7-2182" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb7-2183"><a href="#cb7-2183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2184"><a href="#cb7-2184" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä Grok: encontradas </span><span class="sc">{</span><span class="bu">len</span>(conversations_list)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb7-2185"><a href="#cb7-2185" aria-hidden="true" tabindex="-1"></a>            total_convs <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-2186"><a href="#cb7-2186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2187"><a href="#cb7-2187" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> item <span class="kw">in</span> conversations_list:</span>
<span id="cb7-2188"><a href="#cb7-2188" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(item, <span class="bu">dict</span>):</span>
<span id="cb7-2189"><a href="#cb7-2189" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb7-2190"><a href="#cb7-2190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2191"><a href="#cb7-2191" aria-hidden="true" tabindex="-1"></a>                conv_meta <span class="op">=</span> item.get(<span class="st">&#39;conversation&#39;</span>)</span>
<span id="cb7-2192"><a href="#cb7-2192" aria-hidden="true" tabindex="-1"></a>                responses <span class="op">=</span> item.get(<span class="st">&#39;responses&#39;</span>, [])</span>
<span id="cb7-2193"><a href="#cb7-2193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2194"><a href="#cb7-2194" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conv_meta, <span class="bu">dict</span>) <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(responses, <span class="bu">list</span>) <span class="kw">or</span> <span class="kw">not</span> responses:</span>
<span id="cb7-2195"><a href="#cb7-2195" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb7-2196"><a href="#cb7-2196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2197"><a href="#cb7-2197" aria-hidden="true" tabindex="-1"></a>                conv_id <span class="op">=</span> conv_meta.get(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb7-2198"><a href="#cb7-2198" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> conv_id:</span>
<span id="cb7-2199"><a href="#cb7-2199" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb7-2200"><a href="#cb7-2200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2201"><a href="#cb7-2201" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv_meta.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&quot;Conversa Grok </span><span class="sc">{</span>total_convs <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-2202"><a href="#cb7-2202" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb7-2203"><a href="#cb7-2203" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb7-2204"><a href="#cb7-2204" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2205"><a href="#cb7-2205" aria-hidden="true" tabindex="-1"></a>                create_time_str <span class="op">=</span> conv_meta.get(<span class="st">&#39;create_time&#39;</span>)</span>
<span id="cb7-2206"><a href="#cb7-2206" aria-hidden="true" tabindex="-1"></a>                modify_time_str <span class="op">=</span> conv_meta.get(<span class="st">&#39;modify_time&#39;</span>)</span>
<span id="cb7-2207"><a href="#cb7-2207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2208"><a href="#cb7-2208" aria-hidden="true" tabindex="-1"></a>                <span class="kw">def</span> format_iso_timestamp(ts_str):</span>
<span id="cb7-2209"><a href="#cb7-2209" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> ts_str:</span>
<span id="cb7-2210"><a href="#cb7-2210" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb7-2211"><a href="#cb7-2211" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">try</span>:</span>
<span id="cb7-2212"><a href="#cb7-2212" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="st">&#39;.&#39;</span> <span class="kw">in</span> ts_str:</span>
<span id="cb7-2213"><a href="#cb7-2213" aria-hidden="true" tabindex="-1"></a>                            ts_str <span class="op">=</span> ts_str.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>] <span class="op">+</span> <span class="st">&#39;Z&#39;</span></span>
<span id="cb7-2214"><a href="#cb7-2214" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="va">self</span>.format_timestamp(ts_str)</span>
<span id="cb7-2215"><a href="#cb7-2215" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">except</span>:</span>
<span id="cb7-2216"><a href="#cb7-2216" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="bu">str</span>(ts_str)</span>
<span id="cb7-2217"><a href="#cb7-2217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2218"><a href="#cb7-2218" aria-hidden="true" tabindex="-1"></a>                inserted_at <span class="op">=</span> format_iso_timestamp(create_time_str)</span>
<span id="cb7-2219"><a href="#cb7-2219" aria-hidden="true" tabindex="-1"></a>                updated_at <span class="op">=</span> format_iso_timestamp(modify_time_str)</span>
<span id="cb7-2220"><a href="#cb7-2220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2221"><a href="#cb7-2221" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb7-2222"><a href="#cb7-2222" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> resp <span class="kw">in</span> responses:</span>
<span id="cb7-2223"><a href="#cb7-2223" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(resp, <span class="bu">dict</span>):</span>
<span id="cb7-2224"><a href="#cb7-2224" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb7-2225"><a href="#cb7-2225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2226"><a href="#cb7-2226" aria-hidden="true" tabindex="-1"></a>                    resp_data <span class="op">=</span> resp.get(<span class="st">&#39;response&#39;</span>)</span>
<span id="cb7-2227"><a href="#cb7-2227" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(resp_data, <span class="bu">dict</span>):</span>
<span id="cb7-2228"><a href="#cb7-2228" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb7-2229"><a href="#cb7-2229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2230"><a href="#cb7-2230" aria-hidden="true" tabindex="-1"></a>                    sender <span class="op">=</span> resp_data.get(<span class="st">&#39;sender&#39;</span>, <span class="st">&#39;&#39;</span>).upper()</span>
<span id="cb7-2231"><a href="#cb7-2231" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> sender <span class="op">==</span> <span class="st">&#39;HUMAN&#39;</span>:</span>
<span id="cb7-2232"><a href="#cb7-2232" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb7-2233"><a href="#cb7-2233" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&quot;user&quot;</span></span>
<span id="cb7-2234"><a href="#cb7-2234" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> sender <span class="op">==</span> <span class="st">&#39;ASSISTANT&#39;</span>:</span>
<span id="cb7-2235"><a href="#cb7-2235" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ Grok&quot;</span></span>
<span id="cb7-2236"><a href="#cb7-2236" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&quot;assistant&quot;</span></span>
<span id="cb7-2237"><a href="#cb7-2237" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb7-2238"><a href="#cb7-2238" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb7-2239"><a href="#cb7-2239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2240"><a href="#cb7-2240" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="bu">str</span>(resp_data.get(<span class="st">&#39;message&#39;</span>, <span class="st">&#39;&#39;</span>)).strip()</span>
<span id="cb7-2241"><a href="#cb7-2241" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-2242"><a href="#cb7-2242" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb7-2243"><a href="#cb7-2243" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-2244"><a href="#cb7-2244" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb7-2245"><a href="#cb7-2245" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb7-2246"><a href="#cb7-2246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2247"><a href="#cb7-2247" aria-hidden="true" tabindex="-1"></a>                    create_time <span class="op">=</span> resp_data.get(<span class="st">&#39;create_time&#39;</span>)</span>
<span id="cb7-2248"><a href="#cb7-2248" aria-hidden="true" tabindex="-1"></a>                    timestamp_ms <span class="op">=</span> <span class="va">None</span></span>
<span id="cb7-2249"><a href="#cb7-2249" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(create_time, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;$date&#39;</span> <span class="kw">in</span> create_time:</span>
<span id="cb7-2250"><a href="#cb7-2250" aria-hidden="true" tabindex="-1"></a>                        date_obj <span class="op">=</span> create_time[<span class="st">&#39;$date&#39;</span>]</span>
<span id="cb7-2251"><a href="#cb7-2251" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(date_obj, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;$numberLong&#39;</span> <span class="kw">in</span> date_obj:</span>
<span id="cb7-2252"><a href="#cb7-2252" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">try</span>:</span>
<span id="cb7-2253"><a href="#cb7-2253" aria-hidden="true" tabindex="-1"></a>                                timestamp_ms <span class="op">=</span> <span class="bu">int</span>(date_obj[<span class="st">&#39;$numberLong&#39;</span>])</span>
<span id="cb7-2254"><a href="#cb7-2254" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">except</span>:</span>
<span id="cb7-2255"><a href="#cb7-2255" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">pass</span></span>
<span id="cb7-2256"><a href="#cb7-2256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2257"><a href="#cb7-2257" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb7-2258"><a href="#cb7-2258" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb7-2259"><a href="#cb7-2259" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb7-2260"><a href="#cb7-2260" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb7-2261"><a href="#cb7-2261" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(timestamp_ms <span class="op">/</span> <span class="fl">1000.0</span> <span class="cf">if</span> timestamp_ms <span class="cf">else</span> <span class="va">None</span>),</span>
<span id="cb7-2262"><a href="#cb7-2262" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: <span class="st">&#39;Grok&#39;</span></span>
<span id="cb7-2263"><a href="#cb7-2263" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb7-2264"><a href="#cb7-2264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2265"><a href="#cb7-2265" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb7-2266"><a href="#cb7-2266" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb7-2267"><a href="#cb7-2267" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb7-2268"><a href="#cb7-2268" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;Grok&#39;</span>,</span>
<span id="cb7-2269"><a href="#cb7-2269" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv_id,</span>
<span id="cb7-2270"><a href="#cb7-2270" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: inserted_at,</span>
<span id="cb7-2271"><a href="#cb7-2271" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: updated_at,</span>
<span id="cb7-2272"><a href="#cb7-2272" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb7-2273"><a href="#cb7-2273" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb7-2274"><a href="#cb7-2274" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb7-2275"><a href="#cb7-2275" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb7-2276"><a href="#cb7-2276" aria-hidden="true" tabindex="-1"></a>                    total_convs <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-2277"><a href="#cb7-2277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2278"><a href="#cb7-2278" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> total_convs <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb7-2279"><a href="#cb7-2279" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Grok: processadas </span><span class="sc">{</span>total_convs<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb7-2280"><a href="#cb7-2280" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb7-2281"><a href="#cb7-2281" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: nenhuma conversa v√°lida encontrada.&quot;</span>)</span>
<span id="cb7-2282"><a href="#cb7-2282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2283"><a href="#cb7-2283" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-2284"><a href="#cb7-2284" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar Grok: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-2285"><a href="#cb7-2285" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb7-2286"><a href="#cb7-2286" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb7-2287"><a href="#cb7-2287" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb7-2288"><a href="#cb7-2288" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb7-2289"><a href="#cb7-2289" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-2290"><a href="#cb7-2290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2291"><a href="#cb7-2291" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_markdown_enhanced(<span class="va">self</span>):</span>
<span id="cb7-2292"><a href="#cb7-2292" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Salva conversas com preserva√ß√£o total de formata√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb7-2293"><a href="#cb7-2293" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb7-2294"><a href="#cb7-2294" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] Markdowns seriam criados:&quot;</span>)</span>
<span id="cb7-2295"><a href="#cb7-2295" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb7-2296"><a href="#cb7-2296" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb7-2297"><a href="#cb7-2297" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.md&quot;</span></span>
<span id="cb7-2298"><a href="#cb7-2298" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÑ </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-2299"><a href="#cb7-2299" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-2300"><a href="#cb7-2300" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-2301"><a href="#cb7-2301" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;markdown&#39;</span>])</span>
<span id="cb7-2302"><a href="#cb7-2302" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-2303"><a href="#cb7-2303" aria-hidden="true" tabindex="-1"></a>        failed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-2304"><a href="#cb7-2304" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-2305"><a href="#cb7-2305" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb7-2306"><a href="#cb7-2306" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb7-2307"><a href="#cb7-2307" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb7-2308"><a href="#cb7-2308" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.md&quot;</span></span>
<span id="cb7-2309"><a href="#cb7-2309" aria-hidden="true" tabindex="-1"></a>                filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb7-2310"><a href="#cb7-2310" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2311"><a href="#cb7-2311" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb7-2312"><a href="#cb7-2312" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb7-2313"><a href="#cb7-2313" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb7-2314"><a href="#cb7-2314" aria-hidden="true" tabindex="-1"></a>                markdown_content <span class="op">=</span> <span class="va">self</span>.create_enhanced_markdown_content(conv)</span>
<span id="cb7-2315"><a href="#cb7-2315" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2316"><a href="#cb7-2316" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb7-2317"><a href="#cb7-2317" aria-hidden="true" tabindex="-1"></a>                    f.write(markdown_content)</span>
<span id="cb7-2318"><a href="#cb7-2318" aria-hidden="true" tabindex="-1"></a>                saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-2319"><a href="#cb7-2319" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2320"><a href="#cb7-2320" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-2321"><a href="#cb7-2321" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao salvar conversa </span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-2322"><a href="#cb7-2322" aria-hidden="true" tabindex="-1"></a>                failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-2323"><a href="#cb7-2323" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb7-2324"><a href="#cb7-2324" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2325"><a href="#cb7-2325" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Markdown: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados, </span><span class="sc">{</span>failed_count<span class="sc">}</span><span class="ss"> falhas em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb7-2326"><a href="#cb7-2326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2327"><a href="#cb7-2327" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_csv(<span class="va">self</span>):</span>
<span id="cb7-2328"><a href="#cb7-2328" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Salva conversas em arquivos CSV individuais&quot;&quot;&quot;</span></span>
<span id="cb7-2329"><a href="#cb7-2329" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb7-2330"><a href="#cb7-2330" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] CSVs seriam criados:&quot;</span>)</span>
<span id="cb7-2331"><a href="#cb7-2331" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb7-2332"><a href="#cb7-2332" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb7-2333"><a href="#cb7-2333" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.csv&quot;</span></span>
<span id="cb7-2334"><a href="#cb7-2334" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìä </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-2335"><a href="#cb7-2335" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-2336"><a href="#cb7-2336" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-2337"><a href="#cb7-2337" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;csv&#39;</span>])</span>
<span id="cb7-2338"><a href="#cb7-2338" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-2339"><a href="#cb7-2339" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-2340"><a href="#cb7-2340" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb7-2341"><a href="#cb7-2341" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb7-2342"><a href="#cb7-2342" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.csv&quot;</span></span>
<span id="cb7-2343"><a href="#cb7-2343" aria-hidden="true" tabindex="-1"></a>            filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb7-2344"><a href="#cb7-2344" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-2345"><a href="#cb7-2345" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb7-2346"><a href="#cb7-2346" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb7-2347"><a href="#cb7-2347" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2348"><a href="#cb7-2348" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb7-2349"><a href="#cb7-2349" aria-hidden="true" tabindex="-1"></a>                writer <span class="op">=</span> csv.DictWriter(f, fieldnames<span class="op">=</span>[</span>
<span id="cb7-2350"><a href="#cb7-2350" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;node_id&#39;</span>, <span class="st">&#39;author&#39;</span>, <span class="st">&#39;role&#39;</span>, <span class="st">&#39;timestamp&#39;</span>, <span class="st">&#39;model&#39;</span>, <span class="st">&#39;content&#39;</span></span>
<span id="cb7-2351"><a href="#cb7-2351" aria-hidden="true" tabindex="-1"></a>                ])</span>
<span id="cb7-2352"><a href="#cb7-2352" aria-hidden="true" tabindex="-1"></a>                writer.writeheader()</span>
<span id="cb7-2353"><a href="#cb7-2353" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i, msg <span class="kw">in</span> <span class="bu">enumerate</span>(conv[<span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb7-2354"><a href="#cb7-2354" aria-hidden="true" tabindex="-1"></a>                    writer.writerow({</span>
<span id="cb7-2355"><a href="#cb7-2355" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;node_id&#39;</span>: <span class="bu">str</span>(i),</span>
<span id="cb7-2356"><a href="#cb7-2356" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: msg[<span class="st">&#39;author&#39;</span>],</span>
<span id="cb7-2357"><a href="#cb7-2357" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: msg[<span class="st">&#39;role&#39;</span>],</span>
<span id="cb7-2358"><a href="#cb7-2358" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: msg[<span class="st">&#39;timestamp&#39;</span>],</span>
<span id="cb7-2359"><a href="#cb7-2359" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg[<span class="st">&#39;model&#39;</span>],</span>
<span id="cb7-2360"><a href="#cb7-2360" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: msg[<span class="st">&#39;content&#39;</span>]</span>
<span id="cb7-2361"><a href="#cb7-2361" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb7-2362"><a href="#cb7-2362" aria-hidden="true" tabindex="-1"></a>            saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-2363"><a href="#cb7-2363" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-2364"><a href="#cb7-2364" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ CSV: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb7-2365"><a href="#cb7-2365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2366"><a href="#cb7-2366" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_json(<span class="va">self</span>):</span>
<span id="cb7-2367"><a href="#cb7-2367" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Salva conversas em arquivos JSON individuais&quot;&quot;&quot;</span></span>
<span id="cb7-2368"><a href="#cb7-2368" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb7-2369"><a href="#cb7-2369" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] JSONs seriam criados:&quot;</span>)</span>
<span id="cb7-2370"><a href="#cb7-2370" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb7-2371"><a href="#cb7-2371" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb7-2372"><a href="#cb7-2372" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.json&quot;</span></span>
<span id="cb7-2373"><a href="#cb7-2373" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìã </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-2374"><a href="#cb7-2374" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-2375"><a href="#cb7-2375" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-2376"><a href="#cb7-2376" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;json&#39;</span>])</span>
<span id="cb7-2377"><a href="#cb7-2377" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-2378"><a href="#cb7-2378" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-2379"><a href="#cb7-2379" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb7-2380"><a href="#cb7-2380" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb7-2381"><a href="#cb7-2381" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.json&quot;</span></span>
<span id="cb7-2382"><a href="#cb7-2382" aria-hidden="true" tabindex="-1"></a>            filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb7-2383"><a href="#cb7-2383" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-2384"><a href="#cb7-2384" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb7-2385"><a href="#cb7-2385" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb7-2386"><a href="#cb7-2386" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2387"><a href="#cb7-2387" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb7-2388"><a href="#cb7-2388" aria-hidden="true" tabindex="-1"></a>                json.dump(conv, f, ensure_ascii<span class="op">=</span><span class="va">False</span>, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb7-2389"><a href="#cb7-2389" aria-hidden="true" tabindex="-1"></a>            saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-2390"><a href="#cb7-2390" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-2391"><a href="#cb7-2391" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ JSON: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb7-2392"><a href="#cb7-2392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2393"><a href="#cb7-2393" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_all_to_single_files(<span class="va">self</span>):</span>
<span id="cb7-2394"><a href="#cb7-2394" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Salva todas as conversas em arquivos √∫nicos CSV e JSON&quot;&quot;&quot;</span></span>
<span id="cb7-2395"><a href="#cb7-2395" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb7-2396"><a href="#cb7-2396" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] Arquivos √∫nicos seriam criados:&quot;</span>)</span>
<span id="cb7-2397"><a href="#cb7-2397" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÅ </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;csv&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-2398"><a href="#cb7-2398" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÅ </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;json&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-2399"><a href="#cb7-2399" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-2400"><a href="#cb7-2400" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-2401"><a href="#cb7-2401" aria-hidden="true" tabindex="-1"></a>        <span class="co"># CSV √∫nico</span></span>
<span id="cb7-2402"><a href="#cb7-2402" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.single_files[<span class="st">&#39;csv&#39;</span>], <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb7-2403"><a href="#cb7-2403" aria-hidden="true" tabindex="-1"></a>            fieldnames <span class="op">=</span> [</span>
<span id="cb7-2404"><a href="#cb7-2404" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;conversation_number&#39;</span>, <span class="st">&#39;source&#39;</span>, <span class="st">&#39;conversation_title&#39;</span>, <span class="st">&#39;category&#39;</span>,</span>
<span id="cb7-2405"><a href="#cb7-2405" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;author&#39;</span>, <span class="st">&#39;role&#39;</span>, <span class="st">&#39;timestamp&#39;</span>, <span class="st">&#39;model&#39;</span>, <span class="st">&#39;content&#39;</span></span>
<span id="cb7-2406"><a href="#cb7-2406" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb7-2407"><a href="#cb7-2407" aria-hidden="true" tabindex="-1"></a>            writer <span class="op">=</span> csv.DictWriter(f, fieldnames<span class="op">=</span>fieldnames)</span>
<span id="cb7-2408"><a href="#cb7-2408" aria-hidden="true" tabindex="-1"></a>            writer.writeheader()</span>
<span id="cb7-2409"><a href="#cb7-2409" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb7-2410"><a href="#cb7-2410" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> msg <span class="kw">in</span> conv[<span class="st">&#39;messages&#39;</span>]:</span>
<span id="cb7-2411"><a href="#cb7-2411" aria-hidden="true" tabindex="-1"></a>                    writer.writerow({</span>
<span id="cb7-2412"><a href="#cb7-2412" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;conversation_number&#39;</span>: conv[<span class="st">&#39;number&#39;</span>],</span>
<span id="cb7-2413"><a href="#cb7-2413" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: conv[<span class="st">&#39;source&#39;</span>],</span>
<span id="cb7-2414"><a href="#cb7-2414" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;conversation_title&#39;</span>: conv[<span class="st">&#39;title&#39;</span>],</span>
<span id="cb7-2415"><a href="#cb7-2415" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: conv[<span class="st">&#39;category&#39;</span>],</span>
<span id="cb7-2416"><a href="#cb7-2416" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: msg[<span class="st">&#39;author&#39;</span>],</span>
<span id="cb7-2417"><a href="#cb7-2417" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: msg[<span class="st">&#39;role&#39;</span>],</span>
<span id="cb7-2418"><a href="#cb7-2418" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: msg[<span class="st">&#39;timestamp&#39;</span>],</span>
<span id="cb7-2419"><a href="#cb7-2419" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg[<span class="st">&#39;model&#39;</span>],</span>
<span id="cb7-2420"><a href="#cb7-2420" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: msg[<span class="st">&#39;content&#39;</span>]</span>
<span id="cb7-2421"><a href="#cb7-2421" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb7-2422"><a href="#cb7-2422" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ CSV √∫nico: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;csv&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-2423"><a href="#cb7-2423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2424"><a href="#cb7-2424" aria-hidden="true" tabindex="-1"></a>        <span class="co"># JSON √∫nico</span></span>
<span id="cb7-2425"><a href="#cb7-2425" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.single_files[<span class="st">&#39;json&#39;</span>], <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb7-2426"><a href="#cb7-2426" aria-hidden="true" tabindex="-1"></a>            json.dump(<span class="va">self</span>.all_conversations, f, ensure_ascii<span class="op">=</span><span class="va">False</span>, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb7-2427"><a href="#cb7-2427" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ JSON √∫nico: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;json&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-2428"><a href="#cb7-2428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2429"><a href="#cb7-2429" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_searchable_index(<span class="va">self</span>):</span>
<span id="cb7-2430"><a href="#cb7-2430" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&quot;&quot;Cria √≠ndice HTML pesquis√°vel com links para HTML&quot;&quot;&quot;</span></span>
<span id="cb7-2431"><a href="#cb7-2431" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb7-2432"><a href="#cb7-2432" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] √çndice HTML seria criado: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-2433"><a href="#cb7-2433" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-2434"><a href="#cb7-2434" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-2435"><a href="#cb7-2435" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;üéØ Criando √≠ndice HTML combinado...&quot;</span>)</span>
<span id="cb7-2436"><a href="#cb7-2436" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-2437"><a href="#cb7-2437" aria-hidden="true" tabindex="-1"></a>        category_stats <span class="op">=</span> {}</span>
<span id="cb7-2438"><a href="#cb7-2438" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb7-2439"><a href="#cb7-2439" aria-hidden="true" tabindex="-1"></a>            cat <span class="op">=</span> conv[<span class="st">&#39;category&#39;</span>]</span>
<span id="cb7-2440"><a href="#cb7-2440" aria-hidden="true" tabindex="-1"></a>            category_stats[cat] <span class="op">=</span> category_stats.get(cat, <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb7-2441"><a href="#cb7-2441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2442"><a href="#cb7-2442" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb7-2443"><a href="#cb7-2443" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html lang=&quot;pt-PT&quot;&gt;</span></span>
<span id="cb7-2444"><a href="#cb7-2444" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb7-2445"><a href="#cb7-2445" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb7-2446"><a href="#cb7-2446" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb7-2447"><a href="#cb7-2447" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;√çndice Combinado - AI Chats&lt;/title&gt;</span></span>
<span id="cb7-2448"><a href="#cb7-2448" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb7-2449"><a href="#cb7-2449" aria-hidden="true" tabindex="-1"></a><span class="ss">        * </span><span class="ch">{{</span><span class="ss"> margin: 0; padding: 0; box-sizing: border-box; </span><span class="ch">}}</span></span>
<span id="cb7-2450"><a href="#cb7-2450" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span><span class="ss"> font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; color: #333; </span><span class="ch">}}</span></span>
<span id="cb7-2451"><a href="#cb7-2451" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span><span class="ss"> max-width: 1400px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; </span><span class="ch">}}</span></span>
<span id="cb7-2452"><a href="#cb7-2452" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header </span><span class="ch">{{</span><span class="ss"> background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; text-align: center; </span><span class="ch">}}</span></span>
<span id="cb7-2453"><a href="#cb7-2453" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header h1 </span><span class="ch">{{</span><span class="ss"> font-size: 2.8em; margin-bottom: 15px; font-weight: 300; </span><span class="ch">}}</span></span>
<span id="cb7-2454"><a href="#cb7-2454" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header p </span><span class="ch">{{</span><span class="ss"> font-size: 1.2em; opacity: 0.9; margin-bottom: 20px; </span><span class="ch">}}</span></span>
<span id="cb7-2455"><a href="#cb7-2455" aria-hidden="true" tabindex="-1"></a><span class="ss">        .stats </span><span class="ch">{{</span><span class="ss"> display: flex; justify-content: center; gap: 30px; margin-top: 25px; flex-wrap: wrap; </span><span class="ch">}}</span></span>
<span id="cb7-2456"><a href="#cb7-2456" aria-hidden="true" tabindex="-1"></a><span class="ss">        .stat-item </span><span class="ch">{{</span><span class="ss"> background: rgba(255,255,255,0.15); padding: 18px 28px; border-radius: 12px; backdrop-filter: blur(10px); font-size: 1.1em; </span><span class="ch">}}</span></span>
<span id="cb7-2457"><a href="#cb7-2457" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-section </span><span class="ch">{{</span><span class="ss"> padding: 30px; background: #f8f9fa; border-bottom: 1px solid #e9ecef; </span><span class="ch">}}</span></span>
<span id="cb7-2458"><a href="#cb7-2458" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-box </span><span class="ch">{{</span><span class="ss"> width: 100%; padding: 18px 25px; font-size: 16px; border: 2px solid #e9ecef; border-radius: 25px; outline: none; transition: all 0.3s ease; font-family: inherit; </span><span class="ch">}}</span></span>
<span id="cb7-2459"><a href="#cb7-2459" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-box:focus </span><span class="ch">{{</span><span class="ss"> border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); </span><span class="ch">}}</span></span>
<span id="cb7-2460"><a href="#cb7-2460" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-section </span><span class="ch">{{</span></span>
<span id="cb7-2461"><a href="#cb7-2461" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px 30px;</span></span>
<span id="cb7-2462"><a href="#cb7-2462" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb7-2463"><a href="#cb7-2463" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb7-2464"><a href="#cb7-2464" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 12px;</span></span>
<span id="cb7-2465"><a href="#cb7-2465" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: center;</span></span>
<span id="cb7-2466"><a href="#cb7-2466" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb7-2467"><a href="#cb7-2467" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 1px solid #e9ecef;</span></span>
<span id="cb7-2468"><a href="#cb7-2468" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2469"><a href="#cb7-2469" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-btn </span><span class="ch">{{</span></span>
<span id="cb7-2470"><a href="#cb7-2470" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 10px 20px;</span></span>
<span id="cb7-2471"><a href="#cb7-2471" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb7-2472"><a href="#cb7-2472" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 2px solid #e9ecef;</span></span>
<span id="cb7-2473"><a href="#cb7-2473" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 25px;</span></span>
<span id="cb7-2474"><a href="#cb7-2474" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb7-2475"><a href="#cb7-2475" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.95em;</span></span>
<span id="cb7-2476"><a href="#cb7-2476" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb7-2477"><a href="#cb7-2477" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.3s ease;</span></span>
<span id="cb7-2478"><a href="#cb7-2478" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: inherit;</span></span>
<span id="cb7-2479"><a href="#cb7-2479" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2480"><a href="#cb7-2480" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-btn.active, .filter-btn:hover </span><span class="ch">{{</span></span>
<span id="cb7-2481"><a href="#cb7-2481" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #667eea;</span></span>
<span id="cb7-2482"><a href="#cb7-2482" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb7-2483"><a href="#cb7-2483" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb7-2484"><a href="#cb7-2484" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: translateY(-2px);</span></span>
<span id="cb7-2485"><a href="#cb7-2485" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);</span></span>
<span id="cb7-2486"><a href="#cb7-2486" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2487"><a href="#cb7-2487" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversations-grid </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-2488"><a href="#cb7-2488" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: grid; </span></span>
<span id="cb7-2489"><a href="#cb7-2489" aria-hidden="true" tabindex="-1"></a><span class="ss">            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); </span></span>
<span id="cb7-2490"><a href="#cb7-2490" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 25px; </span></span>
<span id="cb7-2491"><a href="#cb7-2491" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 35px;</span></span>
<span id="cb7-2492"><a href="#cb7-2492" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);</span></span>
<span id="cb7-2493"><a href="#cb7-2493" aria-hidden="true" tabindex="-1"></a><span class="ss">            min-height: 400px;</span></span>
<span id="cb7-2494"><a href="#cb7-2494" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2495"><a href="#cb7-2495" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-2496"><a href="#cb7-2496" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white; </span></span>
<span id="cb7-2497"><a href="#cb7-2497" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #e9ecef; </span></span>
<span id="cb7-2498"><a href="#cb7-2498" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 15px; </span></span>
<span id="cb7-2499"><a href="#cb7-2499" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 25px; </span></span>
<span id="cb7-2500"><a href="#cb7-2500" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.4s ease; </span></span>
<span id="cb7-2501"><a href="#cb7-2501" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer; </span></span>
<span id="cb7-2502"><a href="#cb7-2502" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: relative;</span></span>
<span id="cb7-2503"><a href="#cb7-2503" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 15px rgba(0,0,0,0.08);</span></span>
<span id="cb7-2504"><a href="#cb7-2504" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2505"><a href="#cb7-2505" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card:hover </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-2506"><a href="#cb7-2506" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: translateY(-8px); </span></span>
<span id="cb7-2507"><a href="#cb7-2507" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 15px 35px rgba(0,0,0,0.15); </span></span>
<span id="cb7-2508"><a href="#cb7-2508" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb7-2509"><a href="#cb7-2509" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2510"><a href="#cb7-2510" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-header </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-2511"><a href="#cb7-2511" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb7-2512"><a href="#cb7-2512" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between; </span></span>
<span id="cb7-2513"><a href="#cb7-2513" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: flex-start; </span></span>
<span id="cb7-2514"><a href="#cb7-2514" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 18px; </span></span>
<span id="cb7-2515"><a href="#cb7-2515" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2516"><a href="#cb7-2516" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-number </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-2517"><a href="#cb7-2517" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #667eea, #764ba2); </span></span>
<span id="cb7-2518"><a href="#cb7-2518" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb7-2519"><a href="#cb7-2519" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 8px 16px; </span></span>
<span id="cb7-2520"><a href="#cb7-2520" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 20px; </span></span>
<span id="cb7-2521"><a href="#cb7-2521" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em; </span></span>
<span id="cb7-2522"><a href="#cb7-2522" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb7-2523"><a href="#cb7-2523" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);</span></span>
<span id="cb7-2524"><a href="#cb7-2524" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2525"><a href="#cb7-2525" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-source </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-2526"><a href="#cb7-2526" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e3f2fd; </span></span>
<span id="cb7-2527"><a href="#cb7-2527" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #1976d2; </span></span>
<span id="cb7-2528"><a href="#cb7-2528" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 5px 12px; </span></span>
<span id="cb7-2529"><a href="#cb7-2529" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px; </span></span>
<span id="cb7-2530"><a href="#cb7-2530" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.85em; </span></span>
<span id="cb7-2531"><a href="#cb7-2531" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold; </span></span>
<span id="cb7-2532"><a href="#cb7-2532" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 10px;</span></span>
<span id="cb7-2533"><a href="#cb7-2533" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2534"><a href="#cb7-2534" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-title </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-2535"><a href="#cb7-2535" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.3em; </span></span>
<span id="cb7-2536"><a href="#cb7-2536" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 600; </span></span>
<span id="cb7-2537"><a href="#cb7-2537" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50; </span></span>
<span id="cb7-2538"><a href="#cb7-2538" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 12px; </span></span>
<span id="cb7-2539"><a href="#cb7-2539" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.4;</span></span>
<span id="cb7-2540"><a href="#cb7-2540" aria-hidden="true" tabindex="-1"></a><span class="ss">            min-height: 3.6em;</span></span>
<span id="cb7-2541"><a href="#cb7-2541" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb7-2542"><a href="#cb7-2542" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2543"><a href="#cb7-2543" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-summary </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-2544"><a href="#cb7-2544" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #6c757d; </span></span>
<span id="cb7-2545"><a href="#cb7-2545" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.95em; </span></span>
<span id="cb7-2546"><a href="#cb7-2546" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.5; </span></span>
<span id="cb7-2547"><a href="#cb7-2547" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 18px;</span></span>
<span id="cb7-2548"><a href="#cb7-2548" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: -webkit-box;</span></span>
<span id="cb7-2549"><a href="#cb7-2549" aria-hidden="true" tabindex="-1"></a><span class="ss">            -webkit-line-clamp: 3;</span></span>
<span id="cb7-2550"><a href="#cb7-2550" aria-hidden="true" tabindex="-1"></a><span class="ss">            -webkit-box-orient: vertical;</span></span>
<span id="cb7-2551"><a href="#cb7-2551" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb7-2552"><a href="#cb7-2552" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb7-2553"><a href="#cb7-2553" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2554"><a href="#cb7-2554" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-meta </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-2555"><a href="#cb7-2555" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb7-2556"><a href="#cb7-2556" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between; </span></span>
<span id="cb7-2557"><a href="#cb7-2557" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.85em; </span></span>
<span id="cb7-2558"><a href="#cb7-2558" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #868e96; </span></span>
<span id="cb7-2559"><a href="#cb7-2559" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-top: 1px solid #e9ecef; </span></span>
<span id="cb7-2560"><a href="#cb7-2560" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-top: 18px;</span></span>
<span id="cb7-2561"><a href="#cb7-2561" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2562"><a href="#cb7-2562" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-actions </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-2563"><a href="#cb7-2563" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: absolute; </span></span>
<span id="cb7-2564"><a href="#cb7-2564" aria-hidden="true" tabindex="-1"></a><span class="ss">            top: 20px; </span></span>
<span id="cb7-2565"><a href="#cb7-2565" aria-hidden="true" tabindex="-1"></a><span class="ss">            right: 20px; </span></span>
<span id="cb7-2566"><a href="#cb7-2566" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb7-2567"><a href="#cb7-2567" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 8px; </span></span>
<span id="cb7-2568"><a href="#cb7-2568" aria-hidden="true" tabindex="-1"></a><span class="ss">            opacity: 0; </span></span>
<span id="cb7-2569"><a href="#cb7-2569" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: opacity 0.3s ease; </span></span>
<span id="cb7-2570"><a href="#cb7-2570" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2571"><a href="#cb7-2571" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card:hover .card-actions </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-2572"><a href="#cb7-2572" aria-hidden="true" tabindex="-1"></a><span class="ss">            opacity: 1; </span></span>
<span id="cb7-2573"><a href="#cb7-2573" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2574"><a href="#cb7-2574" aria-hidden="true" tabindex="-1"></a><span class="ss">        .action-btn </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-2575"><a href="#cb7-2575" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white; </span></span>
<span id="cb7-2576"><a href="#cb7-2576" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 2px solid #e9ecef; </span></span>
<span id="cb7-2577"><a href="#cb7-2577" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px; </span></span>
<span id="cb7-2578"><a href="#cb7-2578" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 6px 12px; </span></span>
<span id="cb7-2579"><a href="#cb7-2579" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.8em; </span></span>
<span id="cb7-2580"><a href="#cb7-2580" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer; </span></span>
<span id="cb7-2581"><a href="#cb7-2581" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.3s ease;</span></span>
<span id="cb7-2582"><a href="#cb7-2582" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb7-2583"><a href="#cb7-2583" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb7-2584"><a href="#cb7-2584" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333;</span></span>
<span id="cb7-2585"><a href="#cb7-2585" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb7-2586"><a href="#cb7-2586" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2587"><a href="#cb7-2587" aria-hidden="true" tabindex="-1"></a><span class="ss">        .action-btn:hover </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-2588"><a href="#cb7-2588" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #667eea; </span></span>
<span id="cb7-2589"><a href="#cb7-2589" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb7-2590"><a href="#cb7-2590" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb7-2591"><a href="#cb7-2591" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: scale(1.05);</span></span>
<span id="cb7-2592"><a href="#cb7-2592" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2593"><a href="#cb7-2593" aria-hidden="true" tabindex="-1"></a><span class="ss">        .recent-badge </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-2594"><a href="#cb7-2594" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #ff6b6b; </span></span>
<span id="cb7-2595"><a href="#cb7-2595" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb7-2596"><a href="#cb7-2596" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 3px 10px; </span></span>
<span id="cb7-2597"><a href="#cb7-2597" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px; </span></span>
<span id="cb7-2598"><a href="#cb7-2598" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.75em; </span></span>
<span id="cb7-2599"><a href="#cb7-2599" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 8px;</span></span>
<span id="cb7-2600"><a href="#cb7-2600" aria-hidden="true" tabindex="-1"></a><span class="ss">            animation: pulse 2s infinite;</span></span>
<span id="cb7-2601"><a href="#cb7-2601" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2602"><a href="#cb7-2602" aria-hidden="true" tabindex="-1"></a><span class="ss">        .no-results </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb7-2603"><a href="#cb7-2603" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center; </span></span>
<span id="cb7-2604"><a href="#cb7-2604" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 60px 20px; </span></span>
<span id="cb7-2605"><a href="#cb7-2605" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #6c757d;</span></span>
<span id="cb7-2606"><a href="#cb7-2606" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.1em;</span></span>
<span id="cb7-2607"><a href="#cb7-2607" aria-hidden="true" tabindex="-1"></a><span class="ss">            grid-column: 1 / -1;</span></span>
<span id="cb7-2608"><a href="#cb7-2608" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2609"><a href="#cb7-2609" aria-hidden="true" tabindex="-1"></a><span class="ss">        @keyframes pulse </span><span class="ch">{{</span></span>
<span id="cb7-2610"><a href="#cb7-2610" aria-hidden="true" tabindex="-1"></a><span class="ss">            0% </span><span class="ch">{{</span><span class="ss"> transform: scale(1); </span><span class="ch">}}</span></span>
<span id="cb7-2611"><a href="#cb7-2611" aria-hidden="true" tabindex="-1"></a><span class="ss">            50% </span><span class="ch">{{</span><span class="ss"> transform: scale(1.05); </span><span class="ch">}}</span></span>
<span id="cb7-2612"><a href="#cb7-2612" aria-hidden="true" tabindex="-1"></a><span class="ss">            100% </span><span class="ch">{{</span><span class="ss"> transform: scale(1); </span><span class="ch">}}</span></span>
<span id="cb7-2613"><a href="#cb7-2613" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2614"><a href="#cb7-2614" aria-hidden="true" tabindex="-1"></a><span class="ss">        .category-badge </span><span class="ch">{{</span></span>
<span id="cb7-2615"><a href="#cb7-2615" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb7-2616"><a href="#cb7-2616" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e3f2fd;</span></span>
<span id="cb7-2617"><a href="#cb7-2617" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #1976d2;</span></span>
<span id="cb7-2618"><a href="#cb7-2618" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 10px;</span></span>
<span id="cb7-2619"><a href="#cb7-2619" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px;</span></span>
<span id="cb7-2620"><a href="#cb7-2620" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.8em;</span></span>
<span id="cb7-2621"><a href="#cb7-2621" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 8px;</span></span>
<span id="cb7-2622"><a href="#cb7-2622" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb7-2623"><a href="#cb7-2623" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2624"><a href="#cb7-2624" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb7-2625"><a href="#cb7-2625" aria-hidden="true" tabindex="-1"></a><span class="ss">        .direct-link </span><span class="ch">{{</span></span>
<span id="cb7-2626"><a href="#cb7-2626" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb7-2627"><a href="#cb7-2627" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 5px;</span></span>
<span id="cb7-2628"><a href="#cb7-2628" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 8px 15px;</span></span>
<span id="cb7-2629"><a href="#cb7-2629" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #28a745;</span></span>
<span id="cb7-2630"><a href="#cb7-2630" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb7-2631"><a href="#cb7-2631" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb7-2632"><a href="#cb7-2632" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 5px;</span></span>
<span id="cb7-2633"><a href="#cb7-2633" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb7-2634"><a href="#cb7-2634" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2635"><a href="#cb7-2635" aria-hidden="true" tabindex="-1"></a><span class="ss">        .direct-link:hover </span><span class="ch">{{</span></span>
<span id="cb7-2636"><a href="#cb7-2636" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #218838;</span></span>
<span id="cb7-2637"><a href="#cb7-2637" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2638"><a href="#cb7-2638" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb7-2639"><a href="#cb7-2639" aria-hidden="true" tabindex="-1"></a><span class="ss">        .html-btn </span><span class="ch">{{</span></span>
<span id="cb7-2640"><a href="#cb7-2640" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #17a2b8;</span></span>
<span id="cb7-2641"><a href="#cb7-2641" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb7-2642"><a href="#cb7-2642" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2643"><a href="#cb7-2643" aria-hidden="true" tabindex="-1"></a><span class="ss">        .html-btn:hover </span><span class="ch">{{</span></span>
<span id="cb7-2644"><a href="#cb7-2644" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #138496;</span></span>
<span id="cb7-2645"><a href="#cb7-2645" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2646"><a href="#cb7-2646" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb7-2647"><a href="#cb7-2647" aria-hidden="true" tabindex="-1"></a><span class="ss">        .pdf-btn </span><span class="ch">{{</span></span>
<span id="cb7-2648"><a href="#cb7-2648" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #dc3545;</span></span>
<span id="cb7-2649"><a href="#cb7-2649" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb7-2650"><a href="#cb7-2650" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2651"><a href="#cb7-2651" aria-hidden="true" tabindex="-1"></a><span class="ss">        .pdf-btn:hover </span><span class="ch">{{</span></span>
<span id="cb7-2652"><a href="#cb7-2652" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #c82333;</span></span>
<span id="cb7-2653"><a href="#cb7-2653" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb7-2654"><a href="#cb7-2654" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb7-2655"><a href="#cb7-2655" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb7-2656"><a href="#cb7-2656" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb7-2657"><a href="#cb7-2657" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb7-2658"><a href="#cb7-2658" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;header&quot;&gt;</span></span>
<span id="cb7-2659"><a href="#cb7-2659" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;h1&gt;üìö √çndice Combinado de Conversas&lt;/h1&gt;</span></span>
<span id="cb7-2660"><a href="#cb7-2660" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;p&gt;Qwen3 ‚Ä¢ ChatGPT ‚Ä¢ DeepSeek ‚Ä¢ Grok ‚Ä¢ COM HTML (Pandoc + MathJax)&lt;/p&gt;</span></span>
<span id="cb7-2661"><a href="#cb7-2661" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div class=&quot;stats&quot;&gt;</span></span>
<span id="cb7-2662"><a href="#cb7-2662" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb7-2663"><a href="#cb7-2663" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Total:&lt;/strong&gt; &lt;span id=&quot;total-count&quot;&gt;</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">&lt;/span&gt; conversas</span></span>
<span id="cb7-2664"><a href="#cb7-2664" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb7-2665"><a href="#cb7-2665" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb7-2666"><a href="#cb7-2666" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Ordena√ß√£o:&lt;/strong&gt; Mais Recentes Primeiro</span></span>
<span id="cb7-2667"><a href="#cb7-2667" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb7-2668"><a href="#cb7-2668" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb7-2669"><a href="#cb7-2669" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Atualizado:&lt;/strong&gt; </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">.</span>strftime(<span class="st">&#39;</span><span class="sc">%d</span><span class="st">/%m/%Y %H:%M&#39;</span>)<span class="sc">}</span></span>
<span id="cb7-2670"><a href="#cb7-2670" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb7-2671"><a href="#cb7-2671" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb7-2672"><a href="#cb7-2672" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb7-2673"><a href="#cb7-2673" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb7-2674"><a href="#cb7-2674" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;search-section&quot;&gt;</span></span>
<span id="cb7-2675"><a href="#cb7-2675" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;input type=&quot;text&quot; id=&quot;searchInput&quot; class=&quot;search-box&quot; placeholder=&quot;üîç Pesquisar por t√≠tulo, conte√∫do ou categoria...&quot;&gt;</span></span>
<span id="cb7-2676"><a href="#cb7-2676" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb7-2677"><a href="#cb7-2677" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb7-2678"><a href="#cb7-2678" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;filter-section&quot;&gt;</span></span>
<span id="cb7-2679"><a href="#cb7-2679" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;button class=&quot;filter-btn active&quot; data-filter=&quot;todas&quot;&gt;Todas (</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">)&lt;/button&gt;</span></span>
<span id="cb7-2680"><a href="#cb7-2680" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb7-2681"><a href="#cb7-2681" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-2682"><a href="#cb7-2682" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category, count <span class="kw">in</span> category_stats.items():</span>
<span id="cb7-2683"><a href="#cb7-2683" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">+=</span> <span class="ss">f&#39;&lt;button class=&quot;filter-btn&quot; data-filter=&quot;</span><span class="sc">{</span>category<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot;&gt;</span><span class="sc">{</span>category<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">)&lt;/button&gt;</span><span class="ch">\n</span><span class="ss">&#39;</span></span>
<span id="cb7-2684"><a href="#cb7-2684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2685"><a href="#cb7-2685" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb7-2686"><a href="#cb7-2686" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb7-2687"><a href="#cb7-2687" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb7-2688"><a href="#cb7-2688" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div style=&quot;text-align: center; padding: 15px; background: #e9ecef; border-bottom: 1px solid #ddd;&quot;&gt;</span></span>
<span id="cb7-2689"><a href="#cb7-2689" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;strong&gt;Acesso R√°pido:&lt;/strong&gt;</span></span>
<span id="cb7-2690"><a href="#cb7-2690" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_markdown/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìÅ Markdown&lt;/a&gt;</span></span>
<span id="cb7-2691"><a href="#cb7-2691" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_html/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üåê HTML&lt;/a&gt;</span></span>
<span id="cb7-2692"><a href="#cb7-2692" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_pdfs/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìÑ PDF&lt;/a&gt;</span></span>
<span id="cb7-2693"><a href="#cb7-2693" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_json/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìã JSON&lt;/a&gt;</span></span>
<span id="cb7-2694"><a href="#cb7-2694" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb7-2695"><a href="#cb7-2695" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb7-2696"><a href="#cb7-2696" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div class=&quot;conversations-grid&quot; id=&quot;conversationsGrid&quot;&gt;</span></span>
<span id="cb7-2697"><a href="#cb7-2697" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb7-2698"><a href="#cb7-2698" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-2699"><a href="#cb7-2699" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.all_conversations):</span>
<span id="cb7-2700"><a href="#cb7-2700" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb7-2701"><a href="#cb7-2701" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb7-2702"><a href="#cb7-2702" aria-hidden="true" tabindex="-1"></a>            recent_badge <span class="op">=</span> <span class="st">&quot;&lt;span class=&#39;recent-badge&#39;&gt;NOVO&lt;/span&gt;&quot;</span> <span class="cf">if</span> i <span class="op">&lt;</span> <span class="dv">5</span> <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb7-2703"><a href="#cb7-2703" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-2704"><a href="#cb7-2704" aria-hidden="true" tabindex="-1"></a>            summary <span class="op">=</span> conv.get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;Sem resumo dispon√≠vel&#39;</span>)</span>
<span id="cb7-2705"><a href="#cb7-2705" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(summary) <span class="op">&gt;</span> <span class="dv">150</span>:</span>
<span id="cb7-2706"><a href="#cb7-2706" aria-hidden="true" tabindex="-1"></a>                summary <span class="op">=</span> summary[:<span class="dv">150</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span></span>
<span id="cb7-2707"><a href="#cb7-2707" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-2708"><a href="#cb7-2708" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">+=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb7-2709"><a href="#cb7-2709" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div class=&quot;conversation-card&quot; data-title=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&quot; data-summary=&quot;</span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&quot; data-source=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot; data-category=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;category&#39;</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot;&gt;</span></span>
<span id="cb7-2710"><a href="#cb7-2710" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-header&quot;&gt;</span></span>
<span id="cb7-2711"><a href="#cb7-2711" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;card-number&quot;&gt;#</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>recent_badge<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb7-2712"><a href="#cb7-2712" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;card-actions&quot;&gt;</span></span>
<span id="cb7-2713"><a href="#cb7-2713" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_markdown/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.md&quot; class=&quot;action-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üìÑ MD&lt;/a&gt;</span></span>
<span id="cb7-2714"><a href="#cb7-2714" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_html/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&quot; class=&quot;action-btn html-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üåê HTML&lt;/a&gt;</span></span>
<span id="cb7-2715"><a href="#cb7-2715" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_pdfs/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.pdf&quot; class=&quot;action-btn pdf-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üìä PDF&lt;/a&gt;</span></span>
<span id="cb7-2716"><a href="#cb7-2716" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;/div&gt;</span></span>
<span id="cb7-2717"><a href="#cb7-2717" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb7-2718"><a href="#cb7-2718" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-title&quot; onclick=&quot;openHTML(&#39;</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&#39;)&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb7-2719"><a href="#cb7-2719" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div&gt;</span></span>
<span id="cb7-2720"><a href="#cb7-2720" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span class=&quot;card-source&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb7-2721"><a href="#cb7-2721" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span class=&quot;category-badge&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;category&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb7-2722"><a href="#cb7-2722" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb7-2723"><a href="#cb7-2723" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-summary&quot; onclick=&quot;openHTML(&#39;</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&#39;)&quot;&gt;</span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb7-2724"><a href="#cb7-2724" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-meta&quot;&gt;</span></span>
<span id="cb7-2725"><a href="#cb7-2725" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span&gt;üìÖ </span><span class="sc">{</span>conv<span class="sc">.</span>get(<span class="st">&#39;updated_at&#39;</span>) <span class="kw">or</span> conv<span class="sc">.</span>get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb7-2726"><a href="#cb7-2726" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span&gt;üí¨ </span><span class="sc">{</span><span class="bu">len</span>(conv[<span class="st">&#39;messages&#39;</span>])<span class="sc">}</span><span class="ss"> mensagens&lt;/span&gt;</span></span>
<span id="cb7-2727"><a href="#cb7-2727" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb7-2728"><a href="#cb7-2728" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb7-2729"><a href="#cb7-2729" aria-hidden="true" tabindex="-1"></a><span class="ss">            &quot;&quot;&quot;</span></span>
<span id="cb7-2730"><a href="#cb7-2730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2731"><a href="#cb7-2731" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb7-2732"><a href="#cb7-2732" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb7-2733"><a href="#cb7-2733" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/div&gt;</span></span>
<span id="cb7-2734"><a href="#cb7-2734" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb7-2735"><a href="#cb7-2735" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;script&gt;</span></span>
<span id="cb7-2736"><a href="#cb7-2736" aria-hidden="true" tabindex="-1"></a><span class="st">        let currentFilter = &#39;todas&#39;;</span></span>
<span id="cb7-2737"><a href="#cb7-2737" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb7-2738"><a href="#cb7-2738" aria-hidden="true" tabindex="-1"></a><span class="st">        document.addEventListener(&#39;DOMContentLoaded&#39;, function() {</span></span>
<span id="cb7-2739"><a href="#cb7-2739" aria-hidden="true" tabindex="-1"></a><span class="st">            updateStats();</span></span>
<span id="cb7-2740"><a href="#cb7-2740" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb7-2741"><a href="#cb7-2741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2742"><a href="#cb7-2742" aria-hidden="true" tabindex="-1"></a><span class="st">        document.querySelectorAll(&#39;.filter-btn&#39;).forEach(btn =&gt; {</span></span>
<span id="cb7-2743"><a href="#cb7-2743" aria-hidden="true" tabindex="-1"></a><span class="st">            btn.addEventListener(&#39;click&#39;, () =&gt; {</span></span>
<span id="cb7-2744"><a href="#cb7-2744" aria-hidden="true" tabindex="-1"></a><span class="st">                document.querySelectorAll(&#39;.filter-btn&#39;).forEach(b =&gt; b.classList.remove(&#39;active&#39;));</span></span>
<span id="cb7-2745"><a href="#cb7-2745" aria-hidden="true" tabindex="-1"></a><span class="st">                btn.classList.add(&#39;active&#39;);</span></span>
<span id="cb7-2746"><a href="#cb7-2746" aria-hidden="true" tabindex="-1"></a><span class="st">                currentFilter = btn.getAttribute(&#39;data-filter&#39;);</span></span>
<span id="cb7-2747"><a href="#cb7-2747" aria-hidden="true" tabindex="-1"></a><span class="st">                filterConversations();</span></span>
<span id="cb7-2748"><a href="#cb7-2748" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb7-2749"><a href="#cb7-2749" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb7-2750"><a href="#cb7-2750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2751"><a href="#cb7-2751" aria-hidden="true" tabindex="-1"></a><span class="st">        document.getElementById(&#39;searchInput&#39;).addEventListener(&#39;input&#39;, filterConversations);</span></span>
<span id="cb7-2752"><a href="#cb7-2752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2753"><a href="#cb7-2753" aria-hidden="true" tabindex="-1"></a><span class="st">        function filterConversations() {</span></span>
<span id="cb7-2754"><a href="#cb7-2754" aria-hidden="true" tabindex="-1"></a><span class="st">            const term = document.getElementById(&#39;searchInput&#39;).value.toLowerCase();</span></span>
<span id="cb7-2755"><a href="#cb7-2755" aria-hidden="true" tabindex="-1"></a><span class="st">            const cards = document.querySelectorAll(&#39;.conversation-card&#39;);</span></span>
<span id="cb7-2756"><a href="#cb7-2756" aria-hidden="true" tabindex="-1"></a><span class="st">            let visible = 0;</span></span>
<span id="cb7-2757"><a href="#cb7-2757" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-2758"><a href="#cb7-2758" aria-hidden="true" tabindex="-1"></a><span class="st">            cards.forEach(card =&gt; {</span></span>
<span id="cb7-2759"><a href="#cb7-2759" aria-hidden="true" tabindex="-1"></a><span class="st">                const title = card.getAttribute(&#39;data-title&#39;).toLowerCase();</span></span>
<span id="cb7-2760"><a href="#cb7-2760" aria-hidden="true" tabindex="-1"></a><span class="st">                const summary = card.getAttribute(&#39;data-summary&#39;).toLowerCase();</span></span>
<span id="cb7-2761"><a href="#cb7-2761" aria-hidden="true" tabindex="-1"></a><span class="st">                const source = card.getAttribute(&#39;data-source&#39;).toLowerCase();</span></span>
<span id="cb7-2762"><a href="#cb7-2762" aria-hidden="true" tabindex="-1"></a><span class="st">                const category = card.getAttribute(&#39;data-category&#39;).toLowerCase();</span></span>
<span id="cb7-2763"><a href="#cb7-2763" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb7-2764"><a href="#cb7-2764" aria-hidden="true" tabindex="-1"></a><span class="st">                const matchesSearch = (title.includes(term) || summary.includes(term) || category.includes(term) || source.includes(term));</span></span>
<span id="cb7-2765"><a href="#cb7-2765" aria-hidden="true" tabindex="-1"></a><span class="st">                const matchesCategory = (currentFilter === &#39;todas&#39; || category === currentFilter);</span></span>
<span id="cb7-2766"><a href="#cb7-2766" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb7-2767"><a href="#cb7-2767" aria-hidden="true" tabindex="-1"></a><span class="st">                if (matchesSearch &amp;&amp; matchesCategory) {</span></span>
<span id="cb7-2768"><a href="#cb7-2768" aria-hidden="true" tabindex="-1"></a><span class="st">                    card.style.display = &#39;block&#39;;</span></span>
<span id="cb7-2769"><a href="#cb7-2769" aria-hidden="true" tabindex="-1"></a><span class="st">                    visible++;</span></span>
<span id="cb7-2770"><a href="#cb7-2770" aria-hidden="true" tabindex="-1"></a><span class="st">                } else {</span></span>
<span id="cb7-2771"><a href="#cb7-2771" aria-hidden="true" tabindex="-1"></a><span class="st">                    card.style.display = &#39;none&#39;;</span></span>
<span id="cb7-2772"><a href="#cb7-2772" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb7-2773"><a href="#cb7-2773" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb7-2774"><a href="#cb7-2774" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-2775"><a href="#cb7-2775" aria-hidden="true" tabindex="-1"></a><span class="st">            updateStats(visible);</span></span>
<span id="cb7-2776"><a href="#cb7-2776" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-2777"><a href="#cb7-2777" aria-hidden="true" tabindex="-1"></a><span class="st">            const grid = document.getElementById(&#39;conversationsGrid&#39;);</span></span>
<span id="cb7-2778"><a href="#cb7-2778" aria-hidden="true" tabindex="-1"></a><span class="st">            const noResults = document.getElementById(&#39;no-results-message&#39;);</span></span>
<span id="cb7-2779"><a href="#cb7-2779" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb7-2780"><a href="#cb7-2780" aria-hidden="true" tabindex="-1"></a><span class="st">            if (visible === 0) {</span></span>
<span id="cb7-2781"><a href="#cb7-2781" aria-hidden="true" tabindex="-1"></a><span class="st">                if (!noResults) {</span></span>
<span id="cb7-2782"><a href="#cb7-2782" aria-hidden="true" tabindex="-1"></a><span class="st">                    const noResultsMsg = document.createElement(&#39;div&#39;);</span></span>
<span id="cb7-2783"><a href="#cb7-2783" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.id = &#39;no-results-message&#39;;</span></span>
<span id="cb7-2784"><a href="#cb7-2784" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.className = &#39;no-results&#39;;</span></span>
<span id="cb7-2785"><a href="#cb7-2785" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.innerHTML = &#39;üîç Nenhuma conversa encontrada. Tente ajustar os filtros ou a pesquisa.&#39;;</span></span>
<span id="cb7-2786"><a href="#cb7-2786" aria-hidden="true" tabindex="-1"></a><span class="st">                    grid.appendChild(noResultsMsg);</span></span>
<span id="cb7-2787"><a href="#cb7-2787" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb7-2788"><a href="#cb7-2788" aria-hidden="true" tabindex="-1"></a><span class="st">            } else if (noResults) {</span></span>
<span id="cb7-2789"><a href="#cb7-2789" aria-hidden="true" tabindex="-1"></a><span class="st">                noResults.remove();</span></span>
<span id="cb7-2790"><a href="#cb7-2790" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-2791"><a href="#cb7-2791" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb7-2792"><a href="#cb7-2792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2793"><a href="#cb7-2793" aria-hidden="true" tabindex="-1"></a><span class="st">        function updateStats(visibleCount = null) {</span></span>
<span id="cb7-2794"><a href="#cb7-2794" aria-hidden="true" tabindex="-1"></a><span class="st">            const totalElement = document.getElementById(&#39;total-count&#39;);</span></span>
<span id="cb7-2795"><a href="#cb7-2795" aria-hidden="true" tabindex="-1"></a><span class="st">            if (visibleCount !== null) {</span></span>
<span id="cb7-2796"><a href="#cb7-2796" aria-hidden="true" tabindex="-1"></a><span class="st">                totalElement.textContent = visibleCount;</span></span>
<span id="cb7-2797"><a href="#cb7-2797" aria-hidden="true" tabindex="-1"></a><span class="st">            } else {</span></span>
<span id="cb7-2798"><a href="#cb7-2798" aria-hidden="true" tabindex="-1"></a><span class="st">                totalElement.textContent = &quot;&quot;&quot;</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(<span class="va">self</span>.all_conversations)) <span class="op">+</span> <span class="st">&quot;&quot;&quot;;</span></span>
<span id="cb7-2799"><a href="#cb7-2799" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-2800"><a href="#cb7-2800" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb7-2801"><a href="#cb7-2801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2802"><a href="#cb7-2802" aria-hidden="true" tabindex="-1"></a><span class="st">        function openHTML(filename) {</span></span>
<span id="cb7-2803"><a href="#cb7-2803" aria-hidden="true" tabindex="-1"></a><span class="st">            const htmlUrl = &#39;combined_html/&#39; + filename;</span></span>
<span id="cb7-2804"><a href="#cb7-2804" aria-hidden="true" tabindex="-1"></a><span class="st">            console.log(&#39;Abrindo HTML:&#39;, htmlUrl);</span></span>
<span id="cb7-2805"><a href="#cb7-2805" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(htmlUrl, &#39;_blank&#39;);</span></span>
<span id="cb7-2806"><a href="#cb7-2806" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb7-2807"><a href="#cb7-2807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2808"><a href="#cb7-2808" aria-hidden="true" tabindex="-1"></a><span class="st">        function openMD(filename) {</span></span>
<span id="cb7-2809"><a href="#cb7-2809" aria-hidden="true" tabindex="-1"></a><span class="st">            const mdUrl = &#39;combined_markdown/&#39; + filename;</span></span>
<span id="cb7-2810"><a href="#cb7-2810" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(mdUrl, &#39;_blank&#39;);</span></span>
<span id="cb7-2811"><a href="#cb7-2811" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb7-2812"><a href="#cb7-2812" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb7-2813"><a href="#cb7-2813" aria-hidden="true" tabindex="-1"></a><span class="st">        function openPDF(filename) {</span></span>
<span id="cb7-2814"><a href="#cb7-2814" aria-hidden="true" tabindex="-1"></a><span class="st">            const pdfFile = filename.replace(&#39;.html&#39;, &#39;.pdf&#39;);</span></span>
<span id="cb7-2815"><a href="#cb7-2815" aria-hidden="true" tabindex="-1"></a><span class="st">            const pdfUrl = &#39;combined_pdfs/&#39; + pdfFile;</span></span>
<span id="cb7-2816"><a href="#cb7-2816" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(pdfUrl, &#39;_blank&#39;);</span></span>
<span id="cb7-2817"><a href="#cb7-2817" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb7-2818"><a href="#cb7-2818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2819"><a href="#cb7-2819" aria-hidden="true" tabindex="-1"></a><span class="st">        document.addEventListener(&#39;keydown&#39;, function(e) {</span></span>
<span id="cb7-2820"><a href="#cb7-2820" aria-hidden="true" tabindex="-1"></a><span class="st">            if (e.key === &#39;Escape&#39;) {</span></span>
<span id="cb7-2821"><a href="#cb7-2821" aria-hidden="true" tabindex="-1"></a><span class="st">                document.getElementById(&#39;searchInput&#39;).value = &#39;&#39;;</span></span>
<span id="cb7-2822"><a href="#cb7-2822" aria-hidden="true" tabindex="-1"></a><span class="st">                filterConversations();</span></span>
<span id="cb7-2823"><a href="#cb7-2823" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb7-2824"><a href="#cb7-2824" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb7-2825"><a href="#cb7-2825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2826"><a href="#cb7-2826" aria-hidden="true" tabindex="-1"></a><span class="st">        document.querySelectorAll(&#39;.conversation-card&#39;).forEach(card =&gt; {</span></span>
<span id="cb7-2827"><a href="#cb7-2827" aria-hidden="true" tabindex="-1"></a><span class="st">            card.addEventListener(&#39;click&#39;, function(e) {</span></span>
<span id="cb7-2828"><a href="#cb7-2828" aria-hidden="true" tabindex="-1"></a><span class="st">                if (e.target.closest(&#39;.action-btn&#39;)) {</span></span>
<span id="cb7-2829"><a href="#cb7-2829" aria-hidden="true" tabindex="-1"></a><span class="st">                    return;</span></span>
<span id="cb7-2830"><a href="#cb7-2830" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb7-2831"><a href="#cb7-2831" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb7-2832"><a href="#cb7-2832" aria-hidden="true" tabindex="-1"></a><span class="st">                const htmlBtn = this.querySelector(&#39;a.html-btn&#39;);</span></span>
<span id="cb7-2833"><a href="#cb7-2833" aria-hidden="true" tabindex="-1"></a><span class="st">                if (htmlBtn) {</span></span>
<span id="cb7-2834"><a href="#cb7-2834" aria-hidden="true" tabindex="-1"></a><span class="st">                    const htmlUrl = htmlBtn.getAttribute(&#39;href&#39;);</span></span>
<span id="cb7-2835"><a href="#cb7-2835" aria-hidden="true" tabindex="-1"></a><span class="st">                    window.open(htmlUrl, &#39;_blank&#39;);</span></span>
<span id="cb7-2836"><a href="#cb7-2836" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb7-2837"><a href="#cb7-2837" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb7-2838"><a href="#cb7-2838" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb7-2839"><a href="#cb7-2839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2840"><a href="#cb7-2840" aria-hidden="true" tabindex="-1"></a><span class="st">        document.getElementById(&#39;searchInput&#39;).focus();</span></span>
<span id="cb7-2841"><a href="#cb7-2841" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb7-2842"><a href="#cb7-2842" aria-hidden="true" tabindex="-1"></a><span class="st">        console.log(&#39;√çndice carregado com&#39;, &quot;&quot;&quot;</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(<span class="va">self</span>.all_conversations)) <span class="op">+</span> <span class="st">&quot;&quot;&quot;, &#39;conversas&#39;);</span></span>
<span id="cb7-2843"><a href="#cb7-2843" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/script&gt;</span></span>
<span id="cb7-2844"><a href="#cb7-2844" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/body&gt;</span></span>
<span id="cb7-2845"><a href="#cb7-2845" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/html&gt;</span></span>
<span id="cb7-2846"><a href="#cb7-2846" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb7-2847"><a href="#cb7-2847" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-2848"><a href="#cb7-2848" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.index_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb7-2849"><a href="#cb7-2849" aria-hidden="true" tabindex="-1"></a>            f.write(html_content)</span>
<span id="cb7-2850"><a href="#cb7-2850" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ √çndice combinado criado: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-2851"><a href="#cb7-2851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2852"><a href="#cb7-2852" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb7-2853"><a href="#cb7-2853" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser(</span>
<span id="cb7-2854"><a href="#cb7-2854" aria-hidden="true" tabindex="-1"></a>        description<span class="op">=</span><span class="st">&quot;Processa exporta√ß√µes combinadas com exporta√ß√£o HTML via Pandoc.&quot;</span></span>
<span id="cb7-2855"><a href="#cb7-2855" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-2856"><a href="#cb7-2856" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">&quot;--dry-run&quot;</span>, action<span class="op">=</span><span class="st">&quot;store_true&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Executa sem salvar arquivos&quot;</span>)</span>
<span id="cb7-2857"><a href="#cb7-2857" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">&quot;--force-overwrite&quot;</span>, action<span class="op">=</span><span class="st">&quot;store_true&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Substitui arquivos existentes&quot;</span>)</span>
<span id="cb7-2858"><a href="#cb7-2858" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-2859"><a href="#cb7-2859" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb7-2860"><a href="#cb7-2860" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-2861"><a href="#cb7-2861" aria-hidden="true" tabindex="-1"></a>    system <span class="op">=</span> CombinedFragmentsSystem(</span>
<span id="cb7-2862"><a href="#cb7-2862" aria-hidden="true" tabindex="-1"></a>        dry_run<span class="op">=</span>args.dry_run,</span>
<span id="cb7-2863"><a href="#cb7-2863" aria-hidden="true" tabindex="-1"></a>        force_overwrite<span class="op">=</span>args.force_overwrite</span>
<span id="cb7-2864"><a href="#cb7-2864" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-2865"><a href="#cb7-2865" aria-hidden="true" tabindex="-1"></a>    system.run()</span>
<span id="cb7-2866"><a href="#cb7-2866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2867"><a href="#cb7-2867" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb7-2868"><a href="#cb7-2868" aria-hidden="true" tabindex="-1"></a>    main()</span></code></pre></div>
<p><strong>Principais corre√ß√µes aplicadas:</strong></p>
<ol type="1">
<li><p><strong>M√©todo <code>process_qwen_corrected</code></strong> -
Substitui o m√©todo anterior com foco espec√≠fico no problema do
<code>content_list</code></p></li>
<li><p><strong><code>_extract_qwen_messages_corrected</code></strong> -
Extra√ß√£o recursiva que busca mensagens em toda a estrutura</p></li>
<li><p><strong><code>_is_qwen_message_with_content</code></strong> -
Verifica tanto <code>content</code> quanto <code>content_list</code>
para identificar mensagens v√°lidas</p></li>
<li><p><strong><code>_create_message_from_qwen_object</code></strong> -
<strong>CORRE√á√ÉO PRINCIPAL</strong>: Prioriza <code>content_list</code>
quando <code>content</code> est√° vazio, extraindo o conte√∫do real das
mensagens</p></li>
<li><p><strong>Mant√©m todas as outras funcionalidades</strong> -
ChatGPT, DeepSeek e Grok continuam funcionando exatamente como
antes</p></li>
</ol>
<p>O c√≥digo agora deve extrair corretamente todas as mensagens do Qwen,
incluindo aquelas que antes tinham conte√∫do apenas em
<code>content_list</code>.</p>
<hr />
<h3 data-number="1.2.7" id="utilizador-2025-11-08-064957-deepseek-reasoner"><span class="header-section-number">1.2.7</span> üë§ Utilizador <em>(2025-11-08
06:49:57)</em> <em>[deepseek-reasoner]</em></h3>
<p>Agora parece que o conteudo de Qwen est√° correcto. Mas outro problema
quando TOC √© grande, parece que atrapalha o texto. Assim sugere-se: TOC
flutuante otimizado: ‚Ä¢ Posicionado √† direita com float: right Clearfix
para layout: ‚Ä¢ Classe .main-content com overflow: hidden ‚Ä¢ Previne
problemas com elementos flutuantes. Agora o HTML deve ocupar
praticamente toda a largura dispon√≠vel no browser. 1. Layout de tela
completa: ‚Ä¢ max-width: none no elemento body ‚Ä¢ max-width: 95% no
container principal . E pretendo um novo file
comb_fragments_system5_html_export.py completo e funcional.
Optimizado.</p>
<hr />
<h3 data-number="1.2.8" id="deepseek-2025-11-08-064957-deepseek-reasoner"><span class="header-section-number">1.2.8</span> ü§ñ DeepSeek <em>(2025-11-08
06:49:57)</em> <em>[deepseek-reasoner]</em></h3>
<p>Vamos criar uma vers√£o otimizada do sistema, com foco em melhorar o
layout do TOC (Table of Contents) e aproveitar melhor a largura da
tela.</p>
<p>As principais altera√ß√µes ser√£o:</p>
<ol type="1">
<li>No CSS, vamos ajustar o layout para que o TOC flutue √† direita e o
conte√∫do principal ocupe a largura restante.</li>
<li>Adicionar uma classe .main-content com overflow: hidden para conter
o TOC flutuante.</li>
<li>Ajustar as larguras do body e container para usar quase 100% da
largura.</li>
</ol>
<p>Al√©m disso, vamos reorganizar o c√≥digo para garantir que as
convers√µes HTML (com Pandoc ou fallback) incorporem esses estilos.</p>
<p>Vou fornecer o c√≥digo completo do
<code>comb_fragments_system5_html_export.py</code> com as otimiza√ß√µes
solicitadas.</p>
<p>Note: Vou manter a mesma estrutura e funcionalidades, apenas
otimizando o CSS e o layout. Aqui est√° o
<code>comb_fragments_system5_html_export.py</code> completo e otimizado
com TOC flutuante e layout de tela completa:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># comb_fragments_system5_html_export.py</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> webbrowser</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tempfile</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> traceback</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Any, Optional</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> markdown</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CombinedFragmentsSystem:</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dry_run<span class="op">=</span><span class="va">False</span>, force_overwrite<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_dir <span class="op">=</span> Path(<span class="st">&quot;data&quot;</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dry_run <span class="op">=</span> dry_run</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.force_overwrite <span class="op">=</span> force_overwrite</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configurar logging</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        logging.basicConfig(level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">&#39;</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estrutura de pastas organizada</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dirs <span class="op">=</span> {</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;markdown&#39;</span>: <span class="st">&quot;combined_markdown&quot;</span>,</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_csv&quot;</span>, </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_json&quot;</span>,</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;pdfs&#39;</span>: <span class="st">&quot;combined_pdfs&quot;</span>,</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;html&#39;</span>: <span class="st">&quot;combined_html&quot;</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.single_files <span class="op">=</span> {</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_all_conversations.csv&quot;</span>,</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_all_conversations.json&quot;</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.index_file <span class="op">=</span> <span class="st">&quot;index.html&quot;</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations <span class="op">=</span> []</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configura√ß√£o de processamento por fonte</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.processors <span class="op">=</span> {</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;qwen&#39;</span>: {</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chat-export.json&quot;</span>,</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_qwen_corrected,</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;chatgpt&#39;</span>: {</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chatgpt.zip&quot;</span>, </span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_chatgpt,</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;deepseek&#39;</span>: {</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;deepseek_data.zip&quot;</span>,</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_deepseek,</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;grok&#39;</span>: {</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;grok.zip&quot;</span>,</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_grok,</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sanitize_filename(<span class="va">self</span>, text: <span class="bu">str</span>, max_len: <span class="bu">int</span> <span class="op">=</span> <span class="dv">50</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Sanitiza nomes de arquivo REMOVENDO ESPA√áOS e preservando emojis&quot;&quot;&quot;</span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove caracteres inv√°lidos</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="dv">\s</span><span class="pp">]</span><span class="vs">&#39;</span>  <span class="co"># Inclui \s para remover espa√ßos</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;_&#39;</span>, text)  <span class="co"># Substitui espa√ßos por underscores</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;_</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39;_&#39;</span>, sanitized)  <span class="co"># Remove underscores duplicados</span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> sanitized.strip(<span class="st">&#39;_&#39;</span>)  <span class="co"># Remove underscores no in√≠cio e fim</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Limita o comprimento</span></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(sanitized) <span class="op">&gt;</span> max_len:</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Tenta cortar em um ponto l√≥gico (underscore)</span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;_&#39;</span> <span class="kw">in</span> sanitized[:max_len]:</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>                last_underscore <span class="op">=</span> sanitized[:max_len].rfind(<span class="st">&#39;_&#39;</span>)</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> last_underscore <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>                    sanitized <span class="op">=</span> sanitized[:last_underscore]</span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>                sanitized <span class="op">=</span> sanitized[:max_len]</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_original_title(<span class="va">self</span>, text: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Preserva o t√≠tulo original com espa√ßos, apenas removendo caracteres realmente inv√°lidos&quot;&quot;&quot;</span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove apenas caracteres realmente problem√°ticos, mantendo espa√ßos</span></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="pp">]</span><span class="vs">&#39;</span></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;&#39;</span>, text)</span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;</span><span class="dv">\s</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39; &#39;</span>, sanitized.strip())</span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_special_content(<span class="va">self</span>, content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Preserva f√≥rmulas matem√°ticas, c√≥digo e formata√ß√£o especial&quot;&quot;&quot;</span></span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;&quot;</span></span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>        preserved_content <span class="op">=</span> content</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Corrige problemas com barras invertidas em LaTeX</span></span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>        latex_corrections <span class="op">=</span> {</span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ärac&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">frac&#39;</span>,</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Çarepsilon&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">varepsilon&#39;</span>,</span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ç&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span>,</span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ä&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span></span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> wrong, correct <span class="kw">in</span> latex_corrections.items():</span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>            preserved_content <span class="op">=</span> preserved_content.replace(wrong, correct)</span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> preserved_content</span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ensure_directories(<span class="va">self</span>):</span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Cria todas as pastas necess√°rias&quot;&quot;&quot;</span></span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;DRY-RUN: Pastas seriam criadas:&quot;</span>)</span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a>            Path(folder).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;Pasta criada: </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> run(<span class="va">self</span>):</span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Executa o processamento completo&quot;&quot;&quot;</span></span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;SISTEMA COMBINADO DE EXPORTA√á√ïES COM HTML (Qwen3, ChatGPT, DeepSeek, Grok)&quot;</span>)</span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.data_dir.exists():</span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;Pasta &#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">}</span><span class="ss">&#39; n√£o encontrada.&quot;</span>)</span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;Crie a pasta &#39;data&#39; e coloque os arquivos de exporta√ß√£o:&quot;</span>)</span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   - </span><span class="sc">{</span>config[<span class="st">&#39;file&#39;</span>]<span class="sc">}</span><span class="ss"> (para </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;Usando pasta de dados: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ensure_directories()</span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a>        processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> config[<span class="st">&#39;enabled&#39;</span>]:</span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a>                file_path <span class="op">=</span> <span class="va">self</span>.data_dir <span class="op">/</span> config[<span class="st">&#39;file&#39;</span>]</span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> file_path.exists():</span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Processando </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a>                    config[<span class="st">&#39;method&#39;</span>](file_path)</span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.warning(<span class="ss">f&quot;</span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">: arquivo n√£o encontrado - </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> processed_count <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhum arquivo de exporta√ß√£o encontrado na pasta &#39;data&#39;.&quot;</span>)</span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhuma conversa foi extra√≠da dos arquivos.&quot;</span>)</span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._post_process_conversations()</span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-182"><a href="#cb8-182" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._export_all_formats()</span>
<span id="cb8-183"><a href="#cb8-183" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üéâ SISTEMA COMBINADO FINALIZADO!&quot;</span>)</span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ √çndice: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> Path(<span class="va">self</span>.index_file).exists():</span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true" tabindex="-1"></a>                webbrowser.<span class="bu">open</span>(<span class="ss">f&#39;file://</span><span class="sc">{</span>Path(<span class="va">self</span>.index_file)<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üîÆ MODO DRY-RUN: Nenhum arquivo foi criado.&quot;</span>)</span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _post_process_conversations(<span class="va">self</span>):</span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processamento p√≥s-extra√ß√£o das conversas&quot;&quot;&quot;</span></span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations.sort(</span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a>            key<span class="op">=</span><span class="kw">lambda</span> x: <span class="va">self</span>.parse_timestamp_for_sorting(</span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a>                x.get(<span class="st">&#39;updated_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;created_at&#39;</span>)</span>
<span id="cb8-195"><a href="#cb8-195" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb8-196"><a href="#cb8-196" aria-hidden="true" tabindex="-1"></a>            reverse<span class="op">=</span><span class="va">True</span></span>
<span id="cb8-197"><a href="#cb8-197" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-198"><a href="#cb8-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-199"><a href="#cb8-199" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.all_conversations):</span>
<span id="cb8-200"><a href="#cb8-200" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;number&#39;</span>] <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb8-201"><a href="#cb8-201" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;category&#39;</span>] <span class="op">=</span> <span class="va">self</span>.categorize_conversation(conv[<span class="st">&#39;title&#39;</span>], conv.get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;&#39;</span>))</span>
<span id="cb8-202"><a href="#cb8-202" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;source&#39;</span>, <span class="st">&#39;Desconhecido&#39;</span>)</span>
<span id="cb8-203"><a href="#cb8-203" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;messages&#39;</span>, [])</span>
<span id="cb8-204"><a href="#cb8-204" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;summary&#39;</span>, conv[<span class="st">&#39;messages&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> conv[<span class="st">&#39;messages&#39;</span>] <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>)</span>
<span id="cb8-205"><a href="#cb8-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-206"><a href="#cb8-206" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä Total combinado de conversas: </span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-207"><a href="#cb8-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-208"><a href="#cb8-208" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _export_all_formats(<span class="va">self</span>):</span>
<span id="cb8-209"><a href="#cb8-209" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Exporta para todos os formatos&quot;&quot;&quot;</span></span>
<span id="cb8-210"><a href="#cb8-210" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">üîÑ Exportando para formatos...&quot;</span>)</span>
<span id="cb8-211"><a href="#cb8-211" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_markdown_enhanced()</span>
<span id="cb8-212"><a href="#cb8-212" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_html_robust()</span>
<span id="cb8-213"><a href="#cb8-213" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_csv() </span>
<span id="cb8-214"><a href="#cb8-214" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_json()</span>
<span id="cb8-215"><a href="#cb8-215" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_all_to_single_files()</span>
<span id="cb8-216"><a href="#cb8-216" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.create_searchable_index()</span>
<span id="cb8-217"><a href="#cb8-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-218"><a href="#cb8-218" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _get_pandoc_version(<span class="va">self</span>) <span class="op">-&gt;</span> Optional[<span class="bu">tuple</span>]:</span>
<span id="cb8-219"><a href="#cb8-219" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Obt√©m a vers√£o do Pandoc para compatibilidade&quot;&quot;&quot;</span></span>
<span id="cb8-220"><a href="#cb8-220" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-221"><a href="#cb8-221" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run([<span class="st">&#39;pandoc&#39;</span>, <span class="st">&#39;--version&#39;</span>], capture_output<span class="op">=</span><span class="va">True</span>, text<span class="op">=</span><span class="va">True</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>)</span>
<span id="cb8-222"><a href="#cb8-222" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb8-223"><a href="#cb8-223" aria-hidden="true" tabindex="-1"></a>                first_line <span class="op">=</span> result.stdout.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb8-224"><a href="#cb8-224" aria-hidden="true" tabindex="-1"></a>                version_str <span class="op">=</span> first_line.split()[<span class="dv">1</span>]</span>
<span id="cb8-225"><a href="#cb8-225" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="bu">tuple</span>(<span class="bu">map</span>(<span class="bu">int</span>, version_str.split(<span class="st">&#39;.&#39;</span>)))</span>
<span id="cb8-226"><a href="#cb8-226" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb8-227"><a href="#cb8-227" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb8-228"><a href="#cb8-228" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb8-229"><a href="#cb8-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-230"><a href="#cb8-230" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_optimized(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb8-231"><a href="#cb8-231" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Convers√£o OTIMIZADA com Pandoc usando todas as op√ß√µes avan√ßadas&quot;&quot;&quot;</span></span>
<span id="cb8-232"><a href="#cb8-232" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-233"><a href="#cb8-233" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Convertendo com Pandoc otimizado: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-234"><a href="#cb8-234" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-235"><a href="#cb8-235" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica se o arquivo MathJax local existe</span></span>
<span id="cb8-236"><a href="#cb8-236" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb8-237"><a href="#cb8-237" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb8-238"><a href="#cb8-238" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-239"><a href="#cb8-239" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Comandos base</span></span>
<span id="cb8-240"><a href="#cb8-240" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb8-241"><a href="#cb8-241" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb8-242"><a href="#cb8-242" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb8-243"><a href="#cb8-243" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji+autolink_bare_uris+tex_math_single_backslash&#39;</span>,</span>
<span id="cb8-244"><a href="#cb8-244" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb8-245"><a href="#cb8-245" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb8-246"><a href="#cb8-246" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span>,</span>
<span id="cb8-247"><a href="#cb8-247" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--table-of-contents&#39;</span>,</span>
<span id="cb8-248"><a href="#cb8-248" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--toc-depth=2&#39;</span>, </span>
<span id="cb8-249"><a href="#cb8-249" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--number-sections&#39;</span></span>
<span id="cb8-250"><a href="#cb8-250" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb8-251"><a href="#cb8-251" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-252"><a href="#cb8-252" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica vers√£o do Pandoc para recursos avan√ßados</span></span>
<span id="cb8-253"><a href="#cb8-253" aria-hidden="true" tabindex="-1"></a>            pandoc_version <span class="op">=</span> <span class="va">self</span>._get_pandoc_version()</span>
<span id="cb8-254"><a href="#cb8-254" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-255"><a href="#cb8-255" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Adiciona --embed-resources apenas se suportado (Pandoc 2.19+)</span></span>
<span id="cb8-256"><a href="#cb8-256" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pandoc_version <span class="kw">and</span> pandoc_version <span class="op">&gt;=</span> (<span class="dv">2</span>, <span class="dv">19</span>):</span>
<span id="cb8-257"><a href="#cb8-257" aria-hidden="true" tabindex="-1"></a>                command.append(<span class="st">&#39;--embed-resources&#39;</span>)</span>
<span id="cb8-258"><a href="#cb8-258" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="st">&quot;‚úÖ Usando --embed-resources (Pandoc 2.19+)&quot;</span>)</span>
<span id="cb8-259"><a href="#cb8-259" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb8-260"><a href="#cb8-260" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="st">&quot;‚ÑπÔ∏è  --embed-resources n√£o suportado, usando recursos externos&quot;</span>)</span>
<span id="cb8-261"><a href="#cb8-261" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-262"><a href="#cb8-262" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Adiciona syntax highlighting</span></span>
<span id="cb8-263"><a href="#cb8-263" aria-hidden="true" tabindex="-1"></a>            command.extend([<span class="st">&#39;--syntax-highlighting=pygments&#39;</span>])</span>
<span id="cb8-264"><a href="#cb8-264" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-265"><a href="#cb8-265" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb8-266"><a href="#cb8-266" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb8-267"><a href="#cb8-267" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb8-268"><a href="#cb8-268" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb8-269"><a href="#cb8-269" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb8-270"><a href="#cb8-270" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">180</span></span>
<span id="cb8-271"><a href="#cb8-271" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb8-272"><a href="#cb8-272" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-273"><a href="#cb8-273" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb8-274"><a href="#cb8-274" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> result.stdout</span>
<span id="cb8-275"><a href="#cb8-275" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-276"><a href="#cb8-276" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Aplica otimiza√ß√µes adicionais</span></span>
<span id="cb8-277"><a href="#cb8-277" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="va">self</span>._optimize_html_content(html_content)</span>
<span id="cb8-278"><a href="#cb8-278" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> html_content</span>
<span id="cb8-279"><a href="#cb8-279" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb8-280"><a href="#cb8-280" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc otimizado falhou, tentando m√©todo b√°sico: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-281"><a href="#cb8-281" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb8-282"><a href="#cb8-282" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-283"><a href="#cb8-283" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> subprocess.TimeoutExpired:</span>
<span id="cb8-284"><a href="#cb8-284" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Timeout no Pandoc otimizado&quot;</span>)</span>
<span id="cb8-285"><a href="#cb8-285" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb8-286"><a href="#cb8-286" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-287"><a href="#cb8-287" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc otimizado: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-288"><a href="#cb8-288" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb8-289"><a href="#cb8-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-290"><a href="#cb8-290" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_basic(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb8-291"><a href="#cb8-291" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;M√©todo b√°sico de fallback para Pandoc com TOC e numera√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb8-292"><a href="#cb8-292" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-293"><a href="#cb8-293" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Tentando convers√£o b√°sica: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-294"><a href="#cb8-294" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-295"><a href="#cb8-295" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb8-296"><a href="#cb8-296" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb8-297"><a href="#cb8-297" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-298"><a href="#cb8-298" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb8-299"><a href="#cb8-299" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb8-300"><a href="#cb8-300" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb8-301"><a href="#cb8-301" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown&#39;</span>,</span>
<span id="cb8-302"><a href="#cb8-302" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb8-303"><a href="#cb8-303" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb8-304"><a href="#cb8-304" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--table-of-contents&#39;</span>,</span>
<span id="cb8-305"><a href="#cb8-305" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--toc-depth=2&#39;</span>,</span>
<span id="cb8-306"><a href="#cb8-306" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--number-sections&#39;</span>,</span>
<span id="cb8-307"><a href="#cb8-307" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb8-308"><a href="#cb8-308" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb8-309"><a href="#cb8-309" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-310"><a href="#cb8-310" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb8-311"><a href="#cb8-311" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb8-312"><a href="#cb8-312" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb8-313"><a href="#cb8-313" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb8-314"><a href="#cb8-314" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb8-315"><a href="#cb8-315" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">120</span></span>
<span id="cb8-316"><a href="#cb8-316" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb8-317"><a href="#cb8-317" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-318"><a href="#cb8-318" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb8-319"><a href="#cb8-319" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._optimize_html_content(result.stdout)</span>
<span id="cb8-320"><a href="#cb8-320" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb8-321"><a href="#cb8-321" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc b√°sico falhou, usando fallback Python: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-322"><a href="#cb8-322" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb8-323"><a href="#cb8-323" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-324"><a href="#cb8-324" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-325"><a href="#cb8-325" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc b√°sico: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-326"><a href="#cb8-326" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb8-327"><a href="#cb8-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-328"><a href="#cb8-328" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _optimize_html_content(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-329"><a href="#cb8-329" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Aplica otimiza√ß√µes finais ao conte√∫do HTML&quot;&quot;&quot;</span></span>
<span id="cb8-330"><a href="#cb8-330" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona viewport para responsividade</span></span>
<span id="cb8-331"><a href="#cb8-331" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;viewport&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb8-332"><a href="#cb8-332" aria-hidden="true" tabindex="-1"></a>            viewport_meta <span class="op">=</span> <span class="st">&#39;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#39;</span></span>
<span id="cb8-333"><a href="#cb8-333" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="ss">    </span><span class="sc">{</span>viewport_meta<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb8-334"><a href="#cb8-334" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-335"><a href="#cb8-335" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Melhora acessibilidade</span></span>
<span id="cb8-336"><a href="#cb8-336" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;html&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;lang&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb8-337"><a href="#cb8-337" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;html&gt;&#39;</span>, <span class="st">&#39;&lt;html lang=&quot;pt-BR&quot;&gt;&#39;</span>)</span>
<span id="cb8-338"><a href="#cb8-338" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-339"><a href="#cb8-339" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona CSS personalizado para melhorar TOC e numera√ß√£o</span></span>
<span id="cb8-340"><a href="#cb8-340" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="va">self</span>._inject_enhanced_css(html_content)</span>
<span id="cb8-341"><a href="#cb8-341" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-342"><a href="#cb8-342" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Otimiza TOC gerado pelo Pandoc</span></span>
<span id="cb8-343"><a href="#cb8-343" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="va">self</span>._enhance_toc_styling(html_content)</span>
<span id="cb8-344"><a href="#cb8-344" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-345"><a href="#cb8-345" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb8-346"><a href="#cb8-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-347"><a href="#cb8-347" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _inject_enhanced_css(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-348"><a href="#cb8-348" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Injeta CSS personalizado aprimorado para TOC flutuante e layout de tela completa&quot;&quot;&quot;</span></span>
<span id="cb8-349"><a href="#cb8-349" aria-hidden="true" tabindex="-1"></a>        enhanced_css <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb8-350"><a href="#cb8-350" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;style&gt;</span></span>
<span id="cb8-351"><a href="#cb8-351" aria-hidden="true" tabindex="-1"></a><span class="st">            /* LAYOUT DE TELA COMPLETA OTIMIZADO */</span></span>
<span id="cb8-352"><a href="#cb8-352" aria-hidden="true" tabindex="-1"></a><span class="st">            body {</span></span>
<span id="cb8-353"><a href="#cb8-353" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb8-354"><a href="#cb8-354" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.6;</span></span>
<span id="cb8-355"><a href="#cb8-355" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0;</span></span>
<span id="cb8-356"><a href="#cb8-356" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb8-357"><a href="#cb8-357" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #f5f5f5;</span></span>
<span id="cb8-358"><a href="#cb8-358" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #333;</span></span>
<span id="cb8-359"><a href="#cb8-359" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: none; /* Remove limita√ß√£o de largura - TELA COMPLETA */</span></span>
<span id="cb8-360"><a href="#cb8-360" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-361"><a href="#cb8-361" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-362"><a href="#cb8-362" aria-hidden="true" tabindex="-1"></a><span class="st">            .container {</span></span>
<span id="cb8-363"><a href="#cb8-363" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb8-364"><a href="#cb8-364" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0 auto;</span></span>
<span id="cb8-365"><a href="#cb8-365" aria-hidden="true" tabindex="-1"></a><span class="st">                background: white;</span></span>
<span id="cb8-366"><a href="#cb8-366" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 40px;</span></span>
<span id="cb8-367"><a href="#cb8-367" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 10px;</span></span>
<span id="cb8-368"><a href="#cb8-368" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb8-369"><a href="#cb8-369" aria-hidden="true" tabindex="-1"></a><span class="st">                position: relative; /* Para posicionamento do TOC */</span></span>
<span id="cb8-370"><a href="#cb8-370" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-371"><a href="#cb8-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-372"><a href="#cb8-372" aria-hidden="true" tabindex="-1"></a><span class="st">            /* TOC FLUTUANTE OTIMIZADO */</span></span>
<span id="cb8-373"><a href="#cb8-373" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC {</span></span>
<span id="cb8-374"><a href="#cb8-374" aria-hidden="true" tabindex="-1"></a><span class="st">                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);</span></span>
<span id="cb8-375"><a href="#cb8-375" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #dee2e6;</span></span>
<span id="cb8-376"><a href="#cb8-376" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb8-377"><a href="#cb8-377" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb8-378"><a href="#cb8-378" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 20px 0;</span></span>
<span id="cb8-379"><a href="#cb8-379" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb8-380"><a href="#cb8-380" aria-hidden="true" tabindex="-1"></a><span class="st">                float: right; /* FLUTUA √Ä DIREITA */</span></span>
<span id="cb8-381"><a href="#cb8-381" aria-hidden="true" tabindex="-1"></a><span class="st">                width: 320px; /* Largura fixa para TOC */</span></span>
<span id="cb8-382"><a href="#cb8-382" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-left: 30px;</span></span>
<span id="cb8-383"><a href="#cb8-383" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-bottom: 30px;</span></span>
<span id="cb8-384"><a href="#cb8-384" aria-hidden="true" tabindex="-1"></a><span class="st">                position: relative;</span></span>
<span id="cb8-385"><a href="#cb8-385" aria-hidden="true" tabindex="-1"></a><span class="st">                z-index: 100;</span></span>
<span id="cb8-386"><a href="#cb8-386" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-387"><a href="#cb8-387" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-388"><a href="#cb8-388" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul {</span></span>
<span id="cb8-389"><a href="#cb8-389" aria-hidden="true" tabindex="-1"></a><span class="st">                list-style-type: none;</span></span>
<span id="cb8-390"><a href="#cb8-390" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 15px;</span></span>
<span id="cb8-391"><a href="#cb8-391" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 10px 0;</span></span>
<span id="cb8-392"><a href="#cb8-392" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-393"><a href="#cb8-393" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-394"><a href="#cb8-394" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul ul {</span></span>
<span id="cb8-395"><a href="#cb8-395" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 25px;</span></span>
<span id="cb8-396"><a href="#cb8-396" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-397"><a href="#cb8-397" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-398"><a href="#cb8-398" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC li {</span></span>
<span id="cb8-399"><a href="#cb8-399" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 8px 0;</span></span>
<span id="cb8-400"><a href="#cb8-400" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.4;</span></span>
<span id="cb8-401"><a href="#cb8-401" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-402"><a href="#cb8-402" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-403"><a href="#cb8-403" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a {</span></span>
<span id="cb8-404"><a href="#cb8-404" aria-hidden="true" tabindex="-1"></a><span class="st">                text-decoration: none;</span></span>
<span id="cb8-405"><a href="#cb8-405" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #495057;</span></span>
<span id="cb8-406"><a href="#cb8-406" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 500;</span></span>
<span id="cb8-407"><a href="#cb8-407" aria-hidden="true" tabindex="-1"></a><span class="st">                transition: color 0.2s ease;</span></span>
<span id="cb8-408"><a href="#cb8-408" aria-hidden="true" tabindex="-1"></a><span class="st">                display: block;</span></span>
<span id="cb8-409"><a href="#cb8-409" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 4px 8px;</span></span>
<span id="cb8-410"><a href="#cb8-410" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 4px;</span></span>
<span id="cb8-411"><a href="#cb8-411" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-412"><a href="#cb8-412" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-413"><a href="#cb8-413" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a:hover {</span></span>
<span id="cb8-414"><a href="#cb8-414" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #007bff;</span></span>
<span id="cb8-415"><a href="#cb8-415" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: rgba(0, 123, 255, 0.1);</span></span>
<span id="cb8-416"><a href="#cb8-416" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-417"><a href="#cb8-417" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-418"><a href="#cb8-418" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC &gt; ul &gt; li &gt; a {</span></span>
<span id="cb8-419"><a href="#cb8-419" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 600;</span></span>
<span id="cb8-420"><a href="#cb8-420" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50;</span></span>
<span id="cb8-421"><a href="#cb8-421" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 3px solid #3498db;</span></span>
<span id="cb8-422"><a href="#cb8-422" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 12px;</span></span>
<span id="cb8-423"><a href="#cb8-423" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-424"><a href="#cb8-424" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-425"><a href="#cb8-425" aria-hidden="true" tabindex="-1"></a><span class="st">            /* CLEARFIX PARA LAYOUT COM TOC FLUTUANTE */</span></span>
<span id="cb8-426"><a href="#cb8-426" aria-hidden="true" tabindex="-1"></a><span class="st">            .main-content {</span></span>
<span id="cb8-427"><a href="#cb8-427" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow: hidden; /* PREVINE PROBLEMAS COM ELEMENTOS FLUTUANTES */</span></span>
<span id="cb8-428"><a href="#cb8-428" aria-hidden="true" tabindex="-1"></a><span class="st">                position: relative;</span></span>
<span id="cb8-429"><a href="#cb8-429" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-430"><a href="#cb8-430" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-431"><a href="#cb8-431" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Estilos para numera√ß√£o de se√ß√µes */</span></span>
<span id="cb8-432"><a href="#cb8-432" aria-hidden="true" tabindex="-1"></a><span class="st">            .header-section-number {</span></span>
<span id="cb8-433"><a href="#cb8-433" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #3498db;</span></span>
<span id="cb8-434"><a href="#cb8-434" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: bold;</span></span>
<span id="cb8-435"><a href="#cb8-435" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-right: 8px;</span></span>
<span id="cb8-436"><a href="#cb8-436" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-437"><a href="#cb8-437" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-438"><a href="#cb8-438" aria-hidden="true" tabindex="-1"></a><span class="st">            h1 .header-section-number {</span></span>
<span id="cb8-439"><a href="#cb8-439" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.9em;</span></span>
<span id="cb8-440"><a href="#cb8-440" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-441"><a href="#cb8-441" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-442"><a href="#cb8-442" aria-hidden="true" tabindex="-1"></a><span class="st">            h2 .header-section-number {</span></span>
<span id="cb8-443"><a href="#cb8-443" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.85em;</span></span>
<span id="cb8-444"><a href="#cb8-444" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-445"><a href="#cb8-445" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-446"><a href="#cb8-446" aria-hidden="true" tabindex="-1"></a><span class="st">            h3 .header-section-number {</span></span>
<span id="cb8-447"><a href="#cb8-447" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.8em;</span></span>
<span id="cb8-448"><a href="#cb8-448" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-449"><a href="#cb8-449" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-450"><a href="#cb8-450" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para c√≥digo e matem√°tica */</span></span>
<span id="cb8-451"><a href="#cb8-451" aria-hidden="true" tabindex="-1"></a><span class="st">            .math { display: block; text-align: center; margin: 1.5em 0; }</span></span>
<span id="cb8-452"><a href="#cb8-452" aria-hidden="true" tabindex="-1"></a><span class="st">            .math inline { display: inline-block; }</span></span>
<span id="cb8-453"><a href="#cb8-453" aria-hidden="true" tabindex="-1"></a><span class="st">            pre { </span></span>
<span id="cb8-454"><a href="#cb8-454" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb8-455"><a href="#cb8-455" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #2d2d2d; </span></span>
<span id="cb8-456"><a href="#cb8-456" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #f8f8f2;</span></span>
<span id="cb8-457"><a href="#cb8-457" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb8-458"><a href="#cb8-458" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb8-459"><a href="#cb8-459" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow-x: auto;</span></span>
<span id="cb8-460"><a href="#cb8-460" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb8-461"><a href="#cb8-461" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.4;</span></span>
<span id="cb8-462"><a href="#cb8-462" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-463"><a href="#cb8-463" aria-hidden="true" tabindex="-1"></a><span class="st">            code { </span></span>
<span id="cb8-464"><a href="#cb8-464" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #e9ecef; </span></span>
<span id="cb8-465"><a href="#cb8-465" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 0.2em 0.4em; </span></span>
<span id="cb8-466"><a href="#cb8-466" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 3px;</span></span>
<span id="cb8-467"><a href="#cb8-467" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb8-468"><a href="#cb8-468" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #c7254e;</span></span>
<span id="cb8-469"><a href="#cb8-469" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-470"><a href="#cb8-470" aria-hidden="true" tabindex="-1"></a><span class="st">            pre code { </span></span>
<span id="cb8-471"><a href="#cb8-471" aria-hidden="true" tabindex="-1"></a><span class="st">                background: none; </span></span>
<span id="cb8-472"><a href="#cb8-472" aria-hidden="true" tabindex="-1"></a><span class="st">                color: inherit; </span></span>
<span id="cb8-473"><a href="#cb8-473" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 0; </span></span>
<span id="cb8-474"><a href="#cb8-474" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-475"><a href="#cb8-475" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-476"><a href="#cb8-476" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias responsivas */</span></span>
<span id="cb8-477"><a href="#cb8-477" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 1400px) {</span></span>
<span id="cb8-478"><a href="#cb8-478" aria-hidden="true" tabindex="-1"></a><span class="st">                .container {</span></span>
<span id="cb8-479"><a href="#cb8-479" aria-hidden="true" tabindex="-1"></a><span class="st">                    max-width: 98%;</span></span>
<span id="cb8-480"><a href="#cb8-480" aria-hidden="true" tabindex="-1"></a><span class="st">                    padding: 30px;</span></span>
<span id="cb8-481"><a href="#cb8-481" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb8-482"><a href="#cb8-482" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC {</span></span>
<span id="cb8-483"><a href="#cb8-483" aria-hidden="true" tabindex="-1"></a><span class="st">                    width: 280px; /* Reduz um pouco em telas menores */</span></span>
<span id="cb8-484"><a href="#cb8-484" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb8-485"><a href="#cb8-485" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-486"><a href="#cb8-486" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-487"><a href="#cb8-487" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 1200px) {</span></span>
<span id="cb8-488"><a href="#cb8-488" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC {</span></span>
<span id="cb8-489"><a href="#cb8-489" aria-hidden="true" tabindex="-1"></a><span class="st">                    float: none;</span></span>
<span id="cb8-490"><a href="#cb8-490" aria-hidden="true" tabindex="-1"></a><span class="st">                    width: auto;</span></span>
<span id="cb8-491"><a href="#cb8-491" aria-hidden="true" tabindex="-1"></a><span class="st">                    margin: 20px 0;</span></span>
<span id="cb8-492"><a href="#cb8-492" aria-hidden="true" tabindex="-1"></a><span class="st">                    position: static;</span></span>
<span id="cb8-493"><a href="#cb8-493" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb8-494"><a href="#cb8-494" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-495"><a href="#cb8-495" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-496"><a href="#cb8-496" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 768px) {</span></span>
<span id="cb8-497"><a href="#cb8-497" aria-hidden="true" tabindex="-1"></a><span class="st">                body { padding: 10px; font-size: 14px; }</span></span>
<span id="cb8-498"><a href="#cb8-498" aria-hidden="true" tabindex="-1"></a><span class="st">                .container { padding: 20px; max-width: 100%; }</span></span>
<span id="cb8-499"><a href="#cb8-499" aria-hidden="true" tabindex="-1"></a><span class="st">                pre { font-size: 12px; padding: 15px; }</span></span>
<span id="cb8-500"><a href="#cb8-500" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC { padding: 15px; }</span></span>
<span id="cb8-501"><a href="#cb8-501" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-502"><a href="#cb8-502" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-503"><a href="#cb8-503" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para tabelas */</span></span>
<span id="cb8-504"><a href="#cb8-504" aria-hidden="true" tabindex="-1"></a><span class="st">            table { </span></span>
<span id="cb8-505"><a href="#cb8-505" aria-hidden="true" tabindex="-1"></a><span class="st">                width: 100%; </span></span>
<span id="cb8-506"><a href="#cb8-506" aria-hidden="true" tabindex="-1"></a><span class="st">                border-collapse: collapse; </span></span>
<span id="cb8-507"><a href="#cb8-507" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 1.5em 0;</span></span>
<span id="cb8-508"><a href="#cb8-508" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb8-509"><a href="#cb8-509" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb8-510"><a href="#cb8-510" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow: hidden;</span></span>
<span id="cb8-511"><a href="#cb8-511" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-512"><a href="#cb8-512" aria-hidden="true" tabindex="-1"></a><span class="st">            th, td { </span></span>
<span id="cb8-513"><a href="#cb8-513" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #dee2e6; </span></span>
<span id="cb8-514"><a href="#cb8-514" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 12px 15px; </span></span>
<span id="cb8-515"><a href="#cb8-515" aria-hidden="true" tabindex="-1"></a><span class="st">                text-align: left; </span></span>
<span id="cb8-516"><a href="#cb8-516" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-517"><a href="#cb8-517" aria-hidden="true" tabindex="-1"></a><span class="st">            th { </span></span>
<span id="cb8-518"><a href="#cb8-518" aria-hidden="true" tabindex="-1"></a><span class="st">                background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb8-519"><a href="#cb8-519" aria-hidden="true" tabindex="-1"></a><span class="st">                color: white; </span></span>
<span id="cb8-520"><a href="#cb8-520" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: bold;</span></span>
<span id="cb8-521"><a href="#cb8-521" aria-hidden="true" tabindex="-1"></a><span class="st">                text-transform: uppercase;</span></span>
<span id="cb8-522"><a href="#cb8-522" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.9em;</span></span>
<span id="cb8-523"><a href="#cb8-523" aria-hidden="true" tabindex="-1"></a><span class="st">                letter-spacing: 0.5px;</span></span>
<span id="cb8-524"><a href="#cb8-524" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-525"><a href="#cb8-525" aria-hidden="true" tabindex="-1"></a><span class="st">            tr:nth-child(even) { </span></span>
<span id="cb8-526"><a href="#cb8-526" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #f8f9fa; </span></span>
<span id="cb8-527"><a href="#cb8-527" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-528"><a href="#cb8-528" aria-hidden="true" tabindex="-1"></a><span class="st">            tr:hover { </span></span>
<span id="cb8-529"><a href="#cb8-529" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #e3f2fd; </span></span>
<span id="cb8-530"><a href="#cb8-530" aria-hidden="true" tabindex="-1"></a><span class="st">                transition: background-color 0.2s ease;</span></span>
<span id="cb8-531"><a href="#cb8-531" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-532"><a href="#cb8-532" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-533"><a href="#cb8-533" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para blocos de cita√ß√£o */</span></span>
<span id="cb8-534"><a href="#cb8-534" aria-hidden="true" tabindex="-1"></a><span class="st">            blockquote { </span></span>
<span id="cb8-535"><a href="#cb8-535" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb8-536"><a href="#cb8-536" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 25px 0; </span></span>
<span id="cb8-537"><a href="#cb8-537" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 25px; </span></span>
<span id="cb8-538"><a href="#cb8-538" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #7f8c8d;</span></span>
<span id="cb8-539"><a href="#cb8-539" aria-hidden="true" tabindex="-1"></a><span class="st">                font-style: italic;</span></span>
<span id="cb8-540"><a href="#cb8-540" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #f8f9fa;</span></span>
<span id="cb8-541"><a href="#cb8-541" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb8-542"><a href="#cb8-542" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 0 8px 8px 0;</span></span>
<span id="cb8-543"><a href="#cb8-543" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-544"><a href="#cb8-544" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-545"><a href="#cb8-545" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Cabe√ßalhos com numera√ß√£o */</span></span>
<span id="cb8-546"><a href="#cb8-546" aria-hidden="true" tabindex="-1"></a><span class="st">            h1, h2, h3, h4, h5 { </span></span>
<span id="cb8-547"><a href="#cb8-547" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50; </span></span>
<span id="cb8-548"><a href="#cb8-548" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-top: 1.8em;</span></span>
<span id="cb8-549"><a href="#cb8-549" aria-hidden="true" tabindex="-1"></a><span class="st">                border-bottom: 1px solid #e9ecef;</span></span>
<span id="cb8-550"><a href="#cb8-550" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-bottom: 0.5em;</span></span>
<span id="cb8-551"><a href="#cb8-551" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-552"><a href="#cb8-552" aria-hidden="true" tabindex="-1"></a><span class="st">            h1 { </span></span>
<span id="cb8-553"><a href="#cb8-553" aria-hidden="true" tabindex="-1"></a><span class="st">                border-bottom: 3px solid #3498db; </span></span>
<span id="cb8-554"><a href="#cb8-554" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-bottom: 15px; </span></span>
<span id="cb8-555"><a href="#cb8-555" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50;</span></span>
<span id="cb8-556"><a href="#cb8-556" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 2.2em;</span></span>
<span id="cb8-557"><a href="#cb8-557" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-558"><a href="#cb8-558" aria-hidden="true" tabindex="-1"></a><span class="st">            h2 {</span></span>
<span id="cb8-559"><a href="#cb8-559" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db;</span></span>
<span id="cb8-560"><a href="#cb8-560" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 15px;</span></span>
<span id="cb8-561"><a href="#cb8-561" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-top: 2em;</span></span>
<span id="cb8-562"><a href="#cb8-562" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-563"><a href="#cb8-563" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-564"><a href="#cb8-564" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Scroll suave para links do TOC */</span></span>
<span id="cb8-565"><a href="#cb8-565" aria-hidden="true" tabindex="-1"></a><span class="st">            html {</span></span>
<span id="cb8-566"><a href="#cb8-566" aria-hidden="true" tabindex="-1"></a><span class="st">                scroll-behavior: smooth;</span></span>
<span id="cb8-567"><a href="#cb8-567" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-568"><a href="#cb8-568" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-569"><a href="#cb8-569" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Estilo para quando o TOC √© muito grande */</span></span>
<span id="cb8-570"><a href="#cb8-570" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC:has(ul ul ul ul) {</span></span>
<span id="cb8-571"><a href="#cb8-571" aria-hidden="true" tabindex="-1"></a><span class="st">                max-height: 80vh;</span></span>
<span id="cb8-572"><a href="#cb8-572" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow-y: auto;</span></span>
<span id="cb8-573"><a href="#cb8-573" aria-hidden="true" tabindex="-1"></a><span class="st">                position: sticky;</span></span>
<span id="cb8-574"><a href="#cb8-574" aria-hidden="true" tabindex="-1"></a><span class="st">                top: 20px;</span></span>
<span id="cb8-575"><a href="#cb8-575" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-576"><a href="#cb8-576" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-577"><a href="#cb8-577" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Indicador visual para se√ß√£o ativa no TOC */</span></span>
<span id="cb8-578"><a href="#cb8-578" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a.active {</span></span>
<span id="cb8-579"><a href="#cb8-579" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #007bff;</span></span>
<span id="cb8-580"><a href="#cb8-580" aria-hidden="true" tabindex="-1"></a><span class="st">                color: white;</span></span>
<span id="cb8-581"><a href="#cb8-581" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-582"><a href="#cb8-582" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/style&gt;</span></span>
<span id="cb8-583"><a href="#cb8-583" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb8-584"><a href="#cb8-584" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-585"><a href="#cb8-585" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;/head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb8-586"><a href="#cb8-586" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;/head&gt;&#39;</span>, <span class="ss">f&#39;</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;&#39;</span>)</span>
<span id="cb8-587"><a href="#cb8-587" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb8-588"><a href="#cb8-588" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb8-589"><a href="#cb8-589" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb8-590"><a href="#cb8-590" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;&lt;body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb8-591"><a href="#cb8-591" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;body&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;&#39;</span>)</span>
<span id="cb8-592"><a href="#cb8-592" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb8-593"><a href="#cb8-593" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;</span><span class="ch">\n</span><span class="sc">{</span>html_content<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/body&gt;&#39;</span></span>
<span id="cb8-594"><a href="#cb8-594" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-595"><a href="#cb8-595" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb8-596"><a href="#cb8-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-597"><a href="#cb8-597" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _enhance_toc_styling(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-598"><a href="#cb8-598" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Melhora o estilo do Table of Contents gerado pelo Pandoc&quot;&quot;&quot;</span></span>
<span id="cb8-599"><a href="#cb8-599" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona t√≠tulo ao TOC se n√£o existir</span></span>
<span id="cb8-600"><a href="#cb8-600" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;Table of Contents&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb8-601"><a href="#cb8-601" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(</span>
<span id="cb8-602"><a href="#cb8-602" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span>, </span>
<span id="cb8-603"><a href="#cb8-603" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&lt;h2 style=&quot;margin-top: 0; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;&quot;&gt;üìë Table of Contents&lt;/h2&gt;&#39;</span></span>
<span id="cb8-604"><a href="#cb8-604" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb8-605"><a href="#cb8-605" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-606"><a href="#cb8-606" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona wrapper para conte√∫do principal com clearfix</span></span>
<span id="cb8-607"><a href="#cb8-607" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;&lt;body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb8-608"><a href="#cb8-608" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Encontra o TOC e envolve o conte√∫do restante</span></span>
<span id="cb8-609"><a href="#cb8-609" aria-hidden="true" tabindex="-1"></a>            toc_end <span class="op">=</span> html_content.find(<span class="st">&#39;&lt;/div&gt;&#39;</span>, html_content.find(<span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span>)) <span class="op">+</span> <span class="dv">6</span></span>
<span id="cb8-610"><a href="#cb8-610" aria-hidden="true" tabindex="-1"></a>            body_content <span class="op">=</span> html_content[toc_end:]</span>
<span id="cb8-611"><a href="#cb8-611" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;&lt;div class=&quot;main-content&quot;&gt;&#39;</span> <span class="kw">not</span> <span class="kw">in</span> body_content:</span>
<span id="cb8-612"><a href="#cb8-612" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> html_content[:toc_end] <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&lt;div class=&quot;main-content&quot;&gt;&#39;</span> <span class="op">+</span> body_content <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&lt;/div&gt;&#39;</span></span>
<span id="cb8-613"><a href="#cb8-613" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-614"><a href="#cb8-614" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb8-615"><a href="#cb8-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-616"><a href="#cb8-616" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_fallback(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-617"><a href="#cb8-617" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Fallback para convers√£o quando Pandoc falha&quot;&quot;&quot;</span></span>
<span id="cb8-618"><a href="#cb8-618" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-619"><a href="#cb8-619" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(md_file_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-620"><a href="#cb8-620" aria-hidden="true" tabindex="-1"></a>                md_content <span class="op">=</span> f.read()</span>
<span id="cb8-621"><a href="#cb8-621" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-622"><a href="#cb8-622" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extens√µes avan√ßadas para melhor convers√£o</span></span>
<span id="cb8-623"><a href="#cb8-623" aria-hidden="true" tabindex="-1"></a>            extensions <span class="op">=</span> [</span>
<span id="cb8-624"><a href="#cb8-624" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;extra&#39;</span>, <span class="st">&#39;tables&#39;</span>, <span class="st">&#39;fenced_code&#39;</span>, <span class="st">&#39;codehilite&#39;</span>, </span>
<span id="cb8-625"><a href="#cb8-625" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;toc&#39;</span>, <span class="st">&#39;md_in_html&#39;</span>, <span class="st">&#39;attr_list&#39;</span></span>
<span id="cb8-626"><a href="#cb8-626" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb8-627"><a href="#cb8-627" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-628"><a href="#cb8-628" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> markdown.markdown(</span>
<span id="cb8-629"><a href="#cb8-629" aria-hidden="true" tabindex="-1"></a>                md_content,</span>
<span id="cb8-630"><a href="#cb8-630" aria-hidden="true" tabindex="-1"></a>                extensions<span class="op">=</span>extensions,</span>
<span id="cb8-631"><a href="#cb8-631" aria-hidden="true" tabindex="-1"></a>                output_format<span class="op">=</span><span class="st">&#39;html5&#39;</span></span>
<span id="cb8-632"><a href="#cb8-632" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb8-633"><a href="#cb8-633" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-634"><a href="#cb8-634" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_enhanced_html_template(html_content, Path(md_file_path).name)</span>
<span id="cb8-635"><a href="#cb8-635" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-636"><a href="#cb8-636" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-637"><a href="#cb8-637" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Fallback tamb√©m falhou: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-638"><a href="#cb8-638" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_basic_html(md_content, Path(md_file_path).name)</span>
<span id="cb8-639"><a href="#cb8-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-640"><a href="#cb8-640" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_enhanced_html_template(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-641"><a href="#cb8-641" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Template HTML aprimorado com suporte a MathJax local/online e TOC flutuante&quot;&quot;&quot;</span></span>
<span id="cb8-642"><a href="#cb8-642" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb8-643"><a href="#cb8-643" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-644"><a href="#cb8-644" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb8-645"><a href="#cb8-645" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html lang=&quot;pt-BR&quot;&gt;</span></span>
<span id="cb8-646"><a href="#cb8-646" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb8-647"><a href="#cb8-647" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb8-648"><a href="#cb8-648" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb8-649"><a href="#cb8-649" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb8-650"><a href="#cb8-650" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb8-651"><a href="#cb8-651" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* LAYOUT DE TELA COMPLETA OTIMIZADO */</span></span>
<span id="cb8-652"><a href="#cb8-652" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span></span>
<span id="cb8-653"><a href="#cb8-653" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb8-654"><a href="#cb8-654" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb8-655"><a href="#cb8-655" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0;</span></span>
<span id="cb8-656"><a href="#cb8-656" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb8-657"><a href="#cb8-657" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb8-658"><a href="#cb8-658" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333;</span></span>
<span id="cb8-659"><a href="#cb8-659" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: none; /* Remove limita√ß√£o de largura - TELA COMPLETA */</span></span>
<span id="cb8-660"><a href="#cb8-660" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-661"><a href="#cb8-661" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb8-662"><a href="#cb8-662" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb8-663"><a href="#cb8-663" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb8-664"><a href="#cb8-664" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb8-665"><a href="#cb8-665" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 40px;</span></span>
<span id="cb8-666"><a href="#cb8-666" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 10px;</span></span>
<span id="cb8-667"><a href="#cb8-667" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb8-668"><a href="#cb8-668" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: relative; /* Para posicionamento do TOC */</span></span>
<span id="cb8-669"><a href="#cb8-669" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-670"><a href="#cb8-670" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-671"><a href="#cb8-671" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* TOC FLUTUANTE MANUAL */</span></span>
<span id="cb8-672"><a href="#cb8-672" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc </span><span class="ch">{{</span></span>
<span id="cb8-673"><a href="#cb8-673" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);</span></span>
<span id="cb8-674"><a href="#cb8-674" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #dee2e6;</span></span>
<span id="cb8-675"><a href="#cb8-675" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb8-676"><a href="#cb8-676" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb8-677"><a href="#cb8-677" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 20px 0;</span></span>
<span id="cb8-678"><a href="#cb8-678" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb8-679"><a href="#cb8-679" aria-hidden="true" tabindex="-1"></a><span class="ss">            float: right; /* FLUTUA √Ä DIREITA */</span></span>
<span id="cb8-680"><a href="#cb8-680" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 320px; /* Largura fixa para TOC */</span></span>
<span id="cb8-681"><a href="#cb8-681" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 30px;</span></span>
<span id="cb8-682"><a href="#cb8-682" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 30px;</span></span>
<span id="cb8-683"><a href="#cb8-683" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: relative;</span></span>
<span id="cb8-684"><a href="#cb8-684" aria-hidden="true" tabindex="-1"></a><span class="ss">            z-index: 100;</span></span>
<span id="cb8-685"><a href="#cb8-685" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-686"><a href="#cb8-686" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-687"><a href="#cb8-687" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc h2 </span><span class="ch">{{</span></span>
<span id="cb8-688"><a href="#cb8-688" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb8-689"><a href="#cb8-689" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb8-690"><a href="#cb8-690" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 2px solid #3498db;</span></span>
<span id="cb8-691"><a href="#cb8-691" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 10px;</span></span>
<span id="cb8-692"><a href="#cb8-692" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-693"><a href="#cb8-693" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc ul </span><span class="ch">{{</span></span>
<span id="cb8-694"><a href="#cb8-694" aria-hidden="true" tabindex="-1"></a><span class="ss">            list-style-type: none;</span></span>
<span id="cb8-695"><a href="#cb8-695" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb8-696"><a href="#cb8-696" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-697"><a href="#cb8-697" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc li </span><span class="ch">{{</span></span>
<span id="cb8-698"><a href="#cb8-698" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 8px 0;</span></span>
<span id="cb8-699"><a href="#cb8-699" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-700"><a href="#cb8-700" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc a </span><span class="ch">{{</span></span>
<span id="cb8-701"><a href="#cb8-701" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb8-702"><a href="#cb8-702" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #495057;</span></span>
<span id="cb8-703"><a href="#cb8-703" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb8-704"><a href="#cb8-704" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: block;</span></span>
<span id="cb8-705"><a href="#cb8-705" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 8px;</span></span>
<span id="cb8-706"><a href="#cb8-706" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb8-707"><a href="#cb8-707" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-708"><a href="#cb8-708" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc a:hover </span><span class="ch">{{</span></span>
<span id="cb8-709"><a href="#cb8-709" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #007bff;</span></span>
<span id="cb8-710"><a href="#cb8-710" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: rgba(0, 123, 255, 0.1);</span></span>
<span id="cb8-711"><a href="#cb8-711" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-712"><a href="#cb8-712" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-713"><a href="#cb8-713" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* CLEARFIX PARA LAYOUT COM TOC FLUTUANTE */</span></span>
<span id="cb8-714"><a href="#cb8-714" aria-hidden="true" tabindex="-1"></a><span class="ss">        .main-content </span><span class="ch">{{</span></span>
<span id="cb8-715"><a href="#cb8-715" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden; /* PREVINE PROBLEMAS COM ELEMENTOS FLUTUANTES */</span></span>
<span id="cb8-716"><a href="#cb8-716" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: relative;</span></span>
<span id="cb8-717"><a href="#cb8-717" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-718"><a href="#cb8-718" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-719"><a href="#cb8-719" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1, h2, h3, h4, h5 </span><span class="ch">{{</span></span>
<span id="cb8-720"><a href="#cb8-720" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb8-721"><a href="#cb8-721" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 1.8em;</span></span>
<span id="cb8-722"><a href="#cb8-722" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-723"><a href="#cb8-723" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1 </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-724"><a href="#cb8-724" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 3px solid #3498db; </span></span>
<span id="cb8-725"><a href="#cb8-725" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 15px; </span></span>
<span id="cb8-726"><a href="#cb8-726" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb8-727"><a href="#cb8-727" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 2.2em;</span></span>
<span id="cb8-728"><a href="#cb8-728" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-729"><a href="#cb8-729" aria-hidden="true" tabindex="-1"></a><span class="ss">        h2 </span><span class="ch">{{</span></span>
<span id="cb8-730"><a href="#cb8-730" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb8-731"><a href="#cb8-731" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb8-732"><a href="#cb8-732" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 2em;</span></span>
<span id="cb8-733"><a href="#cb8-733" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-734"><a href="#cb8-734" aria-hidden="true" tabindex="-1"></a><span class="ss">        code </span><span class="ch">{{</span></span>
<span id="cb8-735"><a href="#cb8-735" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f4f4f4;</span></span>
<span id="cb8-736"><a href="#cb8-736" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 3px 8px;</span></span>
<span id="cb8-737"><a href="#cb8-737" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb8-738"><a href="#cb8-738" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb8-739"><a href="#cb8-739" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #c7254e;</span></span>
<span id="cb8-740"><a href="#cb8-740" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb8-741"><a href="#cb8-741" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-742"><a href="#cb8-742" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span></span>
<span id="cb8-743"><a href="#cb8-743" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #2d2d2d;</span></span>
<span id="cb8-744"><a href="#cb8-744" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #f8f8f2;</span></span>
<span id="cb8-745"><a href="#cb8-745" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb8-746"><a href="#cb8-746" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb8-747"><a href="#cb8-747" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb8-748"><a href="#cb8-748" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 5px solid #3498db;</span></span>
<span id="cb8-749"><a href="#cb8-749" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb8-750"><a href="#cb8-750" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.4;</span></span>
<span id="cb8-751"><a href="#cb8-751" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-752"><a href="#cb8-752" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre code </span><span class="ch">{{</span></span>
<span id="cb8-753"><a href="#cb8-753" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: none;</span></span>
<span id="cb8-754"><a href="#cb8-754" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: inherit;</span></span>
<span id="cb8-755"><a href="#cb8-755" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 0;</span></span>
<span id="cb8-756"><a href="#cb8-756" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-757"><a href="#cb8-757" aria-hidden="true" tabindex="-1"></a><span class="ss">        blockquote </span><span class="ch">{{</span></span>
<span id="cb8-758"><a href="#cb8-758" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb8-759"><a href="#cb8-759" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 25px 0;</span></span>
<span id="cb8-760"><a href="#cb8-760" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 25px;</span></span>
<span id="cb8-761"><a href="#cb8-761" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb8-762"><a href="#cb8-762" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-style: italic;</span></span>
<span id="cb8-763"><a href="#cb8-763" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb8-764"><a href="#cb8-764" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb8-765"><a href="#cb8-765" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 0 8px 8px 0;</span></span>
<span id="cb8-766"><a href="#cb8-766" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-767"><a href="#cb8-767" aria-hidden="true" tabindex="-1"></a><span class="ss">        table </span><span class="ch">{{</span></span>
<span id="cb8-768"><a href="#cb8-768" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-collapse: collapse;</span></span>
<span id="cb8-769"><a href="#cb8-769" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 100%;</span></span>
<span id="cb8-770"><a href="#cb8-770" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb8-771"><a href="#cb8-771" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb8-772"><a href="#cb8-772" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb8-773"><a href="#cb8-773" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb8-774"><a href="#cb8-774" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-775"><a href="#cb8-775" aria-hidden="true" tabindex="-1"></a><span class="ss">        th, td </span><span class="ch">{{</span></span>
<span id="cb8-776"><a href="#cb8-776" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb8-777"><a href="#cb8-777" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb8-778"><a href="#cb8-778" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: left;</span></span>
<span id="cb8-779"><a href="#cb8-779" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-780"><a href="#cb8-780" aria-hidden="true" tabindex="-1"></a><span class="ss">        th </span><span class="ch">{{</span></span>
<span id="cb8-781"><a href="#cb8-781" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb8-782"><a href="#cb8-782" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb8-783"><a href="#cb8-783" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb8-784"><a href="#cb8-784" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-transform: uppercase;</span></span>
<span id="cb8-785"><a href="#cb8-785" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb8-786"><a href="#cb8-786" aria-hidden="true" tabindex="-1"></a><span class="ss">            letter-spacing: 0.5px;</span></span>
<span id="cb8-787"><a href="#cb8-787" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-788"><a href="#cb8-788" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:nth-child(even) </span><span class="ch">{{</span></span>
<span id="cb8-789"><a href="#cb8-789" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f8f9fa;</span></span>
<span id="cb8-790"><a href="#cb8-790" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-791"><a href="#cb8-791" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:hover </span><span class="ch">{{</span></span>
<span id="cb8-792"><a href="#cb8-792" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #e3f2fd;</span></span>
<span id="cb8-793"><a href="#cb8-793" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: background-color 0.2s ease;</span></span>
<span id="cb8-794"><a href="#cb8-794" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-795"><a href="#cb8-795" aria-hidden="true" tabindex="-1"></a><span class="ss">        .math </span><span class="ch">{{</span></span>
<span id="cb8-796"><a href="#cb8-796" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center;</span></span>
<span id="cb8-797"><a href="#cb8-797" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb8-798"><a href="#cb8-798" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb8-799"><a href="#cb8-799" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb8-800"><a href="#cb8-800" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb8-801"><a href="#cb8-801" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb8-802"><a href="#cb8-802" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-803"><a href="#cb8-803" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-header </span><span class="ch">{{</span></span>
<span id="cb8-804"><a href="#cb8-804" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb8-805"><a href="#cb8-805" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between;</span></span>
<span id="cb8-806"><a href="#cb8-806" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: center;</span></span>
<span id="cb8-807"><a href="#cb8-807" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 15px;</span></span>
<span id="cb8-808"><a href="#cb8-808" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb8-809"><a href="#cb8-809" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 10px;</span></span>
<span id="cb8-810"><a href="#cb8-810" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-811"><a href="#cb8-811" aria-hidden="true" tabindex="-1"></a><span class="ss">        .author </span><span class="ch">{{</span></span>
<span id="cb8-812"><a href="#cb8-812" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb8-813"><a href="#cb8-813" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb8-814"><a href="#cb8-814" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.1em;</span></span>
<span id="cb8-815"><a href="#cb8-815" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-816"><a href="#cb8-816" aria-hidden="true" tabindex="-1"></a><span class="ss">        .timestamp </span><span class="ch">{{</span></span>
<span id="cb8-817"><a href="#cb8-817" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb8-818"><a href="#cb8-818" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb8-819"><a href="#cb8-819" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e9ecef;</span></span>
<span id="cb8-820"><a href="#cb8-820" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 8px;</span></span>
<span id="cb8-821"><a href="#cb8-821" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb8-822"><a href="#cb8-822" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-823"><a href="#cb8-823" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-content </span><span class="ch">{{</span></span>
<span id="cb8-824"><a href="#cb8-824" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb8-825"><a href="#cb8-825" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb8-826"><a href="#cb8-826" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb8-827"><a href="#cb8-827" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb8-828"><a href="#cb8-828" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 20px;</span></span>
<span id="cb8-829"><a href="#cb8-829" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-830"><a href="#cb8-830" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata </span><span class="ch">{{</span></span>
<span id="cb8-831"><a href="#cb8-831" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e8f4fd;</span></span>
<span id="cb8-832"><a href="#cb8-832" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb8-833"><a href="#cb8-833" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb8-834"><a href="#cb8-834" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 25px;</span></span>
<span id="cb8-835"><a href="#cb8-835" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb8-836"><a href="#cb8-836" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-837"><a href="#cb8-837" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata h3 </span><span class="ch">{{</span></span>
<span id="cb8-838"><a href="#cb8-838" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb8-839"><a href="#cb8-839" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb8-840"><a href="#cb8-840" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-841"><a href="#cb8-841" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-842"><a href="#cb8-842" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* Melhorias responsivas */</span></span>
<span id="cb8-843"><a href="#cb8-843" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 1400px) </span><span class="ch">{{</span></span>
<span id="cb8-844"><a href="#cb8-844" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb8-845"><a href="#cb8-845" aria-hidden="true" tabindex="-1"></a><span class="ss">                max-width: 98%;</span></span>
<span id="cb8-846"><a href="#cb8-846" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 30px;</span></span>
<span id="cb8-847"><a href="#cb8-847" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb8-848"><a href="#cb8-848" aria-hidden="true" tabindex="-1"></a><span class="ss">            .toc </span><span class="ch">{{</span></span>
<span id="cb8-849"><a href="#cb8-849" aria-hidden="true" tabindex="-1"></a><span class="ss">                width: 280px; /* Reduz um pouco em telas menores */</span></span>
<span id="cb8-850"><a href="#cb8-850" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb8-851"><a href="#cb8-851" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-852"><a href="#cb8-852" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-853"><a href="#cb8-853" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 1200px) </span><span class="ch">{{</span></span>
<span id="cb8-854"><a href="#cb8-854" aria-hidden="true" tabindex="-1"></a><span class="ss">            .toc </span><span class="ch">{{</span></span>
<span id="cb8-855"><a href="#cb8-855" aria-hidden="true" tabindex="-1"></a><span class="ss">                float: none;</span></span>
<span id="cb8-856"><a href="#cb8-856" aria-hidden="true" tabindex="-1"></a><span class="ss">                width: auto;</span></span>
<span id="cb8-857"><a href="#cb8-857" aria-hidden="true" tabindex="-1"></a><span class="ss">                margin: 20px 0;</span></span>
<span id="cb8-858"><a href="#cb8-858" aria-hidden="true" tabindex="-1"></a><span class="ss">                position: static;</span></span>
<span id="cb8-859"><a href="#cb8-859" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb8-860"><a href="#cb8-860" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-861"><a href="#cb8-861" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-862"><a href="#cb8-862" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 768px) </span><span class="ch">{{</span></span>
<span id="cb8-863"><a href="#cb8-863" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb8-864"><a href="#cb8-864" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 20px;</span></span>
<span id="cb8-865"><a href="#cb8-865" aria-hidden="true" tabindex="-1"></a><span class="ss">                max-width: 100%;</span></span>
<span id="cb8-866"><a href="#cb8-866" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb8-867"><a href="#cb8-867" aria-hidden="true" tabindex="-1"></a><span class="ss">            body </span><span class="ch">{{</span></span>
<span id="cb8-868"><a href="#cb8-868" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 10px;</span></span>
<span id="cb8-869"><a href="#cb8-869" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb8-870"><a href="#cb8-870" aria-hidden="true" tabindex="-1"></a><span class="ss">            h1 </span><span class="ch">{{</span></span>
<span id="cb8-871"><a href="#cb8-871" aria-hidden="true" tabindex="-1"></a><span class="ss">                font-size: 1.8em;</span></span>
<span id="cb8-872"><a href="#cb8-872" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb8-873"><a href="#cb8-873" aria-hidden="true" tabindex="-1"></a><span class="ss">            .message-header </span><span class="ch">{{</span></span>
<span id="cb8-874"><a href="#cb8-874" aria-hidden="true" tabindex="-1"></a><span class="ss">                flex-direction: column;</span></span>
<span id="cb8-875"><a href="#cb8-875" aria-hidden="true" tabindex="-1"></a><span class="ss">                align-items: flex-start;</span></span>
<span id="cb8-876"><a href="#cb8-876" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb8-877"><a href="#cb8-877" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-878"><a href="#cb8-878" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-879"><a href="#cb8-879" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* Scroll suave */</span></span>
<span id="cb8-880"><a href="#cb8-880" aria-hidden="true" tabindex="-1"></a><span class="ss">        html </span><span class="ch">{{</span></span>
<span id="cb8-881"><a href="#cb8-881" aria-hidden="true" tabindex="-1"></a><span class="ss">            scroll-behavior: smooth;</span></span>
<span id="cb8-882"><a href="#cb8-882" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-883"><a href="#cb8-883" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb8-884"><a href="#cb8-884" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb8-885"><a href="#cb8-885" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb8-886"><a href="#cb8-886" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb8-887"><a href="#cb8-887" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="sc">{</span>content<span class="sc">}</span></span>
<span id="cb8-888"><a href="#cb8-888" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb8-889"><a href="#cb8-889" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb8-890"><a href="#cb8-890" aria-hidden="true" tabindex="-1"></a><span class="ss">        // Configura√ß√£o MathJax para melhor renderiza√ß√£o</span></span>
<span id="cb8-891"><a href="#cb8-891" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb8-892"><a href="#cb8-892" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb8-893"><a href="#cb8-893" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb8-894"><a href="#cb8-894" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb8-895"><a href="#cb8-895" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true,</span></span>
<span id="cb8-896"><a href="#cb8-896" aria-hidden="true" tabindex="-1"></a><span class="ss">                tags: &#39;ams&#39;</span></span>
<span id="cb8-897"><a href="#cb8-897" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb8-898"><a href="#cb8-898" aria-hidden="true" tabindex="-1"></a><span class="ss">            options: </span><span class="ch">{{</span></span>
<span id="cb8-899"><a href="#cb8-899" aria-hidden="true" tabindex="-1"></a><span class="ss">                skipHtmlTags: [&#39;script&#39;, &#39;noscript&#39;, &#39;style&#39;, &#39;textarea&#39;, &#39;pre&#39;],</span></span>
<span id="cb8-900"><a href="#cb8-900" aria-hidden="true" tabindex="-1"></a><span class="ss">                renderActions: </span><span class="ch">{{</span></span>
<span id="cb8-901"><a href="#cb8-901" aria-hidden="true" tabindex="-1"></a><span class="ss">                    addMenu: [0, &#39;&#39;, &#39;&#39;]</span></span>
<span id="cb8-902"><a href="#cb8-902" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb8-903"><a href="#cb8-903" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb8-904"><a href="#cb8-904" aria-hidden="true" tabindex="-1"></a><span class="ss">            startup: </span><span class="ch">{{</span></span>
<span id="cb8-905"><a href="#cb8-905" aria-hidden="true" tabindex="-1"></a><span class="ss">                pageReady() </span><span class="ch">{{</span></span>
<span id="cb8-906"><a href="#cb8-906" aria-hidden="true" tabindex="-1"></a><span class="ss">                    return MathJax.startup.defaultPageReady().then(() =&gt; </span><span class="ch">{{</span></span>
<span id="cb8-907"><a href="#cb8-907" aria-hidden="true" tabindex="-1"></a><span class="ss">                        console.log(&#39;MathJax carregado com sucesso&#39;);</span></span>
<span id="cb8-908"><a href="#cb8-908" aria-hidden="true" tabindex="-1"></a><span class="ss">                    </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb8-909"><a href="#cb8-909" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb8-910"><a href="#cb8-910" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb8-911"><a href="#cb8-911" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb8-912"><a href="#cb8-912" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-913"><a href="#cb8-913" aria-hidden="true" tabindex="-1"></a><span class="ss">        // Script para destacar se√ß√£o ativa no TOC (se existir)</span></span>
<span id="cb8-914"><a href="#cb8-914" aria-hidden="true" tabindex="-1"></a><span class="ss">        document.addEventListener(&#39;DOMContentLoaded&#39;, function() </span><span class="ch">{{</span></span>
<span id="cb8-915"><a href="#cb8-915" aria-hidden="true" tabindex="-1"></a><span class="ss">            const tocLinks = document.querySelectorAll(&#39;#TOC a, .toc a&#39;);</span></span>
<span id="cb8-916"><a href="#cb8-916" aria-hidden="true" tabindex="-1"></a><span class="ss">            const sections = document.querySelectorAll(&#39;h1, h2, h3, h4, h5&#39;);</span></span>
<span id="cb8-917"><a href="#cb8-917" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span></span>
<span id="cb8-918"><a href="#cb8-918" aria-hidden="true" tabindex="-1"></a><span class="ss">            function highlightActiveSection() </span><span class="ch">{{</span></span>
<span id="cb8-919"><a href="#cb8-919" aria-hidden="true" tabindex="-1"></a><span class="ss">                let currentSection = &#39;&#39;;</span></span>
<span id="cb8-920"><a href="#cb8-920" aria-hidden="true" tabindex="-1"></a><span class="ss">                const scrollY = window.pageYOffset;</span></span>
<span id="cb8-921"><a href="#cb8-921" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span></span>
<span id="cb8-922"><a href="#cb8-922" aria-hidden="true" tabindex="-1"></a><span class="ss">                sections.forEach(section =&gt; </span><span class="ch">{{</span></span>
<span id="cb8-923"><a href="#cb8-923" aria-hidden="true" tabindex="-1"></a><span class="ss">                    const sectionTop = section.offsetTop - 100;</span></span>
<span id="cb8-924"><a href="#cb8-924" aria-hidden="true" tabindex="-1"></a><span class="ss">                    if (scrollY &gt;= sectionTop) </span><span class="ch">{{</span></span>
<span id="cb8-925"><a href="#cb8-925" aria-hidden="true" tabindex="-1"></a><span class="ss">                        currentSection = section.getAttribute(&#39;id&#39;);</span></span>
<span id="cb8-926"><a href="#cb8-926" aria-hidden="true" tabindex="-1"></a><span class="ss">                    </span><span class="ch">}}</span></span>
<span id="cb8-927"><a href="#cb8-927" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb8-928"><a href="#cb8-928" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span></span>
<span id="cb8-929"><a href="#cb8-929" aria-hidden="true" tabindex="-1"></a><span class="ss">                tocLinks.forEach(link =&gt; </span><span class="ch">{{</span></span>
<span id="cb8-930"><a href="#cb8-930" aria-hidden="true" tabindex="-1"></a><span class="ss">                    link.classList.remove(&#39;active&#39;);</span></span>
<span id="cb8-931"><a href="#cb8-931" aria-hidden="true" tabindex="-1"></a><span class="ss">                    if (link.getAttribute(&#39;href&#39;) === &#39;#&#39; + currentSection) </span><span class="ch">{{</span></span>
<span id="cb8-932"><a href="#cb8-932" aria-hidden="true" tabindex="-1"></a><span class="ss">                        link.classList.add(&#39;active&#39;);</span></span>
<span id="cb8-933"><a href="#cb8-933" aria-hidden="true" tabindex="-1"></a><span class="ss">                    </span><span class="ch">}}</span></span>
<span id="cb8-934"><a href="#cb8-934" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb8-935"><a href="#cb8-935" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb8-936"><a href="#cb8-936" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span></span>
<span id="cb8-937"><a href="#cb8-937" aria-hidden="true" tabindex="-1"></a><span class="ss">            if (tocLinks.length &gt; 0) </span><span class="ch">{{</span></span>
<span id="cb8-938"><a href="#cb8-938" aria-hidden="true" tabindex="-1"></a><span class="ss">                window.addEventListener(&#39;scroll&#39;, highlightActiveSection);</span></span>
<span id="cb8-939"><a href="#cb8-939" aria-hidden="true" tabindex="-1"></a><span class="ss">                highlightActiveSection(); // Chamar inicialmente</span></span>
<span id="cb8-940"><a href="#cb8-940" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb8-941"><a href="#cb8-941" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb8-942"><a href="#cb8-942" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb8-943"><a href="#cb8-943" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb8-944"><a href="#cb8-944" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb8-945"><a href="#cb8-945" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb8-946"><a href="#cb8-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-947"><a href="#cb8-947" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_basic_html(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-948"><a href="#cb8-948" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;HTML b√°sico de √∫ltimo recurso com MathJax&quot;&quot;&quot;</span></span>
<span id="cb8-949"><a href="#cb8-949" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb8-950"><a href="#cb8-950" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-951"><a href="#cb8-951" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb8-952"><a href="#cb8-952" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html&gt;</span></span>
<span id="cb8-953"><a href="#cb8-953" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb8-954"><a href="#cb8-954" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb8-955"><a href="#cb8-955" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb8-956"><a href="#cb8-956" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb8-957"><a href="#cb8-957" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-958"><a href="#cb8-958" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif; </span></span>
<span id="cb8-959"><a href="#cb8-959" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px; </span></span>
<span id="cb8-960"><a href="#cb8-960" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb8-961"><a href="#cb8-961" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb8-962"><a href="#cb8-962" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: none; /* Remove limita√ß√£o de largura - TELA COMPLETA */</span></span>
<span id="cb8-963"><a href="#cb8-963" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-964"><a href="#cb8-964" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-965"><a href="#cb8-965" aria-hidden="true" tabindex="-1"></a><span class="ss">            white-space: pre-wrap; </span></span>
<span id="cb8-966"><a href="#cb8-966" aria-hidden="true" tabindex="-1"></a><span class="ss">            word-wrap: break-word; </span></span>
<span id="cb8-967"><a href="#cb8-967" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb8-968"><a href="#cb8-968" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb8-969"><a href="#cb8-969" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 5px;</span></span>
<span id="cb8-970"><a href="#cb8-970" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb8-971"><a href="#cb8-971" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-972"><a href="#cb8-972" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb8-973"><a href="#cb8-973" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb8-974"><a href="#cb8-974" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb8-975"><a href="#cb8-975" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb8-976"><a href="#cb8-976" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 30px;</span></span>
<span id="cb8-977"><a href="#cb8-977" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb8-978"><a href="#cb8-978" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb8-979"><a href="#cb8-979" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-980"><a href="#cb8-980" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb8-981"><a href="#cb8-981" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb8-982"><a href="#cb8-982" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb8-983"><a href="#cb8-983" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb8-984"><a href="#cb8-984" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb8-985"><a href="#cb8-985" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb8-986"><a href="#cb8-986" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true</span></span>
<span id="cb8-987"><a href="#cb8-987" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb8-988"><a href="#cb8-988" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb8-989"><a href="#cb8-989" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb8-990"><a href="#cb8-990" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb8-991"><a href="#cb8-991" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb8-992"><a href="#cb8-992" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb8-993"><a href="#cb8-993" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb8-994"><a href="#cb8-994" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;pre&gt;</span><span class="sc">{</span>content<span class="sc">}</span><span class="ss">&lt;/pre&gt;</span></span>
<span id="cb8-995"><a href="#cb8-995" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb8-996"><a href="#cb8-996" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb8-997"><a href="#cb8-997" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb8-998"><a href="#cb8-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-999"><a href="#cb8-999" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_html_robust(<span class="va">self</span>):</span>
<span id="cb8-1000"><a href="#cb8-1000" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;M√©todo ROBUSTO para convers√£o HTML - VERS√ÉO OTIMIZADA&quot;&quot;&quot;</span></span>
<span id="cb8-1001"><a href="#cb8-1001" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1002"><a href="#cb8-1002" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] HTMLs seriam criados:&quot;</span>)</span>
<span id="cb8-1003"><a href="#cb8-1003" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-1004"><a href="#cb8-1004" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb8-1005"><a href="#cb8-1005" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.html&quot;</span></span>
<span id="cb8-1006"><a href="#cb8-1006" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üåê </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1007"><a href="#cb8-1007" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1008"><a href="#cb8-1008" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1009"><a href="#cb8-1009" aria-hidden="true" tabindex="-1"></a>        markdown_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;markdown&#39;</span>])</span>
<span id="cb8-1010"><a href="#cb8-1010" aria-hidden="true" tabindex="-1"></a>        html_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;html&#39;</span>])</span>
<span id="cb8-1011"><a href="#cb8-1011" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1012"><a href="#cb8-1012" aria-hidden="true" tabindex="-1"></a>        md_files <span class="op">=</span> <span class="bu">list</span>(markdown_folder.glob(<span class="st">&quot;*.md&quot;</span>))</span>
<span id="cb8-1013"><a href="#cb8-1013" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1014"><a href="#cb8-1014" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> md_files:</span>
<span id="cb8-1015"><a href="#cb8-1015" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Nenhum arquivo Markdown encontrado para convers√£o.&quot;</span>)</span>
<span id="cb8-1016"><a href="#cb8-1016" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1017"><a href="#cb8-1017" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1018"><a href="#cb8-1018" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÑ Convertendo </span><span class="sc">{</span><span class="bu">len</span>(md_files)<span class="sc">}</span><span class="ss"> arquivos Markdown para HTML (OTIMIZADO)...&quot;</span>)</span>
<span id="cb8-1019"><a href="#cb8-1019" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1020"><a href="#cb8-1020" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verifica se Pandoc est√° dispon√≠vel</span></span>
<span id="cb8-1021"><a href="#cb8-1021" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-1022"><a href="#cb8-1022" aria-hidden="true" tabindex="-1"></a>            subprocess.run([<span class="st">&#39;pandoc&#39;</span>, <span class="st">&#39;--version&#39;</span>], capture_output<span class="op">=</span><span class="va">True</span>, check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-1023"><a href="#cb8-1023" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">True</span></span>
<span id="cb8-1024"><a href="#cb8-1024" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;‚úÖ Pandoc dispon√≠vel - usando convers√£o otimizada&quot;</span>)</span>
<span id="cb8-1025"><a href="#cb8-1025" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb8-1026"><a href="#cb8-1026" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">False</span></span>
<span id="cb8-1027"><a href="#cb8-1027" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è Pandoc n√£o dispon√≠vel - usando fallback Python&quot;</span>)</span>
<span id="cb8-1028"><a href="#cb8-1028" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1029"><a href="#cb8-1029" aria-hidden="true" tabindex="-1"></a>        converted_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-1030"><a href="#cb8-1030" aria-hidden="true" tabindex="-1"></a>        failed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-1031"><a href="#cb8-1031" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1032"><a href="#cb8-1032" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> md_file <span class="kw">in</span> md_files:</span>
<span id="cb8-1033"><a href="#cb8-1033" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb8-1034"><a href="#cb8-1034" aria-hidden="true" tabindex="-1"></a>                html_file <span class="op">=</span> html_folder <span class="op">/</span> md_file.with_suffix(<span class="st">&#39;.html&#39;</span>).name</span>
<span id="cb8-1035"><a href="#cb8-1035" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1036"><a href="#cb8-1036" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> html_file.exists():</span>
<span id="cb8-1037"><a href="#cb8-1037" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚è≠Ô∏è  J√° existe: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1038"><a href="#cb8-1038" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1039"><a href="#cb8-1039" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb8-1040"><a href="#cb8-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1041"><a href="#cb8-1041" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ Processando: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1042"><a href="#cb8-1042" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1043"><a href="#cb8-1043" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> pandoc_available:</span>
<span id="cb8-1044"><a href="#cb8-1044" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_pandoc_optimized(<span class="bu">str</span>(md_file))</span>
<span id="cb8-1045"><a href="#cb8-1045" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb8-1046"><a href="#cb8-1046" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_fallback(<span class="bu">str</span>(md_file))</span>
<span id="cb8-1047"><a href="#cb8-1047" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1048"><a href="#cb8-1048" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> html_content:</span>
<span id="cb8-1049"><a href="#cb8-1049" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(html_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1050"><a href="#cb8-1050" aria-hidden="true" tabindex="-1"></a>                        f.write(html_content)</span>
<span id="cb8-1051"><a href="#cb8-1051" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1052"><a href="#cb8-1052" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Criado: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1053"><a href="#cb8-1053" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1054"><a href="#cb8-1054" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb8-1055"><a href="#cb8-1055" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Falha na convers√£o: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1056"><a href="#cb8-1056" aria-hidden="true" tabindex="-1"></a>                    failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1057"><a href="#cb8-1057" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1058"><a href="#cb8-1058" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-1059"><a href="#cb8-1059" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro em </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1060"><a href="#cb8-1060" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(traceback.format_exc())</span>
<span id="cb8-1061"><a href="#cb8-1061" aria-hidden="true" tabindex="-1"></a>                failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1062"><a href="#cb8-1062" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1063"><a href="#cb8-1063" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä HTML: </span><span class="sc">{</span>converted_count<span class="sc">}</span><span class="ss"> arquivos criados, </span><span class="sc">{</span>failed_count<span class="sc">}</span><span class="ss"> falhas em &#39;</span><span class="sc">{</span>html_folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb8-1064"><a href="#cb8-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1065"><a href="#cb8-1065" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> categorize_conversation(<span class="va">self</span>, title: <span class="bu">str</span>, summary: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-1066"><a href="#cb8-1066" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Categoriza√ß√£o otimizada com express√µes regulares&quot;&quot;&quot;</span></span>
<span id="cb8-1067"><a href="#cb8-1067" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&quot;</span>.lower()</span>
<span id="cb8-1068"><a href="#cb8-1068" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1069"><a href="#cb8-1069" aria-hidden="true" tabindex="-1"></a>        patterns <span class="op">=</span> {</span>
<span id="cb8-1070"><a href="#cb8-1070" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Tecnologia&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">tecnologia</span><span class="cf">|</span><span class="vs">hardware</span><span class="cf">|</span><span class="vs">software</span><span class="cf">|</span><span class="vs">rede</span><span class="cf">|</span><span class="vs">internet</span><span class="cf">|</span><span class="vs">wifi</span><span class="cf">|</span><span class="vs">bluetooth</span><span class="cf">|</span><span class="pp">[45]</span><span class="vs">g</span><span class="cf">|</span><span class="vs">cloud</span><span class="cf">|</span><span class="vs">aws</span><span class="cf">|</span><span class="vs">azure</span><span class="cf">|</span><span class="vs">gcp</span><span class="cf">|</span><span class="vs">servidor</span><span class="cf">|</span><span class="vs">hosting</span><span class="cf">|</span><span class="vs">dom√≠nio</span><span class="cf">|</span><span class="vs">ssl</span><span class="cf">|</span><span class="vs">router</span><span class="cf">|</span><span class="vs">switch</span><span class="cf">|</span><span class="vs">firewall</span><span class="cf">|</span><span class="vs">iot</span><span class="cf">|</span><span class="vs">smartphone</span><span class="cf">|</span><span class="vs">tablet</span><span class="cf">|</span><span class="vs">navegador</span><span class="cf">|</span><span class="vs">browser</span><span class="cf">|</span><span class="vs">chrome</span><span class="cf">|</span><span class="vs">firefox</span><span class="cf">|</span><span class="vs">edge</span><span class="cf">|</span><span class="vs">safari</span><span class="cf">|</span><span class="vs">email</span><span class="cf">|</span><span class="vs">gmail</span><span class="cf">|</span><span class="vs">outlook</span><span class="cf">|</span><span class="vs">criptografia</span><span class="cf">|</span><span class="vs">seguran√ßa</span><span class="cf">|</span><span class="vs">ciberseguran√ßa</span><span class="cf">|</span><span class="vs">ransomware</span><span class="cf">|</span><span class="vs">phishing</span><span class="cf">|</span><span class="vs">autentica√ß√£o</span><span class="cf">|</span><span class="vs">2fa</span><span class="cf">|</span><span class="vs">biometria</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb8-1071"><a href="#cb8-1071" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Sa√∫de&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">sa√∫de</span><span class="cf">|</span><span class="vs">medicina</span><span class="cf">|</span><span class="vs">m√©dico</span><span class="cf">|</span><span class="vs">enfermagem</span><span class="cf">|</span><span class="vs">doen√ßa</span><span class="cf">|</span><span class="vs">v√≠rus</span><span class="cf">|</span><span class="vs">bact√©ria</span><span class="cf">|</span><span class="vs">vacina</span><span class="cf">|</span><span class="vs">covid</span><span class="cf">|</span><span class="vs">coronav√≠rus</span><span class="cf">|</span><span class="vs">gripe</span><span class="cf">|</span><span class="vs">febre</span><span class="cf">|</span><span class="vs">dor</span><span class="cf">|</span><span class="vs">an√°lise</span><span class="cf">|</span><span class="vs">exame</span><span class="cf">|</span><span class="vs">raio x</span><span class="cf">|</span><span class="vs">resson√¢ncia</span><span class="cf">|</span><span class="vs">hospital</span><span class="cf">|</span><span class="vs">cl√≠nica</span><span class="cf">|</span><span class="vs">farm√°cia</span><span class="cf">|</span><span class="vs">medicamento</span><span class="cf">|</span><span class="vs">rem√©dio</span><span class="cf">|</span><span class="vs">psicologia</span><span class="cf">|</span><span class="vs">terapia</span><span class="cf">|</span><span class="vs">bem-estar</span><span class="cf">|</span><span class="vs">nutri√ß√£o</span><span class="cf">|</span><span class="vs">dieta</span><span class="cf">|</span><span class="vs">exerc√≠cio</span><span class="cf">|</span><span class="vs">fitness</span><span class="cf">|</span><span class="vs">sono</span><span class="cf">|</span><span class="vs">sa√∫de mental</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb8-1072"><a href="#cb8-1072" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Programa√ß√£o&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">python</span><span class="cf">|</span><span class="vs">javascript</span><span class="cf">|</span><span class="vs">java</span><span class="cf">|</span><span class="vs">c</span><span class="ch">\+\+</span><span class="cf">|</span><span class="vs">c#</span><span class="cf">|</span><span class="vs">go</span><span class="cf">|</span><span class="vs">rust</span><span class="cf">|</span><span class="vs">lua</span><span class="cf">|</span><span class="vs">bash</span><span class="cf">|</span><span class="vs">script</span><span class="cf">|</span><span class="vs">debug</span><span class="cf">|</span><span class="vs">erro</span><span class="cf">|</span><span class="vs">conda</span><span class="cf">|</span><span class="vs">mamba</span><span class="cf">|</span><span class="vs">pandoc</span><span class="cf">|</span><span class="vs">msys2</span><span class="cf">|</span><span class="vs">spyder</span><span class="cf">|</span><span class="vs">jupyter</span><span class="cf">|</span><span class="vs">pip</span><span class="cf">|</span><span class="vs">venv</span><span class="cf">|</span><span class="vs">docker</span><span class="cf">|</span><span class="vs">git</span><span class="cf">|</span><span class="vs">github</span><span class="cf">|</span><span class="vs">vscode</span><span class="cf">|</span><span class="vs">ide</span><span class="cf">|</span><span class="vs">programa</span><span class="cf">|</span><span class="vs">c√≥digo</span><span class="cf">|</span><span class="vs">fun√ß√£o</span><span class="cf">|</span><span class="vs">classe</span><span class="cf">|</span><span class="vs">api</span><span class="cf">|</span><span class="vs">selenium</span><span class="cf">|</span><span class="vs">playwright</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb8-1073"><a href="#cb8-1073" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Sistemas&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">windows</span><span class="cf">|</span><span class="vs">linux</span><span class="cf">|</span><span class="vs">macos</span><span class="cf">|</span><span class="vs">so</span><span class="cf">|</span><span class="vs">sistema operacional</span><span class="cf">|</span><span class="vs">driver</span><span class="cf">|</span><span class="vs">registry</span><span class="cf">|</span><span class="vs">process</span><span class="cf">|</span><span class="vs">firewall</span><span class="cf">|</span><span class="vs">bios</span><span class="cf">|</span><span class="vs">boot</span><span class="cf">|</span><span class="vs">path</span><span class="cf">|</span><span class="vs">dll</span><span class="cf">|</span><span class="vs">exe</span><span class="cf">|</span><span class="vs">powershell</span><span class="cf">|</span><span class="vs">cmd</span><span class="cf">|</span><span class="vs">terminal</span><span class="cf">|</span><span class="vs">shell</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb8-1074"><a href="#cb8-1074" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;IA&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">ia</span><span class="cf">|</span><span class="vs">gpt</span><span class="cf">|</span><span class="vs">chatgpt</span><span class="cf">|</span><span class="vs">grok</span><span class="cf">|</span><span class="vs">qwen</span><span class="cf">|</span><span class="vs">deepseek</span><span class="cf">|</span><span class="vs">llm</span><span class="cf">|</span><span class="vs">modelo</span><span class="cf">|</span><span class="vs">prompt</span><span class="cf">|</span><span class="vs">token</span><span class="cf">|</span><span class="vs">embedding</span><span class="cf">|</span><span class="vs">fine-tune</span><span class="cf">|</span><span class="vs">neural</span><span class="cf">|</span><span class="vs">chatbot</span><span class="cf">|</span><span class="vs">intelig√™ncia artificial</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb8-1075"><a href="#cb8-1075" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Dados&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">dados</span><span class="cf">|</span><span class="vs">data</span><span class="cf">|</span><span class="vs">csv</span><span class="cf">|</span><span class="vs">json</span><span class="cf">|</span><span class="vs">pandas</span><span class="cf">|</span><span class="vs">numpy</span><span class="cf">|</span><span class="vs">excel</span><span class="cf">|</span><span class="vs">sql</span><span class="cf">|</span><span class="vs">banco</span><span class="cf">|</span><span class="vs">sqlite</span><span class="cf">|</span><span class="vs">postgres</span><span class="cf">|</span><span class="vs">visualiza√ß√£o</span><span class="cf">|</span><span class="vs">gr√°fico</span><span class="cf">|</span><span class="vs">tabela</span><span class="cf">|</span><span class="vs">an√°lise</span><span class="cf">|</span><span class="vs">etl</span><span class="cf">|</span><span class="vs">dashboard</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb8-1076"><a href="#cb8-1076" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Geral&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">geral</span><span class="cf">|</span><span class="vs">pergunta</span><span class="cf">|</span><span class="vs">ajuda</span><span class="cf">|</span><span class="vs">como fazer</span><span class="cf">|</span><span class="vs">explicar</span><span class="cf">|</span><span class="vs">resumo</span><span class="cf">|</span><span class="vs">tutorial b√°sico</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span></span>
<span id="cb8-1077"><a href="#cb8-1077" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-1078"><a href="#cb8-1078" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1079"><a href="#cb8-1079" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category, pattern <span class="kw">in</span> patterns.items():</span>
<span id="cb8-1080"><a href="#cb8-1080" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> re.search(pattern, text, re.IGNORECASE):</span>
<span id="cb8-1081"><a href="#cb8-1081" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> category</span>
<span id="cb8-1082"><a href="#cb8-1082" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1083"><a href="#cb8-1083" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Outros&#39;</span></span>
<span id="cb8-1084"><a href="#cb8-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1085"><a href="#cb8-1085" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_timestamp_for_sorting(<span class="va">self</span>, timestamp) <span class="op">-&gt;</span> datetime:</span>
<span id="cb8-1086"><a href="#cb8-1086" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> timestamp:</span>
<span id="cb8-1087"><a href="#cb8-1087" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> datetime.<span class="bu">min</span></span>
<span id="cb8-1088"><a href="#cb8-1088" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1089"><a href="#cb8-1089" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-1090"><a href="#cb8-1090" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(timestamp, <span class="bu">str</span>):</span>
<span id="cb8-1091"><a href="#cb8-1091" aria-hidden="true" tabindex="-1"></a>                clean_ts <span class="op">=</span> timestamp.replace(<span class="st">&#39;T&#39;</span>, <span class="st">&#39; &#39;</span>).split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>].split(<span class="st">&#39;+&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb8-1092"><a href="#cb8-1092" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> clean_ts.endswith(<span class="st">&#39;Z&#39;</span>):</span>
<span id="cb8-1093"><a href="#cb8-1093" aria-hidden="true" tabindex="-1"></a>                    clean_ts <span class="op">=</span> clean_ts[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb8-1094"><a href="#cb8-1094" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> datetime.fromisoformat(clean_ts)</span>
<span id="cb8-1095"><a href="#cb8-1095" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(timestamp, (<span class="bu">int</span>, <span class="bu">float</span>)):</span>
<span id="cb8-1096"><a href="#cb8-1096" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> datetime.fromtimestamp(timestamp)</span>
<span id="cb8-1097"><a href="#cb8-1097" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb8-1098"><a href="#cb8-1098" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb8-1099"><a href="#cb8-1099" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1100"><a href="#cb8-1100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> datetime.<span class="bu">min</span></span>
<span id="cb8-1101"><a href="#cb8-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1102"><a href="#cb8-1102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> format_timestamp(<span class="va">self</span>, timestamp) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb8-1103"><a href="#cb8-1103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> timestamp:</span>
<span id="cb8-1104"><a href="#cb8-1104" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb8-1105"><a href="#cb8-1105" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1106"><a href="#cb8-1106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-1107"><a href="#cb8-1107" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(timestamp, (<span class="bu">int</span>, <span class="bu">float</span>)):</span>
<span id="cb8-1108"><a href="#cb8-1108" aria-hidden="true" tabindex="-1"></a>                dt <span class="op">=</span> datetime.fromtimestamp(timestamp)</span>
<span id="cb8-1109"><a href="#cb8-1109" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> dt.strftime(<span class="st">&#39;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S&#39;</span>)</span>
<span id="cb8-1110"><a href="#cb8-1110" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(timestamp, <span class="bu">str</span>):</span>
<span id="cb8-1111"><a href="#cb8-1111" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">&#39;T&#39;</span> <span class="kw">in</span> timestamp:</span>
<span id="cb8-1112"><a href="#cb8-1112" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> timestamp.replace(<span class="st">&#39;T&#39;</span>, <span class="st">&#39; &#39;</span>).split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb8-1113"><a href="#cb8-1113" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> timestamp</span>
<span id="cb8-1114"><a href="#cb8-1114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb8-1115"><a href="#cb8-1115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb8-1116"><a href="#cb8-1116" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1117"><a href="#cb8-1117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">str</span>(timestamp)</span>
<span id="cb8-1118"><a href="#cb8-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1119"><a href="#cb8-1119" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_enhanced_markdown_content(<span class="va">self</span>, conversation: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb8-1120"><a href="#cb8-1120" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Gera conte√∫do Markdown com preserva√ß√£o total de formata√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb8-1121"><a href="#cb8-1121" aria-hidden="true" tabindex="-1"></a>        lines <span class="op">=</span> [</span>
<span id="cb8-1122"><a href="#cb8-1122" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;# </span><span class="sc">{</span>conversation[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-1123"><a href="#cb8-1123" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb8-1124"><a href="#cb8-1124" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;## üìä Informa√ß√µes&quot;</span>,</span>
<span id="cb8-1125"><a href="#cb8-1125" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **N√∫mero:** #</span><span class="sc">{</span>conversation[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-1126"><a href="#cb8-1126" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Origem:** </span><span class="sc">{</span>conversation[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-1127"><a href="#cb8-1127" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Categoria:** </span><span class="sc">{</span>conversation[<span class="st">&#39;category&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-1128"><a href="#cb8-1128" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **ID:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;id&#39;</span>, <span class="st">&#39;N/A&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-1129"><a href="#cb8-1129" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Criada em:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> conversation<span class="sc">.</span>get(<span class="st">&#39;created_at&#39;</span>) <span class="kw">or</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-1130"><a href="#cb8-1130" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb8-1131"><a href="#cb8-1131" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1132"><a href="#cb8-1132" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> conversation.get(<span class="st">&#39;updated_at&#39;</span>):</span>
<span id="cb8-1133"><a href="#cb8-1133" aria-hidden="true" tabindex="-1"></a>            lines.append(<span class="ss">f&quot;- **Atualizada em:** </span><span class="sc">{</span>conversation[<span class="st">&#39;updated_at&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1134"><a href="#cb8-1134" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1135"><a href="#cb8-1135" aria-hidden="true" tabindex="-1"></a>        lines.extend([</span>
<span id="cb8-1136"><a href="#cb8-1136" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Total de mensagens:** </span><span class="sc">{</span><span class="bu">len</span>(conversation[<span class="st">&#39;messages&#39;</span>])<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-1137"><a href="#cb8-1137" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Resumo:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;Sem resumo&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-1138"><a href="#cb8-1138" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb8-1139"><a href="#cb8-1139" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;---&quot;</span>,</span>
<span id="cb8-1140"><a href="#cb8-1140" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb8-1141"><a href="#cb8-1141" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;## üí¨ Conversa&quot;</span>,</span>
<span id="cb8-1142"><a href="#cb8-1142" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span></span>
<span id="cb8-1143"><a href="#cb8-1143" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb8-1144"><a href="#cb8-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1145"><a href="#cb8-1145" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, msg <span class="kw">in</span> <span class="bu">enumerate</span>(conversation[<span class="st">&#39;messages&#39;</span>], <span class="dv">1</span>):</span>
<span id="cb8-1146"><a href="#cb8-1146" aria-hidden="true" tabindex="-1"></a>            timestamp <span class="op">=</span> <span class="ss">f&quot; *(</span><span class="sc">{</span>msg[<span class="st">&#39;timestamp&#39;</span>]<span class="sc">}</span><span class="ss">)*&quot;</span> <span class="cf">if</span> msg[<span class="st">&#39;timestamp&#39;</span>] <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb8-1147"><a href="#cb8-1147" aria-hidden="true" tabindex="-1"></a>            model_info <span class="op">=</span> <span class="ss">f&quot; *[</span><span class="sc">{</span>msg<span class="sc">.</span>get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;&#39;</span>)<span class="sc">}</span><span class="ss">]*&quot;</span> <span class="cf">if</span> msg.get(<span class="st">&#39;model&#39;</span>) <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb8-1148"><a href="#cb8-1148" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1149"><a href="#cb8-1149" aria-hidden="true" tabindex="-1"></a>            preserved_content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(msg[<span class="st">&#39;content&#39;</span>])</span>
<span id="cb8-1150"><a href="#cb8-1150" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1151"><a href="#cb8-1151" aria-hidden="true" tabindex="-1"></a>            lines.extend([</span>
<span id="cb8-1152"><a href="#cb8-1152" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;### </span><span class="sc">{</span>msg[<span class="st">&#39;author&#39;</span>]<span class="sc">}{</span>timestamp<span class="sc">}{</span>model_info<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-1153"><a href="#cb8-1153" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;&quot;</span>,</span>
<span id="cb8-1154"><a href="#cb8-1154" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;</span><span class="sc">{</span>preserved_content<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb8-1155"><a href="#cb8-1155" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;&quot;</span></span>
<span id="cb8-1156"><a href="#cb8-1156" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb8-1157"><a href="#cb8-1157" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1158"><a href="#cb8-1158" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> j <span class="op">&lt;</span> <span class="bu">len</span>(conversation[<span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb8-1159"><a href="#cb8-1159" aria-hidden="true" tabindex="-1"></a>                lines.extend([<span class="st">&quot;---&quot;</span>, <span class="st">&quot;&quot;</span>])</span>
<span id="cb8-1160"><a href="#cb8-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1161"><a href="#cb8-1161" aria-hidden="true" tabindex="-1"></a>        lines.extend([</span>
<span id="cb8-1162"><a href="#cb8-1162" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;---&quot;</span>,</span>
<span id="cb8-1163"><a href="#cb8-1163" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb8-1164"><a href="#cb8-1164" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;*Conversa exportada do </span><span class="sc">{</span>conversation[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">*&quot;</span>,</span>
<span id="cb8-1165"><a href="#cb8-1165" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;*Processado em: </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">.</span>strftime(<span class="st">&#39;</span><span class="sc">%d</span><span class="st">/%m/%Y %H:%M&#39;</span>)<span class="sc">}</span><span class="ss">*&quot;</span></span>
<span id="cb8-1166"><a href="#cb8-1166" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb8-1167"><a href="#cb8-1167" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1168"><a href="#cb8-1168" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(lines)</span>
<span id="cb8-1169"><a href="#cb8-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1170"><a href="#cb8-1170" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_qwen_corrected(<span class="va">self</span>, path: Path):</span>
<span id="cb8-1171"><a href="#cb8-1171" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa Qwen3 com corre√ß√£o para content_list - VERS√ÉO CORRIGIDA&quot;&quot;&quot;</span></span>
<span id="cb8-1172"><a href="#cb8-1172" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1173"><a href="#cb8-1173" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria Qwen3: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1174"><a href="#cb8-1174" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1175"><a href="#cb8-1175" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1176"><a href="#cb8-1176" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-1177"><a href="#cb8-1177" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1178"><a href="#cb8-1178" aria-hidden="true" tabindex="-1"></a>                raw_data <span class="op">=</span> json.load(f)</span>
<span id="cb8-1179"><a href="#cb8-1179" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1180"><a href="#cb8-1180" aria-hidden="true" tabindex="-1"></a>            <span class="co"># DEBUG: Salvar estrutura completa para an√°lise</span></span>
<span id="cb8-1181"><a href="#cb8-1181" aria-hidden="true" tabindex="-1"></a>            debug_file <span class="op">=</span> Path(<span class="st">&quot;qwen_debug_structure.json&quot;</span>)</span>
<span id="cb8-1182"><a href="#cb8-1182" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(debug_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1183"><a href="#cb8-1183" aria-hidden="true" tabindex="-1"></a>                json.dump(raw_data, f, indent<span class="op">=</span><span class="dv">2</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-1184"><a href="#cb8-1184" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Estrutura Qwen salva em: </span><span class="sc">{</span>debug_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1185"><a href="#cb8-1185" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1186"><a href="#cb8-1186" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extrair conversas</span></span>
<span id="cb8-1187"><a href="#cb8-1187" aria-hidden="true" tabindex="-1"></a>            conversations <span class="op">=</span> []</span>
<span id="cb8-1188"><a href="#cb8-1188" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1189"><a href="#cb8-1189" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;data&#39;</span> <span class="kw">in</span> raw_data <span class="kw">and</span> <span class="bu">isinstance</span>(raw_data[<span class="st">&#39;data&#39;</span>], <span class="bu">list</span>):</span>
<span id="cb8-1190"><a href="#cb8-1190" aria-hidden="true" tabindex="-1"></a>                conversations <span class="op">=</span> raw_data[<span class="st">&#39;data&#39;</span>]</span>
<span id="cb8-1191"><a href="#cb8-1191" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÅ Estrutura 1: </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas em &#39;data&#39;&quot;</span>)</span>
<span id="cb8-1192"><a href="#cb8-1192" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">list</span>):</span>
<span id="cb8-1193"><a href="#cb8-1193" aria-hidden="true" tabindex="-1"></a>                conversations <span class="op">=</span> raw_data</span>
<span id="cb8-1194"><a href="#cb8-1194" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÅ Estrutura 2: </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas na raiz&quot;</span>)</span>
<span id="cb8-1195"><a href="#cb8-1195" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb8-1196"><a href="#cb8-1196" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> key, value <span class="kw">in</span> raw_data.items():</span>
<span id="cb8-1197"><a href="#cb8-1197" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(value, <span class="bu">list</span>) <span class="kw">and</span> <span class="bu">len</span>(value) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb8-1198"><a href="#cb8-1198" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(value[<span class="dv">0</span>], <span class="bu">dict</span>) <span class="kw">and</span> <span class="bu">any</span>(k <span class="kw">in</span> value[<span class="dv">0</span>] <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">&#39;title&#39;</span>, <span class="st">&#39;chat&#39;</span>, <span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb8-1199"><a href="#cb8-1199" aria-hidden="true" tabindex="-1"></a>                            conversations <span class="op">=</span> value</span>
<span id="cb8-1200"><a href="#cb8-1200" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÅ Estrutura alternativa: </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas em &#39;</span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb8-1201"><a href="#cb8-1201" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">break</span></span>
<span id="cb8-1202"><a href="#cb8-1202" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1203"><a href="#cb8-1203" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> conversations:</span>
<span id="cb8-1204"><a href="#cb8-1204" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Nenhuma conversa encontrada no arquivo Qwen&quot;</span>)</span>
<span id="cb8-1205"><a href="#cb8-1205" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-1206"><a href="#cb8-1206" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1207"><a href="#cb8-1207" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Qwen: encontradas </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb8-1208"><a href="#cb8-1208" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-1209"><a href="#cb8-1209" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1210"><a href="#cb8-1210" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(conversations):</span>
<span id="cb8-1211"><a href="#cb8-1211" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conv, <span class="bu">dict</span>):</span>
<span id="cb8-1212"><a href="#cb8-1212" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb8-1213"><a href="#cb8-1213" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1214"><a href="#cb8-1214" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa Qwen </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb8-1215"><a href="#cb8-1215" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb8-1216"><a href="#cb8-1216" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1217"><a href="#cb8-1217" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üîç Processando: &#39;</span><span class="sc">{</span>clean_title<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb8-1218"><a href="#cb8-1218" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1219"><a href="#cb8-1219" aria-hidden="true" tabindex="-1"></a>                <span class="co"># EXTRA√á√ÉO CORRIGIDA - foco em content_list</span></span>
<span id="cb8-1220"><a href="#cb8-1220" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> <span class="va">self</span>._extract_qwen_messages_corrected(conv, clean_title, i)</span>
<span id="cb8-1221"><a href="#cb8-1221" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1222"><a href="#cb8-1222" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb8-1223"><a href="#cb8-1223" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Ordenar mensagens por timestamp</span></span>
<span id="cb8-1224"><a href="#cb8-1224" aria-hidden="true" tabindex="-1"></a>                    messages.sort(key<span class="op">=</span><span class="kw">lambda</span> x: <span class="va">self</span>.parse_timestamp_for_sorting(x[<span class="st">&#39;timestamp&#39;</span>]))</span>
<span id="cb8-1225"><a href="#cb8-1225" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1226"><a href="#cb8-1226" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb8-1227"><a href="#cb8-1227" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,</span>
<span id="cb8-1228"><a href="#cb8-1228" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;Qwen3&#39;</span>,</span>
<span id="cb8-1229"><a href="#cb8-1229" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;qwen_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb8-1230"><a href="#cb8-1230" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;created_at&#39;</span>)),</span>
<span id="cb8-1231"><a href="#cb8-1231" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;updated_at&#39;</span>)),</span>
<span id="cb8-1232"><a href="#cb8-1232" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb8-1233"><a href="#cb8-1233" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb8-1234"><a href="#cb8-1234" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="va">self</span>.categorize_conversation(clean_title, messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb8-1235"><a href="#cb8-1235" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-1236"><a href="#cb8-1236" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1237"><a href="#cb8-1237" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;   ‚úÖ Adicionada: </span><span class="sc">{</span><span class="bu">len</span>(messages)<span class="sc">}</span><span class="ss"> mensagens&quot;</span>)</span>
<span id="cb8-1238"><a href="#cb8-1238" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb8-1239"><a href="#cb8-1239" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.warning(<span class="ss">f&quot;   ‚ùå Conversa </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: nenhuma mensagem extra√≠da&quot;</span>)</span>
<span id="cb8-1240"><a href="#cb8-1240" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1241"><a href="#cb8-1241" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Qwen3: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb8-1242"><a href="#cb8-1242" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1243"><a href="#cb8-1243" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-1244"><a href="#cb8-1244" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar Qwen3: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1245"><a href="#cb8-1245" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(traceback.format_exc())</span>
<span id="cb8-1246"><a href="#cb8-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1247"><a href="#cb8-1247" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _extract_qwen_messages_corrected(<span class="va">self</span>, conv: Dict[<span class="bu">str</span>, Any], clean_title: <span class="bu">str</span>, conv_index: <span class="bu">int</span>) <span class="op">-&gt;</span> List[Dict[<span class="bu">str</span>, Any]]:</span>
<span id="cb8-1248"><a href="#cb8-1248" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Extrai mensagens do Qwen com corre√ß√£o para content_list&quot;&quot;&quot;</span></span>
<span id="cb8-1249"><a href="#cb8-1249" aria-hidden="true" tabindex="-1"></a>        all_messages <span class="op">=</span> []</span>
<span id="cb8-1250"><a href="#cb8-1250" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1251"><a href="#cb8-1251" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ESTRAT√âGIA PRINCIPAL: Buscar em toda a estrutura por mensagens</span></span>
<span id="cb8-1252"><a href="#cb8-1252" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> extract_from_object(obj, path<span class="op">=</span><span class="st">&quot;&quot;</span>):</span>
<span id="cb8-1253"><a href="#cb8-1253" aria-hidden="true" tabindex="-1"></a>            messages_found <span class="op">=</span> []</span>
<span id="cb8-1254"><a href="#cb8-1254" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1255"><a href="#cb8-1255" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(obj, <span class="bu">dict</span>):</span>
<span id="cb8-1256"><a href="#cb8-1256" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Verificar se √© uma mensagem com content_list (CASO CORRIGIDO)</span></span>
<span id="cb8-1257"><a href="#cb8-1257" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>._is_qwen_message_with_content(obj):</span>
<span id="cb8-1258"><a href="#cb8-1258" aria-hidden="true" tabindex="-1"></a>                    message <span class="op">=</span> <span class="va">self</span>._create_message_from_qwen_object(obj)</span>
<span id="cb8-1259"><a href="#cb8-1259" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> message:</span>
<span id="cb8-1260"><a href="#cb8-1260" aria-hidden="true" tabindex="-1"></a>                        messages_found.append(message)</span>
<span id="cb8-1261"><a href="#cb8-1261" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1262"><a href="#cb8-1262" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Buscar recursivamente</span></span>
<span id="cb8-1263"><a href="#cb8-1263" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> key, value <span class="kw">in</span> obj.items():</span>
<span id="cb8-1264"><a href="#cb8-1264" aria-hidden="true" tabindex="-1"></a>                    messages_found.extend(extract_from_object(value, <span class="ss">f&quot;</span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">&quot;</span>))</span>
<span id="cb8-1265"><a href="#cb8-1265" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1266"><a href="#cb8-1266" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(obj, <span class="bu">list</span>):</span>
<span id="cb8-1267"><a href="#cb8-1267" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> item <span class="kw">in</span> obj:</span>
<span id="cb8-1268"><a href="#cb8-1268" aria-hidden="true" tabindex="-1"></a>                    messages_found.extend(extract_from_object(item, path))</span>
<span id="cb8-1269"><a href="#cb8-1269" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1270"><a href="#cb8-1270" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> messages_found</span>
<span id="cb8-1271"><a href="#cb8-1271" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1272"><a href="#cb8-1272" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Aplicar extra√ß√£o recursiva</span></span>
<span id="cb8-1273"><a href="#cb8-1273" aria-hidden="true" tabindex="-1"></a>        all_messages <span class="op">=</span> extract_from_object(conv, <span class="st">&quot;root&quot;</span>)</span>
<span id="cb8-1274"><a href="#cb8-1274" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1275"><a href="#cb8-1275" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remover duplicatas</span></span>
<span id="cb8-1276"><a href="#cb8-1276" aria-hidden="true" tabindex="-1"></a>        unique_messages <span class="op">=</span> <span class="va">self</span>._remove_duplicate_messages(all_messages)</span>
<span id="cb8-1277"><a href="#cb8-1277" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1278"><a href="#cb8-1278" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(unique_messages) <span class="op">!=</span> <span class="bu">len</span>(all_messages):</span>
<span id="cb8-1279"><a href="#cb8-1279" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;         üîÑ Removidas </span><span class="sc">{</span><span class="bu">len</span>(all_messages) <span class="op">-</span> <span class="bu">len</span>(unique_messages)<span class="sc">}</span><span class="ss"> mensagens duplicadas&quot;</span>)</span>
<span id="cb8-1280"><a href="#cb8-1280" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1281"><a href="#cb8-1281" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> unique_messages</span>
<span id="cb8-1282"><a href="#cb8-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1283"><a href="#cb8-1283" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _is_qwen_message_with_content(<span class="va">self</span>, obj: Dict) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb8-1284"><a href="#cb8-1284" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Verifica se √© uma mensagem Qwen v√°lida (incluindo content_list)&quot;&quot;&quot;</span></span>
<span id="cb8-1285"><a href="#cb8-1285" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verificar campos b√°sicos de mensagem</span></span>
<span id="cb8-1286"><a href="#cb8-1286" aria-hidden="true" tabindex="-1"></a>        has_basic_structure <span class="op">=</span> (<span class="st">&#39;role&#39;</span> <span class="kw">in</span> obj <span class="kw">and</span> <span class="st">&#39;content&#39;</span> <span class="kw">in</span> obj)</span>
<span id="cb8-1287"><a href="#cb8-1287" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1288"><a href="#cb8-1288" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verificar se tem content_list (CORRE√á√ÉO DO PROBLEMA)</span></span>
<span id="cb8-1289"><a href="#cb8-1289" aria-hidden="true" tabindex="-1"></a>        has_content_list <span class="op">=</span> <span class="st">&#39;content_list&#39;</span> <span class="kw">in</span> obj <span class="kw">and</span> <span class="bu">isinstance</span>(obj[<span class="st">&#39;content_list&#39;</span>], <span class="bu">list</span>)</span>
<span id="cb8-1290"><a href="#cb8-1290" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1291"><a href="#cb8-1291" aria-hidden="true" tabindex="-1"></a>        <span class="co"># √â uma mensagem v√°lida se tiver estrutura b√°sica E (conte√∫do n√£o vazio OU content_list)</span></span>
<span id="cb8-1292"><a href="#cb8-1292" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (has_basic_structure <span class="kw">and</span> </span>
<span id="cb8-1293"><a href="#cb8-1293" aria-hidden="true" tabindex="-1"></a>                (obj.get(<span class="st">&#39;content&#39;</span>) <span class="kw">or</span> has_content_list) <span class="kw">and</span></span>
<span id="cb8-1294"><a href="#cb8-1294" aria-hidden="true" tabindex="-1"></a>                obj.get(<span class="st">&#39;role&#39;</span>) <span class="kw">in</span> [<span class="st">&#39;user&#39;</span>, <span class="st">&#39;assistant&#39;</span>])</span>
<span id="cb8-1295"><a href="#cb8-1295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1296"><a href="#cb8-1296" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_message_from_qwen_object(<span class="va">self</span>, obj: Dict) <span class="op">-&gt;</span> Optional[Dict[<span class="bu">str</span>, Any]]:</span>
<span id="cb8-1297"><a href="#cb8-1297" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Cria uma mensagem a partir de um objeto Qwen, priorizando content_list&quot;&quot;&quot;</span></span>
<span id="cb8-1298"><a href="#cb8-1298" aria-hidden="true" tabindex="-1"></a>        role <span class="op">=</span> obj.get(<span class="st">&#39;role&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb8-1299"><a href="#cb8-1299" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> obj.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb8-1300"><a href="#cb8-1300" aria-hidden="true" tabindex="-1"></a>        content_list <span class="op">=</span> obj.get(<span class="st">&#39;content_list&#39;</span>, [])</span>
<span id="cb8-1301"><a href="#cb8-1301" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1302"><a href="#cb8-1302" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> role:</span>
<span id="cb8-1303"><a href="#cb8-1303" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb8-1304"><a href="#cb8-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1305"><a href="#cb8-1305" aria-hidden="true" tabindex="-1"></a>        <span class="co"># CORRE√á√ÉO PRINCIPAL: Priorizar content_list quando content estiver vazio</span></span>
<span id="cb8-1306"><a href="#cb8-1306" aria-hidden="true" tabindex="-1"></a>        final_content <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb8-1307"><a href="#cb8-1307" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1308"><a href="#cb8-1308" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> content_list <span class="kw">and</span> <span class="bu">isinstance</span>(content_list, <span class="bu">list</span>):</span>
<span id="cb8-1309"><a href="#cb8-1309" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extrair conte√∫do de content_list</span></span>
<span id="cb8-1310"><a href="#cb8-1310" aria-hidden="true" tabindex="-1"></a>            content_parts <span class="op">=</span> []</span>
<span id="cb8-1311"><a href="#cb8-1311" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> content_item <span class="kw">in</span> content_list:</span>
<span id="cb8-1312"><a href="#cb8-1312" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">isinstance</span>(content_item, <span class="bu">dict</span>):</span>
<span id="cb8-1313"><a href="#cb8-1313" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Verificar diferentes estruturas de content_list</span></span>
<span id="cb8-1314"><a href="#cb8-1314" aria-hidden="true" tabindex="-1"></a>                    item_content <span class="op">=</span> content_item.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb8-1315"><a href="#cb8-1315" aria-hidden="true" tabindex="-1"></a>                    item_text <span class="op">=</span> content_item.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb8-1316"><a href="#cb8-1316" aria-hidden="true" tabindex="-1"></a>                    item_type <span class="op">=</span> content_item.get(<span class="st">&#39;type&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb8-1317"><a href="#cb8-1317" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1318"><a href="#cb8-1318" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> item_content:</span>
<span id="cb8-1319"><a href="#cb8-1319" aria-hidden="true" tabindex="-1"></a>                        content_parts.append(<span class="bu">str</span>(item_content))</span>
<span id="cb8-1320"><a href="#cb8-1320" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> item_text:</span>
<span id="cb8-1321"><a href="#cb8-1321" aria-hidden="true" tabindex="-1"></a>                        content_parts.append(<span class="bu">str</span>(item_text))</span>
<span id="cb8-1322"><a href="#cb8-1322" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> item_type <span class="op">==</span> <span class="st">&#39;text&#39;</span> <span class="kw">and</span> <span class="st">&#39;text&#39;</span> <span class="kw">in</span> content_item:</span>
<span id="cb8-1323"><a href="#cb8-1323" aria-hidden="true" tabindex="-1"></a>                        content_parts.append(<span class="bu">str</span>(content_item[<span class="st">&#39;text&#39;</span>]))</span>
<span id="cb8-1324"><a href="#cb8-1324" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1325"><a href="#cb8-1325" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> content_parts:</span>
<span id="cb8-1326"><a href="#cb8-1326" aria-hidden="true" tabindex="-1"></a>                final_content <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(content_parts).strip()</span>
<span id="cb8-1327"><a href="#cb8-1327" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1328"><a href="#cb8-1328" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se content_list n√£o forneceu conte√∫do, usar o campo content tradicional</span></span>
<span id="cb8-1329"><a href="#cb8-1329" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> final_content <span class="kw">and</span> content:</span>
<span id="cb8-1330"><a href="#cb8-1330" aria-hidden="true" tabindex="-1"></a>            final_content <span class="op">=</span> <span class="bu">str</span>(content).strip()</span>
<span id="cb8-1331"><a href="#cb8-1331" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1332"><a href="#cb8-1332" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se ainda n√£o tem conte√∫do, pular</span></span>
<span id="cb8-1333"><a href="#cb8-1333" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> final_content <span class="kw">or</span> final_content <span class="op">==</span> <span class="st">&#39;null&#39;</span>:</span>
<span id="cb8-1334"><a href="#cb8-1334" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb8-1335"><a href="#cb8-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1336"><a href="#cb8-1336" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Determinar autor</span></span>
<span id="cb8-1337"><a href="#cb8-1337" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> role <span class="op">==</span> <span class="st">&#39;user&#39;</span>:</span>
<span id="cb8-1338"><a href="#cb8-1338" aria-hidden="true" tabindex="-1"></a>            author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb8-1339"><a href="#cb8-1339" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> role <span class="op">==</span> <span class="st">&#39;assistant&#39;</span>:</span>
<span id="cb8-1340"><a href="#cb8-1340" aria-hidden="true" tabindex="-1"></a>            author <span class="op">=</span> <span class="st">&quot;ü§ñ Qwen3&quot;</span></span>
<span id="cb8-1341"><a href="#cb8-1341" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb8-1342"><a href="#cb8-1342" aria-hidden="true" tabindex="-1"></a>            author <span class="op">=</span> <span class="ss">f&quot;üîπ </span><span class="sc">{</span>role<span class="sc">.</span>title()<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb8-1343"><a href="#cb8-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1344"><a href="#cb8-1344" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Processar conte√∫do especial</span></span>
<span id="cb8-1345"><a href="#cb8-1345" aria-hidden="true" tabindex="-1"></a>        final_content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(final_content)</span>
<span id="cb8-1346"><a href="#cb8-1346" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1347"><a href="#cb8-1347" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb8-1348"><a href="#cb8-1348" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb8-1349"><a href="#cb8-1349" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb8-1350"><a href="#cb8-1350" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;content&#39;</span>: final_content,</span>
<span id="cb8-1351"><a href="#cb8-1351" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(obj.get(<span class="st">&#39;created_at&#39;</span>)),</span>
<span id="cb8-1352"><a href="#cb8-1352" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;model&#39;</span>: obj.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;Qwen3&#39;</span>)</span>
<span id="cb8-1353"><a href="#cb8-1353" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-1354"><a href="#cb8-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1355"><a href="#cb8-1355" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _remove_duplicate_messages(<span class="va">self</span>, messages: List[Dict[<span class="bu">str</span>, Any]]) <span class="op">-&gt;</span> List[Dict[<span class="bu">str</span>, Any]]:</span>
<span id="cb8-1356"><a href="#cb8-1356" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Remove mensagens duplicadas baseadas no conte√∫do&quot;&quot;&quot;</span></span>
<span id="cb8-1357"><a href="#cb8-1357" aria-hidden="true" tabindex="-1"></a>        seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb8-1358"><a href="#cb8-1358" aria-hidden="true" tabindex="-1"></a>        unique_messages <span class="op">=</span> []</span>
<span id="cb8-1359"><a href="#cb8-1359" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1360"><a href="#cb8-1360" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> msg <span class="kw">in</span> messages:</span>
<span id="cb8-1361"><a href="#cb8-1361" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Criar uma chave √∫nica baseada no conte√∫do e timestamp</span></span>
<span id="cb8-1362"><a href="#cb8-1362" aria-hidden="true" tabindex="-1"></a>            content_key <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>msg[<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>msg[<span class="st">&#39;timestamp&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb8-1363"><a href="#cb8-1363" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1364"><a href="#cb8-1364" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> content_key <span class="kw">not</span> <span class="kw">in</span> seen:</span>
<span id="cb8-1365"><a href="#cb8-1365" aria-hidden="true" tabindex="-1"></a>                seen.add(content_key)</span>
<span id="cb8-1366"><a href="#cb8-1366" aria-hidden="true" tabindex="-1"></a>                unique_messages.append(msg)</span>
<span id="cb8-1367"><a href="#cb8-1367" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1368"><a href="#cb8-1368" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> unique_messages</span>
<span id="cb8-1369"><a href="#cb8-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1370"><a href="#cb8-1370" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_chatgpt(<span class="va">self</span>, path: Path):</span>
<span id="cb8-1371"><a href="#cb8-1371" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do ChatGPT&quot;&quot;&quot;</span></span>
<span id="cb8-1372"><a href="#cb8-1372" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1373"><a href="#cb8-1373" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria ChatGPT: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1374"><a href="#cb8-1374" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1375"><a href="#cb8-1375" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1376"><a href="#cb8-1376" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-1377"><a href="#cb8-1377" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;chatgpt_&quot;</span>)</span>
<span id="cb8-1378"><a href="#cb8-1378" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb8-1379"><a href="#cb8-1379" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb8-1380"><a href="#cb8-1380" aria-hidden="true" tabindex="-1"></a>            convs_path <span class="op">=</span> Path(temp_dir) <span class="op">/</span> <span class="st">&quot;conversations.json&quot;</span></span>
<span id="cb8-1381"><a href="#cb8-1381" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> convs_path.exists():</span>
<span id="cb8-1382"><a href="#cb8-1382" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå ChatGPT: conversations.json n√£o encontrado.&quot;</span>)</span>
<span id="cb8-1383"><a href="#cb8-1383" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-1384"><a href="#cb8-1384" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1385"><a href="#cb8-1385" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(convs_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1386"><a href="#cb8-1386" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.load(f)</span>
<span id="cb8-1387"><a href="#cb8-1387" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1388"><a href="#cb8-1388" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">list</span>):</span>
<span id="cb8-1389"><a href="#cb8-1389" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  ChatGPT: estrutura inesperada.&quot;</span>)</span>
<span id="cb8-1390"><a href="#cb8-1390" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-1391"><a href="#cb8-1391" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1392"><a href="#cb8-1392" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç ChatGPT: encontradas </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb8-1393"><a href="#cb8-1393" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-1394"><a href="#cb8-1394" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1395"><a href="#cb8-1395" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb8-1396"><a href="#cb8-1396" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa ChatGPT </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb8-1397"><a href="#cb8-1397" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb8-1398"><a href="#cb8-1398" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb8-1399"><a href="#cb8-1399" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1400"><a href="#cb8-1400" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb8-1401"><a href="#cb8-1401" aria-hidden="true" tabindex="-1"></a>                mapping <span class="op">=</span> conv.get(<span class="st">&#39;mapping&#39;</span>, {})</span>
<span id="cb8-1402"><a href="#cb8-1402" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1403"><a href="#cb8-1403" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> msg_id, node <span class="kw">in</span> mapping.items():</span>
<span id="cb8-1404"><a href="#cb8-1404" aria-hidden="true" tabindex="-1"></a>                    msg_data <span class="op">=</span> node.get(<span class="st">&#39;message&#39;</span>)</span>
<span id="cb8-1405"><a href="#cb8-1405" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> msg_data <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(msg_data, <span class="bu">dict</span>):</span>
<span id="cb8-1406"><a href="#cb8-1406" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-1407"><a href="#cb8-1407" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb8-1408"><a href="#cb8-1408" aria-hidden="true" tabindex="-1"></a>                    author_role <span class="op">=</span> msg_data.get(<span class="st">&#39;author&#39;</span>, {}).get(<span class="st">&#39;role&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb8-1409"><a href="#cb8-1409" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> author_role <span class="op">==</span> <span class="st">&#39;user&#39;</span>:</span>
<span id="cb8-1410"><a href="#cb8-1410" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb8-1411"><a href="#cb8-1411" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;user&#39;</span></span>
<span id="cb8-1412"><a href="#cb8-1412" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> author_role <span class="op">==</span> <span class="st">&#39;assistant&#39;</span>:</span>
<span id="cb8-1413"><a href="#cb8-1413" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ ChatGPT&quot;</span></span>
<span id="cb8-1414"><a href="#cb8-1414" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;assistant&#39;</span></span>
<span id="cb8-1415"><a href="#cb8-1415" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb8-1416"><a href="#cb8-1416" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-1417"><a href="#cb8-1417" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb8-1418"><a href="#cb8-1418" aria-hidden="true" tabindex="-1"></a>                    content_parts <span class="op">=</span> []</span>
<span id="cb8-1419"><a href="#cb8-1419" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> part <span class="kw">in</span> msg_data.get(<span class="st">&#39;content&#39;</span>, {}).get(<span class="st">&#39;parts&#39;</span>, []):</span>
<span id="cb8-1420"><a href="#cb8-1420" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(part, <span class="bu">str</span>):</span>
<span id="cb8-1421"><a href="#cb8-1421" aria-hidden="true" tabindex="-1"></a>                            content_parts.append(part)</span>
<span id="cb8-1422"><a href="#cb8-1422" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(content_parts).strip()</span>
<span id="cb8-1423"><a href="#cb8-1423" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1424"><a href="#cb8-1424" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb8-1425"><a href="#cb8-1425" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1426"><a href="#cb8-1426" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb8-1427"><a href="#cb8-1427" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-1428"><a href="#cb8-1428" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb8-1429"><a href="#cb8-1429" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb8-1430"><a href="#cb8-1430" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb8-1431"><a href="#cb8-1431" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb8-1432"><a href="#cb8-1432" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb8-1433"><a href="#cb8-1433" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(msg_data.get(<span class="st">&#39;create_time&#39;</span>)),</span>
<span id="cb8-1434"><a href="#cb8-1434" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg_data.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;ChatGPT&#39;</span>)</span>
<span id="cb8-1435"><a href="#cb8-1435" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-1436"><a href="#cb8-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1437"><a href="#cb8-1437" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb8-1438"><a href="#cb8-1438" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb8-1439"><a href="#cb8-1439" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb8-1440"><a href="#cb8-1440" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;ChatGPT&#39;</span>,</span>
<span id="cb8-1441"><a href="#cb8-1441" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;chatgpt_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb8-1442"><a href="#cb8-1442" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;create_time&#39;</span>)),</span>
<span id="cb8-1443"><a href="#cb8-1443" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;update_time&#39;</span>)),</span>
<span id="cb8-1444"><a href="#cb8-1444" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb8-1445"><a href="#cb8-1445" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb8-1446"><a href="#cb8-1446" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb8-1447"><a href="#cb8-1447" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-1448"><a href="#cb8-1448" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1449"><a href="#cb8-1449" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1450"><a href="#cb8-1450" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ ChatGPT: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb8-1451"><a href="#cb8-1451" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1452"><a href="#cb8-1452" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-1453"><a href="#cb8-1453" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar ChatGPT: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1454"><a href="#cb8-1454" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1455"><a href="#cb8-1455" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb8-1456"><a href="#cb8-1456" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb8-1457"><a href="#cb8-1457" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb8-1458"><a href="#cb8-1458" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-1459"><a href="#cb8-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1460"><a href="#cb8-1460" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_deepseek(<span class="va">self</span>, path: Path):</span>
<span id="cb8-1461"><a href="#cb8-1461" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do DeepSeek&quot;&quot;&quot;</span></span>
<span id="cb8-1462"><a href="#cb8-1462" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1463"><a href="#cb8-1463" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria DeepSeek: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1464"><a href="#cb8-1464" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1465"><a href="#cb8-1465" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1466"><a href="#cb8-1466" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-1467"><a href="#cb8-1467" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;deepseek_&quot;</span>)</span>
<span id="cb8-1468"><a href="#cb8-1468" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb8-1469"><a href="#cb8-1469" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb8-1470"><a href="#cb8-1470" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1471"><a href="#cb8-1471" aria-hidden="true" tabindex="-1"></a>            convs_path <span class="op">=</span> Path(temp_dir) <span class="op">/</span> <span class="st">&quot;conversations.json&quot;</span></span>
<span id="cb8-1472"><a href="#cb8-1472" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> convs_path.exists():</span>
<span id="cb8-1473"><a href="#cb8-1473" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå DeepSeek: conversations.json n√£o encontrado.&quot;</span>)</span>
<span id="cb8-1474"><a href="#cb8-1474" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-1475"><a href="#cb8-1475" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1476"><a href="#cb8-1476" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(convs_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1477"><a href="#cb8-1477" aria-hidden="true" tabindex="-1"></a>                raw_data <span class="op">=</span> json.load(f)</span>
<span id="cb8-1478"><a href="#cb8-1478" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1479"><a href="#cb8-1479" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">list</span>):</span>
<span id="cb8-1480"><a href="#cb8-1480" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> raw_data</span>
<span id="cb8-1481"><a href="#cb8-1481" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;data&#39;</span> <span class="kw">in</span> raw_data:</span>
<span id="cb8-1482"><a href="#cb8-1482" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> raw_data[<span class="st">&#39;data&#39;</span>]</span>
<span id="cb8-1483"><a href="#cb8-1483" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb8-1484"><a href="#cb8-1484" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  DeepSeek: estrutura inesperada.&quot;</span>)</span>
<span id="cb8-1485"><a href="#cb8-1485" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-1486"><a href="#cb8-1486" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1487"><a href="#cb8-1487" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">list</span>):</span>
<span id="cb8-1488"><a href="#cb8-1488" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  DeepSeek: &#39;data&#39; n√£o √© uma lista.&quot;</span>)</span>
<span id="cb8-1489"><a href="#cb8-1489" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-1490"><a href="#cb8-1490" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1491"><a href="#cb8-1491" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç DeepSeek: encontradas </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb8-1492"><a href="#cb8-1492" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-1493"><a href="#cb8-1493" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1494"><a href="#cb8-1494" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb8-1495"><a href="#cb8-1495" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa DeepSeek </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb8-1496"><a href="#cb8-1496" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb8-1497"><a href="#cb8-1497" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb8-1498"><a href="#cb8-1498" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1499"><a href="#cb8-1499" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb8-1500"><a href="#cb8-1500" aria-hidden="true" tabindex="-1"></a>                mapping <span class="op">=</span> conv.get(<span class="st">&#39;mapping&#39;</span>, {})</span>
<span id="cb8-1501"><a href="#cb8-1501" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1502"><a href="#cb8-1502" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> node_id, node <span class="kw">in</span> mapping.items():</span>
<span id="cb8-1503"><a href="#cb8-1503" aria-hidden="true" tabindex="-1"></a>                    msg_data <span class="op">=</span> node.get(<span class="st">&#39;message&#39;</span>)</span>
<span id="cb8-1504"><a href="#cb8-1504" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> msg_data <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(msg_data, <span class="bu">dict</span>):</span>
<span id="cb8-1505"><a href="#cb8-1505" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-1506"><a href="#cb8-1506" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb8-1507"><a href="#cb8-1507" aria-hidden="true" tabindex="-1"></a>                    fragments <span class="op">=</span> msg_data.get(<span class="st">&#39;fragments&#39;</span>, [])</span>
<span id="cb8-1508"><a href="#cb8-1508" aria-hidden="true" tabindex="-1"></a>                    content_parts <span class="op">=</span> []</span>
<span id="cb8-1509"><a href="#cb8-1509" aria-hidden="true" tabindex="-1"></a>                    msg_type <span class="op">=</span> <span class="va">None</span></span>
<span id="cb8-1510"><a href="#cb8-1510" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1511"><a href="#cb8-1511" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> frag <span class="kw">in</span> fragments:</span>
<span id="cb8-1512"><a href="#cb8-1512" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(frag, <span class="bu">dict</span>):</span>
<span id="cb8-1513"><a href="#cb8-1513" aria-hidden="true" tabindex="-1"></a>                            frag_type <span class="op">=</span> frag.get(<span class="st">&#39;type&#39;</span>, <span class="st">&#39;&#39;</span>).upper()</span>
<span id="cb8-1514"><a href="#cb8-1514" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> frag_type <span class="kw">in</span> (<span class="st">&#39;REQUEST&#39;</span>, <span class="st">&#39;RESPONSE&#39;</span>):</span>
<span id="cb8-1515"><a href="#cb8-1515" aria-hidden="true" tabindex="-1"></a>                                msg_type <span class="op">=</span> frag_type</span>
<span id="cb8-1516"><a href="#cb8-1516" aria-hidden="true" tabindex="-1"></a>                            text <span class="op">=</span> frag.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb8-1517"><a href="#cb8-1517" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> text:</span>
<span id="cb8-1518"><a href="#cb8-1518" aria-hidden="true" tabindex="-1"></a>                                content_parts.append(text)</span>
<span id="cb8-1519"><a href="#cb8-1519" aria-hidden="true" tabindex="-1"></a>                            content <span class="op">=</span> frag.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb8-1520"><a href="#cb8-1520" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> content:</span>
<span id="cb8-1521"><a href="#cb8-1521" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> <span class="bu">isinstance</span>(content, <span class="bu">list</span>):</span>
<span id="cb8-1522"><a href="#cb8-1522" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">for</span> item <span class="kw">in</span> content:</span>
<span id="cb8-1523"><a href="#cb8-1523" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">if</span> <span class="bu">isinstance</span>(item, <span class="bu">str</span>):</span>
<span id="cb8-1524"><a href="#cb8-1524" aria-hidden="true" tabindex="-1"></a>                                            content_parts.append(item)</span>
<span id="cb8-1525"><a href="#cb8-1525" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">elif</span> <span class="bu">isinstance</span>(item, <span class="bu">dict</span>):</span>
<span id="cb8-1526"><a href="#cb8-1526" aria-hidden="true" tabindex="-1"></a>                                            item_text <span class="op">=</span> item.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb8-1527"><a href="#cb8-1527" aria-hidden="true" tabindex="-1"></a>                                            <span class="cf">if</span> item_text:</span>
<span id="cb8-1528"><a href="#cb8-1528" aria-hidden="true" tabindex="-1"></a>                                                content_parts.append(<span class="bu">str</span>(item_text))</span>
<span id="cb8-1529"><a href="#cb8-1529" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">else</span>:</span>
<span id="cb8-1530"><a href="#cb8-1530" aria-hidden="true" tabindex="-1"></a>                                    content_parts.append(<span class="bu">str</span>(content))</span>
<span id="cb8-1531"><a href="#cb8-1531" aria-hidden="true" tabindex="-1"></a>                                    </span>
<span id="cb8-1532"><a href="#cb8-1532" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="st">&#39; &#39;</span>.join(content_parts).strip()</span>
<span id="cb8-1533"><a href="#cb8-1533" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1534"><a href="#cb8-1534" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb8-1535"><a href="#cb8-1535" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1536"><a href="#cb8-1536" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb8-1537"><a href="#cb8-1537" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-1538"><a href="#cb8-1538" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb8-1539"><a href="#cb8-1539" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> msg_type <span class="op">==</span> <span class="st">&#39;REQUEST&#39;</span>:</span>
<span id="cb8-1540"><a href="#cb8-1540" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb8-1541"><a href="#cb8-1541" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;user&#39;</span></span>
<span id="cb8-1542"><a href="#cb8-1542" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb8-1543"><a href="#cb8-1543" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ DeepSeek&quot;</span></span>
<span id="cb8-1544"><a href="#cb8-1544" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;assistant&#39;</span></span>
<span id="cb8-1545"><a href="#cb8-1545" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb8-1546"><a href="#cb8-1546" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb8-1547"><a href="#cb8-1547" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb8-1548"><a href="#cb8-1548" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb8-1549"><a href="#cb8-1549" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb8-1550"><a href="#cb8-1550" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(msg_data.get(<span class="st">&#39;inserted_at&#39;</span>)),</span>
<span id="cb8-1551"><a href="#cb8-1551" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg_data.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;DeepSeek&#39;</span>)</span>
<span id="cb8-1552"><a href="#cb8-1552" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-1553"><a href="#cb8-1553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1554"><a href="#cb8-1554" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb8-1555"><a href="#cb8-1555" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb8-1556"><a href="#cb8-1556" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb8-1557"><a href="#cb8-1557" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;DeepSeek&#39;</span>,</span>
<span id="cb8-1558"><a href="#cb8-1558" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;deepseek_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb8-1559"><a href="#cb8-1559" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;inserted_at&#39;</span>)),</span>
<span id="cb8-1560"><a href="#cb8-1560" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;updated_at&#39;</span>)),</span>
<span id="cb8-1561"><a href="#cb8-1561" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb8-1562"><a href="#cb8-1562" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb8-1563"><a href="#cb8-1563" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb8-1564"><a href="#cb8-1564" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-1565"><a href="#cb8-1565" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1566"><a href="#cb8-1566" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1567"><a href="#cb8-1567" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ DeepSeek: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb8-1568"><a href="#cb8-1568" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1569"><a href="#cb8-1569" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-1570"><a href="#cb8-1570" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar DeepSeek: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1571"><a href="#cb8-1571" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1572"><a href="#cb8-1572" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb8-1573"><a href="#cb8-1573" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb8-1574"><a href="#cb8-1574" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb8-1575"><a href="#cb8-1575" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-1576"><a href="#cb8-1576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1577"><a href="#cb8-1577" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_grok(<span class="va">self</span>, path: Path):</span>
<span id="cb8-1578"><a href="#cb8-1578" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do Grok&quot;&quot;&quot;</span></span>
<span id="cb8-1579"><a href="#cb8-1579" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1580"><a href="#cb8-1580" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria Grok: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1581"><a href="#cb8-1581" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1582"><a href="#cb8-1582" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1583"><a href="#cb8-1583" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-1584"><a href="#cb8-1584" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;grok_&quot;</span>)</span>
<span id="cb8-1585"><a href="#cb8-1585" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb8-1586"><a href="#cb8-1586" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb8-1587"><a href="#cb8-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1588"><a href="#cb8-1588" aria-hidden="true" tabindex="-1"></a>            target_file <span class="op">=</span> <span class="va">None</span></span>
<span id="cb8-1589"><a href="#cb8-1589" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> root, _, files <span class="kw">in</span> os.walk(temp_dir):</span>
<span id="cb8-1590"><a href="#cb8-1590" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb8-1591"><a href="#cb8-1591" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">file</span> <span class="op">==</span> <span class="st">&quot;prod-grok-backend.json&quot;</span>:</span>
<span id="cb8-1592"><a href="#cb8-1592" aria-hidden="true" tabindex="-1"></a>                        target_file <span class="op">=</span> Path(root) <span class="op">/</span> <span class="bu">file</span></span>
<span id="cb8-1593"><a href="#cb8-1593" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb8-1594"><a href="#cb8-1594" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> target_file:</span>
<span id="cb8-1595"><a href="#cb8-1595" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb8-1596"><a href="#cb8-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1597"><a href="#cb8-1597" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> target_file:</span>
<span id="cb8-1598"><a href="#cb8-1598" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: ficheiro &#39;prod-grok-backend.json&#39; n√£o encontrado no ZIP.&quot;</span>)</span>
<span id="cb8-1599"><a href="#cb8-1599" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-1600"><a href="#cb8-1600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1601"><a href="#cb8-1601" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Grok: carregando </span><span class="sc">{</span>target_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb8-1602"><a href="#cb8-1602" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(target_file, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1603"><a href="#cb8-1603" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.load(f)</span>
<span id="cb8-1604"><a href="#cb8-1604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1605"><a href="#cb8-1605" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">dict</span>) <span class="kw">or</span> <span class="st">&#39;conversations&#39;</span> <span class="kw">not</span> <span class="kw">in</span> data:</span>
<span id="cb8-1606"><a href="#cb8-1606" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: estrutura inesperada ‚Äî chave &#39;conversations&#39; n√£o encontrada.&quot;</span>)</span>
<span id="cb8-1607"><a href="#cb8-1607" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-1608"><a href="#cb8-1608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1609"><a href="#cb8-1609" aria-hidden="true" tabindex="-1"></a>            conversations_list <span class="op">=</span> data[<span class="st">&#39;conversations&#39;</span>]</span>
<span id="cb8-1610"><a href="#cb8-1610" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conversations_list, <span class="bu">list</span>):</span>
<span id="cb8-1611"><a href="#cb8-1611" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: &#39;conversations&#39; n√£o √© uma lista.&quot;</span>)</span>
<span id="cb8-1612"><a href="#cb8-1612" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb8-1613"><a href="#cb8-1613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1614"><a href="#cb8-1614" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä Grok: encontradas </span><span class="sc">{</span><span class="bu">len</span>(conversations_list)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb8-1615"><a href="#cb8-1615" aria-hidden="true" tabindex="-1"></a>            total_convs <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-1616"><a href="#cb8-1616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1617"><a href="#cb8-1617" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> item <span class="kw">in</span> conversations_list:</span>
<span id="cb8-1618"><a href="#cb8-1618" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(item, <span class="bu">dict</span>):</span>
<span id="cb8-1619"><a href="#cb8-1619" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb8-1620"><a href="#cb8-1620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1621"><a href="#cb8-1621" aria-hidden="true" tabindex="-1"></a>                conv_meta <span class="op">=</span> item.get(<span class="st">&#39;conversation&#39;</span>)</span>
<span id="cb8-1622"><a href="#cb8-1622" aria-hidden="true" tabindex="-1"></a>                responses <span class="op">=</span> item.get(<span class="st">&#39;responses&#39;</span>, [])</span>
<span id="cb8-1623"><a href="#cb8-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1624"><a href="#cb8-1624" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conv_meta, <span class="bu">dict</span>) <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(responses, <span class="bu">list</span>) <span class="kw">or</span> <span class="kw">not</span> responses:</span>
<span id="cb8-1625"><a href="#cb8-1625" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb8-1626"><a href="#cb8-1626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1627"><a href="#cb8-1627" aria-hidden="true" tabindex="-1"></a>                conv_id <span class="op">=</span> conv_meta.get(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb8-1628"><a href="#cb8-1628" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> conv_id:</span>
<span id="cb8-1629"><a href="#cb8-1629" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb8-1630"><a href="#cb8-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1631"><a href="#cb8-1631" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv_meta.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&quot;Conversa Grok </span><span class="sc">{</span>total_convs <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1632"><a href="#cb8-1632" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb8-1633"><a href="#cb8-1633" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb8-1634"><a href="#cb8-1634" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1635"><a href="#cb8-1635" aria-hidden="true" tabindex="-1"></a>                create_time_str <span class="op">=</span> conv_meta.get(<span class="st">&#39;create_time&#39;</span>)</span>
<span id="cb8-1636"><a href="#cb8-1636" aria-hidden="true" tabindex="-1"></a>                modify_time_str <span class="op">=</span> conv_meta.get(<span class="st">&#39;modify_time&#39;</span>)</span>
<span id="cb8-1637"><a href="#cb8-1637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1638"><a href="#cb8-1638" aria-hidden="true" tabindex="-1"></a>                <span class="kw">def</span> format_iso_timestamp(ts_str):</span>
<span id="cb8-1639"><a href="#cb8-1639" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> ts_str:</span>
<span id="cb8-1640"><a href="#cb8-1640" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb8-1641"><a href="#cb8-1641" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">try</span>:</span>
<span id="cb8-1642"><a href="#cb8-1642" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="st">&#39;.&#39;</span> <span class="kw">in</span> ts_str:</span>
<span id="cb8-1643"><a href="#cb8-1643" aria-hidden="true" tabindex="-1"></a>                            ts_str <span class="op">=</span> ts_str.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>] <span class="op">+</span> <span class="st">&#39;Z&#39;</span></span>
<span id="cb8-1644"><a href="#cb8-1644" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="va">self</span>.format_timestamp(ts_str)</span>
<span id="cb8-1645"><a href="#cb8-1645" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">except</span>:</span>
<span id="cb8-1646"><a href="#cb8-1646" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="bu">str</span>(ts_str)</span>
<span id="cb8-1647"><a href="#cb8-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1648"><a href="#cb8-1648" aria-hidden="true" tabindex="-1"></a>                inserted_at <span class="op">=</span> format_iso_timestamp(create_time_str)</span>
<span id="cb8-1649"><a href="#cb8-1649" aria-hidden="true" tabindex="-1"></a>                updated_at <span class="op">=</span> format_iso_timestamp(modify_time_str)</span>
<span id="cb8-1650"><a href="#cb8-1650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1651"><a href="#cb8-1651" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb8-1652"><a href="#cb8-1652" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> resp <span class="kw">in</span> responses:</span>
<span id="cb8-1653"><a href="#cb8-1653" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(resp, <span class="bu">dict</span>):</span>
<span id="cb8-1654"><a href="#cb8-1654" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-1655"><a href="#cb8-1655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1656"><a href="#cb8-1656" aria-hidden="true" tabindex="-1"></a>                    resp_data <span class="op">=</span> resp.get(<span class="st">&#39;response&#39;</span>)</span>
<span id="cb8-1657"><a href="#cb8-1657" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(resp_data, <span class="bu">dict</span>):</span>
<span id="cb8-1658"><a href="#cb8-1658" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-1659"><a href="#cb8-1659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1660"><a href="#cb8-1660" aria-hidden="true" tabindex="-1"></a>                    sender <span class="op">=</span> resp_data.get(<span class="st">&#39;sender&#39;</span>, <span class="st">&#39;&#39;</span>).upper()</span>
<span id="cb8-1661"><a href="#cb8-1661" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> sender <span class="op">==</span> <span class="st">&#39;HUMAN&#39;</span>:</span>
<span id="cb8-1662"><a href="#cb8-1662" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb8-1663"><a href="#cb8-1663" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&quot;user&quot;</span></span>
<span id="cb8-1664"><a href="#cb8-1664" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> sender <span class="op">==</span> <span class="st">&#39;ASSISTANT&#39;</span>:</span>
<span id="cb8-1665"><a href="#cb8-1665" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ Grok&quot;</span></span>
<span id="cb8-1666"><a href="#cb8-1666" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&quot;assistant&quot;</span></span>
<span id="cb8-1667"><a href="#cb8-1667" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb8-1668"><a href="#cb8-1668" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-1669"><a href="#cb8-1669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1670"><a href="#cb8-1670" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="bu">str</span>(resp_data.get(<span class="st">&#39;message&#39;</span>, <span class="st">&#39;&#39;</span>)).strip()</span>
<span id="cb8-1671"><a href="#cb8-1671" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1672"><a href="#cb8-1672" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb8-1673"><a href="#cb8-1673" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1674"><a href="#cb8-1674" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb8-1675"><a href="#cb8-1675" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb8-1676"><a href="#cb8-1676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1677"><a href="#cb8-1677" aria-hidden="true" tabindex="-1"></a>                    create_time <span class="op">=</span> resp_data.get(<span class="st">&#39;create_time&#39;</span>)</span>
<span id="cb8-1678"><a href="#cb8-1678" aria-hidden="true" tabindex="-1"></a>                    timestamp_ms <span class="op">=</span> <span class="va">None</span></span>
<span id="cb8-1679"><a href="#cb8-1679" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(create_time, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;$date&#39;</span> <span class="kw">in</span> create_time:</span>
<span id="cb8-1680"><a href="#cb8-1680" aria-hidden="true" tabindex="-1"></a>                        date_obj <span class="op">=</span> create_time[<span class="st">&#39;$date&#39;</span>]</span>
<span id="cb8-1681"><a href="#cb8-1681" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(date_obj, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;$numberLong&#39;</span> <span class="kw">in</span> date_obj:</span>
<span id="cb8-1682"><a href="#cb8-1682" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">try</span>:</span>
<span id="cb8-1683"><a href="#cb8-1683" aria-hidden="true" tabindex="-1"></a>                                timestamp_ms <span class="op">=</span> <span class="bu">int</span>(date_obj[<span class="st">&#39;$numberLong&#39;</span>])</span>
<span id="cb8-1684"><a href="#cb8-1684" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">except</span>:</span>
<span id="cb8-1685"><a href="#cb8-1685" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">pass</span></span>
<span id="cb8-1686"><a href="#cb8-1686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1687"><a href="#cb8-1687" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb8-1688"><a href="#cb8-1688" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb8-1689"><a href="#cb8-1689" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb8-1690"><a href="#cb8-1690" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb8-1691"><a href="#cb8-1691" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(timestamp_ms <span class="op">/</span> <span class="fl">1000.0</span> <span class="cf">if</span> timestamp_ms <span class="cf">else</span> <span class="va">None</span>),</span>
<span id="cb8-1692"><a href="#cb8-1692" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: <span class="st">&#39;Grok&#39;</span></span>
<span id="cb8-1693"><a href="#cb8-1693" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-1694"><a href="#cb8-1694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1695"><a href="#cb8-1695" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb8-1696"><a href="#cb8-1696" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb8-1697"><a href="#cb8-1697" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb8-1698"><a href="#cb8-1698" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;Grok&#39;</span>,</span>
<span id="cb8-1699"><a href="#cb8-1699" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv_id,</span>
<span id="cb8-1700"><a href="#cb8-1700" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: inserted_at,</span>
<span id="cb8-1701"><a href="#cb8-1701" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: updated_at,</span>
<span id="cb8-1702"><a href="#cb8-1702" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb8-1703"><a href="#cb8-1703" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb8-1704"><a href="#cb8-1704" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb8-1705"><a href="#cb8-1705" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-1706"><a href="#cb8-1706" aria-hidden="true" tabindex="-1"></a>                    total_convs <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1707"><a href="#cb8-1707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1708"><a href="#cb8-1708" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> total_convs <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb8-1709"><a href="#cb8-1709" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Grok: processadas </span><span class="sc">{</span>total_convs<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb8-1710"><a href="#cb8-1710" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb8-1711"><a href="#cb8-1711" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: nenhuma conversa v√°lida encontrada.&quot;</span>)</span>
<span id="cb8-1712"><a href="#cb8-1712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1713"><a href="#cb8-1713" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-1714"><a href="#cb8-1714" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar Grok: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1715"><a href="#cb8-1715" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1716"><a href="#cb8-1716" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb8-1717"><a href="#cb8-1717" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb8-1718"><a href="#cb8-1718" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb8-1719"><a href="#cb8-1719" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-1720"><a href="#cb8-1720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1721"><a href="#cb8-1721" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_markdown_enhanced(<span class="va">self</span>):</span>
<span id="cb8-1722"><a href="#cb8-1722" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas com preserva√ß√£o total de formata√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb8-1723"><a href="#cb8-1723" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1724"><a href="#cb8-1724" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] Markdowns seriam criados:&quot;</span>)</span>
<span id="cb8-1725"><a href="#cb8-1725" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-1726"><a href="#cb8-1726" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb8-1727"><a href="#cb8-1727" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.md&quot;</span></span>
<span id="cb8-1728"><a href="#cb8-1728" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÑ </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1729"><a href="#cb8-1729" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1730"><a href="#cb8-1730" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1731"><a href="#cb8-1731" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;markdown&#39;</span>])</span>
<span id="cb8-1732"><a href="#cb8-1732" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-1733"><a href="#cb8-1733" aria-hidden="true" tabindex="-1"></a>        failed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-1734"><a href="#cb8-1734" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1735"><a href="#cb8-1735" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-1736"><a href="#cb8-1736" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb8-1737"><a href="#cb8-1737" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb8-1738"><a href="#cb8-1738" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.md&quot;</span></span>
<span id="cb8-1739"><a href="#cb8-1739" aria-hidden="true" tabindex="-1"></a>                filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb8-1740"><a href="#cb8-1740" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1741"><a href="#cb8-1741" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb8-1742"><a href="#cb8-1742" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb8-1743"><a href="#cb8-1743" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-1744"><a href="#cb8-1744" aria-hidden="true" tabindex="-1"></a>                markdown_content <span class="op">=</span> <span class="va">self</span>.create_enhanced_markdown_content(conv)</span>
<span id="cb8-1745"><a href="#cb8-1745" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1746"><a href="#cb8-1746" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1747"><a href="#cb8-1747" aria-hidden="true" tabindex="-1"></a>                    f.write(markdown_content)</span>
<span id="cb8-1748"><a href="#cb8-1748" aria-hidden="true" tabindex="-1"></a>                saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1749"><a href="#cb8-1749" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1750"><a href="#cb8-1750" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-1751"><a href="#cb8-1751" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao salvar conversa </span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1752"><a href="#cb8-1752" aria-hidden="true" tabindex="-1"></a>                failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1753"><a href="#cb8-1753" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb8-1754"><a href="#cb8-1754" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1755"><a href="#cb8-1755" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Markdown: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados, </span><span class="sc">{</span>failed_count<span class="sc">}</span><span class="ss"> falhas em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb8-1756"><a href="#cb8-1756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1757"><a href="#cb8-1757" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_csv(<span class="va">self</span>):</span>
<span id="cb8-1758"><a href="#cb8-1758" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas em arquivos CSV individuais&quot;&quot;&quot;</span></span>
<span id="cb8-1759"><a href="#cb8-1759" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1760"><a href="#cb8-1760" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] CSVs seriam criados:&quot;</span>)</span>
<span id="cb8-1761"><a href="#cb8-1761" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-1762"><a href="#cb8-1762" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb8-1763"><a href="#cb8-1763" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.csv&quot;</span></span>
<span id="cb8-1764"><a href="#cb8-1764" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìä </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1765"><a href="#cb8-1765" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1766"><a href="#cb8-1766" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1767"><a href="#cb8-1767" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;csv&#39;</span>])</span>
<span id="cb8-1768"><a href="#cb8-1768" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-1769"><a href="#cb8-1769" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1770"><a href="#cb8-1770" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-1771"><a href="#cb8-1771" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb8-1772"><a href="#cb8-1772" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.csv&quot;</span></span>
<span id="cb8-1773"><a href="#cb8-1773" aria-hidden="true" tabindex="-1"></a>            filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb8-1774"><a href="#cb8-1774" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1775"><a href="#cb8-1775" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb8-1776"><a href="#cb8-1776" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb8-1777"><a href="#cb8-1777" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1778"><a href="#cb8-1778" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1779"><a href="#cb8-1779" aria-hidden="true" tabindex="-1"></a>                writer <span class="op">=</span> csv.DictWriter(f, fieldnames<span class="op">=</span>[</span>
<span id="cb8-1780"><a href="#cb8-1780" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;node_id&#39;</span>, <span class="st">&#39;author&#39;</span>, <span class="st">&#39;role&#39;</span>, <span class="st">&#39;timestamp&#39;</span>, <span class="st">&#39;model&#39;</span>, <span class="st">&#39;content&#39;</span></span>
<span id="cb8-1781"><a href="#cb8-1781" aria-hidden="true" tabindex="-1"></a>                ])</span>
<span id="cb8-1782"><a href="#cb8-1782" aria-hidden="true" tabindex="-1"></a>                writer.writeheader()</span>
<span id="cb8-1783"><a href="#cb8-1783" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i, msg <span class="kw">in</span> <span class="bu">enumerate</span>(conv[<span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb8-1784"><a href="#cb8-1784" aria-hidden="true" tabindex="-1"></a>                    writer.writerow({</span>
<span id="cb8-1785"><a href="#cb8-1785" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;node_id&#39;</span>: <span class="bu">str</span>(i),</span>
<span id="cb8-1786"><a href="#cb8-1786" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: msg[<span class="st">&#39;author&#39;</span>],</span>
<span id="cb8-1787"><a href="#cb8-1787" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: msg[<span class="st">&#39;role&#39;</span>],</span>
<span id="cb8-1788"><a href="#cb8-1788" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: msg[<span class="st">&#39;timestamp&#39;</span>],</span>
<span id="cb8-1789"><a href="#cb8-1789" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg[<span class="st">&#39;model&#39;</span>],</span>
<span id="cb8-1790"><a href="#cb8-1790" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: msg[<span class="st">&#39;content&#39;</span>]</span>
<span id="cb8-1791"><a href="#cb8-1791" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-1792"><a href="#cb8-1792" aria-hidden="true" tabindex="-1"></a>            saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1793"><a href="#cb8-1793" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1794"><a href="#cb8-1794" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ CSV: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb8-1795"><a href="#cb8-1795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1796"><a href="#cb8-1796" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_json(<span class="va">self</span>):</span>
<span id="cb8-1797"><a href="#cb8-1797" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas em arquivos JSON individuais&quot;&quot;&quot;</span></span>
<span id="cb8-1798"><a href="#cb8-1798" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1799"><a href="#cb8-1799" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] JSONs seriam criados:&quot;</span>)</span>
<span id="cb8-1800"><a href="#cb8-1800" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-1801"><a href="#cb8-1801" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb8-1802"><a href="#cb8-1802" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.json&quot;</span></span>
<span id="cb8-1803"><a href="#cb8-1803" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìã </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1804"><a href="#cb8-1804" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1805"><a href="#cb8-1805" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1806"><a href="#cb8-1806" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;json&#39;</span>])</span>
<span id="cb8-1807"><a href="#cb8-1807" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-1808"><a href="#cb8-1808" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1809"><a href="#cb8-1809" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-1810"><a href="#cb8-1810" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb8-1811"><a href="#cb8-1811" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.json&quot;</span></span>
<span id="cb8-1812"><a href="#cb8-1812" aria-hidden="true" tabindex="-1"></a>            filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb8-1813"><a href="#cb8-1813" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1814"><a href="#cb8-1814" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb8-1815"><a href="#cb8-1815" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb8-1816"><a href="#cb8-1816" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-1817"><a href="#cb8-1817" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1818"><a href="#cb8-1818" aria-hidden="true" tabindex="-1"></a>                json.dump(conv, f, ensure_ascii<span class="op">=</span><span class="va">False</span>, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb8-1819"><a href="#cb8-1819" aria-hidden="true" tabindex="-1"></a>            saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-1820"><a href="#cb8-1820" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1821"><a href="#cb8-1821" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ JSON: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb8-1822"><a href="#cb8-1822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1823"><a href="#cb8-1823" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_all_to_single_files(<span class="va">self</span>):</span>
<span id="cb8-1824"><a href="#cb8-1824" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva todas as conversas em arquivos √∫nicos CSV e JSON&quot;&quot;&quot;</span></span>
<span id="cb8-1825"><a href="#cb8-1825" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1826"><a href="#cb8-1826" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] Arquivos √∫nicos seriam criados:&quot;</span>)</span>
<span id="cb8-1827"><a href="#cb8-1827" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÅ </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;csv&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1828"><a href="#cb8-1828" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÅ </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;json&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1829"><a href="#cb8-1829" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1830"><a href="#cb8-1830" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1831"><a href="#cb8-1831" aria-hidden="true" tabindex="-1"></a>        <span class="co"># CSV √∫nico</span></span>
<span id="cb8-1832"><a href="#cb8-1832" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.single_files[<span class="st">&#39;csv&#39;</span>], <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1833"><a href="#cb8-1833" aria-hidden="true" tabindex="-1"></a>            fieldnames <span class="op">=</span> [</span>
<span id="cb8-1834"><a href="#cb8-1834" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;conversation_number&#39;</span>, <span class="st">&#39;source&#39;</span>, <span class="st">&#39;conversation_title&#39;</span>, <span class="st">&#39;category&#39;</span>,</span>
<span id="cb8-1835"><a href="#cb8-1835" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;author&#39;</span>, <span class="st">&#39;role&#39;</span>, <span class="st">&#39;timestamp&#39;</span>, <span class="st">&#39;model&#39;</span>, <span class="st">&#39;content&#39;</span></span>
<span id="cb8-1836"><a href="#cb8-1836" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb8-1837"><a href="#cb8-1837" aria-hidden="true" tabindex="-1"></a>            writer <span class="op">=</span> csv.DictWriter(f, fieldnames<span class="op">=</span>fieldnames)</span>
<span id="cb8-1838"><a href="#cb8-1838" aria-hidden="true" tabindex="-1"></a>            writer.writeheader()</span>
<span id="cb8-1839"><a href="#cb8-1839" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-1840"><a href="#cb8-1840" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> msg <span class="kw">in</span> conv[<span class="st">&#39;messages&#39;</span>]:</span>
<span id="cb8-1841"><a href="#cb8-1841" aria-hidden="true" tabindex="-1"></a>                    writer.writerow({</span>
<span id="cb8-1842"><a href="#cb8-1842" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;conversation_number&#39;</span>: conv[<span class="st">&#39;number&#39;</span>],</span>
<span id="cb8-1843"><a href="#cb8-1843" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: conv[<span class="st">&#39;source&#39;</span>],</span>
<span id="cb8-1844"><a href="#cb8-1844" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;conversation_title&#39;</span>: conv[<span class="st">&#39;title&#39;</span>],</span>
<span id="cb8-1845"><a href="#cb8-1845" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: conv[<span class="st">&#39;category&#39;</span>],</span>
<span id="cb8-1846"><a href="#cb8-1846" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: msg[<span class="st">&#39;author&#39;</span>],</span>
<span id="cb8-1847"><a href="#cb8-1847" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: msg[<span class="st">&#39;role&#39;</span>],</span>
<span id="cb8-1848"><a href="#cb8-1848" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: msg[<span class="st">&#39;timestamp&#39;</span>],</span>
<span id="cb8-1849"><a href="#cb8-1849" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg[<span class="st">&#39;model&#39;</span>],</span>
<span id="cb8-1850"><a href="#cb8-1850" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: msg[<span class="st">&#39;content&#39;</span>]</span>
<span id="cb8-1851"><a href="#cb8-1851" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb8-1852"><a href="#cb8-1852" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ CSV √∫nico: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;csv&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1853"><a href="#cb8-1853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1854"><a href="#cb8-1854" aria-hidden="true" tabindex="-1"></a>        <span class="co"># JSON √∫nico</span></span>
<span id="cb8-1855"><a href="#cb8-1855" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.single_files[<span class="st">&#39;json&#39;</span>], <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-1856"><a href="#cb8-1856" aria-hidden="true" tabindex="-1"></a>            json.dump(<span class="va">self</span>.all_conversations, f, ensure_ascii<span class="op">=</span><span class="va">False</span>, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb8-1857"><a href="#cb8-1857" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ JSON √∫nico: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;json&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1858"><a href="#cb8-1858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1859"><a href="#cb8-1859" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_searchable_index(<span class="va">self</span>):</span>
<span id="cb8-1860"><a href="#cb8-1860" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Cria √≠ndice HTML pesquis√°vel com links para HTML&quot;&quot;&quot;</span></span>
<span id="cb8-1861"><a href="#cb8-1861" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb8-1862"><a href="#cb8-1862" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] √çndice HTML seria criado: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-1863"><a href="#cb8-1863" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-1864"><a href="#cb8-1864" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-1865"><a href="#cb8-1865" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;üéØ Criando √≠ndice HTML combinado...&quot;</span>)</span>
<span id="cb8-1866"><a href="#cb8-1866" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-1867"><a href="#cb8-1867" aria-hidden="true" tabindex="-1"></a>        category_stats <span class="op">=</span> {}</span>
<span id="cb8-1868"><a href="#cb8-1868" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb8-1869"><a href="#cb8-1869" aria-hidden="true" tabindex="-1"></a>            cat <span class="op">=</span> conv[<span class="st">&#39;category&#39;</span>]</span>
<span id="cb8-1870"><a href="#cb8-1870" aria-hidden="true" tabindex="-1"></a>            category_stats[cat] <span class="op">=</span> category_stats.get(cat, <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb8-1871"><a href="#cb8-1871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1872"><a href="#cb8-1872" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb8-1873"><a href="#cb8-1873" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html lang=&quot;pt-PT&quot;&gt;</span></span>
<span id="cb8-1874"><a href="#cb8-1874" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb8-1875"><a href="#cb8-1875" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb8-1876"><a href="#cb8-1876" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb8-1877"><a href="#cb8-1877" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;√çndice Combinado - AI Chats&lt;/title&gt;</span></span>
<span id="cb8-1878"><a href="#cb8-1878" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb8-1879"><a href="#cb8-1879" aria-hidden="true" tabindex="-1"></a><span class="ss">        * </span><span class="ch">{{</span><span class="ss"> margin: 0; padding: 0; box-sizing: border-box; </span><span class="ch">}}</span></span>
<span id="cb8-1880"><a href="#cb8-1880" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span><span class="ss"> font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; color: #333; </span><span class="ch">}}</span></span>
<span id="cb8-1881"><a href="#cb8-1881" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span><span class="ss"> max-width: 1400px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; </span><span class="ch">}}</span></span>
<span id="cb8-1882"><a href="#cb8-1882" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header </span><span class="ch">{{</span><span class="ss"> background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; text-align: center; </span><span class="ch">}}</span></span>
<span id="cb8-1883"><a href="#cb8-1883" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header h1 </span><span class="ch">{{</span><span class="ss"> font-size: 2.8em; margin-bottom: 15px; font-weight: 300; </span><span class="ch">}}</span></span>
<span id="cb8-1884"><a href="#cb8-1884" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header p </span><span class="ch">{{</span><span class="ss"> font-size: 1.2em; opacity: 0.9; margin-bottom: 20px; </span><span class="ch">}}</span></span>
<span id="cb8-1885"><a href="#cb8-1885" aria-hidden="true" tabindex="-1"></a><span class="ss">        .stats </span><span class="ch">{{</span><span class="ss"> display: flex; justify-content: center; gap: 30px; margin-top: 25px; flex-wrap: wrap; </span><span class="ch">}}</span></span>
<span id="cb8-1886"><a href="#cb8-1886" aria-hidden="true" tabindex="-1"></a><span class="ss">        .stat-item </span><span class="ch">{{</span><span class="ss"> background: rgba(255,255,255,0.15); padding: 18px 28px; border-radius: 12px; backdrop-filter: blur(10px); font-size: 1.1em; </span><span class="ch">}}</span></span>
<span id="cb8-1887"><a href="#cb8-1887" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-section </span><span class="ch">{{</span><span class="ss"> padding: 30px; background: #f8f9fa; border-bottom: 1px solid #e9ecef; </span><span class="ch">}}</span></span>
<span id="cb8-1888"><a href="#cb8-1888" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-box </span><span class="ch">{{</span><span class="ss"> width: 100%; padding: 18px 25px; font-size: 16px; border: 2px solid #e9ecef; border-radius: 25px; outline: none; transition: all 0.3s ease; font-family: inherit; </span><span class="ch">}}</span></span>
<span id="cb8-1889"><a href="#cb8-1889" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-box:focus </span><span class="ch">{{</span><span class="ss"> border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); </span><span class="ch">}}</span></span>
<span id="cb8-1890"><a href="#cb8-1890" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-section </span><span class="ch">{{</span></span>
<span id="cb8-1891"><a href="#cb8-1891" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px 30px;</span></span>
<span id="cb8-1892"><a href="#cb8-1892" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb8-1893"><a href="#cb8-1893" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb8-1894"><a href="#cb8-1894" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 12px;</span></span>
<span id="cb8-1895"><a href="#cb8-1895" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: center;</span></span>
<span id="cb8-1896"><a href="#cb8-1896" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb8-1897"><a href="#cb8-1897" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 1px solid #e9ecef;</span></span>
<span id="cb8-1898"><a href="#cb8-1898" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1899"><a href="#cb8-1899" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-btn </span><span class="ch">{{</span></span>
<span id="cb8-1900"><a href="#cb8-1900" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 10px 20px;</span></span>
<span id="cb8-1901"><a href="#cb8-1901" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb8-1902"><a href="#cb8-1902" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 2px solid #e9ecef;</span></span>
<span id="cb8-1903"><a href="#cb8-1903" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 25px;</span></span>
<span id="cb8-1904"><a href="#cb8-1904" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb8-1905"><a href="#cb8-1905" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.95em;</span></span>
<span id="cb8-1906"><a href="#cb8-1906" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb8-1907"><a href="#cb8-1907" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.3s ease;</span></span>
<span id="cb8-1908"><a href="#cb8-1908" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: inherit;</span></span>
<span id="cb8-1909"><a href="#cb8-1909" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1910"><a href="#cb8-1910" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-btn.active, .filter-btn:hover </span><span class="ch">{{</span></span>
<span id="cb8-1911"><a href="#cb8-1911" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #667eea;</span></span>
<span id="cb8-1912"><a href="#cb8-1912" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb8-1913"><a href="#cb8-1913" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb8-1914"><a href="#cb8-1914" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: translateY(-2px);</span></span>
<span id="cb8-1915"><a href="#cb8-1915" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);</span></span>
<span id="cb8-1916"><a href="#cb8-1916" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1917"><a href="#cb8-1917" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversations-grid </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1918"><a href="#cb8-1918" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: grid; </span></span>
<span id="cb8-1919"><a href="#cb8-1919" aria-hidden="true" tabindex="-1"></a><span class="ss">            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); </span></span>
<span id="cb8-1920"><a href="#cb8-1920" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 25px; </span></span>
<span id="cb8-1921"><a href="#cb8-1921" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 35px;</span></span>
<span id="cb8-1922"><a href="#cb8-1922" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);</span></span>
<span id="cb8-1923"><a href="#cb8-1923" aria-hidden="true" tabindex="-1"></a><span class="ss">            min-height: 400px;</span></span>
<span id="cb8-1924"><a href="#cb8-1924" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1925"><a href="#cb8-1925" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1926"><a href="#cb8-1926" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white; </span></span>
<span id="cb8-1927"><a href="#cb8-1927" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #e9ecef; </span></span>
<span id="cb8-1928"><a href="#cb8-1928" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 15px; </span></span>
<span id="cb8-1929"><a href="#cb8-1929" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 25px; </span></span>
<span id="cb8-1930"><a href="#cb8-1930" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.4s ease; </span></span>
<span id="cb8-1931"><a href="#cb8-1931" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer; </span></span>
<span id="cb8-1932"><a href="#cb8-1932" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: relative;</span></span>
<span id="cb8-1933"><a href="#cb8-1933" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 15px rgba(0,0,0,0.08);</span></span>
<span id="cb8-1934"><a href="#cb8-1934" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1935"><a href="#cb8-1935" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card:hover </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1936"><a href="#cb8-1936" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: translateY(-8px); </span></span>
<span id="cb8-1937"><a href="#cb8-1937" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 15px 35px rgba(0,0,0,0.15); </span></span>
<span id="cb8-1938"><a href="#cb8-1938" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb8-1939"><a href="#cb8-1939" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1940"><a href="#cb8-1940" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-header </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1941"><a href="#cb8-1941" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb8-1942"><a href="#cb8-1942" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between; </span></span>
<span id="cb8-1943"><a href="#cb8-1943" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: flex-start; </span></span>
<span id="cb8-1944"><a href="#cb8-1944" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 18px; </span></span>
<span id="cb8-1945"><a href="#cb8-1945" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1946"><a href="#cb8-1946" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-number </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1947"><a href="#cb8-1947" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #667eea, #764ba2); </span></span>
<span id="cb8-1948"><a href="#cb8-1948" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb8-1949"><a href="#cb8-1949" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 8px 16px; </span></span>
<span id="cb8-1950"><a href="#cb8-1950" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 20px; </span></span>
<span id="cb8-1951"><a href="#cb8-1951" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em; </span></span>
<span id="cb8-1952"><a href="#cb8-1952" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb8-1953"><a href="#cb8-1953" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);</span></span>
<span id="cb8-1954"><a href="#cb8-1954" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1955"><a href="#cb8-1955" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-source </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1956"><a href="#cb8-1956" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e3f2fd; </span></span>
<span id="cb8-1957"><a href="#cb8-1957" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #1976d2; </span></span>
<span id="cb8-1958"><a href="#cb8-1958" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 5px 12px; </span></span>
<span id="cb8-1959"><a href="#cb8-1959" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px; </span></span>
<span id="cb8-1960"><a href="#cb8-1960" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.85em; </span></span>
<span id="cb8-1961"><a href="#cb8-1961" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold; </span></span>
<span id="cb8-1962"><a href="#cb8-1962" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 10px;</span></span>
<span id="cb8-1963"><a href="#cb8-1963" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1964"><a href="#cb8-1964" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-title </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1965"><a href="#cb8-1965" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.3em; </span></span>
<span id="cb8-1966"><a href="#cb8-1966" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 600; </span></span>
<span id="cb8-1967"><a href="#cb8-1967" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50; </span></span>
<span id="cb8-1968"><a href="#cb8-1968" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 12px; </span></span>
<span id="cb8-1969"><a href="#cb8-1969" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.4;</span></span>
<span id="cb8-1970"><a href="#cb8-1970" aria-hidden="true" tabindex="-1"></a><span class="ss">            min-height: 3.6em;</span></span>
<span id="cb8-1971"><a href="#cb8-1971" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb8-1972"><a href="#cb8-1972" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1973"><a href="#cb8-1973" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-summary </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1974"><a href="#cb8-1974" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #6c757d; </span></span>
<span id="cb8-1975"><a href="#cb8-1975" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.95em; </span></span>
<span id="cb8-1976"><a href="#cb8-1976" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.5; </span></span>
<span id="cb8-1977"><a href="#cb8-1977" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 18px;</span></span>
<span id="cb8-1978"><a href="#cb8-1978" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: -webkit-box;</span></span>
<span id="cb8-1979"><a href="#cb8-1979" aria-hidden="true" tabindex="-1"></a><span class="ss">            -webkit-line-clamp: 3;</span></span>
<span id="cb8-1980"><a href="#cb8-1980" aria-hidden="true" tabindex="-1"></a><span class="ss">            -webkit-box-orient: vertical;</span></span>
<span id="cb8-1981"><a href="#cb8-1981" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb8-1982"><a href="#cb8-1982" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb8-1983"><a href="#cb8-1983" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1984"><a href="#cb8-1984" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-meta </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1985"><a href="#cb8-1985" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb8-1986"><a href="#cb8-1986" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between; </span></span>
<span id="cb8-1987"><a href="#cb8-1987" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.85em; </span></span>
<span id="cb8-1988"><a href="#cb8-1988" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #868e96; </span></span>
<span id="cb8-1989"><a href="#cb8-1989" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-top: 1px solid #e9ecef; </span></span>
<span id="cb8-1990"><a href="#cb8-1990" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-top: 18px;</span></span>
<span id="cb8-1991"><a href="#cb8-1991" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-1992"><a href="#cb8-1992" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-actions </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-1993"><a href="#cb8-1993" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: absolute; </span></span>
<span id="cb8-1994"><a href="#cb8-1994" aria-hidden="true" tabindex="-1"></a><span class="ss">            top: 20px; </span></span>
<span id="cb8-1995"><a href="#cb8-1995" aria-hidden="true" tabindex="-1"></a><span class="ss">            right: 20px; </span></span>
<span id="cb8-1996"><a href="#cb8-1996" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb8-1997"><a href="#cb8-1997" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 8px; </span></span>
<span id="cb8-1998"><a href="#cb8-1998" aria-hidden="true" tabindex="-1"></a><span class="ss">            opacity: 0; </span></span>
<span id="cb8-1999"><a href="#cb8-1999" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: opacity 0.3s ease; </span></span>
<span id="cb8-2000"><a href="#cb8-2000" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-2001"><a href="#cb8-2001" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card:hover .card-actions </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-2002"><a href="#cb8-2002" aria-hidden="true" tabindex="-1"></a><span class="ss">            opacity: 1; </span></span>
<span id="cb8-2003"><a href="#cb8-2003" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-2004"><a href="#cb8-2004" aria-hidden="true" tabindex="-1"></a><span class="ss">        .action-btn </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-2005"><a href="#cb8-2005" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white; </span></span>
<span id="cb8-2006"><a href="#cb8-2006" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 2px solid #e9ecef; </span></span>
<span id="cb8-2007"><a href="#cb8-2007" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px; </span></span>
<span id="cb8-2008"><a href="#cb8-2008" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 6px 12px; </span></span>
<span id="cb8-2009"><a href="#cb8-2009" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.8em; </span></span>
<span id="cb8-2010"><a href="#cb8-2010" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer; </span></span>
<span id="cb8-2011"><a href="#cb8-2011" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.3s ease;</span></span>
<span id="cb8-2012"><a href="#cb8-2012" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb8-2013"><a href="#cb8-2013" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb8-2014"><a href="#cb8-2014" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333;</span></span>
<span id="cb8-2015"><a href="#cb8-2015" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb8-2016"><a href="#cb8-2016" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-2017"><a href="#cb8-2017" aria-hidden="true" tabindex="-1"></a><span class="ss">        .action-btn:hover </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-2018"><a href="#cb8-2018" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #667eea; </span></span>
<span id="cb8-2019"><a href="#cb8-2019" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb8-2020"><a href="#cb8-2020" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb8-2021"><a href="#cb8-2021" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: scale(1.05);</span></span>
<span id="cb8-2022"><a href="#cb8-2022" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-2023"><a href="#cb8-2023" aria-hidden="true" tabindex="-1"></a><span class="ss">        .recent-badge </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-2024"><a href="#cb8-2024" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #ff6b6b; </span></span>
<span id="cb8-2025"><a href="#cb8-2025" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb8-2026"><a href="#cb8-2026" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 3px 10px; </span></span>
<span id="cb8-2027"><a href="#cb8-2027" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px; </span></span>
<span id="cb8-2028"><a href="#cb8-2028" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.75em; </span></span>
<span id="cb8-2029"><a href="#cb8-2029" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 8px;</span></span>
<span id="cb8-2030"><a href="#cb8-2030" aria-hidden="true" tabindex="-1"></a><span class="ss">            animation: pulse 2s infinite;</span></span>
<span id="cb8-2031"><a href="#cb8-2031" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-2032"><a href="#cb8-2032" aria-hidden="true" tabindex="-1"></a><span class="ss">        .no-results </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb8-2033"><a href="#cb8-2033" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center; </span></span>
<span id="cb8-2034"><a href="#cb8-2034" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 60px 20px; </span></span>
<span id="cb8-2035"><a href="#cb8-2035" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #6c757d;</span></span>
<span id="cb8-2036"><a href="#cb8-2036" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.1em;</span></span>
<span id="cb8-2037"><a href="#cb8-2037" aria-hidden="true" tabindex="-1"></a><span class="ss">            grid-column: 1 / -1;</span></span>
<span id="cb8-2038"><a href="#cb8-2038" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-2039"><a href="#cb8-2039" aria-hidden="true" tabindex="-1"></a><span class="ss">        @keyframes pulse </span><span class="ch">{{</span></span>
<span id="cb8-2040"><a href="#cb8-2040" aria-hidden="true" tabindex="-1"></a><span class="ss">            0% </span><span class="ch">{{</span><span class="ss"> transform: scale(1); </span><span class="ch">}}</span></span>
<span id="cb8-2041"><a href="#cb8-2041" aria-hidden="true" tabindex="-1"></a><span class="ss">            50% </span><span class="ch">{{</span><span class="ss"> transform: scale(1.05); </span><span class="ch">}}</span></span>
<span id="cb8-2042"><a href="#cb8-2042" aria-hidden="true" tabindex="-1"></a><span class="ss">            100% </span><span class="ch">{{</span><span class="ss"> transform: scale(1); </span><span class="ch">}}</span></span>
<span id="cb8-2043"><a href="#cb8-2043" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-2044"><a href="#cb8-2044" aria-hidden="true" tabindex="-1"></a><span class="ss">        .category-badge </span><span class="ch">{{</span></span>
<span id="cb8-2045"><a href="#cb8-2045" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb8-2046"><a href="#cb8-2046" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e3f2fd;</span></span>
<span id="cb8-2047"><a href="#cb8-2047" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #1976d2;</span></span>
<span id="cb8-2048"><a href="#cb8-2048" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 10px;</span></span>
<span id="cb8-2049"><a href="#cb8-2049" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px;</span></span>
<span id="cb8-2050"><a href="#cb8-2050" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.8em;</span></span>
<span id="cb8-2051"><a href="#cb8-2051" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 8px;</span></span>
<span id="cb8-2052"><a href="#cb8-2052" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb8-2053"><a href="#cb8-2053" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-2054"><a href="#cb8-2054" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-2055"><a href="#cb8-2055" aria-hidden="true" tabindex="-1"></a><span class="ss">        .direct-link </span><span class="ch">{{</span></span>
<span id="cb8-2056"><a href="#cb8-2056" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb8-2057"><a href="#cb8-2057" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 5px;</span></span>
<span id="cb8-2058"><a href="#cb8-2058" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 8px 15px;</span></span>
<span id="cb8-2059"><a href="#cb8-2059" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #28a745;</span></span>
<span id="cb8-2060"><a href="#cb8-2060" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb8-2061"><a href="#cb8-2061" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb8-2062"><a href="#cb8-2062" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 5px;</span></span>
<span id="cb8-2063"><a href="#cb8-2063" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb8-2064"><a href="#cb8-2064" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-2065"><a href="#cb8-2065" aria-hidden="true" tabindex="-1"></a><span class="ss">        .direct-link:hover </span><span class="ch">{{</span></span>
<span id="cb8-2066"><a href="#cb8-2066" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #218838;</span></span>
<span id="cb8-2067"><a href="#cb8-2067" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-2068"><a href="#cb8-2068" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-2069"><a href="#cb8-2069" aria-hidden="true" tabindex="-1"></a><span class="ss">        .html-btn </span><span class="ch">{{</span></span>
<span id="cb8-2070"><a href="#cb8-2070" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #17a2b8;</span></span>
<span id="cb8-2071"><a href="#cb8-2071" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb8-2072"><a href="#cb8-2072" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-2073"><a href="#cb8-2073" aria-hidden="true" tabindex="-1"></a><span class="ss">        .html-btn:hover </span><span class="ch">{{</span></span>
<span id="cb8-2074"><a href="#cb8-2074" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #138496;</span></span>
<span id="cb8-2075"><a href="#cb8-2075" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-2076"><a href="#cb8-2076" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-2077"><a href="#cb8-2077" aria-hidden="true" tabindex="-1"></a><span class="ss">        .pdf-btn </span><span class="ch">{{</span></span>
<span id="cb8-2078"><a href="#cb8-2078" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #dc3545;</span></span>
<span id="cb8-2079"><a href="#cb8-2079" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb8-2080"><a href="#cb8-2080" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-2081"><a href="#cb8-2081" aria-hidden="true" tabindex="-1"></a><span class="ss">        .pdf-btn:hover </span><span class="ch">{{</span></span>
<span id="cb8-2082"><a href="#cb8-2082" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #c82333;</span></span>
<span id="cb8-2083"><a href="#cb8-2083" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb8-2084"><a href="#cb8-2084" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb8-2085"><a href="#cb8-2085" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb8-2086"><a href="#cb8-2086" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb8-2087"><a href="#cb8-2087" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb8-2088"><a href="#cb8-2088" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;header&quot;&gt;</span></span>
<span id="cb8-2089"><a href="#cb8-2089" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;h1&gt;üìö √çndice Combinado de Conversas&lt;/h1&gt;</span></span>
<span id="cb8-2090"><a href="#cb8-2090" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;p&gt;Qwen3 ‚Ä¢ ChatGPT ‚Ä¢ DeepSeek ‚Ä¢ Grok ‚Ä¢ COM HTML (Pandoc + MathJax)&lt;/p&gt;</span></span>
<span id="cb8-2091"><a href="#cb8-2091" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div class=&quot;stats&quot;&gt;</span></span>
<span id="cb8-2092"><a href="#cb8-2092" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb8-2093"><a href="#cb8-2093" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Total:&lt;/strong&gt; &lt;span id=&quot;total-count&quot;&gt;</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">&lt;/span&gt; conversas</span></span>
<span id="cb8-2094"><a href="#cb8-2094" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb8-2095"><a href="#cb8-2095" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb8-2096"><a href="#cb8-2096" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Ordena√ß√£o:&lt;/strong&gt; Mais Recentes Primeiro</span></span>
<span id="cb8-2097"><a href="#cb8-2097" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb8-2098"><a href="#cb8-2098" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb8-2099"><a href="#cb8-2099" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Atualizado:&lt;/strong&gt; </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">.</span>strftime(<span class="st">&#39;</span><span class="sc">%d</span><span class="st">/%m/%Y %H:%M&#39;</span>)<span class="sc">}</span></span>
<span id="cb8-2100"><a href="#cb8-2100" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb8-2101"><a href="#cb8-2101" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb8-2102"><a href="#cb8-2102" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb8-2103"><a href="#cb8-2103" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-2104"><a href="#cb8-2104" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;search-section&quot;&gt;</span></span>
<span id="cb8-2105"><a href="#cb8-2105" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;input type=&quot;text&quot; id=&quot;searchInput&quot; class=&quot;search-box&quot; placeholder=&quot;üîç Pesquisar por t√≠tulo, conte√∫do ou categoria...&quot;&gt;</span></span>
<span id="cb8-2106"><a href="#cb8-2106" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb8-2107"><a href="#cb8-2107" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb8-2108"><a href="#cb8-2108" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;filter-section&quot;&gt;</span></span>
<span id="cb8-2109"><a href="#cb8-2109" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;button class=&quot;filter-btn active&quot; data-filter=&quot;todas&quot;&gt;Todas (</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">)&lt;/button&gt;</span></span>
<span id="cb8-2110"><a href="#cb8-2110" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb8-2111"><a href="#cb8-2111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-2112"><a href="#cb8-2112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category, count <span class="kw">in</span> category_stats.items():</span>
<span id="cb8-2113"><a href="#cb8-2113" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">+=</span> <span class="ss">f&#39;&lt;button class=&quot;filter-btn&quot; data-filter=&quot;</span><span class="sc">{</span>category<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot;&gt;</span><span class="sc">{</span>category<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">)&lt;/button&gt;</span><span class="ch">\n</span><span class="ss">&#39;</span></span>
<span id="cb8-2114"><a href="#cb8-2114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2115"><a href="#cb8-2115" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb8-2116"><a href="#cb8-2116" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb8-2117"><a href="#cb8-2117" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb8-2118"><a href="#cb8-2118" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div style=&quot;text-align: center; padding: 15px; background: #e9ecef; border-bottom: 1px solid #ddd;&quot;&gt;</span></span>
<span id="cb8-2119"><a href="#cb8-2119" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;strong&gt;Acesso R√°pido:&lt;/strong&gt;</span></span>
<span id="cb8-2120"><a href="#cb8-2120" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_markdown/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìÅ Markdown&lt;/a&gt;</span></span>
<span id="cb8-2121"><a href="#cb8-2121" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_html/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üåê HTML&lt;/a&gt;</span></span>
<span id="cb8-2122"><a href="#cb8-2122" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_pdfs/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìÑ PDF&lt;/a&gt;</span></span>
<span id="cb8-2123"><a href="#cb8-2123" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_json/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìã JSON&lt;/a&gt;</span></span>
<span id="cb8-2124"><a href="#cb8-2124" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb8-2125"><a href="#cb8-2125" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb8-2126"><a href="#cb8-2126" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div class=&quot;conversations-grid&quot; id=&quot;conversationsGrid&quot;&gt;</span></span>
<span id="cb8-2127"><a href="#cb8-2127" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb8-2128"><a href="#cb8-2128" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-2129"><a href="#cb8-2129" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.all_conversations):</span>
<span id="cb8-2130"><a href="#cb8-2130" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb8-2131"><a href="#cb8-2131" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb8-2132"><a href="#cb8-2132" aria-hidden="true" tabindex="-1"></a>            recent_badge <span class="op">=</span> <span class="st">&quot;&lt;span class=&#39;recent-badge&#39;&gt;NOVO&lt;/span&gt;&quot;</span> <span class="cf">if</span> i <span class="op">&lt;</span> <span class="dv">5</span> <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb8-2133"><a href="#cb8-2133" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-2134"><a href="#cb8-2134" aria-hidden="true" tabindex="-1"></a>            summary <span class="op">=</span> conv.get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;Sem resumo dispon√≠vel&#39;</span>)</span>
<span id="cb8-2135"><a href="#cb8-2135" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(summary) <span class="op">&gt;</span> <span class="dv">150</span>:</span>
<span id="cb8-2136"><a href="#cb8-2136" aria-hidden="true" tabindex="-1"></a>                summary <span class="op">=</span> summary[:<span class="dv">150</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span></span>
<span id="cb8-2137"><a href="#cb8-2137" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-2138"><a href="#cb8-2138" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">+=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb8-2139"><a href="#cb8-2139" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div class=&quot;conversation-card&quot; data-title=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&quot; data-summary=&quot;</span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&quot; data-source=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot; data-category=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;category&#39;</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot;&gt;</span></span>
<span id="cb8-2140"><a href="#cb8-2140" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-header&quot;&gt;</span></span>
<span id="cb8-2141"><a href="#cb8-2141" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;card-number&quot;&gt;#</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>recent_badge<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb8-2142"><a href="#cb8-2142" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;card-actions&quot;&gt;</span></span>
<span id="cb8-2143"><a href="#cb8-2143" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_markdown/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.md&quot; class=&quot;action-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üìÑ MD&lt;/a&gt;</span></span>
<span id="cb8-2144"><a href="#cb8-2144" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_html/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&quot; class=&quot;action-btn html-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üåê HTML&lt;/a&gt;</span></span>
<span id="cb8-2145"><a href="#cb8-2145" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_pdfs/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.pdf&quot; class=&quot;action-btn pdf-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üìä PDF&lt;/a&gt;</span></span>
<span id="cb8-2146"><a href="#cb8-2146" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;/div&gt;</span></span>
<span id="cb8-2147"><a href="#cb8-2147" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb8-2148"><a href="#cb8-2148" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-title&quot; onclick=&quot;openHTML(&#39;</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&#39;)&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb8-2149"><a href="#cb8-2149" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div&gt;</span></span>
<span id="cb8-2150"><a href="#cb8-2150" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span class=&quot;card-source&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb8-2151"><a href="#cb8-2151" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span class=&quot;category-badge&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;category&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb8-2152"><a href="#cb8-2152" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb8-2153"><a href="#cb8-2153" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-summary&quot; onclick=&quot;openHTML(&#39;</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&#39;)&quot;&gt;</span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb8-2154"><a href="#cb8-2154" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-meta&quot;&gt;</span></span>
<span id="cb8-2155"><a href="#cb8-2155" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span&gt;üìÖ </span><span class="sc">{</span>conv<span class="sc">.</span>get(<span class="st">&#39;updated_at&#39;</span>) <span class="kw">or</span> conv<span class="sc">.</span>get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb8-2156"><a href="#cb8-2156" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span&gt;üí¨ </span><span class="sc">{</span><span class="bu">len</span>(conv[<span class="st">&#39;messages&#39;</span>])<span class="sc">}</span><span class="ss"> mensagens&lt;/span&gt;</span></span>
<span id="cb8-2157"><a href="#cb8-2157" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb8-2158"><a href="#cb8-2158" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb8-2159"><a href="#cb8-2159" aria-hidden="true" tabindex="-1"></a><span class="ss">            &quot;&quot;&quot;</span></span>
<span id="cb8-2160"><a href="#cb8-2160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2161"><a href="#cb8-2161" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb8-2162"><a href="#cb8-2162" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb8-2163"><a href="#cb8-2163" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/div&gt;</span></span>
<span id="cb8-2164"><a href="#cb8-2164" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb8-2165"><a href="#cb8-2165" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;script&gt;</span></span>
<span id="cb8-2166"><a href="#cb8-2166" aria-hidden="true" tabindex="-1"></a><span class="st">        let currentFilter = &#39;todas&#39;;</span></span>
<span id="cb8-2167"><a href="#cb8-2167" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb8-2168"><a href="#cb8-2168" aria-hidden="true" tabindex="-1"></a><span class="st">        document.addEventListener(&#39;DOMContentLoaded&#39;, function() {</span></span>
<span id="cb8-2169"><a href="#cb8-2169" aria-hidden="true" tabindex="-1"></a><span class="st">            updateStats();</span></span>
<span id="cb8-2170"><a href="#cb8-2170" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb8-2171"><a href="#cb8-2171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2172"><a href="#cb8-2172" aria-hidden="true" tabindex="-1"></a><span class="st">        document.querySelectorAll(&#39;.filter-btn&#39;).forEach(btn =&gt; {</span></span>
<span id="cb8-2173"><a href="#cb8-2173" aria-hidden="true" tabindex="-1"></a><span class="st">            btn.addEventListener(&#39;click&#39;, () =&gt; {</span></span>
<span id="cb8-2174"><a href="#cb8-2174" aria-hidden="true" tabindex="-1"></a><span class="st">                document.querySelectorAll(&#39;.filter-btn&#39;).forEach(b =&gt; b.classList.remove(&#39;active&#39;));</span></span>
<span id="cb8-2175"><a href="#cb8-2175" aria-hidden="true" tabindex="-1"></a><span class="st">                btn.classList.add(&#39;active&#39;);</span></span>
<span id="cb8-2176"><a href="#cb8-2176" aria-hidden="true" tabindex="-1"></a><span class="st">                currentFilter = btn.getAttribute(&#39;data-filter&#39;);</span></span>
<span id="cb8-2177"><a href="#cb8-2177" aria-hidden="true" tabindex="-1"></a><span class="st">                filterConversations();</span></span>
<span id="cb8-2178"><a href="#cb8-2178" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb8-2179"><a href="#cb8-2179" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb8-2180"><a href="#cb8-2180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2181"><a href="#cb8-2181" aria-hidden="true" tabindex="-1"></a><span class="st">        document.getElementById(&#39;searchInput&#39;).addEventListener(&#39;input&#39;, filterConversations);</span></span>
<span id="cb8-2182"><a href="#cb8-2182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2183"><a href="#cb8-2183" aria-hidden="true" tabindex="-1"></a><span class="st">        function filterConversations() {</span></span>
<span id="cb8-2184"><a href="#cb8-2184" aria-hidden="true" tabindex="-1"></a><span class="st">            const term = document.getElementById(&#39;searchInput&#39;).value.toLowerCase();</span></span>
<span id="cb8-2185"><a href="#cb8-2185" aria-hidden="true" tabindex="-1"></a><span class="st">            const cards = document.querySelectorAll(&#39;.conversation-card&#39;);</span></span>
<span id="cb8-2186"><a href="#cb8-2186" aria-hidden="true" tabindex="-1"></a><span class="st">            let visible = 0;</span></span>
<span id="cb8-2187"><a href="#cb8-2187" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-2188"><a href="#cb8-2188" aria-hidden="true" tabindex="-1"></a><span class="st">            cards.forEach(card =&gt; {</span></span>
<span id="cb8-2189"><a href="#cb8-2189" aria-hidden="true" tabindex="-1"></a><span class="st">                const title = card.getAttribute(&#39;data-title&#39;).toLowerCase();</span></span>
<span id="cb8-2190"><a href="#cb8-2190" aria-hidden="true" tabindex="-1"></a><span class="st">                const summary = card.getAttribute(&#39;data-summary&#39;).toLowerCase();</span></span>
<span id="cb8-2191"><a href="#cb8-2191" aria-hidden="true" tabindex="-1"></a><span class="st">                const source = card.getAttribute(&#39;data-source&#39;).toLowerCase();</span></span>
<span id="cb8-2192"><a href="#cb8-2192" aria-hidden="true" tabindex="-1"></a><span class="st">                const category = card.getAttribute(&#39;data-category&#39;).toLowerCase();</span></span>
<span id="cb8-2193"><a href="#cb8-2193" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb8-2194"><a href="#cb8-2194" aria-hidden="true" tabindex="-1"></a><span class="st">                const matchesSearch = (title.includes(term) || summary.includes(term) || category.includes(term) || source.includes(term));</span></span>
<span id="cb8-2195"><a href="#cb8-2195" aria-hidden="true" tabindex="-1"></a><span class="st">                const matchesCategory = (currentFilter === &#39;todas&#39; || category === currentFilter);</span></span>
<span id="cb8-2196"><a href="#cb8-2196" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb8-2197"><a href="#cb8-2197" aria-hidden="true" tabindex="-1"></a><span class="st">                if (matchesSearch &amp;&amp; matchesCategory) {</span></span>
<span id="cb8-2198"><a href="#cb8-2198" aria-hidden="true" tabindex="-1"></a><span class="st">                    card.style.display = &#39;block&#39;;</span></span>
<span id="cb8-2199"><a href="#cb8-2199" aria-hidden="true" tabindex="-1"></a><span class="st">                    visible++;</span></span>
<span id="cb8-2200"><a href="#cb8-2200" aria-hidden="true" tabindex="-1"></a><span class="st">                } else {</span></span>
<span id="cb8-2201"><a href="#cb8-2201" aria-hidden="true" tabindex="-1"></a><span class="st">                    card.style.display = &#39;none&#39;;</span></span>
<span id="cb8-2202"><a href="#cb8-2202" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb8-2203"><a href="#cb8-2203" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb8-2204"><a href="#cb8-2204" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-2205"><a href="#cb8-2205" aria-hidden="true" tabindex="-1"></a><span class="st">            updateStats(visible);</span></span>
<span id="cb8-2206"><a href="#cb8-2206" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-2207"><a href="#cb8-2207" aria-hidden="true" tabindex="-1"></a><span class="st">            const grid = document.getElementById(&#39;conversationsGrid&#39;);</span></span>
<span id="cb8-2208"><a href="#cb8-2208" aria-hidden="true" tabindex="-1"></a><span class="st">            const noResults = document.getElementById(&#39;no-results-message&#39;);</span></span>
<span id="cb8-2209"><a href="#cb8-2209" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb8-2210"><a href="#cb8-2210" aria-hidden="true" tabindex="-1"></a><span class="st">            if (visible === 0) {</span></span>
<span id="cb8-2211"><a href="#cb8-2211" aria-hidden="true" tabindex="-1"></a><span class="st">                if (!noResults) {</span></span>
<span id="cb8-2212"><a href="#cb8-2212" aria-hidden="true" tabindex="-1"></a><span class="st">                    const noResultsMsg = document.createElement(&#39;div&#39;);</span></span>
<span id="cb8-2213"><a href="#cb8-2213" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.id = &#39;no-results-message&#39;;</span></span>
<span id="cb8-2214"><a href="#cb8-2214" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.className = &#39;no-results&#39;;</span></span>
<span id="cb8-2215"><a href="#cb8-2215" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.innerHTML = &#39;üîç Nenhuma conversa encontrada. Tente ajustar os filtros ou a pesquisa.&#39;;</span></span>
<span id="cb8-2216"><a href="#cb8-2216" aria-hidden="true" tabindex="-1"></a><span class="st">                    grid.appendChild(noResultsMsg);</span></span>
<span id="cb8-2217"><a href="#cb8-2217" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb8-2218"><a href="#cb8-2218" aria-hidden="true" tabindex="-1"></a><span class="st">            } else if (noResults) {</span></span>
<span id="cb8-2219"><a href="#cb8-2219" aria-hidden="true" tabindex="-1"></a><span class="st">                noResults.remove();</span></span>
<span id="cb8-2220"><a href="#cb8-2220" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-2221"><a href="#cb8-2221" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb8-2222"><a href="#cb8-2222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2223"><a href="#cb8-2223" aria-hidden="true" tabindex="-1"></a><span class="st">        function updateStats(visibleCount = null) {</span></span>
<span id="cb8-2224"><a href="#cb8-2224" aria-hidden="true" tabindex="-1"></a><span class="st">            const totalElement = document.getElementById(&#39;total-count&#39;);</span></span>
<span id="cb8-2225"><a href="#cb8-2225" aria-hidden="true" tabindex="-1"></a><span class="st">            if (visibleCount !== null) {</span></span>
<span id="cb8-2226"><a href="#cb8-2226" aria-hidden="true" tabindex="-1"></a><span class="st">                totalElement.textContent = visibleCount;</span></span>
<span id="cb8-2227"><a href="#cb8-2227" aria-hidden="true" tabindex="-1"></a><span class="st">            } else {</span></span>
<span id="cb8-2228"><a href="#cb8-2228" aria-hidden="true" tabindex="-1"></a><span class="st">                totalElement.textContent = &quot;&quot;&quot;</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(<span class="va">self</span>.all_conversations)) <span class="op">+</span> <span class="st">&quot;&quot;&quot;;</span></span>
<span id="cb8-2229"><a href="#cb8-2229" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-2230"><a href="#cb8-2230" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb8-2231"><a href="#cb8-2231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2232"><a href="#cb8-2232" aria-hidden="true" tabindex="-1"></a><span class="st">        function openHTML(filename) {</span></span>
<span id="cb8-2233"><a href="#cb8-2233" aria-hidden="true" tabindex="-1"></a><span class="st">            const htmlUrl = &#39;combined_html/&#39; + filename;</span></span>
<span id="cb8-2234"><a href="#cb8-2234" aria-hidden="true" tabindex="-1"></a><span class="st">            console.log(&#39;Abrindo HTML:&#39;, htmlUrl);</span></span>
<span id="cb8-2235"><a href="#cb8-2235" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(htmlUrl, &#39;_blank&#39;);</span></span>
<span id="cb8-2236"><a href="#cb8-2236" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb8-2237"><a href="#cb8-2237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2238"><a href="#cb8-2238" aria-hidden="true" tabindex="-1"></a><span class="st">        function openMD(filename) {</span></span>
<span id="cb8-2239"><a href="#cb8-2239" aria-hidden="true" tabindex="-1"></a><span class="st">            const mdUrl = &#39;combined_markdown/&#39; + filename;</span></span>
<span id="cb8-2240"><a href="#cb8-2240" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(mdUrl, &#39;_blank&#39;);</span></span>
<span id="cb8-2241"><a href="#cb8-2241" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb8-2242"><a href="#cb8-2242" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb8-2243"><a href="#cb8-2243" aria-hidden="true" tabindex="-1"></a><span class="st">        function openPDF(filename) {</span></span>
<span id="cb8-2244"><a href="#cb8-2244" aria-hidden="true" tabindex="-1"></a><span class="st">            const pdfFile = filename.replace(&#39;.html&#39;, &#39;.pdf&#39;);</span></span>
<span id="cb8-2245"><a href="#cb8-2245" aria-hidden="true" tabindex="-1"></a><span class="st">            const pdfUrl = &#39;combined_pdfs/&#39; + pdfFile;</span></span>
<span id="cb8-2246"><a href="#cb8-2246" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(pdfUrl, &#39;_blank&#39;);</span></span>
<span id="cb8-2247"><a href="#cb8-2247" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb8-2248"><a href="#cb8-2248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2249"><a href="#cb8-2249" aria-hidden="true" tabindex="-1"></a><span class="st">        document.addEventListener(&#39;keydown&#39;, function(e) {</span></span>
<span id="cb8-2250"><a href="#cb8-2250" aria-hidden="true" tabindex="-1"></a><span class="st">            if (e.key === &#39;Escape&#39;) {</span></span>
<span id="cb8-2251"><a href="#cb8-2251" aria-hidden="true" tabindex="-1"></a><span class="st">                document.getElementById(&#39;searchInput&#39;).value = &#39;&#39;;</span></span>
<span id="cb8-2252"><a href="#cb8-2252" aria-hidden="true" tabindex="-1"></a><span class="st">                filterConversations();</span></span>
<span id="cb8-2253"><a href="#cb8-2253" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb8-2254"><a href="#cb8-2254" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb8-2255"><a href="#cb8-2255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2256"><a href="#cb8-2256" aria-hidden="true" tabindex="-1"></a><span class="st">        document.querySelectorAll(&#39;.conversation-card&#39;).forEach(card =&gt; {</span></span>
<span id="cb8-2257"><a href="#cb8-2257" aria-hidden="true" tabindex="-1"></a><span class="st">            card.addEventListener(&#39;click&#39;, function(e) {</span></span>
<span id="cb8-2258"><a href="#cb8-2258" aria-hidden="true" tabindex="-1"></a><span class="st">                if (e.target.closest(&#39;.action-btn&#39;)) {</span></span>
<span id="cb8-2259"><a href="#cb8-2259" aria-hidden="true" tabindex="-1"></a><span class="st">                    return;</span></span>
<span id="cb8-2260"><a href="#cb8-2260" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb8-2261"><a href="#cb8-2261" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb8-2262"><a href="#cb8-2262" aria-hidden="true" tabindex="-1"></a><span class="st">                const htmlBtn = this.querySelector(&#39;a.html-btn&#39;);</span></span>
<span id="cb8-2263"><a href="#cb8-2263" aria-hidden="true" tabindex="-1"></a><span class="st">                if (htmlBtn) {</span></span>
<span id="cb8-2264"><a href="#cb8-2264" aria-hidden="true" tabindex="-1"></a><span class="st">                    const htmlUrl = htmlBtn.getAttribute(&#39;href&#39;);</span></span>
<span id="cb8-2265"><a href="#cb8-2265" aria-hidden="true" tabindex="-1"></a><span class="st">                    window.open(htmlUrl, &#39;_blank&#39;);</span></span>
<span id="cb8-2266"><a href="#cb8-2266" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb8-2267"><a href="#cb8-2267" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb8-2268"><a href="#cb8-2268" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb8-2269"><a href="#cb8-2269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2270"><a href="#cb8-2270" aria-hidden="true" tabindex="-1"></a><span class="st">        document.getElementById(&#39;searchInput&#39;).focus();</span></span>
<span id="cb8-2271"><a href="#cb8-2271" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb8-2272"><a href="#cb8-2272" aria-hidden="true" tabindex="-1"></a><span class="st">        console.log(&#39;√çndice carregado com&#39;, &quot;&quot;&quot;</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(<span class="va">self</span>.all_conversations)) <span class="op">+</span> <span class="st">&quot;&quot;&quot;, &#39;conversas&#39;);</span></span>
<span id="cb8-2273"><a href="#cb8-2273" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/script&gt;</span></span>
<span id="cb8-2274"><a href="#cb8-2274" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/body&gt;</span></span>
<span id="cb8-2275"><a href="#cb8-2275" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/html&gt;</span></span>
<span id="cb8-2276"><a href="#cb8-2276" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb8-2277"><a href="#cb8-2277" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-2278"><a href="#cb8-2278" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.index_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb8-2279"><a href="#cb8-2279" aria-hidden="true" tabindex="-1"></a>            f.write(html_content)</span>
<span id="cb8-2280"><a href="#cb8-2280" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ √çndice combinado criado: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-2281"><a href="#cb8-2281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2282"><a href="#cb8-2282" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb8-2283"><a href="#cb8-2283" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser(</span>
<span id="cb8-2284"><a href="#cb8-2284" aria-hidden="true" tabindex="-1"></a>        description<span class="op">=</span><span class="st">&quot;Processa exporta√ß√µes combinadas com exporta√ß√£o HTML via Pandoc.&quot;</span></span>
<span id="cb8-2285"><a href="#cb8-2285" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-2286"><a href="#cb8-2286" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">&quot;--dry-run&quot;</span>, action<span class="op">=</span><span class="st">&quot;store_true&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Executa sem salvar arquivos&quot;</span>)</span>
<span id="cb8-2287"><a href="#cb8-2287" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">&quot;--force-overwrite&quot;</span>, action<span class="op">=</span><span class="st">&quot;store_true&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Substitui arquivos existentes&quot;</span>)</span>
<span id="cb8-2288"><a href="#cb8-2288" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-2289"><a href="#cb8-2289" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb8-2290"><a href="#cb8-2290" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-2291"><a href="#cb8-2291" aria-hidden="true" tabindex="-1"></a>    system <span class="op">=</span> CombinedFragmentsSystem(</span>
<span id="cb8-2292"><a href="#cb8-2292" aria-hidden="true" tabindex="-1"></a>        dry_run<span class="op">=</span>args.dry_run,</span>
<span id="cb8-2293"><a href="#cb8-2293" aria-hidden="true" tabindex="-1"></a>        force_overwrite<span class="op">=</span>args.force_overwrite</span>
<span id="cb8-2294"><a href="#cb8-2294" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-2295"><a href="#cb8-2295" aria-hidden="true" tabindex="-1"></a>    system.run()</span>
<span id="cb8-2296"><a href="#cb8-2296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2297"><a href="#cb8-2297" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb8-2298"><a href="#cb8-2298" aria-hidden="true" tabindex="-1"></a>    main()</span></code></pre></div>
<p><strong>Principais otimiza√ß√µes implementadas:</strong></p>
<ol type="1">
<li><strong>TOC Flutuante Otimizado:</strong>
<ul>
<li><code>float: right</code> para posicionamento √† direita</li>
<li>Largura fixa de 320px (280px em telas menores)</li>
<li><code>position: relative</code> e <code>z-index: 100</code> para
sobreposi√ß√£o correta</li>
</ul></li>
<li><strong>Clearfix para Layout:</strong>
<ul>
<li>Classe <code>.main-content</code> com
<code>overflow: hidden</code></li>
<li>Previne problemas com elementos flutuantes</li>
</ul></li>
<li><strong>Layout de Tela Completa:</strong>
<ul>
<li><code>max-width: none</code> no elemento <code>body</code></li>
<li><code>max-width: 95%</code> no container principal</li>
<li>Utiliza praticamente toda a largura dispon√≠vel do browser</li>
</ul></li>
<li><strong>Otimiza√ß√µes Responsivas:</strong>
<ul>
<li>Breakpoints ajustados para 1400px, 1200px e 768px</li>
<li>TOC torna-se est√°tico em telas menores que 1200px</li>
</ul></li>
<li><strong>Melhorias Visuais:</strong>
<ul>
<li>Scroll suave para navega√ß√£o</li>
<li>Destaque visual para se√ß√£o ativa no TOC</li>
<li>Melhor espa√ßamento e tipografia</li>
</ul></li>
</ol>
<p>O sistema mant√©m todas as funcionalidades anteriores corrigidas (Qwen
com content_list) e agora oferece uma experi√™ncia de usu√°rio muito
melhor com o TOC flutuante e layout de tela completa.</p>
<hr />
<h3 data-number="1.2.9" id="utilizador-2025-11-08-070835-deepseek-reasoner"><span class="header-section-number">1.2.9</span> üë§ Utilizador <em>(2025-11-08
07:08:35)</em> <em>[deepseek-reasoner]</em></h3>
<p>Pretendo altera√ß√£o ‚Äìtoc-depth=3</p>
<hr />
<h3 data-number="1.2.10" id="deepseek-2025-11-08-070835-deepseek-reasoner"><span class="header-section-number">1.2.10</span> ü§ñ DeepSeek <em>(2025-11-08
07:08:35)</em> <em>[deepseek-reasoner]</em></h3>
<p>Vamos alterar a profundidade do TOC (Table of Contents) de 2 para 3
n√≠veis. Isso significa que o TOC ir√° incluir t√≠tulos de n√≠vel 1, 2 e 3
(h1, h2, h3).</p>
<p>No c√≥digo, temos duas chamadas ao Pandoc que especificam
<code>--toc-depth=2</code>: 1. No m√©todo
<code>_convert_with_pandoc_optimized</code> 2. No m√©todo
<code>_convert_with_pandoc_basic</code></p>
<p>Vamos alterar ambas para <code>--toc-depth=3</code>. Aqui est√° o
c√≥digo completo com a altera√ß√£o <code>--toc-depth=3</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># comb_fragments_system5_html_export.py</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> webbrowser</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tempfile</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> traceback</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Any, Optional</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> markdown</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CombinedFragmentsSystem:</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, dry_run<span class="op">=</span><span class="va">False</span>, force_overwrite<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_dir <span class="op">=</span> Path(<span class="st">&quot;data&quot;</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dry_run <span class="op">=</span> dry_run</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.force_overwrite <span class="op">=</span> force_overwrite</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configurar logging</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        logging.basicConfig(level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">&#39;</span>)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estrutura de pastas organizada</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dirs <span class="op">=</span> {</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;markdown&#39;</span>: <span class="st">&quot;combined_markdown&quot;</span>,</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_csv&quot;</span>, </span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_json&quot;</span>,</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;pdfs&#39;</span>: <span class="st">&quot;combined_pdfs&quot;</span>,</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;html&#39;</span>: <span class="st">&quot;combined_html&quot;</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.single_files <span class="op">=</span> {</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;csv&#39;</span>: <span class="st">&quot;combined_all_conversations.csv&quot;</span>,</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;json&#39;</span>: <span class="st">&quot;combined_all_conversations.json&quot;</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.index_file <span class="op">=</span> <span class="st">&quot;index.html&quot;</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations <span class="op">=</span> []</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configura√ß√£o de processamento por fonte</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.processors <span class="op">=</span> {</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;qwen&#39;</span>: {</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chat-export.json&quot;</span>,</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_qwen_corrected,</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;chatgpt&#39;</span>: {</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;chatgpt.zip&quot;</span>, </span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_chatgpt,</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;deepseek&#39;</span>: {</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;deepseek_data.zip&quot;</span>,</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_deepseek,</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;grok&#39;</span>: {</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;file&#39;</span>: <span class="st">&quot;grok.zip&quot;</span>,</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="va">self</span>.process_grok,</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;enabled&#39;</span>: <span class="va">True</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sanitize_filename(<span class="va">self</span>, text: <span class="bu">str</span>, max_len: <span class="bu">int</span> <span class="op">=</span> <span class="dv">50</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Sanitiza nomes de arquivo REMOVENDO ESPA√áOS e preservando emojis&quot;&quot;&quot;</span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove caracteres inv√°lidos</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="dv">\s</span><span class="pp">]</span><span class="vs">&#39;</span>  <span class="co"># Inclui \s para remover espa√ßos</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;_&#39;</span>, text)  <span class="co"># Substitui espa√ßos por underscores</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;_</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39;_&#39;</span>, sanitized)  <span class="co"># Remove underscores duplicados</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> sanitized.strip(<span class="st">&#39;_&#39;</span>)  <span class="co"># Remove underscores no in√≠cio e fim</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;conversa_sem_titulo&quot;</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Limita o comprimento</span></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(sanitized) <span class="op">&gt;</span> max_len:</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Tenta cortar em um ponto l√≥gico (underscore)</span></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;_&#39;</span> <span class="kw">in</span> sanitized[:max_len]:</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>                last_underscore <span class="op">=</span> sanitized[:max_len].rfind(<span class="st">&#39;_&#39;</span>)</span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> last_underscore <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>                    sanitized <span class="op">=</span> sanitized[:last_underscore]</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>                sanitized <span class="op">=</span> sanitized[:max_len]</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_original_title(<span class="va">self</span>, text: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Preserva o t√≠tulo original com espa√ßos, apenas removendo caracteres realmente inv√°lidos&quot;&quot;&quot;</span></span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, <span class="bu">str</span>):</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove apenas caracteres realmente problem√°ticos, mantendo espa√ßos</span></span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>        invalid_chars <span class="op">=</span> <span class="vs">r&#39;</span><span class="pp">[&lt;&gt;:&quot;/</span><span class="ch">\\</span><span class="pp">|?*</span><span class="ch">\x00</span><span class="pp">-</span><span class="ch">\x1F\x7F</span><span class="pp">]</span><span class="vs">&#39;</span></span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(invalid_chars, <span class="st">&#39;&#39;</span>, text)</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>        sanitized <span class="op">=</span> re.sub(<span class="vs">r&#39;</span><span class="dv">\s</span><span class="op">+</span><span class="vs">&#39;</span>, <span class="st">&#39; &#39;</span>, sanitized.strip())</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sanitized:</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>            sanitized <span class="op">=</span> <span class="st">&quot;Conversa sem t√≠tulo&quot;</span></span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sanitized</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preserve_special_content(<span class="va">self</span>, content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Preserva f√≥rmulas matem√°ticas, c√≥digo e formata√ß√£o especial&quot;&quot;&quot;</span></span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;&quot;</span></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>        preserved_content <span class="op">=</span> content</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Corrige problemas com barras invertidas em LaTeX</span></span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>        latex_corrections <span class="op">=</span> {</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ärac&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">frac&#39;</span>,</span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Çarepsilon&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">varepsilon&#39;</span>,</span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ç&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span>,</span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;√¢¬ô¬Ä&#39;</span>: <span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span></span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> wrong, correct <span class="kw">in</span> latex_corrections.items():</span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a>            preserved_content <span class="op">=</span> preserved_content.replace(wrong, correct)</span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> preserved_content</span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ensure_directories(<span class="va">self</span>):</span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Cria todas as pastas necess√°rias&quot;&quot;&quot;</span></span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;DRY-RUN: Pastas seriam criadas:&quot;</span>)</span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> folder <span class="kw">in</span> <span class="va">self</span>.output_dirs.values():</span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a>            Path(folder).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;Pasta criada: </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> run(<span class="va">self</span>):</span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Executa o processamento completo&quot;&quot;&quot;</span></span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;SISTEMA COMBINADO DE EXPORTA√á√ïES COM HTML (Qwen3, ChatGPT, DeepSeek, Grok)&quot;</span>)</span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.data_dir.exists():</span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;Pasta &#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">}</span><span class="ss">&#39; n√£o encontrada.&quot;</span>)</span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;Crie a pasta &#39;data&#39; e coloque os arquivos de exporta√ß√£o:&quot;</span>)</span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   - </span><span class="sc">{</span>config[<span class="st">&#39;file&#39;</span>]<span class="sc">}</span><span class="ss"> (para </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;Usando pasta de dados: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data_dir<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ensure_directories()</span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a>        processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> source_name, config <span class="kw">in</span> <span class="va">self</span>.processors.items():</span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> config[<span class="st">&#39;enabled&#39;</span>]:</span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a>                file_path <span class="op">=</span> <span class="va">self</span>.data_dir <span class="op">/</span> config[<span class="st">&#39;file&#39;</span>]</span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> file_path.exists():</span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Processando </span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb9-166"><a href="#cb9-166" aria-hidden="true" tabindex="-1"></a>                    config[<span class="st">&#39;method&#39;</span>](file_path)</span>
<span id="cb9-167"><a href="#cb9-167" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-168"><a href="#cb9-168" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb9-169"><a href="#cb9-169" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.warning(<span class="ss">f&quot;</span><span class="sc">{</span>source_name<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">: arquivo n√£o encontrado - </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-170"><a href="#cb9-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-171"><a href="#cb9-171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> processed_count <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb9-172"><a href="#cb9-172" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhum arquivo de exporta√ß√£o encontrado na pasta &#39;data&#39;.&quot;</span>)</span>
<span id="cb9-173"><a href="#cb9-173" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb9-174"><a href="#cb9-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-175"><a href="#cb9-175" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb9-176"><a href="#cb9-176" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;Nenhuma conversa foi extra√≠da dos arquivos.&quot;</span>)</span>
<span id="cb9-177"><a href="#cb9-177" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb9-178"><a href="#cb9-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-179"><a href="#cb9-179" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._post_process_conversations()</span>
<span id="cb9-180"><a href="#cb9-180" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-181"><a href="#cb9-181" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.dry_run:</span>
<span id="cb9-182"><a href="#cb9-182" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._export_all_formats()</span>
<span id="cb9-183"><a href="#cb9-183" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üéâ SISTEMA COMBINADO FINALIZADO!&quot;</span>)</span>
<span id="cb9-184"><a href="#cb9-184" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ √çndice: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-185"><a href="#cb9-185" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> Path(<span class="va">self</span>.index_file).exists():</span>
<span id="cb9-186"><a href="#cb9-186" aria-hidden="true" tabindex="-1"></a>                webbrowser.<span class="bu">open</span>(<span class="ss">f&#39;file://</span><span class="sc">{</span>Path(<span class="va">self</span>.index_file)<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb9-187"><a href="#cb9-187" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb9-188"><a href="#cb9-188" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">üîÆ MODO DRY-RUN: Nenhum arquivo foi criado.&quot;</span>)</span>
<span id="cb9-189"><a href="#cb9-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-190"><a href="#cb9-190" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _post_process_conversations(<span class="va">self</span>):</span>
<span id="cb9-191"><a href="#cb9-191" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processamento p√≥s-extra√ß√£o das conversas&quot;&quot;&quot;</span></span>
<span id="cb9-192"><a href="#cb9-192" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.all_conversations.sort(</span>
<span id="cb9-193"><a href="#cb9-193" aria-hidden="true" tabindex="-1"></a>            key<span class="op">=</span><span class="kw">lambda</span> x: <span class="va">self</span>.parse_timestamp_for_sorting(</span>
<span id="cb9-194"><a href="#cb9-194" aria-hidden="true" tabindex="-1"></a>                x.get(<span class="st">&#39;updated_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> x.get(<span class="st">&#39;created_at&#39;</span>)</span>
<span id="cb9-195"><a href="#cb9-195" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb9-196"><a href="#cb9-196" aria-hidden="true" tabindex="-1"></a>            reverse<span class="op">=</span><span class="va">True</span></span>
<span id="cb9-197"><a href="#cb9-197" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb9-198"><a href="#cb9-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-199"><a href="#cb9-199" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.all_conversations):</span>
<span id="cb9-200"><a href="#cb9-200" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;number&#39;</span>] <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb9-201"><a href="#cb9-201" aria-hidden="true" tabindex="-1"></a>            conv[<span class="st">&#39;category&#39;</span>] <span class="op">=</span> <span class="va">self</span>.categorize_conversation(conv[<span class="st">&#39;title&#39;</span>], conv.get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;&#39;</span>))</span>
<span id="cb9-202"><a href="#cb9-202" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;source&#39;</span>, <span class="st">&#39;Desconhecido&#39;</span>)</span>
<span id="cb9-203"><a href="#cb9-203" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;messages&#39;</span>, [])</span>
<span id="cb9-204"><a href="#cb9-204" aria-hidden="true" tabindex="-1"></a>            conv.setdefault(<span class="st">&#39;summary&#39;</span>, conv[<span class="st">&#39;messages&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> conv[<span class="st">&#39;messages&#39;</span>] <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>)</span>
<span id="cb9-205"><a href="#cb9-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-206"><a href="#cb9-206" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä Total combinado de conversas: </span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-207"><a href="#cb9-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-208"><a href="#cb9-208" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _export_all_formats(<span class="va">self</span>):</span>
<span id="cb9-209"><a href="#cb9-209" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Exporta para todos os formatos&quot;&quot;&quot;</span></span>
<span id="cb9-210"><a href="#cb9-210" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">üîÑ Exportando para formatos...&quot;</span>)</span>
<span id="cb9-211"><a href="#cb9-211" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_markdown_enhanced()</span>
<span id="cb9-212"><a href="#cb9-212" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_html_robust()</span>
<span id="cb9-213"><a href="#cb9-213" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_csv() </span>
<span id="cb9-214"><a href="#cb9-214" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_as_json()</span>
<span id="cb9-215"><a href="#cb9-215" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.save_all_to_single_files()</span>
<span id="cb9-216"><a href="#cb9-216" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.create_searchable_index()</span>
<span id="cb9-217"><a href="#cb9-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-218"><a href="#cb9-218" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _get_pandoc_version(<span class="va">self</span>) <span class="op">-&gt;</span> Optional[<span class="bu">tuple</span>]:</span>
<span id="cb9-219"><a href="#cb9-219" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Obt√©m a vers√£o do Pandoc para compatibilidade&quot;&quot;&quot;</span></span>
<span id="cb9-220"><a href="#cb9-220" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-221"><a href="#cb9-221" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run([<span class="st">&#39;pandoc&#39;</span>, <span class="st">&#39;--version&#39;</span>], capture_output<span class="op">=</span><span class="va">True</span>, text<span class="op">=</span><span class="va">True</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>)</span>
<span id="cb9-222"><a href="#cb9-222" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb9-223"><a href="#cb9-223" aria-hidden="true" tabindex="-1"></a>                first_line <span class="op">=</span> result.stdout.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb9-224"><a href="#cb9-224" aria-hidden="true" tabindex="-1"></a>                version_str <span class="op">=</span> first_line.split()[<span class="dv">1</span>]</span>
<span id="cb9-225"><a href="#cb9-225" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="bu">tuple</span>(<span class="bu">map</span>(<span class="bu">int</span>, version_str.split(<span class="st">&#39;.&#39;</span>)))</span>
<span id="cb9-226"><a href="#cb9-226" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb9-227"><a href="#cb9-227" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb9-228"><a href="#cb9-228" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb9-229"><a href="#cb9-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-230"><a href="#cb9-230" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_optimized(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb9-231"><a href="#cb9-231" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Convers√£o OTIMIZADA com Pandoc usando todas as op√ß√µes avan√ßadas&quot;&quot;&quot;</span></span>
<span id="cb9-232"><a href="#cb9-232" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-233"><a href="#cb9-233" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Convertendo com Pandoc otimizado: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-234"><a href="#cb9-234" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-235"><a href="#cb9-235" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica se o arquivo MathJax local existe</span></span>
<span id="cb9-236"><a href="#cb9-236" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb9-237"><a href="#cb9-237" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb9-238"><a href="#cb9-238" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-239"><a href="#cb9-239" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Comandos base</span></span>
<span id="cb9-240"><a href="#cb9-240" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb9-241"><a href="#cb9-241" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb9-242"><a href="#cb9-242" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb9-243"><a href="#cb9-243" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown+emoji+autolink_bare_uris+tex_math_single_backslash&#39;</span>,</span>
<span id="cb9-244"><a href="#cb9-244" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb9-245"><a href="#cb9-245" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb9-246"><a href="#cb9-246" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span>,</span>
<span id="cb9-247"><a href="#cb9-247" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--table-of-contents&#39;</span>,</span>
<span id="cb9-248"><a href="#cb9-248" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--toc-depth=3&#39;</span>,  <span class="co"># ALTERADO: de 2 para 3</span></span>
<span id="cb9-249"><a href="#cb9-249" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--number-sections&#39;</span></span>
<span id="cb9-250"><a href="#cb9-250" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb9-251"><a href="#cb9-251" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-252"><a href="#cb9-252" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Verifica vers√£o do Pandoc para recursos avan√ßados</span></span>
<span id="cb9-253"><a href="#cb9-253" aria-hidden="true" tabindex="-1"></a>            pandoc_version <span class="op">=</span> <span class="va">self</span>._get_pandoc_version()</span>
<span id="cb9-254"><a href="#cb9-254" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-255"><a href="#cb9-255" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Adiciona --embed-resources apenas se suportado (Pandoc 2.19+)</span></span>
<span id="cb9-256"><a href="#cb9-256" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pandoc_version <span class="kw">and</span> pandoc_version <span class="op">&gt;=</span> (<span class="dv">2</span>, <span class="dv">19</span>):</span>
<span id="cb9-257"><a href="#cb9-257" aria-hidden="true" tabindex="-1"></a>                command.append(<span class="st">&#39;--embed-resources&#39;</span>)</span>
<span id="cb9-258"><a href="#cb9-258" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="st">&quot;‚úÖ Usando --embed-resources (Pandoc 2.19+)&quot;</span>)</span>
<span id="cb9-259"><a href="#cb9-259" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb9-260"><a href="#cb9-260" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="st">&quot;‚ÑπÔ∏è  --embed-resources n√£o suportado, usando recursos externos&quot;</span>)</span>
<span id="cb9-261"><a href="#cb9-261" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-262"><a href="#cb9-262" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Adiciona syntax highlighting</span></span>
<span id="cb9-263"><a href="#cb9-263" aria-hidden="true" tabindex="-1"></a>            command.extend([<span class="st">&#39;--syntax-highlighting=pygments&#39;</span>])</span>
<span id="cb9-264"><a href="#cb9-264" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-265"><a href="#cb9-265" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb9-266"><a href="#cb9-266" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb9-267"><a href="#cb9-267" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb9-268"><a href="#cb9-268" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb9-269"><a href="#cb9-269" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb9-270"><a href="#cb9-270" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">180</span></span>
<span id="cb9-271"><a href="#cb9-271" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb9-272"><a href="#cb9-272" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-273"><a href="#cb9-273" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb9-274"><a href="#cb9-274" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> result.stdout</span>
<span id="cb9-275"><a href="#cb9-275" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-276"><a href="#cb9-276" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Aplica otimiza√ß√µes adicionais</span></span>
<span id="cb9-277"><a href="#cb9-277" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="va">self</span>._optimize_html_content(html_content)</span>
<span id="cb9-278"><a href="#cb9-278" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> html_content</span>
<span id="cb9-279"><a href="#cb9-279" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb9-280"><a href="#cb9-280" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc otimizado falhou, tentando m√©todo b√°sico: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-281"><a href="#cb9-281" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb9-282"><a href="#cb9-282" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-283"><a href="#cb9-283" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> subprocess.TimeoutExpired:</span>
<span id="cb9-284"><a href="#cb9-284" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Timeout no Pandoc otimizado&quot;</span>)</span>
<span id="cb9-285"><a href="#cb9-285" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb9-286"><a href="#cb9-286" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb9-287"><a href="#cb9-287" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc otimizado: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-288"><a href="#cb9-288" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_pandoc_basic(md_file_path)</span>
<span id="cb9-289"><a href="#cb9-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-290"><a href="#cb9-290" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_pandoc_basic(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb9-291"><a href="#cb9-291" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;M√©todo b√°sico de fallback para Pandoc com TOC e numera√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb9-292"><a href="#cb9-292" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-293"><a href="#cb9-293" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîß Tentando convers√£o b√°sica: </span><span class="sc">{</span>Path(md_file_path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-294"><a href="#cb9-294" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-295"><a href="#cb9-295" aria-hidden="true" tabindex="-1"></a>            mathjax_path <span class="op">=</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>)</span>
<span id="cb9-296"><a href="#cb9-296" aria-hidden="true" tabindex="-1"></a>            mathjax_arg <span class="op">=</span> <span class="ss">f&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> mathjax_path.exists() <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb9-297"><a href="#cb9-297" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-298"><a href="#cb9-298" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [</span>
<span id="cb9-299"><a href="#cb9-299" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;pandoc&#39;</span>, </span>
<span id="cb9-300"><a href="#cb9-300" aria-hidden="true" tabindex="-1"></a>                <span class="bu">str</span>(md_file_path),</span>
<span id="cb9-301"><a href="#cb9-301" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--from&#39;</span>, <span class="st">&#39;markdown&#39;</span>,</span>
<span id="cb9-302"><a href="#cb9-302" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--to&#39;</span>, <span class="st">&#39;html5&#39;</span>,</span>
<span id="cb9-303"><a href="#cb9-303" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--standalone&#39;</span>,</span>
<span id="cb9-304"><a href="#cb9-304" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--table-of-contents&#39;</span>,</span>
<span id="cb9-305"><a href="#cb9-305" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--toc-depth=3&#39;</span>,  <span class="co"># ALTERADO: de 2 para 3</span></span>
<span id="cb9-306"><a href="#cb9-306" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--number-sections&#39;</span>,</span>
<span id="cb9-307"><a href="#cb9-307" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;--mathjax&#39;</span> <span class="cf">if</span> <span class="kw">not</span> mathjax_path.exists() <span class="cf">else</span> <span class="ss">f&#39;--mathjax=</span><span class="sc">{</span>mathjax_arg<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb9-308"><a href="#cb9-308" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb9-309"><a href="#cb9-309" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-310"><a href="#cb9-310" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> subprocess.run(</span>
<span id="cb9-311"><a href="#cb9-311" aria-hidden="true" tabindex="-1"></a>                command, </span>
<span id="cb9-312"><a href="#cb9-312" aria-hidden="true" tabindex="-1"></a>                capture_output<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb9-313"><a href="#cb9-313" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb9-314"><a href="#cb9-314" aria-hidden="true" tabindex="-1"></a>                encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, </span>
<span id="cb9-315"><a href="#cb9-315" aria-hidden="true" tabindex="-1"></a>                timeout<span class="op">=</span><span class="dv">120</span></span>
<span id="cb9-316"><a href="#cb9-316" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb9-317"><a href="#cb9-317" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-318"><a href="#cb9-318" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result.returncode <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb9-319"><a href="#cb9-319" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._optimize_html_content(result.stdout)</span>
<span id="cb9-320"><a href="#cb9-320" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb9-321"><a href="#cb9-321" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="ss">f&quot;‚ö†Ô∏è Pandoc b√°sico falhou, usando fallback Python: </span><span class="sc">{</span>result<span class="sc">.</span>stderr[:<span class="dv">200</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-322"><a href="#cb9-322" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb9-323"><a href="#cb9-323" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-324"><a href="#cb9-324" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb9-325"><a href="#cb9-325" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro no Pandoc b√°sico: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-326"><a href="#cb9-326" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._convert_with_fallback(md_file_path)</span>
<span id="cb9-327"><a href="#cb9-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-328"><a href="#cb9-328" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _optimize_html_content(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb9-329"><a href="#cb9-329" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Aplica otimiza√ß√µes finais ao conte√∫do HTML&quot;&quot;&quot;</span></span>
<span id="cb9-330"><a href="#cb9-330" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona viewport para responsividade</span></span>
<span id="cb9-331"><a href="#cb9-331" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;viewport&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb9-332"><a href="#cb9-332" aria-hidden="true" tabindex="-1"></a>            viewport_meta <span class="op">=</span> <span class="st">&#39;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#39;</span></span>
<span id="cb9-333"><a href="#cb9-333" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="ss">    </span><span class="sc">{</span>viewport_meta<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb9-334"><a href="#cb9-334" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-335"><a href="#cb9-335" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Melhora acessibilidade</span></span>
<span id="cb9-336"><a href="#cb9-336" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;html&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;lang&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb9-337"><a href="#cb9-337" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;html&gt;&#39;</span>, <span class="st">&#39;&lt;html lang=&quot;pt-BR&quot;&gt;&#39;</span>)</span>
<span id="cb9-338"><a href="#cb9-338" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-339"><a href="#cb9-339" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona CSS personalizado para melhorar TOC e numera√ß√£o</span></span>
<span id="cb9-340"><a href="#cb9-340" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="va">self</span>._inject_enhanced_css(html_content)</span>
<span id="cb9-341"><a href="#cb9-341" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-342"><a href="#cb9-342" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Otimiza TOC gerado pelo Pandoc</span></span>
<span id="cb9-343"><a href="#cb9-343" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="va">self</span>._enhance_toc_styling(html_content)</span>
<span id="cb9-344"><a href="#cb9-344" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-345"><a href="#cb9-345" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb9-346"><a href="#cb9-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-347"><a href="#cb9-347" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _inject_enhanced_css(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb9-348"><a href="#cb9-348" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Injeta CSS personalizado aprimorado para TOC flutuante e layout de tela completa&quot;&quot;&quot;</span></span>
<span id="cb9-349"><a href="#cb9-349" aria-hidden="true" tabindex="-1"></a>        enhanced_css <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb9-350"><a href="#cb9-350" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;style&gt;</span></span>
<span id="cb9-351"><a href="#cb9-351" aria-hidden="true" tabindex="-1"></a><span class="st">            /* LAYOUT DE TELA COMPLETA OTIMIZADO */</span></span>
<span id="cb9-352"><a href="#cb9-352" aria-hidden="true" tabindex="-1"></a><span class="st">            body {</span></span>
<span id="cb9-353"><a href="#cb9-353" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb9-354"><a href="#cb9-354" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.6;</span></span>
<span id="cb9-355"><a href="#cb9-355" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0;</span></span>
<span id="cb9-356"><a href="#cb9-356" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb9-357"><a href="#cb9-357" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #f5f5f5;</span></span>
<span id="cb9-358"><a href="#cb9-358" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #333;</span></span>
<span id="cb9-359"><a href="#cb9-359" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: none; /* Remove limita√ß√£o de largura - TELA COMPLETA */</span></span>
<span id="cb9-360"><a href="#cb9-360" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-361"><a href="#cb9-361" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-362"><a href="#cb9-362" aria-hidden="true" tabindex="-1"></a><span class="st">            .container {</span></span>
<span id="cb9-363"><a href="#cb9-363" aria-hidden="true" tabindex="-1"></a><span class="st">                max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb9-364"><a href="#cb9-364" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 0 auto;</span></span>
<span id="cb9-365"><a href="#cb9-365" aria-hidden="true" tabindex="-1"></a><span class="st">                background: white;</span></span>
<span id="cb9-366"><a href="#cb9-366" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 40px;</span></span>
<span id="cb9-367"><a href="#cb9-367" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 10px;</span></span>
<span id="cb9-368"><a href="#cb9-368" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb9-369"><a href="#cb9-369" aria-hidden="true" tabindex="-1"></a><span class="st">                position: relative; /* Para posicionamento do TOC */</span></span>
<span id="cb9-370"><a href="#cb9-370" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-371"><a href="#cb9-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-372"><a href="#cb9-372" aria-hidden="true" tabindex="-1"></a><span class="st">            /* TOC FLUTUANTE OTIMIZADO */</span></span>
<span id="cb9-373"><a href="#cb9-373" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC {</span></span>
<span id="cb9-374"><a href="#cb9-374" aria-hidden="true" tabindex="-1"></a><span class="st">                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);</span></span>
<span id="cb9-375"><a href="#cb9-375" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #dee2e6;</span></span>
<span id="cb9-376"><a href="#cb9-376" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb9-377"><a href="#cb9-377" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb9-378"><a href="#cb9-378" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 20px 0;</span></span>
<span id="cb9-379"><a href="#cb9-379" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb9-380"><a href="#cb9-380" aria-hidden="true" tabindex="-1"></a><span class="st">                float: right; /* FLUTUA √Ä DIREITA */</span></span>
<span id="cb9-381"><a href="#cb9-381" aria-hidden="true" tabindex="-1"></a><span class="st">                width: 320px; /* Largura fixa para TOC */</span></span>
<span id="cb9-382"><a href="#cb9-382" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-left: 30px;</span></span>
<span id="cb9-383"><a href="#cb9-383" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-bottom: 30px;</span></span>
<span id="cb9-384"><a href="#cb9-384" aria-hidden="true" tabindex="-1"></a><span class="st">                position: relative;</span></span>
<span id="cb9-385"><a href="#cb9-385" aria-hidden="true" tabindex="-1"></a><span class="st">                z-index: 100;</span></span>
<span id="cb9-386"><a href="#cb9-386" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-387"><a href="#cb9-387" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-388"><a href="#cb9-388" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul {</span></span>
<span id="cb9-389"><a href="#cb9-389" aria-hidden="true" tabindex="-1"></a><span class="st">                list-style-type: none;</span></span>
<span id="cb9-390"><a href="#cb9-390" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 15px;</span></span>
<span id="cb9-391"><a href="#cb9-391" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 10px 0;</span></span>
<span id="cb9-392"><a href="#cb9-392" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-393"><a href="#cb9-393" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-394"><a href="#cb9-394" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul ul {</span></span>
<span id="cb9-395"><a href="#cb9-395" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 25px;</span></span>
<span id="cb9-396"><a href="#cb9-396" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-397"><a href="#cb9-397" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-398"><a href="#cb9-398" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC ul ul ul {</span></span>
<span id="cb9-399"><a href="#cb9-399" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 35px; /* Mais indenta√ß√£o para n√≠vel 3 */</span></span>
<span id="cb9-400"><a href="#cb9-400" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-401"><a href="#cb9-401" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-402"><a href="#cb9-402" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC li {</span></span>
<span id="cb9-403"><a href="#cb9-403" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 8px 0;</span></span>
<span id="cb9-404"><a href="#cb9-404" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.4;</span></span>
<span id="cb9-405"><a href="#cb9-405" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-406"><a href="#cb9-406" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-407"><a href="#cb9-407" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a {</span></span>
<span id="cb9-408"><a href="#cb9-408" aria-hidden="true" tabindex="-1"></a><span class="st">                text-decoration: none;</span></span>
<span id="cb9-409"><a href="#cb9-409" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #495057;</span></span>
<span id="cb9-410"><a href="#cb9-410" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 500;</span></span>
<span id="cb9-411"><a href="#cb9-411" aria-hidden="true" tabindex="-1"></a><span class="st">                transition: color 0.2s ease;</span></span>
<span id="cb9-412"><a href="#cb9-412" aria-hidden="true" tabindex="-1"></a><span class="st">                display: block;</span></span>
<span id="cb9-413"><a href="#cb9-413" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 4px 8px;</span></span>
<span id="cb9-414"><a href="#cb9-414" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 4px;</span></span>
<span id="cb9-415"><a href="#cb9-415" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-416"><a href="#cb9-416" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-417"><a href="#cb9-417" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a:hover {</span></span>
<span id="cb9-418"><a href="#cb9-418" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #007bff;</span></span>
<span id="cb9-419"><a href="#cb9-419" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: rgba(0, 123, 255, 0.1);</span></span>
<span id="cb9-420"><a href="#cb9-420" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-421"><a href="#cb9-421" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-422"><a href="#cb9-422" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC &gt; ul &gt; li &gt; a {</span></span>
<span id="cb9-423"><a href="#cb9-423" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: 600;</span></span>
<span id="cb9-424"><a href="#cb9-424" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50;</span></span>
<span id="cb9-425"><a href="#cb9-425" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 3px solid #3498db;</span></span>
<span id="cb9-426"><a href="#cb9-426" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 12px;</span></span>
<span id="cb9-427"><a href="#cb9-427" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-428"><a href="#cb9-428" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-429"><a href="#cb9-429" aria-hidden="true" tabindex="-1"></a><span class="st">            /* CLEARFIX PARA LAYOUT COM TOC FLUTUANTE */</span></span>
<span id="cb9-430"><a href="#cb9-430" aria-hidden="true" tabindex="-1"></a><span class="st">            .main-content {</span></span>
<span id="cb9-431"><a href="#cb9-431" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow: hidden; /* PREVINE PROBLEMAS COM ELEMENTOS FLUTUANTES */</span></span>
<span id="cb9-432"><a href="#cb9-432" aria-hidden="true" tabindex="-1"></a><span class="st">                position: relative;</span></span>
<span id="cb9-433"><a href="#cb9-433" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-434"><a href="#cb9-434" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-435"><a href="#cb9-435" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Estilos para numera√ß√£o de se√ß√µes */</span></span>
<span id="cb9-436"><a href="#cb9-436" aria-hidden="true" tabindex="-1"></a><span class="st">            .header-section-number {</span></span>
<span id="cb9-437"><a href="#cb9-437" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #3498db;</span></span>
<span id="cb9-438"><a href="#cb9-438" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: bold;</span></span>
<span id="cb9-439"><a href="#cb9-439" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-right: 8px;</span></span>
<span id="cb9-440"><a href="#cb9-440" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-441"><a href="#cb9-441" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-442"><a href="#cb9-442" aria-hidden="true" tabindex="-1"></a><span class="st">            h1 .header-section-number {</span></span>
<span id="cb9-443"><a href="#cb9-443" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.9em;</span></span>
<span id="cb9-444"><a href="#cb9-444" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-445"><a href="#cb9-445" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-446"><a href="#cb9-446" aria-hidden="true" tabindex="-1"></a><span class="st">            h2 .header-section-number {</span></span>
<span id="cb9-447"><a href="#cb9-447" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.85em;</span></span>
<span id="cb9-448"><a href="#cb9-448" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-449"><a href="#cb9-449" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-450"><a href="#cb9-450" aria-hidden="true" tabindex="-1"></a><span class="st">            h3 .header-section-number {</span></span>
<span id="cb9-451"><a href="#cb9-451" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.8em;</span></span>
<span id="cb9-452"><a href="#cb9-452" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-453"><a href="#cb9-453" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-454"><a href="#cb9-454" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para c√≥digo e matem√°tica */</span></span>
<span id="cb9-455"><a href="#cb9-455" aria-hidden="true" tabindex="-1"></a><span class="st">            .math { display: block; text-align: center; margin: 1.5em 0; }</span></span>
<span id="cb9-456"><a href="#cb9-456" aria-hidden="true" tabindex="-1"></a><span class="st">            .math inline { display: inline-block; }</span></span>
<span id="cb9-457"><a href="#cb9-457" aria-hidden="true" tabindex="-1"></a><span class="st">            pre { </span></span>
<span id="cb9-458"><a href="#cb9-458" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb9-459"><a href="#cb9-459" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #2d2d2d; </span></span>
<span id="cb9-460"><a href="#cb9-460" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #f8f8f2;</span></span>
<span id="cb9-461"><a href="#cb9-461" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb9-462"><a href="#cb9-462" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb9-463"><a href="#cb9-463" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow-x: auto;</span></span>
<span id="cb9-464"><a href="#cb9-464" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb9-465"><a href="#cb9-465" aria-hidden="true" tabindex="-1"></a><span class="st">                line-height: 1.4;</span></span>
<span id="cb9-466"><a href="#cb9-466" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-467"><a href="#cb9-467" aria-hidden="true" tabindex="-1"></a><span class="st">            code { </span></span>
<span id="cb9-468"><a href="#cb9-468" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #e9ecef; </span></span>
<span id="cb9-469"><a href="#cb9-469" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 0.2em 0.4em; </span></span>
<span id="cb9-470"><a href="#cb9-470" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 3px;</span></span>
<span id="cb9-471"><a href="#cb9-471" aria-hidden="true" tabindex="-1"></a><span class="st">                font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb9-472"><a href="#cb9-472" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #c7254e;</span></span>
<span id="cb9-473"><a href="#cb9-473" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-474"><a href="#cb9-474" aria-hidden="true" tabindex="-1"></a><span class="st">            pre code { </span></span>
<span id="cb9-475"><a href="#cb9-475" aria-hidden="true" tabindex="-1"></a><span class="st">                background: none; </span></span>
<span id="cb9-476"><a href="#cb9-476" aria-hidden="true" tabindex="-1"></a><span class="st">                color: inherit; </span></span>
<span id="cb9-477"><a href="#cb9-477" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 0; </span></span>
<span id="cb9-478"><a href="#cb9-478" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-479"><a href="#cb9-479" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-480"><a href="#cb9-480" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias responsivas */</span></span>
<span id="cb9-481"><a href="#cb9-481" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 1400px) {</span></span>
<span id="cb9-482"><a href="#cb9-482" aria-hidden="true" tabindex="-1"></a><span class="st">                .container {</span></span>
<span id="cb9-483"><a href="#cb9-483" aria-hidden="true" tabindex="-1"></a><span class="st">                    max-width: 98%;</span></span>
<span id="cb9-484"><a href="#cb9-484" aria-hidden="true" tabindex="-1"></a><span class="st">                    padding: 30px;</span></span>
<span id="cb9-485"><a href="#cb9-485" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb9-486"><a href="#cb9-486" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC {</span></span>
<span id="cb9-487"><a href="#cb9-487" aria-hidden="true" tabindex="-1"></a><span class="st">                    width: 280px; /* Reduz um pouco em telas menores */</span></span>
<span id="cb9-488"><a href="#cb9-488" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb9-489"><a href="#cb9-489" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-490"><a href="#cb9-490" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-491"><a href="#cb9-491" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 1200px) {</span></span>
<span id="cb9-492"><a href="#cb9-492" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC {</span></span>
<span id="cb9-493"><a href="#cb9-493" aria-hidden="true" tabindex="-1"></a><span class="st">                    float: none;</span></span>
<span id="cb9-494"><a href="#cb9-494" aria-hidden="true" tabindex="-1"></a><span class="st">                    width: auto;</span></span>
<span id="cb9-495"><a href="#cb9-495" aria-hidden="true" tabindex="-1"></a><span class="st">                    margin: 20px 0;</span></span>
<span id="cb9-496"><a href="#cb9-496" aria-hidden="true" tabindex="-1"></a><span class="st">                    position: static;</span></span>
<span id="cb9-497"><a href="#cb9-497" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb9-498"><a href="#cb9-498" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-499"><a href="#cb9-499" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-500"><a href="#cb9-500" aria-hidden="true" tabindex="-1"></a><span class="st">            @media (max-width: 768px) {</span></span>
<span id="cb9-501"><a href="#cb9-501" aria-hidden="true" tabindex="-1"></a><span class="st">                body { padding: 10px; font-size: 14px; }</span></span>
<span id="cb9-502"><a href="#cb9-502" aria-hidden="true" tabindex="-1"></a><span class="st">                .container { padding: 20px; max-width: 100%; }</span></span>
<span id="cb9-503"><a href="#cb9-503" aria-hidden="true" tabindex="-1"></a><span class="st">                pre { font-size: 12px; padding: 15px; }</span></span>
<span id="cb9-504"><a href="#cb9-504" aria-hidden="true" tabindex="-1"></a><span class="st">                #TOC { padding: 15px; }</span></span>
<span id="cb9-505"><a href="#cb9-505" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-506"><a href="#cb9-506" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-507"><a href="#cb9-507" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para tabelas */</span></span>
<span id="cb9-508"><a href="#cb9-508" aria-hidden="true" tabindex="-1"></a><span class="st">            table { </span></span>
<span id="cb9-509"><a href="#cb9-509" aria-hidden="true" tabindex="-1"></a><span class="st">                width: 100%; </span></span>
<span id="cb9-510"><a href="#cb9-510" aria-hidden="true" tabindex="-1"></a><span class="st">                border-collapse: collapse; </span></span>
<span id="cb9-511"><a href="#cb9-511" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 1.5em 0;</span></span>
<span id="cb9-512"><a href="#cb9-512" aria-hidden="true" tabindex="-1"></a><span class="st">                box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb9-513"><a href="#cb9-513" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 8px;</span></span>
<span id="cb9-514"><a href="#cb9-514" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow: hidden;</span></span>
<span id="cb9-515"><a href="#cb9-515" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-516"><a href="#cb9-516" aria-hidden="true" tabindex="-1"></a><span class="st">            th, td { </span></span>
<span id="cb9-517"><a href="#cb9-517" aria-hidden="true" tabindex="-1"></a><span class="st">                border: 1px solid #dee2e6; </span></span>
<span id="cb9-518"><a href="#cb9-518" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 12px 15px; </span></span>
<span id="cb9-519"><a href="#cb9-519" aria-hidden="true" tabindex="-1"></a><span class="st">                text-align: left; </span></span>
<span id="cb9-520"><a href="#cb9-520" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-521"><a href="#cb9-521" aria-hidden="true" tabindex="-1"></a><span class="st">            th { </span></span>
<span id="cb9-522"><a href="#cb9-522" aria-hidden="true" tabindex="-1"></a><span class="st">                background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb9-523"><a href="#cb9-523" aria-hidden="true" tabindex="-1"></a><span class="st">                color: white; </span></span>
<span id="cb9-524"><a href="#cb9-524" aria-hidden="true" tabindex="-1"></a><span class="st">                font-weight: bold;</span></span>
<span id="cb9-525"><a href="#cb9-525" aria-hidden="true" tabindex="-1"></a><span class="st">                text-transform: uppercase;</span></span>
<span id="cb9-526"><a href="#cb9-526" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 0.9em;</span></span>
<span id="cb9-527"><a href="#cb9-527" aria-hidden="true" tabindex="-1"></a><span class="st">                letter-spacing: 0.5px;</span></span>
<span id="cb9-528"><a href="#cb9-528" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-529"><a href="#cb9-529" aria-hidden="true" tabindex="-1"></a><span class="st">            tr:nth-child(even) { </span></span>
<span id="cb9-530"><a href="#cb9-530" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #f8f9fa; </span></span>
<span id="cb9-531"><a href="#cb9-531" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-532"><a href="#cb9-532" aria-hidden="true" tabindex="-1"></a><span class="st">            tr:hover { </span></span>
<span id="cb9-533"><a href="#cb9-533" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #e3f2fd; </span></span>
<span id="cb9-534"><a href="#cb9-534" aria-hidden="true" tabindex="-1"></a><span class="st">                transition: background-color 0.2s ease;</span></span>
<span id="cb9-535"><a href="#cb9-535" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-536"><a href="#cb9-536" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-537"><a href="#cb9-537" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Melhorias para blocos de cita√ß√£o */</span></span>
<span id="cb9-538"><a href="#cb9-538" aria-hidden="true" tabindex="-1"></a><span class="st">            blockquote { </span></span>
<span id="cb9-539"><a href="#cb9-539" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db; </span></span>
<span id="cb9-540"><a href="#cb9-540" aria-hidden="true" tabindex="-1"></a><span class="st">                margin: 25px 0; </span></span>
<span id="cb9-541"><a href="#cb9-541" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 25px; </span></span>
<span id="cb9-542"><a href="#cb9-542" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #7f8c8d;</span></span>
<span id="cb9-543"><a href="#cb9-543" aria-hidden="true" tabindex="-1"></a><span class="st">                font-style: italic;</span></span>
<span id="cb9-544"><a href="#cb9-544" aria-hidden="true" tabindex="-1"></a><span class="st">                background: #f8f9fa;</span></span>
<span id="cb9-545"><a href="#cb9-545" aria-hidden="true" tabindex="-1"></a><span class="st">                padding: 20px;</span></span>
<span id="cb9-546"><a href="#cb9-546" aria-hidden="true" tabindex="-1"></a><span class="st">                border-radius: 0 8px 8px 0;</span></span>
<span id="cb9-547"><a href="#cb9-547" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-548"><a href="#cb9-548" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-549"><a href="#cb9-549" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Cabe√ßalhos com numera√ß√£o */</span></span>
<span id="cb9-550"><a href="#cb9-550" aria-hidden="true" tabindex="-1"></a><span class="st">            h1, h2, h3, h4, h5 { </span></span>
<span id="cb9-551"><a href="#cb9-551" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50; </span></span>
<span id="cb9-552"><a href="#cb9-552" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-top: 1.8em;</span></span>
<span id="cb9-553"><a href="#cb9-553" aria-hidden="true" tabindex="-1"></a><span class="st">                border-bottom: 1px solid #e9ecef;</span></span>
<span id="cb9-554"><a href="#cb9-554" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-bottom: 0.5em;</span></span>
<span id="cb9-555"><a href="#cb9-555" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-556"><a href="#cb9-556" aria-hidden="true" tabindex="-1"></a><span class="st">            h1 { </span></span>
<span id="cb9-557"><a href="#cb9-557" aria-hidden="true" tabindex="-1"></a><span class="st">                border-bottom: 3px solid #3498db; </span></span>
<span id="cb9-558"><a href="#cb9-558" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-bottom: 15px; </span></span>
<span id="cb9-559"><a href="#cb9-559" aria-hidden="true" tabindex="-1"></a><span class="st">                color: #2c3e50;</span></span>
<span id="cb9-560"><a href="#cb9-560" aria-hidden="true" tabindex="-1"></a><span class="st">                font-size: 2.2em;</span></span>
<span id="cb9-561"><a href="#cb9-561" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-562"><a href="#cb9-562" aria-hidden="true" tabindex="-1"></a><span class="st">            h2 {</span></span>
<span id="cb9-563"><a href="#cb9-563" aria-hidden="true" tabindex="-1"></a><span class="st">                border-left: 4px solid #3498db;</span></span>
<span id="cb9-564"><a href="#cb9-564" aria-hidden="true" tabindex="-1"></a><span class="st">                padding-left: 15px;</span></span>
<span id="cb9-565"><a href="#cb9-565" aria-hidden="true" tabindex="-1"></a><span class="st">                margin-top: 2em;</span></span>
<span id="cb9-566"><a href="#cb9-566" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-567"><a href="#cb9-567" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-568"><a href="#cb9-568" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Scroll suave para links do TOC */</span></span>
<span id="cb9-569"><a href="#cb9-569" aria-hidden="true" tabindex="-1"></a><span class="st">            html {</span></span>
<span id="cb9-570"><a href="#cb9-570" aria-hidden="true" tabindex="-1"></a><span class="st">                scroll-behavior: smooth;</span></span>
<span id="cb9-571"><a href="#cb9-571" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-572"><a href="#cb9-572" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-573"><a href="#cb9-573" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Estilo para quando o TOC √© muito grande */</span></span>
<span id="cb9-574"><a href="#cb9-574" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC:has(ul ul ul ul) {</span></span>
<span id="cb9-575"><a href="#cb9-575" aria-hidden="true" tabindex="-1"></a><span class="st">                max-height: 80vh;</span></span>
<span id="cb9-576"><a href="#cb9-576" aria-hidden="true" tabindex="-1"></a><span class="st">                overflow-y: auto;</span></span>
<span id="cb9-577"><a href="#cb9-577" aria-hidden="true" tabindex="-1"></a><span class="st">                position: sticky;</span></span>
<span id="cb9-578"><a href="#cb9-578" aria-hidden="true" tabindex="-1"></a><span class="st">                top: 20px;</span></span>
<span id="cb9-579"><a href="#cb9-579" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-580"><a href="#cb9-580" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-581"><a href="#cb9-581" aria-hidden="true" tabindex="-1"></a><span class="st">            /* Indicador visual para se√ß√£o ativa no TOC */</span></span>
<span id="cb9-582"><a href="#cb9-582" aria-hidden="true" tabindex="-1"></a><span class="st">            #TOC a.active {</span></span>
<span id="cb9-583"><a href="#cb9-583" aria-hidden="true" tabindex="-1"></a><span class="st">                background-color: #007bff;</span></span>
<span id="cb9-584"><a href="#cb9-584" aria-hidden="true" tabindex="-1"></a><span class="st">                color: white;</span></span>
<span id="cb9-585"><a href="#cb9-585" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-586"><a href="#cb9-586" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/style&gt;</span></span>
<span id="cb9-587"><a href="#cb9-587" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;&quot;&quot;</span></span>
<span id="cb9-588"><a href="#cb9-588" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-589"><a href="#cb9-589" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;/head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb9-590"><a href="#cb9-590" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;/head&gt;&#39;</span>, <span class="ss">f&#39;</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;&#39;</span>)</span>
<span id="cb9-591"><a href="#cb9-591" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">&#39;&lt;head&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb9-592"><a href="#cb9-592" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;head&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb9-593"><a href="#cb9-593" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb9-594"><a href="#cb9-594" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;&lt;body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb9-595"><a href="#cb9-595" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> html_content.replace(<span class="st">&#39;&lt;body&gt;&#39;</span>, <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;&#39;</span>)</span>
<span id="cb9-596"><a href="#cb9-596" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb9-597"><a href="#cb9-597" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> <span class="ss">f&#39;&lt;head&gt;</span><span class="ch">\n</span><span class="sc">{</span>enhanced_css<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/head&gt;</span><span class="ch">\n</span><span class="ss">&lt;body&gt;</span><span class="ch">\n</span><span class="sc">{</span>html_content<span class="sc">}</span><span class="ch">\n</span><span class="ss">&lt;/body&gt;&#39;</span></span>
<span id="cb9-598"><a href="#cb9-598" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-599"><a href="#cb9-599" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb9-600"><a href="#cb9-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-601"><a href="#cb9-601" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _enhance_toc_styling(<span class="va">self</span>, html_content: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb9-602"><a href="#cb9-602" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Melhora o estilo do Table of Contents gerado pelo Pandoc&quot;&quot;&quot;</span></span>
<span id="cb9-603"><a href="#cb9-603" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona t√≠tulo ao TOC se n√£o existir</span></span>
<span id="cb9-604"><a href="#cb9-604" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;Table of Contents&#39;</span> <span class="kw">not</span> <span class="kw">in</span> html_content:</span>
<span id="cb9-605"><a href="#cb9-605" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> html_content.replace(</span>
<span id="cb9-606"><a href="#cb9-606" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span>, </span>
<span id="cb9-607"><a href="#cb9-607" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&lt;h2 style=&quot;margin-top: 0; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;&quot;&gt;üìë Table of Contents&lt;/h2&gt;&#39;</span></span>
<span id="cb9-608"><a href="#cb9-608" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb9-609"><a href="#cb9-609" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-610"><a href="#cb9-610" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adiciona wrapper para conte√∫do principal com clearfix</span></span>
<span id="cb9-611"><a href="#cb9-611" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span> <span class="kw">in</span> html_content <span class="kw">and</span> <span class="st">&#39;&lt;body&gt;&#39;</span> <span class="kw">in</span> html_content:</span>
<span id="cb9-612"><a href="#cb9-612" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Encontra o TOC e envolve o conte√∫do restante</span></span>
<span id="cb9-613"><a href="#cb9-613" aria-hidden="true" tabindex="-1"></a>            toc_end <span class="op">=</span> html_content.find(<span class="st">&#39;&lt;/div&gt;&#39;</span>, html_content.find(<span class="st">&#39;&lt;div id=&quot;TOC&quot;&gt;&#39;</span>)) <span class="op">+</span> <span class="dv">6</span></span>
<span id="cb9-614"><a href="#cb9-614" aria-hidden="true" tabindex="-1"></a>            body_content <span class="op">=</span> html_content[toc_end:]</span>
<span id="cb9-615"><a href="#cb9-615" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;&lt;div class=&quot;main-content&quot;&gt;&#39;</span> <span class="kw">not</span> <span class="kw">in</span> body_content:</span>
<span id="cb9-616"><a href="#cb9-616" aria-hidden="true" tabindex="-1"></a>                html_content <span class="op">=</span> html_content[:toc_end] <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&lt;div class=&quot;main-content&quot;&gt;&#39;</span> <span class="op">+</span> body_content <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&lt;/div&gt;&#39;</span></span>
<span id="cb9-617"><a href="#cb9-617" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-618"><a href="#cb9-618" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> html_content</span>
<span id="cb9-619"><a href="#cb9-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-620"><a href="#cb9-620" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _convert_with_fallback(<span class="va">self</span>, md_file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb9-621"><a href="#cb9-621" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Fallback para convers√£o quando Pandoc falha&quot;&quot;&quot;</span></span>
<span id="cb9-622"><a href="#cb9-622" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-623"><a href="#cb9-623" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(md_file_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb9-624"><a href="#cb9-624" aria-hidden="true" tabindex="-1"></a>                md_content <span class="op">=</span> f.read()</span>
<span id="cb9-625"><a href="#cb9-625" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-626"><a href="#cb9-626" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extens√µes avan√ßadas para melhor convers√£o</span></span>
<span id="cb9-627"><a href="#cb9-627" aria-hidden="true" tabindex="-1"></a>            extensions <span class="op">=</span> [</span>
<span id="cb9-628"><a href="#cb9-628" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;extra&#39;</span>, <span class="st">&#39;tables&#39;</span>, <span class="st">&#39;fenced_code&#39;</span>, <span class="st">&#39;codehilite&#39;</span>, </span>
<span id="cb9-629"><a href="#cb9-629" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;toc&#39;</span>, <span class="st">&#39;md_in_html&#39;</span>, <span class="st">&#39;attr_list&#39;</span></span>
<span id="cb9-630"><a href="#cb9-630" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb9-631"><a href="#cb9-631" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-632"><a href="#cb9-632" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">=</span> markdown.markdown(</span>
<span id="cb9-633"><a href="#cb9-633" aria-hidden="true" tabindex="-1"></a>                md_content,</span>
<span id="cb9-634"><a href="#cb9-634" aria-hidden="true" tabindex="-1"></a>                extensions<span class="op">=</span>extensions,</span>
<span id="cb9-635"><a href="#cb9-635" aria-hidden="true" tabindex="-1"></a>                output_format<span class="op">=</span><span class="st">&#39;html5&#39;</span></span>
<span id="cb9-636"><a href="#cb9-636" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb9-637"><a href="#cb9-637" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-638"><a href="#cb9-638" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_enhanced_html_template(html_content, Path(md_file_path).name)</span>
<span id="cb9-639"><a href="#cb9-639" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-640"><a href="#cb9-640" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb9-641"><a href="#cb9-641" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Fallback tamb√©m falhou: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-642"><a href="#cb9-642" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._create_basic_html(md_content, Path(md_file_path).name)</span>
<span id="cb9-643"><a href="#cb9-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-644"><a href="#cb9-644" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_enhanced_html_template(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb9-645"><a href="#cb9-645" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Template HTML aprimorado com suporte a MathJax local/online e TOC flutuante&quot;&quot;&quot;</span></span>
<span id="cb9-646"><a href="#cb9-646" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb9-647"><a href="#cb9-647" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-648"><a href="#cb9-648" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb9-649"><a href="#cb9-649" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html lang=&quot;pt-BR&quot;&gt;</span></span>
<span id="cb9-650"><a href="#cb9-650" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb9-651"><a href="#cb9-651" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb9-652"><a href="#cb9-652" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb9-653"><a href="#cb9-653" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb9-654"><a href="#cb9-654" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb9-655"><a href="#cb9-655" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* LAYOUT DE TELA COMPLETA OTIMIZADO */</span></span>
<span id="cb9-656"><a href="#cb9-656" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span></span>
<span id="cb9-657"><a href="#cb9-657" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif;</span></span>
<span id="cb9-658"><a href="#cb9-658" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb9-659"><a href="#cb9-659" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0;</span></span>
<span id="cb9-660"><a href="#cb9-660" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb9-661"><a href="#cb9-661" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb9-662"><a href="#cb9-662" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333;</span></span>
<span id="cb9-663"><a href="#cb9-663" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: none; /* Remove limita√ß√£o de largura - TELA COMPLETA */</span></span>
<span id="cb9-664"><a href="#cb9-664" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-665"><a href="#cb9-665" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb9-666"><a href="#cb9-666" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb9-667"><a href="#cb9-667" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb9-668"><a href="#cb9-668" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb9-669"><a href="#cb9-669" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 40px;</span></span>
<span id="cb9-670"><a href="#cb9-670" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 10px;</span></span>
<span id="cb9-671"><a href="#cb9-671" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 20px rgba(0,0,0,0.1);</span></span>
<span id="cb9-672"><a href="#cb9-672" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: relative; /* Para posicionamento do TOC */</span></span>
<span id="cb9-673"><a href="#cb9-673" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-674"><a href="#cb9-674" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb9-675"><a href="#cb9-675" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* TOC FLUTUANTE MANUAL */</span></span>
<span id="cb9-676"><a href="#cb9-676" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc </span><span class="ch">{{</span></span>
<span id="cb9-677"><a href="#cb9-677" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);</span></span>
<span id="cb9-678"><a href="#cb9-678" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #dee2e6;</span></span>
<span id="cb9-679"><a href="#cb9-679" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb9-680"><a href="#cb9-680" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb9-681"><a href="#cb9-681" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 20px 0;</span></span>
<span id="cb9-682"><a href="#cb9-682" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb9-683"><a href="#cb9-683" aria-hidden="true" tabindex="-1"></a><span class="ss">            float: right; /* FLUTUA √Ä DIREITA */</span></span>
<span id="cb9-684"><a href="#cb9-684" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 320px; /* Largura fixa para TOC */</span></span>
<span id="cb9-685"><a href="#cb9-685" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 30px;</span></span>
<span id="cb9-686"><a href="#cb9-686" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 30px;</span></span>
<span id="cb9-687"><a href="#cb9-687" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: relative;</span></span>
<span id="cb9-688"><a href="#cb9-688" aria-hidden="true" tabindex="-1"></a><span class="ss">            z-index: 100;</span></span>
<span id="cb9-689"><a href="#cb9-689" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-690"><a href="#cb9-690" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb9-691"><a href="#cb9-691" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc h2 </span><span class="ch">{{</span></span>
<span id="cb9-692"><a href="#cb9-692" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb9-693"><a href="#cb9-693" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb9-694"><a href="#cb9-694" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 2px solid #3498db;</span></span>
<span id="cb9-695"><a href="#cb9-695" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 10px;</span></span>
<span id="cb9-696"><a href="#cb9-696" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-697"><a href="#cb9-697" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc ul </span><span class="ch">{{</span></span>
<span id="cb9-698"><a href="#cb9-698" aria-hidden="true" tabindex="-1"></a><span class="ss">            list-style-type: none;</span></span>
<span id="cb9-699"><a href="#cb9-699" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb9-700"><a href="#cb9-700" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-701"><a href="#cb9-701" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc ul ul </span><span class="ch">{{</span></span>
<span id="cb9-702"><a href="#cb9-702" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 25px;</span></span>
<span id="cb9-703"><a href="#cb9-703" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-704"><a href="#cb9-704" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc ul ul ul </span><span class="ch">{{</span></span>
<span id="cb9-705"><a href="#cb9-705" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 35px; /* Mais indenta√ß√£o para n√≠vel 3 */</span></span>
<span id="cb9-706"><a href="#cb9-706" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-707"><a href="#cb9-707" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc li </span><span class="ch">{{</span></span>
<span id="cb9-708"><a href="#cb9-708" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 8px 0;</span></span>
<span id="cb9-709"><a href="#cb9-709" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-710"><a href="#cb9-710" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc a </span><span class="ch">{{</span></span>
<span id="cb9-711"><a href="#cb9-711" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb9-712"><a href="#cb9-712" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #495057;</span></span>
<span id="cb9-713"><a href="#cb9-713" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb9-714"><a href="#cb9-714" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: block;</span></span>
<span id="cb9-715"><a href="#cb9-715" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 8px;</span></span>
<span id="cb9-716"><a href="#cb9-716" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb9-717"><a href="#cb9-717" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-718"><a href="#cb9-718" aria-hidden="true" tabindex="-1"></a><span class="ss">        .toc a:hover </span><span class="ch">{{</span></span>
<span id="cb9-719"><a href="#cb9-719" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #007bff;</span></span>
<span id="cb9-720"><a href="#cb9-720" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: rgba(0, 123, 255, 0.1);</span></span>
<span id="cb9-721"><a href="#cb9-721" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-722"><a href="#cb9-722" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb9-723"><a href="#cb9-723" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* CLEARFIX PARA LAYOUT COM TOC FLUTUANTE */</span></span>
<span id="cb9-724"><a href="#cb9-724" aria-hidden="true" tabindex="-1"></a><span class="ss">        .main-content </span><span class="ch">{{</span></span>
<span id="cb9-725"><a href="#cb9-725" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden; /* PREVINE PROBLEMAS COM ELEMENTOS FLUTUANTES */</span></span>
<span id="cb9-726"><a href="#cb9-726" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: relative;</span></span>
<span id="cb9-727"><a href="#cb9-727" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-728"><a href="#cb9-728" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb9-729"><a href="#cb9-729" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1, h2, h3, h4, h5 </span><span class="ch">{{</span></span>
<span id="cb9-730"><a href="#cb9-730" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb9-731"><a href="#cb9-731" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 1.8em;</span></span>
<span id="cb9-732"><a href="#cb9-732" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-733"><a href="#cb9-733" aria-hidden="true" tabindex="-1"></a><span class="ss">        h1 </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-734"><a href="#cb9-734" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 3px solid #3498db; </span></span>
<span id="cb9-735"><a href="#cb9-735" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-bottom: 15px; </span></span>
<span id="cb9-736"><a href="#cb9-736" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb9-737"><a href="#cb9-737" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 2.2em;</span></span>
<span id="cb9-738"><a href="#cb9-738" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-739"><a href="#cb9-739" aria-hidden="true" tabindex="-1"></a><span class="ss">        h2 </span><span class="ch">{{</span></span>
<span id="cb9-740"><a href="#cb9-740" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb9-741"><a href="#cb9-741" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 15px;</span></span>
<span id="cb9-742"><a href="#cb9-742" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 2em;</span></span>
<span id="cb9-743"><a href="#cb9-743" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-744"><a href="#cb9-744" aria-hidden="true" tabindex="-1"></a><span class="ss">        code </span><span class="ch">{{</span></span>
<span id="cb9-745"><a href="#cb9-745" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f4f4f4;</span></span>
<span id="cb9-746"><a href="#cb9-746" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 3px 8px;</span></span>
<span id="cb9-747"><a href="#cb9-747" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb9-748"><a href="#cb9-748" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb9-749"><a href="#cb9-749" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #c7254e;</span></span>
<span id="cb9-750"><a href="#cb9-750" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb9-751"><a href="#cb9-751" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-752"><a href="#cb9-752" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span></span>
<span id="cb9-753"><a href="#cb9-753" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #2d2d2d;</span></span>
<span id="cb9-754"><a href="#cb9-754" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #f8f8f2;</span></span>
<span id="cb9-755"><a href="#cb9-755" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb9-756"><a href="#cb9-756" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb9-757"><a href="#cb9-757" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb9-758"><a href="#cb9-758" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 5px solid #3498db;</span></span>
<span id="cb9-759"><a href="#cb9-759" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Consolas&#39;, &#39;Monaco&#39;, &#39;Courier New&#39;, monospace;</span></span>
<span id="cb9-760"><a href="#cb9-760" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.4;</span></span>
<span id="cb9-761"><a href="#cb9-761" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-762"><a href="#cb9-762" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre code </span><span class="ch">{{</span></span>
<span id="cb9-763"><a href="#cb9-763" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: none;</span></span>
<span id="cb9-764"><a href="#cb9-764" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: inherit;</span></span>
<span id="cb9-765"><a href="#cb9-765" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 0;</span></span>
<span id="cb9-766"><a href="#cb9-766" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-767"><a href="#cb9-767" aria-hidden="true" tabindex="-1"></a><span class="ss">        blockquote </span><span class="ch">{{</span></span>
<span id="cb9-768"><a href="#cb9-768" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb9-769"><a href="#cb9-769" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 25px 0;</span></span>
<span id="cb9-770"><a href="#cb9-770" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-left: 25px;</span></span>
<span id="cb9-771"><a href="#cb9-771" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb9-772"><a href="#cb9-772" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-style: italic;</span></span>
<span id="cb9-773"><a href="#cb9-773" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb9-774"><a href="#cb9-774" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb9-775"><a href="#cb9-775" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 0 8px 8px 0;</span></span>
<span id="cb9-776"><a href="#cb9-776" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-777"><a href="#cb9-777" aria-hidden="true" tabindex="-1"></a><span class="ss">        table </span><span class="ch">{{</span></span>
<span id="cb9-778"><a href="#cb9-778" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-collapse: collapse;</span></span>
<span id="cb9-779"><a href="#cb9-779" aria-hidden="true" tabindex="-1"></a><span class="ss">            width: 100%;</span></span>
<span id="cb9-780"><a href="#cb9-780" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb9-781"><a href="#cb9-781" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 5px rgba(0,0,0,0.1);</span></span>
<span id="cb9-782"><a href="#cb9-782" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb9-783"><a href="#cb9-783" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb9-784"><a href="#cb9-784" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-785"><a href="#cb9-785" aria-hidden="true" tabindex="-1"></a><span class="ss">        th, td </span><span class="ch">{{</span></span>
<span id="cb9-786"><a href="#cb9-786" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb9-787"><a href="#cb9-787" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb9-788"><a href="#cb9-788" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: left;</span></span>
<span id="cb9-789"><a href="#cb9-789" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-790"><a href="#cb9-790" aria-hidden="true" tabindex="-1"></a><span class="ss">        th </span><span class="ch">{{</span></span>
<span id="cb9-791"><a href="#cb9-791" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #3498db, #2980b9);</span></span>
<span id="cb9-792"><a href="#cb9-792" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb9-793"><a href="#cb9-793" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb9-794"><a href="#cb9-794" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-transform: uppercase;</span></span>
<span id="cb9-795"><a href="#cb9-795" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb9-796"><a href="#cb9-796" aria-hidden="true" tabindex="-1"></a><span class="ss">            letter-spacing: 0.5px;</span></span>
<span id="cb9-797"><a href="#cb9-797" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-798"><a href="#cb9-798" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:nth-child(even) </span><span class="ch">{{</span></span>
<span id="cb9-799"><a href="#cb9-799" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f8f9fa;</span></span>
<span id="cb9-800"><a href="#cb9-800" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-801"><a href="#cb9-801" aria-hidden="true" tabindex="-1"></a><span class="ss">        tr:hover </span><span class="ch">{{</span></span>
<span id="cb9-802"><a href="#cb9-802" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #e3f2fd;</span></span>
<span id="cb9-803"><a href="#cb9-803" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: background-color 0.2s ease;</span></span>
<span id="cb9-804"><a href="#cb9-804" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-805"><a href="#cb9-805" aria-hidden="true" tabindex="-1"></a><span class="ss">        .math </span><span class="ch">{{</span></span>
<span id="cb9-806"><a href="#cb9-806" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center;</span></span>
<span id="cb9-807"><a href="#cb9-807" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 1.5em 0;</span></span>
<span id="cb9-808"><a href="#cb9-808" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb9-809"><a href="#cb9-809" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb9-810"><a href="#cb9-810" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb9-811"><a href="#cb9-811" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow-x: auto;</span></span>
<span id="cb9-812"><a href="#cb9-812" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-813"><a href="#cb9-813" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-header </span><span class="ch">{{</span></span>
<span id="cb9-814"><a href="#cb9-814" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb9-815"><a href="#cb9-815" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between;</span></span>
<span id="cb9-816"><a href="#cb9-816" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: center;</span></span>
<span id="cb9-817"><a href="#cb9-817" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 15px;</span></span>
<span id="cb9-818"><a href="#cb9-818" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb9-819"><a href="#cb9-819" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 10px;</span></span>
<span id="cb9-820"><a href="#cb9-820" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-821"><a href="#cb9-821" aria-hidden="true" tabindex="-1"></a><span class="ss">        .author </span><span class="ch">{{</span></span>
<span id="cb9-822"><a href="#cb9-822" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb9-823"><a href="#cb9-823" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb9-824"><a href="#cb9-824" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.1em;</span></span>
<span id="cb9-825"><a href="#cb9-825" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-826"><a href="#cb9-826" aria-hidden="true" tabindex="-1"></a><span class="ss">        .timestamp </span><span class="ch">{{</span></span>
<span id="cb9-827"><a href="#cb9-827" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #7f8c8d;</span></span>
<span id="cb9-828"><a href="#cb9-828" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb9-829"><a href="#cb9-829" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e9ecef;</span></span>
<span id="cb9-830"><a href="#cb9-830" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 8px;</span></span>
<span id="cb9-831"><a href="#cb9-831" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 4px;</span></span>
<span id="cb9-832"><a href="#cb9-832" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-833"><a href="#cb9-833" aria-hidden="true" tabindex="-1"></a><span class="ss">        .message-content </span><span class="ch">{{</span></span>
<span id="cb9-834"><a href="#cb9-834" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb9-835"><a href="#cb9-835" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px;</span></span>
<span id="cb9-836"><a href="#cb9-836" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb9-837"><a href="#cb9-837" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb9-838"><a href="#cb9-838" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 20px;</span></span>
<span id="cb9-839"><a href="#cb9-839" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-840"><a href="#cb9-840" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata </span><span class="ch">{{</span></span>
<span id="cb9-841"><a href="#cb9-841" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e8f4fd;</span></span>
<span id="cb9-842"><a href="#cb9-842" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb9-843"><a href="#cb9-843" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb9-844"><a href="#cb9-844" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 25px;</span></span>
<span id="cb9-845"><a href="#cb9-845" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-left: 4px solid #3498db;</span></span>
<span id="cb9-846"><a href="#cb9-846" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-847"><a href="#cb9-847" aria-hidden="true" tabindex="-1"></a><span class="ss">        .metadata h3 </span><span class="ch">{{</span></span>
<span id="cb9-848"><a href="#cb9-848" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-top: 0;</span></span>
<span id="cb9-849"><a href="#cb9-849" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50;</span></span>
<span id="cb9-850"><a href="#cb9-850" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-851"><a href="#cb9-851" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb9-852"><a href="#cb9-852" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* Melhorias responsivas */</span></span>
<span id="cb9-853"><a href="#cb9-853" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 1400px) </span><span class="ch">{{</span></span>
<span id="cb9-854"><a href="#cb9-854" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb9-855"><a href="#cb9-855" aria-hidden="true" tabindex="-1"></a><span class="ss">                max-width: 98%;</span></span>
<span id="cb9-856"><a href="#cb9-856" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 30px;</span></span>
<span id="cb9-857"><a href="#cb9-857" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb9-858"><a href="#cb9-858" aria-hidden="true" tabindex="-1"></a><span class="ss">            .toc </span><span class="ch">{{</span></span>
<span id="cb9-859"><a href="#cb9-859" aria-hidden="true" tabindex="-1"></a><span class="ss">                width: 280px; /* Reduz um pouco em telas menores */</span></span>
<span id="cb9-860"><a href="#cb9-860" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb9-861"><a href="#cb9-861" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-862"><a href="#cb9-862" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb9-863"><a href="#cb9-863" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 1200px) </span><span class="ch">{{</span></span>
<span id="cb9-864"><a href="#cb9-864" aria-hidden="true" tabindex="-1"></a><span class="ss">            .toc </span><span class="ch">{{</span></span>
<span id="cb9-865"><a href="#cb9-865" aria-hidden="true" tabindex="-1"></a><span class="ss">                float: none;</span></span>
<span id="cb9-866"><a href="#cb9-866" aria-hidden="true" tabindex="-1"></a><span class="ss">                width: auto;</span></span>
<span id="cb9-867"><a href="#cb9-867" aria-hidden="true" tabindex="-1"></a><span class="ss">                margin: 20px 0;</span></span>
<span id="cb9-868"><a href="#cb9-868" aria-hidden="true" tabindex="-1"></a><span class="ss">                position: static;</span></span>
<span id="cb9-869"><a href="#cb9-869" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb9-870"><a href="#cb9-870" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-871"><a href="#cb9-871" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb9-872"><a href="#cb9-872" aria-hidden="true" tabindex="-1"></a><span class="ss">        @media (max-width: 768px) </span><span class="ch">{{</span></span>
<span id="cb9-873"><a href="#cb9-873" aria-hidden="true" tabindex="-1"></a><span class="ss">            .container </span><span class="ch">{{</span></span>
<span id="cb9-874"><a href="#cb9-874" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 20px;</span></span>
<span id="cb9-875"><a href="#cb9-875" aria-hidden="true" tabindex="-1"></a><span class="ss">                max-width: 100%;</span></span>
<span id="cb9-876"><a href="#cb9-876" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb9-877"><a href="#cb9-877" aria-hidden="true" tabindex="-1"></a><span class="ss">            body </span><span class="ch">{{</span></span>
<span id="cb9-878"><a href="#cb9-878" aria-hidden="true" tabindex="-1"></a><span class="ss">                padding: 10px;</span></span>
<span id="cb9-879"><a href="#cb9-879" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb9-880"><a href="#cb9-880" aria-hidden="true" tabindex="-1"></a><span class="ss">            h1 </span><span class="ch">{{</span></span>
<span id="cb9-881"><a href="#cb9-881" aria-hidden="true" tabindex="-1"></a><span class="ss">                font-size: 1.8em;</span></span>
<span id="cb9-882"><a href="#cb9-882" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb9-883"><a href="#cb9-883" aria-hidden="true" tabindex="-1"></a><span class="ss">            .message-header </span><span class="ch">{{</span></span>
<span id="cb9-884"><a href="#cb9-884" aria-hidden="true" tabindex="-1"></a><span class="ss">                flex-direction: column;</span></span>
<span id="cb9-885"><a href="#cb9-885" aria-hidden="true" tabindex="-1"></a><span class="ss">                align-items: flex-start;</span></span>
<span id="cb9-886"><a href="#cb9-886" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb9-887"><a href="#cb9-887" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-888"><a href="#cb9-888" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb9-889"><a href="#cb9-889" aria-hidden="true" tabindex="-1"></a><span class="ss">        /* Scroll suave */</span></span>
<span id="cb9-890"><a href="#cb9-890" aria-hidden="true" tabindex="-1"></a><span class="ss">        html </span><span class="ch">{{</span></span>
<span id="cb9-891"><a href="#cb9-891" aria-hidden="true" tabindex="-1"></a><span class="ss">            scroll-behavior: smooth;</span></span>
<span id="cb9-892"><a href="#cb9-892" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-893"><a href="#cb9-893" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb9-894"><a href="#cb9-894" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb9-895"><a href="#cb9-895" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb9-896"><a href="#cb9-896" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb9-897"><a href="#cb9-897" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="sc">{</span>content<span class="sc">}</span></span>
<span id="cb9-898"><a href="#cb9-898" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb9-899"><a href="#cb9-899" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb9-900"><a href="#cb9-900" aria-hidden="true" tabindex="-1"></a><span class="ss">        // Configura√ß√£o MathJax para melhor renderiza√ß√£o</span></span>
<span id="cb9-901"><a href="#cb9-901" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb9-902"><a href="#cb9-902" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb9-903"><a href="#cb9-903" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb9-904"><a href="#cb9-904" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb9-905"><a href="#cb9-905" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true,</span></span>
<span id="cb9-906"><a href="#cb9-906" aria-hidden="true" tabindex="-1"></a><span class="ss">                tags: &#39;ams&#39;</span></span>
<span id="cb9-907"><a href="#cb9-907" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb9-908"><a href="#cb9-908" aria-hidden="true" tabindex="-1"></a><span class="ss">            options: </span><span class="ch">{{</span></span>
<span id="cb9-909"><a href="#cb9-909" aria-hidden="true" tabindex="-1"></a><span class="ss">                skipHtmlTags: [&#39;script&#39;, &#39;noscript&#39;, &#39;style&#39;, &#39;textarea&#39;, &#39;pre&#39;],</span></span>
<span id="cb9-910"><a href="#cb9-910" aria-hidden="true" tabindex="-1"></a><span class="ss">                renderActions: </span><span class="ch">{{</span></span>
<span id="cb9-911"><a href="#cb9-911" aria-hidden="true" tabindex="-1"></a><span class="ss">                    addMenu: [0, &#39;&#39;, &#39;&#39;]</span></span>
<span id="cb9-912"><a href="#cb9-912" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb9-913"><a href="#cb9-913" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span><span class="ss">,</span></span>
<span id="cb9-914"><a href="#cb9-914" aria-hidden="true" tabindex="-1"></a><span class="ss">            startup: </span><span class="ch">{{</span></span>
<span id="cb9-915"><a href="#cb9-915" aria-hidden="true" tabindex="-1"></a><span class="ss">                pageReady() </span><span class="ch">{{</span></span>
<span id="cb9-916"><a href="#cb9-916" aria-hidden="true" tabindex="-1"></a><span class="ss">                    return MathJax.startup.defaultPageReady().then(() =&gt; </span><span class="ch">{{</span></span>
<span id="cb9-917"><a href="#cb9-917" aria-hidden="true" tabindex="-1"></a><span class="ss">                        console.log(&#39;MathJax carregado com sucesso&#39;);</span></span>
<span id="cb9-918"><a href="#cb9-918" aria-hidden="true" tabindex="-1"></a><span class="ss">                    </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb9-919"><a href="#cb9-919" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span></span>
<span id="cb9-920"><a href="#cb9-920" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb9-921"><a href="#cb9-921" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb9-922"><a href="#cb9-922" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb9-923"><a href="#cb9-923" aria-hidden="true" tabindex="-1"></a><span class="ss">        // Script para destacar se√ß√£o ativa no TOC (se existir)</span></span>
<span id="cb9-924"><a href="#cb9-924" aria-hidden="true" tabindex="-1"></a><span class="ss">        document.addEventListener(&#39;DOMContentLoaded&#39;, function() </span><span class="ch">{{</span></span>
<span id="cb9-925"><a href="#cb9-925" aria-hidden="true" tabindex="-1"></a><span class="ss">            const tocLinks = document.querySelectorAll(&#39;#TOC a, .toc a&#39;);</span></span>
<span id="cb9-926"><a href="#cb9-926" aria-hidden="true" tabindex="-1"></a><span class="ss">            const sections = document.querySelectorAll(&#39;h1, h2, h3, h4, h5&#39;);</span></span>
<span id="cb9-927"><a href="#cb9-927" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span></span>
<span id="cb9-928"><a href="#cb9-928" aria-hidden="true" tabindex="-1"></a><span class="ss">            function highlightActiveSection() </span><span class="ch">{{</span></span>
<span id="cb9-929"><a href="#cb9-929" aria-hidden="true" tabindex="-1"></a><span class="ss">                let currentSection = &#39;&#39;;</span></span>
<span id="cb9-930"><a href="#cb9-930" aria-hidden="true" tabindex="-1"></a><span class="ss">                const scrollY = window.pageYOffset;</span></span>
<span id="cb9-931"><a href="#cb9-931" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span></span>
<span id="cb9-932"><a href="#cb9-932" aria-hidden="true" tabindex="-1"></a><span class="ss">                sections.forEach(section =&gt; </span><span class="ch">{{</span></span>
<span id="cb9-933"><a href="#cb9-933" aria-hidden="true" tabindex="-1"></a><span class="ss">                    const sectionTop = section.offsetTop - 100;</span></span>
<span id="cb9-934"><a href="#cb9-934" aria-hidden="true" tabindex="-1"></a><span class="ss">                    if (scrollY &gt;= sectionTop) </span><span class="ch">{{</span></span>
<span id="cb9-935"><a href="#cb9-935" aria-hidden="true" tabindex="-1"></a><span class="ss">                        currentSection = section.getAttribute(&#39;id&#39;);</span></span>
<span id="cb9-936"><a href="#cb9-936" aria-hidden="true" tabindex="-1"></a><span class="ss">                    </span><span class="ch">}}</span></span>
<span id="cb9-937"><a href="#cb9-937" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb9-938"><a href="#cb9-938" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span></span>
<span id="cb9-939"><a href="#cb9-939" aria-hidden="true" tabindex="-1"></a><span class="ss">                tocLinks.forEach(link =&gt; </span><span class="ch">{{</span></span>
<span id="cb9-940"><a href="#cb9-940" aria-hidden="true" tabindex="-1"></a><span class="ss">                    link.classList.remove(&#39;active&#39;);</span></span>
<span id="cb9-941"><a href="#cb9-941" aria-hidden="true" tabindex="-1"></a><span class="ss">                    if (link.getAttribute(&#39;href&#39;) === &#39;#&#39; + currentSection) </span><span class="ch">{{</span></span>
<span id="cb9-942"><a href="#cb9-942" aria-hidden="true" tabindex="-1"></a><span class="ss">                        link.classList.add(&#39;active&#39;);</span></span>
<span id="cb9-943"><a href="#cb9-943" aria-hidden="true" tabindex="-1"></a><span class="ss">                    </span><span class="ch">}}</span></span>
<span id="cb9-944"><a href="#cb9-944" aria-hidden="true" tabindex="-1"></a><span class="ss">                </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb9-945"><a href="#cb9-945" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb9-946"><a href="#cb9-946" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span></span>
<span id="cb9-947"><a href="#cb9-947" aria-hidden="true" tabindex="-1"></a><span class="ss">            if (tocLinks.length &gt; 0) </span><span class="ch">{{</span></span>
<span id="cb9-948"><a href="#cb9-948" aria-hidden="true" tabindex="-1"></a><span class="ss">                window.addEventListener(&#39;scroll&#39;, highlightActiveSection);</span></span>
<span id="cb9-949"><a href="#cb9-949" aria-hidden="true" tabindex="-1"></a><span class="ss">                highlightActiveSection(); // Chamar inicialmente</span></span>
<span id="cb9-950"><a href="#cb9-950" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb9-951"><a href="#cb9-951" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">);</span></span>
<span id="cb9-952"><a href="#cb9-952" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb9-953"><a href="#cb9-953" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb9-954"><a href="#cb9-954" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb9-955"><a href="#cb9-955" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb9-956"><a href="#cb9-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-957"><a href="#cb9-957" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_basic_html(<span class="va">self</span>, content: <span class="bu">str</span>, title: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb9-958"><a href="#cb9-958" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;HTML b√°sico de √∫ltimo recurso com MathJax&quot;&quot;&quot;</span></span>
<span id="cb9-959"><a href="#cb9-959" aria-hidden="true" tabindex="-1"></a>        mathjax_src <span class="op">=</span> <span class="st">&quot;assets/tex-mml-chtml.js&quot;</span> <span class="cf">if</span> Path(<span class="st">&quot;assets/tex-mml-chtml.js&quot;</span>).exists() <span class="cf">else</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&quot;</span></span>
<span id="cb9-960"><a href="#cb9-960" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-961"><a href="#cb9-961" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb9-962"><a href="#cb9-962" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html&gt;</span></span>
<span id="cb9-963"><a href="#cb9-963" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb9-964"><a href="#cb9-964" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb9-965"><a href="#cb9-965" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;/title&gt;</span></span>
<span id="cb9-966"><a href="#cb9-966" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb9-967"><a href="#cb9-967" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-968"><a href="#cb9-968" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif; </span></span>
<span id="cb9-969"><a href="#cb9-969" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px; </span></span>
<span id="cb9-970"><a href="#cb9-970" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.6;</span></span>
<span id="cb9-971"><a href="#cb9-971" aria-hidden="true" tabindex="-1"></a><span class="ss">            background-color: #f5f5f5;</span></span>
<span id="cb9-972"><a href="#cb9-972" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: none; /* Remove limita√ß√£o de largura - TELA COMPLETA */</span></span>
<span id="cb9-973"><a href="#cb9-973" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-974"><a href="#cb9-974" aria-hidden="true" tabindex="-1"></a><span class="ss">        pre </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-975"><a href="#cb9-975" aria-hidden="true" tabindex="-1"></a><span class="ss">            white-space: pre-wrap; </span></span>
<span id="cb9-976"><a href="#cb9-976" aria-hidden="true" tabindex="-1"></a><span class="ss">            word-wrap: break-word; </span></span>
<span id="cb9-977"><a href="#cb9-977" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb9-978"><a href="#cb9-978" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 15px;</span></span>
<span id="cb9-979"><a href="#cb9-979" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 5px;</span></span>
<span id="cb9-980"><a href="#cb9-980" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #ddd;</span></span>
<span id="cb9-981"><a href="#cb9-981" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-982"><a href="#cb9-982" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span></span>
<span id="cb9-983"><a href="#cb9-983" aria-hidden="true" tabindex="-1"></a><span class="ss">            max-width: 95%; /* Usa quase toda a largura dispon√≠vel */</span></span>
<span id="cb9-984"><a href="#cb9-984" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 0 auto;</span></span>
<span id="cb9-985"><a href="#cb9-985" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb9-986"><a href="#cb9-986" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 30px;</span></span>
<span id="cb9-987"><a href="#cb9-987" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px;</span></span>
<span id="cb9-988"><a href="#cb9-988" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span></span>
<span id="cb9-989"><a href="#cb9-989" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-990"><a href="#cb9-990" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb9-991"><a href="#cb9-991" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script&gt;</span></span>
<span id="cb9-992"><a href="#cb9-992" aria-hidden="true" tabindex="-1"></a><span class="ss">        window.MathJax = </span><span class="ch">{{</span></span>
<span id="cb9-993"><a href="#cb9-993" aria-hidden="true" tabindex="-1"></a><span class="ss">            tex: </span><span class="ch">{{</span></span>
<span id="cb9-994"><a href="#cb9-994" aria-hidden="true" tabindex="-1"></a><span class="ss">                inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">(&#39;, &#39;</span><span class="ch">\\</span><span class="ss">)&#39;]],</span></span>
<span id="cb9-995"><a href="#cb9-995" aria-hidden="true" tabindex="-1"></a><span class="ss">                displayMath: [[&#39;$$&#39;, &#39;$$&#39;], [&#39;</span><span class="ch">\\</span><span class="ss">[&#39;, &#39;</span><span class="ch">\\</span><span class="ss">]&#39;]],</span></span>
<span id="cb9-996"><a href="#cb9-996" aria-hidden="true" tabindex="-1"></a><span class="ss">                processEscapes: true</span></span>
<span id="cb9-997"><a href="#cb9-997" aria-hidden="true" tabindex="-1"></a><span class="ss">            </span><span class="ch">}}</span></span>
<span id="cb9-998"><a href="#cb9-998" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span><span class="ss">;</span></span>
<span id="cb9-999"><a href="#cb9-999" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/script&gt;</span></span>
<span id="cb9-1000"><a href="#cb9-1000" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;script src=&quot;</span><span class="sc">{</span>mathjax_src<span class="sc">}</span><span class="ss">&quot; async&gt;&lt;/script&gt;</span></span>
<span id="cb9-1001"><a href="#cb9-1001" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb9-1002"><a href="#cb9-1002" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb9-1003"><a href="#cb9-1003" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb9-1004"><a href="#cb9-1004" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;pre&gt;</span><span class="sc">{</span>content<span class="sc">}</span><span class="ss">&lt;/pre&gt;</span></span>
<span id="cb9-1005"><a href="#cb9-1005" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/div&gt;</span></span>
<span id="cb9-1006"><a href="#cb9-1006" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/body&gt;</span></span>
<span id="cb9-1007"><a href="#cb9-1007" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/html&gt;&quot;&quot;&quot;</span></span>
<span id="cb9-1008"><a href="#cb9-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1009"><a href="#cb9-1009" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_html_robust(<span class="va">self</span>):</span>
<span id="cb9-1010"><a href="#cb9-1010" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;M√©todo ROBUSTO para convers√£o HTML - VERS√ÉO OTIMIZADA&quot;&quot;&quot;</span></span>
<span id="cb9-1011"><a href="#cb9-1011" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb9-1012"><a href="#cb9-1012" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] HTMLs seriam criados:&quot;</span>)</span>
<span id="cb9-1013"><a href="#cb9-1013" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb9-1014"><a href="#cb9-1014" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb9-1015"><a href="#cb9-1015" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.html&quot;</span></span>
<span id="cb9-1016"><a href="#cb9-1016" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üåê </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1017"><a href="#cb9-1017" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb9-1018"><a href="#cb9-1018" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1019"><a href="#cb9-1019" aria-hidden="true" tabindex="-1"></a>        markdown_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;markdown&#39;</span>])</span>
<span id="cb9-1020"><a href="#cb9-1020" aria-hidden="true" tabindex="-1"></a>        html_folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;html&#39;</span>])</span>
<span id="cb9-1021"><a href="#cb9-1021" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1022"><a href="#cb9-1022" aria-hidden="true" tabindex="-1"></a>        md_files <span class="op">=</span> <span class="bu">list</span>(markdown_folder.glob(<span class="st">&quot;*.md&quot;</span>))</span>
<span id="cb9-1023"><a href="#cb9-1023" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1024"><a href="#cb9-1024" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> md_files:</span>
<span id="cb9-1025"><a href="#cb9-1025" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Nenhum arquivo Markdown encontrado para convers√£o.&quot;</span>)</span>
<span id="cb9-1026"><a href="#cb9-1026" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb9-1027"><a href="#cb9-1027" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1028"><a href="#cb9-1028" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÑ Convertendo </span><span class="sc">{</span><span class="bu">len</span>(md_files)<span class="sc">}</span><span class="ss"> arquivos Markdown para HTML (OTIMIZADO)...&quot;</span>)</span>
<span id="cb9-1029"><a href="#cb9-1029" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1030"><a href="#cb9-1030" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verifica se Pandoc est√° dispon√≠vel</span></span>
<span id="cb9-1031"><a href="#cb9-1031" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-1032"><a href="#cb9-1032" aria-hidden="true" tabindex="-1"></a>            subprocess.run([<span class="st">&#39;pandoc&#39;</span>, <span class="st">&#39;--version&#39;</span>], capture_output<span class="op">=</span><span class="va">True</span>, check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-1033"><a href="#cb9-1033" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">True</span></span>
<span id="cb9-1034"><a href="#cb9-1034" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;‚úÖ Pandoc dispon√≠vel - usando convers√£o otimizada&quot;</span>)</span>
<span id="cb9-1035"><a href="#cb9-1035" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb9-1036"><a href="#cb9-1036" aria-hidden="true" tabindex="-1"></a>            pandoc_available <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-1037"><a href="#cb9-1037" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è Pandoc n√£o dispon√≠vel - usando fallback Python&quot;</span>)</span>
<span id="cb9-1038"><a href="#cb9-1038" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1039"><a href="#cb9-1039" aria-hidden="true" tabindex="-1"></a>        converted_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-1040"><a href="#cb9-1040" aria-hidden="true" tabindex="-1"></a>        failed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-1041"><a href="#cb9-1041" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1042"><a href="#cb9-1042" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> md_file <span class="kw">in</span> md_files:</span>
<span id="cb9-1043"><a href="#cb9-1043" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb9-1044"><a href="#cb9-1044" aria-hidden="true" tabindex="-1"></a>                html_file <span class="op">=</span> html_folder <span class="op">/</span> md_file.with_suffix(<span class="st">&#39;.html&#39;</span>).name</span>
<span id="cb9-1045"><a href="#cb9-1045" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1046"><a href="#cb9-1046" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> html_file.exists():</span>
<span id="cb9-1047"><a href="#cb9-1047" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚è≠Ô∏è  J√° existe: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1048"><a href="#cb9-1048" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-1049"><a href="#cb9-1049" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb9-1050"><a href="#cb9-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1051"><a href="#cb9-1051" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÑ Processando: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1052"><a href="#cb9-1052" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1053"><a href="#cb9-1053" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> pandoc_available:</span>
<span id="cb9-1054"><a href="#cb9-1054" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_pandoc_optimized(<span class="bu">str</span>(md_file))</span>
<span id="cb9-1055"><a href="#cb9-1055" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb9-1056"><a href="#cb9-1056" aria-hidden="true" tabindex="-1"></a>                    html_content <span class="op">=</span> <span class="va">self</span>._convert_with_fallback(<span class="bu">str</span>(md_file))</span>
<span id="cb9-1057"><a href="#cb9-1057" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1058"><a href="#cb9-1058" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> html_content:</span>
<span id="cb9-1059"><a href="#cb9-1059" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(html_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb9-1060"><a href="#cb9-1060" aria-hidden="true" tabindex="-1"></a>                        f.write(html_content)</span>
<span id="cb9-1061"><a href="#cb9-1061" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1062"><a href="#cb9-1062" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Criado: </span><span class="sc">{</span>html_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1063"><a href="#cb9-1063" aria-hidden="true" tabindex="-1"></a>                    converted_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-1064"><a href="#cb9-1064" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb9-1065"><a href="#cb9-1065" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Falha na convers√£o: </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1066"><a href="#cb9-1066" aria-hidden="true" tabindex="-1"></a>                    failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-1067"><a href="#cb9-1067" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1068"><a href="#cb9-1068" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb9-1069"><a href="#cb9-1069" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro em </span><span class="sc">{</span>md_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1070"><a href="#cb9-1070" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(traceback.format_exc())</span>
<span id="cb9-1071"><a href="#cb9-1071" aria-hidden="true" tabindex="-1"></a>                failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-1072"><a href="#cb9-1072" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1073"><a href="#cb9-1073" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä HTML: </span><span class="sc">{</span>converted_count<span class="sc">}</span><span class="ss"> arquivos criados, </span><span class="sc">{</span>failed_count<span class="sc">}</span><span class="ss"> falhas em &#39;</span><span class="sc">{</span>html_folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb9-1074"><a href="#cb9-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1075"><a href="#cb9-1075" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> categorize_conversation(<span class="va">self</span>, title: <span class="bu">str</span>, summary: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb9-1076"><a href="#cb9-1076" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Categoriza√ß√£o otimizada com express√µes regulares&quot;&quot;&quot;</span></span>
<span id="cb9-1077"><a href="#cb9-1077" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&quot;</span>.lower()</span>
<span id="cb9-1078"><a href="#cb9-1078" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1079"><a href="#cb9-1079" aria-hidden="true" tabindex="-1"></a>        patterns <span class="op">=</span> {</span>
<span id="cb9-1080"><a href="#cb9-1080" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Tecnologia&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">tecnologia</span><span class="cf">|</span><span class="vs">hardware</span><span class="cf">|</span><span class="vs">software</span><span class="cf">|</span><span class="vs">rede</span><span class="cf">|</span><span class="vs">internet</span><span class="cf">|</span><span class="vs">wifi</span><span class="cf">|</span><span class="vs">bluetooth</span><span class="cf">|</span><span class="pp">[45]</span><span class="vs">g</span><span class="cf">|</span><span class="vs">cloud</span><span class="cf">|</span><span class="vs">aws</span><span class="cf">|</span><span class="vs">azure</span><span class="cf">|</span><span class="vs">gcp</span><span class="cf">|</span><span class="vs">servidor</span><span class="cf">|</span><span class="vs">hosting</span><span class="cf">|</span><span class="vs">dom√≠nio</span><span class="cf">|</span><span class="vs">ssl</span><span class="cf">|</span><span class="vs">router</span><span class="cf">|</span><span class="vs">switch</span><span class="cf">|</span><span class="vs">firewall</span><span class="cf">|</span><span class="vs">iot</span><span class="cf">|</span><span class="vs">smartphone</span><span class="cf">|</span><span class="vs">tablet</span><span class="cf">|</span><span class="vs">navegador</span><span class="cf">|</span><span class="vs">browser</span><span class="cf">|</span><span class="vs">chrome</span><span class="cf">|</span><span class="vs">firefox</span><span class="cf">|</span><span class="vs">edge</span><span class="cf">|</span><span class="vs">safari</span><span class="cf">|</span><span class="vs">email</span><span class="cf">|</span><span class="vs">gmail</span><span class="cf">|</span><span class="vs">outlook</span><span class="cf">|</span><span class="vs">criptografia</span><span class="cf">|</span><span class="vs">seguran√ßa</span><span class="cf">|</span><span class="vs">ciberseguran√ßa</span><span class="cf">|</span><span class="vs">ransomware</span><span class="cf">|</span><span class="vs">phishing</span><span class="cf">|</span><span class="vs">autentica√ß√£o</span><span class="cf">|</span><span class="vs">2fa</span><span class="cf">|</span><span class="vs">biometria</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb9-1081"><a href="#cb9-1081" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Sa√∫de&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">sa√∫de</span><span class="cf">|</span><span class="vs">medicina</span><span class="cf">|</span><span class="vs">m√©dico</span><span class="cf">|</span><span class="vs">enfermagem</span><span class="cf">|</span><span class="vs">doen√ßa</span><span class="cf">|</span><span class="vs">v√≠rus</span><span class="cf">|</span><span class="vs">bact√©ria</span><span class="cf">|</span><span class="vs">vacina</span><span class="cf">|</span><span class="vs">covid</span><span class="cf">|</span><span class="vs">coronav√≠rus</span><span class="cf">|</span><span class="vs">gripe</span><span class="cf">|</span><span class="vs">febre</span><span class="cf">|</span><span class="vs">dor</span><span class="cf">|</span><span class="vs">an√°lise</span><span class="cf">|</span><span class="vs">exame</span><span class="cf">|</span><span class="vs">raio x</span><span class="cf">|</span><span class="vs">resson√¢ncia</span><span class="cf">|</span><span class="vs">hospital</span><span class="cf">|</span><span class="vs">cl√≠nica</span><span class="cf">|</span><span class="vs">farm√°cia</span><span class="cf">|</span><span class="vs">medicamento</span><span class="cf">|</span><span class="vs">rem√©dio</span><span class="cf">|</span><span class="vs">psicologia</span><span class="cf">|</span><span class="vs">terapia</span><span class="cf">|</span><span class="vs">bem-estar</span><span class="cf">|</span><span class="vs">nutri√ß√£o</span><span class="cf">|</span><span class="vs">dieta</span><span class="cf">|</span><span class="vs">exerc√≠cio</span><span class="cf">|</span><span class="vs">fitness</span><span class="cf">|</span><span class="vs">sono</span><span class="cf">|</span><span class="vs">sa√∫de mental</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb9-1082"><a href="#cb9-1082" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Programa√ß√£o&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">python</span><span class="cf">|</span><span class="vs">javascript</span><span class="cf">|</span><span class="vs">java</span><span class="cf">|</span><span class="vs">c</span><span class="ch">\+\+</span><span class="cf">|</span><span class="vs">c#</span><span class="cf">|</span><span class="vs">go</span><span class="cf">|</span><span class="vs">rust</span><span class="cf">|</span><span class="vs">lua</span><span class="cf">|</span><span class="vs">bash</span><span class="cf">|</span><span class="vs">script</span><span class="cf">|</span><span class="vs">debug</span><span class="cf">|</span><span class="vs">erro</span><span class="cf">|</span><span class="vs">conda</span><span class="cf">|</span><span class="vs">mamba</span><span class="cf">|</span><span class="vs">pandoc</span><span class="cf">|</span><span class="vs">msys2</span><span class="cf">|</span><span class="vs">spyder</span><span class="cf">|</span><span class="vs">jupyter</span><span class="cf">|</span><span class="vs">pip</span><span class="cf">|</span><span class="vs">venv</span><span class="cf">|</span><span class="vs">docker</span><span class="cf">|</span><span class="vs">git</span><span class="cf">|</span><span class="vs">github</span><span class="cf">|</span><span class="vs">vscode</span><span class="cf">|</span><span class="vs">ide</span><span class="cf">|</span><span class="vs">programa</span><span class="cf">|</span><span class="vs">c√≥digo</span><span class="cf">|</span><span class="vs">fun√ß√£o</span><span class="cf">|</span><span class="vs">classe</span><span class="cf">|</span><span class="vs">api</span><span class="cf">|</span><span class="vs">selenium</span><span class="cf">|</span><span class="vs">playwright</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb9-1083"><a href="#cb9-1083" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Sistemas&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">windows</span><span class="cf">|</span><span class="vs">linux</span><span class="cf">|</span><span class="vs">macos</span><span class="cf">|</span><span class="vs">so</span><span class="cf">|</span><span class="vs">sistema operacional</span><span class="cf">|</span><span class="vs">driver</span><span class="cf">|</span><span class="vs">registry</span><span class="cf">|</span><span class="vs">process</span><span class="cf">|</span><span class="vs">firewall</span><span class="cf">|</span><span class="vs">bios</span><span class="cf">|</span><span class="vs">boot</span><span class="cf">|</span><span class="vs">path</span><span class="cf">|</span><span class="vs">dll</span><span class="cf">|</span><span class="vs">exe</span><span class="cf">|</span><span class="vs">powershell</span><span class="cf">|</span><span class="vs">cmd</span><span class="cf">|</span><span class="vs">terminal</span><span class="cf">|</span><span class="vs">shell</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb9-1084"><a href="#cb9-1084" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;IA&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">ia</span><span class="cf">|</span><span class="vs">gpt</span><span class="cf">|</span><span class="vs">chatgpt</span><span class="cf">|</span><span class="vs">grok</span><span class="cf">|</span><span class="vs">qwen</span><span class="cf">|</span><span class="vs">deepseek</span><span class="cf">|</span><span class="vs">llm</span><span class="cf">|</span><span class="vs">modelo</span><span class="cf">|</span><span class="vs">prompt</span><span class="cf">|</span><span class="vs">token</span><span class="cf">|</span><span class="vs">embedding</span><span class="cf">|</span><span class="vs">fine-tune</span><span class="cf">|</span><span class="vs">neural</span><span class="cf">|</span><span class="vs">chatbot</span><span class="cf">|</span><span class="vs">intelig√™ncia artificial</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb9-1085"><a href="#cb9-1085" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Dados&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">dados</span><span class="cf">|</span><span class="vs">data</span><span class="cf">|</span><span class="vs">csv</span><span class="cf">|</span><span class="vs">json</span><span class="cf">|</span><span class="vs">pandas</span><span class="cf">|</span><span class="vs">numpy</span><span class="cf">|</span><span class="vs">excel</span><span class="cf">|</span><span class="vs">sql</span><span class="cf">|</span><span class="vs">banco</span><span class="cf">|</span><span class="vs">sqlite</span><span class="cf">|</span><span class="vs">postgres</span><span class="cf">|</span><span class="vs">visualiza√ß√£o</span><span class="cf">|</span><span class="vs">gr√°fico</span><span class="cf">|</span><span class="vs">tabela</span><span class="cf">|</span><span class="vs">an√°lise</span><span class="cf">|</span><span class="vs">etl</span><span class="cf">|</span><span class="vs">dashboard</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span>,</span>
<span id="cb9-1086"><a href="#cb9-1086" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Geral&#39;</span>: <span class="vs">r&#39;</span><span class="dv">\b</span><span class="kw">(</span><span class="vs">geral</span><span class="cf">|</span><span class="vs">pergunta</span><span class="cf">|</span><span class="vs">ajuda</span><span class="cf">|</span><span class="vs">como fazer</span><span class="cf">|</span><span class="vs">explicar</span><span class="cf">|</span><span class="vs">resumo</span><span class="cf">|</span><span class="vs">tutorial b√°sico</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">&#39;</span></span>
<span id="cb9-1087"><a href="#cb9-1087" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-1088"><a href="#cb9-1088" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1089"><a href="#cb9-1089" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category, pattern <span class="kw">in</span> patterns.items():</span>
<span id="cb9-1090"><a href="#cb9-1090" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> re.search(pattern, text, re.IGNORECASE):</span>
<span id="cb9-1091"><a href="#cb9-1091" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> category</span>
<span id="cb9-1092"><a href="#cb9-1092" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1093"><a href="#cb9-1093" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Outros&#39;</span></span>
<span id="cb9-1094"><a href="#cb9-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1095"><a href="#cb9-1095" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_timestamp_for_sorting(<span class="va">self</span>, timestamp) <span class="op">-&gt;</span> datetime:</span>
<span id="cb9-1096"><a href="#cb9-1096" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> timestamp:</span>
<span id="cb9-1097"><a href="#cb9-1097" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> datetime.<span class="bu">min</span></span>
<span id="cb9-1098"><a href="#cb9-1098" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1099"><a href="#cb9-1099" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-1100"><a href="#cb9-1100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(timestamp, <span class="bu">str</span>):</span>
<span id="cb9-1101"><a href="#cb9-1101" aria-hidden="true" tabindex="-1"></a>                clean_ts <span class="op">=</span> timestamp.replace(<span class="st">&#39;T&#39;</span>, <span class="st">&#39; &#39;</span>).split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>].split(<span class="st">&#39;+&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb9-1102"><a href="#cb9-1102" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> clean_ts.endswith(<span class="st">&#39;Z&#39;</span>):</span>
<span id="cb9-1103"><a href="#cb9-1103" aria-hidden="true" tabindex="-1"></a>                    clean_ts <span class="op">=</span> clean_ts[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb9-1104"><a href="#cb9-1104" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> datetime.fromisoformat(clean_ts)</span>
<span id="cb9-1105"><a href="#cb9-1105" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(timestamp, (<span class="bu">int</span>, <span class="bu">float</span>)):</span>
<span id="cb9-1106"><a href="#cb9-1106" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> datetime.fromtimestamp(timestamp)</span>
<span id="cb9-1107"><a href="#cb9-1107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb9-1108"><a href="#cb9-1108" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb9-1109"><a href="#cb9-1109" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1110"><a href="#cb9-1110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> datetime.<span class="bu">min</span></span>
<span id="cb9-1111"><a href="#cb9-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1112"><a href="#cb9-1112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> format_timestamp(<span class="va">self</span>, timestamp) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb9-1113"><a href="#cb9-1113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> timestamp:</span>
<span id="cb9-1114"><a href="#cb9-1114" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb9-1115"><a href="#cb9-1115" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1116"><a href="#cb9-1116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-1117"><a href="#cb9-1117" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(timestamp, (<span class="bu">int</span>, <span class="bu">float</span>)):</span>
<span id="cb9-1118"><a href="#cb9-1118" aria-hidden="true" tabindex="-1"></a>                dt <span class="op">=</span> datetime.fromtimestamp(timestamp)</span>
<span id="cb9-1119"><a href="#cb9-1119" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> dt.strftime(<span class="st">&#39;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S&#39;</span>)</span>
<span id="cb9-1120"><a href="#cb9-1120" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(timestamp, <span class="bu">str</span>):</span>
<span id="cb9-1121"><a href="#cb9-1121" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">&#39;T&#39;</span> <span class="kw">in</span> timestamp:</span>
<span id="cb9-1122"><a href="#cb9-1122" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> timestamp.replace(<span class="st">&#39;T&#39;</span>, <span class="st">&#39; &#39;</span>).split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb9-1123"><a href="#cb9-1123" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> timestamp</span>
<span id="cb9-1124"><a href="#cb9-1124" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb9-1125"><a href="#cb9-1125" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb9-1126"><a href="#cb9-1126" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1127"><a href="#cb9-1127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">str</span>(timestamp)</span>
<span id="cb9-1128"><a href="#cb9-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1129"><a href="#cb9-1129" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_enhanced_markdown_content(<span class="va">self</span>, conversation: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb9-1130"><a href="#cb9-1130" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Gera conte√∫do Markdown com preserva√ß√£o total de formata√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb9-1131"><a href="#cb9-1131" aria-hidden="true" tabindex="-1"></a>        lines <span class="op">=</span> [</span>
<span id="cb9-1132"><a href="#cb9-1132" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;# </span><span class="sc">{</span>conversation[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb9-1133"><a href="#cb9-1133" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb9-1134"><a href="#cb9-1134" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;## üìä Informa√ß√µes&quot;</span>,</span>
<span id="cb9-1135"><a href="#cb9-1135" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **N√∫mero:** #</span><span class="sc">{</span>conversation[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb9-1136"><a href="#cb9-1136" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Origem:** </span><span class="sc">{</span>conversation[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb9-1137"><a href="#cb9-1137" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Categoria:** </span><span class="sc">{</span>conversation[<span class="st">&#39;category&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb9-1138"><a href="#cb9-1138" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **ID:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;id&#39;</span>, <span class="st">&#39;N/A&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb9-1139"><a href="#cb9-1139" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Criada em:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> conversation<span class="sc">.</span>get(<span class="st">&#39;created_at&#39;</span>) <span class="kw">or</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb9-1140"><a href="#cb9-1140" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb9-1141"><a href="#cb9-1141" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1142"><a href="#cb9-1142" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> conversation.get(<span class="st">&#39;updated_at&#39;</span>):</span>
<span id="cb9-1143"><a href="#cb9-1143" aria-hidden="true" tabindex="-1"></a>            lines.append(<span class="ss">f&quot;- **Atualizada em:** </span><span class="sc">{</span>conversation[<span class="st">&#39;updated_at&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1144"><a href="#cb9-1144" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1145"><a href="#cb9-1145" aria-hidden="true" tabindex="-1"></a>        lines.extend([</span>
<span id="cb9-1146"><a href="#cb9-1146" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Total de mensagens:** </span><span class="sc">{</span><span class="bu">len</span>(conversation[<span class="st">&#39;messages&#39;</span>])<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb9-1147"><a href="#cb9-1147" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;- **Resumo:** </span><span class="sc">{</span>conversation<span class="sc">.</span>get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;Sem resumo&#39;</span>)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb9-1148"><a href="#cb9-1148" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb9-1149"><a href="#cb9-1149" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;---&quot;</span>,</span>
<span id="cb9-1150"><a href="#cb9-1150" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb9-1151"><a href="#cb9-1151" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;## üí¨ Conversa&quot;</span>,</span>
<span id="cb9-1152"><a href="#cb9-1152" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span></span>
<span id="cb9-1153"><a href="#cb9-1153" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb9-1154"><a href="#cb9-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1155"><a href="#cb9-1155" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, msg <span class="kw">in</span> <span class="bu">enumerate</span>(conversation[<span class="st">&#39;messages&#39;</span>], <span class="dv">1</span>):</span>
<span id="cb9-1156"><a href="#cb9-1156" aria-hidden="true" tabindex="-1"></a>            timestamp <span class="op">=</span> <span class="ss">f&quot; *(</span><span class="sc">{</span>msg[<span class="st">&#39;timestamp&#39;</span>]<span class="sc">}</span><span class="ss">)*&quot;</span> <span class="cf">if</span> msg[<span class="st">&#39;timestamp&#39;</span>] <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb9-1157"><a href="#cb9-1157" aria-hidden="true" tabindex="-1"></a>            model_info <span class="op">=</span> <span class="ss">f&quot; *[</span><span class="sc">{</span>msg<span class="sc">.</span>get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;&#39;</span>)<span class="sc">}</span><span class="ss">]*&quot;</span> <span class="cf">if</span> msg.get(<span class="st">&#39;model&#39;</span>) <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb9-1158"><a href="#cb9-1158" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1159"><a href="#cb9-1159" aria-hidden="true" tabindex="-1"></a>            preserved_content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(msg[<span class="st">&#39;content&#39;</span>])</span>
<span id="cb9-1160"><a href="#cb9-1160" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1161"><a href="#cb9-1161" aria-hidden="true" tabindex="-1"></a>            lines.extend([</span>
<span id="cb9-1162"><a href="#cb9-1162" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;### </span><span class="sc">{</span>msg[<span class="st">&#39;author&#39;</span>]<span class="sc">}{</span>timestamp<span class="sc">}{</span>model_info<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb9-1163"><a href="#cb9-1163" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;&quot;</span>,</span>
<span id="cb9-1164"><a href="#cb9-1164" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;</span><span class="sc">{</span>preserved_content<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb9-1165"><a href="#cb9-1165" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;&quot;</span></span>
<span id="cb9-1166"><a href="#cb9-1166" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb9-1167"><a href="#cb9-1167" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1168"><a href="#cb9-1168" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> j <span class="op">&lt;</span> <span class="bu">len</span>(conversation[<span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb9-1169"><a href="#cb9-1169" aria-hidden="true" tabindex="-1"></a>                lines.extend([<span class="st">&quot;---&quot;</span>, <span class="st">&quot;&quot;</span>])</span>
<span id="cb9-1170"><a href="#cb9-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1171"><a href="#cb9-1171" aria-hidden="true" tabindex="-1"></a>        lines.extend([</span>
<span id="cb9-1172"><a href="#cb9-1172" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;---&quot;</span>,</span>
<span id="cb9-1173"><a href="#cb9-1173" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;&quot;</span>,</span>
<span id="cb9-1174"><a href="#cb9-1174" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;*Conversa exportada do </span><span class="sc">{</span>conversation[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">*&quot;</span>,</span>
<span id="cb9-1175"><a href="#cb9-1175" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;*Processado em: </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">.</span>strftime(<span class="st">&#39;</span><span class="sc">%d</span><span class="st">/%m/%Y %H:%M&#39;</span>)<span class="sc">}</span><span class="ss">*&quot;</span></span>
<span id="cb9-1176"><a href="#cb9-1176" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb9-1177"><a href="#cb9-1177" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1178"><a href="#cb9-1178" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(lines)</span>
<span id="cb9-1179"><a href="#cb9-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1180"><a href="#cb9-1180" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_qwen_corrected(<span class="va">self</span>, path: Path):</span>
<span id="cb9-1181"><a href="#cb9-1181" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa Qwen3 com corre√ß√£o para content_list - VERS√ÉO CORRIGIDA&quot;&quot;&quot;</span></span>
<span id="cb9-1182"><a href="#cb9-1182" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb9-1183"><a href="#cb9-1183" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria Qwen3: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1184"><a href="#cb9-1184" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb9-1185"><a href="#cb9-1185" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1186"><a href="#cb9-1186" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-1187"><a href="#cb9-1187" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb9-1188"><a href="#cb9-1188" aria-hidden="true" tabindex="-1"></a>                raw_data <span class="op">=</span> json.load(f)</span>
<span id="cb9-1189"><a href="#cb9-1189" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1190"><a href="#cb9-1190" aria-hidden="true" tabindex="-1"></a>            <span class="co"># DEBUG: Salvar estrutura completa para an√°lise</span></span>
<span id="cb9-1191"><a href="#cb9-1191" aria-hidden="true" tabindex="-1"></a>            debug_file <span class="op">=</span> Path(<span class="st">&quot;qwen_debug_structure.json&quot;</span>)</span>
<span id="cb9-1192"><a href="#cb9-1192" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(debug_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb9-1193"><a href="#cb9-1193" aria-hidden="true" tabindex="-1"></a>                json.dump(raw_data, f, indent<span class="op">=</span><span class="dv">2</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-1194"><a href="#cb9-1194" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Estrutura Qwen salva em: </span><span class="sc">{</span>debug_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1195"><a href="#cb9-1195" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1196"><a href="#cb9-1196" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extrair conversas</span></span>
<span id="cb9-1197"><a href="#cb9-1197" aria-hidden="true" tabindex="-1"></a>            conversations <span class="op">=</span> []</span>
<span id="cb9-1198"><a href="#cb9-1198" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1199"><a href="#cb9-1199" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;data&#39;</span> <span class="kw">in</span> raw_data <span class="kw">and</span> <span class="bu">isinstance</span>(raw_data[<span class="st">&#39;data&#39;</span>], <span class="bu">list</span>):</span>
<span id="cb9-1200"><a href="#cb9-1200" aria-hidden="true" tabindex="-1"></a>                conversations <span class="op">=</span> raw_data[<span class="st">&#39;data&#39;</span>]</span>
<span id="cb9-1201"><a href="#cb9-1201" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÅ Estrutura 1: </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas em &#39;data&#39;&quot;</span>)</span>
<span id="cb9-1202"><a href="#cb9-1202" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">list</span>):</span>
<span id="cb9-1203"><a href="#cb9-1203" aria-hidden="true" tabindex="-1"></a>                conversations <span class="op">=</span> raw_data</span>
<span id="cb9-1204"><a href="#cb9-1204" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÅ Estrutura 2: </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas na raiz&quot;</span>)</span>
<span id="cb9-1205"><a href="#cb9-1205" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb9-1206"><a href="#cb9-1206" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> key, value <span class="kw">in</span> raw_data.items():</span>
<span id="cb9-1207"><a href="#cb9-1207" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(value, <span class="bu">list</span>) <span class="kw">and</span> <span class="bu">len</span>(value) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb9-1208"><a href="#cb9-1208" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(value[<span class="dv">0</span>], <span class="bu">dict</span>) <span class="kw">and</span> <span class="bu">any</span>(k <span class="kw">in</span> value[<span class="dv">0</span>] <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">&#39;title&#39;</span>, <span class="st">&#39;chat&#39;</span>, <span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb9-1209"><a href="#cb9-1209" aria-hidden="true" tabindex="-1"></a>                            conversations <span class="op">=</span> value</span>
<span id="cb9-1210"><a href="#cb9-1210" aria-hidden="true" tabindex="-1"></a>                            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìÅ Estrutura alternativa: </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas em &#39;</span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb9-1211"><a href="#cb9-1211" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">break</span></span>
<span id="cb9-1212"><a href="#cb9-1212" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1213"><a href="#cb9-1213" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> conversations:</span>
<span id="cb9-1214"><a href="#cb9-1214" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Nenhuma conversa encontrada no arquivo Qwen&quot;</span>)</span>
<span id="cb9-1215"><a href="#cb9-1215" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb9-1216"><a href="#cb9-1216" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1217"><a href="#cb9-1217" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Qwen: encontradas </span><span class="sc">{</span><span class="bu">len</span>(conversations)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb9-1218"><a href="#cb9-1218" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-1219"><a href="#cb9-1219" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1220"><a href="#cb9-1220" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(conversations):</span>
<span id="cb9-1221"><a href="#cb9-1221" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conv, <span class="bu">dict</span>):</span>
<span id="cb9-1222"><a href="#cb9-1222" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb9-1223"><a href="#cb9-1223" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1224"><a href="#cb9-1224" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa Qwen </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb9-1225"><a href="#cb9-1225" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb9-1226"><a href="#cb9-1226" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1227"><a href="#cb9-1227" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üîç Processando: &#39;</span><span class="sc">{</span>clean_title<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb9-1228"><a href="#cb9-1228" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1229"><a href="#cb9-1229" aria-hidden="true" tabindex="-1"></a>                <span class="co"># EXTRA√á√ÉO CORRIGIDA - foco em content_list</span></span>
<span id="cb9-1230"><a href="#cb9-1230" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> <span class="va">self</span>._extract_qwen_messages_corrected(conv, clean_title, i)</span>
<span id="cb9-1231"><a href="#cb9-1231" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1232"><a href="#cb9-1232" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb9-1233"><a href="#cb9-1233" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Ordenar mensagens por timestamp</span></span>
<span id="cb9-1234"><a href="#cb9-1234" aria-hidden="true" tabindex="-1"></a>                    messages.sort(key<span class="op">=</span><span class="kw">lambda</span> x: <span class="va">self</span>.parse_timestamp_for_sorting(x[<span class="st">&#39;timestamp&#39;</span>]))</span>
<span id="cb9-1235"><a href="#cb9-1235" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1236"><a href="#cb9-1236" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb9-1237"><a href="#cb9-1237" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,</span>
<span id="cb9-1238"><a href="#cb9-1238" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;Qwen3&#39;</span>,</span>
<span id="cb9-1239"><a href="#cb9-1239" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;qwen_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb9-1240"><a href="#cb9-1240" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;created_at&#39;</span>)),</span>
<span id="cb9-1241"><a href="#cb9-1241" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;updated_at&#39;</span>)),</span>
<span id="cb9-1242"><a href="#cb9-1242" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb9-1243"><a href="#cb9-1243" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb9-1244"><a href="#cb9-1244" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="va">self</span>.categorize_conversation(clean_title, messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb9-1245"><a href="#cb9-1245" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb9-1246"><a href="#cb9-1246" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-1247"><a href="#cb9-1247" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.info(<span class="ss">f&quot;   ‚úÖ Adicionada: </span><span class="sc">{</span><span class="bu">len</span>(messages)<span class="sc">}</span><span class="ss"> mensagens&quot;</span>)</span>
<span id="cb9-1248"><a href="#cb9-1248" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb9-1249"><a href="#cb9-1249" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.logger.warning(<span class="ss">f&quot;   ‚ùå Conversa </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: nenhuma mensagem extra√≠da&quot;</span>)</span>
<span id="cb9-1250"><a href="#cb9-1250" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1251"><a href="#cb9-1251" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Qwen3: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb9-1252"><a href="#cb9-1252" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1253"><a href="#cb9-1253" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb9-1254"><a href="#cb9-1254" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar Qwen3: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1255"><a href="#cb9-1255" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(traceback.format_exc())</span>
<span id="cb9-1256"><a href="#cb9-1256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1257"><a href="#cb9-1257" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _extract_qwen_messages_corrected(<span class="va">self</span>, conv: Dict[<span class="bu">str</span>, Any], clean_title: <span class="bu">str</span>, conv_index: <span class="bu">int</span>) <span class="op">-&gt;</span> List[Dict[<span class="bu">str</span>, Any]]:</span>
<span id="cb9-1258"><a href="#cb9-1258" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Extrai mensagens do Qwen com corre√ß√£o para content_list&quot;&quot;&quot;</span></span>
<span id="cb9-1259"><a href="#cb9-1259" aria-hidden="true" tabindex="-1"></a>        all_messages <span class="op">=</span> []</span>
<span id="cb9-1260"><a href="#cb9-1260" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1261"><a href="#cb9-1261" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ESTRAT√âGIA PRINCIPAL: Buscar em toda a estrutura por mensagens</span></span>
<span id="cb9-1262"><a href="#cb9-1262" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> extract_from_object(obj, path<span class="op">=</span><span class="st">&quot;&quot;</span>):</span>
<span id="cb9-1263"><a href="#cb9-1263" aria-hidden="true" tabindex="-1"></a>            messages_found <span class="op">=</span> []</span>
<span id="cb9-1264"><a href="#cb9-1264" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1265"><a href="#cb9-1265" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(obj, <span class="bu">dict</span>):</span>
<span id="cb9-1266"><a href="#cb9-1266" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Verificar se √© uma mensagem com content_list (CASO CORRIGIDO)</span></span>
<span id="cb9-1267"><a href="#cb9-1267" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>._is_qwen_message_with_content(obj):</span>
<span id="cb9-1268"><a href="#cb9-1268" aria-hidden="true" tabindex="-1"></a>                    message <span class="op">=</span> <span class="va">self</span>._create_message_from_qwen_object(obj)</span>
<span id="cb9-1269"><a href="#cb9-1269" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> message:</span>
<span id="cb9-1270"><a href="#cb9-1270" aria-hidden="true" tabindex="-1"></a>                        messages_found.append(message)</span>
<span id="cb9-1271"><a href="#cb9-1271" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1272"><a href="#cb9-1272" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Buscar recursivamente</span></span>
<span id="cb9-1273"><a href="#cb9-1273" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> key, value <span class="kw">in</span> obj.items():</span>
<span id="cb9-1274"><a href="#cb9-1274" aria-hidden="true" tabindex="-1"></a>                    messages_found.extend(extract_from_object(value, <span class="ss">f&quot;</span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">&quot;</span>))</span>
<span id="cb9-1275"><a href="#cb9-1275" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1276"><a href="#cb9-1276" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(obj, <span class="bu">list</span>):</span>
<span id="cb9-1277"><a href="#cb9-1277" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> item <span class="kw">in</span> obj:</span>
<span id="cb9-1278"><a href="#cb9-1278" aria-hidden="true" tabindex="-1"></a>                    messages_found.extend(extract_from_object(item, path))</span>
<span id="cb9-1279"><a href="#cb9-1279" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1280"><a href="#cb9-1280" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> messages_found</span>
<span id="cb9-1281"><a href="#cb9-1281" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1282"><a href="#cb9-1282" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Aplicar extra√ß√£o recursiva</span></span>
<span id="cb9-1283"><a href="#cb9-1283" aria-hidden="true" tabindex="-1"></a>        all_messages <span class="op">=</span> extract_from_object(conv, <span class="st">&quot;root&quot;</span>)</span>
<span id="cb9-1284"><a href="#cb9-1284" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1285"><a href="#cb9-1285" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remover duplicatas</span></span>
<span id="cb9-1286"><a href="#cb9-1286" aria-hidden="true" tabindex="-1"></a>        unique_messages <span class="op">=</span> <span class="va">self</span>._remove_duplicate_messages(all_messages)</span>
<span id="cb9-1287"><a href="#cb9-1287" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1288"><a href="#cb9-1288" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(unique_messages) <span class="op">!=</span> <span class="bu">len</span>(all_messages):</span>
<span id="cb9-1289"><a href="#cb9-1289" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;         üîÑ Removidas </span><span class="sc">{</span><span class="bu">len</span>(all_messages) <span class="op">-</span> <span class="bu">len</span>(unique_messages)<span class="sc">}</span><span class="ss"> mensagens duplicadas&quot;</span>)</span>
<span id="cb9-1290"><a href="#cb9-1290" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1291"><a href="#cb9-1291" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> unique_messages</span>
<span id="cb9-1292"><a href="#cb9-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1293"><a href="#cb9-1293" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _is_qwen_message_with_content(<span class="va">self</span>, obj: Dict) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb9-1294"><a href="#cb9-1294" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Verifica se √© uma mensagem Qwen v√°lida (incluindo content_list)&quot;&quot;&quot;</span></span>
<span id="cb9-1295"><a href="#cb9-1295" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verificar campos b√°sicos de mensagem</span></span>
<span id="cb9-1296"><a href="#cb9-1296" aria-hidden="true" tabindex="-1"></a>        has_basic_structure <span class="op">=</span> (<span class="st">&#39;role&#39;</span> <span class="kw">in</span> obj <span class="kw">and</span> <span class="st">&#39;content&#39;</span> <span class="kw">in</span> obj)</span>
<span id="cb9-1297"><a href="#cb9-1297" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1298"><a href="#cb9-1298" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verificar se tem content_list (CORRE√á√ÉO DO PROBLEMA)</span></span>
<span id="cb9-1299"><a href="#cb9-1299" aria-hidden="true" tabindex="-1"></a>        has_content_list <span class="op">=</span> <span class="st">&#39;content_list&#39;</span> <span class="kw">in</span> obj <span class="kw">and</span> <span class="bu">isinstance</span>(obj[<span class="st">&#39;content_list&#39;</span>], <span class="bu">list</span>)</span>
<span id="cb9-1300"><a href="#cb9-1300" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1301"><a href="#cb9-1301" aria-hidden="true" tabindex="-1"></a>        <span class="co"># √â uma mensagem v√°lida se tiver estrutura b√°sica E (conte√∫do n√£o vazio OU content_list)</span></span>
<span id="cb9-1302"><a href="#cb9-1302" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (has_basic_structure <span class="kw">and</span> </span>
<span id="cb9-1303"><a href="#cb9-1303" aria-hidden="true" tabindex="-1"></a>                (obj.get(<span class="st">&#39;content&#39;</span>) <span class="kw">or</span> has_content_list) <span class="kw">and</span></span>
<span id="cb9-1304"><a href="#cb9-1304" aria-hidden="true" tabindex="-1"></a>                obj.get(<span class="st">&#39;role&#39;</span>) <span class="kw">in</span> [<span class="st">&#39;user&#39;</span>, <span class="st">&#39;assistant&#39;</span>])</span>
<span id="cb9-1305"><a href="#cb9-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1306"><a href="#cb9-1306" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _create_message_from_qwen_object(<span class="va">self</span>, obj: Dict) <span class="op">-&gt;</span> Optional[Dict[<span class="bu">str</span>, Any]]:</span>
<span id="cb9-1307"><a href="#cb9-1307" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Cria uma mensagem a partir de um objeto Qwen, priorizando content_list&quot;&quot;&quot;</span></span>
<span id="cb9-1308"><a href="#cb9-1308" aria-hidden="true" tabindex="-1"></a>        role <span class="op">=</span> obj.get(<span class="st">&#39;role&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb9-1309"><a href="#cb9-1309" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> obj.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb9-1310"><a href="#cb9-1310" aria-hidden="true" tabindex="-1"></a>        content_list <span class="op">=</span> obj.get(<span class="st">&#39;content_list&#39;</span>, [])</span>
<span id="cb9-1311"><a href="#cb9-1311" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1312"><a href="#cb9-1312" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> role:</span>
<span id="cb9-1313"><a href="#cb9-1313" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb9-1314"><a href="#cb9-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1315"><a href="#cb9-1315" aria-hidden="true" tabindex="-1"></a>        <span class="co"># CORRE√á√ÉO PRINCIPAL: Priorizar content_list quando content estiver vazio</span></span>
<span id="cb9-1316"><a href="#cb9-1316" aria-hidden="true" tabindex="-1"></a>        final_content <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb9-1317"><a href="#cb9-1317" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1318"><a href="#cb9-1318" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> content_list <span class="kw">and</span> <span class="bu">isinstance</span>(content_list, <span class="bu">list</span>):</span>
<span id="cb9-1319"><a href="#cb9-1319" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extrair conte√∫do de content_list</span></span>
<span id="cb9-1320"><a href="#cb9-1320" aria-hidden="true" tabindex="-1"></a>            content_parts <span class="op">=</span> []</span>
<span id="cb9-1321"><a href="#cb9-1321" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> content_item <span class="kw">in</span> content_list:</span>
<span id="cb9-1322"><a href="#cb9-1322" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">isinstance</span>(content_item, <span class="bu">dict</span>):</span>
<span id="cb9-1323"><a href="#cb9-1323" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Verificar diferentes estruturas de content_list</span></span>
<span id="cb9-1324"><a href="#cb9-1324" aria-hidden="true" tabindex="-1"></a>                    item_content <span class="op">=</span> content_item.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb9-1325"><a href="#cb9-1325" aria-hidden="true" tabindex="-1"></a>                    item_text <span class="op">=</span> content_item.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb9-1326"><a href="#cb9-1326" aria-hidden="true" tabindex="-1"></a>                    item_type <span class="op">=</span> content_item.get(<span class="st">&#39;type&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb9-1327"><a href="#cb9-1327" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1328"><a href="#cb9-1328" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> item_content:</span>
<span id="cb9-1329"><a href="#cb9-1329" aria-hidden="true" tabindex="-1"></a>                        content_parts.append(<span class="bu">str</span>(item_content))</span>
<span id="cb9-1330"><a href="#cb9-1330" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> item_text:</span>
<span id="cb9-1331"><a href="#cb9-1331" aria-hidden="true" tabindex="-1"></a>                        content_parts.append(<span class="bu">str</span>(item_text))</span>
<span id="cb9-1332"><a href="#cb9-1332" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> item_type <span class="op">==</span> <span class="st">&#39;text&#39;</span> <span class="kw">and</span> <span class="st">&#39;text&#39;</span> <span class="kw">in</span> content_item:</span>
<span id="cb9-1333"><a href="#cb9-1333" aria-hidden="true" tabindex="-1"></a>                        content_parts.append(<span class="bu">str</span>(content_item[<span class="st">&#39;text&#39;</span>]))</span>
<span id="cb9-1334"><a href="#cb9-1334" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1335"><a href="#cb9-1335" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> content_parts:</span>
<span id="cb9-1336"><a href="#cb9-1336" aria-hidden="true" tabindex="-1"></a>                final_content <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>.join(content_parts).strip()</span>
<span id="cb9-1337"><a href="#cb9-1337" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1338"><a href="#cb9-1338" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se content_list n√£o forneceu conte√∫do, usar o campo content tradicional</span></span>
<span id="cb9-1339"><a href="#cb9-1339" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> final_content <span class="kw">and</span> content:</span>
<span id="cb9-1340"><a href="#cb9-1340" aria-hidden="true" tabindex="-1"></a>            final_content <span class="op">=</span> <span class="bu">str</span>(content).strip()</span>
<span id="cb9-1341"><a href="#cb9-1341" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1342"><a href="#cb9-1342" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se ainda n√£o tem conte√∫do, pular</span></span>
<span id="cb9-1343"><a href="#cb9-1343" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> final_content <span class="kw">or</span> final_content <span class="op">==</span> <span class="st">&#39;null&#39;</span>:</span>
<span id="cb9-1344"><a href="#cb9-1344" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb9-1345"><a href="#cb9-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1346"><a href="#cb9-1346" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Determinar autor</span></span>
<span id="cb9-1347"><a href="#cb9-1347" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> role <span class="op">==</span> <span class="st">&#39;user&#39;</span>:</span>
<span id="cb9-1348"><a href="#cb9-1348" aria-hidden="true" tabindex="-1"></a>            author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb9-1349"><a href="#cb9-1349" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> role <span class="op">==</span> <span class="st">&#39;assistant&#39;</span>:</span>
<span id="cb9-1350"><a href="#cb9-1350" aria-hidden="true" tabindex="-1"></a>            author <span class="op">=</span> <span class="st">&quot;ü§ñ Qwen3&quot;</span></span>
<span id="cb9-1351"><a href="#cb9-1351" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb9-1352"><a href="#cb9-1352" aria-hidden="true" tabindex="-1"></a>            author <span class="op">=</span> <span class="ss">f&quot;üîπ </span><span class="sc">{</span>role<span class="sc">.</span>title()<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb9-1353"><a href="#cb9-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1354"><a href="#cb9-1354" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Processar conte√∫do especial</span></span>
<span id="cb9-1355"><a href="#cb9-1355" aria-hidden="true" tabindex="-1"></a>        final_content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(final_content)</span>
<span id="cb9-1356"><a href="#cb9-1356" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1357"><a href="#cb9-1357" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb9-1358"><a href="#cb9-1358" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb9-1359"><a href="#cb9-1359" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb9-1360"><a href="#cb9-1360" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;content&#39;</span>: final_content,</span>
<span id="cb9-1361"><a href="#cb9-1361" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(obj.get(<span class="st">&#39;created_at&#39;</span>)),</span>
<span id="cb9-1362"><a href="#cb9-1362" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;model&#39;</span>: obj.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;Qwen3&#39;</span>)</span>
<span id="cb9-1363"><a href="#cb9-1363" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-1364"><a href="#cb9-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1365"><a href="#cb9-1365" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _remove_duplicate_messages(<span class="va">self</span>, messages: List[Dict[<span class="bu">str</span>, Any]]) <span class="op">-&gt;</span> List[Dict[<span class="bu">str</span>, Any]]:</span>
<span id="cb9-1366"><a href="#cb9-1366" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Remove mensagens duplicadas baseadas no conte√∫do&quot;&quot;&quot;</span></span>
<span id="cb9-1367"><a href="#cb9-1367" aria-hidden="true" tabindex="-1"></a>        seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb9-1368"><a href="#cb9-1368" aria-hidden="true" tabindex="-1"></a>        unique_messages <span class="op">=</span> []</span>
<span id="cb9-1369"><a href="#cb9-1369" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1370"><a href="#cb9-1370" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> msg <span class="kw">in</span> messages:</span>
<span id="cb9-1371"><a href="#cb9-1371" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Criar uma chave √∫nica baseada no conte√∫do e timestamp</span></span>
<span id="cb9-1372"><a href="#cb9-1372" aria-hidden="true" tabindex="-1"></a>            content_key <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>msg[<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>msg[<span class="st">&#39;timestamp&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb9-1373"><a href="#cb9-1373" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1374"><a href="#cb9-1374" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> content_key <span class="kw">not</span> <span class="kw">in</span> seen:</span>
<span id="cb9-1375"><a href="#cb9-1375" aria-hidden="true" tabindex="-1"></a>                seen.add(content_key)</span>
<span id="cb9-1376"><a href="#cb9-1376" aria-hidden="true" tabindex="-1"></a>                unique_messages.append(msg)</span>
<span id="cb9-1377"><a href="#cb9-1377" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1378"><a href="#cb9-1378" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> unique_messages</span>
<span id="cb9-1379"><a href="#cb9-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1380"><a href="#cb9-1380" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_chatgpt(<span class="va">self</span>, path: Path):</span>
<span id="cb9-1381"><a href="#cb9-1381" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do ChatGPT&quot;&quot;&quot;</span></span>
<span id="cb9-1382"><a href="#cb9-1382" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb9-1383"><a href="#cb9-1383" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria ChatGPT: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1384"><a href="#cb9-1384" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb9-1385"><a href="#cb9-1385" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1386"><a href="#cb9-1386" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-1387"><a href="#cb9-1387" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;chatgpt_&quot;</span>)</span>
<span id="cb9-1388"><a href="#cb9-1388" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb9-1389"><a href="#cb9-1389" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb9-1390"><a href="#cb9-1390" aria-hidden="true" tabindex="-1"></a>            convs_path <span class="op">=</span> Path(temp_dir) <span class="op">/</span> <span class="st">&quot;conversations.json&quot;</span></span>
<span id="cb9-1391"><a href="#cb9-1391" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> convs_path.exists():</span>
<span id="cb9-1392"><a href="#cb9-1392" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå ChatGPT: conversations.json n√£o encontrado.&quot;</span>)</span>
<span id="cb9-1393"><a href="#cb9-1393" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb9-1394"><a href="#cb9-1394" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1395"><a href="#cb9-1395" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(convs_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb9-1396"><a href="#cb9-1396" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.load(f)</span>
<span id="cb9-1397"><a href="#cb9-1397" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1398"><a href="#cb9-1398" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">list</span>):</span>
<span id="cb9-1399"><a href="#cb9-1399" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  ChatGPT: estrutura inesperada.&quot;</span>)</span>
<span id="cb9-1400"><a href="#cb9-1400" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb9-1401"><a href="#cb9-1401" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1402"><a href="#cb9-1402" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç ChatGPT: encontradas </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb9-1403"><a href="#cb9-1403" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-1404"><a href="#cb9-1404" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1405"><a href="#cb9-1405" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb9-1406"><a href="#cb9-1406" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa ChatGPT </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb9-1407"><a href="#cb9-1407" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb9-1408"><a href="#cb9-1408" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb9-1409"><a href="#cb9-1409" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1410"><a href="#cb9-1410" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb9-1411"><a href="#cb9-1411" aria-hidden="true" tabindex="-1"></a>                mapping <span class="op">=</span> conv.get(<span class="st">&#39;mapping&#39;</span>, {})</span>
<span id="cb9-1412"><a href="#cb9-1412" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1413"><a href="#cb9-1413" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> msg_id, node <span class="kw">in</span> mapping.items():</span>
<span id="cb9-1414"><a href="#cb9-1414" aria-hidden="true" tabindex="-1"></a>                    msg_data <span class="op">=</span> node.get(<span class="st">&#39;message&#39;</span>)</span>
<span id="cb9-1415"><a href="#cb9-1415" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> msg_data <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(msg_data, <span class="bu">dict</span>):</span>
<span id="cb9-1416"><a href="#cb9-1416" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb9-1417"><a href="#cb9-1417" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb9-1418"><a href="#cb9-1418" aria-hidden="true" tabindex="-1"></a>                    author_role <span class="op">=</span> msg_data.get(<span class="st">&#39;author&#39;</span>, {}).get(<span class="st">&#39;role&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb9-1419"><a href="#cb9-1419" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> author_role <span class="op">==</span> <span class="st">&#39;user&#39;</span>:</span>
<span id="cb9-1420"><a href="#cb9-1420" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb9-1421"><a href="#cb9-1421" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;user&#39;</span></span>
<span id="cb9-1422"><a href="#cb9-1422" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> author_role <span class="op">==</span> <span class="st">&#39;assistant&#39;</span>:</span>
<span id="cb9-1423"><a href="#cb9-1423" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ ChatGPT&quot;</span></span>
<span id="cb9-1424"><a href="#cb9-1424" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;assistant&#39;</span></span>
<span id="cb9-1425"><a href="#cb9-1425" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb9-1426"><a href="#cb9-1426" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb9-1427"><a href="#cb9-1427" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb9-1428"><a href="#cb9-1428" aria-hidden="true" tabindex="-1"></a>                    content_parts <span class="op">=</span> []</span>
<span id="cb9-1429"><a href="#cb9-1429" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> part <span class="kw">in</span> msg_data.get(<span class="st">&#39;content&#39;</span>, {}).get(<span class="st">&#39;parts&#39;</span>, []):</span>
<span id="cb9-1430"><a href="#cb9-1430" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(part, <span class="bu">str</span>):</span>
<span id="cb9-1431"><a href="#cb9-1431" aria-hidden="true" tabindex="-1"></a>                            content_parts.append(part)</span>
<span id="cb9-1432"><a href="#cb9-1432" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(content_parts).strip()</span>
<span id="cb9-1433"><a href="#cb9-1433" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1434"><a href="#cb9-1434" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb9-1435"><a href="#cb9-1435" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1436"><a href="#cb9-1436" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb9-1437"><a href="#cb9-1437" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb9-1438"><a href="#cb9-1438" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb9-1439"><a href="#cb9-1439" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb9-1440"><a href="#cb9-1440" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb9-1441"><a href="#cb9-1441" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb9-1442"><a href="#cb9-1442" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb9-1443"><a href="#cb9-1443" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(msg_data.get(<span class="st">&#39;create_time&#39;</span>)),</span>
<span id="cb9-1444"><a href="#cb9-1444" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg_data.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;ChatGPT&#39;</span>)</span>
<span id="cb9-1445"><a href="#cb9-1445" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb9-1446"><a href="#cb9-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1447"><a href="#cb9-1447" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb9-1448"><a href="#cb9-1448" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb9-1449"><a href="#cb9-1449" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb9-1450"><a href="#cb9-1450" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;ChatGPT&#39;</span>,</span>
<span id="cb9-1451"><a href="#cb9-1451" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;chatgpt_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb9-1452"><a href="#cb9-1452" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;create_time&#39;</span>)),</span>
<span id="cb9-1453"><a href="#cb9-1453" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;update_time&#39;</span>)),</span>
<span id="cb9-1454"><a href="#cb9-1454" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb9-1455"><a href="#cb9-1455" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb9-1456"><a href="#cb9-1456" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb9-1457"><a href="#cb9-1457" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb9-1458"><a href="#cb9-1458" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-1459"><a href="#cb9-1459" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1460"><a href="#cb9-1460" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ ChatGPT: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb9-1461"><a href="#cb9-1461" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1462"><a href="#cb9-1462" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb9-1463"><a href="#cb9-1463" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar ChatGPT: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1464"><a href="#cb9-1464" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb9-1465"><a href="#cb9-1465" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb9-1466"><a href="#cb9-1466" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb9-1467"><a href="#cb9-1467" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb9-1468"><a href="#cb9-1468" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-1469"><a href="#cb9-1469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1470"><a href="#cb9-1470" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_deepseek(<span class="va">self</span>, path: Path):</span>
<span id="cb9-1471"><a href="#cb9-1471" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do DeepSeek&quot;&quot;&quot;</span></span>
<span id="cb9-1472"><a href="#cb9-1472" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb9-1473"><a href="#cb9-1473" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria DeepSeek: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1474"><a href="#cb9-1474" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb9-1475"><a href="#cb9-1475" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1476"><a href="#cb9-1476" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-1477"><a href="#cb9-1477" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;deepseek_&quot;</span>)</span>
<span id="cb9-1478"><a href="#cb9-1478" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb9-1479"><a href="#cb9-1479" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb9-1480"><a href="#cb9-1480" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1481"><a href="#cb9-1481" aria-hidden="true" tabindex="-1"></a>            convs_path <span class="op">=</span> Path(temp_dir) <span class="op">/</span> <span class="st">&quot;conversations.json&quot;</span></span>
<span id="cb9-1482"><a href="#cb9-1482" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> convs_path.exists():</span>
<span id="cb9-1483"><a href="#cb9-1483" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå DeepSeek: conversations.json n√£o encontrado.&quot;</span>)</span>
<span id="cb9-1484"><a href="#cb9-1484" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb9-1485"><a href="#cb9-1485" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1486"><a href="#cb9-1486" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(convs_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb9-1487"><a href="#cb9-1487" aria-hidden="true" tabindex="-1"></a>                raw_data <span class="op">=</span> json.load(f)</span>
<span id="cb9-1488"><a href="#cb9-1488" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1489"><a href="#cb9-1489" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">list</span>):</span>
<span id="cb9-1490"><a href="#cb9-1490" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> raw_data</span>
<span id="cb9-1491"><a href="#cb9-1491" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(raw_data, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;data&#39;</span> <span class="kw">in</span> raw_data:</span>
<span id="cb9-1492"><a href="#cb9-1492" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> raw_data[<span class="st">&#39;data&#39;</span>]</span>
<span id="cb9-1493"><a href="#cb9-1493" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb9-1494"><a href="#cb9-1494" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  DeepSeek: estrutura inesperada.&quot;</span>)</span>
<span id="cb9-1495"><a href="#cb9-1495" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb9-1496"><a href="#cb9-1496" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1497"><a href="#cb9-1497" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">list</span>):</span>
<span id="cb9-1498"><a href="#cb9-1498" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.warning(<span class="st">&quot;‚ö†Ô∏è  DeepSeek: &#39;data&#39; n√£o √© uma lista.&quot;</span>)</span>
<span id="cb9-1499"><a href="#cb9-1499" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb9-1500"><a href="#cb9-1500" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1501"><a href="#cb9-1501" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç DeepSeek: encontradas </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb9-1502"><a href="#cb9-1502" aria-hidden="true" tabindex="-1"></a>            processed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-1503"><a href="#cb9-1503" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1504"><a href="#cb9-1504" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb9-1505"><a href="#cb9-1505" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&#39;Conversa DeepSeek </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb9-1506"><a href="#cb9-1506" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb9-1507"><a href="#cb9-1507" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb9-1508"><a href="#cb9-1508" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1509"><a href="#cb9-1509" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb9-1510"><a href="#cb9-1510" aria-hidden="true" tabindex="-1"></a>                mapping <span class="op">=</span> conv.get(<span class="st">&#39;mapping&#39;</span>, {})</span>
<span id="cb9-1511"><a href="#cb9-1511" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1512"><a href="#cb9-1512" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> node_id, node <span class="kw">in</span> mapping.items():</span>
<span id="cb9-1513"><a href="#cb9-1513" aria-hidden="true" tabindex="-1"></a>                    msg_data <span class="op">=</span> node.get(<span class="st">&#39;message&#39;</span>)</span>
<span id="cb9-1514"><a href="#cb9-1514" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> msg_data <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(msg_data, <span class="bu">dict</span>):</span>
<span id="cb9-1515"><a href="#cb9-1515" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb9-1516"><a href="#cb9-1516" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb9-1517"><a href="#cb9-1517" aria-hidden="true" tabindex="-1"></a>                    fragments <span class="op">=</span> msg_data.get(<span class="st">&#39;fragments&#39;</span>, [])</span>
<span id="cb9-1518"><a href="#cb9-1518" aria-hidden="true" tabindex="-1"></a>                    content_parts <span class="op">=</span> []</span>
<span id="cb9-1519"><a href="#cb9-1519" aria-hidden="true" tabindex="-1"></a>                    msg_type <span class="op">=</span> <span class="va">None</span></span>
<span id="cb9-1520"><a href="#cb9-1520" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1521"><a href="#cb9-1521" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> frag <span class="kw">in</span> fragments:</span>
<span id="cb9-1522"><a href="#cb9-1522" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(frag, <span class="bu">dict</span>):</span>
<span id="cb9-1523"><a href="#cb9-1523" aria-hidden="true" tabindex="-1"></a>                            frag_type <span class="op">=</span> frag.get(<span class="st">&#39;type&#39;</span>, <span class="st">&#39;&#39;</span>).upper()</span>
<span id="cb9-1524"><a href="#cb9-1524" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> frag_type <span class="kw">in</span> (<span class="st">&#39;REQUEST&#39;</span>, <span class="st">&#39;RESPONSE&#39;</span>):</span>
<span id="cb9-1525"><a href="#cb9-1525" aria-hidden="true" tabindex="-1"></a>                                msg_type <span class="op">=</span> frag_type</span>
<span id="cb9-1526"><a href="#cb9-1526" aria-hidden="true" tabindex="-1"></a>                            text <span class="op">=</span> frag.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb9-1527"><a href="#cb9-1527" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> text:</span>
<span id="cb9-1528"><a href="#cb9-1528" aria-hidden="true" tabindex="-1"></a>                                content_parts.append(text)</span>
<span id="cb9-1529"><a href="#cb9-1529" aria-hidden="true" tabindex="-1"></a>                            content <span class="op">=</span> frag.get(<span class="st">&#39;content&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb9-1530"><a href="#cb9-1530" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> content:</span>
<span id="cb9-1531"><a href="#cb9-1531" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> <span class="bu">isinstance</span>(content, <span class="bu">list</span>):</span>
<span id="cb9-1532"><a href="#cb9-1532" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">for</span> item <span class="kw">in</span> content:</span>
<span id="cb9-1533"><a href="#cb9-1533" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">if</span> <span class="bu">isinstance</span>(item, <span class="bu">str</span>):</span>
<span id="cb9-1534"><a href="#cb9-1534" aria-hidden="true" tabindex="-1"></a>                                            content_parts.append(item)</span>
<span id="cb9-1535"><a href="#cb9-1535" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">elif</span> <span class="bu">isinstance</span>(item, <span class="bu">dict</span>):</span>
<span id="cb9-1536"><a href="#cb9-1536" aria-hidden="true" tabindex="-1"></a>                                            item_text <span class="op">=</span> item.get(<span class="st">&#39;text&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb9-1537"><a href="#cb9-1537" aria-hidden="true" tabindex="-1"></a>                                            <span class="cf">if</span> item_text:</span>
<span id="cb9-1538"><a href="#cb9-1538" aria-hidden="true" tabindex="-1"></a>                                                content_parts.append(<span class="bu">str</span>(item_text))</span>
<span id="cb9-1539"><a href="#cb9-1539" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">else</span>:</span>
<span id="cb9-1540"><a href="#cb9-1540" aria-hidden="true" tabindex="-1"></a>                                    content_parts.append(<span class="bu">str</span>(content))</span>
<span id="cb9-1541"><a href="#cb9-1541" aria-hidden="true" tabindex="-1"></a>                                    </span>
<span id="cb9-1542"><a href="#cb9-1542" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="st">&#39; &#39;</span>.join(content_parts).strip()</span>
<span id="cb9-1543"><a href="#cb9-1543" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1544"><a href="#cb9-1544" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb9-1545"><a href="#cb9-1545" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1546"><a href="#cb9-1546" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb9-1547"><a href="#cb9-1547" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb9-1548"><a href="#cb9-1548" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb9-1549"><a href="#cb9-1549" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> msg_type <span class="op">==</span> <span class="st">&#39;REQUEST&#39;</span>:</span>
<span id="cb9-1550"><a href="#cb9-1550" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb9-1551"><a href="#cb9-1551" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;user&#39;</span></span>
<span id="cb9-1552"><a href="#cb9-1552" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb9-1553"><a href="#cb9-1553" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ DeepSeek&quot;</span></span>
<span id="cb9-1554"><a href="#cb9-1554" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&#39;assistant&#39;</span></span>
<span id="cb9-1555"><a href="#cb9-1555" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb9-1556"><a href="#cb9-1556" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb9-1557"><a href="#cb9-1557" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb9-1558"><a href="#cb9-1558" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb9-1559"><a href="#cb9-1559" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb9-1560"><a href="#cb9-1560" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(msg_data.get(<span class="st">&#39;inserted_at&#39;</span>)),</span>
<span id="cb9-1561"><a href="#cb9-1561" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg_data.get(<span class="st">&#39;model&#39;</span>, <span class="st">&#39;DeepSeek&#39;</span>)</span>
<span id="cb9-1562"><a href="#cb9-1562" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb9-1563"><a href="#cb9-1563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1564"><a href="#cb9-1564" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb9-1565"><a href="#cb9-1565" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb9-1566"><a href="#cb9-1566" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb9-1567"><a href="#cb9-1567" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;DeepSeek&#39;</span>,</span>
<span id="cb9-1568"><a href="#cb9-1568" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv.get(<span class="st">&#39;id&#39;</span>, <span class="ss">f&#39;deepseek_</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">&#39;</span>),</span>
<span id="cb9-1569"><a href="#cb9-1569" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;inserted_at&#39;</span>)),</span>
<span id="cb9-1570"><a href="#cb9-1570" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: <span class="va">self</span>.format_timestamp(conv.get(<span class="st">&#39;updated_at&#39;</span>)),</span>
<span id="cb9-1571"><a href="#cb9-1571" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb9-1572"><a href="#cb9-1572" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb9-1573"><a href="#cb9-1573" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb9-1574"><a href="#cb9-1574" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb9-1575"><a href="#cb9-1575" aria-hidden="true" tabindex="-1"></a>                    processed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-1576"><a href="#cb9-1576" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1577"><a href="#cb9-1577" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ DeepSeek: </span><span class="sc">{</span>processed_count<span class="sc">}</span><span class="ss"> conversas processadas.&quot;</span>)</span>
<span id="cb9-1578"><a href="#cb9-1578" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1579"><a href="#cb9-1579" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb9-1580"><a href="#cb9-1580" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar DeepSeek: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1581"><a href="#cb9-1581" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb9-1582"><a href="#cb9-1582" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb9-1583"><a href="#cb9-1583" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb9-1584"><a href="#cb9-1584" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb9-1585"><a href="#cb9-1585" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-1586"><a href="#cb9-1586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1587"><a href="#cb9-1587" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_grok(<span class="va">self</span>, path: Path):</span>
<span id="cb9-1588"><a href="#cb9-1588" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Processa exporta√ß√£o do Grok&quot;&quot;&quot;</span></span>
<span id="cb9-1589"><a href="#cb9-1589" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb9-1590"><a href="#cb9-1590" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] Processaria Grok: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1591"><a href="#cb9-1591" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb9-1592"><a href="#cb9-1592" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1593"><a href="#cb9-1593" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-1594"><a href="#cb9-1594" aria-hidden="true" tabindex="-1"></a>            temp_dir <span class="op">=</span> tempfile.mkdtemp(prefix<span class="op">=</span><span class="st">&quot;grok_&quot;</span>)</span>
<span id="cb9-1595"><a href="#cb9-1595" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> zipfile.ZipFile(path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> z:</span>
<span id="cb9-1596"><a href="#cb9-1596" aria-hidden="true" tabindex="-1"></a>                z.extractall(temp_dir)</span>
<span id="cb9-1597"><a href="#cb9-1597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1598"><a href="#cb9-1598" aria-hidden="true" tabindex="-1"></a>            target_file <span class="op">=</span> <span class="va">None</span></span>
<span id="cb9-1599"><a href="#cb9-1599" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> root, _, files <span class="kw">in</span> os.walk(temp_dir):</span>
<span id="cb9-1600"><a href="#cb9-1600" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb9-1601"><a href="#cb9-1601" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">file</span> <span class="op">==</span> <span class="st">&quot;prod-grok-backend.json&quot;</span>:</span>
<span id="cb9-1602"><a href="#cb9-1602" aria-hidden="true" tabindex="-1"></a>                        target_file <span class="op">=</span> Path(root) <span class="op">/</span> <span class="bu">file</span></span>
<span id="cb9-1603"><a href="#cb9-1603" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb9-1604"><a href="#cb9-1604" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> target_file:</span>
<span id="cb9-1605"><a href="#cb9-1605" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb9-1606"><a href="#cb9-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1607"><a href="#cb9-1607" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> target_file:</span>
<span id="cb9-1608"><a href="#cb9-1608" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: ficheiro &#39;prod-grok-backend.json&#39; n√£o encontrado no ZIP.&quot;</span>)</span>
<span id="cb9-1609"><a href="#cb9-1609" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb9-1610"><a href="#cb9-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1611"><a href="#cb9-1611" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîç Grok: carregando </span><span class="sc">{</span>target_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb9-1612"><a href="#cb9-1612" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(target_file, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb9-1613"><a href="#cb9-1613" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.load(f)</span>
<span id="cb9-1614"><a href="#cb9-1614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1615"><a href="#cb9-1615" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(data, <span class="bu">dict</span>) <span class="kw">or</span> <span class="st">&#39;conversations&#39;</span> <span class="kw">not</span> <span class="kw">in</span> data:</span>
<span id="cb9-1616"><a href="#cb9-1616" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: estrutura inesperada ‚Äî chave &#39;conversations&#39; n√£o encontrada.&quot;</span>)</span>
<span id="cb9-1617"><a href="#cb9-1617" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb9-1618"><a href="#cb9-1618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1619"><a href="#cb9-1619" aria-hidden="true" tabindex="-1"></a>            conversations_list <span class="op">=</span> data[<span class="st">&#39;conversations&#39;</span>]</span>
<span id="cb9-1620"><a href="#cb9-1620" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conversations_list, <span class="bu">list</span>):</span>
<span id="cb9-1621"><a href="#cb9-1621" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: &#39;conversations&#39; n√£o √© uma lista.&quot;</span>)</span>
<span id="cb9-1622"><a href="#cb9-1622" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb9-1623"><a href="#cb9-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1624"><a href="#cb9-1624" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üìä Grok: encontradas </span><span class="sc">{</span><span class="bu">len</span>(conversations_list)<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb9-1625"><a href="#cb9-1625" aria-hidden="true" tabindex="-1"></a>            total_convs <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-1626"><a href="#cb9-1626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1627"><a href="#cb9-1627" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> item <span class="kw">in</span> conversations_list:</span>
<span id="cb9-1628"><a href="#cb9-1628" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(item, <span class="bu">dict</span>):</span>
<span id="cb9-1629"><a href="#cb9-1629" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb9-1630"><a href="#cb9-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1631"><a href="#cb9-1631" aria-hidden="true" tabindex="-1"></a>                conv_meta <span class="op">=</span> item.get(<span class="st">&#39;conversation&#39;</span>)</span>
<span id="cb9-1632"><a href="#cb9-1632" aria-hidden="true" tabindex="-1"></a>                responses <span class="op">=</span> item.get(<span class="st">&#39;responses&#39;</span>, [])</span>
<span id="cb9-1633"><a href="#cb9-1633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1634"><a href="#cb9-1634" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(conv_meta, <span class="bu">dict</span>) <span class="kw">or</span> <span class="kw">not</span> <span class="bu">isinstance</span>(responses, <span class="bu">list</span>) <span class="kw">or</span> <span class="kw">not</span> responses:</span>
<span id="cb9-1635"><a href="#cb9-1635" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb9-1636"><a href="#cb9-1636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1637"><a href="#cb9-1637" aria-hidden="true" tabindex="-1"></a>                conv_id <span class="op">=</span> conv_meta.get(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb9-1638"><a href="#cb9-1638" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> conv_id:</span>
<span id="cb9-1639"><a href="#cb9-1639" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb9-1640"><a href="#cb9-1640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1641"><a href="#cb9-1641" aria-hidden="true" tabindex="-1"></a>                original_title <span class="op">=</span> conv_meta.get(<span class="st">&#39;title&#39;</span>, <span class="ss">f&quot;Conversa Grok </span><span class="sc">{</span>total_convs <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1642"><a href="#cb9-1642" aria-hidden="true" tabindex="-1"></a>                <span class="co"># PRESERVA t√≠tulo original com espa√ßos</span></span>
<span id="cb9-1643"><a href="#cb9-1643" aria-hidden="true" tabindex="-1"></a>                clean_title <span class="op">=</span> <span class="va">self</span>.preserve_original_title(original_title)</span>
<span id="cb9-1644"><a href="#cb9-1644" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1645"><a href="#cb9-1645" aria-hidden="true" tabindex="-1"></a>                create_time_str <span class="op">=</span> conv_meta.get(<span class="st">&#39;create_time&#39;</span>)</span>
<span id="cb9-1646"><a href="#cb9-1646" aria-hidden="true" tabindex="-1"></a>                modify_time_str <span class="op">=</span> conv_meta.get(<span class="st">&#39;modify_time&#39;</span>)</span>
<span id="cb9-1647"><a href="#cb9-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1648"><a href="#cb9-1648" aria-hidden="true" tabindex="-1"></a>                <span class="kw">def</span> format_iso_timestamp(ts_str):</span>
<span id="cb9-1649"><a href="#cb9-1649" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> ts_str:</span>
<span id="cb9-1650"><a href="#cb9-1650" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb9-1651"><a href="#cb9-1651" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">try</span>:</span>
<span id="cb9-1652"><a href="#cb9-1652" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="st">&#39;.&#39;</span> <span class="kw">in</span> ts_str:</span>
<span id="cb9-1653"><a href="#cb9-1653" aria-hidden="true" tabindex="-1"></a>                            ts_str <span class="op">=</span> ts_str.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>] <span class="op">+</span> <span class="st">&#39;Z&#39;</span></span>
<span id="cb9-1654"><a href="#cb9-1654" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="va">self</span>.format_timestamp(ts_str)</span>
<span id="cb9-1655"><a href="#cb9-1655" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">except</span>:</span>
<span id="cb9-1656"><a href="#cb9-1656" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="bu">str</span>(ts_str)</span>
<span id="cb9-1657"><a href="#cb9-1657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1658"><a href="#cb9-1658" aria-hidden="true" tabindex="-1"></a>                inserted_at <span class="op">=</span> format_iso_timestamp(create_time_str)</span>
<span id="cb9-1659"><a href="#cb9-1659" aria-hidden="true" tabindex="-1"></a>                updated_at <span class="op">=</span> format_iso_timestamp(modify_time_str)</span>
<span id="cb9-1660"><a href="#cb9-1660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1661"><a href="#cb9-1661" aria-hidden="true" tabindex="-1"></a>                messages <span class="op">=</span> []</span>
<span id="cb9-1662"><a href="#cb9-1662" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> resp <span class="kw">in</span> responses:</span>
<span id="cb9-1663"><a href="#cb9-1663" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(resp, <span class="bu">dict</span>):</span>
<span id="cb9-1664"><a href="#cb9-1664" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb9-1665"><a href="#cb9-1665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1666"><a href="#cb9-1666" aria-hidden="true" tabindex="-1"></a>                    resp_data <span class="op">=</span> resp.get(<span class="st">&#39;response&#39;</span>)</span>
<span id="cb9-1667"><a href="#cb9-1667" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(resp_data, <span class="bu">dict</span>):</span>
<span id="cb9-1668"><a href="#cb9-1668" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb9-1669"><a href="#cb9-1669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1670"><a href="#cb9-1670" aria-hidden="true" tabindex="-1"></a>                    sender <span class="op">=</span> resp_data.get(<span class="st">&#39;sender&#39;</span>, <span class="st">&#39;&#39;</span>).upper()</span>
<span id="cb9-1671"><a href="#cb9-1671" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> sender <span class="op">==</span> <span class="st">&#39;HUMAN&#39;</span>:</span>
<span id="cb9-1672"><a href="#cb9-1672" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;üë§ Utilizador&quot;</span></span>
<span id="cb9-1673"><a href="#cb9-1673" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&quot;user&quot;</span></span>
<span id="cb9-1674"><a href="#cb9-1674" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> sender <span class="op">==</span> <span class="st">&#39;ASSISTANT&#39;</span>:</span>
<span id="cb9-1675"><a href="#cb9-1675" aria-hidden="true" tabindex="-1"></a>                        author <span class="op">=</span> <span class="st">&quot;ü§ñ Grok&quot;</span></span>
<span id="cb9-1676"><a href="#cb9-1676" aria-hidden="true" tabindex="-1"></a>                        role <span class="op">=</span> <span class="st">&quot;assistant&quot;</span></span>
<span id="cb9-1677"><a href="#cb9-1677" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb9-1678"><a href="#cb9-1678" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb9-1679"><a href="#cb9-1679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1680"><a href="#cb9-1680" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="bu">str</span>(resp_data.get(<span class="st">&#39;message&#39;</span>, <span class="st">&#39;&#39;</span>)).strip()</span>
<span id="cb9-1681"><a href="#cb9-1681" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1682"><a href="#cb9-1682" aria-hidden="true" tabindex="-1"></a>                    content <span class="op">=</span> <span class="va">self</span>.preserve_special_content(content)</span>
<span id="cb9-1683"><a href="#cb9-1683" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1684"><a href="#cb9-1684" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> content:</span>
<span id="cb9-1685"><a href="#cb9-1685" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb9-1686"><a href="#cb9-1686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1687"><a href="#cb9-1687" aria-hidden="true" tabindex="-1"></a>                    create_time <span class="op">=</span> resp_data.get(<span class="st">&#39;create_time&#39;</span>)</span>
<span id="cb9-1688"><a href="#cb9-1688" aria-hidden="true" tabindex="-1"></a>                    timestamp_ms <span class="op">=</span> <span class="va">None</span></span>
<span id="cb9-1689"><a href="#cb9-1689" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(create_time, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;$date&#39;</span> <span class="kw">in</span> create_time:</span>
<span id="cb9-1690"><a href="#cb9-1690" aria-hidden="true" tabindex="-1"></a>                        date_obj <span class="op">=</span> create_time[<span class="st">&#39;$date&#39;</span>]</span>
<span id="cb9-1691"><a href="#cb9-1691" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(date_obj, <span class="bu">dict</span>) <span class="kw">and</span> <span class="st">&#39;$numberLong&#39;</span> <span class="kw">in</span> date_obj:</span>
<span id="cb9-1692"><a href="#cb9-1692" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">try</span>:</span>
<span id="cb9-1693"><a href="#cb9-1693" aria-hidden="true" tabindex="-1"></a>                                timestamp_ms <span class="op">=</span> <span class="bu">int</span>(date_obj[<span class="st">&#39;$numberLong&#39;</span>])</span>
<span id="cb9-1694"><a href="#cb9-1694" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">except</span>:</span>
<span id="cb9-1695"><a href="#cb9-1695" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">pass</span></span>
<span id="cb9-1696"><a href="#cb9-1696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1697"><a href="#cb9-1697" aria-hidden="true" tabindex="-1"></a>                    messages.append({</span>
<span id="cb9-1698"><a href="#cb9-1698" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: author,</span>
<span id="cb9-1699"><a href="#cb9-1699" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: role,</span>
<span id="cb9-1700"><a href="#cb9-1700" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: content,</span>
<span id="cb9-1701"><a href="#cb9-1701" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: <span class="va">self</span>.format_timestamp(timestamp_ms <span class="op">/</span> <span class="fl">1000.0</span> <span class="cf">if</span> timestamp_ms <span class="cf">else</span> <span class="va">None</span>),</span>
<span id="cb9-1702"><a href="#cb9-1702" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: <span class="st">&#39;Grok&#39;</span></span>
<span id="cb9-1703"><a href="#cb9-1703" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb9-1704"><a href="#cb9-1704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1705"><a href="#cb9-1705" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> messages:</span>
<span id="cb9-1706"><a href="#cb9-1706" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.all_conversations.append({</span>
<span id="cb9-1707"><a href="#cb9-1707" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: clean_title,  <span class="co"># T√≠tulo ORIGINAL com espa√ßos</span></span>
<span id="cb9-1708"><a href="#cb9-1708" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: <span class="st">&#39;Grok&#39;</span>,</span>
<span id="cb9-1709"><a href="#cb9-1709" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;id&#39;</span>: conv_id,</span>
<span id="cb9-1710"><a href="#cb9-1710" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;inserted_at&#39;</span>: inserted_at,</span>
<span id="cb9-1711"><a href="#cb9-1711" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;updated_at&#39;</span>: updated_at,</span>
<span id="cb9-1712"><a href="#cb9-1712" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;messages&#39;</span>: messages,</span>
<span id="cb9-1713"><a href="#cb9-1713" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;summary&#39;</span>: messages[<span class="dv">0</span>][<span class="st">&#39;content&#39;</span>][:<span class="dv">100</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span> <span class="cf">if</span> messages <span class="cf">else</span> <span class="st">&quot;Sem conte√∫do&quot;</span>,</span>
<span id="cb9-1714"><a href="#cb9-1714" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: <span class="st">&#39;Geral&#39;</span></span>
<span id="cb9-1715"><a href="#cb9-1715" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb9-1716"><a href="#cb9-1716" aria-hidden="true" tabindex="-1"></a>                    total_convs <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-1717"><a href="#cb9-1717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1718"><a href="#cb9-1718" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> total_convs <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb9-1719"><a href="#cb9-1719" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Grok: processadas </span><span class="sc">{</span>total_convs<span class="sc">}</span><span class="ss"> conversas.&quot;</span>)</span>
<span id="cb9-1720"><a href="#cb9-1720" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb9-1721"><a href="#cb9-1721" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="st">&quot;‚ùå Grok: nenhuma conversa v√°lida encontrada.&quot;</span>)</span>
<span id="cb9-1722"><a href="#cb9-1722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1723"><a href="#cb9-1723" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb9-1724"><a href="#cb9-1724" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao processar Grok: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1725"><a href="#cb9-1725" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb9-1726"><a href="#cb9-1726" aria-hidden="true" tabindex="-1"></a>                traceback.print_exc()</span>
<span id="cb9-1727"><a href="#cb9-1727" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>:</span>
<span id="cb9-1728"><a href="#cb9-1728" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&#39;temp_dir&#39;</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb9-1729"><a href="#cb9-1729" aria-hidden="true" tabindex="-1"></a>                shutil.rmtree(temp_dir, ignore_errors<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-1730"><a href="#cb9-1730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1731"><a href="#cb9-1731" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_markdown_enhanced(<span class="va">self</span>):</span>
<span id="cb9-1732"><a href="#cb9-1732" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas com preserva√ß√£o total de formata√ß√£o&quot;&quot;&quot;</span></span>
<span id="cb9-1733"><a href="#cb9-1733" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb9-1734"><a href="#cb9-1734" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] Markdowns seriam criados:&quot;</span>)</span>
<span id="cb9-1735"><a href="#cb9-1735" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb9-1736"><a href="#cb9-1736" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb9-1737"><a href="#cb9-1737" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.md&quot;</span></span>
<span id="cb9-1738"><a href="#cb9-1738" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÑ </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1739"><a href="#cb9-1739" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb9-1740"><a href="#cb9-1740" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1741"><a href="#cb9-1741" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;markdown&#39;</span>])</span>
<span id="cb9-1742"><a href="#cb9-1742" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-1743"><a href="#cb9-1743" aria-hidden="true" tabindex="-1"></a>        failed_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-1744"><a href="#cb9-1744" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1745"><a href="#cb9-1745" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb9-1746"><a href="#cb9-1746" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb9-1747"><a href="#cb9-1747" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb9-1748"><a href="#cb9-1748" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.md&quot;</span></span>
<span id="cb9-1749"><a href="#cb9-1749" aria-hidden="true" tabindex="-1"></a>                filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb9-1750"><a href="#cb9-1750" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1751"><a href="#cb9-1751" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb9-1752"><a href="#cb9-1752" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb9-1753"><a href="#cb9-1753" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb9-1754"><a href="#cb9-1754" aria-hidden="true" tabindex="-1"></a>                markdown_content <span class="op">=</span> <span class="va">self</span>.create_enhanced_markdown_content(conv)</span>
<span id="cb9-1755"><a href="#cb9-1755" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1756"><a href="#cb9-1756" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb9-1757"><a href="#cb9-1757" aria-hidden="true" tabindex="-1"></a>                    f.write(markdown_content)</span>
<span id="cb9-1758"><a href="#cb9-1758" aria-hidden="true" tabindex="-1"></a>                saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-1759"><a href="#cb9-1759" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1760"><a href="#cb9-1760" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb9-1761"><a href="#cb9-1761" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.error(<span class="ss">f&quot;‚ùå Erro ao salvar conversa </span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1762"><a href="#cb9-1762" aria-hidden="true" tabindex="-1"></a>                failed_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-1763"><a href="#cb9-1763" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb9-1764"><a href="#cb9-1764" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1765"><a href="#cb9-1765" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ Markdown: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados, </span><span class="sc">{</span>failed_count<span class="sc">}</span><span class="ss"> falhas em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb9-1766"><a href="#cb9-1766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1767"><a href="#cb9-1767" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_csv(<span class="va">self</span>):</span>
<span id="cb9-1768"><a href="#cb9-1768" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas em arquivos CSV individuais&quot;&quot;&quot;</span></span>
<span id="cb9-1769"><a href="#cb9-1769" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb9-1770"><a href="#cb9-1770" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] CSVs seriam criados:&quot;</span>)</span>
<span id="cb9-1771"><a href="#cb9-1771" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb9-1772"><a href="#cb9-1772" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb9-1773"><a href="#cb9-1773" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.csv&quot;</span></span>
<span id="cb9-1774"><a href="#cb9-1774" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìä </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1775"><a href="#cb9-1775" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb9-1776"><a href="#cb9-1776" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1777"><a href="#cb9-1777" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;csv&#39;</span>])</span>
<span id="cb9-1778"><a href="#cb9-1778" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-1779"><a href="#cb9-1779" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1780"><a href="#cb9-1780" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb9-1781"><a href="#cb9-1781" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb9-1782"><a href="#cb9-1782" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.csv&quot;</span></span>
<span id="cb9-1783"><a href="#cb9-1783" aria-hidden="true" tabindex="-1"></a>            filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb9-1784"><a href="#cb9-1784" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1785"><a href="#cb9-1785" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb9-1786"><a href="#cb9-1786" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb9-1787"><a href="#cb9-1787" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1788"><a href="#cb9-1788" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb9-1789"><a href="#cb9-1789" aria-hidden="true" tabindex="-1"></a>                writer <span class="op">=</span> csv.DictWriter(f, fieldnames<span class="op">=</span>[</span>
<span id="cb9-1790"><a href="#cb9-1790" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;node_id&#39;</span>, <span class="st">&#39;author&#39;</span>, <span class="st">&#39;role&#39;</span>, <span class="st">&#39;timestamp&#39;</span>, <span class="st">&#39;model&#39;</span>, <span class="st">&#39;content&#39;</span></span>
<span id="cb9-1791"><a href="#cb9-1791" aria-hidden="true" tabindex="-1"></a>                ])</span>
<span id="cb9-1792"><a href="#cb9-1792" aria-hidden="true" tabindex="-1"></a>                writer.writeheader()</span>
<span id="cb9-1793"><a href="#cb9-1793" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i, msg <span class="kw">in</span> <span class="bu">enumerate</span>(conv[<span class="st">&#39;messages&#39;</span>]):</span>
<span id="cb9-1794"><a href="#cb9-1794" aria-hidden="true" tabindex="-1"></a>                    writer.writerow({</span>
<span id="cb9-1795"><a href="#cb9-1795" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;node_id&#39;</span>: <span class="bu">str</span>(i),</span>
<span id="cb9-1796"><a href="#cb9-1796" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: msg[<span class="st">&#39;author&#39;</span>],</span>
<span id="cb9-1797"><a href="#cb9-1797" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: msg[<span class="st">&#39;role&#39;</span>],</span>
<span id="cb9-1798"><a href="#cb9-1798" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: msg[<span class="st">&#39;timestamp&#39;</span>],</span>
<span id="cb9-1799"><a href="#cb9-1799" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg[<span class="st">&#39;model&#39;</span>],</span>
<span id="cb9-1800"><a href="#cb9-1800" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: msg[<span class="st">&#39;content&#39;</span>]</span>
<span id="cb9-1801"><a href="#cb9-1801" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb9-1802"><a href="#cb9-1802" aria-hidden="true" tabindex="-1"></a>            saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-1803"><a href="#cb9-1803" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1804"><a href="#cb9-1804" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ CSV: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb9-1805"><a href="#cb9-1805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1806"><a href="#cb9-1806" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_json(<span class="va">self</span>):</span>
<span id="cb9-1807"><a href="#cb9-1807" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva conversas em arquivos JSON individuais&quot;&quot;&quot;</span></span>
<span id="cb9-1808"><a href="#cb9-1808" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb9-1809"><a href="#cb9-1809" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] JSONs seriam criados:&quot;</span>)</span>
<span id="cb9-1810"><a href="#cb9-1810" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb9-1811"><a href="#cb9-1811" aria-hidden="true" tabindex="-1"></a>                safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb9-1812"><a href="#cb9-1812" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.json&quot;</span></span>
<span id="cb9-1813"><a href="#cb9-1813" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìã </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1814"><a href="#cb9-1814" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb9-1815"><a href="#cb9-1815" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1816"><a href="#cb9-1816" aria-hidden="true" tabindex="-1"></a>        folder <span class="op">=</span> Path(<span class="va">self</span>.output_dirs[<span class="st">&#39;json&#39;</span>])</span>
<span id="cb9-1817"><a href="#cb9-1817" aria-hidden="true" tabindex="-1"></a>        saved_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-1818"><a href="#cb9-1818" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1819"><a href="#cb9-1819" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb9-1820"><a href="#cb9-1820" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb9-1821"><a href="#cb9-1821" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">.json&quot;</span></span>
<span id="cb9-1822"><a href="#cb9-1822" aria-hidden="true" tabindex="-1"></a>            filepath <span class="op">=</span> folder <span class="op">/</span> filename</span>
<span id="cb9-1823"><a href="#cb9-1823" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1824"><a href="#cb9-1824" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.force_overwrite <span class="kw">and</span> filepath.exists():</span>
<span id="cb9-1825"><a href="#cb9-1825" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb9-1826"><a href="#cb9-1826" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-1827"><a href="#cb9-1827" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb9-1828"><a href="#cb9-1828" aria-hidden="true" tabindex="-1"></a>                json.dump(conv, f, ensure_ascii<span class="op">=</span><span class="va">False</span>, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb9-1829"><a href="#cb9-1829" aria-hidden="true" tabindex="-1"></a>            saved_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-1830"><a href="#cb9-1830" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1831"><a href="#cb9-1831" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ JSON: </span><span class="sc">{</span>saved_count<span class="sc">}</span><span class="ss"> arquivos criados em &#39;</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb9-1832"><a href="#cb9-1832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1833"><a href="#cb9-1833" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_all_to_single_files(<span class="va">self</span>):</span>
<span id="cb9-1834"><a href="#cb9-1834" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Salva todas as conversas em arquivos √∫nicos CSV e JSON&quot;&quot;&quot;</span></span>
<span id="cb9-1835"><a href="#cb9-1835" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb9-1836"><a href="#cb9-1836" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="st">&quot;üîÆ [DRY-RUN] Arquivos √∫nicos seriam criados:&quot;</span>)</span>
<span id="cb9-1837"><a href="#cb9-1837" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÅ </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;csv&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1838"><a href="#cb9-1838" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;   üìÅ </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;json&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1839"><a href="#cb9-1839" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb9-1840"><a href="#cb9-1840" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1841"><a href="#cb9-1841" aria-hidden="true" tabindex="-1"></a>        <span class="co"># CSV √∫nico</span></span>
<span id="cb9-1842"><a href="#cb9-1842" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.single_files[<span class="st">&#39;csv&#39;</span>], <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb9-1843"><a href="#cb9-1843" aria-hidden="true" tabindex="-1"></a>            fieldnames <span class="op">=</span> [</span>
<span id="cb9-1844"><a href="#cb9-1844" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;conversation_number&#39;</span>, <span class="st">&#39;source&#39;</span>, <span class="st">&#39;conversation_title&#39;</span>, <span class="st">&#39;category&#39;</span>,</span>
<span id="cb9-1845"><a href="#cb9-1845" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;author&#39;</span>, <span class="st">&#39;role&#39;</span>, <span class="st">&#39;timestamp&#39;</span>, <span class="st">&#39;model&#39;</span>, <span class="st">&#39;content&#39;</span></span>
<span id="cb9-1846"><a href="#cb9-1846" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb9-1847"><a href="#cb9-1847" aria-hidden="true" tabindex="-1"></a>            writer <span class="op">=</span> csv.DictWriter(f, fieldnames<span class="op">=</span>fieldnames)</span>
<span id="cb9-1848"><a href="#cb9-1848" aria-hidden="true" tabindex="-1"></a>            writer.writeheader()</span>
<span id="cb9-1849"><a href="#cb9-1849" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb9-1850"><a href="#cb9-1850" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> msg <span class="kw">in</span> conv[<span class="st">&#39;messages&#39;</span>]:</span>
<span id="cb9-1851"><a href="#cb9-1851" aria-hidden="true" tabindex="-1"></a>                    writer.writerow({</span>
<span id="cb9-1852"><a href="#cb9-1852" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;conversation_number&#39;</span>: conv[<span class="st">&#39;number&#39;</span>],</span>
<span id="cb9-1853"><a href="#cb9-1853" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;source&#39;</span>: conv[<span class="st">&#39;source&#39;</span>],</span>
<span id="cb9-1854"><a href="#cb9-1854" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;conversation_title&#39;</span>: conv[<span class="st">&#39;title&#39;</span>],</span>
<span id="cb9-1855"><a href="#cb9-1855" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;category&#39;</span>: conv[<span class="st">&#39;category&#39;</span>],</span>
<span id="cb9-1856"><a href="#cb9-1856" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;author&#39;</span>: msg[<span class="st">&#39;author&#39;</span>],</span>
<span id="cb9-1857"><a href="#cb9-1857" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;role&#39;</span>: msg[<span class="st">&#39;role&#39;</span>],</span>
<span id="cb9-1858"><a href="#cb9-1858" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;timestamp&#39;</span>: msg[<span class="st">&#39;timestamp&#39;</span>],</span>
<span id="cb9-1859"><a href="#cb9-1859" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;model&#39;</span>: msg[<span class="st">&#39;model&#39;</span>],</span>
<span id="cb9-1860"><a href="#cb9-1860" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;content&#39;</span>: msg[<span class="st">&#39;content&#39;</span>]</span>
<span id="cb9-1861"><a href="#cb9-1861" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb9-1862"><a href="#cb9-1862" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ CSV √∫nico: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;csv&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1863"><a href="#cb9-1863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1864"><a href="#cb9-1864" aria-hidden="true" tabindex="-1"></a>        <span class="co"># JSON √∫nico</span></span>
<span id="cb9-1865"><a href="#cb9-1865" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.single_files[<span class="st">&#39;json&#39;</span>], <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb9-1866"><a href="#cb9-1866" aria-hidden="true" tabindex="-1"></a>            json.dump(<span class="va">self</span>.all_conversations, f, ensure_ascii<span class="op">=</span><span class="va">False</span>, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb9-1867"><a href="#cb9-1867" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ JSON √∫nico: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>single_files[<span class="st">&#39;json&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1868"><a href="#cb9-1868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1869"><a href="#cb9-1869" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_searchable_index(<span class="va">self</span>):</span>
<span id="cb9-1870"><a href="#cb9-1870" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Cria √≠ndice HTML pesquis√°vel com links para HTML&quot;&quot;&quot;</span></span>
<span id="cb9-1871"><a href="#cb9-1871" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dry_run:</span>
<span id="cb9-1872"><a href="#cb9-1872" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.info(<span class="ss">f&quot;üîÆ [DRY-RUN] √çndice HTML seria criado: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-1873"><a href="#cb9-1873" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb9-1874"><a href="#cb9-1874" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-1875"><a href="#cb9-1875" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">&quot;üéØ Criando √≠ndice HTML combinado...&quot;</span>)</span>
<span id="cb9-1876"><a href="#cb9-1876" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-1877"><a href="#cb9-1877" aria-hidden="true" tabindex="-1"></a>        category_stats <span class="op">=</span> {}</span>
<span id="cb9-1878"><a href="#cb9-1878" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> conv <span class="kw">in</span> <span class="va">self</span>.all_conversations:</span>
<span id="cb9-1879"><a href="#cb9-1879" aria-hidden="true" tabindex="-1"></a>            cat <span class="op">=</span> conv[<span class="st">&#39;category&#39;</span>]</span>
<span id="cb9-1880"><a href="#cb9-1880" aria-hidden="true" tabindex="-1"></a>            category_stats[cat] <span class="op">=</span> category_stats.get(cat, <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb9-1881"><a href="#cb9-1881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1882"><a href="#cb9-1882" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span>
<span id="cb9-1883"><a href="#cb9-1883" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;html lang=&quot;pt-PT&quot;&gt;</span></span>
<span id="cb9-1884"><a href="#cb9-1884" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;head&gt;</span></span>
<span id="cb9-1885"><a href="#cb9-1885" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span id="cb9-1886"><a href="#cb9-1886" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb9-1887"><a href="#cb9-1887" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;title&gt;√çndice Combinado - AI Chats&lt;/title&gt;</span></span>
<span id="cb9-1888"><a href="#cb9-1888" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;style&gt;</span></span>
<span id="cb9-1889"><a href="#cb9-1889" aria-hidden="true" tabindex="-1"></a><span class="ss">        * </span><span class="ch">{{</span><span class="ss"> margin: 0; padding: 0; box-sizing: border-box; </span><span class="ch">}}</span></span>
<span id="cb9-1890"><a href="#cb9-1890" aria-hidden="true" tabindex="-1"></a><span class="ss">        body </span><span class="ch">{{</span><span class="ss"> font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; color: #333; </span><span class="ch">}}</span></span>
<span id="cb9-1891"><a href="#cb9-1891" aria-hidden="true" tabindex="-1"></a><span class="ss">        .container </span><span class="ch">{{</span><span class="ss"> max-width: 1400px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; </span><span class="ch">}}</span></span>
<span id="cb9-1892"><a href="#cb9-1892" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header </span><span class="ch">{{</span><span class="ss"> background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; text-align: center; </span><span class="ch">}}</span></span>
<span id="cb9-1893"><a href="#cb9-1893" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header h1 </span><span class="ch">{{</span><span class="ss"> font-size: 2.8em; margin-bottom: 15px; font-weight: 300; </span><span class="ch">}}</span></span>
<span id="cb9-1894"><a href="#cb9-1894" aria-hidden="true" tabindex="-1"></a><span class="ss">        .header p </span><span class="ch">{{</span><span class="ss"> font-size: 1.2em; opacity: 0.9; margin-bottom: 20px; </span><span class="ch">}}</span></span>
<span id="cb9-1895"><a href="#cb9-1895" aria-hidden="true" tabindex="-1"></a><span class="ss">        .stats </span><span class="ch">{{</span><span class="ss"> display: flex; justify-content: center; gap: 30px; margin-top: 25px; flex-wrap: wrap; </span><span class="ch">}}</span></span>
<span id="cb9-1896"><a href="#cb9-1896" aria-hidden="true" tabindex="-1"></a><span class="ss">        .stat-item </span><span class="ch">{{</span><span class="ss"> background: rgba(255,255,255,0.15); padding: 18px 28px; border-radius: 12px; backdrop-filter: blur(10px); font-size: 1.1em; </span><span class="ch">}}</span></span>
<span id="cb9-1897"><a href="#cb9-1897" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-section </span><span class="ch">{{</span><span class="ss"> padding: 30px; background: #f8f9fa; border-bottom: 1px solid #e9ecef; </span><span class="ch">}}</span></span>
<span id="cb9-1898"><a href="#cb9-1898" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-box </span><span class="ch">{{</span><span class="ss"> width: 100%; padding: 18px 25px; font-size: 16px; border: 2px solid #e9ecef; border-radius: 25px; outline: none; transition: all 0.3s ease; font-family: inherit; </span><span class="ch">}}</span></span>
<span id="cb9-1899"><a href="#cb9-1899" aria-hidden="true" tabindex="-1"></a><span class="ss">        .search-box:focus </span><span class="ch">{{</span><span class="ss"> border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); </span><span class="ch">}}</span></span>
<span id="cb9-1900"><a href="#cb9-1900" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-section </span><span class="ch">{{</span></span>
<span id="cb9-1901"><a href="#cb9-1901" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 20px 30px;</span></span>
<span id="cb9-1902"><a href="#cb9-1902" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex;</span></span>
<span id="cb9-1903"><a href="#cb9-1903" aria-hidden="true" tabindex="-1"></a><span class="ss">            flex-wrap: wrap;</span></span>
<span id="cb9-1904"><a href="#cb9-1904" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 12px;</span></span>
<span id="cb9-1905"><a href="#cb9-1905" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: center;</span></span>
<span id="cb9-1906"><a href="#cb9-1906" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #f8f9fa;</span></span>
<span id="cb9-1907"><a href="#cb9-1907" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-bottom: 1px solid #e9ecef;</span></span>
<span id="cb9-1908"><a href="#cb9-1908" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-1909"><a href="#cb9-1909" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-btn </span><span class="ch">{{</span></span>
<span id="cb9-1910"><a href="#cb9-1910" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 10px 20px;</span></span>
<span id="cb9-1911"><a href="#cb9-1911" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white;</span></span>
<span id="cb9-1912"><a href="#cb9-1912" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 2px solid #e9ecef;</span></span>
<span id="cb9-1913"><a href="#cb9-1913" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 25px;</span></span>
<span id="cb9-1914"><a href="#cb9-1914" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb9-1915"><a href="#cb9-1915" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.95em;</span></span>
<span id="cb9-1916"><a href="#cb9-1916" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb9-1917"><a href="#cb9-1917" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.3s ease;</span></span>
<span id="cb9-1918"><a href="#cb9-1918" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-family: inherit;</span></span>
<span id="cb9-1919"><a href="#cb9-1919" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-1920"><a href="#cb9-1920" aria-hidden="true" tabindex="-1"></a><span class="ss">        .filter-btn.active, .filter-btn:hover </span><span class="ch">{{</span></span>
<span id="cb9-1921"><a href="#cb9-1921" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #667eea;</span></span>
<span id="cb9-1922"><a href="#cb9-1922" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb9-1923"><a href="#cb9-1923" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb9-1924"><a href="#cb9-1924" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: translateY(-2px);</span></span>
<span id="cb9-1925"><a href="#cb9-1925" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);</span></span>
<span id="cb9-1926"><a href="#cb9-1926" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-1927"><a href="#cb9-1927" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversations-grid </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-1928"><a href="#cb9-1928" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: grid; </span></span>
<span id="cb9-1929"><a href="#cb9-1929" aria-hidden="true" tabindex="-1"></a><span class="ss">            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); </span></span>
<span id="cb9-1930"><a href="#cb9-1930" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 25px; </span></span>
<span id="cb9-1931"><a href="#cb9-1931" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 35px;</span></span>
<span id="cb9-1932"><a href="#cb9-1932" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);</span></span>
<span id="cb9-1933"><a href="#cb9-1933" aria-hidden="true" tabindex="-1"></a><span class="ss">            min-height: 400px;</span></span>
<span id="cb9-1934"><a href="#cb9-1934" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-1935"><a href="#cb9-1935" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-1936"><a href="#cb9-1936" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white; </span></span>
<span id="cb9-1937"><a href="#cb9-1937" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 1px solid #e9ecef; </span></span>
<span id="cb9-1938"><a href="#cb9-1938" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 15px; </span></span>
<span id="cb9-1939"><a href="#cb9-1939" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 25px; </span></span>
<span id="cb9-1940"><a href="#cb9-1940" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.4s ease; </span></span>
<span id="cb9-1941"><a href="#cb9-1941" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer; </span></span>
<span id="cb9-1942"><a href="#cb9-1942" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: relative;</span></span>
<span id="cb9-1943"><a href="#cb9-1943" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 5px 15px rgba(0,0,0,0.08);</span></span>
<span id="cb9-1944"><a href="#cb9-1944" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-1945"><a href="#cb9-1945" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card:hover </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-1946"><a href="#cb9-1946" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: translateY(-8px); </span></span>
<span id="cb9-1947"><a href="#cb9-1947" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 15px 35px rgba(0,0,0,0.15); </span></span>
<span id="cb9-1948"><a href="#cb9-1948" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb9-1949"><a href="#cb9-1949" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-1950"><a href="#cb9-1950" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-header </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-1951"><a href="#cb9-1951" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb9-1952"><a href="#cb9-1952" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between; </span></span>
<span id="cb9-1953"><a href="#cb9-1953" aria-hidden="true" tabindex="-1"></a><span class="ss">            align-items: flex-start; </span></span>
<span id="cb9-1954"><a href="#cb9-1954" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 18px; </span></span>
<span id="cb9-1955"><a href="#cb9-1955" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-1956"><a href="#cb9-1956" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-number </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-1957"><a href="#cb9-1957" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: linear-gradient(135deg, #667eea, #764ba2); </span></span>
<span id="cb9-1958"><a href="#cb9-1958" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb9-1959"><a href="#cb9-1959" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 8px 16px; </span></span>
<span id="cb9-1960"><a href="#cb9-1960" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 20px; </span></span>
<span id="cb9-1961"><a href="#cb9-1961" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em; </span></span>
<span id="cb9-1962"><a href="#cb9-1962" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold;</span></span>
<span id="cb9-1963"><a href="#cb9-1963" aria-hidden="true" tabindex="-1"></a><span class="ss">            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);</span></span>
<span id="cb9-1964"><a href="#cb9-1964" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-1965"><a href="#cb9-1965" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-source </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-1966"><a href="#cb9-1966" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e3f2fd; </span></span>
<span id="cb9-1967"><a href="#cb9-1967" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #1976d2; </span></span>
<span id="cb9-1968"><a href="#cb9-1968" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 5px 12px; </span></span>
<span id="cb9-1969"><a href="#cb9-1969" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px; </span></span>
<span id="cb9-1970"><a href="#cb9-1970" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.85em; </span></span>
<span id="cb9-1971"><a href="#cb9-1971" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: bold; </span></span>
<span id="cb9-1972"><a href="#cb9-1972" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 10px;</span></span>
<span id="cb9-1973"><a href="#cb9-1973" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-1974"><a href="#cb9-1974" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-title </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-1975"><a href="#cb9-1975" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.3em; </span></span>
<span id="cb9-1976"><a href="#cb9-1976" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 600; </span></span>
<span id="cb9-1977"><a href="#cb9-1977" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #2c3e50; </span></span>
<span id="cb9-1978"><a href="#cb9-1978" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 12px; </span></span>
<span id="cb9-1979"><a href="#cb9-1979" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.4;</span></span>
<span id="cb9-1980"><a href="#cb9-1980" aria-hidden="true" tabindex="-1"></a><span class="ss">            min-height: 3.6em;</span></span>
<span id="cb9-1981"><a href="#cb9-1981" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb9-1982"><a href="#cb9-1982" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-1983"><a href="#cb9-1983" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-summary </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-1984"><a href="#cb9-1984" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #6c757d; </span></span>
<span id="cb9-1985"><a href="#cb9-1985" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.95em; </span></span>
<span id="cb9-1986"><a href="#cb9-1986" aria-hidden="true" tabindex="-1"></a><span class="ss">            line-height: 1.5; </span></span>
<span id="cb9-1987"><a href="#cb9-1987" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-bottom: 18px;</span></span>
<span id="cb9-1988"><a href="#cb9-1988" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: -webkit-box;</span></span>
<span id="cb9-1989"><a href="#cb9-1989" aria-hidden="true" tabindex="-1"></a><span class="ss">            -webkit-line-clamp: 3;</span></span>
<span id="cb9-1990"><a href="#cb9-1990" aria-hidden="true" tabindex="-1"></a><span class="ss">            -webkit-box-orient: vertical;</span></span>
<span id="cb9-1991"><a href="#cb9-1991" aria-hidden="true" tabindex="-1"></a><span class="ss">            overflow: hidden;</span></span>
<span id="cb9-1992"><a href="#cb9-1992" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer;</span></span>
<span id="cb9-1993"><a href="#cb9-1993" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-1994"><a href="#cb9-1994" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-meta </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-1995"><a href="#cb9-1995" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb9-1996"><a href="#cb9-1996" aria-hidden="true" tabindex="-1"></a><span class="ss">            justify-content: space-between; </span></span>
<span id="cb9-1997"><a href="#cb9-1997" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.85em; </span></span>
<span id="cb9-1998"><a href="#cb9-1998" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #868e96; </span></span>
<span id="cb9-1999"><a href="#cb9-1999" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-top: 1px solid #e9ecef; </span></span>
<span id="cb9-2000"><a href="#cb9-2000" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding-top: 18px;</span></span>
<span id="cb9-2001"><a href="#cb9-2001" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-2002"><a href="#cb9-2002" aria-hidden="true" tabindex="-1"></a><span class="ss">        .card-actions </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-2003"><a href="#cb9-2003" aria-hidden="true" tabindex="-1"></a><span class="ss">            position: absolute; </span></span>
<span id="cb9-2004"><a href="#cb9-2004" aria-hidden="true" tabindex="-1"></a><span class="ss">            top: 20px; </span></span>
<span id="cb9-2005"><a href="#cb9-2005" aria-hidden="true" tabindex="-1"></a><span class="ss">            right: 20px; </span></span>
<span id="cb9-2006"><a href="#cb9-2006" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: flex; </span></span>
<span id="cb9-2007"><a href="#cb9-2007" aria-hidden="true" tabindex="-1"></a><span class="ss">            gap: 8px; </span></span>
<span id="cb9-2008"><a href="#cb9-2008" aria-hidden="true" tabindex="-1"></a><span class="ss">            opacity: 0; </span></span>
<span id="cb9-2009"><a href="#cb9-2009" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: opacity 0.3s ease; </span></span>
<span id="cb9-2010"><a href="#cb9-2010" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-2011"><a href="#cb9-2011" aria-hidden="true" tabindex="-1"></a><span class="ss">        .conversation-card:hover .card-actions </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-2012"><a href="#cb9-2012" aria-hidden="true" tabindex="-1"></a><span class="ss">            opacity: 1; </span></span>
<span id="cb9-2013"><a href="#cb9-2013" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-2014"><a href="#cb9-2014" aria-hidden="true" tabindex="-1"></a><span class="ss">        .action-btn </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-2015"><a href="#cb9-2015" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: white; </span></span>
<span id="cb9-2016"><a href="#cb9-2016" aria-hidden="true" tabindex="-1"></a><span class="ss">            border: 2px solid #e9ecef; </span></span>
<span id="cb9-2017"><a href="#cb9-2017" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 8px; </span></span>
<span id="cb9-2018"><a href="#cb9-2018" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 6px 12px; </span></span>
<span id="cb9-2019"><a href="#cb9-2019" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.8em; </span></span>
<span id="cb9-2020"><a href="#cb9-2020" aria-hidden="true" tabindex="-1"></a><span class="ss">            cursor: pointer; </span></span>
<span id="cb9-2021"><a href="#cb9-2021" aria-hidden="true" tabindex="-1"></a><span class="ss">            transition: all 0.3s ease;</span></span>
<span id="cb9-2022"><a href="#cb9-2022" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb9-2023"><a href="#cb9-2023" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb9-2024"><a href="#cb9-2024" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #333;</span></span>
<span id="cb9-2025"><a href="#cb9-2025" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb9-2026"><a href="#cb9-2026" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-2027"><a href="#cb9-2027" aria-hidden="true" tabindex="-1"></a><span class="ss">        .action-btn:hover </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-2028"><a href="#cb9-2028" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #667eea; </span></span>
<span id="cb9-2029"><a href="#cb9-2029" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb9-2030"><a href="#cb9-2030" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-color: #667eea;</span></span>
<span id="cb9-2031"><a href="#cb9-2031" aria-hidden="true" tabindex="-1"></a><span class="ss">            transform: scale(1.05);</span></span>
<span id="cb9-2032"><a href="#cb9-2032" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-2033"><a href="#cb9-2033" aria-hidden="true" tabindex="-1"></a><span class="ss">        .recent-badge </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-2034"><a href="#cb9-2034" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #ff6b6b; </span></span>
<span id="cb9-2035"><a href="#cb9-2035" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white; </span></span>
<span id="cb9-2036"><a href="#cb9-2036" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 3px 10px; </span></span>
<span id="cb9-2037"><a href="#cb9-2037" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px; </span></span>
<span id="cb9-2038"><a href="#cb9-2038" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.75em; </span></span>
<span id="cb9-2039"><a href="#cb9-2039" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 8px;</span></span>
<span id="cb9-2040"><a href="#cb9-2040" aria-hidden="true" tabindex="-1"></a><span class="ss">            animation: pulse 2s infinite;</span></span>
<span id="cb9-2041"><a href="#cb9-2041" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-2042"><a href="#cb9-2042" aria-hidden="true" tabindex="-1"></a><span class="ss">        .no-results </span><span class="ch">{{</span><span class="ss"> </span></span>
<span id="cb9-2043"><a href="#cb9-2043" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-align: center; </span></span>
<span id="cb9-2044"><a href="#cb9-2044" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 60px 20px; </span></span>
<span id="cb9-2045"><a href="#cb9-2045" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #6c757d;</span></span>
<span id="cb9-2046"><a href="#cb9-2046" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 1.1em;</span></span>
<span id="cb9-2047"><a href="#cb9-2047" aria-hidden="true" tabindex="-1"></a><span class="ss">            grid-column: 1 / -1;</span></span>
<span id="cb9-2048"><a href="#cb9-2048" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-2049"><a href="#cb9-2049" aria-hidden="true" tabindex="-1"></a><span class="ss">        @keyframes pulse </span><span class="ch">{{</span></span>
<span id="cb9-2050"><a href="#cb9-2050" aria-hidden="true" tabindex="-1"></a><span class="ss">            0% </span><span class="ch">{{</span><span class="ss"> transform: scale(1); </span><span class="ch">}}</span></span>
<span id="cb9-2051"><a href="#cb9-2051" aria-hidden="true" tabindex="-1"></a><span class="ss">            50% </span><span class="ch">{{</span><span class="ss"> transform: scale(1.05); </span><span class="ch">}}</span></span>
<span id="cb9-2052"><a href="#cb9-2052" aria-hidden="true" tabindex="-1"></a><span class="ss">            100% </span><span class="ch">{{</span><span class="ss"> transform: scale(1); </span><span class="ch">}}</span></span>
<span id="cb9-2053"><a href="#cb9-2053" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-2054"><a href="#cb9-2054" aria-hidden="true" tabindex="-1"></a><span class="ss">        .category-badge </span><span class="ch">{{</span></span>
<span id="cb9-2055"><a href="#cb9-2055" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb9-2056"><a href="#cb9-2056" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #e3f2fd;</span></span>
<span id="cb9-2057"><a href="#cb9-2057" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: #1976d2;</span></span>
<span id="cb9-2058"><a href="#cb9-2058" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 4px 10px;</span></span>
<span id="cb9-2059"><a href="#cb9-2059" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 12px;</span></span>
<span id="cb9-2060"><a href="#cb9-2060" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.8em;</span></span>
<span id="cb9-2061"><a href="#cb9-2061" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin-left: 8px;</span></span>
<span id="cb9-2062"><a href="#cb9-2062" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-weight: 500;</span></span>
<span id="cb9-2063"><a href="#cb9-2063" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-2064"><a href="#cb9-2064" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb9-2065"><a href="#cb9-2065" aria-hidden="true" tabindex="-1"></a><span class="ss">        .direct-link </span><span class="ch">{{</span></span>
<span id="cb9-2066"><a href="#cb9-2066" aria-hidden="true" tabindex="-1"></a><span class="ss">            display: inline-block;</span></span>
<span id="cb9-2067"><a href="#cb9-2067" aria-hidden="true" tabindex="-1"></a><span class="ss">            margin: 5px;</span></span>
<span id="cb9-2068"><a href="#cb9-2068" aria-hidden="true" tabindex="-1"></a><span class="ss">            padding: 8px 15px;</span></span>
<span id="cb9-2069"><a href="#cb9-2069" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #28a745;</span></span>
<span id="cb9-2070"><a href="#cb9-2070" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb9-2071"><a href="#cb9-2071" aria-hidden="true" tabindex="-1"></a><span class="ss">            text-decoration: none;</span></span>
<span id="cb9-2072"><a href="#cb9-2072" aria-hidden="true" tabindex="-1"></a><span class="ss">            border-radius: 5px;</span></span>
<span id="cb9-2073"><a href="#cb9-2073" aria-hidden="true" tabindex="-1"></a><span class="ss">            font-size: 0.9em;</span></span>
<span id="cb9-2074"><a href="#cb9-2074" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-2075"><a href="#cb9-2075" aria-hidden="true" tabindex="-1"></a><span class="ss">        .direct-link:hover </span><span class="ch">{{</span></span>
<span id="cb9-2076"><a href="#cb9-2076" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #218838;</span></span>
<span id="cb9-2077"><a href="#cb9-2077" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-2078"><a href="#cb9-2078" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb9-2079"><a href="#cb9-2079" aria-hidden="true" tabindex="-1"></a><span class="ss">        .html-btn </span><span class="ch">{{</span></span>
<span id="cb9-2080"><a href="#cb9-2080" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #17a2b8;</span></span>
<span id="cb9-2081"><a href="#cb9-2081" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb9-2082"><a href="#cb9-2082" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-2083"><a href="#cb9-2083" aria-hidden="true" tabindex="-1"></a><span class="ss">        .html-btn:hover </span><span class="ch">{{</span></span>
<span id="cb9-2084"><a href="#cb9-2084" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #138496;</span></span>
<span id="cb9-2085"><a href="#cb9-2085" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-2086"><a href="#cb9-2086" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb9-2087"><a href="#cb9-2087" aria-hidden="true" tabindex="-1"></a><span class="ss">        .pdf-btn </span><span class="ch">{{</span></span>
<span id="cb9-2088"><a href="#cb9-2088" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #dc3545;</span></span>
<span id="cb9-2089"><a href="#cb9-2089" aria-hidden="true" tabindex="-1"></a><span class="ss">            color: white;</span></span>
<span id="cb9-2090"><a href="#cb9-2090" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-2091"><a href="#cb9-2091" aria-hidden="true" tabindex="-1"></a><span class="ss">        .pdf-btn:hover </span><span class="ch">{{</span></span>
<span id="cb9-2092"><a href="#cb9-2092" aria-hidden="true" tabindex="-1"></a><span class="ss">            background: #c82333;</span></span>
<span id="cb9-2093"><a href="#cb9-2093" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span><span class="ch">}}</span></span>
<span id="cb9-2094"><a href="#cb9-2094" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;/style&gt;</span></span>
<span id="cb9-2095"><a href="#cb9-2095" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/head&gt;</span></span>
<span id="cb9-2096"><a href="#cb9-2096" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;body&gt;</span></span>
<span id="cb9-2097"><a href="#cb9-2097" aria-hidden="true" tabindex="-1"></a><span class="ss">    &lt;div class=&quot;container&quot;&gt;</span></span>
<span id="cb9-2098"><a href="#cb9-2098" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;header&quot;&gt;</span></span>
<span id="cb9-2099"><a href="#cb9-2099" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;h1&gt;üìö √çndice Combinado de Conversas&lt;/h1&gt;</span></span>
<span id="cb9-2100"><a href="#cb9-2100" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;p&gt;Qwen3 ‚Ä¢ ChatGPT ‚Ä¢ DeepSeek ‚Ä¢ Grok ‚Ä¢ COM HTML (Pandoc + MathJax)&lt;/p&gt;</span></span>
<span id="cb9-2101"><a href="#cb9-2101" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div class=&quot;stats&quot;&gt;</span></span>
<span id="cb9-2102"><a href="#cb9-2102" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb9-2103"><a href="#cb9-2103" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Total:&lt;/strong&gt; &lt;span id=&quot;total-count&quot;&gt;</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">&lt;/span&gt; conversas</span></span>
<span id="cb9-2104"><a href="#cb9-2104" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb9-2105"><a href="#cb9-2105" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb9-2106"><a href="#cb9-2106" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Ordena√ß√£o:&lt;/strong&gt; Mais Recentes Primeiro</span></span>
<span id="cb9-2107"><a href="#cb9-2107" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb9-2108"><a href="#cb9-2108" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;stat-item&quot;&gt;</span></span>
<span id="cb9-2109"><a href="#cb9-2109" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;strong&gt;Atualizado:&lt;/strong&gt; </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">.</span>strftime(<span class="st">&#39;</span><span class="sc">%d</span><span class="st">/%m/%Y %H:%M&#39;</span>)<span class="sc">}</span></span>
<span id="cb9-2110"><a href="#cb9-2110" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb9-2111"><a href="#cb9-2111" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb9-2112"><a href="#cb9-2112" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb9-2113"><a href="#cb9-2113" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb9-2114"><a href="#cb9-2114" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;search-section&quot;&gt;</span></span>
<span id="cb9-2115"><a href="#cb9-2115" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;input type=&quot;text&quot; id=&quot;searchInput&quot; class=&quot;search-box&quot; placeholder=&quot;üîç Pesquisar por t√≠tulo, conte√∫do ou categoria...&quot;&gt;</span></span>
<span id="cb9-2116"><a href="#cb9-2116" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb9-2117"><a href="#cb9-2117" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="cb9-2118"><a href="#cb9-2118" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div class=&quot;filter-section&quot;&gt;</span></span>
<span id="cb9-2119"><a href="#cb9-2119" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;button class=&quot;filter-btn active&quot; data-filter=&quot;todas&quot;&gt;Todas (</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.all_conversations)<span class="sc">}</span><span class="ss">)&lt;/button&gt;</span></span>
<span id="cb9-2120"><a href="#cb9-2120" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb9-2121"><a href="#cb9-2121" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-2122"><a href="#cb9-2122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category, count <span class="kw">in</span> category_stats.items():</span>
<span id="cb9-2123"><a href="#cb9-2123" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">+=</span> <span class="ss">f&#39;&lt;button class=&quot;filter-btn&quot; data-filter=&quot;</span><span class="sc">{</span>category<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot;&gt;</span><span class="sc">{</span>category<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">)&lt;/button&gt;</span><span class="ch">\n</span><span class="ss">&#39;</span></span>
<span id="cb9-2124"><a href="#cb9-2124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2125"><a href="#cb9-2125" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb9-2126"><a href="#cb9-2126" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb9-2127"><a href="#cb9-2127" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb9-2128"><a href="#cb9-2128" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div style=&quot;text-align: center; padding: 15px; background: #e9ecef; border-bottom: 1px solid #ddd;&quot;&gt;</span></span>
<span id="cb9-2129"><a href="#cb9-2129" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;strong&gt;Acesso R√°pido:&lt;/strong&gt;</span></span>
<span id="cb9-2130"><a href="#cb9-2130" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_markdown/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìÅ Markdown&lt;/a&gt;</span></span>
<span id="cb9-2131"><a href="#cb9-2131" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_html/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üåê HTML&lt;/a&gt;</span></span>
<span id="cb9-2132"><a href="#cb9-2132" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_pdfs/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìÑ PDF&lt;/a&gt;</span></span>
<span id="cb9-2133"><a href="#cb9-2133" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;a href=&quot;combined_json/&quot; class=&quot;direct-link&quot; target=&quot;_blank&quot;&gt;üìã JSON&lt;/a&gt;</span></span>
<span id="cb9-2134"><a href="#cb9-2134" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb9-2135"><a href="#cb9-2135" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb9-2136"><a href="#cb9-2136" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;div class=&quot;conversations-grid&quot; id=&quot;conversationsGrid&quot;&gt;</span></span>
<span id="cb9-2137"><a href="#cb9-2137" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb9-2138"><a href="#cb9-2138" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-2139"><a href="#cb9-2139" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, conv <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.all_conversations):</span>
<span id="cb9-2140"><a href="#cb9-2140" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> <span class="va">self</span>.sanitize_filename(conv[<span class="st">&#39;title&#39;</span>])</span>
<span id="cb9-2141"><a href="#cb9-2141" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">:03d}</span><span class="ss">_</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb9-2142"><a href="#cb9-2142" aria-hidden="true" tabindex="-1"></a>            recent_badge <span class="op">=</span> <span class="st">&quot;&lt;span class=&#39;recent-badge&#39;&gt;NOVO&lt;/span&gt;&quot;</span> <span class="cf">if</span> i <span class="op">&lt;</span> <span class="dv">5</span> <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb9-2143"><a href="#cb9-2143" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-2144"><a href="#cb9-2144" aria-hidden="true" tabindex="-1"></a>            summary <span class="op">=</span> conv.get(<span class="st">&#39;summary&#39;</span>, <span class="st">&#39;Sem resumo dispon√≠vel&#39;</span>)</span>
<span id="cb9-2145"><a href="#cb9-2145" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(summary) <span class="op">&gt;</span> <span class="dv">150</span>:</span>
<span id="cb9-2146"><a href="#cb9-2146" aria-hidden="true" tabindex="-1"></a>                summary <span class="op">=</span> summary[:<span class="dv">150</span>] <span class="op">+</span> <span class="st">&quot;...&quot;</span></span>
<span id="cb9-2147"><a href="#cb9-2147" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-2148"><a href="#cb9-2148" aria-hidden="true" tabindex="-1"></a>            html_content <span class="op">+=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb9-2149"><a href="#cb9-2149" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div class=&quot;conversation-card&quot; data-title=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&quot; data-summary=&quot;</span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&quot; data-source=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot; data-category=&quot;</span><span class="sc">{</span>conv[<span class="st">&#39;category&#39;</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">&quot;&gt;</span></span>
<span id="cb9-2150"><a href="#cb9-2150" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-header&quot;&gt;</span></span>
<span id="cb9-2151"><a href="#cb9-2151" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;card-number&quot;&gt;#</span><span class="sc">{</span>conv[<span class="st">&#39;number&#39;</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>recent_badge<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb9-2152"><a href="#cb9-2152" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;div class=&quot;card-actions&quot;&gt;</span></span>
<span id="cb9-2153"><a href="#cb9-2153" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_markdown/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.md&quot; class=&quot;action-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üìÑ MD&lt;/a&gt;</span></span>
<span id="cb9-2154"><a href="#cb9-2154" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_html/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&quot; class=&quot;action-btn html-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üåê HTML&lt;/a&gt;</span></span>
<span id="cb9-2155"><a href="#cb9-2155" aria-hidden="true" tabindex="-1"></a><span class="ss">                        &lt;a href=&quot;combined_pdfs/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.pdf&quot; class=&quot;action-btn pdf-btn&quot; target=&quot;_blank&quot; onclick=&quot;event.stopPropagation();&quot;&gt;üìä PDF&lt;/a&gt;</span></span>
<span id="cb9-2156"><a href="#cb9-2156" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;/div&gt;</span></span>
<span id="cb9-2157"><a href="#cb9-2157" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb9-2158"><a href="#cb9-2158" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-title&quot; onclick=&quot;openHTML(&#39;</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&#39;)&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;title&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb9-2159"><a href="#cb9-2159" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div&gt;</span></span>
<span id="cb9-2160"><a href="#cb9-2160" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span class=&quot;card-source&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb9-2161"><a href="#cb9-2161" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span class=&quot;category-badge&quot;&gt;</span><span class="sc">{</span>conv[<span class="st">&#39;category&#39;</span>]<span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb9-2162"><a href="#cb9-2162" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb9-2163"><a href="#cb9-2163" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-summary&quot; onclick=&quot;openHTML(&#39;</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.html&#39;)&quot;&gt;</span><span class="sc">{</span>summary<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb9-2164"><a href="#cb9-2164" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;div class=&quot;card-meta&quot;&gt;</span></span>
<span id="cb9-2165"><a href="#cb9-2165" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span&gt;üìÖ </span><span class="sc">{</span>conv<span class="sc">.</span>get(<span class="st">&#39;updated_at&#39;</span>) <span class="kw">or</span> conv<span class="sc">.</span>get(<span class="st">&#39;inserted_at&#39;</span>) <span class="kw">or</span> <span class="st">&#39;N/A&#39;</span><span class="sc">}</span><span class="ss">&lt;/span&gt;</span></span>
<span id="cb9-2166"><a href="#cb9-2166" aria-hidden="true" tabindex="-1"></a><span class="ss">                    &lt;span&gt;üí¨ </span><span class="sc">{</span><span class="bu">len</span>(conv[<span class="st">&#39;messages&#39;</span>])<span class="sc">}</span><span class="ss"> mensagens&lt;/span&gt;</span></span>
<span id="cb9-2167"><a href="#cb9-2167" aria-hidden="true" tabindex="-1"></a><span class="ss">                &lt;/div&gt;</span></span>
<span id="cb9-2168"><a href="#cb9-2168" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb9-2169"><a href="#cb9-2169" aria-hidden="true" tabindex="-1"></a><span class="ss">            &quot;&quot;&quot;</span></span>
<span id="cb9-2170"><a href="#cb9-2170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2171"><a href="#cb9-2171" aria-hidden="true" tabindex="-1"></a>        html_content <span class="op">+=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb9-2172"><a href="#cb9-2172" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/div&gt;</span></span>
<span id="cb9-2173"><a href="#cb9-2173" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/div&gt;</span></span>
<span id="cb9-2174"><a href="#cb9-2174" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb9-2175"><a href="#cb9-2175" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;script&gt;</span></span>
<span id="cb9-2176"><a href="#cb9-2176" aria-hidden="true" tabindex="-1"></a><span class="st">        let currentFilter = &#39;todas&#39;;</span></span>
<span id="cb9-2177"><a href="#cb9-2177" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb9-2178"><a href="#cb9-2178" aria-hidden="true" tabindex="-1"></a><span class="st">        document.addEventListener(&#39;DOMContentLoaded&#39;, function() {</span></span>
<span id="cb9-2179"><a href="#cb9-2179" aria-hidden="true" tabindex="-1"></a><span class="st">            updateStats();</span></span>
<span id="cb9-2180"><a href="#cb9-2180" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb9-2181"><a href="#cb9-2181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2182"><a href="#cb9-2182" aria-hidden="true" tabindex="-1"></a><span class="st">        document.querySelectorAll(&#39;.filter-btn&#39;).forEach(btn =&gt; {</span></span>
<span id="cb9-2183"><a href="#cb9-2183" aria-hidden="true" tabindex="-1"></a><span class="st">            btn.addEventListener(&#39;click&#39;, () =&gt; {</span></span>
<span id="cb9-2184"><a href="#cb9-2184" aria-hidden="true" tabindex="-1"></a><span class="st">                document.querySelectorAll(&#39;.filter-btn&#39;).forEach(b =&gt; b.classList.remove(&#39;active&#39;));</span></span>
<span id="cb9-2185"><a href="#cb9-2185" aria-hidden="true" tabindex="-1"></a><span class="st">                btn.classList.add(&#39;active&#39;);</span></span>
<span id="cb9-2186"><a href="#cb9-2186" aria-hidden="true" tabindex="-1"></a><span class="st">                currentFilter = btn.getAttribute(&#39;data-filter&#39;);</span></span>
<span id="cb9-2187"><a href="#cb9-2187" aria-hidden="true" tabindex="-1"></a><span class="st">                filterConversations();</span></span>
<span id="cb9-2188"><a href="#cb9-2188" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb9-2189"><a href="#cb9-2189" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb9-2190"><a href="#cb9-2190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2191"><a href="#cb9-2191" aria-hidden="true" tabindex="-1"></a><span class="st">        document.getElementById(&#39;searchInput&#39;).addEventListener(&#39;input&#39;, filterConversations);</span></span>
<span id="cb9-2192"><a href="#cb9-2192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2193"><a href="#cb9-2193" aria-hidden="true" tabindex="-1"></a><span class="st">        function filterConversations() {</span></span>
<span id="cb9-2194"><a href="#cb9-2194" aria-hidden="true" tabindex="-1"></a><span class="st">            const term = document.getElementById(&#39;searchInput&#39;).value.toLowerCase();</span></span>
<span id="cb9-2195"><a href="#cb9-2195" aria-hidden="true" tabindex="-1"></a><span class="st">            const cards = document.querySelectorAll(&#39;.conversation-card&#39;);</span></span>
<span id="cb9-2196"><a href="#cb9-2196" aria-hidden="true" tabindex="-1"></a><span class="st">            let visible = 0;</span></span>
<span id="cb9-2197"><a href="#cb9-2197" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-2198"><a href="#cb9-2198" aria-hidden="true" tabindex="-1"></a><span class="st">            cards.forEach(card =&gt; {</span></span>
<span id="cb9-2199"><a href="#cb9-2199" aria-hidden="true" tabindex="-1"></a><span class="st">                const title = card.getAttribute(&#39;data-title&#39;).toLowerCase();</span></span>
<span id="cb9-2200"><a href="#cb9-2200" aria-hidden="true" tabindex="-1"></a><span class="st">                const summary = card.getAttribute(&#39;data-summary&#39;).toLowerCase();</span></span>
<span id="cb9-2201"><a href="#cb9-2201" aria-hidden="true" tabindex="-1"></a><span class="st">                const source = card.getAttribute(&#39;data-source&#39;).toLowerCase();</span></span>
<span id="cb9-2202"><a href="#cb9-2202" aria-hidden="true" tabindex="-1"></a><span class="st">                const category = card.getAttribute(&#39;data-category&#39;).toLowerCase();</span></span>
<span id="cb9-2203"><a href="#cb9-2203" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb9-2204"><a href="#cb9-2204" aria-hidden="true" tabindex="-1"></a><span class="st">                const matchesSearch = (title.includes(term) || summary.includes(term) || category.includes(term) || source.includes(term));</span></span>
<span id="cb9-2205"><a href="#cb9-2205" aria-hidden="true" tabindex="-1"></a><span class="st">                const matchesCategory = (currentFilter === &#39;todas&#39; || category === currentFilter);</span></span>
<span id="cb9-2206"><a href="#cb9-2206" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb9-2207"><a href="#cb9-2207" aria-hidden="true" tabindex="-1"></a><span class="st">                if (matchesSearch &amp;&amp; matchesCategory) {</span></span>
<span id="cb9-2208"><a href="#cb9-2208" aria-hidden="true" tabindex="-1"></a><span class="st">                    card.style.display = &#39;block&#39;;</span></span>
<span id="cb9-2209"><a href="#cb9-2209" aria-hidden="true" tabindex="-1"></a><span class="st">                    visible++;</span></span>
<span id="cb9-2210"><a href="#cb9-2210" aria-hidden="true" tabindex="-1"></a><span class="st">                } else {</span></span>
<span id="cb9-2211"><a href="#cb9-2211" aria-hidden="true" tabindex="-1"></a><span class="st">                    card.style.display = &#39;none&#39;;</span></span>
<span id="cb9-2212"><a href="#cb9-2212" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb9-2213"><a href="#cb9-2213" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb9-2214"><a href="#cb9-2214" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-2215"><a href="#cb9-2215" aria-hidden="true" tabindex="-1"></a><span class="st">            updateStats(visible);</span></span>
<span id="cb9-2216"><a href="#cb9-2216" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-2217"><a href="#cb9-2217" aria-hidden="true" tabindex="-1"></a><span class="st">            const grid = document.getElementById(&#39;conversationsGrid&#39;);</span></span>
<span id="cb9-2218"><a href="#cb9-2218" aria-hidden="true" tabindex="-1"></a><span class="st">            const noResults = document.getElementById(&#39;no-results-message&#39;);</span></span>
<span id="cb9-2219"><a href="#cb9-2219" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="cb9-2220"><a href="#cb9-2220" aria-hidden="true" tabindex="-1"></a><span class="st">            if (visible === 0) {</span></span>
<span id="cb9-2221"><a href="#cb9-2221" aria-hidden="true" tabindex="-1"></a><span class="st">                if (!noResults) {</span></span>
<span id="cb9-2222"><a href="#cb9-2222" aria-hidden="true" tabindex="-1"></a><span class="st">                    const noResultsMsg = document.createElement(&#39;div&#39;);</span></span>
<span id="cb9-2223"><a href="#cb9-2223" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.id = &#39;no-results-message&#39;;</span></span>
<span id="cb9-2224"><a href="#cb9-2224" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.className = &#39;no-results&#39;;</span></span>
<span id="cb9-2225"><a href="#cb9-2225" aria-hidden="true" tabindex="-1"></a><span class="st">                    noResultsMsg.innerHTML = &#39;üîç Nenhuma conversa encontrada. Tente ajustar os filtros ou a pesquisa.&#39;;</span></span>
<span id="cb9-2226"><a href="#cb9-2226" aria-hidden="true" tabindex="-1"></a><span class="st">                    grid.appendChild(noResultsMsg);</span></span>
<span id="cb9-2227"><a href="#cb9-2227" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb9-2228"><a href="#cb9-2228" aria-hidden="true" tabindex="-1"></a><span class="st">            } else if (noResults) {</span></span>
<span id="cb9-2229"><a href="#cb9-2229" aria-hidden="true" tabindex="-1"></a><span class="st">                noResults.remove();</span></span>
<span id="cb9-2230"><a href="#cb9-2230" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-2231"><a href="#cb9-2231" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb9-2232"><a href="#cb9-2232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2233"><a href="#cb9-2233" aria-hidden="true" tabindex="-1"></a><span class="st">        function updateStats(visibleCount = null) {</span></span>
<span id="cb9-2234"><a href="#cb9-2234" aria-hidden="true" tabindex="-1"></a><span class="st">            const totalElement = document.getElementById(&#39;total-count&#39;);</span></span>
<span id="cb9-2235"><a href="#cb9-2235" aria-hidden="true" tabindex="-1"></a><span class="st">            if (visibleCount !== null) {</span></span>
<span id="cb9-2236"><a href="#cb9-2236" aria-hidden="true" tabindex="-1"></a><span class="st">                totalElement.textContent = visibleCount;</span></span>
<span id="cb9-2237"><a href="#cb9-2237" aria-hidden="true" tabindex="-1"></a><span class="st">            } else {</span></span>
<span id="cb9-2238"><a href="#cb9-2238" aria-hidden="true" tabindex="-1"></a><span class="st">                totalElement.textContent = &quot;&quot;&quot;</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(<span class="va">self</span>.all_conversations)) <span class="op">+</span> <span class="st">&quot;&quot;&quot;;</span></span>
<span id="cb9-2239"><a href="#cb9-2239" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-2240"><a href="#cb9-2240" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb9-2241"><a href="#cb9-2241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2242"><a href="#cb9-2242" aria-hidden="true" tabindex="-1"></a><span class="st">        function openHTML(filename) {</span></span>
<span id="cb9-2243"><a href="#cb9-2243" aria-hidden="true" tabindex="-1"></a><span class="st">            const htmlUrl = &#39;combined_html/&#39; + filename;</span></span>
<span id="cb9-2244"><a href="#cb9-2244" aria-hidden="true" tabindex="-1"></a><span class="st">            console.log(&#39;Abrindo HTML:&#39;, htmlUrl);</span></span>
<span id="cb9-2245"><a href="#cb9-2245" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(htmlUrl, &#39;_blank&#39;);</span></span>
<span id="cb9-2246"><a href="#cb9-2246" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb9-2247"><a href="#cb9-2247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2248"><a href="#cb9-2248" aria-hidden="true" tabindex="-1"></a><span class="st">        function openMD(filename) {</span></span>
<span id="cb9-2249"><a href="#cb9-2249" aria-hidden="true" tabindex="-1"></a><span class="st">            const mdUrl = &#39;combined_markdown/&#39; + filename;</span></span>
<span id="cb9-2250"><a href="#cb9-2250" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(mdUrl, &#39;_blank&#39;);</span></span>
<span id="cb9-2251"><a href="#cb9-2251" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb9-2252"><a href="#cb9-2252" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb9-2253"><a href="#cb9-2253" aria-hidden="true" tabindex="-1"></a><span class="st">        function openPDF(filename) {</span></span>
<span id="cb9-2254"><a href="#cb9-2254" aria-hidden="true" tabindex="-1"></a><span class="st">            const pdfFile = filename.replace(&#39;.html&#39;, &#39;.pdf&#39;);</span></span>
<span id="cb9-2255"><a href="#cb9-2255" aria-hidden="true" tabindex="-1"></a><span class="st">            const pdfUrl = &#39;combined_pdfs/&#39; + pdfFile;</span></span>
<span id="cb9-2256"><a href="#cb9-2256" aria-hidden="true" tabindex="-1"></a><span class="st">            window.open(pdfUrl, &#39;_blank&#39;);</span></span>
<span id="cb9-2257"><a href="#cb9-2257" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb9-2258"><a href="#cb9-2258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2259"><a href="#cb9-2259" aria-hidden="true" tabindex="-1"></a><span class="st">        document.addEventListener(&#39;keydown&#39;, function(e) {</span></span>
<span id="cb9-2260"><a href="#cb9-2260" aria-hidden="true" tabindex="-1"></a><span class="st">            if (e.key === &#39;Escape&#39;) {</span></span>
<span id="cb9-2261"><a href="#cb9-2261" aria-hidden="true" tabindex="-1"></a><span class="st">                document.getElementById(&#39;searchInput&#39;).value = &#39;&#39;;</span></span>
<span id="cb9-2262"><a href="#cb9-2262" aria-hidden="true" tabindex="-1"></a><span class="st">                filterConversations();</span></span>
<span id="cb9-2263"><a href="#cb9-2263" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb9-2264"><a href="#cb9-2264" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb9-2265"><a href="#cb9-2265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2266"><a href="#cb9-2266" aria-hidden="true" tabindex="-1"></a><span class="st">        document.querySelectorAll(&#39;.conversation-card&#39;).forEach(card =&gt; {</span></span>
<span id="cb9-2267"><a href="#cb9-2267" aria-hidden="true" tabindex="-1"></a><span class="st">            card.addEventListener(&#39;click&#39;, function(e) {</span></span>
<span id="cb9-2268"><a href="#cb9-2268" aria-hidden="true" tabindex="-1"></a><span class="st">                if (e.target.closest(&#39;.action-btn&#39;)) {</span></span>
<span id="cb9-2269"><a href="#cb9-2269" aria-hidden="true" tabindex="-1"></a><span class="st">                    return;</span></span>
<span id="cb9-2270"><a href="#cb9-2270" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb9-2271"><a href="#cb9-2271" aria-hidden="true" tabindex="-1"></a><span class="st">                </span></span>
<span id="cb9-2272"><a href="#cb9-2272" aria-hidden="true" tabindex="-1"></a><span class="st">                const htmlBtn = this.querySelector(&#39;a.html-btn&#39;);</span></span>
<span id="cb9-2273"><a href="#cb9-2273" aria-hidden="true" tabindex="-1"></a><span class="st">                if (htmlBtn) {</span></span>
<span id="cb9-2274"><a href="#cb9-2274" aria-hidden="true" tabindex="-1"></a><span class="st">                    const htmlUrl = htmlBtn.getAttribute(&#39;href&#39;);</span></span>
<span id="cb9-2275"><a href="#cb9-2275" aria-hidden="true" tabindex="-1"></a><span class="st">                    window.open(htmlUrl, &#39;_blank&#39;);</span></span>
<span id="cb9-2276"><a href="#cb9-2276" aria-hidden="true" tabindex="-1"></a><span class="st">                }</span></span>
<span id="cb9-2277"><a href="#cb9-2277" aria-hidden="true" tabindex="-1"></a><span class="st">            });</span></span>
<span id="cb9-2278"><a href="#cb9-2278" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb9-2279"><a href="#cb9-2279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2280"><a href="#cb9-2280" aria-hidden="true" tabindex="-1"></a><span class="st">        document.getElementById(&#39;searchInput&#39;).focus();</span></span>
<span id="cb9-2281"><a href="#cb9-2281" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb9-2282"><a href="#cb9-2282" aria-hidden="true" tabindex="-1"></a><span class="st">        console.log(&#39;√çndice carregado com&#39;, &quot;&quot;&quot;</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(<span class="va">self</span>.all_conversations)) <span class="op">+</span> <span class="st">&quot;&quot;&quot;, &#39;conversas&#39;);</span></span>
<span id="cb9-2283"><a href="#cb9-2283" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/script&gt;</span></span>
<span id="cb9-2284"><a href="#cb9-2284" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/body&gt;</span></span>
<span id="cb9-2285"><a href="#cb9-2285" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/html&gt;</span></span>
<span id="cb9-2286"><a href="#cb9-2286" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb9-2287"><a href="#cb9-2287" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-2288"><a href="#cb9-2288" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(<span class="va">self</span>.index_file, <span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb9-2289"><a href="#cb9-2289" aria-hidden="true" tabindex="-1"></a>            f.write(html_content)</span>
<span id="cb9-2290"><a href="#cb9-2290" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f&quot;‚úÖ √çndice combinado criado: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>index_file<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb9-2291"><a href="#cb9-2291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2292"><a href="#cb9-2292" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb9-2293"><a href="#cb9-2293" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser(</span>
<span id="cb9-2294"><a href="#cb9-2294" aria-hidden="true" tabindex="-1"></a>        description<span class="op">=</span><span class="st">&quot;Processa exporta√ß√µes combinadas com exporta√ß√£o HTML via Pandoc.&quot;</span></span>
<span id="cb9-2295"><a href="#cb9-2295" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-2296"><a href="#cb9-2296" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">&quot;--dry-run&quot;</span>, action<span class="op">=</span><span class="st">&quot;store_true&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Executa sem salvar arquivos&quot;</span>)</span>
<span id="cb9-2297"><a href="#cb9-2297" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">&quot;--force-overwrite&quot;</span>, action<span class="op">=</span><span class="st">&quot;store_true&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Substitui arquivos existentes&quot;</span>)</span>
<span id="cb9-2298"><a href="#cb9-2298" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-2299"><a href="#cb9-2299" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb9-2300"><a href="#cb9-2300" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-2301"><a href="#cb9-2301" aria-hidden="true" tabindex="-1"></a>    system <span class="op">=</span> CombinedFragmentsSystem(</span>
<span id="cb9-2302"><a href="#cb9-2302" aria-hidden="true" tabindex="-1"></a>        dry_run<span class="op">=</span>args.dry_run,</span>
<span id="cb9-2303"><a href="#cb9-2303" aria-hidden="true" tabindex="-1"></a>        force_overwrite<span class="op">=</span>args.force_overwrite</span>
<span id="cb9-2304"><a href="#cb9-2304" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-2305"><a href="#cb9-2305" aria-hidden="true" tabindex="-1"></a>    system.run()</span>
<span id="cb9-2306"><a href="#cb9-2306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2307"><a href="#cb9-2307" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb9-2308"><a href="#cb9-2308" aria-hidden="true" tabindex="-1"></a>    main()</span></code></pre></div>
<p><strong>Altera√ß√µes principais realizadas:</strong></p>
<ol type="1">
<li><strong><code>--toc-depth=3</code></strong> em ambos os m√©todos de
convers√£o:
<ul>
<li><code>_convert_with_pandoc_optimized</code> - linha com
<code>&#39;--toc-depth=3&#39;</code></li>
<li><code>_convert_with_pandoc_basic</code> - linha com
<code>&#39;--toc-depth=3&#39;</code></li>
</ul></li>
<li><strong>CSS atualizado</strong> para suportar 3 n√≠veis de TOC:
<ul>
<li>Adicionado <code>#TOC ul ul ul</code> com
<code>padding-left: 35px</code> para mais indenta√ß√£o</li>
<li>Adicionado <code>.toc ul ul ul</code> com
<code>padding-left: 35px</code> no template fallback</li>
</ul></li>
</ol>
<p>Agora o TOC incluir√° cabe√ßalhos de n√≠vel 1, 2 e 3 (h1, h2, h3),
proporcionando uma navega√ß√£o mais detalhada atrav√©s das conversas.</p>
<hr />
<p><em>Conversa exportada do DeepSeek</em> <em>Processado em: 23/11/2025
23:05</em></p>

        <script id="fixed-toc-script">
        document.addEventListener('DOMContentLoaded', function() {
            const toc = document.getElementById('TOC');
            if (toc) {
                const tocTitle = toc.querySelector('h2');
                if (tocTitle) {
                    const toggleBtn = document.createElement('button');
                    toggleBtn.innerHTML = '‚ò∞';
                    toggleBtn.className = 'toc-toggle-btn';
                    toggleBtn.title = 'Minimizar/Expandir TOC';
                    let isMinimized = false;
                    toggleBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        isMinimized = !isMinimized;
                        if (isMinimized) {
                            toc.classList.add('toc-minimized');
                        } else {
                            toc.classList.remove('toc-minimized');
                        }
                    });
                    tocTitle.appendChild(toggleBtn);
                }
            }
            
            // SCROLLSPY
            const sections = document.querySelectorAll('h1, h2, h3, h4, h5');
            const tocLinks = document.querySelectorAll('#TOC a');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.getAttribute('id');
                        tocLinks.forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href') === '#' + id) {
                                link.classList.add('active');
                            }
                        });
                    }
                });
            }, { 
                rootMargin: '-20% 0px -60% 0px', 
                threshold: 0 
            });
            
            sections.forEach(section => {
                if (section.id) observer.observe(section);
            });
            
            // Scroll suave
            tocLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        const offsetTop = targetElement.offsetTop - 80;
                        window.scrollTo({ top: offsetTop, behavior: 'smooth' });
                    }
                });
            });
            
            // BOT√ÉO VOLTAR AO TOPO
            const backToTopBtn = document.createElement('button');
            backToTopBtn.className = 'back-to-top-content';
            backToTopBtn.innerHTML = '‚Üë';
            backToTopBtn.title = 'Voltar ao Topo';
            document.body.appendChild(backToTopBtn);
            
            window.addEventListener('scroll', () => {
                if (window.pageYOffset > 300) {
                    backToTopBtn.classList.add('show');
                } else {
                    backToTopBtn.classList.remove('show');
                }
            });
            
            backToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
        </script>
        
</body>
</html>
